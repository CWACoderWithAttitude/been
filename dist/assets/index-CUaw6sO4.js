function x6(ae,me){for(var Ie=0;Ie<me.length;Ie++){const oe=me[Ie];if(typeof oe!="string"&&!Array.isArray(oe)){for(const Ae in oe)if(Ae!=="default"&&!(Ae in ae)){const ke=Object.getOwnPropertyDescriptor(oe,Ae);ke&&Object.defineProperty(ae,Ae,ke.get?ke:{enumerable:!0,get:()=>oe[Ae]})}}}return Object.freeze(Object.defineProperty(ae,Symbol.toStringTag,{value:"Module"}))}(function(){const me=document.createElement("link").relList;if(me&&me.supports&&me.supports("modulepreload"))return;for(const Ae of document.querySelectorAll('link[rel="modulepreload"]'))oe(Ae);new MutationObserver(Ae=>{for(const ke of Ae)if(ke.type==="childList")for(const ft of ke.addedNodes)ft.tagName==="LINK"&&ft.rel==="modulepreload"&&oe(ft)}).observe(document,{childList:!0,subtree:!0});function Ie(Ae){const ke={};return Ae.integrity&&(ke.integrity=Ae.integrity),Ae.referrerPolicy&&(ke.referrerPolicy=Ae.referrerPolicy),Ae.crossOrigin==="use-credentials"?ke.credentials="include":Ae.crossOrigin==="anonymous"?ke.credentials="omit":ke.credentials="same-origin",ke}function oe(Ae){if(Ae.ep)return;Ae.ep=!0;const ke=Ie(Ae);fetch(Ae.href,ke)}})();function v2(ae){return ae&&ae.__esModule&&Object.prototype.hasOwnProperty.call(ae,"default")?ae.default:ae}var f2={exports:{}},Zm={};var t4;function b6(){if(t4)return Zm;t4=1;var ae=Symbol.for("react.transitional.element"),me=Symbol.for("react.fragment");function Ie(oe,Ae,ke){var ft=null;if(ke!==void 0&&(ft=""+ke),Ae.key!==void 0&&(ft=""+Ae.key),"key"in Ae){ke={};for(var o in Ae)o!=="key"&&(ke[o]=Ae[o])}else ke=Ae;return Ae=ke.ref,{$$typeof:ae,type:oe,key:ft,ref:Ae!==void 0?Ae:null,props:ke}}return Zm.Fragment=me,Zm.jsx=Ie,Zm.jsxs=Ie,Zm}var i4;function w6(){return i4||(i4=1,f2.exports=b6()),f2.exports}var Bi=w6(),p2={exports:{}},zn={};var n4;function T6(){if(n4)return zn;n4=1;var ae=Symbol.for("react.transitional.element"),me=Symbol.for("react.portal"),Ie=Symbol.for("react.fragment"),oe=Symbol.for("react.strict_mode"),Ae=Symbol.for("react.profiler"),ke=Symbol.for("react.consumer"),ft=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),Tt=Symbol.for("react.suspense"),We=Symbol.for("react.memo"),ci=Symbol.for("react.lazy"),Ft=Symbol.for("react.activity"),Pi=Symbol.iterator;function Hi(Ue){return Ue===null||typeof Ue!="object"?null:(Ue=Pi&&Ue[Pi]||Ue["@@iterator"],typeof Ue=="function"?Ue:null)}var yn={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},hi=Object.assign,$i={};function vn(Ue,Pt,qt){this.props=Ue,this.context=Pt,this.refs=$i,this.updater=qt||yn}vn.prototype.isReactComponent={},vn.prototype.setState=function(Ue,Pt){if(typeof Ue!="object"&&typeof Ue!="function"&&Ue!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ue,Pt,"setState")},vn.prototype.forceUpdate=function(Ue){this.updater.enqueueForceUpdate(this,Ue,"forceUpdate")};function Ci(){}Ci.prototype=vn.prototype;function ki(Ue,Pt,qt){this.props=Ue,this.context=Pt,this.refs=$i,this.updater=qt||yn}var si=ki.prototype=new Ci;si.constructor=ki,hi(si,vn.prototype),si.isPureReactComponent=!0;var _n=Array.isArray;function mr(){}var ln={H:null,A:null,T:null,S:null},ea=Object.prototype.hasOwnProperty;function Oa(Ue,Pt,qt){var gi=qt.ref;return{$$typeof:ae,type:Ue,key:Pt,ref:gi!==void 0?gi:null,props:qt}}function Ss(Ue,Pt){return Oa(Ue.type,Pt,Ue.props)}function no(Ue){return typeof Ue=="object"&&Ue!==null&&Ue.$$typeof===ae}function xa(Ue){var Pt={"=":"=0",":":"=2"};return"$"+Ue.replace(/[=:]/g,function(qt){return Pt[qt]})}var Yi=/\/+/g;function Bo(Ue,Pt){return typeof Ue=="object"&&Ue!==null&&Ue.key!=null?xa(""+Ue.key):Pt.toString(36)}function zr(Ue){switch(Ue.status){case"fulfilled":return Ue.value;case"rejected":throw Ue.reason;default:switch(typeof Ue.status=="string"?Ue.then(mr,mr):(Ue.status="pending",Ue.then(function(Pt){Ue.status==="pending"&&(Ue.status="fulfilled",Ue.value=Pt)},function(Pt){Ue.status==="pending"&&(Ue.status="rejected",Ue.reason=Pt)})),Ue.status){case"fulfilled":return Ue.value;case"rejected":throw Ue.reason}}throw Ue}function yt(Ue,Pt,qt,gi,fn){var En=typeof Ue;(En==="undefined"||En==="boolean")&&(Ue=null);var Kn=!1;if(Ue===null)Kn=!0;else switch(En){case"bigint":case"string":case"number":Kn=!0;break;case"object":switch(Ue.$$typeof){case ae:case me:Kn=!0;break;case ci:return Kn=Ue._init,yt(Kn(Ue._payload),Pt,qt,gi,fn)}}if(Kn)return fn=fn(Ue),Kn=gi===""?"."+Bo(Ue,0):gi,_n(fn)?(qt="",Kn!=null&&(qt=Kn.replace(Yi,"$&/")+"/"),yt(fn,Pt,qt,"",function(br){return br})):fn!=null&&(no(fn)&&(fn=Ss(fn,qt+(fn.key==null||Ue&&Ue.key===fn.key?"":(""+fn.key).replace(Yi,"$&/")+"/")+Kn)),Pt.push(fn)),1;Kn=0;var Lr=gi===""?".":gi+":";if(_n(Ue))for(var Li=0;Li<Ue.length;Li++)gi=Ue[Li],En=Lr+Bo(gi,Li),Kn+=yt(gi,Pt,qt,En,fn);else if(Li=Hi(Ue),typeof Li=="function")for(Ue=Li.call(Ue),Li=0;!(gi=Ue.next()).done;)gi=gi.value,En=Lr+Bo(gi,Li++),Kn+=yt(gi,Pt,qt,En,fn);else if(En==="object"){if(typeof Ue.then=="function")return yt(zr(Ue),Pt,qt,gi,fn);throw Pt=String(Ue),Error("Objects are not valid as a React child (found: "+(Pt==="[object Object]"?"object with keys {"+Object.keys(Ue).join(", ")+"}":Pt)+"). If you meant to render a collection of children, use an array instead.")}return Kn}function jt(Ue,Pt,qt){if(Ue==null)return Ue;var gi=[],fn=0;return yt(Ue,gi,"","",function(En){return Pt.call(qt,En,fn++)}),gi}function _i(Ue){if(Ue._status===-1){var Pt=Ue._result;Pt=Pt(),Pt.then(function(qt){(Ue._status===0||Ue._status===-1)&&(Ue._status=1,Ue._result=qt)},function(qt){(Ue._status===0||Ue._status===-1)&&(Ue._status=2,Ue._result=qt)}),Ue._status===-1&&(Ue._status=0,Ue._result=Pt)}if(Ue._status===1)return Ue._result.default;throw Ue._result}var On=typeof reportError=="function"?reportError:function(Ue){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Pt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Ue=="object"&&Ue!==null&&typeof Ue.message=="string"?String(Ue.message):String(Ue),error:Ue});if(!window.dispatchEvent(Pt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Ue);return}console.error(Ue)},Fn={map:jt,forEach:function(Ue,Pt,qt){jt(Ue,function(){Pt.apply(this,arguments)},qt)},count:function(Ue){var Pt=0;return jt(Ue,function(){Pt++}),Pt},toArray:function(Ue){return jt(Ue,function(Pt){return Pt})||[]},only:function(Ue){if(!no(Ue))throw Error("React.Children.only expected to receive a single React element child.");return Ue}};return zn.Activity=Ft,zn.Children=Fn,zn.Component=vn,zn.Fragment=Ie,zn.Profiler=Ae,zn.PureComponent=ki,zn.StrictMode=oe,zn.Suspense=Tt,zn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ln,zn.__COMPILER_RUNTIME={__proto__:null,c:function(Ue){return ln.H.useMemoCache(Ue)}},zn.cache=function(Ue){return function(){return Ue.apply(null,arguments)}},zn.cacheSignal=function(){return null},zn.cloneElement=function(Ue,Pt,qt){if(Ue==null)throw Error("The argument must be a React element, but you passed "+Ue+".");var gi=hi({},Ue.props),fn=Ue.key;if(Pt!=null)for(En in Pt.key!==void 0&&(fn=""+Pt.key),Pt)!ea.call(Pt,En)||En==="key"||En==="__self"||En==="__source"||En==="ref"&&Pt.ref===void 0||(gi[En]=Pt[En]);var En=arguments.length-2;if(En===1)gi.children=qt;else if(1<En){for(var Kn=Array(En),Lr=0;Lr<En;Lr++)Kn[Lr]=arguments[Lr+2];gi.children=Kn}return Oa(Ue.type,fn,gi)},zn.createContext=function(Ue){return Ue={$$typeof:ft,_currentValue:Ue,_currentValue2:Ue,_threadCount:0,Provider:null,Consumer:null},Ue.Provider=Ue,Ue.Consumer={$$typeof:ke,_context:Ue},Ue},zn.createElement=function(Ue,Pt,qt){var gi,fn={},En=null;if(Pt!=null)for(gi in Pt.key!==void 0&&(En=""+Pt.key),Pt)ea.call(Pt,gi)&&gi!=="key"&&gi!=="__self"&&gi!=="__source"&&(fn[gi]=Pt[gi]);var Kn=arguments.length-2;if(Kn===1)fn.children=qt;else if(1<Kn){for(var Lr=Array(Kn),Li=0;Li<Kn;Li++)Lr[Li]=arguments[Li+2];fn.children=Lr}if(Ue&&Ue.defaultProps)for(gi in Kn=Ue.defaultProps,Kn)fn[gi]===void 0&&(fn[gi]=Kn[gi]);return Oa(Ue,En,fn)},zn.createRef=function(){return{current:null}},zn.forwardRef=function(Ue){return{$$typeof:o,render:Ue}},zn.isValidElement=no,zn.lazy=function(Ue){return{$$typeof:ci,_payload:{_status:-1,_result:Ue},_init:_i}},zn.memo=function(Ue,Pt){return{$$typeof:We,type:Ue,compare:Pt===void 0?null:Pt}},zn.startTransition=function(Ue){var Pt=ln.T,qt={};ln.T=qt;try{var gi=Ue(),fn=ln.S;fn!==null&&fn(qt,gi),typeof gi=="object"&&gi!==null&&typeof gi.then=="function"&&gi.then(mr,On)}catch(En){On(En)}finally{Pt!==null&&qt.types!==null&&(Pt.types=qt.types),ln.T=Pt}},zn.unstable_useCacheRefresh=function(){return ln.H.useCacheRefresh()},zn.use=function(Ue){return ln.H.use(Ue)},zn.useActionState=function(Ue,Pt,qt){return ln.H.useActionState(Ue,Pt,qt)},zn.useCallback=function(Ue,Pt){return ln.H.useCallback(Ue,Pt)},zn.useContext=function(Ue){return ln.H.useContext(Ue)},zn.useDebugValue=function(){},zn.useDeferredValue=function(Ue,Pt){return ln.H.useDeferredValue(Ue,Pt)},zn.useEffect=function(Ue,Pt){return ln.H.useEffect(Ue,Pt)},zn.useEffectEvent=function(Ue){return ln.H.useEffectEvent(Ue)},zn.useId=function(){return ln.H.useId()},zn.useImperativeHandle=function(Ue,Pt,qt){return ln.H.useImperativeHandle(Ue,Pt,qt)},zn.useInsertionEffect=function(Ue,Pt){return ln.H.useInsertionEffect(Ue,Pt)},zn.useLayoutEffect=function(Ue,Pt){return ln.H.useLayoutEffect(Ue,Pt)},zn.useMemo=function(Ue,Pt){return ln.H.useMemo(Ue,Pt)},zn.useOptimistic=function(Ue,Pt){return ln.H.useOptimistic(Ue,Pt)},zn.useReducer=function(Ue,Pt,qt){return ln.H.useReducer(Ue,Pt,qt)},zn.useRef=function(Ue){return ln.H.useRef(Ue)},zn.useState=function(Ue){return ln.H.useState(Ue)},zn.useSyncExternalStore=function(Ue,Pt,qt){return ln.H.useSyncExternalStore(Ue,Pt,qt)},zn.useTransition=function(){return ln.H.useTransition()},zn.version="19.2.0",zn}var r4;function x2(){return r4||(r4=1,p2.exports=T6()),p2.exports}var di=x2();const S6=v2(di);var m2={exports:{}},Xm={},_2={exports:{}},g2={};var a4;function E6(){return a4||(a4=1,(function(ae){function me(yt,jt){var _i=yt.length;yt.push(jt);e:for(;0<_i;){var On=_i-1>>>1,Fn=yt[On];if(0<Ae(Fn,jt))yt[On]=jt,yt[_i]=Fn,_i=On;else break e}}function Ie(yt){return yt.length===0?null:yt[0]}function oe(yt){if(yt.length===0)return null;var jt=yt[0],_i=yt.pop();if(_i!==jt){yt[0]=_i;e:for(var On=0,Fn=yt.length,Ue=Fn>>>1;On<Ue;){var Pt=2*(On+1)-1,qt=yt[Pt],gi=Pt+1,fn=yt[gi];if(0>Ae(qt,_i))gi<Fn&&0>Ae(fn,qt)?(yt[On]=fn,yt[gi]=_i,On=gi):(yt[On]=qt,yt[Pt]=_i,On=Pt);else if(gi<Fn&&0>Ae(fn,_i))yt[On]=fn,yt[gi]=_i,On=gi;else break e}}return jt}function Ae(yt,jt){var _i=yt.sortIndex-jt.sortIndex;return _i!==0?_i:yt.id-jt.id}if(ae.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var ke=performance;ae.unstable_now=function(){return ke.now()}}else{var ft=Date,o=ft.now();ae.unstable_now=function(){return ft.now()-o}}var Tt=[],We=[],ci=1,Ft=null,Pi=3,Hi=!1,yn=!1,hi=!1,$i=!1,vn=typeof setTimeout=="function"?setTimeout:null,Ci=typeof clearTimeout=="function"?clearTimeout:null,ki=typeof setImmediate<"u"?setImmediate:null;function si(yt){for(var jt=Ie(We);jt!==null;){if(jt.callback===null)oe(We);else if(jt.startTime<=yt)oe(We),jt.sortIndex=jt.expirationTime,me(Tt,jt);else break;jt=Ie(We)}}function _n(yt){if(hi=!1,si(yt),!yn)if(Ie(Tt)!==null)yn=!0,mr||(mr=!0,xa());else{var jt=Ie(We);jt!==null&&zr(_n,jt.startTime-yt)}}var mr=!1,ln=-1,ea=5,Oa=-1;function Ss(){return $i?!0:!(ae.unstable_now()-Oa<ea)}function no(){if($i=!1,mr){var yt=ae.unstable_now();Oa=yt;var jt=!0;try{e:{yn=!1,hi&&(hi=!1,Ci(ln),ln=-1),Hi=!0;var _i=Pi;try{t:{for(si(yt),Ft=Ie(Tt);Ft!==null&&!(Ft.expirationTime>yt&&Ss());){var On=Ft.callback;if(typeof On=="function"){Ft.callback=null,Pi=Ft.priorityLevel;var Fn=On(Ft.expirationTime<=yt);if(yt=ae.unstable_now(),typeof Fn=="function"){Ft.callback=Fn,si(yt),jt=!0;break t}Ft===Ie(Tt)&&oe(Tt),si(yt)}else oe(Tt);Ft=Ie(Tt)}if(Ft!==null)jt=!0;else{var Ue=Ie(We);Ue!==null&&zr(_n,Ue.startTime-yt),jt=!1}}break e}finally{Ft=null,Pi=_i,Hi=!1}jt=void 0}}finally{jt?xa():mr=!1}}}var xa;if(typeof ki=="function")xa=function(){ki(no)};else if(typeof MessageChannel<"u"){var Yi=new MessageChannel,Bo=Yi.port2;Yi.port1.onmessage=no,xa=function(){Bo.postMessage(null)}}else xa=function(){vn(no,0)};function zr(yt,jt){ln=vn(function(){yt(ae.unstable_now())},jt)}ae.unstable_IdlePriority=5,ae.unstable_ImmediatePriority=1,ae.unstable_LowPriority=4,ae.unstable_NormalPriority=3,ae.unstable_Profiling=null,ae.unstable_UserBlockingPriority=2,ae.unstable_cancelCallback=function(yt){yt.callback=null},ae.unstable_forceFrameRate=function(yt){0>yt||125<yt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ea=0<yt?Math.floor(1e3/yt):5},ae.unstable_getCurrentPriorityLevel=function(){return Pi},ae.unstable_next=function(yt){switch(Pi){case 1:case 2:case 3:var jt=3;break;default:jt=Pi}var _i=Pi;Pi=jt;try{return yt()}finally{Pi=_i}},ae.unstable_requestPaint=function(){$i=!0},ae.unstable_runWithPriority=function(yt,jt){switch(yt){case 1:case 2:case 3:case 4:case 5:break;default:yt=3}var _i=Pi;Pi=yt;try{return jt()}finally{Pi=_i}},ae.unstable_scheduleCallback=function(yt,jt,_i){var On=ae.unstable_now();switch(typeof _i=="object"&&_i!==null?(_i=_i.delay,_i=typeof _i=="number"&&0<_i?On+_i:On):_i=On,yt){case 1:var Fn=-1;break;case 2:Fn=250;break;case 5:Fn=1073741823;break;case 4:Fn=1e4;break;default:Fn=5e3}return Fn=_i+Fn,yt={id:ci++,callback:jt,priorityLevel:yt,startTime:_i,expirationTime:Fn,sortIndex:-1},_i>On?(yt.sortIndex=_i,me(We,yt),Ie(Tt)===null&&yt===Ie(We)&&(hi?(Ci(ln),ln=-1):hi=!0,zr(_n,_i-On))):(yt.sortIndex=Fn,me(Tt,yt),yn||Hi||(yn=!0,mr||(mr=!0,xa()))),yt},ae.unstable_shouldYield=Ss,ae.unstable_wrapCallback=function(yt){var jt=Pi;return function(){var _i=Pi;Pi=jt;try{return yt.apply(this,arguments)}finally{Pi=_i}}}})(g2)),g2}var o4;function A6(){return o4||(o4=1,_2.exports=E6()),_2.exports}var y2={exports:{}},rs={};var s4;function M6(){if(s4)return rs;s4=1;var ae=x2();function me(Tt){var We="https://react.dev/errors/"+Tt;if(1<arguments.length){We+="?args[]="+encodeURIComponent(arguments[1]);for(var ci=2;ci<arguments.length;ci++)We+="&args[]="+encodeURIComponent(arguments[ci])}return"Minified React error #"+Tt+"; visit "+We+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Ie(){}var oe={d:{f:Ie,r:function(){throw Error(me(522))},D:Ie,C:Ie,L:Ie,m:Ie,X:Ie,S:Ie,M:Ie},p:0,findDOMNode:null},Ae=Symbol.for("react.portal");function ke(Tt,We,ci){var Ft=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ae,key:Ft==null?null:""+Ft,children:Tt,containerInfo:We,implementation:ci}}var ft=ae.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(Tt,We){if(Tt==="font")return"";if(typeof We=="string")return We==="use-credentials"?We:""}return rs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=oe,rs.createPortal=function(Tt,We){var ci=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!We||We.nodeType!==1&&We.nodeType!==9&&We.nodeType!==11)throw Error(me(299));return ke(Tt,We,null,ci)},rs.flushSync=function(Tt){var We=ft.T,ci=oe.p;try{if(ft.T=null,oe.p=2,Tt)return Tt()}finally{ft.T=We,oe.p=ci,oe.d.f()}},rs.preconnect=function(Tt,We){typeof Tt=="string"&&(We?(We=We.crossOrigin,We=typeof We=="string"?We==="use-credentials"?We:"":void 0):We=null,oe.d.C(Tt,We))},rs.prefetchDNS=function(Tt){typeof Tt=="string"&&oe.d.D(Tt)},rs.preinit=function(Tt,We){if(typeof Tt=="string"&&We&&typeof We.as=="string"){var ci=We.as,Ft=o(ci,We.crossOrigin),Pi=typeof We.integrity=="string"?We.integrity:void 0,Hi=typeof We.fetchPriority=="string"?We.fetchPriority:void 0;ci==="style"?oe.d.S(Tt,typeof We.precedence=="string"?We.precedence:void 0,{crossOrigin:Ft,integrity:Pi,fetchPriority:Hi}):ci==="script"&&oe.d.X(Tt,{crossOrigin:Ft,integrity:Pi,fetchPriority:Hi,nonce:typeof We.nonce=="string"?We.nonce:void 0})}},rs.preinitModule=function(Tt,We){if(typeof Tt=="string")if(typeof We=="object"&&We!==null){if(We.as==null||We.as==="script"){var ci=o(We.as,We.crossOrigin);oe.d.M(Tt,{crossOrigin:ci,integrity:typeof We.integrity=="string"?We.integrity:void 0,nonce:typeof We.nonce=="string"?We.nonce:void 0})}}else We==null&&oe.d.M(Tt)},rs.preload=function(Tt,We){if(typeof Tt=="string"&&typeof We=="object"&&We!==null&&typeof We.as=="string"){var ci=We.as,Ft=o(ci,We.crossOrigin);oe.d.L(Tt,ci,{crossOrigin:Ft,integrity:typeof We.integrity=="string"?We.integrity:void 0,nonce:typeof We.nonce=="string"?We.nonce:void 0,type:typeof We.type=="string"?We.type:void 0,fetchPriority:typeof We.fetchPriority=="string"?We.fetchPriority:void 0,referrerPolicy:typeof We.referrerPolicy=="string"?We.referrerPolicy:void 0,imageSrcSet:typeof We.imageSrcSet=="string"?We.imageSrcSet:void 0,imageSizes:typeof We.imageSizes=="string"?We.imageSizes:void 0,media:typeof We.media=="string"?We.media:void 0})}},rs.preloadModule=function(Tt,We){if(typeof Tt=="string")if(We){var ci=o(We.as,We.crossOrigin);oe.d.m(Tt,{as:typeof We.as=="string"&&We.as!=="script"?We.as:void 0,crossOrigin:ci,integrity:typeof We.integrity=="string"?We.integrity:void 0})}else oe.d.m(Tt)},rs.requestFormReset=function(Tt){oe.d.r(Tt)},rs.unstable_batchedUpdates=function(Tt,We){return Tt(We)},rs.useFormState=function(Tt,We,ci){return ft.H.useFormState(Tt,We,ci)},rs.useFormStatus=function(){return ft.H.useHostTransitionStatus()},rs.version="19.2.0",rs}var l4;function w4(){if(l4)return y2.exports;l4=1;function ae(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ae)}catch(me){console.error(me)}}return ae(),y2.exports=M6(),y2.exports}var c4;function I6(){if(c4)return Xm;c4=1;var ae=A6(),me=x2(),Ie=w4();function oe(s){var d="https://react.dev/errors/"+s;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)d+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+s+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Ae(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function ke(s){var d=s,g=s;if(s.alternate)for(;d.return;)d=d.return;else{s=d;do d=s,(d.flags&4098)!==0&&(g=d.return),s=d.return;while(s)}return d.tag===3?g:null}function ft(s){if(s.tag===13){var d=s.memoizedState;if(d===null&&(s=s.alternate,s!==null&&(d=s.memoizedState)),d!==null)return d.dehydrated}return null}function o(s){if(s.tag===31){var d=s.memoizedState;if(d===null&&(s=s.alternate,s!==null&&(d=s.memoizedState)),d!==null)return d.dehydrated}return null}function Tt(s){if(ke(s)!==s)throw Error(oe(188))}function We(s){var d=s.alternate;if(!d){if(d=ke(s),d===null)throw Error(oe(188));return d!==s?null:s}for(var g=s,w=d;;){var C=g.return;if(C===null)break;var L=C.alternate;if(L===null){if(w=C.return,w!==null){g=w;continue}break}if(C.child===L.child){for(L=C.child;L;){if(L===g)return Tt(C),s;if(L===w)return Tt(C),d;L=L.sibling}throw Error(oe(188))}if(g.return!==w.return)g=C,w=L;else{for(var X=!1,he=C.child;he;){if(he===g){X=!0,g=C,w=L;break}if(he===w){X=!0,w=C,g=L;break}he=he.sibling}if(!X){for(he=L.child;he;){if(he===g){X=!0,g=L,w=C;break}if(he===w){X=!0,w=L,g=C;break}he=he.sibling}if(!X)throw Error(oe(189))}}if(g.alternate!==w)throw Error(oe(190))}if(g.tag!==3)throw Error(oe(188));return g.stateNode.current===g?s:d}function ci(s){var d=s.tag;if(d===5||d===26||d===27||d===6)return s;for(s=s.child;s!==null;){if(d=ci(s),d!==null)return d;s=s.sibling}return null}var Ft=Object.assign,Pi=Symbol.for("react.element"),Hi=Symbol.for("react.transitional.element"),yn=Symbol.for("react.portal"),hi=Symbol.for("react.fragment"),$i=Symbol.for("react.strict_mode"),vn=Symbol.for("react.profiler"),Ci=Symbol.for("react.consumer"),ki=Symbol.for("react.context"),si=Symbol.for("react.forward_ref"),_n=Symbol.for("react.suspense"),mr=Symbol.for("react.suspense_list"),ln=Symbol.for("react.memo"),ea=Symbol.for("react.lazy"),Oa=Symbol.for("react.activity"),Ss=Symbol.for("react.memo_cache_sentinel"),no=Symbol.iterator;function xa(s){return s===null||typeof s!="object"?null:(s=no&&s[no]||s["@@iterator"],typeof s=="function"?s:null)}var Yi=Symbol.for("react.client.reference");function Bo(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===Yi?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case hi:return"Fragment";case vn:return"Profiler";case $i:return"StrictMode";case _n:return"Suspense";case mr:return"SuspenseList";case Oa:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case yn:return"Portal";case ki:return s.displayName||"Context";case Ci:return(s._context.displayName||"Context")+".Consumer";case si:var d=s.render;return s=s.displayName,s||(s=d.displayName||d.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case ln:return d=s.displayName||null,d!==null?d:Bo(s.type)||"Memo";case ea:d=s._payload,s=s._init;try{return Bo(s(d))}catch{}}return null}var zr=Array.isArray,yt=me.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,jt=Ie.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,_i={pending:!1,data:null,method:null,action:null},On=[],Fn=-1;function Ue(s){return{current:s}}function Pt(s){0>Fn||(s.current=On[Fn],On[Fn]=null,Fn--)}function qt(s,d){Fn++,On[Fn]=s.current,s.current=d}var gi=Ue(null),fn=Ue(null),En=Ue(null),Kn=Ue(null);function Lr(s,d){switch(qt(En,d),qt(fn,s),qt(gi,null),d.nodeType){case 9:case 11:s=(s=d.documentElement)&&(s=s.namespaceURI)?im(s):0;break;default:if(s=d.tagName,d=d.namespaceURI)d=im(d),s=_f(d,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}Pt(gi),qt(gi,s)}function Li(){Pt(gi),Pt(fn),Pt(En)}function br(s){s.memoizedState!==null&&qt(Kn,s);var d=gi.current,g=_f(d,s.type);d!==g&&(qt(fn,s),qt(gi,g))}function Br(s){fn.current===s&&(Pt(gi),Pt(fn)),Kn.current===s&&(Pt(Kn),M1._currentValue=_i)}var Ol,sr;function ro(s){if(Ol===void 0)try{throw Error()}catch(g){var d=g.stack.trim().match(/\n( *(at )?)/);Ol=d&&d[1]||"",sr=-1<g.stack.indexOf(`
    at`)?" (<anonymous>)":-1<g.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ol+s+sr}var $a=!1;function wo(s,d){if(!s||$a)return"";$a=!0;var g=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var w={DetermineComponentFrameRoot:function(){try{if(d){var Bt=function(){throw Error()};if(Object.defineProperty(Bt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Bt,[])}catch(wt){var _t=wt}Reflect.construct(s,[],Bt)}else{try{Bt.call()}catch(wt){_t=wt}s.call(Bt.prototype)}}else{try{throw Error()}catch(wt){_t=wt}(Bt=s())&&typeof Bt.catch=="function"&&Bt.catch(function(){})}}catch(wt){if(wt&&_t&&typeof wt.stack=="string")return[wt.stack,_t.stack]}return[null,null]}};w.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var C=Object.getOwnPropertyDescriptor(w.DetermineComponentFrameRoot,"name");C&&C.configurable&&Object.defineProperty(w.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var L=w.DetermineComponentFrameRoot(),X=L[0],he=L[1];if(X&&he){var De=X.split(`
`),ht=he.split(`
`);for(C=w=0;w<De.length&&!De[w].includes("DetermineComponentFrameRoot");)w++;for(;C<ht.length&&!ht[C].includes("DetermineComponentFrameRoot");)C++;if(w===De.length||C===ht.length)for(w=De.length-1,C=ht.length-1;1<=w&&0<=C&&De[w]!==ht[C];)C--;for(;1<=w&&0<=C;w--,C--)if(De[w]!==ht[C]){if(w!==1||C!==1)do if(w--,C--,0>C||De[w]!==ht[C]){var Dt=`
`+De[w].replace(" at new "," at ");return s.displayName&&Dt.includes("<anonymous>")&&(Dt=Dt.replace("<anonymous>",s.displayName)),Dt}while(1<=w&&0<=C);break}}}finally{$a=!1,Error.prepareStackTrace=g}return(g=s?s.displayName||s.name:"")?ro(g):""}function Es(s,d){switch(s.tag){case 26:case 27:case 5:return ro(s.type);case 16:return ro("Lazy");case 13:return s.child!==d&&d!==null?ro("Suspense Fallback"):ro("Suspense");case 19:return ro("SuspenseList");case 0:case 15:return wo(s.type,!1);case 11:return wo(s.type.render,!1);case 1:return wo(s.type,!0);case 31:return ro("Activity");default:return""}}function Sr(s){try{var d="",g=null;do d+=Es(s,g),g=s,s=s.return;while(s);return d}catch(w){return`
Error generating stack: `+w.message+`
`+w.stack}}var gc=Object.prototype.hasOwnProperty,ol=ae.unstable_scheduleCallback,Fa=ae.unstable_cancelCallback,Fl=ae.unstable_shouldYield,_h=ae.unstable_requestPaint,Er=ae.unstable_now,Bl=ae.unstable_getCurrentPriorityLevel,as=ae.unstable_ImmediatePriority,As=ae.unstable_UserBlockingPriority,Ms=ae.unstable_NormalPriority,Wa=ae.unstable_LowPriority,kl=ae.unstable_IdlePriority,Is=ae.log,gu=ae.unstable_setDisableYieldValue,Cs=null,Vn=null;function ao(s){if(typeof Is=="function"&&gu(s),Vn&&typeof Vn.setStrictMode=="function")try{Vn.setStrictMode(Cs,s)}catch{}}var ba=Math.clz32?Math.clz32:ko,sl=Math.log,os=Math.LN2;function ko(s){return s>>>=0,s===0?32:31-(sl(s)/os|0)|0}var Zn=256,ta=262144,zs=4194304;function oo(s){var d=s&42;if(d!==0)return d;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Ba(s,d,g){var w=s.pendingLanes;if(w===0)return 0;var C=0,L=s.suspendedLanes,X=s.pingedLanes;s=s.warmLanes;var he=w&134217727;return he!==0?(w=he&~L,w!==0?C=oo(w):(X&=he,X!==0?C=oo(X):g||(g=he&~s,g!==0&&(C=oo(g))))):(he=w&~L,he!==0?C=oo(he):X!==0?C=oo(X):g||(g=w&~s,g!==0&&(C=oo(g)))),C===0?0:d!==0&&d!==C&&(d&L)===0&&(L=C&-C,g=d&-d,L>=g||L===32&&(g&4194048)!==0)?d:C}function Nl(s,d){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&d)===0}function gh(s,d){switch(s){case 1:case 2:case 4:case 8:case 64:return d+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bd(){var s=zs;return zs<<=1,(zs&62914560)===0&&(zs=4194304),s}function Ul(s){for(var d=[],g=0;31>g;g++)d.push(s);return d}function nt(s,d){s.pendingLanes|=d,d!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function ll(s,d,g,w,C,L){var X=s.pendingLanes;s.pendingLanes=g,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=g,s.entangledLanes&=g,s.errorRecoveryDisabledLanes&=g,s.shellSuspendCounter=0;var he=s.entanglements,De=s.expirationTimes,ht=s.hiddenUpdates;for(g=X&~g;0<g;){var Dt=31-ba(g),Bt=1<<Dt;he[Dt]=0,De[Dt]=-1;var _t=ht[Dt];if(_t!==null)for(ht[Dt]=null,Dt=0;Dt<_t.length;Dt++){var wt=_t[Dt];wt!==null&&(wt.lane&=-536870913)}g&=~Bt}w!==0&&yu(s,w,0),L!==0&&C===0&&s.tag!==0&&(s.suspendedLanes|=L&~(X&~d))}function yu(s,d,g){s.pendingLanes|=d,s.suspendedLanes&=~d;var w=31-ba(d);s.entangledLanes|=d,s.entanglements[w]=s.entanglements[w]|1073741824|g&261930}function vu(s,d){var g=s.entangledLanes|=d;for(s=s.entanglements;g;){var w=31-ba(g),C=1<<w;C&d|s[w]&d&&(s[w]|=d),g&=~C}}function Ui(s,d){var g=d&-d;return g=(g&42)!==0?1:pa(g),(g&(s.suspendedLanes|d))!==0?0:g}function pa(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function yh(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function xu(){var s=jt.p;return s!==0?s:(s=window.event,s===void 0?32:b0(s.type))}function Te(s,d){var g=jt.p;try{return jt.p=s,d()}finally{jt.p=g}}var V=Math.random().toString(36).slice(2),G="__reactFiber$"+V,J="__reactProps$"+V,pe="__reactContainer$"+V,fe="__reactEvents$"+V,xe="__reactListeners$"+V,Pe="__reactHandles$"+V,be="__reactResources$"+V,Ce="__reactMarker$"+V;function ct(s){delete s[G],delete s[J],delete s[fe],delete s[xe],delete s[Pe]}function et(s){var d=s[G];if(d)return d;for(var g=s.parentNode;g;){if(d=g[pe]||g[G]){if(g=d.alternate,d.child!==null||g!==null&&g.child!==null)for(s=om(s);s!==null;){if(g=s[G])return g;s=om(s)}return d}s=g,g=s.parentNode}return null}function kt(s){if(s=s[G]||s[pe]){var d=s.tag;if(d===5||d===6||d===13||d===31||d===26||d===27||d===3)return s}return null}function ei(s){var d=s.tag;if(d===5||d===26||d===27||d===6)return s.stateNode;throw Error(oe(33))}function Jt(s){var d=s[be];return d||(d=s[be]={hoistableStyles:new Map,hoistableScripts:new Map}),d}function Gt(s){s[Ce]=!0}var Ei=new Set,Mi={};function rn(s,d){jn(s,d),jn(s+"Capture",d)}function jn(s,d){for(Mi[s]=d,s=0;s<d.length;s++)Ei.add(d[s])}var Pr=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),wr={},_r={};function xn(s){return gc.call(_r,s)?!0:gc.call(wr,s)?!1:Pr.test(s)?_r[s]=!0:(wr[s]=!0,!1)}function Oi(s,d,g){if(xn(d))if(g===null)s.removeAttribute(d);else{switch(typeof g){case"undefined":case"function":case"symbol":s.removeAttribute(d);return;case"boolean":var w=d.toLowerCase().slice(0,5);if(w!=="data-"&&w!=="aria-"){s.removeAttribute(d);return}}s.setAttribute(d,""+g)}}function Rn(s,d,g){if(g===null)s.removeAttribute(d);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(d);return}s.setAttribute(d,""+g)}}function An(s,d,g,w){if(w===null)s.removeAttribute(g);else{switch(typeof w){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(g);return}s.setAttributeNS(d,g,""+w)}}function qi(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Bn(s){var d=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function kr(s,d,g){var w=Object.getOwnPropertyDescriptor(s.constructor.prototype,d);if(!s.hasOwnProperty(d)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var C=w.get,L=w.set;return Object.defineProperty(s,d,{configurable:!0,get:function(){return C.call(this)},set:function(X){g=""+X,L.call(this,X)}}),Object.defineProperty(s,d,{enumerable:w.enumerable}),{getValue:function(){return g},setValue:function(X){g=""+X},stopTracking:function(){s._valueTracker=null,delete s[d]}}}}function ma(s){if(!s._valueTracker){var d=Bn(s)?"checked":"value";s._valueTracker=kr(s,d,""+s[d])}}function To(s){if(!s)return!1;var d=s._valueTracker;if(!d)return!0;var g=d.getValue(),w="";return s&&(w=Bn(s)?s.checked?"true":"false":s.value),s=w,s!==g?(d.setValue(s),!0):!1}function Rs(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Xr=/[\n"\\]/g;function Nr(s){return s.replace(Xr,function(d){return"\\"+d.charCodeAt(0).toString(16)+" "})}function wa(s,d,g,w,C,L,X,he){s.name="",X!=null&&typeof X!="function"&&typeof X!="symbol"&&typeof X!="boolean"?s.type=X:s.removeAttribute("type"),d!=null?X==="number"?(d===0&&s.value===""||s.value!=d)&&(s.value=""+qi(d)):s.value!==""+qi(d)&&(s.value=""+qi(d)):X!=="submit"&&X!=="reset"||s.removeAttribute("value"),d!=null?ka(s,X,qi(d)):g!=null?ka(s,X,qi(g)):w!=null&&s.removeAttribute("value"),C==null&&L!=null&&(s.defaultChecked=!!L),C!=null&&(s.checked=C&&typeof C!="function"&&typeof C!="symbol"),he!=null&&typeof he!="function"&&typeof he!="symbol"&&typeof he!="boolean"?s.name=""+qi(he):s.removeAttribute("name")}function No(s,d,g,w,C,L,X,he){if(L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"&&(s.type=L),d!=null||g!=null){if(!(L!=="submit"&&L!=="reset"||d!=null)){ma(s);return}g=g!=null?""+qi(g):"",d=d!=null?""+qi(d):g,he||d===s.value||(s.value=d),s.defaultValue=d}w=w??C,w=typeof w!="function"&&typeof w!="symbol"&&!!w,s.checked=he?s.checked:!!w,s.defaultChecked=!!w,X!=null&&typeof X!="function"&&typeof X!="symbol"&&typeof X!="boolean"&&(s.name=X),ma(s)}function ka(s,d,g){d==="number"&&Rs(s.ownerDocument)===s||s.defaultValue===""+g||(s.defaultValue=""+g)}function _a(s,d,g,w){if(s=s.options,d){d={};for(var C=0;C<g.length;C++)d["$"+g[C]]=!0;for(g=0;g<s.length;g++)C=d.hasOwnProperty("$"+s[g].value),s[g].selected!==C&&(s[g].selected=C),C&&w&&(s[g].defaultSelected=!0)}else{for(g=""+qi(g),d=null,C=0;C<s.length;C++){if(s[C].value===g){s[C].selected=!0,w&&(s[C].defaultSelected=!0);return}d!==null||s[C].disabled||(d=s[C])}d!==null&&(d.selected=!0)}}function vh(s,d,g){if(d!=null&&(d=""+qi(d),d!==s.value&&(s.value=d),g==null)){s.defaultValue!==d&&(s.defaultValue=d);return}s.defaultValue=g!=null?""+qi(g):""}function bu(s,d,g,w){if(d==null){if(w!=null){if(g!=null)throw Error(oe(92));if(zr(w)){if(1<w.length)throw Error(oe(93));w=w[0]}g=w}g==null&&(g=""),d=g}g=qi(d),s.defaultValue=g,w=s.textContent,w===g&&w!==""&&w!==null&&(s.value=w),ma(s)}function Ds(s,d){if(d){var g=s.firstChild;if(g&&g===s.lastChild&&g.nodeType===3){g.nodeValue=d;return}}s.textContent=d}var xh=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Na(s,d,g){var w=d.indexOf("--")===0;g==null||typeof g=="boolean"||g===""?w?s.setProperty(d,""):d==="float"?s.cssFloat="":s[d]="":w?s.setProperty(d,g):typeof g!="number"||g===0||xh.has(d)?d==="float"?s.cssFloat=g:s[d]=(""+g).trim():s[d]=g+"px"}function Uo(s,d,g){if(d!=null&&typeof d!="object")throw Error(oe(62));if(s=s.style,g!=null){for(var w in g)!g.hasOwnProperty(w)||d!=null&&d.hasOwnProperty(w)||(w.indexOf("--")===0?s.setProperty(w,""):w==="float"?s.cssFloat="":s[w]="");for(var C in d)w=d[C],d.hasOwnProperty(C)&&g[C]!==w&&Na(s,C,w)}else for(var L in d)d.hasOwnProperty(L)&&Na(s,L,d[L])}function Ta(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var So=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),cl=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ps(s){return cl.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Vo(){}var wu=null;function jo(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Eo=null,Vl=null;function Of(s){var d=kt(s);if(d&&(s=d.stateNode)){var g=s[J]||null;e:switch(s=d.stateNode,d.type){case"input":if(wa(s,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name),d=g.name,g.type==="radio"&&d!=null){for(g=s;g.parentNode;)g=g.parentNode;for(g=g.querySelectorAll('input[name="'+Nr(""+d)+'"][type="radio"]'),d=0;d<g.length;d++){var w=g[d];if(w!==s&&w.form===s.form){var C=w[J]||null;if(!C)throw Error(oe(90));wa(w,C.value,C.defaultValue,C.defaultValue,C.checked,C.defaultChecked,C.type,C.name)}}for(d=0;d<g.length;d++)w=g[d],w.form===s.form&&To(w)}break e;case"textarea":vh(s,g.value,g.defaultValue);break e;case"select":d=g.value,d!=null&&_a(s,!!g.multiple,d,!1)}}}var so=!1;function wd(s,d,g){if(so)return s(d,g);so=!0;try{var w=s(d);return w}finally{if(so=!1,(Eo!==null||Vl!==null)&&(hr(),Eo&&(d=Eo,s=Vl,Vl=Eo=null,Of(d),s)))for(d=0;d<s.length;d++)Of(s[d])}}function ss(s,d){var g=s.stateNode;if(g===null)return null;var w=g[J]||null;if(w===null)return null;g=w[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(w=!w.disabled)||(s=s.type,w=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!w;break e;default:s=!1}if(s)return null;if(g&&typeof g!="function")throw Error(oe(231,d,typeof g));return g}var Ya=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),bh=!1;if(Ya)try{var ul={};Object.defineProperty(ul,"passive",{get:function(){bh=!0}}),window.addEventListener("test",ul,ul),window.removeEventListener("test",ul,ul)}catch{bh=!1}var Ao=null,Ki=null,Tu=null;function Su(){if(Tu)return Tu;var s,d=Ki,g=d.length,w,C="value"in Ao?Ao.value:Ao.textContent,L=C.length;for(s=0;s<g&&d[s]===C[s];s++);var X=g-s;for(w=1;w<=X&&d[g-w]===C[L-w];w++);return Tu=C.slice(s,1<w?1-w:void 0)}function jl(s){var d=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&d===13&&(s=13)):s=d,s===10&&(s=13),32<=s||s===13?s:0}function Eu(){return!0}function Au(){return!1}function Sa(s){function d(g,w,C,L,X){this._reactName=g,this._targetInst=C,this.type=w,this.nativeEvent=L,this.target=X,this.currentTarget=null;for(var he in s)s.hasOwnProperty(he)&&(g=s[he],this[he]=g?g(L):L[he]);return this.isDefaultPrevented=(L.defaultPrevented!=null?L.defaultPrevented:L.returnValue===!1)?Eu:Au,this.isPropagationStopped=Au,this}return Ft(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():typeof g.returnValue!="unknown"&&(g.returnValue=!1),this.isDefaultPrevented=Eu)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():typeof g.cancelBubble!="unknown"&&(g.cancelBubble=!0),this.isPropagationStopped=Eu)},persist:function(){},isPersistent:Eu}),d}var ls={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ls=Sa(ls),Mu=Ft({},ls,{view:0,detail:0}),Td=Sa(Mu),Ff,yc,Ra,Gl=Ft({},Mu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:lo,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Ra&&(Ra&&s.type==="mousemove"?(Ff=s.screenX-Ra.screenX,yc=s.screenY-Ra.screenY):yc=Ff=0,Ra=s),Ff)},movementY:function(s){return"movementY"in s?s.movementY:yc}}),vc=Sa(Gl),wh=Ft({},Gl,{dataTransfer:0}),hl=Sa(wh),Ur=Ft({},Mu,{relatedTarget:0}),Th=Sa(Ur),Bf=Ft({},ls,{animationName:0,elapsedTime:0,pseudoElement:0}),kf=Sa(Bf),pn=Ft({},ls,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Nf=Sa(pn),j1=Ft({},ls,{data:0}),Uf=Sa(j1),ti={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dl={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Go(s){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(s):(s=dl[s])?!!d[s]:!1}function lo(){return Go}var Iu=Ft({},Mu,{key:function(s){if(s.key){var d=ti[s.key]||s.key;if(d!=="Unidentified")return d}return s.type==="keypress"?(s=jl(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Sh[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:lo,charCode:function(s){return s.type==="keypress"?jl(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?jl(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Xt=Sa(Iu),Ji=Ft({},Gl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),on=Sa(Ji),co=Ft({},Mu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:lo}),Cu=Sa(co),gn=Ft({},ls,{propertyName:0,elapsedTime:0,pseudoElement:0}),Eh=Sa(gn),xc=Ft({},Gl,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),Ah=Sa(xc),sa=Ft({},ls,{newState:0,oldState:0}),Or=Sa(sa),Gp=[9,13,27,32],bc=Ya&&"CompositionEvent"in window,wc=null;Ya&&"documentMode"in document&&(wc=document.documentMode);var Mh=Ya&&"TextEvent"in window&&!wc,Ih=Ya&&(!bc||wc&&8<wc&&11>=wc),Sd=" ",zu=!1;function $r(s,d){switch(s){case"keyup":return Gp.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Os(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var la=!1;function Ed(s,d){switch(s){case"compositionend":return Os(d);case"keypress":return d.which!==32?null:(zu=!0,Sd);case"textInput":return s=d.data,s===Sd&&zu?null:s;default:return null}}function Ru(s,d){if(la)return s==="compositionend"||!bc&&$r(s,d)?(s=Su(),Tu=Ki=Ao=null,la=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return Ih&&d.locale!=="ko"?null:d.data;default:return null}}var Wr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cs(s){var d=s&&s.nodeName&&s.nodeName.toLowerCase();return d==="input"?!!Wr[s.type]:d==="textarea"}function Fs(s,d,g,w){Eo?Vl?Vl.push(w):Vl=[w]:Eo=w,d=hp(d,"onChange"),0<d.length&&(g=new Ls("onChange","change",null,g,w),s.push({event:g,listeners:d}))}var lr=null,xi=null;function Ut(s){Jp(s,0)}function Bs(s){var d=ei(s);if(To(d))return s}function li(s,d){if(s==="change")return d}var Tc=!1;if(Ya){var Du;if(Ya){var ii="oninput"in document;if(!ii){var Pu=document.createElement("div");Pu.setAttribute("oninput","return;"),ii=typeof Pu.oninput=="function"}Du=ii}else Du=!1;Tc=Du&&(!document.documentMode||9<document.documentMode)}function Ch(){lr&&(lr.detachEvent("onpropertychange",Vf),xi=lr=null)}function Vf(s){if(s.propertyName==="value"&&Bs(xi)){var d=[];Fs(d,xi,s,jo(s)),wd(Ut,d)}}function ks(s,d,g){s==="focusin"?(Ch(),lr=d,xi=g,lr.attachEvent("onpropertychange",Vf)):s==="focusout"&&Ch()}function Ad(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Bs(xi)}function ca(s,d){if(s==="click")return Bs(d)}function Da(s,d){if(s==="input"||s==="change")return Bs(d)}function Sc(s,d){return s===d&&(s!==0||1/s===1/d)||s!==s&&d!==d}var Ea=typeof Object.is=="function"?Object.is:Sc;function Mo(s,d){if(Ea(s,d))return!0;if(typeof s!="object"||s===null||typeof d!="object"||d===null)return!1;var g=Object.keys(s),w=Object.keys(d);if(g.length!==w.length)return!1;for(w=0;w<g.length;w++){var C=g[w];if(!gc.call(d,C)||!Ea(s[C],d[C]))return!1}return!0}function ia(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function G1(s,d){var g=ia(s);s=0;for(var w;g;){if(g.nodeType===3){if(w=s+g.textContent.length,s<=d&&w>=d)return{node:g,offset:d-s};s=w}e:{for(;g;){if(g.nextSibling){g=g.nextSibling;break e}g=g.parentNode}g=void 0}g=ia(g)}}function H1(s,d){return s&&d?s===d?!0:s&&s.nodeType===3?!1:d&&d.nodeType===3?H1(s,d.parentNode):"contains"in s?s.contains(d):s.compareDocumentPosition?!!(s.compareDocumentPosition(d)&16):!1:!1}function Lu(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var d=Rs(s.document);d instanceof s.HTMLIFrameElement;){try{var g=typeof d.contentWindow.location.href=="string"}catch{g=!1}if(g)s=d.contentWindow;else break;d=Rs(s.document)}return d}function Ns(s){var d=s&&s.nodeName&&s.nodeName.toLowerCase();return d&&(d==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||d==="textarea"||s.contentEditable==="true")}var q1=Ya&&"documentMode"in document&&11>=document.documentMode,Pa=null,Md=null,Hl=null,Ec=!1;function fl(s,d,g){var w=g.window===g?g.document:g.nodeType===9?g:g.ownerDocument;Ec||Pa==null||Pa!==Rs(w)||(w=Pa,"selectionStart"in w&&Ns(w)?w={start:w.selectionStart,end:w.selectionEnd}:(w=(w.ownerDocument&&w.ownerDocument.defaultView||window).getSelection(),w={anchorNode:w.anchorNode,anchorOffset:w.anchorOffset,focusNode:w.focusNode,focusOffset:w.focusOffset}),Hl&&Mo(Hl,w)||(Hl=w,w=hp(Md,"onSelect"),0<w.length&&(d=new Ls("onSelect","select",null,d,g),s.push({event:d,listeners:w}),d.target=Pa)))}function Ac(s,d){var g={};return g[s.toLowerCase()]=d.toLowerCase(),g["Webkit"+s]="webkit"+d,g["Moz"+s]="moz"+d,g}var Mc={animationend:Ac("Animation","AnimationEnd"),animationiteration:Ac("Animation","AnimationIteration"),animationstart:Ac("Animation","AnimationStart"),transitionrun:Ac("Transition","TransitionRun"),transitionstart:Ac("Transition","TransitionStart"),transitioncancel:Ac("Transition","TransitionCancel"),transitionend:Ac("Transition","TransitionEnd")},jf={},pl={};Ya&&(pl=document.createElement("div").style,"AnimationEvent"in window||(delete Mc.animationend.animation,delete Mc.animationiteration.animation,delete Mc.animationstart.animation),"TransitionEvent"in window||delete Mc.transitionend.transition);function Ic(s){if(jf[s])return jf[s];if(!Mc[s])return s;var d=Mc[s],g;for(g in d)if(d.hasOwnProperty(g)&&g in pl)return jf[s]=d[g];return s}var Id=Ic("animationend"),zh=Ic("animationiteration"),Cd=Ic("animationstart"),Gf=Ic("transitionrun"),Ho=Ic("transitionstart"),Cc=Ic("transitioncancel"),Ou=Ic("transitionend"),zd=new Map,Rh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Rh.push("scrollEnd");function Ua(s,d){zd.set(s,d),rn(d,[s])}var ml=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var d=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(d))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},uo=[],_l=0,Ka=0;function zc(){for(var s=_l,d=Ka=_l=0;d<s;){var g=uo[d];uo[d++]=null;var w=uo[d];uo[d++]=null;var C=uo[d];uo[d++]=null;var L=uo[d];if(uo[d++]=null,w!==null&&C!==null){var X=w.pending;X===null?C.next=C:(C.next=X.next,X.next=C),w.pending=C}L!==0&&Rc(g,C,L)}}function pt(s,d,g,w){uo[_l++]=s,uo[_l++]=d,uo[_l++]=g,uo[_l++]=w,Ka|=w,s.lanes|=w,s=s.alternate,s!==null&&(s.lanes|=w)}function Dh(s,d,g,w){return pt(s,d,g,w),ql(s)}function qo(s,d){return pt(s,null,null,d),ql(s)}function Rc(s,d,g){s.lanes|=g;var w=s.alternate;w!==null&&(w.lanes|=g);for(var C=!1,L=s.return;L!==null;)L.childLanes|=g,w=L.alternate,w!==null&&(w.childLanes|=g),L.tag===22&&(s=L.stateNode,s===null||s._visibility&1||(C=!0)),s=L,L=L.return;return s.tag===3?(L=s.stateNode,C&&d!==null&&(C=31-ba(g),s=L.hiddenUpdates,w=s[C],w===null?s[C]=[d]:w.push(d),d.lane=g|536870912),L):null}function ql(s){if(50<da)throw da=0,ra=null,Error(oe(185));for(var d=s.return;d!==null;)s=d,d=s.return;return s.tag===3?s.stateNode:null}var Us={};function Vs(s,d,g,w){this.tag=s,this.key=g,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=w,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Va(s,d,g,w){return new Vs(s,d,g,w)}function ho(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Ai(s,d){var g=s.alternate;return g===null?(g=Va(s.tag,d,s.key,s.mode),g.elementType=s.elementType,g.type=s.type,g.stateNode=s.stateNode,g.alternate=s,s.alternate=g):(g.pendingProps=d,g.type=s.type,g.flags=0,g.subtreeFlags=0,g.deletions=null),g.flags=s.flags&65011712,g.childLanes=s.childLanes,g.lanes=s.lanes,g.child=s.child,g.memoizedProps=s.memoizedProps,g.memoizedState=s.memoizedState,g.updateQueue=s.updateQueue,d=s.dependencies,g.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},g.sibling=s.sibling,g.index=s.index,g.ref=s.ref,g.refCleanup=s.refCleanup,g}function Dc(s,d){s.flags&=65011714;var g=s.alternate;return g===null?(s.childLanes=0,s.lanes=d,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=g.childLanes,s.lanes=g.lanes,s.child=g.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=g.memoizedProps,s.memoizedState=g.memoizedState,s.updateQueue=g.updateQueue,s.type=g.type,d=g.dependencies,s.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),s}function Rd(s,d,g,w,C,L){var X=0;if(w=s,typeof s=="function")ho(s)&&(X=1);else if(typeof s=="string")X=g_(s,g,gi.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case Oa:return s=Va(31,g,d,C),s.elementType=Oa,s.lanes=L,s;case hi:return Pc(g.children,C,L,d);case $i:X=8,C|=24;break;case vn:return s=Va(12,g,d,C|2),s.elementType=vn,s.lanes=L,s;case _n:return s=Va(13,g,d,C),s.elementType=_n,s.lanes=L,s;case mr:return s=Va(19,g,d,C),s.elementType=mr,s.lanes=L,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case ki:X=10;break e;case Ci:X=9;break e;case si:X=11;break e;case ln:X=14;break e;case ea:X=16,w=null;break e}X=29,g=Error(oe(130,s===null?"null":typeof s,"")),w=null}return d=Va(X,g,d,C),d.elementType=s,d.type=w,d.lanes=L,d}function Pc(s,d,g,w){return s=Va(7,s,w,d),s.lanes=g,s}function Fu(s,d,g){return s=Va(6,s,null,d),s.lanes=g,s}function Z1(s){var d=Va(18,null,null,0);return d.stateNode=s,d}function Xn(s,d,g){return d=Va(4,s.children!==null?s.children:[],s.key,d),d.lanes=g,d.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},d}var Hf=new WeakMap;function fo(s,d){if(typeof s=="object"&&s!==null){var g=Hf.get(s);return g!==void 0?g:(d={value:s,source:d,stack:Sr(d)},Hf.set(s,d),d)}return{value:s,source:d,stack:Sr(d)}}var Bu=[],ku=0,Dd=null,Ph=0,Io=[],Zo=0,us=null,js=1,hs="";function ds(s,d){Bu[ku++]=Ph,Bu[ku++]=Dd,Dd=s,Ph=d}function Lh(s,d,g){Io[Zo++]=js,Io[Zo++]=hs,Io[Zo++]=us,us=s;var w=js;s=hs;var C=32-ba(w)-1;w&=~(1<<C),g+=1;var L=32-ba(d)+C;if(30<L){var X=C-C%5;L=(w&(1<<X)-1).toString(32),w>>=X,C-=X,js=1<<32-ba(d)+C|g<<C|w,hs=L+s}else js=1<<L|g<<C|w,hs=s}function Oh(s){s.return!==null&&(ds(s,1),Lh(s,1,0))}function gl(s){for(;s===Dd;)Dd=Bu[--ku],Bu[ku]=null,Ph=Bu[--ku],Bu[ku]=null;for(;s===us;)us=Io[--Zo],Io[Zo]=null,hs=Io[--Zo],Io[Zo]=null,js=Io[--Zo],Io[Zo]=null}function Lc(s,d){Io[Zo++]=js,Io[Zo++]=hs,Io[Zo++]=us,js=d.id,hs=d.overflow,us=s}var na=null,gr=null,Gn=!1,Gs=null,Co=!1,Zl=Error(oe(519));function fs(s){var d=Error(oe(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Nu(fo(d,s)),Zl}function Fh(s){var d=s.stateNode,g=s.type,w=s.memoizedProps;switch(d[G]=s,d[J]=w,g){case"dialog":qn("cancel",d),qn("close",d);break;case"iframe":case"object":case"embed":qn("load",d);break;case"video":case"audio":for(g=0;g<ff.length;g++)qn(ff[g],d);break;case"source":qn("error",d);break;case"img":case"image":case"link":qn("error",d),qn("load",d);break;case"details":qn("toggle",d);break;case"input":qn("invalid",d),No(d,w.value,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name,!0);break;case"select":qn("invalid",d);break;case"textarea":qn("invalid",d),bu(d,w.value,w.defaultValue,w.children)}g=w.children,typeof g!="string"&&typeof g!="number"&&typeof g!="bigint"||d.textContent===""+g||w.suppressHydrationWarning===!0||mf(d.textContent,g)?(w.popover!=null&&(qn("beforetoggle",d),qn("toggle",d)),w.onScroll!=null&&qn("scroll",d),w.onScrollEnd!=null&&qn("scrollend",d),w.onClick!=null&&(d.onclick=Vo),d=!0):d=!1,d||fs(s,!0)}function Pd(s){for(na=s.return;na;)switch(na.tag){case 5:case 31:case 13:Co=!1;return;case 27:case 3:Co=!0;return;default:na=na.return}}function yl(s){if(s!==na)return!1;if(!Gn)return Pd(s),Gn=!0,!1;var d=s.tag,g;if((g=d!==3&&d!==27)&&((g=d===5)&&(g=s.type,g=!(g!=="form"&&g!=="button")||nm(s.type,s.memoizedProps)),g=!g),g&&gr&&fs(s),Pd(s),d===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(oe(317));gr=am(s)}else if(d===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(oe(317));gr=am(s)}else d===27?(d=gr,au(s.type)?(s=io,io=null,gr=s):gr=d):gr=na?rl(s.stateNode.nextSibling):null;return!0}function ps(){gr=na=null,Gn=!1}function Ld(){var s=Gs;return s!==null&&(Zi===null?Zi=s:Zi.push.apply(Zi,s),Gs=null),s}function Nu(s){Gs===null?Gs=[s]:Gs.push(s)}var Od=Ue(null),Xo=null,$o=null;function Xl(s,d,g){qt(Od,d._currentValue),d._currentValue=g}function Hs(s){s._currentValue=Od.current,Pt(Od)}function qf(s,d,g){for(;s!==null;){var w=s.alternate;if((s.childLanes&d)!==d?(s.childLanes|=d,w!==null&&(w.childLanes|=d)):w!==null&&(w.childLanes&d)!==d&&(w.childLanes|=d),s===g)break;s=s.return}}function Bh(s,d,g,w){var C=s.child;for(C!==null&&(C.return=s);C!==null;){var L=C.dependencies;if(L!==null){var X=C.child;L=L.firstContext;e:for(;L!==null;){var he=L;L=C;for(var De=0;De<d.length;De++)if(he.context===d[De]){L.lanes|=g,he=L.alternate,he!==null&&(he.lanes|=g),qf(L.return,g,s),w||(X=null);break e}L=he.next}}else if(C.tag===18){if(X=C.return,X===null)throw Error(oe(341));X.lanes|=g,L=X.alternate,L!==null&&(L.lanes|=g),qf(X,g,s),X=null}else X=C.child;if(X!==null)X.return=C;else for(X=C;X!==null;){if(X===s){X=null;break}if(C=X.sibling,C!==null){C.return=X.return,X=C;break}X=X.return}C=X}}function $l(s,d,g,w){s=null;for(var C=d,L=!1;C!==null;){if(!L){if((C.flags&524288)!==0)L=!0;else if((C.flags&262144)!==0)break}if(C.tag===10){var X=C.alternate;if(X===null)throw Error(oe(387));if(X=X.memoizedProps,X!==null){var he=C.type;Ea(C.pendingProps.value,X.value)||(s!==null?s.push(he):s=[he])}}else if(C===Kn.current){if(X=C.alternate,X===null)throw Error(oe(387));X.memoizedState.memoizedState!==C.memoizedState.memoizedState&&(s!==null?s.push(M1):s=[M1])}C=C.return}s!==null&&Bh(d,s,g,w),d.flags|=262144}function Oc(s){for(s=s.firstContext;s!==null;){if(!Ea(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function qs(s){Xo=s,$o=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Vr(s){return Zf(Xo,s)}function Uu(s,d){return Xo===null&&qs(s),Zf(s,d)}function Zf(s,d){var g=d._currentValue;if(d={context:d,memoizedValue:g,next:null},$o===null){if(s===null)throw Error(oe(308));$o=d,s.dependencies={lanes:0,firstContext:d},s.flags|=524288}else $o=$o.next=d;return g}var kh=typeof AbortController<"u"?AbortController:function(){var s=[],d=this.signal={aborted:!1,addEventListener:function(g,w){s.push(w)}};this.abort=function(){d.aborted=!0,s.forEach(function(g){return g()})}},Fc=ae.unstable_scheduleCallback,Fd=ae.unstable_NormalPriority,cr={$$typeof:ki,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Nh(){return{controller:new kh,data:new Map,refCount:0}}function vl(s){s.refCount--,s.refCount===0&&Fc(Fd,function(){s.controller.abort()})}var xl=null,Uh=0,Wl=0,Yl=null;function Vh(s,d){if(xl===null){var g=xl=[];Uh=0,Wl=cp(),Yl={status:"pending",value:void 0,then:function(w){g.push(w)}}}return Uh++,d.then(jh,jh),d}function jh(){if(--Uh===0&&xl!==null){Yl!==null&&(Yl.status="fulfilled");var s=xl;xl=null,Wl=0,Yl=null;for(var d=0;d<s.length;d++)(0,s[d])()}}function Vu(s,d){var g=[],w={status:"pending",value:null,reason:null,then:function(C){g.push(C)}};return s.then(function(){w.status="fulfilled",w.value=d;for(var C=0;C<g.length;C++)(0,g[C])(d)},function(C){for(w.status="rejected",w.reason=C,C=0;C<g.length;C++)(0,g[C])(void 0)}),w}var Gh=yt.S;yt.S=function(s,d){an=Er(),typeof d=="object"&&d!==null&&typeof d.then=="function"&&Vh(s,d),Gh!==null&&Gh(s,d)};var Zs=Ue(null);function Bd(){var s=Zs.current;return s!==null?s:vt.pooledCache}function Hh(s,d){d===null?qt(Zs,Zs.current):qt(Zs,d.pool)}function Bc(){var s=Bd();return s===null?null:{parent:cr._currentValue,pool:s}}var kc=Error(oe(460)),kd=Error(oe(474)),Nd=Error(oe(542)),Ud={then:function(){}};function X1(s){return s=s.status,s==="fulfilled"||s==="rejected"}function qh(s,d,g){switch(g=s[g],g===void 0?s.push(d):g!==d&&(d.then(Vo,Vo),d=g),d.status){case"fulfilled":return d.value;case"rejected":throw s=d.reason,Nc(s),s;default:if(typeof d.status=="string")d.then(Vo,Vo);else{if(s=vt,s!==null&&100<s.shellSuspendCounter)throw Error(oe(482));s=d,s.status="pending",s.then(function(w){if(d.status==="pending"){var C=d;C.status="fulfilled",C.value=w}},function(w){if(d.status==="pending"){var C=d;C.status="rejected",C.reason=w}})}switch(d.status){case"fulfilled":return d.value;case"rejected":throw s=d.reason,Nc(s),s}throw wl=d,kc}}function bl(s){try{var d=s._init;return d(s._payload)}catch(g){throw g!==null&&typeof g=="object"&&typeof g.then=="function"?(wl=g,kc):g}}var wl=null;function Xf(){if(wl===null)throw Error(oe(459));var s=wl;return wl=null,s}function Nc(s){if(s===kc||s===Nd)throw Error(oe(483))}var Kl=null,ju=0;function Zh(s){var d=ju;return ju+=1,Kl===null&&(Kl=[]),qh(Kl,s,d)}function Jl(s,d){d=d.props.ref,s.ref=d!==void 0?d:null}function Wo(s,d){throw d.$$typeof===Pi?Error(oe(525)):(s=Object.prototype.toString.call(d),Error(oe(31,s==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":s)))}function Gu(s){function d(Qe,Ne){if(s){var dt=Qe.deletions;dt===null?(Qe.deletions=[Ne],Qe.flags|=16):dt.push(Ne)}}function g(Qe,Ne){if(!s)return null;for(;Ne!==null;)d(Qe,Ne),Ne=Ne.sibling;return null}function w(Qe){for(var Ne=new Map;Qe!==null;)Qe.key!==null?Ne.set(Qe.key,Qe):Ne.set(Qe.index,Qe),Qe=Qe.sibling;return Ne}function C(Qe,Ne){return Qe=Ai(Qe,Ne),Qe.index=0,Qe.sibling=null,Qe}function L(Qe,Ne,dt){return Qe.index=dt,s?(dt=Qe.alternate,dt!==null?(dt=dt.index,dt<Ne?(Qe.flags|=67108866,Ne):dt):(Qe.flags|=67108866,Ne)):(Qe.flags|=1048576,Ne)}function X(Qe){return s&&Qe.alternate===null&&(Qe.flags|=67108866),Qe}function he(Qe,Ne,dt,Ot){return Ne===null||Ne.tag!==6?(Ne=Fu(dt,Qe.mode,Ot),Ne.return=Qe,Ne):(Ne=C(Ne,dt),Ne.return=Qe,Ne)}function De(Qe,Ne,dt,Ot){var Gi=dt.type;return Gi===hi?Dt(Qe,Ne,dt.props.children,Ot,dt.key):Ne!==null&&(Ne.elementType===Gi||typeof Gi=="object"&&Gi!==null&&Gi.$$typeof===ea&&bl(Gi)===Ne.type)?(Ne=C(Ne,dt.props),Jl(Ne,dt),Ne.return=Qe,Ne):(Ne=Rd(dt.type,dt.key,dt.props,null,Qe.mode,Ot),Jl(Ne,dt),Ne.return=Qe,Ne)}function ht(Qe,Ne,dt,Ot){return Ne===null||Ne.tag!==4||Ne.stateNode.containerInfo!==dt.containerInfo||Ne.stateNode.implementation!==dt.implementation?(Ne=Xn(dt,Qe.mode,Ot),Ne.return=Qe,Ne):(Ne=C(Ne,dt.children||[]),Ne.return=Qe,Ne)}function Dt(Qe,Ne,dt,Ot,Gi){return Ne===null||Ne.tag!==7?(Ne=Pc(dt,Qe.mode,Ot,Gi),Ne.return=Qe,Ne):(Ne=C(Ne,dt),Ne.return=Qe,Ne)}function Bt(Qe,Ne,dt){if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number"||typeof Ne=="bigint")return Ne=Fu(""+Ne,Qe.mode,dt),Ne.return=Qe,Ne;if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case Hi:return dt=Rd(Ne.type,Ne.key,Ne.props,null,Qe.mode,dt),Jl(dt,Ne),dt.return=Qe,dt;case yn:return Ne=Xn(Ne,Qe.mode,dt),Ne.return=Qe,Ne;case ea:return Ne=bl(Ne),Bt(Qe,Ne,dt)}if(zr(Ne)||xa(Ne))return Ne=Pc(Ne,Qe.mode,dt,null),Ne.return=Qe,Ne;if(typeof Ne.then=="function")return Bt(Qe,Zh(Ne),dt);if(Ne.$$typeof===ki)return Bt(Qe,Uu(Qe,Ne),dt);Wo(Qe,Ne)}return null}function _t(Qe,Ne,dt,Ot){var Gi=Ne!==null?Ne.key:null;if(typeof dt=="string"&&dt!==""||typeof dt=="number"||typeof dt=="bigint")return Gi!==null?null:he(Qe,Ne,""+dt,Ot);if(typeof dt=="object"&&dt!==null){switch(dt.$$typeof){case Hi:return dt.key===Gi?De(Qe,Ne,dt,Ot):null;case yn:return dt.key===Gi?ht(Qe,Ne,dt,Ot):null;case ea:return dt=bl(dt),_t(Qe,Ne,dt,Ot)}if(zr(dt)||xa(dt))return Gi!==null?null:Dt(Qe,Ne,dt,Ot,null);if(typeof dt.then=="function")return _t(Qe,Ne,Zh(dt),Ot);if(dt.$$typeof===ki)return _t(Qe,Ne,Uu(Qe,dt),Ot);Wo(Qe,dt)}return null}function wt(Qe,Ne,dt,Ot,Gi){if(typeof Ot=="string"&&Ot!==""||typeof Ot=="number"||typeof Ot=="bigint")return Qe=Qe.get(dt)||null,he(Ne,Qe,""+Ot,Gi);if(typeof Ot=="object"&&Ot!==null){switch(Ot.$$typeof){case Hi:return Qe=Qe.get(Ot.key===null?dt:Ot.key)||null,De(Ne,Qe,Ot,Gi);case yn:return Qe=Qe.get(Ot.key===null?dt:Ot.key)||null,ht(Ne,Qe,Ot,Gi);case ea:return Ot=bl(Ot),wt(Qe,Ne,dt,Ot,Gi)}if(zr(Ot)||xa(Ot))return Qe=Qe.get(dt)||null,Dt(Ne,Qe,Ot,Gi,null);if(typeof Ot.then=="function")return wt(Qe,Ne,dt,Zh(Ot),Gi);if(Ot.$$typeof===ki)return wt(Qe,Ne,dt,Uu(Ne,Ot),Gi);Wo(Ne,Ot)}return null}function mi(Qe,Ne,dt,Ot){for(var Gi=null,pr=null,Di=Ne,Tn=Ne=0,Qn=null;Di!==null&&Tn<dt.length;Tn++){Di.index>Tn?(Qn=Di,Di=null):Qn=Di.sibling;var er=_t(Qe,Di,dt[Tn],Ot);if(er===null){Di===null&&(Di=Qn);break}s&&Di&&er.alternate===null&&d(Qe,Di),Ne=L(er,Ne,Tn),pr===null?Gi=er:pr.sibling=er,pr=er,Di=Qn}if(Tn===dt.length)return g(Qe,Di),Gn&&ds(Qe,Tn),Gi;if(Di===null){for(;Tn<dt.length;Tn++)Di=Bt(Qe,dt[Tn],Ot),Di!==null&&(Ne=L(Di,Ne,Tn),pr===null?Gi=Di:pr.sibling=Di,pr=Di);return Gn&&ds(Qe,Tn),Gi}for(Di=w(Di);Tn<dt.length;Tn++)Qn=wt(Di,Qe,Tn,dt[Tn],Ot),Qn!==null&&(s&&Qn.alternate!==null&&Di.delete(Qn.key===null?Tn:Qn.key),Ne=L(Qn,Ne,Tn),pr===null?Gi=Qn:pr.sibling=Qn,pr=Qn);return s&&Di.forEach(function(du){return d(Qe,du)}),Gn&&ds(Qe,Tn),Gi}function ji(Qe,Ne,dt,Ot){if(dt==null)throw Error(oe(151));for(var Gi=null,pr=null,Di=Ne,Tn=Ne=0,Qn=null,er=dt.next();Di!==null&&!er.done;Tn++,er=dt.next()){Di.index>Tn?(Qn=Di,Di=null):Qn=Di.sibling;var du=_t(Qe,Di,er.value,Ot);if(du===null){Di===null&&(Di=Qn);break}s&&Di&&du.alternate===null&&d(Qe,Di),Ne=L(du,Ne,Tn),pr===null?Gi=du:pr.sibling=du,pr=du,Di=Qn}if(er.done)return g(Qe,Di),Gn&&ds(Qe,Tn),Gi;if(Di===null){for(;!er.done;Tn++,er=dt.next())er=Bt(Qe,er.value,Ot),er!==null&&(Ne=L(er,Ne,Tn),pr===null?Gi=er:pr.sibling=er,pr=er);return Gn&&ds(Qe,Tn),Gi}for(Di=w(Di);!er.done;Tn++,er=dt.next())er=wt(Di,Qe,Tn,er.value,Ot),er!==null&&(s&&er.alternate!==null&&Di.delete(er.key===null?Tn:er.key),Ne=L(er,Ne,Tn),pr===null?Gi=er:pr.sibling=er,pr=er);return s&&Di.forEach(function(bm){return d(Qe,bm)}),Gn&&ds(Qe,Tn),Gi}function Ir(Qe,Ne,dt,Ot){if(typeof dt=="object"&&dt!==null&&dt.type===hi&&dt.key===null&&(dt=dt.props.children),typeof dt=="object"&&dt!==null){switch(dt.$$typeof){case Hi:e:{for(var Gi=dt.key;Ne!==null;){if(Ne.key===Gi){if(Gi=dt.type,Gi===hi){if(Ne.tag===7){g(Qe,Ne.sibling),Ot=C(Ne,dt.props.children),Ot.return=Qe,Qe=Ot;break e}}else if(Ne.elementType===Gi||typeof Gi=="object"&&Gi!==null&&Gi.$$typeof===ea&&bl(Gi)===Ne.type){g(Qe,Ne.sibling),Ot=C(Ne,dt.props),Jl(Ot,dt),Ot.return=Qe,Qe=Ot;break e}g(Qe,Ne);break}else d(Qe,Ne);Ne=Ne.sibling}dt.type===hi?(Ot=Pc(dt.props.children,Qe.mode,Ot,dt.key),Ot.return=Qe,Qe=Ot):(Ot=Rd(dt.type,dt.key,dt.props,null,Qe.mode,Ot),Jl(Ot,dt),Ot.return=Qe,Qe=Ot)}return X(Qe);case yn:e:{for(Gi=dt.key;Ne!==null;){if(Ne.key===Gi)if(Ne.tag===4&&Ne.stateNode.containerInfo===dt.containerInfo&&Ne.stateNode.implementation===dt.implementation){g(Qe,Ne.sibling),Ot=C(Ne,dt.children||[]),Ot.return=Qe,Qe=Ot;break e}else{g(Qe,Ne);break}else d(Qe,Ne);Ne=Ne.sibling}Ot=Xn(dt,Qe.mode,Ot),Ot.return=Qe,Qe=Ot}return X(Qe);case ea:return dt=bl(dt),Ir(Qe,Ne,dt,Ot)}if(zr(dt))return mi(Qe,Ne,dt,Ot);if(xa(dt)){if(Gi=xa(dt),typeof Gi!="function")throw Error(oe(150));return dt=Gi.call(dt),ji(Qe,Ne,dt,Ot)}if(typeof dt.then=="function")return Ir(Qe,Ne,Zh(dt),Ot);if(dt.$$typeof===ki)return Ir(Qe,Ne,Uu(Qe,dt),Ot);Wo(Qe,dt)}return typeof dt=="string"&&dt!==""||typeof dt=="number"||typeof dt=="bigint"?(dt=""+dt,Ne!==null&&Ne.tag===6?(g(Qe,Ne.sibling),Ot=C(Ne,dt),Ot.return=Qe,Qe=Ot):(g(Qe,Ne),Ot=Fu(dt,Qe.mode,Ot),Ot.return=Qe,Qe=Ot),X(Qe)):g(Qe,Ne)}return function(Qe,Ne,dt,Ot){try{ju=0;var Gi=Ir(Qe,Ne,dt,Ot);return Kl=null,Gi}catch(Di){if(Di===kc||Di===Nd)throw Di;var pr=Va(29,Di,null,Qe.mode);return pr.lanes=Ot,pr.return=Qe,pr}finally{}}}var Xs=Gu(!0),Ql=Gu(!1),Ja=!1;function Xh(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Hu(s,d){s=s.updateQueue,d.updateQueue===s&&(d.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function $s(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Ws(s,d,g){var w=s.updateQueue;if(w===null)return null;if(w=w.shared,(Je&2)!==0){var C=w.pending;return C===null?d.next=d:(d.next=C.next,C.next=d),w.pending=d,d=ql(s),Rc(s,null,g),d}return pt(s,w,d,g),ql(s)}function ec(s,d,g){if(d=d.updateQueue,d!==null&&(d=d.shared,(g&4194048)!==0)){var w=d.lanes;w&=s.pendingLanes,g|=w,d.lanes=g,vu(s,g)}}function qu(s,d){var g=s.updateQueue,w=s.alternate;if(w!==null&&(w=w.updateQueue,g===w)){var C=null,L=null;if(g=g.firstBaseUpdate,g!==null){do{var X={lane:g.lane,tag:g.tag,payload:g.payload,callback:null,next:null};L===null?C=L=X:L=L.next=X,g=g.next}while(g!==null);L===null?C=L=d:L=L.next=d}else C=L=d;g={baseState:w.baseState,firstBaseUpdate:C,lastBaseUpdate:L,shared:w.shared,callbacks:w.callbacks},s.updateQueue=g;return}s=g.lastBaseUpdate,s===null?g.firstBaseUpdate=d:s.next=d,g.lastBaseUpdate=d}var $h=!1;function tc(){if($h){var s=Yl;if(s!==null)throw s}}function Ys(s,d,g,w){$h=!1;var C=s.updateQueue;Ja=!1;var L=C.firstBaseUpdate,X=C.lastBaseUpdate,he=C.shared.pending;if(he!==null){C.shared.pending=null;var De=he,ht=De.next;De.next=null,X===null?L=ht:X.next=ht,X=De;var Dt=s.alternate;Dt!==null&&(Dt=Dt.updateQueue,he=Dt.lastBaseUpdate,he!==X&&(he===null?Dt.firstBaseUpdate=ht:he.next=ht,Dt.lastBaseUpdate=De))}if(L!==null){var Bt=C.baseState;X=0,Dt=ht=De=null,he=L;do{var _t=he.lane&-536870913,wt=_t!==he.lane;if(wt?($e&_t)===_t:(w&_t)===_t){_t!==0&&_t===Wl&&($h=!0),Dt!==null&&(Dt=Dt.next={lane:0,tag:he.tag,payload:he.payload,callback:null,next:null});e:{var mi=s,ji=he;_t=d;var Ir=g;switch(ji.tag){case 1:if(mi=ji.payload,typeof mi=="function"){Bt=mi.call(Ir,Bt,_t);break e}Bt=mi;break e;case 3:mi.flags=mi.flags&-65537|128;case 0:if(mi=ji.payload,_t=typeof mi=="function"?mi.call(Ir,Bt,_t):mi,_t==null)break e;Bt=Ft({},Bt,_t);break e;case 2:Ja=!0}}_t=he.callback,_t!==null&&(s.flags|=64,wt&&(s.flags|=8192),wt=C.callbacks,wt===null?C.callbacks=[_t]:wt.push(_t))}else wt={lane:_t,tag:he.tag,payload:he.payload,callback:he.callback,next:null},Dt===null?(ht=Dt=wt,De=Bt):Dt=Dt.next=wt,X|=_t;if(he=he.next,he===null){if(he=C.shared.pending,he===null)break;wt=he,he=wt.next,wt.next=null,C.lastBaseUpdate=wt,C.shared.pending=null}}while(!0);Dt===null&&(De=Bt),C.baseState=De,C.firstBaseUpdate=ht,C.lastBaseUpdate=Dt,L===null&&(C.shared.lanes=0),Qi|=X,s.lanes=X,s.memoizedState=Bt}}function $1(s,d){if(typeof s!="function")throw Error(oe(191,s));s.call(d)}function Tl(s,d){var g=s.callbacks;if(g!==null)for(s.callbacks=null,s=0;s<g.length;s++)$1(g[s],d)}var Uc=Ue(null),Vd=Ue(0);function Wh(s,d){s=Ti,qt(Vd,s),qt(Uc,d),Ti=s|d.baseLanes}function Zu(){qt(Vd,Ti),qt(Uc,Uc.current)}function Yo(){Ti=Vd.current,Pt(Uc),Pt(Vd)}var La=Ue(null),ga=null;function Ks(s){var d=s.alternate;qt(Yr,Yr.current&1),qt(La,s),ga===null&&(d===null||Uc.current!==null||d.memoizedState!==null)&&(ga=s)}function Xu(s){qt(Yr,Yr.current),qt(La,s),ga===null&&(ga=s)}function Yh(s){s.tag===22?(qt(Yr,Yr.current),qt(La,s),ga===null&&(ga=s)):Ko()}function Ko(){qt(Yr,Yr.current),qt(La,La.current)}function ja(s){Pt(La),ga===s&&(ga=null),Pt(Yr)}var Yr=Ue(0);function Js(s){for(var d=s;d!==null;){if(d.tag===13){var g=d.memoizedState;if(g!==null&&(g=g.dehydrated,g===null||w1(g)||_p(g)))return d}else if(d.tag===19&&(d.memoizedProps.revealOrder==="forwards"||d.memoizedProps.revealOrder==="backwards"||d.memoizedProps.revealOrder==="unstable_legacy-backwards"||d.memoizedProps.revealOrder==="together")){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===s)break;for(;d.sibling===null;){if(d.return===null||d.return===s)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var po=0,st=null,yr=null,Ar=null,ms=!1,zo=!1,Wt=!1,$u=0,Wu=0,Sl=null,jd=0;function Fr(){throw Error(oe(321))}function Kh(s,d){if(d===null)return!1;for(var g=0;g<d.length&&g<s.length;g++)if(!Ea(s[g],d[g]))return!1;return!0}function Gd(s,d,g,w,C,L){return po=L,st=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,yt.H=s===null||s.memoizedState===null?Po:ad,Wt=!1,L=g(w,C),Wt=!1,zo&&(L=Y1(d,g,w,C)),W1(s),L}function W1(s){yt.H=Kc;var d=yr!==null&&yr.next!==null;if(po=0,Ar=yr=st=null,ms=!1,Wu=0,Sl=null,d)throw Error(oe(300));s===null||Kr||(s=s.dependencies,s!==null&&Oc(s)&&(Kr=!0))}function Y1(s,d,g,w){st=s;var C=0;do{if(zo&&(Sl=null),Wu=0,zo=!1,25<=C)throw Error(oe(301));if(C+=1,Ar=yr=null,s.updateQueue!=null){var L=s.updateQueue;L.lastEffect=null,L.events=null,L.stores=null,L.memoCache!=null&&(L.memoCache.index=0)}yt.H=od,L=d(g,w)}while(zo);return L}function mo(){var s=yt.H,d=s.useState()[0];return d=typeof d.then=="function"?Vc(d):d,s=s.useState()[0],(yr!==null?yr.memoizedState:null)!==s&&(st.flags|=1024),d}function Jh(){var s=$u!==0;return $u=0,s}function Aa(s,d,g){d.updateQueue=s.updateQueue,d.flags&=-2053,s.lanes&=~g}function Qs(s){if(ms){for(s=s.memoizedState;s!==null;){var d=s.queue;d!==null&&(d.pending=null),s=s.next}ms=!1}po=0,Ar=yr=st=null,zo=!1,Wu=$u=0,Sl=null}function Ga(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ar===null?st.memoizedState=Ar=s:Ar=Ar.next=s,Ar}function jr(){if(yr===null){var s=st.alternate;s=s!==null?s.memoizedState:null}else s=yr.next;var d=Ar===null?st.memoizedState:Ar.next;if(d!==null)Ar=d,yr=s;else{if(s===null)throw st.alternate===null?Error(oe(467)):Error(oe(310));yr=s,s={memoizedState:yr.memoizedState,baseState:yr.baseState,baseQueue:yr.baseQueue,queue:yr.queue,next:null},Ar===null?st.memoizedState=Ar=s:Ar=Ar.next=s}return Ar}function Yu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Vc(s){var d=Wu;return Wu+=1,Sl===null&&(Sl=[]),s=qh(Sl,s,d),d=st,(Ar===null?d.memoizedState:Ar.next)===null&&(d=d.alternate,yt.H=d===null||d.memoizedState===null?Po:ad),s}function Ku(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Vc(s);if(s.$$typeof===ki)return Vr(s)}throw Error(oe(438,String(s)))}function Ha(s){var d=null,g=st.updateQueue;if(g!==null&&(d=g.memoCache),d==null){var w=st.alternate;w!==null&&(w=w.updateQueue,w!==null&&(w=w.memoCache,w!=null&&(d={data:w.data.map(function(C){return C.slice()}),index:0})))}if(d==null&&(d={data:[],index:0}),g===null&&(g=Yu(),st.updateQueue=g),g.memoCache=d,g=d.data[d.index],g===void 0)for(g=d.data[d.index]=Array(s),w=0;w<s;w++)g[w]=Ss;return d.index++,g}function mn(s,d){return typeof d=="function"?d(s):d}function ic(s){var d=jr();return nc(d,yr,s)}function nc(s,d,g){var w=s.queue;if(w===null)throw Error(oe(311));w.lastRenderedReducer=g;var C=s.baseQueue,L=w.pending;if(L!==null){if(C!==null){var X=C.next;C.next=L.next,L.next=X}d.baseQueue=C=L,w.pending=null}if(L=s.baseState,C===null)s.memoizedState=L;else{d=C.next;var he=X=null,De=null,ht=d,Dt=!1;do{var Bt=ht.lane&-536870913;if(Bt!==ht.lane?($e&Bt)===Bt:(po&Bt)===Bt){var _t=ht.revertLane;if(_t===0)De!==null&&(De=De.next={lane:0,revertLane:0,gesture:null,action:ht.action,hasEagerState:ht.hasEagerState,eagerState:ht.eagerState,next:null}),Bt===Wl&&(Dt=!0);else if((po&_t)===_t){ht=ht.next,_t===Wl&&(Dt=!0);continue}else Bt={lane:0,revertLane:ht.revertLane,gesture:null,action:ht.action,hasEagerState:ht.hasEagerState,eagerState:ht.eagerState,next:null},De===null?(he=De=Bt,X=L):De=De.next=Bt,st.lanes|=_t,Qi|=_t;Bt=ht.action,Wt&&g(L,Bt),L=ht.hasEagerState?ht.eagerState:g(L,Bt)}else _t={lane:Bt,revertLane:ht.revertLane,gesture:ht.gesture,action:ht.action,hasEagerState:ht.hasEagerState,eagerState:ht.eagerState,next:null},De===null?(he=De=_t,X=L):De=De.next=_t,st.lanes|=Bt,Qi|=Bt;ht=ht.next}while(ht!==null&&ht!==d);if(De===null?X=L:De.next=he,!Ea(L,s.memoizedState)&&(Kr=!0,Dt&&(g=Yl,g!==null)))throw g;s.memoizedState=L,s.baseState=X,s.baseQueue=De,w.lastRenderedState=L}return C===null&&(w.lanes=0),[s.memoizedState,w.dispatch]}function Hd(s){var d=jr(),g=d.queue;if(g===null)throw Error(oe(311));g.lastRenderedReducer=s;var w=g.dispatch,C=g.pending,L=d.memoizedState;if(C!==null){g.pending=null;var X=C=C.next;do L=s(L,X.action),X=X.next;while(X!==C);Ea(L,d.memoizedState)||(Kr=!0),d.memoizedState=L,d.baseQueue===null&&(d.baseState=L),g.lastRenderedState=L}return[L,w]}function $f(s,d,g){var w=st,C=jr(),L=Gn;if(L){if(g===void 0)throw Error(oe(407));g=g()}else g=d();var X=!Ea((yr||C).memoizedState,g);if(X&&(C.memoizedState=g,Kr=!0),C=C.queue,Zc(Ro.bind(null,w,C,s),[s]),C.getSnapshot!==d||X||Ar!==null&&Ar.memoizedState.tag&1){if(w.flags|=2048,Ma(9,{destroy:void 0},qd.bind(null,w,C,g,d),null),vt===null)throw Error(oe(349));L||(po&127)!==0||el(w,d,g)}return g}function el(s,d,g){s.flags|=16384,s={getSnapshot:d,value:g},d=st.updateQueue,d===null?(d=Yu(),st.updateQueue=d,d.stores=[s]):(g=d.stores,g===null?d.stores=[s]:g.push(s))}function qd(s,d,g,w){d.value=g,d.getSnapshot=w,rc(d)&&ut(s)}function Ro(s,d,g){return g(function(){rc(d)&&ut(s)})}function rc(s){var d=s.getSnapshot;s=s.value;try{var g=d();return!Ea(s,g)}catch{return!0}}function ut(s){var d=qo(s,2);d!==null&&ur(d,s,2)}function It(s){var d=Ga();if(typeof s=="function"){var g=s;if(s=g(),Wt){ao(!0);try{g()}finally{ao(!1)}}}return d.memoizedState=d.baseState=s,d.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:mn,lastRenderedState:s},d}function jc(s,d,g,w){return s.baseState=g,nc(s,yr,typeof w=="function"?w:mn)}function fr(s,d,g,w,C){if(Wc(s))throw Error(oe(485));if(s=d.action,s!==null){var L={payload:C,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(X){L.listeners.push(X)}};yt.T!==null?g(!0):L.isTransition=!1,w(L),g=d.pending,g===null?(L.next=d.pending=L,Se(d,L)):(L.next=g.next,d.pending=g.next=L)}}function Se(s,d){var g=d.action,w=d.payload,C=s.state;if(d.isTransition){var L=yt.T,X={};yt.T=X;try{var he=g(C,w),De=yt.S;De!==null&&De(X,he),Zd(s,d,he)}catch(ht){ac(s,d,ht)}finally{L!==null&&X.types!==null&&(L.types=X.types),yt.T=L}}else try{L=g(C,w),Zd(s,d,L)}catch(ht){ac(s,d,ht)}}function Zd(s,d,g){g!==null&&typeof g=="object"&&typeof g.then=="function"?g.then(function(w){Gc(s,d,w)},function(w){return ac(s,d,w)}):Gc(s,d,g)}function Gc(s,d,g){d.status="fulfilled",d.value=g,Qh(d),s.state=g,d=s.pending,d!==null&&(g=d.next,g===d?s.pending=null:(g=g.next,d.next=g,Se(s,g)))}function ac(s,d,g){var w=s.pending;if(s.pending=null,w!==null){w=w.next;do d.status="rejected",d.reason=g,Qh(d),d=d.next;while(d!==w)}s.action=null}function Qh(s){s=s.listeners;for(var d=0;d<s.length;d++)(0,s[d])()}function ed(s,d){return d}function Hc(s,d){if(Gn){var g=vt.formState;if(g!==null){e:{var w=st;if(Gn){if(gr){t:{for(var C=gr,L=Co;C.nodeType!==8;){if(!L){C=null;break t}if(C=rl(C.nextSibling),C===null){C=null;break t}}L=C.data,C=L==="F!"||L==="F"?C:null}if(C){gr=rl(C.nextSibling),w=C.data==="F!";break e}}fs(w)}w=!1}w&&(d=g[0])}}return g=Ga(),g.memoizedState=g.baseState=d,w={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ed,lastRenderedState:d},g.queue=w,g=Al.bind(null,st,w),w.dispatch=g,w=It(!1),L=eh.bind(null,st,!1,w.queue),w=Ga(),C={state:d,dispatch:null,action:s,pending:null},w.queue=C,g=fr.bind(null,st,C,L,g),C.dispatch=g,w.memoizedState=s,[d,g,!1]}function qc(s){var d=jr();return K1(d,yr,s)}function K1(s,d,g){if(d=nc(s,d,ed)[0],s=ic(mn)[0],typeof d=="object"&&d!==null&&typeof d.then=="function")try{var w=Vc(d)}catch(X){throw X===kc?Nd:X}else w=d;d=jr();var C=d.queue,L=C.dispatch;return g!==d.memoizedState&&(st.flags|=2048,Ma(9,{destroy:void 0},J1.bind(null,C,g),null)),[w,L,s]}function J1(s,d){s.action=d}function Wf(s){var d=jr(),g=yr;if(g!==null)return K1(d,g,s);jr(),d=d.memoizedState,g=jr();var w=g.queue.dispatch;return g.memoizedState=s,[d,w,!1]}function Ma(s,d,g,w){return s={tag:s,create:g,deps:w,inst:d,next:null},d=st.updateQueue,d===null&&(d=Yu(),st.updateQueue=d),g=d.lastEffect,g===null?d.lastEffect=s.next=s:(w=g.next,g.next=s,s.next=w,d.lastEffect=s),s}function Xd(){return jr().memoizedState}function Ju(s,d,g,w){var C=Ga();st.flags|=s,C.memoizedState=Ma(1|d,{destroy:void 0},g,w===void 0?null:w)}function td(s,d,g,w){var C=jr();w=w===void 0?null:w;var L=C.memoizedState.inst;yr!==null&&w!==null&&Kh(w,yr.memoizedState.deps)?C.memoizedState=Ma(d,L,g,w):(st.flags|=s,C.memoizedState=Ma(1|d,L,g,w))}function id(s,d){Ju(8390656,8,s,d)}function Zc(s,d){td(2048,8,s,d)}function Xc(s){st.flags|=4;var d=st.updateQueue;if(d===null)d=Yu(),st.updateQueue=d,d.events=[s];else{var g=d.events;g===null?d.events=[s]:g.push(s)}}function Yf(s){var d=jr().memoizedState;return Xc({ref:d,nextImpl:s}),function(){if((Je&2)!==0)throw Error(oe(440));return d.impl.apply(void 0,arguments)}}function Kf(s,d){return td(4,2,s,d)}function Q1(s,d){return td(4,4,s,d)}function Jf(s,d){if(typeof d=="function"){s=s();var g=d(s);return function(){typeof g=="function"?g():d(null)}}if(d!=null)return s=s(),d.current=s,function(){d.current=null}}function ep(s,d,g){g=g!=null?g.concat([s]):null,td(4,4,Jf.bind(null,d,s),g)}function ya(){}function tp(s,d){var g=jr();d=d===void 0?null:d;var w=g.memoizedState;return d!==null&&Kh(d,w[1])?w[0]:(g.memoizedState=[s,d],s)}function Qu(s,d){var g=jr();d=d===void 0?null:d;var w=g.memoizedState;if(d!==null&&Kh(d,w[1]))return w[0];if(w=s(),Wt){ao(!0);try{s()}finally{ao(!1)}}return g.memoizedState=[w,d],w}function Ln(s,d,g){return g===void 0||(po&1073741824)!==0&&($e&261930)===0?s.memoizedState=d:(s.memoizedState=g,s=go(),st.lanes|=s,Qi|=s,g)}function zi(s,d,g,w){return Ea(g,d)?g:Uc.current!==null?(s=Ln(s,g,w),Ea(s,d)||(Kr=!0),s):(po&42)===0||(po&1073741824)!==0&&($e&261930)===0?(Kr=!0,s.memoizedState=g):(s=go(),st.lanes|=s,Qi|=s,d)}function $d(s,d,g,w,C){var L=jt.p;jt.p=L!==0&&8>L?L:8;var X=yt.T,he={};yt.T=he,eh(s,!1,d,g);try{var De=C(),ht=yt.S;if(ht!==null&&ht(he,De),De!==null&&typeof De=="object"&&typeof De.then=="function"){var Dt=Vu(De,w);_s(s,d,Dt,vr(s))}else _s(s,d,w,vr(s))}catch(Bt){_s(s,d,{then:function(){},status:"rejected",reason:Bt},vr())}finally{jt.p=L,X!==null&&he.types!==null&&(X.types=he.types),yt.T=X}}function Qa(){}function El(s,d,g,w){if(s.tag!==5)throw Error(oe(476));var C=$c(s).queue;$d(s,C,d,_i,g===null?Qa:function(){return tl(s),g(w)})}function $c(s){var d=s.memoizedState;if(d!==null)return d;d={memoizedState:_i,baseState:_i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:mn,lastRenderedState:_i},next:null};var g={};return d.next={memoizedState:g,baseState:g,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:mn,lastRenderedState:g},next:null},s.memoizedState=d,s=s.alternate,s!==null&&(s.memoizedState=d),d}function tl(s){var d=$c(s);d.next===null&&(d=s.alternate.memoizedState),_s(s,d.next.queue,{},vr())}function nd(){return Vr(M1)}function Wd(){return jr().memoizedState}function rd(){return jr().memoizedState}function Yd(s){for(var d=s.return;d!==null;){switch(d.tag){case 24:case 3:var g=vr();s=$s(g);var w=Ws(d,s,g);w!==null&&(ur(w,d,g),ec(w,d,g)),d={cache:Nh()},s.payload=d;return}d=d.return}}function Do(s,d,g){var w=vr();g={lane:w,revertLane:0,gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},Wc(s)?Yc(d,g):(g=Dh(s,d,g,w),g!==null&&(ur(g,s,w),Ml(g,d,w)))}function Al(s,d,g){var w=vr();_s(s,d,g,w)}function _s(s,d,g,w){var C={lane:w,revertLane:0,gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null};if(Wc(s))Yc(d,C);else{var L=s.alternate;if(s.lanes===0&&(L===null||L.lanes===0)&&(L=d.lastRenderedReducer,L!==null))try{var X=d.lastRenderedState,he=L(X,g);if(C.hasEagerState=!0,C.eagerState=he,Ea(he,X))return pt(s,d,C,0),vt===null&&zc(),!1}catch{}finally{}if(g=Dh(s,d,C,w),g!==null)return ur(g,s,w),Ml(g,d,w),!0}return!1}function eh(s,d,g,w){if(w={lane:2,revertLane:cp(),gesture:null,action:w,hasEagerState:!1,eagerState:null,next:null},Wc(s)){if(d)throw Error(oe(479))}else d=Dh(s,g,w,2),d!==null&&ur(d,s,2)}function Wc(s){var d=s.alternate;return s===st||d!==null&&d===st}function Yc(s,d){zo=ms=!0;var g=s.pending;g===null?d.next=d:(d.next=g.next,g.next=d),s.pending=d}function Ml(s,d,g){if((g&4194048)!==0){var w=d.lanes;w&=s.pendingLanes,g|=w,d.lanes=g,vu(s,g)}}var Kc={readContext:Vr,use:Ku,useCallback:Fr,useContext:Fr,useEffect:Fr,useImperativeHandle:Fr,useLayoutEffect:Fr,useInsertionEffect:Fr,useMemo:Fr,useReducer:Fr,useRef:Fr,useState:Fr,useDebugValue:Fr,useDeferredValue:Fr,useTransition:Fr,useSyncExternalStore:Fr,useId:Fr,useHostTransitionStatus:Fr,useFormState:Fr,useActionState:Fr,useOptimistic:Fr,useMemoCache:Fr,useCacheRefresh:Fr};Kc.useEffectEvent=Fr;var Po={readContext:Vr,use:Ku,useCallback:function(s,d){return Ga().memoizedState=[s,d===void 0?null:d],s},useContext:Vr,useEffect:id,useImperativeHandle:function(s,d,g){g=g!=null?g.concat([s]):null,Ju(4194308,4,Jf.bind(null,d,s),g)},useLayoutEffect:function(s,d){return Ju(4194308,4,s,d)},useInsertionEffect:function(s,d){Ju(4,2,s,d)},useMemo:function(s,d){var g=Ga();d=d===void 0?null:d;var w=s();if(Wt){ao(!0);try{s()}finally{ao(!1)}}return g.memoizedState=[w,d],w},useReducer:function(s,d,g){var w=Ga();if(g!==void 0){var C=g(d);if(Wt){ao(!0);try{g(d)}finally{ao(!1)}}}else C=d;return w.memoizedState=w.baseState=C,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:C},w.queue=s,s=s.dispatch=Do.bind(null,st,s),[w.memoizedState,s]},useRef:function(s){var d=Ga();return s={current:s},d.memoizedState=s},useState:function(s){s=It(s);var d=s.queue,g=Al.bind(null,st,d);return d.dispatch=g,[s.memoizedState,g]},useDebugValue:ya,useDeferredValue:function(s,d){var g=Ga();return Ln(g,s,d)},useTransition:function(){var s=It(!1);return s=$d.bind(null,st,s.queue,!0,!1),Ga().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,d,g){var w=st,C=Ga();if(Gn){if(g===void 0)throw Error(oe(407));g=g()}else{if(g=d(),vt===null)throw Error(oe(349));($e&127)!==0||el(w,d,g)}C.memoizedState=g;var L={value:g,getSnapshot:d};return C.queue=L,id(Ro.bind(null,w,L,s),[s]),w.flags|=2048,Ma(9,{destroy:void 0},qd.bind(null,w,L,g,d),null),g},useId:function(){var s=Ga(),d=vt.identifierPrefix;if(Gn){var g=hs,w=js;g=(w&~(1<<32-ba(w)-1)).toString(32)+g,d="_"+d+"R_"+g,g=$u++,0<g&&(d+="H"+g.toString(32)),d+="_"}else g=jd++,d="_"+d+"r_"+g.toString(32)+"_";return s.memoizedState=d},useHostTransitionStatus:nd,useFormState:Hc,useActionState:Hc,useOptimistic:function(s){var d=Ga();d.memoizedState=d.baseState=s;var g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return d.queue=g,d=eh.bind(null,st,!0,g),g.dispatch=d,[s,d]},useMemoCache:Ha,useCacheRefresh:function(){return Ga().memoizedState=Yd.bind(null,st)},useEffectEvent:function(s){var d=Ga(),g={impl:s};return d.memoizedState=g,function(){if((Je&2)!==0)throw Error(oe(440));return g.impl.apply(void 0,arguments)}}},ad={readContext:Vr,use:Ku,useCallback:tp,useContext:Vr,useEffect:Zc,useImperativeHandle:ep,useInsertionEffect:Kf,useLayoutEffect:Q1,useMemo:Qu,useReducer:ic,useRef:Xd,useState:function(){return ic(mn)},useDebugValue:ya,useDeferredValue:function(s,d){var g=jr();return zi(g,yr.memoizedState,s,d)},useTransition:function(){var s=ic(mn)[0],d=jr().memoizedState;return[typeof s=="boolean"?s:Vc(s),d]},useSyncExternalStore:$f,useId:Wd,useHostTransitionStatus:nd,useFormState:qc,useActionState:qc,useOptimistic:function(s,d){var g=jr();return jc(g,yr,s,d)},useMemoCache:Ha,useCacheRefresh:rd};ad.useEffectEvent=Yf;var od={readContext:Vr,use:Ku,useCallback:tp,useContext:Vr,useEffect:Zc,useImperativeHandle:ep,useInsertionEffect:Kf,useLayoutEffect:Q1,useMemo:Qu,useReducer:Hd,useRef:Xd,useState:function(){return Hd(mn)},useDebugValue:ya,useDeferredValue:function(s,d){var g=jr();return yr===null?Ln(g,s,d):zi(g,yr.memoizedState,s,d)},useTransition:function(){var s=Hd(mn)[0],d=jr().memoizedState;return[typeof s=="boolean"?s:Vc(s),d]},useSyncExternalStore:$f,useId:Wd,useHostTransitionStatus:nd,useFormState:Wf,useActionState:Wf,useOptimistic:function(s,d){var g=jr();return yr!==null?jc(g,yr,s,d):(g.baseState=s,[s,g.queue.dispatch])},useMemoCache:Ha,useCacheRefresh:rd};od.useEffectEvent=Yf;function oc(s,d,g,w){d=s.memoizedState,g=g(w,d),g=g==null?d:Ft({},d,g),s.memoizedState=g,s.lanes===0&&(s.updateQueue.baseState=g)}var sc={enqueueSetState:function(s,d,g){s=s._reactInternals;var w=vr(),C=$s(w);C.payload=d,g!=null&&(C.callback=g),d=Ws(s,C,w),d!==null&&(ur(d,s,w),ec(d,s,w))},enqueueReplaceState:function(s,d,g){s=s._reactInternals;var w=vr(),C=$s(w);C.tag=1,C.payload=d,g!=null&&(C.callback=g),d=Ws(s,C,w),d!==null&&(ur(d,s,w),ec(d,s,w))},enqueueForceUpdate:function(s,d){s=s._reactInternals;var g=vr(),w=$s(g);w.tag=2,d!=null&&(w.callback=d),d=Ws(s,w,g),d!==null&&(ur(d,s,g),ec(d,s,g))}};function Hn(s,d,g,w,C,L,X){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(w,L,X):d.prototype&&d.prototype.isPureReactComponent?!Mo(g,w)||!Mo(C,L):!0}function Jc(s,d,g,w){s=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(g,w),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(g,w),d.state!==s&&sc.enqueueReplaceState(d,d.state,null)}function Il(s,d){var g=d;if("ref"in d){g={};for(var w in d)w!=="ref"&&(g[w]=d[w])}if(s=s.defaultProps){g===d&&(g=Ft({},g));for(var C in s)g[C]===void 0&&(g[C]=s[C])}return g}function Kd(s){ml(s)}function lc(s){console.error(s)}function Jd(s){ml(s)}function cc(s,d){try{var g=s.onUncaughtError;g(d.value,{componentStack:d.stack})}catch(w){setTimeout(function(){throw w})}}function Qd(s,d,g){try{var w=s.onCaughtError;w(g.value,{componentStack:g.stack,errorBoundary:d.tag===1?d.stateNode:null})}catch(C){setTimeout(function(){throw C})}}function il(s,d,g){return g=$s(g),g.tag=3,g.payload={element:null},g.callback=function(){cc(s,d)},g}function ef(s){return s=$s(s),s.tag=3,s}function sd(s,d,g,w){var C=g.type.getDerivedStateFromError;if(typeof C=="function"){var L=w.value;s.payload=function(){return C(L)},s.callback=function(){Qd(d,g,w)}}var X=g.stateNode;X!==null&&typeof X.componentDidCatch=="function"&&(s.callback=function(){Qd(d,g,w),typeof C!="function"&&(Vi===null?Vi=new Set([this]):Vi.add(this));var he=w.stack;this.componentDidCatch(w.value,{componentStack:he!==null?he:""})})}function tf(s,d,g,w,C){if(g.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){if(d=g.alternate,d!==null&&$l(d,g,C,!0),g=La.current,g!==null){switch(g.tag){case 31:case 13:return ga===null?es():g.alternate===null&&fi===0&&(fi=3),g.flags&=-257,g.flags|=65536,g.lanes=C,w===Ud?g.flags|=16384:(d=g.updateQueue,d===null?g.updateQueue=new Set([w]):d.add(w),op(s,w,C)),!1;case 22:return g.flags|=65536,w===Ud?g.flags|=16384:(d=g.updateQueue,d===null?(d={transitions:null,markerInstances:null,retryQueue:new Set([w])},g.updateQueue=d):(g=d.retryQueue,g===null?d.retryQueue=new Set([w]):g.add(w)),op(s,w,C)),!1}throw Error(oe(435,g.tag))}return op(s,w,C),es(),!1}if(Gn)return d=La.current,d!==null?((d.flags&65536)===0&&(d.flags|=256),d.flags|=65536,d.lanes=C,w!==Zl&&(s=Error(oe(422),{cause:w}),Nu(fo(s,g)))):(w!==Zl&&(d=Error(oe(423),{cause:w}),Nu(fo(d,g))),s=s.current.alternate,s.flags|=65536,C&=-C,s.lanes|=C,w=fo(w,g),C=il(s.stateNode,w,C),qu(s,C),fi!==4&&(fi=2)),!1;var L=Error(oe(520),{cause:w});if(L=fo(L,g),Fi===null?Fi=[L]:Fi.push(L),fi!==4&&(fi=2),d===null)return!0;w=fo(w,g),g=d;do{switch(g.tag){case 3:return g.flags|=65536,s=C&-C,g.lanes|=s,s=il(g.stateNode,w,s),qu(g,s),!1;case 1:if(d=g.type,L=g.stateNode,(g.flags&128)===0&&(typeof d.getDerivedStateFromError=="function"||L!==null&&typeof L.componentDidCatch=="function"&&(Vi===null||!Vi.has(L))))return g.flags|=65536,C&=-C,g.lanes|=C,C=ef(C),sd(C,s,g,w),qu(g,C),!1}g=g.return}while(g!==null);return!1}var uc=Error(oe(461)),Kr=!1;function ua(s,d,g,w){d.child=s===null?Ql(d,null,g,w):Xs(d,s.child,g,w)}function nf(s,d,g,w,C){g=g.render;var L=d.ref;if("ref"in w){var X={};for(var he in w)he!=="ref"&&(X[he]=w[he])}else X=w;return qs(d),w=Gd(s,d,g,X,L,C),he=Jh(),s!==null&&!Kr?(Aa(s,d,C),Jo(s,d,C)):(Gn&&he&&Oh(d),d.flags|=1,ua(s,d,w,C),d.child)}function Qf(s,d,g,w,C){if(s===null){var L=g.type;return typeof L=="function"&&!ho(L)&&L.defaultProps===void 0&&g.compare===null?(d.tag=15,d.type=L,ld(s,d,L,w,C)):(s=Rd(g.type,null,w,d,d.mode,C),s.ref=d.ref,s.return=d,d.child=s)}if(L=s.child,!_o(s,C)){var X=L.memoizedProps;if(g=g.compare,g=g!==null?g:Mo,g(X,w)&&s.ref===d.ref)return Jo(s,d,C)}return d.flags|=1,s=Ai(L,w),s.ref=d.ref,s.return=d,d.child=s}function ld(s,d,g,w,C){if(s!==null){var L=s.memoizedProps;if(Mo(L,w)&&s.ref===d.ref)if(Kr=!1,d.pendingProps=w=L,_o(s,C))(s.flags&131072)!==0&&(Kr=!0);else return d.lanes=s.lanes,Jo(s,d,C)}return af(s,d,g,w,C)}function th(s,d,g,w){var C=w.children,L=s!==null?s.memoizedState:null;if(s===null&&d.stateNode===null&&(d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),w.mode==="hidden"){if((d.flags&128)!==0){if(L=L!==null?L.baseLanes|g:g,s!==null){for(w=d.child=s.child,C=0;w!==null;)C=C|w.lanes|w.childLanes,w=w.sibling;w=C&~L}else w=0,d.child=null;return e1(s,d,L,g,w)}if((g&536870912)!==0)d.memoizedState={baseLanes:0,cachePool:null},s!==null&&Hh(d,L!==null?L.cachePool:null),L!==null?Wh(d,L):Zu(),Yh(d);else return w=d.lanes=536870912,e1(s,d,L!==null?L.baseLanes|g:g,g,w)}else L!==null?(Hh(d,L.cachePool),Wh(d,L),Ko(),d.memoizedState=null):(s!==null&&Hh(d,null),Zu(),Ko());return ua(s,d,C,g),d.child}function Qc(s,d){return s!==null&&s.tag===22||d.stateNode!==null||(d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.sibling}function e1(s,d,g,w,C){var L=Bd();return L=L===null?null:{parent:cr._currentValue,pool:L},d.memoizedState={baseLanes:g,cachePool:L},s!==null&&Hh(d,null),Zu(),Yh(d),s!==null&&$l(s,d,w,!0),d.childLanes=C,null}function ih(s,d){return d=of({mode:d.mode,children:d.children},s.mode),d.ref=s.ref,s.child=d,d.return=s,d}function t1(s,d,g){return Xs(d,s.child,null,g),s=ih(d,d.pendingProps),s.flags|=2,ja(d),d.memoizedState=null,s}function rf(s,d,g){var w=d.pendingProps,C=(d.flags&128)!==0;if(d.flags&=-129,s===null){if(Gn){if(w.mode==="hidden")return s=ih(d,w),d.lanes=536870912,Qc(null,s);if(Xu(d),(s=gr)?(s=mp(s,Co),s=s!==null&&s.data==="&"?s:null,s!==null&&(d.memoizedState={dehydrated:s,treeContext:us!==null?{id:js,overflow:hs}:null,retryLane:536870912,hydrationErrors:null},g=Z1(s),g.return=d,d.child=g,na=d,gr=null)):s=null,s===null)throw fs(d);return d.lanes=536870912,null}return ih(d,w)}var L=s.memoizedState;if(L!==null){var X=L.dehydrated;if(Xu(d),C)if(d.flags&256)d.flags&=-257,d=t1(s,d,g);else if(d.memoizedState!==null)d.child=s.child,d.flags|=128,d=null;else throw Error(oe(558));else if(Kr||$l(s,d,g,!1),C=(g&s.childLanes)!==0,Kr||C){if(w=vt,w!==null&&(X=Ui(w,g),X!==0&&X!==L.retryLane))throw L.retryLane=X,qo(s,X),ur(w,s,X),uc;es(),d=t1(s,d,g)}else s=L.treeContext,gr=rl(X.nextSibling),na=d,Gn=!0,Gs=null,Co=!1,s!==null&&Lc(d,s),d=ih(d,w),d.flags|=4096;return d}return s=Ai(s.child,{mode:w.mode,children:w.children}),s.ref=d.ref,d.child=s,s.return=d,s}function cd(s,d){var g=d.ref;if(g===null)s!==null&&s.ref!==null&&(d.flags|=4194816);else{if(typeof g!="function"&&typeof g!="object")throw Error(oe(284));(s===null||s.ref!==g)&&(d.flags|=4194816)}}function af(s,d,g,w,C){return qs(d),g=Gd(s,d,g,w,void 0,C),w=Jh(),s!==null&&!Kr?(Aa(s,d,C),Jo(s,d,C)):(Gn&&w&&Oh(d),d.flags|=1,ua(s,d,g,C),d.child)}function i1(s,d,g,w,C,L){return qs(d),d.updateQueue=null,g=Y1(d,w,g,C),W1(s),w=Jh(),s!==null&&!Kr?(Aa(s,d,L),Jo(s,d,L)):(Gn&&w&&Oh(d),d.flags|=1,ua(s,d,g,L),d.child)}function n1(s,d,g,w,C){if(qs(d),d.stateNode===null){var L=Us,X=g.contextType;typeof X=="object"&&X!==null&&(L=Vr(X)),L=new g(w,L),d.memoizedState=L.state!==null&&L.state!==void 0?L.state:null,L.updater=sc,d.stateNode=L,L._reactInternals=d,L=d.stateNode,L.props=w,L.state=d.memoizedState,L.refs={},Xh(d),X=g.contextType,L.context=typeof X=="object"&&X!==null?Vr(X):Us,L.state=d.memoizedState,X=g.getDerivedStateFromProps,typeof X=="function"&&(oc(d,g,X,w),L.state=d.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof L.getSnapshotBeforeUpdate=="function"||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(X=L.state,typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount(),X!==L.state&&sc.enqueueReplaceState(L,L.state,null),Ys(d,w,L,C),tc(),L.state=d.memoizedState),typeof L.componentDidMount=="function"&&(d.flags|=4194308),w=!0}else if(s===null){L=d.stateNode;var he=d.memoizedProps,De=Il(g,he);L.props=De;var ht=L.context,Dt=g.contextType;X=Us,typeof Dt=="object"&&Dt!==null&&(X=Vr(Dt));var Bt=g.getDerivedStateFromProps;Dt=typeof Bt=="function"||typeof L.getSnapshotBeforeUpdate=="function",he=d.pendingProps!==he,Dt||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(he||ht!==X)&&Jc(d,L,w,X),Ja=!1;var _t=d.memoizedState;L.state=_t,Ys(d,w,L,C),tc(),ht=d.memoizedState,he||_t!==ht||Ja?(typeof Bt=="function"&&(oc(d,g,Bt,w),ht=d.memoizedState),(De=Ja||Hn(d,g,De,w,_t,ht,X))?(Dt||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount()),typeof L.componentDidMount=="function"&&(d.flags|=4194308)):(typeof L.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=w,d.memoizedState=ht),L.props=w,L.state=ht,L.context=X,w=De):(typeof L.componentDidMount=="function"&&(d.flags|=4194308),w=!1)}else{L=d.stateNode,Hu(s,d),X=d.memoizedProps,Dt=Il(g,X),L.props=Dt,Bt=d.pendingProps,_t=L.context,ht=g.contextType,De=Us,typeof ht=="object"&&ht!==null&&(De=Vr(ht)),he=g.getDerivedStateFromProps,(ht=typeof he=="function"||typeof L.getSnapshotBeforeUpdate=="function")||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(X!==Bt||_t!==De)&&Jc(d,L,w,De),Ja=!1,_t=d.memoizedState,L.state=_t,Ys(d,w,L,C),tc();var wt=d.memoizedState;X!==Bt||_t!==wt||Ja||s!==null&&s.dependencies!==null&&Oc(s.dependencies)?(typeof he=="function"&&(oc(d,g,he,w),wt=d.memoizedState),(Dt=Ja||Hn(d,g,Dt,w,_t,wt,De)||s!==null&&s.dependencies!==null&&Oc(s.dependencies))?(ht||typeof L.UNSAFE_componentWillUpdate!="function"&&typeof L.componentWillUpdate!="function"||(typeof L.componentWillUpdate=="function"&&L.componentWillUpdate(w,wt,De),typeof L.UNSAFE_componentWillUpdate=="function"&&L.UNSAFE_componentWillUpdate(w,wt,De)),typeof L.componentDidUpdate=="function"&&(d.flags|=4),typeof L.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof L.componentDidUpdate!="function"||X===s.memoizedProps&&_t===s.memoizedState||(d.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||X===s.memoizedProps&&_t===s.memoizedState||(d.flags|=1024),d.memoizedProps=w,d.memoizedState=wt),L.props=w,L.state=wt,L.context=De,w=Dt):(typeof L.componentDidUpdate!="function"||X===s.memoizedProps&&_t===s.memoizedState||(d.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||X===s.memoizedProps&&_t===s.memoizedState||(d.flags|=1024),w=!1)}return L=w,cd(s,d),w=(d.flags&128)!==0,L||w?(L=d.stateNode,g=w&&typeof g.getDerivedStateFromError!="function"?null:L.render(),d.flags|=1,s!==null&&w?(d.child=Xs(d,s.child,null,C),d.child=Xs(d,null,g,C)):ua(s,d,g,C),d.memoizedState=L.state,s=d.child):s=Jo(s,d,C),s}function r1(s,d,g,w){return ps(),d.flags|=256,ua(s,d,g,w),d.child}var a1={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function o1(s){return{baseLanes:s,cachePool:Bc()}}function $n(s,d,g){return s=s!==null?s.childLanes&~g:0,d&&(s|=oi),s}function s1(s,d,g){var w=d.pendingProps,C=!1,L=(d.flags&128)!==0,X;if((X=L)||(X=s!==null&&s.memoizedState===null?!1:(Yr.current&2)!==0),X&&(C=!0,d.flags&=-129),X=(d.flags&32)!==0,d.flags&=-33,s===null){if(Gn){if(C?Ks(d):Ko(),(s=gr)?(s=mp(s,Co),s=s!==null&&s.data!=="&"?s:null,s!==null&&(d.memoizedState={dehydrated:s,treeContext:us!==null?{id:js,overflow:hs}:null,retryLane:536870912,hydrationErrors:null},g=Z1(s),g.return=d,d.child=g,na=d,gr=null)):s=null,s===null)throw fs(d);return _p(s)?d.lanes=32:d.lanes=536870912,null}var he=w.children;return w=w.fallback,C?(Ko(),C=d.mode,he=of({mode:"hidden",children:he},C),w=Pc(w,C,g,null),he.return=d,w.return=d,he.sibling=w,d.child=he,w=d.child,w.memoizedState=o1(g),w.childLanes=$n(s,X,g),d.memoizedState=a1,Qc(null,w)):(Ks(d),l1(d,he))}var De=s.memoizedState;if(De!==null&&(he=De.dehydrated,he!==null)){if(L)d.flags&256?(Ks(d),d.flags&=-257,d=c1(s,d,g)):d.memoizedState!==null?(Ko(),d.child=s.child,d.flags|=128,d=null):(Ko(),he=w.fallback,C=d.mode,w=of({mode:"visible",children:w.children},C),he=Pc(he,C,g,null),he.flags|=2,w.return=d,he.return=d,w.sibling=he,d.child=w,Xs(d,s.child,null,g),w=d.child,w.memoizedState=o1(g),w.childLanes=$n(s,X,g),d.memoizedState=a1,d=Qc(null,w));else if(Ks(d),_p(he)){if(X=he.nextSibling&&he.nextSibling.dataset,X)var ht=X.dgst;X=ht,w=Error(oe(419)),w.stack="",w.digest=X,Nu({value:w,source:null,stack:null}),d=c1(s,d,g)}else if(Kr||$l(s,d,g,!1),X=(g&s.childLanes)!==0,Kr||X){if(X=vt,X!==null&&(w=Ui(X,g),w!==0&&w!==De.retryLane))throw De.retryLane=w,qo(s,w),ur(X,s,w),uc;w1(he)||es(),d=c1(s,d,g)}else w1(he)?(d.flags|=192,d.child=s.child,d=null):(s=De.treeContext,gr=rl(he.nextSibling),na=d,Gn=!0,Gs=null,Co=!1,s!==null&&Lc(d,s),d=l1(d,w.children),d.flags|=4096);return d}return C?(Ko(),he=w.fallback,C=d.mode,De=s.child,ht=De.sibling,w=Ai(De,{mode:"hidden",children:w.children}),w.subtreeFlags=De.subtreeFlags&65011712,ht!==null?he=Ai(ht,he):(he=Pc(he,C,g,null),he.flags|=2),he.return=d,w.return=d,w.sibling=he,d.child=w,Qc(null,w),w=d.child,he=s.child.memoizedState,he===null?he=o1(g):(C=he.cachePool,C!==null?(De=cr._currentValue,C=C.parent!==De?{parent:De,pool:De}:C):C=Bc(),he={baseLanes:he.baseLanes|g,cachePool:C}),w.memoizedState=he,w.childLanes=$n(s,X,g),d.memoizedState=a1,Qc(s.child,w)):(Ks(d),g=s.child,s=g.sibling,g=Ai(g,{mode:"visible",children:w.children}),g.return=d,g.sibling=null,s!==null&&(X=d.deletions,X===null?(d.deletions=[s],d.flags|=16):X.push(s)),d.child=g,d.memoizedState=null,g)}function l1(s,d){return d=of({mode:"visible",children:d},s.mode),d.return=s,s.child=d}function of(s,d){return s=Va(22,s,null,d),s.lanes=0,s}function c1(s,d,g){return Xs(d,s.child,null,g),s=l1(d,d.pendingProps.children),s.flags|=2,d.memoizedState=null,s}function nh(s,d,g){s.lanes|=d;var w=s.alternate;w!==null&&(w.lanes|=d),qf(s.return,d,g)}function eu(s,d,g,w,C,L){var X=s.memoizedState;X===null?s.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:w,tail:g,tailMode:C,treeForkCount:L}:(X.isBackwards=d,X.rendering=null,X.renderingStartTime=0,X.last=w,X.tail=g,X.tailMode=C,X.treeForkCount=L)}function sf(s,d,g){var w=d.pendingProps,C=w.revealOrder,L=w.tail;w=w.children;var X=Yr.current,he=(X&2)!==0;if(he?(X=X&1|2,d.flags|=128):X&=1,qt(Yr,X),ua(s,d,w,g),w=Gn?Ph:0,!he&&s!==null&&(s.flags&128)!==0)e:for(s=d.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&nh(s,g,d);else if(s.tag===19)nh(s,g,d);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===d)break e;for(;s.sibling===null;){if(s.return===null||s.return===d)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(C){case"forwards":for(g=d.child,C=null;g!==null;)s=g.alternate,s!==null&&Js(s)===null&&(C=g),g=g.sibling;g=C,g===null?(C=d.child,d.child=null):(C=g.sibling,g.sibling=null),eu(d,!1,C,g,L,w);break;case"backwards":case"unstable_legacy-backwards":for(g=null,C=d.child,d.child=null;C!==null;){if(s=C.alternate,s!==null&&Js(s)===null){d.child=C;break}s=C.sibling,C.sibling=g,g=C,C=s}eu(d,!0,g,null,L,w);break;case"together":eu(d,!1,null,null,void 0,w);break;default:d.memoizedState=null}return d.child}function Jo(s,d,g){if(s!==null&&(d.dependencies=s.dependencies),Qi|=d.lanes,(g&d.childLanes)===0)if(s!==null){if($l(s,d,g,!1),(g&d.childLanes)===0)return null}else return null;if(s!==null&&d.child!==s.child)throw Error(oe(153));if(d.child!==null){for(s=d.child,g=Ai(s,s.pendingProps),d.child=g,g.return=d;s.sibling!==null;)s=s.sibling,g=g.sibling=Ai(s,s.pendingProps),g.return=d;g.sibling=null}return d.child}function _o(s,d){return(s.lanes&d)!==0?!0:(s=s.dependencies,!!(s!==null&&Oc(s)))}function lf(s,d,g){switch(d.tag){case 3:Lr(d,d.stateNode.containerInfo),Xl(d,cr,s.memoizedState.cache),ps();break;case 27:case 5:br(d);break;case 4:Lr(d,d.stateNode.containerInfo);break;case 10:Xl(d,d.type,d.memoizedProps.value);break;case 31:if(d.memoizedState!==null)return d.flags|=128,Xu(d),null;break;case 13:var w=d.memoizedState;if(w!==null)return w.dehydrated!==null?(Ks(d),d.flags|=128,null):(g&d.child.childLanes)!==0?s1(s,d,g):(Ks(d),s=Jo(s,d,g),s!==null?s.sibling:null);Ks(d);break;case 19:var C=(s.flags&128)!==0;if(w=(g&d.childLanes)!==0,w||($l(s,d,g,!1),w=(g&d.childLanes)!==0),C){if(w)return sf(s,d,g);d.flags|=128}if(C=d.memoizedState,C!==null&&(C.rendering=null,C.tail=null,C.lastEffect=null),qt(Yr,Yr.current),w)break;return null;case 22:return d.lanes=0,th(s,d,g,d.pendingProps);case 24:Xl(d,cr,s.memoizedState.cache)}return Jo(s,d,g)}function Mr(s,d,g){if(s!==null)if(s.memoizedProps!==d.pendingProps)Kr=!0;else{if(!_o(s,g)&&(d.flags&128)===0)return Kr=!1,lf(s,d,g);Kr=(s.flags&131072)!==0}else Kr=!1,Gn&&(d.flags&1048576)!==0&&Lh(d,Ph,d.index);switch(d.lanes=0,d.tag){case 16:e:{var w=d.pendingProps;if(s=bl(d.elementType),d.type=s,typeof s=="function")ho(s)?(w=Il(s,w),d.tag=1,d=n1(null,d,s,w,g)):(d.tag=0,d=af(null,d,s,w,g));else{if(s!=null){var C=s.$$typeof;if(C===si){d.tag=11,d=nf(null,d,s,w,g);break e}else if(C===ln){d.tag=14,d=Qf(null,d,s,w,g);break e}}throw d=Bo(s)||s,Error(oe(306,d,""))}}return d;case 0:return af(s,d,d.type,d.pendingProps,g);case 1:return w=d.type,C=Il(w,d.pendingProps),n1(s,d,w,C,g);case 3:e:{if(Lr(d,d.stateNode.containerInfo),s===null)throw Error(oe(387));w=d.pendingProps;var L=d.memoizedState;C=L.element,Hu(s,d),Ys(d,w,null,g);var X=d.memoizedState;if(w=X.cache,Xl(d,cr,w),w!==L.cache&&Bh(d,[cr],g,!0),tc(),w=X.element,L.isDehydrated)if(L={element:w,isDehydrated:!1,cache:X.cache},d.updateQueue.baseState=L,d.memoizedState=L,d.flags&256){d=r1(s,d,w,g);break e}else if(w!==C){C=fo(Error(oe(424)),d),Nu(C),d=r1(s,d,w,g);break e}else{switch(s=d.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(gr=rl(s.firstChild),na=d,Gn=!0,Gs=null,Co=!0,g=Ql(d,null,w,g),d.child=g;g;)g.flags=g.flags&-3|4096,g=g.sibling}else{if(ps(),w===C){d=Jo(s,d,g);break e}ua(s,d,w,g)}d=d.child}return d;case 26:return cd(s,d),s===null?(g=_0(d.type,null,d.pendingProps,null))?d.memoizedState=g:Gn||(g=d.type,s=d.pendingProps,w=dp(En.current).createElement(g),w[G]=d,w[J]=s,to(w,g,s),Gt(w),d.stateNode=w):d.memoizedState=_0(d.type,s.memoizedProps,d.pendingProps,s.memoizedState),null;case 27:return br(d),s===null&&Gn&&(w=d.stateNode=sm(d.type,d.pendingProps,En.current),na=d,Co=!0,C=gr,au(d.type)?(io=C,gr=rl(w.firstChild)):gr=C),ua(s,d,d.pendingProps.children,g),cd(s,d),s===null&&(d.flags|=4194304),d.child;case 5:return s===null&&Gn&&((C=w=gr)&&(w=f_(w,d.type,d.pendingProps,Co),w!==null?(d.stateNode=w,na=d,gr=rl(w.firstChild),Co=!1,C=!0):C=!1),C||fs(d)),br(d),C=d.type,L=d.pendingProps,X=s!==null?s.memoizedProps:null,w=L.children,nm(C,L)?w=null:X!==null&&nm(C,X)&&(d.flags|=32),d.memoizedState!==null&&(C=Gd(s,d,mo,null,null,g),M1._currentValue=C),cd(s,d),ua(s,d,w,g),d.child;case 6:return s===null&&Gn&&((s=g=gr)&&(g=h0(g,d.pendingProps,Co),g!==null?(d.stateNode=g,na=d,gr=null,s=!0):s=!1),s||fs(d)),null;case 13:return s1(s,d,g);case 4:return Lr(d,d.stateNode.containerInfo),w=d.pendingProps,s===null?d.child=Xs(d,null,w,g):ua(s,d,w,g),d.child;case 11:return nf(s,d,d.type,d.pendingProps,g);case 7:return ua(s,d,d.pendingProps,g),d.child;case 8:return ua(s,d,d.pendingProps.children,g),d.child;case 12:return ua(s,d,d.pendingProps.children,g),d.child;case 10:return w=d.pendingProps,Xl(d,d.type,w.value),ua(s,d,w.children,g),d.child;case 9:return C=d.type._context,w=d.pendingProps.children,qs(d),C=Vr(C),w=w(C),d.flags|=1,ua(s,d,w,g),d.child;case 14:return Qf(s,d,d.type,d.pendingProps,g);case 15:return ld(s,d,d.type,d.pendingProps,g);case 19:return sf(s,d,g);case 31:return rf(s,d,g);case 22:return th(s,d,g,d.pendingProps);case 24:return qs(d),w=Vr(cr),s===null?(C=Bd(),C===null&&(C=vt,L=Nh(),C.pooledCache=L,L.refCount++,L!==null&&(C.pooledCacheLanes|=g),C=L),d.memoizedState={parent:w,cache:C},Xh(d),Xl(d,cr,C)):((s.lanes&g)!==0&&(Hu(s,d),Ys(d,null,null,g),tc()),C=s.memoizedState,L=d.memoizedState,C.parent!==w?(C={parent:w,cache:w},d.memoizedState=C,d.lanes===0&&(d.memoizedState=d.updateQueue.baseState=C),Xl(d,cr,w)):(w=L.cache,Xl(d,cr,w),w!==C.cache&&Bh(d,[cr],g,!0))),ua(s,d,d.pendingProps.children,g),d.child;case 29:throw d.pendingProps}throw Error(oe(156,d.tag))}function Ia(s){s.flags|=4}function hc(s,d,g,w,C){if((d=(s.mode&32)!==0)&&(d=!1),d){if(s.flags|=16777216,(C&335544128)===C)if(s.stateNode.complete)s.flags|=8192;else if(or())s.flags|=8192;else throw wl=Ud,kd}else s.flags&=-16777217}function rh(s,d){if(d.type!=="stylesheet"||(d.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!vp(d))if(or())s.flags|=8192;else throw wl=Ud,kd}function ah(s,d){d!==null&&(s.flags|=4),s.flags&16384&&(d=s.tag!==22?bd():536870912,s.lanes|=d,en|=d)}function oh(s,d){if(!Gn)switch(s.tailMode){case"hidden":d=s.tail;for(var g=null;d!==null;)d.alternate!==null&&(g=d),d=d.sibling;g===null?s.tail=null:g.sibling=null;break;case"collapsed":g=s.tail;for(var w=null;g!==null;)g.alternate!==null&&(w=g),g=g.sibling;w===null?d||s.tail===null?s.tail=null:s.tail.sibling=null:w.sibling=null}}function Tr(s){var d=s.alternate!==null&&s.alternate.child===s.child,g=0,w=0;if(d)for(var C=s.child;C!==null;)g|=C.lanes|C.childLanes,w|=C.subtreeFlags&65011712,w|=C.flags&65011712,C.return=s,C=C.sibling;else for(C=s.child;C!==null;)g|=C.lanes|C.childLanes,w|=C.subtreeFlags,w|=C.flags,C.return=s,C=C.sibling;return s.subtreeFlags|=w,s.childLanes=g,d}function Hp(s,d,g){var w=d.pendingProps;switch(gl(d),d.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Tr(d),null;case 1:return Tr(d),null;case 3:return g=d.stateNode,w=null,s!==null&&(w=s.memoizedState.cache),d.memoizedState.cache!==w&&(d.flags|=2048),Hs(cr),Li(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(s===null||s.child===null)&&(yl(d)?Ia(d):s===null||s.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,Ld())),Tr(d),null;case 26:var C=d.type,L=d.memoizedState;return s===null?(Ia(d),L!==null?(Tr(d),rh(d,L)):(Tr(d),hc(d,C,null,w,g))):L?L!==s.memoizedState?(Ia(d),Tr(d),rh(d,L)):(Tr(d),d.flags&=-16777217):(s=s.memoizedProps,s!==w&&Ia(d),Tr(d),hc(d,C,s,w,g)),null;case 27:if(Br(d),g=En.current,C=d.type,s!==null&&d.stateNode!=null)s.memoizedProps!==w&&Ia(d);else{if(!w){if(d.stateNode===null)throw Error(oe(166));return Tr(d),null}s=gi.current,yl(d)?Fh(d):(s=sm(C,w,g),d.stateNode=s,Ia(d))}return Tr(d),null;case 5:if(Br(d),C=d.type,s!==null&&d.stateNode!=null)s.memoizedProps!==w&&Ia(d);else{if(!w){if(d.stateNode===null)throw Error(oe(166));return Tr(d),null}if(L=gi.current,yl(d))Fh(d);else{var X=dp(En.current);switch(L){case 1:L=X.createElementNS("http://www.w3.org/2000/svg",C);break;case 2:L=X.createElementNS("http://www.w3.org/1998/Math/MathML",C);break;default:switch(C){case"svg":L=X.createElementNS("http://www.w3.org/2000/svg",C);break;case"math":L=X.createElementNS("http://www.w3.org/1998/Math/MathML",C);break;case"script":L=X.createElement("div"),L.innerHTML="<script><\/script>",L=L.removeChild(L.firstChild);break;case"select":L=typeof w.is=="string"?X.createElement("select",{is:w.is}):X.createElement("select"),w.multiple?L.multiple=!0:w.size&&(L.size=w.size);break;default:L=typeof w.is=="string"?X.createElement(C,{is:w.is}):X.createElement(C)}}L[G]=d,L[J]=w;e:for(X=d.child;X!==null;){if(X.tag===5||X.tag===6)L.appendChild(X.stateNode);else if(X.tag!==4&&X.tag!==27&&X.child!==null){X.child.return=X,X=X.child;continue}if(X===d)break e;for(;X.sibling===null;){if(X.return===null||X.return===d)break e;X=X.return}X.sibling.return=X.return,X=X.sibling}d.stateNode=L;e:switch(to(L,C,w),C){case"button":case"input":case"select":case"textarea":w=!!w.autoFocus;break e;case"img":w=!0;break e;default:w=!1}w&&Ia(d)}}return Tr(d),hc(d,d.type,s===null?null:s.memoizedProps,d.pendingProps,g),null;case 6:if(s&&d.stateNode!=null)s.memoizedProps!==w&&Ia(d);else{if(typeof w!="string"&&d.stateNode===null)throw Error(oe(166));if(s=En.current,yl(d)){if(s=d.stateNode,g=d.memoizedProps,w=null,C=na,C!==null)switch(C.tag){case 27:case 5:w=C.memoizedProps}s[G]=d,s=!!(s.nodeValue===g||w!==null&&w.suppressHydrationWarning===!0||mf(s.nodeValue,g)),s||fs(d,!0)}else s=dp(s).createTextNode(w),s[G]=d,d.stateNode=s}return Tr(d),null;case 31:if(g=d.memoizedState,s===null||s.memoizedState!==null){if(w=yl(d),g!==null){if(s===null){if(!w)throw Error(oe(318));if(s=d.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(oe(557));s[G]=d}else ps(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;Tr(d),s=!1}else g=Ld(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=g),s=!0;if(!s)return d.flags&256?(ja(d),d):(ja(d),null);if((d.flags&128)!==0)throw Error(oe(558))}return Tr(d),null;case 13:if(w=d.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(C=yl(d),w!==null&&w.dehydrated!==null){if(s===null){if(!C)throw Error(oe(318));if(C=d.memoizedState,C=C!==null?C.dehydrated:null,!C)throw Error(oe(317));C[G]=d}else ps(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;Tr(d),C=!1}else C=Ld(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=C),C=!0;if(!C)return d.flags&256?(ja(d),d):(ja(d),null)}return ja(d),(d.flags&128)!==0?(d.lanes=g,d):(g=w!==null,s=s!==null&&s.memoizedState!==null,g&&(w=d.child,C=null,w.alternate!==null&&w.alternate.memoizedState!==null&&w.alternate.memoizedState.cachePool!==null&&(C=w.alternate.memoizedState.cachePool.pool),L=null,w.memoizedState!==null&&w.memoizedState.cachePool!==null&&(L=w.memoizedState.cachePool.pool),L!==C&&(w.flags|=2048)),g!==s&&g&&(d.child.flags|=8192),ah(d,d.updateQueue),Tr(d),null);case 4:return Li(),s===null&&fa(d.stateNode.containerInfo),Tr(d),null;case 10:return Hs(d.type),Tr(d),null;case 19:if(Pt(Yr),w=d.memoizedState,w===null)return Tr(d),null;if(C=(d.flags&128)!==0,L=w.rendering,L===null)if(C)oh(w,!1);else{if(fi!==0||s!==null&&(s.flags&128)!==0)for(s=d.child;s!==null;){if(L=Js(s),L!==null){for(d.flags|=128,oh(w,!1),s=L.updateQueue,d.updateQueue=s,ah(d,s),d.subtreeFlags=0,s=g,g=d.child;g!==null;)Dc(g,s),g=g.sibling;return qt(Yr,Yr.current&1|2),Gn&&ds(d,w.treeForkCount),d.child}s=s.sibling}w.tail!==null&&Er()>Si&&(d.flags|=128,C=!0,oh(w,!1),d.lanes=4194304)}else{if(!C)if(s=Js(L),s!==null){if(d.flags|=128,C=!0,s=s.updateQueue,d.updateQueue=s,ah(d,s),oh(w,!0),w.tail===null&&w.tailMode==="hidden"&&!L.alternate&&!Gn)return Tr(d),null}else 2*Er()-w.renderingStartTime>Si&&g!==536870912&&(d.flags|=128,C=!0,oh(w,!1),d.lanes=4194304);w.isBackwards?(L.sibling=d.child,d.child=L):(s=w.last,s!==null?s.sibling=L:d.child=L,w.last=L)}return w.tail!==null?(s=w.tail,w.rendering=s,w.tail=s.sibling,w.renderingStartTime=Er(),s.sibling=null,g=Yr.current,qt(Yr,C?g&1|2:g&1),Gn&&ds(d,w.treeForkCount),s):(Tr(d),null);case 22:case 23:return ja(d),Yo(),w=d.memoizedState!==null,s!==null?s.memoizedState!==null!==w&&(d.flags|=8192):w&&(d.flags|=8192),w?(g&536870912)!==0&&(d.flags&128)===0&&(Tr(d),d.subtreeFlags&6&&(d.flags|=8192)):Tr(d),g=d.updateQueue,g!==null&&ah(d,g.retryQueue),g=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(g=s.memoizedState.cachePool.pool),w=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(w=d.memoizedState.cachePool.pool),w!==g&&(d.flags|=2048),s!==null&&Pt(Zs),null;case 24:return g=null,s!==null&&(g=s.memoizedState.cache),d.memoizedState.cache!==g&&(d.flags|=2048),Hs(cr),Tr(d),null;case 25:return null;case 30:return null}throw Error(oe(156,d.tag))}function ip(s,d){switch(gl(d),d.tag){case 1:return s=d.flags,s&65536?(d.flags=s&-65537|128,d):null;case 3:return Hs(cr),Li(),s=d.flags,(s&65536)!==0&&(s&128)===0?(d.flags=s&-65537|128,d):null;case 26:case 27:case 5:return Br(d),null;case 31:if(d.memoizedState!==null){if(ja(d),d.alternate===null)throw Error(oe(340));ps()}return s=d.flags,s&65536?(d.flags=s&-65537|128,d):null;case 13:if(ja(d),s=d.memoizedState,s!==null&&s.dehydrated!==null){if(d.alternate===null)throw Error(oe(340));ps()}return s=d.flags,s&65536?(d.flags=s&-65537|128,d):null;case 19:return Pt(Yr),null;case 4:return Li(),null;case 10:return Hs(d.type),null;case 22:case 23:return ja(d),Yo(),s!==null&&Pt(Zs),s=d.flags,s&65536?(d.flags=s&-65537|128,d):null;case 24:return Hs(cr),null;case 25:return null;default:return null}}function cf(s,d){switch(gl(d),d.tag){case 3:Hs(cr),Li();break;case 26:case 27:case 5:Br(d);break;case 4:Li();break;case 31:d.memoizedState!==null&&ja(d);break;case 13:ja(d);break;case 19:Pt(Yr);break;case 10:Hs(d.type);break;case 22:case 23:ja(d),Yo(),s!==null&&Pt(Zs);break;case 24:Hs(cr)}}function tu(s,d){try{var g=d.updateQueue,w=g!==null?g.lastEffect:null;if(w!==null){var C=w.next;g=C;do{if((g.tag&s)===s){w=void 0;var L=g.create,X=g.inst;w=L(),X.destroy=w}g=g.next}while(g!==C)}}catch(he){Yn(d,d.return,he)}}function gs(s,d,g){try{var w=d.updateQueue,C=w!==null?w.lastEffect:null;if(C!==null){var L=C.next;w=L;do{if((w.tag&s)===s){var X=w.inst,he=X.destroy;if(he!==void 0){X.destroy=void 0,C=d;var De=g,ht=he;try{ht()}catch(Dt){Yn(C,De,Dt)}}}w=w.next}while(w!==L)}}catch(Dt){Yn(d,d.return,Dt)}}function ud(s){var d=s.updateQueue;if(d!==null){var g=s.stateNode;try{Tl(d,g)}catch(w){Yn(s,s.return,w)}}}function sh(s,d,g){g.props=Il(s.type,s.memoizedProps),g.state=s.memoizedState;try{g.componentWillUnmount()}catch(w){Yn(s,d,w)}}function Lo(s,d){try{var g=s.ref;if(g!==null){switch(s.tag){case 26:case 27:case 5:var w=s.stateNode;break;case 30:w=s.stateNode;break;default:w=s.stateNode}typeof g=="function"?s.refCleanup=g(w):g.current=w}}catch(C){Yn(s,d,C)}}function ha(s,d){var g=s.ref,w=s.refCleanup;if(g!==null)if(typeof w=="function")try{w()}catch(C){Yn(s,d,C)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof g=="function")try{g(null)}catch(C){Yn(s,d,C)}else g.current=null}function va(s){var d=s.type,g=s.memoizedProps,w=s.stateNode;try{e:switch(d){case"button":case"input":case"select":case"textarea":g.autoFocus&&w.focus();break e;case"img":g.src?w.src=g.src:g.srcSet&&(w.srcset=g.srcSet)}}catch(C){Yn(s,s.return,C)}}function ys(s,d,g){try{var w=s.stateNode;h_(w,s.type,g,d),w[J]=d}catch(C){Yn(s,s.return,C)}}function Qo(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&au(s.type)||s.tag===4}function u1(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Qo(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&au(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function h1(s,d,g){var w=s.tag;if(w===5||w===6)s=s.stateNode,d?(g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g).insertBefore(s,d):(d=g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g,d.appendChild(s),g=g._reactRootContainer,g!=null||d.onclick!==null||(d.onclick=Vo));else if(w!==4&&(w===27&&au(s.type)&&(g=s.stateNode,d=null),s=s.child,s!==null))for(h1(s,d,g),s=s.sibling;s!==null;)h1(s,d,g),s=s.sibling}function uf(s,d,g){var w=s.tag;if(w===5||w===6)s=s.stateNode,d?g.insertBefore(s,d):g.appendChild(s);else if(w!==4&&(w===27&&au(s.type)&&(g=s.stateNode),s=s.child,s!==null))for(uf(s,d,g),s=s.sibling;s!==null;)uf(s,d,g),s=s.sibling}function np(s){var d=s.stateNode,g=s.memoizedProps;try{for(var w=s.type,C=d.attributes;C.length;)d.removeAttributeNode(C[0]);to(d,w,g),d[G]=s,d[J]=g}catch(L){Yn(s,s.return,L)}}var vs=!1,Jn=!1,c=!1,t=typeof WeakSet=="function"?WeakSet:Set,r=null;function u(s,d){if(s=s.containerInfo,tm=_d,s=Lu(s),Ns(s)){if("selectionStart"in s)var g={start:s.selectionStart,end:s.selectionEnd};else e:{g=(g=s.ownerDocument)&&g.defaultView||window;var w=g.getSelection&&g.getSelection();if(w&&w.rangeCount!==0){g=w.anchorNode;var C=w.anchorOffset,L=w.focusNode;w=w.focusOffset;try{g.nodeType,L.nodeType}catch{g=null;break e}var X=0,he=-1,De=-1,ht=0,Dt=0,Bt=s,_t=null;t:for(;;){for(var wt;Bt!==g||C!==0&&Bt.nodeType!==3||(he=X+C),Bt!==L||w!==0&&Bt.nodeType!==3||(De=X+w),Bt.nodeType===3&&(X+=Bt.nodeValue.length),(wt=Bt.firstChild)!==null;)_t=Bt,Bt=wt;for(;;){if(Bt===s)break t;if(_t===g&&++ht===C&&(he=X),_t===L&&++Dt===w&&(De=X),(wt=Bt.nextSibling)!==null)break;Bt=_t,_t=Bt.parentNode}Bt=wt}g=he===-1||De===-1?null:{start:he,end:De}}else g=null}g=g||{start:0,end:0}}else g=null;for(v1={focusedElem:s,selectionRange:g},_d=!1,r=d;r!==null;)if(d=r,s=d.child,(d.subtreeFlags&1028)!==0&&s!==null)s.return=d,r=s;else for(;r!==null;){switch(d=r,L=d.alternate,s=d.flags,d.tag){case 0:if((s&4)!==0&&(s=d.updateQueue,s=s!==null?s.events:null,s!==null))for(g=0;g<s.length;g++)C=s[g],C.ref.impl=C.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&L!==null){s=void 0,g=d,C=L.memoizedProps,L=L.memoizedState,w=g.stateNode;try{var mi=Il(g.type,C);s=w.getSnapshotBeforeUpdate(mi,L),w.__reactInternalSnapshotBeforeUpdate=s}catch(ji){Yn(g,g.return,ji)}}break;case 3:if((s&1024)!==0){if(s=d.stateNode.containerInfo,g=s.nodeType,g===9)pd(s);else if(g===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":pd(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(oe(163))}if(s=d.sibling,s!==null){s.return=d.return,r=s;break}r=d.return}}function p(s,d,g){var w=g.flags;switch(g.tag){case 0:case 11:case 15:K(s,g),w&4&&tu(5,g);break;case 1:if(K(s,g),w&4)if(s=g.stateNode,d===null)try{s.componentDidMount()}catch(X){Yn(g,g.return,X)}else{var C=Il(g.type,d.memoizedProps);d=d.memoizedState;try{s.componentDidUpdate(C,d,s.__reactInternalSnapshotBeforeUpdate)}catch(X){Yn(g,g.return,X)}}w&64&&ud(g),w&512&&Lo(g,g.return);break;case 3:if(K(s,g),w&64&&(s=g.updateQueue,s!==null)){if(d=null,g.child!==null)switch(g.child.tag){case 27:case 5:d=g.child.stateNode;break;case 1:d=g.child.stateNode}try{Tl(s,d)}catch(X){Yn(g,g.return,X)}}break;case 27:d===null&&w&4&&np(g);case 26:case 5:K(s,g),d===null&&w&4&&va(g),w&512&&Lo(g,g.return);break;case 12:K(s,g);break;case 31:K(s,g),w&4&&I(s,g);break;case 13:K(s,g),w&4&&P(s,g),w&64&&(s=g.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(g=Xp.bind(null,g),ou(s,g))));break;case 22:if(w=g.memoizedState!==null||vs,!w){d=d!==null&&d.memoizedState!==null||Jn,C=vs;var L=Jn;vs=w,(Jn=d)&&!L?se(s,g,(g.subtreeFlags&8772)!==0):K(s,g),vs=C,Jn=L}break;case 30:break;default:K(s,g)}}function _(s){var d=s.alternate;d!==null&&(s.alternate=null,_(d)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(d=s.stateNode,d!==null&&ct(d)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var y=null,b=!1;function T(s,d,g){for(g=g.child;g!==null;)M(s,d,g),g=g.sibling}function M(s,d,g){if(Vn&&typeof Vn.onCommitFiberUnmount=="function")try{Vn.onCommitFiberUnmount(Cs,g)}catch{}switch(g.tag){case 26:Jn||ha(g,d),T(s,d,g),g.memoizedState?g.memoizedState.count--:g.stateNode&&(g=g.stateNode,g.parentNode.removeChild(g));break;case 27:Jn||ha(g,d);var w=y,C=b;au(g.type)&&(y=g.stateNode,b=!1),T(s,d,g),uh(g.stateNode),y=w,b=C;break;case 5:Jn||ha(g,d);case 6:if(w=y,C=b,y=null,T(s,d,g),y=w,b=C,y!==null)if(b)try{(y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y).removeChild(g.stateNode)}catch(L){Yn(g,d,L)}else try{y.removeChild(g.stateNode)}catch(L){Yn(g,d,L)}break;case 18:y!==null&&(b?(s=y,yf(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,g.stateNode),hu(s)):yf(y,g.stateNode));break;case 4:w=y,C=b,y=g.stateNode.containerInfo,b=!0,T(s,d,g),y=w,b=C;break;case 0:case 11:case 14:case 15:gs(2,g,d),Jn||gs(4,g,d),T(s,d,g);break;case 1:Jn||(ha(g,d),w=g.stateNode,typeof w.componentWillUnmount=="function"&&sh(g,d,w)),T(s,d,g);break;case 21:T(s,d,g);break;case 22:Jn=(w=Jn)||g.memoizedState!==null,T(s,d,g),Jn=w;break;default:T(s,d,g)}}function I(s,d){if(d.memoizedState===null&&(s=d.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{hu(s)}catch(g){Yn(d,d.return,g)}}}function P(s,d){if(d.memoizedState===null&&(s=d.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{hu(s)}catch(g){Yn(d,d.return,g)}}function z(s){switch(s.tag){case 31:case 13:case 19:var d=s.stateNode;return d===null&&(d=s.stateNode=new t),d;case 22:return s=s.stateNode,d=s._retryCache,d===null&&(d=s._retryCache=new t),d;default:throw Error(oe(435,s.tag))}}function O(s,d){var g=z(s);d.forEach(function(w){if(!g.has(w)){g.add(w);var C=p1.bind(null,s,w);w.then(C,C)}})}function B(s,d){var g=d.deletions;if(g!==null)for(var w=0;w<g.length;w++){var C=g[w],L=s,X=d,he=X;e:for(;he!==null;){switch(he.tag){case 27:if(au(he.type)){y=he.stateNode,b=!1;break e}break;case 5:y=he.stateNode,b=!1;break e;case 3:case 4:y=he.stateNode.containerInfo,b=!0;break e}he=he.return}if(y===null)throw Error(oe(160));M(L,X,C),y=null,b=!1,L=C.alternate,L!==null&&(L.return=null),C.return=null}if(d.subtreeFlags&13886)for(d=d.child;d!==null;)H(d,s),d=d.sibling}var N=null;function H(s,d){var g=s.alternate,w=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:B(d,s),j(s),w&4&&(gs(3,s,s.return),tu(3,s),gs(5,s,s.return));break;case 1:B(d,s),j(s),w&512&&(Jn||g===null||ha(g,g.return)),w&64&&vs&&(s=s.updateQueue,s!==null&&(w=s.callbacks,w!==null&&(g=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=g===null?w:g.concat(w))));break;case 26:var C=N;if(B(d,s),j(s),w&512&&(Jn||g===null||ha(g,g.return)),w&4){var L=g!==null?g.memoizedState:null;if(w=s.memoizedState,g===null)if(w===null)if(s.stateNode===null){e:{w=s.type,g=s.memoizedProps,C=C.ownerDocument||C;t:switch(w){case"title":L=C.getElementsByTagName("title")[0],(!L||L[Ce]||L[G]||L.namespaceURI==="http://www.w3.org/2000/svg"||L.hasAttribute("itemprop"))&&(L=C.createElement(w),C.head.insertBefore(L,C.querySelector("head > title"))),to(L,w,g),L[G]=s,Gt(L),w=L;break e;case"link":var X=E1("link","href",C).get(w+(g.href||""));if(X){for(var he=0;he<X.length;he++)if(L=X[he],L.getAttribute("href")===(g.href==null||g.href===""?null:g.href)&&L.getAttribute("rel")===(g.rel==null?null:g.rel)&&L.getAttribute("title")===(g.title==null?null:g.title)&&L.getAttribute("crossorigin")===(g.crossOrigin==null?null:g.crossOrigin)){X.splice(he,1);break t}}L=C.createElement(w),to(L,w,g),C.head.appendChild(L);break;case"meta":if(X=E1("meta","content",C).get(w+(g.content||""))){for(he=0;he<X.length;he++)if(L=X[he],L.getAttribute("content")===(g.content==null?null:""+g.content)&&L.getAttribute("name")===(g.name==null?null:g.name)&&L.getAttribute("property")===(g.property==null?null:g.property)&&L.getAttribute("http-equiv")===(g.httpEquiv==null?null:g.httpEquiv)&&L.getAttribute("charset")===(g.charSet==null?null:g.charSet)){X.splice(he,1);break t}}L=C.createElement(w),to(L,w,g),C.head.appendChild(L);break;default:throw Error(oe(468,w))}L[G]=s,Gt(L),w=L}s.stateNode=w}else dm(C,s.type,s.stateNode);else s.stateNode=hm(C,w,s.memoizedProps);else L!==w?(L===null?g.stateNode!==null&&(g=g.stateNode,g.parentNode.removeChild(g)):L.count--,w===null?dm(C,s.type,s.stateNode):hm(C,w,s.memoizedProps)):w===null&&s.stateNode!==null&&ys(s,s.memoizedProps,g.memoizedProps)}break;case 27:B(d,s),j(s),w&512&&(Jn||g===null||ha(g,g.return)),g!==null&&w&4&&ys(s,s.memoizedProps,g.memoizedProps);break;case 5:if(B(d,s),j(s),w&512&&(Jn||g===null||ha(g,g.return)),s.flags&32){C=s.stateNode;try{Ds(C,"")}catch(mi){Yn(s,s.return,mi)}}w&4&&s.stateNode!=null&&(C=s.memoizedProps,ys(s,C,g!==null?g.memoizedProps:C)),w&1024&&(c=!0);break;case 6:if(B(d,s),j(s),w&4){if(s.stateNode===null)throw Error(oe(162));w=s.memoizedProps,g=s.stateNode;try{g.nodeValue=w}catch(mi){Yn(s,s.return,mi)}}break;case 3:if(Tf=null,C=N,N=vf(d.containerInfo),B(d,s),N=C,j(s),w&4&&g!==null&&g.memoizedState.isDehydrated)try{hu(d.containerInfo)}catch(mi){Yn(s,s.return,mi)}c&&(c=!1,Z(s));break;case 4:w=N,N=vf(s.stateNode.containerInfo),B(d,s),j(s),N=w;break;case 12:B(d,s),j(s);break;case 31:B(d,s),j(s),w&4&&(w=s.updateQueue,w!==null&&(s.updateQueue=null,O(s,w)));break;case 13:B(d,s),j(s),s.child.flags&8192&&s.memoizedState!==null!=(g!==null&&g.memoizedState!==null)&&(yi=Er()),w&4&&(w=s.updateQueue,w!==null&&(s.updateQueue=null,O(s,w)));break;case 22:C=s.memoizedState!==null;var De=g!==null&&g.memoizedState!==null,ht=vs,Dt=Jn;if(vs=ht||C,Jn=Dt||De,B(d,s),Jn=Dt,vs=ht,j(s),w&8192)e:for(d=s.stateNode,d._visibility=C?d._visibility&-2:d._visibility|1,C&&(g===null||De||vs||Jn||W(s)),g=null,d=s;;){if(d.tag===5||d.tag===26){if(g===null){De=g=d;try{if(L=De.stateNode,C)X=L.style,typeof X.setProperty=="function"?X.setProperty("display","none","important"):X.display="none";else{he=De.stateNode;var Bt=De.memoizedProps.style,_t=Bt!=null&&Bt.hasOwnProperty("display")?Bt.display:null;he.style.display=_t==null||typeof _t=="boolean"?"":(""+_t).trim()}}catch(mi){Yn(De,De.return,mi)}}}else if(d.tag===6){if(g===null){De=d;try{De.stateNode.nodeValue=C?"":De.memoizedProps}catch(mi){Yn(De,De.return,mi)}}}else if(d.tag===18){if(g===null){De=d;try{var wt=De.stateNode;C?pp(wt,!0):pp(De.stateNode,!1)}catch(mi){Yn(De,De.return,mi)}}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===s)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===s)break e;for(;d.sibling===null;){if(d.return===null||d.return===s)break e;g===d&&(g=null),d=d.return}g===d&&(g=null),d.sibling.return=d.return,d=d.sibling}w&4&&(w=s.updateQueue,w!==null&&(g=w.retryQueue,g!==null&&(w.retryQueue=null,O(s,g))));break;case 19:B(d,s),j(s),w&4&&(w=s.updateQueue,w!==null&&(s.updateQueue=null,O(s,w)));break;case 30:break;case 21:break;default:B(d,s),j(s)}}function j(s){var d=s.flags;if(d&2){try{for(var g,w=s.return;w!==null;){if(Qo(w)){g=w;break}w=w.return}if(g==null)throw Error(oe(160));switch(g.tag){case 27:var C=g.stateNode,L=u1(s);uf(s,L,C);break;case 5:var X=g.stateNode;g.flags&32&&(Ds(X,""),g.flags&=-33);var he=u1(s);uf(s,he,X);break;case 3:case 4:var De=g.stateNode.containerInfo,ht=u1(s);h1(s,ht,De);break;default:throw Error(oe(161))}}catch(Dt){Yn(s,s.return,Dt)}s.flags&=-3}d&4096&&(s.flags&=-4097)}function Z(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var d=s;Z(d),d.tag===5&&d.flags&1024&&d.stateNode.reset(),s=s.sibling}}function K(s,d){if(d.subtreeFlags&8772)for(d=d.child;d!==null;)p(s,d.alternate,d),d=d.sibling}function W(s){for(s=s.child;s!==null;){var d=s;switch(d.tag){case 0:case 11:case 14:case 15:gs(4,d,d.return),W(d);break;case 1:ha(d,d.return);var g=d.stateNode;typeof g.componentWillUnmount=="function"&&sh(d,d.return,g),W(d);break;case 27:uh(d.stateNode);case 26:case 5:ha(d,d.return),W(d);break;case 22:d.memoizedState===null&&W(d);break;case 30:W(d);break;default:W(d)}s=s.sibling}}function se(s,d,g){for(g=g&&(d.subtreeFlags&8772)!==0,d=d.child;d!==null;){var w=d.alternate,C=s,L=d,X=L.flags;switch(L.tag){case 0:case 11:case 15:se(C,L,g),tu(4,L);break;case 1:if(se(C,L,g),w=L,C=w.stateNode,typeof C.componentDidMount=="function")try{C.componentDidMount()}catch(ht){Yn(w,w.return,ht)}if(w=L,C=w.updateQueue,C!==null){var he=w.stateNode;try{var De=C.shared.hiddenCallbacks;if(De!==null)for(C.shared.hiddenCallbacks=null,C=0;C<De.length;C++)$1(De[C],he)}catch(ht){Yn(w,w.return,ht)}}g&&X&64&&ud(L),Lo(L,L.return);break;case 27:np(L);case 26:case 5:se(C,L,g),g&&w===null&&X&4&&va(L),Lo(L,L.return);break;case 12:se(C,L,g);break;case 31:se(C,L,g),g&&X&4&&I(C,L);break;case 13:se(C,L,g),g&&X&4&&P(C,L);break;case 22:L.memoizedState===null&&se(C,L,g),Lo(L,L.return);break;case 30:break;default:se(C,L,g)}d=d.sibling}}function Q(s,d){var g=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(g=s.memoizedState.cachePool.pool),s=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(s=d.memoizedState.cachePool.pool),s!==g&&(s!=null&&s.refCount++,g!=null&&vl(g))}function ce(s,d){s=null,d.alternate!==null&&(s=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==s&&(d.refCount++,s!=null&&vl(s))}function ie(s,d,g,w){if(d.subtreeFlags&10256)for(d=d.child;d!==null;)te(s,d,g,w),d=d.sibling}function te(s,d,g,w){var C=d.flags;switch(d.tag){case 0:case 11:case 15:ie(s,d,g,w),C&2048&&tu(9,d);break;case 1:ie(s,d,g,w);break;case 3:ie(s,d,g,w),C&2048&&(s=null,d.alternate!==null&&(s=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==s&&(d.refCount++,s!=null&&vl(s)));break;case 12:if(C&2048){ie(s,d,g,w),s=d.stateNode;try{var L=d.memoizedProps,X=L.id,he=L.onPostCommit;typeof he=="function"&&he(X,d.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(De){Yn(d,d.return,De)}}else ie(s,d,g,w);break;case 31:ie(s,d,g,w);break;case 13:ie(s,d,g,w);break;case 23:break;case 22:L=d.stateNode,X=d.alternate,d.memoizedState!==null?L._visibility&2?ie(s,d,g,w):we(s,d):L._visibility&2?ie(s,d,g,w):(L._visibility|=2,ue(s,d,g,w,(d.subtreeFlags&10256)!==0||!1)),C&2048&&Q(X,d);break;case 24:ie(s,d,g,w),C&2048&&ce(d.alternate,d);break;default:ie(s,d,g,w)}}function ue(s,d,g,w,C){for(C=C&&((d.subtreeFlags&10256)!==0||!1),d=d.child;d!==null;){var L=s,X=d,he=g,De=w,ht=X.flags;switch(X.tag){case 0:case 11:case 15:ue(L,X,he,De,C),tu(8,X);break;case 23:break;case 22:var Dt=X.stateNode;X.memoizedState!==null?Dt._visibility&2?ue(L,X,he,De,C):we(L,X):(Dt._visibility|=2,ue(L,X,he,De,C)),C&&ht&2048&&Q(X.alternate,X);break;case 24:ue(L,X,he,De,C),C&&ht&2048&&ce(X.alternate,X);break;default:ue(L,X,he,De,C)}d=d.sibling}}function we(s,d){if(d.subtreeFlags&10256)for(d=d.child;d!==null;){var g=s,w=d,C=w.flags;switch(w.tag){case 22:we(g,w),C&2048&&Q(w.alternate,w);break;case 24:we(g,w),C&2048&&ce(w.alternate,w);break;default:we(g,w)}d=d.sibling}}var ve=8192;function Oe(s,d,g){if(s.subtreeFlags&ve)for(s=s.child;s!==null;)ze(s,d,g),s=s.sibling}function ze(s,d,g){switch(s.tag){case 26:Oe(s,d,g),s.flags&ve&&s.memoizedState!==null&&y0(g,N,s.memoizedState,s.memoizedProps);break;case 5:Oe(s,d,g);break;case 3:case 4:var w=N;N=vf(s.stateNode.containerInfo),Oe(s,d,g),N=w;break;case 22:s.memoizedState===null&&(w=s.alternate,w!==null&&w.memoizedState!==null?(w=ve,ve=16777216,Oe(s,d,g),ve=w):Oe(s,d,g));break;default:Oe(s,d,g)}}function je(s){var d=s.alternate;if(d!==null&&(s=d.child,s!==null)){d.child=null;do d=s.sibling,s.sibling=null,s=d;while(s!==null)}}function lt(s){var d=s.deletions;if((s.flags&16)!==0){if(d!==null)for(var g=0;g<d.length;g++){var w=d[g];r=w,Ge(w,s)}je(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Me(s),s=s.sibling}function Me(s){switch(s.tag){case 0:case 11:case 15:lt(s),s.flags&2048&&gs(9,s,s.return);break;case 3:lt(s);break;case 12:lt(s);break;case 22:var d=s.stateNode;s.memoizedState!==null&&d._visibility&2&&(s.return===null||s.return.tag!==13)?(d._visibility&=-3,ge(s)):lt(s);break;default:lt(s)}}function ge(s){var d=s.deletions;if((s.flags&16)!==0){if(d!==null)for(var g=0;g<d.length;g++){var w=d[g];r=w,Ge(w,s)}je(s)}for(s=s.child;s!==null;){switch(d=s,d.tag){case 0:case 11:case 15:gs(8,d,d.return),ge(d);break;case 22:g=d.stateNode,g._visibility&2&&(g._visibility&=-3,ge(d));break;default:ge(d)}s=s.sibling}}function Ge(s,d){for(;r!==null;){var g=r;switch(g.tag){case 0:case 11:case 15:gs(8,g,d);break;case 23:case 22:if(g.memoizedState!==null&&g.memoizedState.cachePool!==null){var w=g.memoizedState.cachePool.pool;w!=null&&w.refCount++}break;case 24:vl(g.memoizedState.cache)}if(w=g.child,w!==null)w.return=g,r=w;else e:for(g=s;r!==null;){w=r;var C=w.sibling,L=w.return;if(_(w),w===g){r=null;break e}if(C!==null){C.return=L,r=C;break e}r=L}}}var Re={getCacheForType:function(s){var d=Vr(cr),g=d.data.get(s);return g===void 0&&(g=s(),d.data.set(s,g)),g},cacheSignal:function(){return Vr(cr).controller.signal}},it=typeof WeakMap=="function"?WeakMap:Map,Je=0,vt=null,Ze=null,$e=0,xt=0,Mt=null,St=!1,Rt=!1,Kt=!1,Ti=0,fi=0,Qi=0,Qt=0,Ni=0,oi=0,en=0,Fi=null,Zi=null,Xi=!1,yi=0,an=0,Si=1/0,Mn=null,Vi=null,$t=0,Ri=null,Dn=null,kn=0,Wn=0,rr=null,qa=null,da=0,ra=null;function vr(){return(Je&2)!==0&&$e!==0?$e&-$e:yt.T!==null?cp():xu()}function go(){if(oi===0)if(($e&536870912)===0||Gn){var s=ta;ta<<=1,(ta&3932160)===0&&(ta=262144),oi=s}else oi=536870912;return s=La.current,s!==null&&(s.flags|=32),oi}function ur(s,d,g){(s===vt&&(xt===2||xt===9)||s.cancelPendingCommit!==null)&&(ar(s,0),Pn(s,$e,oi,!1)),nt(s,g),((Je&2)===0||s!==vt)&&(s===vt&&((Je&2)===0&&(Qt|=g),fi===4&&Pn(s,$e,oi,!1)),eo(s))}function yo(s,d,g){if((Je&6)!==0)throw Error(oe(327));var w=!g&&(d&127)===0&&(d&s.expiredLanes)===0||Nl(s,d),C=w?Fo(s,d):dc(s,d,!0),L=w;do{if(C===0){Rt&&!w&&Pn(s,d,0,!1);break}else{if(g=s.current.alternate,L&&!aa(g)){C=dc(s,d,!1),L=!1;continue}if(C===2){if(L=d,s.errorRecoveryDisabledLanes&L)var X=0;else X=s.pendingLanes&-536870913,X=X!==0?X:X&536870912?536870912:0;if(X!==0){d=X;e:{var he=s;C=Fi;var De=he.current.memoizedState.isDehydrated;if(De&&(ar(he,X).flags|=256),X=dc(he,X,!1),X!==2){if(Kt&&!De){he.errorRecoveryDisabledLanes|=L,Qt|=L,C=4;break e}L=Zi,Zi=C,L!==null&&(Zi===null?Zi=L:Zi.push.apply(Zi,L))}C=X}if(L=!1,C!==2)continue}}if(C===1){ar(s,0),Pn(s,d,0,!0);break}e:{switch(w=s,L=C,L){case 0:case 1:throw Error(oe(345));case 4:if((d&4194048)!==d)break;case 6:Pn(w,d,oi,!St);break e;case 2:Zi=null;break;case 3:case 5:break;default:throw Error(oe(329))}if((d&62914560)===d&&(C=yi+300-Er(),10<C)){if(Pn(w,d,oi,!St),Ba(w,0,!0)!==0)break e;kn=d,w.timeoutHandle=rm(Oo.bind(null,w,g,Zi,Mn,Xi,d,oi,Qt,en,St,L,"Throttled",-0,0),C);break e}Oo(w,g,Zi,Mn,Xi,d,oi,Qt,en,St,L,null,-0,0)}}break}while(!0);eo(s)}function Oo(s,d,g,w,C,L,X,he,De,ht,Dt,Bt,_t,wt){if(s.timeoutHandle=-1,Bt=d.subtreeFlags,Bt&8192||(Bt&16785408)===16785408){Bt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Vo},ze(d,L,Bt);var mi=(L&62914560)===L?yi-Er():(L&4194048)===L?an-Er():0;if(mi=fm(Bt,mi),mi!==null){kn=L,s.cancelPendingCommit=mi(Ym.bind(null,s,d,L,g,w,C,X,he,De,Dt,Bt,null,_t,wt)),Pn(s,L,X,!ht);return}}Ym(s,d,L,g,w,C,X,he,De)}function aa(s){for(var d=s;;){var g=d.tag;if((g===0||g===11||g===15)&&d.flags&16384&&(g=d.updateQueue,g!==null&&(g=g.stores,g!==null)))for(var w=0;w<g.length;w++){var C=g[w],L=C.getSnapshot;C=C.value;try{if(!Ea(L(),C))return!1}catch{return!1}}if(g=d.child,d.subtreeFlags&16384&&g!==null)g.return=d,d=g;else{if(d===s)break;for(;d.sibling===null;){if(d.return===null||d.return===s)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function Pn(s,d,g,w){d&=~Ni,d&=~Qt,s.suspendedLanes|=d,s.pingedLanes&=~d,w&&(s.warmLanes|=d),w=s.expirationTimes;for(var C=d;0<C;){var L=31-ba(C),X=1<<L;w[L]=-1,C&=~X}g!==0&&yu(s,g,d)}function hr(){return(Je&6)===0?(df(0),!1):!0}function wn(){if(Ze!==null){if(xt===0)var s=Ze.return;else s=Ze,$o=Xo=null,Qs(s),Kl=null,ju=0,s=Ze;for(;s!==null;)cf(s.alternate,s),s=s.return;Ze=null}}function ar(s,d){var g=s.timeoutHandle;g!==-1&&(s.timeoutHandle=-1,fp(g)),g=s.cancelPendingCommit,g!==null&&(s.cancelPendingCommit=null,g()),kn=0,wn(),vt=s,Ze=g=Ai(s.current,null),$e=d,xt=0,Mt=null,St=!1,Rt=Nl(s,d),Kt=!1,en=oi=Ni=Qt=Qi=fi=0,Zi=Fi=null,Xi=!1,(d&8)!==0&&(d|=d&32);var w=s.entangledLanes;if(w!==0)for(s=s.entanglements,w&=d;0<w;){var C=31-ba(w),L=1<<C;d|=s[C],w&=~L}return Ti=d,zc(),g}function Jr(s,d){st=null,yt.H=Kc,d===kc||d===Nd?(d=Xf(),xt=3):d===kd?(d=Xf(),xt=4):xt=d===uc?8:d!==null&&typeof d=="object"&&typeof d.then=="function"?6:1,Mt=d,Ze===null&&(fi=1,cc(s,fo(d,s.current)))}function or(){var s=La.current;return s===null?!0:($e&4194048)===$e?ga===null:($e&62914560)===$e||($e&536870912)!==0?s===ga:!1}function vo(){var s=yt.H;return yt.H=Kc,s===null?Kc:s}function iu(){var s=yt.A;return yt.A=Re,s}function es(){fi=4,St||($e&4194048)!==$e&&La.current!==null||(Rt=!0),(Qi&134217727)===0&&(Qt&134217727)===0||vt===null||Pn(vt,$e,oi,!1)}function dc(s,d,g){var w=Je;Je|=2;var C=vo(),L=iu();(vt!==s||$e!==d)&&(Mn=null,ar(s,d)),d=!1;var X=fi;e:do try{if(xt!==0&&Ze!==null){var he=Ze,De=Mt;switch(xt){case 8:wn(),X=6;break e;case 3:case 2:case 9:case 6:La.current===null&&(d=!0);var ht=xt;if(xt=0,Mt=null,ts(s,he,De,ht),g&&Rt){X=0;break e}break;default:ht=xt,xt=0,Mt=null,ts(s,he,De,ht)}}lh(),X=fi;break}catch(Dt){Jr(s,Dt)}while(!0);return d&&s.shellSuspendCounter++,$o=Xo=null,Je=w,yt.H=C,yt.A=L,Ze===null&&(vt=null,$e=0,zc()),X}function lh(){for(;Ze!==null;)Gr(Ze)}function Fo(s,d){var g=Je;Je|=2;var w=vo(),C=iu();vt!==s||$e!==d?(Mn=null,Si=Er()+500,ar(s,d)):Rt=Nl(s,d);e:do try{if(xt!==0&&Ze!==null){d=Ze;var L=Mt;t:switch(xt){case 1:xt=0,Mt=null,ts(s,d,L,1);break;case 2:case 9:if(X1(L)){xt=0,Mt=null,xo(d);break}d=function(){xt!==2&&xt!==9||vt!==s||(xt=7),eo(s)},L.then(d,d);break e;case 3:xt=7;break e;case 4:xt=5;break e;case 7:X1(L)?(xt=0,Mt=null,xo(d)):(xt=0,Mt=null,ts(s,d,L,7));break;case 5:var X=null;switch(Ze.tag){case 26:X=Ze.memoizedState;case 5:case 27:var he=Ze;if(X?vp(X):he.stateNode.complete){xt=0,Mt=null;var De=he.sibling;if(De!==null)Ze=De;else{var ht=he.return;ht!==null?(Ze=ht,hd(ht)):Ze=null}break t}}xt=0,Mt=null,ts(s,d,L,5);break;case 6:xt=0,Mt=null,ts(s,d,L,6);break;case 8:wn(),fi=6;break e;default:throw Error(oe(462))}}nl();break}catch(Dt){Jr(s,Dt)}while(!0);return $o=Xo=null,yt.H=w,yt.A=C,Je=g,Ze!==null?0:(vt=null,$e=0,zc(),fi)}function nl(){for(;Ze!==null&&!Fl();)Gr(Ze)}function Gr(s){var d=Mr(s.alternate,s,Ti);s.memoizedProps=s.pendingProps,d===null?hd(s):Ze=d}function xo(s){var d=s,g=d.alternate;switch(d.tag){case 15:case 0:d=i1(g,d,d.pendingProps,d.type,void 0,$e);break;case 11:d=i1(g,d,d.pendingProps,d.type.render,d.ref,$e);break;case 5:Qs(d);default:cf(g,d),d=Ze=Dc(d,Ti),d=Mr(g,d,Ti)}s.memoizedProps=s.pendingProps,d===null?hd(s):Ze=d}function ts(s,d,g,w){$o=Xo=null,Qs(d),Kl=null,ju=0;var C=d.return;try{if(tf(s,C,d,g,$e)){fi=1,cc(s,fo(g,s.current)),Ze=null;return}}catch(L){if(C!==null)throw Ze=C,L;fi=1,cc(s,fo(g,s.current)),Ze=null;return}d.flags&32768?(Gn||w===1?s=!0:Rt||($e&536870912)!==0?s=!1:(St=s=!0,(w===2||w===9||w===3||w===6)&&(w=La.current,w!==null&&w.tag===13&&(w.flags|=16384))),dd(d,s)):hd(d)}function hd(s){var d=s;do{if((d.flags&32768)!==0){dd(d,St);return}s=d.return;var g=Hp(d.alternate,d,Ti);if(g!==null){Ze=g;return}if(d=d.sibling,d!==null){Ze=d;return}Ze=d=s}while(d!==null);fi===0&&(fi=5)}function dd(s,d){do{var g=ip(s.alternate,s);if(g!==null){g.flags&=32767,Ze=g;return}if(g=s.return,g!==null&&(g.flags|=32768,g.subtreeFlags=0,g.deletions=null),!d&&(s=s.sibling,s!==null)){Ze=s;return}Ze=s=g}while(s!==null);fi=6,Ze=null}function Ym(s,d,g,w,C,L,X,he,De){s.cancelPendingCommit=null;do rp();while($t!==0);if((Je&6)!==0)throw Error(oe(327));if(d!==null){if(d===s.current)throw Error(oe(177));if(L=d.lanes|d.childLanes,L|=Ka,ll(s,g,L,X,he,De),s===vt&&(Ze=vt=null,$e=0),Dn=d,Ri=s,kn=g,Wn=L,rr=C,qa=w,(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,sp(Ms,function(){return ap(),null})):(s.callbackNode=null,s.callbackPriority=0),w=(d.flags&13878)!==0,(d.subtreeFlags&13878)!==0||w){w=yt.T,yt.T=null,C=jt.p,jt.p=2,X=Je,Je|=4;try{u(s,d,g)}finally{Je=X,jt.p=C,yt.T=w}}$t=1,qp(),d1(),Km()}}function qp(){if($t===1){$t=0;var s=Ri,d=Dn,g=(d.flags&13878)!==0;if((d.subtreeFlags&13878)!==0||g){g=yt.T,yt.T=null;var w=jt.p;jt.p=2;var C=Je;Je|=4;try{H(d,s);var L=v1,X=Lu(s.containerInfo),he=L.focusedElem,De=L.selectionRange;if(X!==he&&he&&he.ownerDocument&&H1(he.ownerDocument.documentElement,he)){if(De!==null&&Ns(he)){var ht=De.start,Dt=De.end;if(Dt===void 0&&(Dt=ht),"selectionStart"in he)he.selectionStart=ht,he.selectionEnd=Math.min(Dt,he.value.length);else{var Bt=he.ownerDocument||document,_t=Bt&&Bt.defaultView||window;if(_t.getSelection){var wt=_t.getSelection(),mi=he.textContent.length,ji=Math.min(De.start,mi),Ir=De.end===void 0?ji:Math.min(De.end,mi);!wt.extend&&ji>Ir&&(X=Ir,Ir=ji,ji=X);var Qe=G1(he,ji),Ne=G1(he,Ir);if(Qe&&Ne&&(wt.rangeCount!==1||wt.anchorNode!==Qe.node||wt.anchorOffset!==Qe.offset||wt.focusNode!==Ne.node||wt.focusOffset!==Ne.offset)){var dt=Bt.createRange();dt.setStart(Qe.node,Qe.offset),wt.removeAllRanges(),ji>Ir?(wt.addRange(dt),wt.extend(Ne.node,Ne.offset)):(dt.setEnd(Ne.node,Ne.offset),wt.addRange(dt))}}}}for(Bt=[],wt=he;wt=wt.parentNode;)wt.nodeType===1&&Bt.push({element:wt,left:wt.scrollLeft,top:wt.scrollTop});for(typeof he.focus=="function"&&he.focus(),he=0;he<Bt.length;he++){var Ot=Bt[he];Ot.element.scrollLeft=Ot.left,Ot.element.scrollTop=Ot.top}}_d=!!tm,v1=tm=null}finally{Je=C,jt.p=w,yt.T=g}}s.current=d,$t=2}}function d1(){if($t===2){$t=0;var s=Ri,d=Dn,g=(d.flags&8772)!==0;if((d.subtreeFlags&8772)!==0||g){g=yt.T,yt.T=null;var w=jt.p;jt.p=2;var C=Je;Je|=4;try{p(s,d.alternate,d)}finally{Je=C,jt.p=w,yt.T=g}}$t=3}}function Km(){if($t===4||$t===3){$t=0,_h();var s=Ri,d=Dn,g=kn,w=qa;(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?$t=5:($t=0,Dn=Ri=null,Zp(s,s.pendingLanes));var C=s.pendingLanes;if(C===0&&(Vi=null),yh(g),d=d.stateNode,Vn&&typeof Vn.onCommitFiberRoot=="function")try{Vn.onCommitFiberRoot(Cs,d,void 0,(d.current.flags&128)===128)}catch{}if(w!==null){d=yt.T,C=jt.p,jt.p=2,yt.T=null;try{for(var L=s.onRecoverableError,X=0;X<w.length;X++){var he=w[X];L(he.value,{componentStack:he.stack})}}finally{yt.T=d,jt.p=C}}(kn&3)!==0&&rp(),eo(s),C=s.pendingLanes,(g&261930)!==0&&(C&42)!==0?s===ra?da++:(da=0,ra=s):da=0,df(0)}}function Zp(s,d){(s.pooledCacheLanes&=d)===0&&(d=s.pooledCache,d!=null&&(s.pooledCache=null,vl(d)))}function rp(){return qp(),d1(),Km(),ap()}function ap(){if($t!==5)return!1;var s=Ri,d=Wn;Wn=0;var g=yh(kn),w=yt.T,C=jt.p;try{jt.p=32>g?32:g,yt.T=null,g=rr,rr=null;var L=Ri,X=kn;if($t=0,Dn=Ri=null,kn=0,(Je&6)!==0)throw Error(oe(331));var he=Je;if(Je|=4,Me(L.current),te(L,L.current,X,g),Je=he,df(0,!1),Vn&&typeof Vn.onPostCommitFiberRoot=="function")try{Vn.onPostCommitFiberRoot(Cs,L)}catch{}return!0}finally{jt.p=C,yt.T=w,Zp(s,d)}}function Cl(s,d,g){d=fo(g,d),d=il(s.stateNode,d,2),s=Ws(s,d,2),s!==null&&(nt(s,2),eo(s))}function Yn(s,d,g){if(s.tag===3)Cl(s,s,g);else for(;d!==null;){if(d.tag===3){Cl(d,s,g);break}else if(d.tag===1){var w=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof w.componentDidCatch=="function"&&(Vi===null||!Vi.has(w))){s=fo(g,s),g=ef(2),w=Ws(d,g,2),w!==null&&(sd(g,w,d,s),nt(w,2),eo(w));break}}d=d.return}}function op(s,d,g){var w=s.pingCache;if(w===null){w=s.pingCache=new it;var C=new Set;w.set(d,C)}else C=w.get(d),C===void 0&&(C=new Set,w.set(d,C));C.has(g)||(Kt=!0,C.add(g),s=Jm.bind(null,s,d,g),d.then(s,s))}function Jm(s,d,g){var w=s.pingCache;w!==null&&w.delete(d),s.pingedLanes|=s.suspendedLanes&g,s.warmLanes&=~g,vt===s&&($e&g)===g&&(fi===4||fi===3&&($e&62914560)===$e&&300>Er()-yi?(Je&2)===0&&ar(s,0):Ni|=g,en===$e&&(en=0)),eo(s)}function f1(s,d){d===0&&(d=bd()),s=qo(s,d),s!==null&&(nt(s,d),eo(s))}function Xp(s){var d=s.memoizedState,g=0;d!==null&&(g=d.retryLane),f1(s,g)}function p1(s,d){var g=0;switch(s.tag){case 31:case 13:var w=s.stateNode,C=s.memoizedState;C!==null&&(g=C.retryLane);break;case 19:w=s.stateNode;break;case 22:w=s.stateNode._retryCache;break;default:throw Error(oe(314))}w!==null&&w.delete(d),f1(s,g)}function sp(s,d){return ol(s,d)}var m1=null,nu=null,_1=!1,hf=!1,lp=!1,ru=0;function eo(s){s!==nu&&s.next===null&&(nu===null?m1=nu=s:nu=nu.next=s),hf=!0,_1||(_1=!0,i0())}function df(s,d){if(!lp&&hf){lp=!0;do for(var g=!1,w=m1;w!==null;){if(s!==0){var C=w.pendingLanes;if(C===0)var L=0;else{var X=w.suspendedLanes,he=w.pingedLanes;L=(1<<31-ba(42|s)+1)-1,L&=C&~(X&~he),L=L&201326741?L&201326741|1:L?L|2:0}L!==0&&(g=!0,t0(w,L))}else L=$e,L=Ba(w,w===vt?L:0,w.cancelPendingCommit!==null||w.timeoutHandle!==-1),(L&3)===0||Nl(w,L)||(g=!0,t0(w,L));w=w.next}while(g);lp=!1}}function $p(){Wp()}function Wp(){hf=_1=!1;var s=0;ru!==0&&gf()&&(s=ru);for(var d=Er(),g=null,w=m1;w!==null;){var C=w.next,L=Qm(w,d);L===0?(w.next=null,g===null?m1=C:g.next=C,C===null&&(nu=g)):(g=w,(s!==0||(L&3)!==0)&&(hf=!0)),w=C}$t!==0&&$t!==5||df(s),ru!==0&&(ru=0)}function Qm(s,d){for(var g=s.suspendedLanes,w=s.pingedLanes,C=s.expirationTimes,L=s.pendingLanes&-62914561;0<L;){var X=31-ba(L),he=1<<X,De=C[X];De===-1?((he&g)===0||(he&w)!==0)&&(C[X]=gh(he,d)):De<=d&&(s.expiredLanes|=he),L&=~he}if(d=vt,g=$e,g=Ba(s,s===d?g:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),w=s.callbackNode,g===0||s===d&&(xt===2||xt===9)||s.cancelPendingCommit!==null)return w!==null&&w!==null&&Fa(w),s.callbackNode=null,s.callbackPriority=0;if((g&3)===0||Nl(s,g)){if(d=g&-g,d===s.callbackPriority)return d;switch(w!==null&&Fa(w),yh(g)){case 2:case 8:g=As;break;case 32:g=Ms;break;case 268435456:g=kl;break;default:g=Ms}return w=e0.bind(null,s),g=ol(g,w),s.callbackPriority=d,s.callbackNode=g,d}return w!==null&&w!==null&&Fa(w),s.callbackPriority=2,s.callbackNode=null,2}function e0(s,d){if($t!==0&&$t!==5)return s.callbackNode=null,s.callbackPriority=0,null;var g=s.callbackNode;if(rp()&&s.callbackNode!==g)return null;var w=$e;return w=Ba(s,s===vt?w:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),w===0?null:(yo(s,w,d),Qm(s,Er()),s.callbackNode!=null&&s.callbackNode===g?e0.bind(null,s):null)}function t0(s,d){if(rp())return null;yo(s,d,!0)}function i0(){b1(function(){(Je&6)!==0?ol(as,$p):Wp()})}function cp(){if(ru===0){var s=Wl;s===0&&(s=Zn,Zn<<=1,(Zn&261888)===0&&(Zn=256)),ru=s}return ru}function n0(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Ps(""+s)}function Yp(s,d){var g=d.ownerDocument.createElement("input");return g.name=d.name,g.value=d.value,s.id&&g.setAttribute("form",s.id),d.parentNode.insertBefore(g,d),s=new FormData(s),g.parentNode.removeChild(g),s}function c_(s,d,g,w,C){if(d==="submit"&&g&&g.stateNode===C){var L=n0((C[J]||null).action),X=w.submitter;X&&(d=(d=X[J]||null)?n0(d.formAction):X.getAttribute("formAction"),d!==null&&(L=d,X=null));var he=new Ls("action","action",null,w,C);s.push({event:he,listeners:[{instance:null,listener:function(){if(w.defaultPrevented){if(ru!==0){var De=X?Yp(C,X):new FormData(C);El(g,{pending:!0,data:De,method:C.method,action:L},null,De)}}else typeof L=="function"&&(he.preventDefault(),De=X?Yp(C,X):new FormData(C),El(g,{pending:!0,data:De,method:C.method,action:L},L,De))},currentTarget:C}]})}}for(var Kp=0;Kp<Rh.length;Kp++){var up=Rh[Kp],r0=up.toLowerCase(),a0=up[0].toUpperCase()+up.slice(1);Ua(r0,"on"+a0)}Ua(Id,"onAnimationEnd"),Ua(zh,"onAnimationIteration"),Ua(Cd,"onAnimationStart"),Ua("dblclick","onDoubleClick"),Ua("focusin","onFocus"),Ua("focusout","onBlur"),Ua(Gf,"onTransitionRun"),Ua(Ho,"onTransitionStart"),Ua(Cc,"onTransitionCancel"),Ua(Ou,"onTransitionEnd"),jn("onMouseEnter",["mouseout","mouseover"]),jn("onMouseLeave",["mouseout","mouseover"]),jn("onPointerEnter",["pointerout","pointerover"]),jn("onPointerLeave",["pointerout","pointerover"]),rn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),rn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),rn("onBeforeInput",["compositionend","keypress","textInput","paste"]),rn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),rn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),rn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ff="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),o0=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ff));function Jp(s,d){d=(d&4)!==0;for(var g=0;g<s.length;g++){var w=s[g],C=w.event;w=w.listeners;e:{var L=void 0;if(d)for(var X=w.length-1;0<=X;X--){var he=w[X],De=he.instance,ht=he.currentTarget;if(he=he.listener,De!==L&&C.isPropagationStopped())break e;L=he,C.currentTarget=ht;try{L(C)}catch(Dt){ml(Dt)}C.currentTarget=null,L=De}else for(X=0;X<w.length;X++){if(he=w[X],De=he.instance,ht=he.currentTarget,he=he.listener,De!==L&&C.isPropagationStopped())break e;L=he,C.currentTarget=ht;try{L(C)}catch(Dt){ml(Dt)}C.currentTarget=null,L=De}}}}function qn(s,d){var g=d[fe];g===void 0&&(g=d[fe]=new Set);var w=s+"__bubble";g.has(w)||(Qp(d,s,2,!1),g.add(w))}function g1(s,d,g){var w=0;d&&(w|=4),Qp(g,s,w,d)}var zl="_reactListening"+Math.random().toString(36).slice(2);function fa(s){if(!s[zl]){s[zl]=!0,Ei.forEach(function(g){g!=="selectionchange"&&(o0.has(g)||g1(g,!1,s),g1(g,!0,s))});var d=s.nodeType===9?s:s.ownerDocument;d===null||d[zl]||(d[zl]=!0,g1("selectionchange",!1,d))}}function Qp(s,d,g,w){switch(b0(d)){case 2:var C=I1;break;case 8:C=x0;break;default:C=wp}g=C.bind(null,d,g,s),C=void 0,!bh||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(C=!0),w?C!==void 0?s.addEventListener(d,g,{capture:!0,passive:C}):s.addEventListener(d,g,!0):C!==void 0?s.addEventListener(d,g,{passive:C}):s.addEventListener(d,g,!1)}function fd(s,d,g,w,C){var L=w;if((d&1)===0&&(d&2)===0&&w!==null)e:for(;;){if(w===null)return;var X=w.tag;if(X===3||X===4){var he=w.stateNode.containerInfo;if(he===C)break;if(X===4)for(X=w.return;X!==null;){var De=X.tag;if((De===3||De===4)&&X.stateNode.containerInfo===C)return;X=X.return}for(;he!==null;){if(X=et(he),X===null)return;if(De=X.tag,De===5||De===6||De===26||De===27){w=L=X;continue e}he=he.parentNode}}w=w.return}wd(function(){var ht=L,Dt=jo(g),Bt=[];e:{var _t=zd.get(s);if(_t!==void 0){var wt=Ls,mi=s;switch(s){case"keypress":if(jl(g)===0)break e;case"keydown":case"keyup":wt=Xt;break;case"focusin":mi="focus",wt=Th;break;case"focusout":mi="blur",wt=Th;break;case"beforeblur":case"afterblur":wt=Th;break;case"click":if(g.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":wt=vc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":wt=hl;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":wt=Cu;break;case Id:case zh:case Cd:wt=kf;break;case Ou:wt=Eh;break;case"scroll":case"scrollend":wt=Td;break;case"wheel":wt=Ah;break;case"copy":case"cut":case"paste":wt=Nf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":wt=on;break;case"toggle":case"beforetoggle":wt=Or}var ji=(d&4)!==0,Ir=!ji&&(s==="scroll"||s==="scrollend"),Qe=ji?_t!==null?_t+"Capture":null:_t;ji=[];for(var Ne=ht,dt;Ne!==null;){var Ot=Ne;if(dt=Ot.stateNode,Ot=Ot.tag,Ot!==5&&Ot!==26&&Ot!==27||dt===null||Qe===null||(Ot=ss(Ne,Qe),Ot!=null&&ji.push(y1(Ne,Ot,dt))),Ir)break;Ne=Ne.return}0<ji.length&&(_t=new wt(_t,mi,null,g,Dt),Bt.push({event:_t,listeners:ji}))}}if((d&7)===0){e:{if(_t=s==="mouseover"||s==="pointerover",wt=s==="mouseout"||s==="pointerout",_t&&g!==wu&&(mi=g.relatedTarget||g.fromElement)&&(et(mi)||mi[pe]))break e;if((wt||_t)&&(_t=Dt.window===Dt?Dt:(_t=Dt.ownerDocument)?_t.defaultView||_t.parentWindow:window,wt?(mi=g.relatedTarget||g.toElement,wt=ht,mi=mi?et(mi):null,mi!==null&&(Ir=ke(mi),ji=mi.tag,mi!==Ir||ji!==5&&ji!==27&&ji!==6)&&(mi=null)):(wt=null,mi=ht),wt!==mi)){if(ji=vc,Ot="onMouseLeave",Qe="onMouseEnter",Ne="mouse",(s==="pointerout"||s==="pointerover")&&(ji=on,Ot="onPointerLeave",Qe="onPointerEnter",Ne="pointer"),Ir=wt==null?_t:ei(wt),dt=mi==null?_t:ei(mi),_t=new ji(Ot,Ne+"leave",wt,g,Dt),_t.target=Ir,_t.relatedTarget=dt,Ot=null,et(Dt)===ht&&(ji=new ji(Qe,Ne+"enter",mi,g,Dt),ji.target=dt,ji.relatedTarget=Ir,Ot=ji),Ir=Ot,wt&&mi)t:{for(ji=u_,Qe=wt,Ne=mi,dt=0,Ot=Qe;Ot;Ot=ji(Ot))dt++;Ot=0;for(var Gi=Ne;Gi;Gi=ji(Gi))Ot++;for(;0<dt-Ot;)Qe=ji(Qe),dt--;for(;0<Ot-dt;)Ne=ji(Ne),Ot--;for(;dt--;){if(Qe===Ne||Ne!==null&&Qe===Ne.alternate){ji=Qe;break t}Qe=ji(Qe),Ne=ji(Ne)}ji=null}else ji=null;wt!==null&&s0(Bt,_t,wt,ji,!1),mi!==null&&Ir!==null&&s0(Bt,Ir,mi,ji,!0)}}e:{if(_t=ht?ei(ht):window,wt=_t.nodeName&&_t.nodeName.toLowerCase(),wt==="select"||wt==="input"&&_t.type==="file")var pr=li;else if(cs(_t))if(Tc)pr=Da;else{pr=Ad;var Di=ks}else wt=_t.nodeName,!wt||wt.toLowerCase()!=="input"||_t.type!=="checkbox"&&_t.type!=="radio"?ht&&Ta(ht.elementType)&&(pr=li):pr=ca;if(pr&&(pr=pr(s,ht))){Fs(Bt,pr,g,Dt);break e}Di&&Di(s,_t,ht),s==="focusout"&&ht&&_t.type==="number"&&ht.memoizedProps.value!=null&&ka(_t,"number",_t.value)}switch(Di=ht?ei(ht):window,s){case"focusin":(cs(Di)||Di.contentEditable==="true")&&(Pa=Di,Md=ht,Hl=null);break;case"focusout":Hl=Md=Pa=null;break;case"mousedown":Ec=!0;break;case"contextmenu":case"mouseup":case"dragend":Ec=!1,fl(Bt,g,Dt);break;case"selectionchange":if(q1)break;case"keydown":case"keyup":fl(Bt,g,Dt)}var Tn;if(bc)e:{switch(s){case"compositionstart":var Qn="onCompositionStart";break e;case"compositionend":Qn="onCompositionEnd";break e;case"compositionupdate":Qn="onCompositionUpdate";break e}Qn=void 0}else la?$r(s,g)&&(Qn="onCompositionEnd"):s==="keydown"&&g.keyCode===229&&(Qn="onCompositionStart");Qn&&(Ih&&g.locale!=="ko"&&(la||Qn!=="onCompositionStart"?Qn==="onCompositionEnd"&&la&&(Tn=Su()):(Ao=Dt,Ki="value"in Ao?Ao.value:Ao.textContent,la=!0)),Di=hp(ht,Qn),0<Di.length&&(Qn=new Uf(Qn,s,null,g,Dt),Bt.push({event:Qn,listeners:Di}),Tn?Qn.data=Tn:(Tn=Os(g),Tn!==null&&(Qn.data=Tn)))),(Tn=Mh?Ed(s,g):Ru(s,g))&&(Qn=hp(ht,"onBeforeInput"),0<Qn.length&&(Di=new Uf("onBeforeInput","beforeinput",null,g,Dt),Bt.push({event:Di,listeners:Qn}),Di.data=Tn)),c_(Bt,s,ht,g,Dt)}Jp(Bt,d)})}function y1(s,d,g){return{instance:s,listener:d,currentTarget:g}}function hp(s,d){for(var g=d+"Capture",w=[];s!==null;){var C=s,L=C.stateNode;if(C=C.tag,C!==5&&C!==26&&C!==27||L===null||(C=ss(s,g),C!=null&&w.unshift(y1(s,C,L)),C=ss(s,d),C!=null&&w.push(y1(s,C,L))),s.tag===3)return w;s=s.return}return[]}function u_(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function s0(s,d,g,w,C){for(var L=d._reactName,X=[];g!==null&&g!==w;){var he=g,De=he.alternate,ht=he.stateNode;if(he=he.tag,De!==null&&De===w)break;he!==5&&he!==26&&he!==27||ht===null||(De=ht,C?(ht=ss(g,L),ht!=null&&X.unshift(y1(g,ht,De))):C||(ht=ss(g,L),ht!=null&&X.push(y1(g,ht,De)))),g=g.return}X.length!==0&&s.push({event:d,listeners:X})}var pf=/\r\n?/g,l0=/\u0000|\uFFFD/g;function ch(s){return(typeof s=="string"?s:""+s).replace(pf,`
`).replace(l0,"")}function mf(s,d){return d=ch(d),ch(s)===d}function Rr(s,d,g,w,C,L){switch(g){case"children":typeof w=="string"?d==="body"||d==="textarea"&&w===""||Ds(s,w):(typeof w=="number"||typeof w=="bigint")&&d!=="body"&&Ds(s,""+w);break;case"className":Rn(s,"class",w);break;case"tabIndex":Rn(s,"tabindex",w);break;case"dir":case"role":case"viewBox":case"width":case"height":Rn(s,g,w);break;case"style":Uo(s,w,L);break;case"data":if(d!=="object"){Rn(s,"data",w);break}case"src":case"href":if(w===""&&(d!=="a"||g!=="href")){s.removeAttribute(g);break}if(w==null||typeof w=="function"||typeof w=="symbol"||typeof w=="boolean"){s.removeAttribute(g);break}w=Ps(""+w),s.setAttribute(g,w);break;case"action":case"formAction":if(typeof w=="function"){s.setAttribute(g,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof L=="function"&&(g==="formAction"?(d!=="input"&&Rr(s,d,"name",C.name,C,null),Rr(s,d,"formEncType",C.formEncType,C,null),Rr(s,d,"formMethod",C.formMethod,C,null),Rr(s,d,"formTarget",C.formTarget,C,null)):(Rr(s,d,"encType",C.encType,C,null),Rr(s,d,"method",C.method,C,null),Rr(s,d,"target",C.target,C,null)));if(w==null||typeof w=="symbol"||typeof w=="boolean"){s.removeAttribute(g);break}w=Ps(""+w),s.setAttribute(g,w);break;case"onClick":w!=null&&(s.onclick=Vo);break;case"onScroll":w!=null&&qn("scroll",s);break;case"onScrollEnd":w!=null&&qn("scrollend",s);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(oe(61));if(g=w.__html,g!=null){if(C.children!=null)throw Error(oe(60));s.innerHTML=g}}break;case"multiple":s.multiple=w&&typeof w!="function"&&typeof w!="symbol";break;case"muted":s.muted=w&&typeof w!="function"&&typeof w!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(w==null||typeof w=="function"||typeof w=="boolean"||typeof w=="symbol"){s.removeAttribute("xlink:href");break}g=Ps(""+w),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",g);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":w!=null&&typeof w!="function"&&typeof w!="symbol"?s.setAttribute(g,""+w):s.removeAttribute(g);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":w&&typeof w!="function"&&typeof w!="symbol"?s.setAttribute(g,""):s.removeAttribute(g);break;case"capture":case"download":w===!0?s.setAttribute(g,""):w!==!1&&w!=null&&typeof w!="function"&&typeof w!="symbol"?s.setAttribute(g,w):s.removeAttribute(g);break;case"cols":case"rows":case"size":case"span":w!=null&&typeof w!="function"&&typeof w!="symbol"&&!isNaN(w)&&1<=w?s.setAttribute(g,w):s.removeAttribute(g);break;case"rowSpan":case"start":w==null||typeof w=="function"||typeof w=="symbol"||isNaN(w)?s.removeAttribute(g):s.setAttribute(g,w);break;case"popover":qn("beforetoggle",s),qn("toggle",s),Oi(s,"popover",w);break;case"xlinkActuate":An(s,"http://www.w3.org/1999/xlink","xlink:actuate",w);break;case"xlinkArcrole":An(s,"http://www.w3.org/1999/xlink","xlink:arcrole",w);break;case"xlinkRole":An(s,"http://www.w3.org/1999/xlink","xlink:role",w);break;case"xlinkShow":An(s,"http://www.w3.org/1999/xlink","xlink:show",w);break;case"xlinkTitle":An(s,"http://www.w3.org/1999/xlink","xlink:title",w);break;case"xlinkType":An(s,"http://www.w3.org/1999/xlink","xlink:type",w);break;case"xmlBase":An(s,"http://www.w3.org/XML/1998/namespace","xml:base",w);break;case"xmlLang":An(s,"http://www.w3.org/XML/1998/namespace","xml:lang",w);break;case"xmlSpace":An(s,"http://www.w3.org/XML/1998/namespace","xml:space",w);break;case"is":Oi(s,"is",w);break;case"innerText":case"textContent":break;default:(!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(g=So.get(g)||g,Oi(s,g,w))}}function em(s,d,g,w,C,L){switch(g){case"style":Uo(s,w,L);break;case"dangerouslySetInnerHTML":if(w!=null){if(typeof w!="object"||!("__html"in w))throw Error(oe(61));if(g=w.__html,g!=null){if(C.children!=null)throw Error(oe(60));s.innerHTML=g}}break;case"children":typeof w=="string"?Ds(s,w):(typeof w=="number"||typeof w=="bigint")&&Ds(s,""+w);break;case"onScroll":w!=null&&qn("scroll",s);break;case"onScrollEnd":w!=null&&qn("scrollend",s);break;case"onClick":w!=null&&(s.onclick=Vo);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Mi.hasOwnProperty(g))e:{if(g[0]==="o"&&g[1]==="n"&&(C=g.endsWith("Capture"),d=g.slice(2,C?g.length-7:void 0),L=s[J]||null,L=L!=null?L[g]:null,typeof L=="function"&&s.removeEventListener(d,L,C),typeof w=="function")){typeof L!="function"&&L!==null&&(g in s?s[g]=null:s.hasAttribute(g)&&s.removeAttribute(g)),s.addEventListener(d,w,C);break e}g in s?s[g]=w:w===!0?s.setAttribute(g,""):Oi(s,g,w)}}}function to(s,d,g){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":qn("error",s),qn("load",s);var w=!1,C=!1,L;for(L in g)if(g.hasOwnProperty(L)){var X=g[L];if(X!=null)switch(L){case"src":w=!0;break;case"srcSet":C=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(oe(137,d));default:Rr(s,d,L,X,g,null)}}C&&Rr(s,d,"srcSet",g.srcSet,g,null),w&&Rr(s,d,"src",g.src,g,null);return;case"input":qn("invalid",s);var he=L=X=C=null,De=null,ht=null;for(w in g)if(g.hasOwnProperty(w)){var Dt=g[w];if(Dt!=null)switch(w){case"name":C=Dt;break;case"type":X=Dt;break;case"checked":De=Dt;break;case"defaultChecked":ht=Dt;break;case"value":L=Dt;break;case"defaultValue":he=Dt;break;case"children":case"dangerouslySetInnerHTML":if(Dt!=null)throw Error(oe(137,d));break;default:Rr(s,d,w,Dt,g,null)}}No(s,L,he,De,ht,X,C,!1);return;case"select":qn("invalid",s),w=X=L=null;for(C in g)if(g.hasOwnProperty(C)&&(he=g[C],he!=null))switch(C){case"value":L=he;break;case"defaultValue":X=he;break;case"multiple":w=he;default:Rr(s,d,C,he,g,null)}d=L,g=X,s.multiple=!!w,d!=null?_a(s,!!w,d,!1):g!=null&&_a(s,!!w,g,!0);return;case"textarea":qn("invalid",s),L=C=w=null;for(X in g)if(g.hasOwnProperty(X)&&(he=g[X],he!=null))switch(X){case"value":w=he;break;case"defaultValue":C=he;break;case"children":L=he;break;case"dangerouslySetInnerHTML":if(he!=null)throw Error(oe(91));break;default:Rr(s,d,X,he,g,null)}bu(s,w,C,L);return;case"option":for(De in g)if(g.hasOwnProperty(De)&&(w=g[De],w!=null))switch(De){case"selected":s.selected=w&&typeof w!="function"&&typeof w!="symbol";break;default:Rr(s,d,De,w,g,null)}return;case"dialog":qn("beforetoggle",s),qn("toggle",s),qn("cancel",s),qn("close",s);break;case"iframe":case"object":qn("load",s);break;case"video":case"audio":for(w=0;w<ff.length;w++)qn(ff[w],s);break;case"image":qn("error",s),qn("load",s);break;case"details":qn("toggle",s);break;case"embed":case"source":case"link":qn("error",s),qn("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ht in g)if(g.hasOwnProperty(ht)&&(w=g[ht],w!=null))switch(ht){case"children":case"dangerouslySetInnerHTML":throw Error(oe(137,d));default:Rr(s,d,ht,w,g,null)}return;default:if(Ta(d)){for(Dt in g)g.hasOwnProperty(Dt)&&(w=g[Dt],w!==void 0&&em(s,d,Dt,w,g,void 0));return}}for(he in g)g.hasOwnProperty(he)&&(w=g[he],w!=null&&Rr(s,d,he,w,g,null))}function h_(s,d,g,w){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var C=null,L=null,X=null,he=null,De=null,ht=null,Dt=null;for(wt in g){var Bt=g[wt];if(g.hasOwnProperty(wt)&&Bt!=null)switch(wt){case"checked":break;case"value":break;case"defaultValue":De=Bt;default:w.hasOwnProperty(wt)||Rr(s,d,wt,null,w,Bt)}}for(var _t in w){var wt=w[_t];if(Bt=g[_t],w.hasOwnProperty(_t)&&(wt!=null||Bt!=null))switch(_t){case"type":L=wt;break;case"name":C=wt;break;case"checked":ht=wt;break;case"defaultChecked":Dt=wt;break;case"value":X=wt;break;case"defaultValue":he=wt;break;case"children":case"dangerouslySetInnerHTML":if(wt!=null)throw Error(oe(137,d));break;default:wt!==Bt&&Rr(s,d,_t,wt,w,Bt)}}wa(s,X,he,De,ht,Dt,L,C);return;case"select":wt=X=he=_t=null;for(L in g)if(De=g[L],g.hasOwnProperty(L)&&De!=null)switch(L){case"value":break;case"multiple":wt=De;default:w.hasOwnProperty(L)||Rr(s,d,L,null,w,De)}for(C in w)if(L=w[C],De=g[C],w.hasOwnProperty(C)&&(L!=null||De!=null))switch(C){case"value":_t=L;break;case"defaultValue":he=L;break;case"multiple":X=L;default:L!==De&&Rr(s,d,C,L,w,De)}d=he,g=X,w=wt,_t!=null?_a(s,!!g,_t,!1):!!w!=!!g&&(d!=null?_a(s,!!g,d,!0):_a(s,!!g,g?[]:"",!1));return;case"textarea":wt=_t=null;for(he in g)if(C=g[he],g.hasOwnProperty(he)&&C!=null&&!w.hasOwnProperty(he))switch(he){case"value":break;case"children":break;default:Rr(s,d,he,null,w,C)}for(X in w)if(C=w[X],L=g[X],w.hasOwnProperty(X)&&(C!=null||L!=null))switch(X){case"value":_t=C;break;case"defaultValue":wt=C;break;case"children":break;case"dangerouslySetInnerHTML":if(C!=null)throw Error(oe(91));break;default:C!==L&&Rr(s,d,X,C,w,L)}vh(s,_t,wt);return;case"option":for(var mi in g)if(_t=g[mi],g.hasOwnProperty(mi)&&_t!=null&&!w.hasOwnProperty(mi))switch(mi){case"selected":s.selected=!1;break;default:Rr(s,d,mi,null,w,_t)}for(De in w)if(_t=w[De],wt=g[De],w.hasOwnProperty(De)&&_t!==wt&&(_t!=null||wt!=null))switch(De){case"selected":s.selected=_t&&typeof _t!="function"&&typeof _t!="symbol";break;default:Rr(s,d,De,_t,w,wt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ji in g)_t=g[ji],g.hasOwnProperty(ji)&&_t!=null&&!w.hasOwnProperty(ji)&&Rr(s,d,ji,null,w,_t);for(ht in w)if(_t=w[ht],wt=g[ht],w.hasOwnProperty(ht)&&_t!==wt&&(_t!=null||wt!=null))switch(ht){case"children":case"dangerouslySetInnerHTML":if(_t!=null)throw Error(oe(137,d));break;default:Rr(s,d,ht,_t,w,wt)}return;default:if(Ta(d)){for(var Ir in g)_t=g[Ir],g.hasOwnProperty(Ir)&&_t!==void 0&&!w.hasOwnProperty(Ir)&&em(s,d,Ir,void 0,w,_t);for(Dt in w)_t=w[Dt],wt=g[Dt],!w.hasOwnProperty(Dt)||_t===wt||_t===void 0&&wt===void 0||em(s,d,Dt,_t,w,wt);return}}for(var Qe in g)_t=g[Qe],g.hasOwnProperty(Qe)&&_t!=null&&!w.hasOwnProperty(Qe)&&Rr(s,d,Qe,null,w,_t);for(Bt in w)_t=w[Bt],wt=g[Bt],!w.hasOwnProperty(Bt)||_t===wt||_t==null&&wt==null||Rr(s,d,Bt,_t,w,wt)}function c0(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function d_(){if(typeof performance.getEntriesByType=="function"){for(var s=0,d=0,g=performance.getEntriesByType("resource"),w=0;w<g.length;w++){var C=g[w],L=C.transferSize,X=C.initiatorType,he=C.duration;if(L&&he&&c0(X)){for(X=0,he=C.responseEnd,w+=1;w<g.length;w++){var De=g[w],ht=De.startTime;if(ht>he)break;var Dt=De.transferSize,Bt=De.initiatorType;Dt&&c0(Bt)&&(De=De.responseEnd,X+=Dt*(De<he?1:(he-ht)/(De-ht)))}if(--w,d+=8*(L+X)/(C.duration/1e3),s++,10<s)break}}if(0<s)return d/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var tm=null,v1=null;function dp(s){return s.nodeType===9?s:s.ownerDocument}function im(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function _f(s,d){if(s===0)switch(d){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&d==="foreignObject"?0:s}function nm(s,d){return s==="textarea"||s==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.children=="bigint"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var Hr=null;function gf(){var s=window.event;return s&&s.type==="popstate"?s===Hr?!1:(Hr=s,!0):(Hr=null,!1)}var rm=typeof setTimeout=="function"?setTimeout:void 0,fp=typeof clearTimeout=="function"?clearTimeout:void 0,x1=typeof Promise=="function"?Promise:void 0,b1=typeof queueMicrotask=="function"?queueMicrotask:typeof x1<"u"?function(s){return x1.resolve(null).then(s).catch(u0)}:rm;function u0(s){setTimeout(function(){throw s})}function au(s){return s==="head"}function yf(s,d){var g=d,w=0;do{var C=g.nextSibling;if(s.removeChild(g),C&&C.nodeType===8)if(g=C.data,g==="/$"||g==="/&"){if(w===0){s.removeChild(C),hu(d);return}w--}else if(g==="$"||g==="$?"||g==="$~"||g==="$!"||g==="&")w++;else if(g==="html")uh(s.ownerDocument.documentElement);else if(g==="head"){g=s.ownerDocument.head,uh(g);for(var L=g.firstChild;L;){var X=L.nextSibling,he=L.nodeName;L[Ce]||he==="SCRIPT"||he==="STYLE"||he==="LINK"&&L.rel.toLowerCase()==="stylesheet"||g.removeChild(L),L=X}}else g==="body"&&uh(s.ownerDocument.body);g=C}while(g);hu(d)}function pp(s,d){var g=s;s=0;do{var w=g.nextSibling;if(g.nodeType===1?d?(g._stashedDisplay=g.style.display,g.style.display="none"):(g.style.display=g._stashedDisplay||"",g.getAttribute("style")===""&&g.removeAttribute("style")):g.nodeType===3&&(d?(g._stashedText=g.nodeValue,g.nodeValue=""):g.nodeValue=g._stashedText||""),w&&w.nodeType===8)if(g=w.data,g==="/$"){if(s===0)break;s--}else g!=="$"&&g!=="$?"&&g!=="$~"&&g!=="$!"||s++;g=w}while(g)}function pd(s){var d=s.firstChild;for(d&&d.nodeType===10&&(d=d.nextSibling);d;){var g=d;switch(d=d.nextSibling,g.nodeName){case"HTML":case"HEAD":case"BODY":pd(g),ct(g);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(g.rel.toLowerCase()==="stylesheet")continue}s.removeChild(g)}}function f_(s,d,g,w){for(;s.nodeType===1;){var C=g;if(s.nodeName.toLowerCase()!==d.toLowerCase()){if(!w&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(w){if(!s[Ce])switch(d){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(L=s.getAttribute("rel"),L==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(L!==C.rel||s.getAttribute("href")!==(C.href==null||C.href===""?null:C.href)||s.getAttribute("crossorigin")!==(C.crossOrigin==null?null:C.crossOrigin)||s.getAttribute("title")!==(C.title==null?null:C.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(L=s.getAttribute("src"),(L!==(C.src==null?null:C.src)||s.getAttribute("type")!==(C.type==null?null:C.type)||s.getAttribute("crossorigin")!==(C.crossOrigin==null?null:C.crossOrigin))&&L&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(d==="input"&&s.type==="hidden"){var L=C.name==null?null:""+C.name;if(C.type==="hidden"&&s.getAttribute("name")===L)return s}else return s;if(s=rl(s.nextSibling),s===null)break}return null}function h0(s,d,g){if(d==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!g||(s=rl(s.nextSibling),s===null))return null;return s}function mp(s,d){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!d||(s=rl(s.nextSibling),s===null))return null;return s}function w1(s){return s.data==="$?"||s.data==="$~"}function _p(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function ou(s,d){var g=s.ownerDocument;if(s.data==="$~")s._reactRetry=d;else if(s.data!=="$?"||g.readyState!=="loading")d();else{var w=function(){d(),g.removeEventListener("DOMContentLoaded",w)};g.addEventListener("DOMContentLoaded",w),s._reactRetry=w}}function rl(s){for(;s!=null;s=s.nextSibling){var d=s.nodeType;if(d===1||d===3)break;if(d===8){if(d=s.data,d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"||d==="F!"||d==="F")break;if(d==="/$"||d==="/&")return null}}return s}var io=null;function am(s){s=s.nextSibling;for(var d=0;s;){if(s.nodeType===8){var g=s.data;if(g==="/$"||g==="/&"){if(d===0)return rl(s.nextSibling);d--}else g!=="$"&&g!=="$!"&&g!=="$?"&&g!=="$~"&&g!=="&"||d++}s=s.nextSibling}return null}function om(s){s=s.previousSibling;for(var d=0;s;){if(s.nodeType===8){var g=s.data;if(g==="$"||g==="$!"||g==="$?"||g==="$~"||g==="&"){if(d===0)return s;d--}else g!=="/$"&&g!=="/&"||d++}s=s.previousSibling}return null}function sm(s,d,g){switch(d=dp(g),s){case"html":if(s=d.documentElement,!s)throw Error(oe(452));return s;case"head":if(s=d.head,!s)throw Error(oe(453));return s;case"body":if(s=d.body,!s)throw Error(oe(454));return s;default:throw Error(oe(451))}}function uh(s){for(var d=s.attributes;d.length;)s.removeAttributeNode(d[0]);ct(s)}var al=new Map,d0=new Set;function vf(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var fc=jt.d;jt.d={f:lm,r:cm,D:f0,C:p0,L:gp,m:pc,X:p_,S:m0,M:m_};function lm(){var s=fc.f(),d=hr();return s||d}function cm(s){var d=kt(s);d!==null&&d.tag===5&&d.type==="form"?tl(d):fc.r(s)}var md=typeof document>"u"?null:document;function um(s,d,g){var w=md;if(w&&typeof d=="string"&&d){var C=Nr(d);C='link[rel="'+s+'"][href="'+C+'"]',typeof g=="string"&&(C+='[crossorigin="'+g+'"]'),d0.has(C)||(d0.add(C),s={rel:s,crossOrigin:g,href:d},w.querySelector(C)===null&&(d=w.createElement("link"),to(d,"link",s),Gt(d),w.head.appendChild(d)))}}function f0(s){fc.D(s),um("dns-prefetch",s,null)}function p0(s,d){fc.C(s,d),um("preconnect",s,d)}function gp(s,d,g){fc.L(s,d,g);var w=md;if(w&&s&&d){var C='link[rel="preload"][as="'+Nr(d)+'"]';d==="image"&&g&&g.imageSrcSet?(C+='[imagesrcset="'+Nr(g.imageSrcSet)+'"]',typeof g.imageSizes=="string"&&(C+='[imagesizes="'+Nr(g.imageSizes)+'"]')):C+='[href="'+Nr(s)+'"]';var L=C;switch(d){case"style":L=xf(s);break;case"script":L=bf(s)}al.has(L)||(s=Ft({rel:"preload",href:d==="image"&&g&&g.imageSrcSet?void 0:s,as:d},g),al.set(L,s),w.querySelector(C)!==null||d==="style"&&w.querySelector(T1(L))||d==="script"&&w.querySelector(su(L))||(d=w.createElement("link"),to(d,"link",s),Gt(d),w.head.appendChild(d)))}}function pc(s,d){fc.m(s,d);var g=md;if(g&&s){var w=d&&typeof d.as=="string"?d.as:"script",C='link[rel="modulepreload"][as="'+Nr(w)+'"][href="'+Nr(s)+'"]',L=C;switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":L=bf(s)}if(!al.has(L)&&(s=Ft({rel:"modulepreload",href:s},d),al.set(L,s),g.querySelector(C)===null)){switch(w){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(g.querySelector(su(L)))return}w=g.createElement("link"),to(w,"link",s),Gt(w),g.head.appendChild(w)}}}function m0(s,d,g){fc.S(s,d,g);var w=md;if(w&&s){var C=Jt(w).hoistableStyles,L=xf(s);d=d||"default";var X=C.get(L);if(!X){var he={loading:0,preload:null};if(X=w.querySelector(T1(L)))he.loading=5;else{s=Ft({rel:"stylesheet",href:s,"data-precedence":d},g),(g=al.get(L))&&wf(s,g);var De=X=w.createElement("link");Gt(De),to(De,"link",s),De._p=new Promise(function(ht,Dt){De.onload=ht,De.onerror=Dt}),De.addEventListener("load",function(){he.loading|=1}),De.addEventListener("error",function(){he.loading|=2}),he.loading|=4,S1(X,d,w)}X={type:"stylesheet",instance:X,count:1,state:he},C.set(L,X)}}}function p_(s,d){fc.X(s,d);var g=md;if(g&&s){var w=Jt(g).hoistableScripts,C=bf(s),L=w.get(C);L||(L=g.querySelector(su(C)),L||(s=Ft({src:s,async:!0},d),(d=al.get(C))&&yp(s,d),L=g.createElement("script"),Gt(L),to(L,"link",s),g.head.appendChild(L)),L={type:"script",instance:L,count:1,state:null},w.set(C,L))}}function m_(s,d){fc.M(s,d);var g=md;if(g&&s){var w=Jt(g).hoistableScripts,C=bf(s),L=w.get(C);L||(L=g.querySelector(su(C)),L||(s=Ft({src:s,async:!0,type:"module"},d),(d=al.get(C))&&yp(s,d),L=g.createElement("script"),Gt(L),to(L,"link",s),g.head.appendChild(L)),L={type:"script",instance:L,count:1,state:null},w.set(C,L))}}function _0(s,d,g,w){var C=(C=En.current)?vf(C):null;if(!C)throw Error(oe(446));switch(s){case"meta":case"title":return null;case"style":return typeof g.precedence=="string"&&typeof g.href=="string"?(d=xf(g.href),g=Jt(C).hoistableStyles,w=g.get(d),w||(w={type:"style",instance:null,count:0,state:null},g.set(d,w)),w):{type:"void",instance:null,count:0,state:null};case"link":if(g.rel==="stylesheet"&&typeof g.href=="string"&&typeof g.precedence=="string"){s=xf(g.href);var L=Jt(C).hoistableStyles,X=L.get(s);if(X||(C=C.ownerDocument||C,X={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},L.set(s,X),(L=C.querySelector(T1(s)))&&!L._p&&(X.instance=L,X.state.loading=5),al.has(s)||(g={rel:"preload",as:"style",href:g.href,crossOrigin:g.crossOrigin,integrity:g.integrity,media:g.media,hrefLang:g.hrefLang,referrerPolicy:g.referrerPolicy},al.set(s,g),L||__(C,s,g,X.state))),d&&w===null)throw Error(oe(528,""));return X}if(d&&w!==null)throw Error(oe(529,""));return null;case"script":return d=g.async,g=g.src,typeof g=="string"&&d&&typeof d!="function"&&typeof d!="symbol"?(d=bf(g),g=Jt(C).hoistableScripts,w=g.get(d),w||(w={type:"script",instance:null,count:0,state:null},g.set(d,w)),w):{type:"void",instance:null,count:0,state:null};default:throw Error(oe(444,s))}}function xf(s){return'href="'+Nr(s)+'"'}function T1(s){return'link[rel="stylesheet"]['+s+"]"}function g0(s){return Ft({},s,{"data-precedence":s.precedence,precedence:null})}function __(s,d,g,w){s.querySelector('link[rel="preload"][as="style"]['+d+"]")?w.loading=1:(d=s.createElement("link"),w.preload=d,d.addEventListener("load",function(){return w.loading|=1}),d.addEventListener("error",function(){return w.loading|=2}),to(d,"link",g),Gt(d),s.head.appendChild(d))}function bf(s){return'[src="'+Nr(s)+'"]'}function su(s){return"script[async]"+s}function hm(s,d,g){if(d.count++,d.instance===null)switch(d.type){case"style":var w=s.querySelector('style[data-href~="'+Nr(g.href)+'"]');if(w)return d.instance=w,Gt(w),w;var C=Ft({},g,{"data-href":g.href,"data-precedence":g.precedence,href:null,precedence:null});return w=(s.ownerDocument||s).createElement("style"),Gt(w),to(w,"style",C),S1(w,g.precedence,s),d.instance=w;case"stylesheet":C=xf(g.href);var L=s.querySelector(T1(C));if(L)return d.state.loading|=4,d.instance=L,Gt(L),L;w=g0(g),(C=al.get(C))&&wf(w,C),L=(s.ownerDocument||s).createElement("link"),Gt(L);var X=L;return X._p=new Promise(function(he,De){X.onload=he,X.onerror=De}),to(L,"link",w),d.state.loading|=4,S1(L,g.precedence,s),d.instance=L;case"script":return L=bf(g.src),(C=s.querySelector(su(L)))?(d.instance=C,Gt(C),C):(w=g,(C=al.get(L))&&(w=Ft({},g),yp(w,C)),s=s.ownerDocument||s,C=s.createElement("script"),Gt(C),to(C,"link",w),s.head.appendChild(C),d.instance=C);case"void":return null;default:throw Error(oe(443,d.type))}else d.type==="stylesheet"&&(d.state.loading&4)===0&&(w=d.instance,d.state.loading|=4,S1(w,g.precedence,s));return d.instance}function S1(s,d,g){for(var w=g.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),C=w.length?w[w.length-1]:null,L=C,X=0;X<w.length;X++){var he=w[X];if(he.dataset.precedence===d)L=he;else if(L!==C)break}L?L.parentNode.insertBefore(s,L.nextSibling):(d=g.nodeType===9?g.head:g,d.insertBefore(s,d.firstChild))}function wf(s,d){s.crossOrigin==null&&(s.crossOrigin=d.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=d.referrerPolicy),s.title==null&&(s.title=d.title)}function yp(s,d){s.crossOrigin==null&&(s.crossOrigin=d.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=d.referrerPolicy),s.integrity==null&&(s.integrity=d.integrity)}var Tf=null;function E1(s,d,g){if(Tf===null){var w=new Map,C=Tf=new Map;C.set(g,w)}else C=Tf,w=C.get(g),w||(w=new Map,C.set(g,w));if(w.has(s))return w;for(w.set(s,null),g=g.getElementsByTagName(s),C=0;C<g.length;C++){var L=g[C];if(!(L[Ce]||L[G]||s==="link"&&L.getAttribute("rel")==="stylesheet")&&L.namespaceURI!=="http://www.w3.org/2000/svg"){var X=L.getAttribute(d)||"";X=s+X;var he=w.get(X);he?he.push(L):w.set(X,[L])}}return w}function dm(s,d,g){s=s.ownerDocument||s,s.head.insertBefore(g,d==="title"?s.querySelector("head > title"):null)}function g_(s,d,g){if(g===1||d.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof d.precedence!="string"||typeof d.href!="string"||d.href==="")break;return!0;case"link":if(typeof d.rel!="string"||typeof d.href!="string"||d.href===""||d.onLoad||d.onError)break;switch(d.rel){case"stylesheet":return s=d.disabled,typeof d.precedence=="string"&&s==null;default:return!0}case"script":if(d.async&&typeof d.async!="function"&&typeof d.async!="symbol"&&!d.onLoad&&!d.onError&&d.src&&typeof d.src=="string")return!0}return!1}function vp(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function y0(s,d,g,w){if(g.type==="stylesheet"&&(typeof w.media!="string"||matchMedia(w.media).matches!==!1)&&(g.state.loading&4)===0){if(g.instance===null){var C=xf(w.href),L=d.querySelector(T1(C));if(L){d=L._p,d!==null&&typeof d=="object"&&typeof d.then=="function"&&(s.count++,s=Sf.bind(s),d.then(s,s)),g.state.loading|=4,g.instance=L,Gt(L);return}L=d.ownerDocument||d,w=g0(w),(C=al.get(C))&&wf(w,C),L=L.createElement("link"),Gt(L);var X=L;X._p=new Promise(function(he,De){X.onload=he,X.onerror=De}),to(L,"link",w),g.instance=L}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(g,d),(d=g.state.preload)&&(g.state.loading&3)===0&&(s.count++,g=Sf.bind(s),d.addEventListener("load",g),d.addEventListener("error",g))}}var xp=0;function fm(s,d){return s.stylesheets&&s.count===0&&Ef(s,s.stylesheets),0<s.count||0<s.imgCount?function(g){var w=setTimeout(function(){if(s.stylesheets&&Ef(s,s.stylesheets),s.unsuspend){var L=s.unsuspend;s.unsuspend=null,L()}},6e4+d);0<s.imgBytes&&xp===0&&(xp=62500*d_());var C=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&Ef(s,s.stylesheets),s.unsuspend)){var L=s.unsuspend;s.unsuspend=null,L()}},(s.imgBytes>xp?50:800)+d);return s.unsuspend=g,function(){s.unsuspend=null,clearTimeout(w),clearTimeout(C)}}:null}function Sf(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ef(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var A1=null;function Ef(s,d){s.stylesheets=null,s.unsuspend!==null&&(s.count++,A1=new Map,d.forEach(y_,s),A1=null,Sf.call(s))}function y_(s,d){if(!(d.state.loading&4)){var g=A1.get(s);if(g)var w=g.get(null);else{g=new Map,A1.set(s,g);for(var C=s.querySelectorAll("link[data-precedence],style[data-precedence]"),L=0;L<C.length;L++){var X=C[L];(X.nodeName==="LINK"||X.getAttribute("media")!=="not all")&&(g.set(X.dataset.precedence,X),w=X)}w&&g.set(null,w)}C=d.instance,X=C.getAttribute("data-precedence"),L=g.get(X)||w,L===w&&g.set(null,C),g.set(X,C),this.count++,w=Sf.bind(this),C.addEventListener("load",w),C.addEventListener("error",w),L?L.parentNode.insertBefore(C,L.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(C,s.firstChild)),d.state.loading|=4}}var M1={$$typeof:ki,Provider:null,Consumer:null,_currentValue:_i,_currentValue2:_i,_threadCount:0};function v_(s,d,g,w,C,L,X,he,De){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ul(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ul(0),this.hiddenUpdates=Ul(null),this.identifierPrefix=w,this.onUncaughtError=C,this.onCaughtError=L,this.onRecoverableError=X,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=De,this.incompleteTransitions=new Map}function v0(s,d,g,w,C,L,X,he,De,ht,Dt,Bt){return s=new v_(s,d,g,X,De,ht,Dt,Bt,he),d=1,L===!0&&(d|=24),L=Va(3,null,null,d),s.current=L,L.stateNode=s,d=Nh(),d.refCount++,s.pooledCache=d,d.refCount++,L.memoizedState={element:w,isDehydrated:g,cache:d},Xh(L),s}function pm(s){return s?(s=Us,s):Us}function lu(s,d,g,w,C,L){C=pm(C),w.context===null?w.context=C:w.pendingContext=C,w=$s(d),w.payload={element:g},L=L===void 0?null:L,L!==null&&(w.callback=L),g=Ws(s,w,d),g!==null&&(ur(g,s,d),ec(g,s,d))}function mm(s,d){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var g=s.retryLane;s.retryLane=g!==0&&g<d?g:d}}function bp(s,d){mm(s,d),(s=s.alternate)&&mm(s,d)}function Af(s){if(s.tag===13||s.tag===31){var d=qo(s,67108864);d!==null&&ur(d,s,67108864),bp(s,67108864)}}function Mf(s){if(s.tag===13||s.tag===31){var d=vr();d=pa(d);var g=qo(s,d);g!==null&&ur(g,s,d),bp(s,d)}}var _d=!0;function I1(s,d,g,w){var C=yt.T;yt.T=null;var L=jt.p;try{jt.p=2,wp(s,d,g,w)}finally{jt.p=L,yt.T=C}}function x0(s,d,g,w){var C=yt.T;yt.T=null;var L=jt.p;try{jt.p=8,wp(s,d,g,w)}finally{jt.p=L,yt.T=C}}function wp(s,d,g,w){if(_d){var C=Tp(w);if(C===null)fd(s,d,w,C1,g),gm(s,w);else if(T0(C,s,d,g,w))w.stopPropagation();else if(gm(s,w),d&4&&-1<w0.indexOf(s)){for(;C!==null;){var L=kt(C);if(L!==null)switch(L.tag){case 3:if(L=L.stateNode,L.current.memoizedState.isDehydrated){var X=oo(L.pendingLanes);if(X!==0){var he=L;for(he.pendingLanes|=2,he.entangledLanes|=2;X;){var De=1<<31-ba(X);he.entanglements[1]|=De,X&=~De}eo(L),(Je&6)===0&&(Si=Er()+500,df(0))}}break;case 31:case 13:he=qo(L,2),he!==null&&ur(he,L,2),hr(),bp(L,2)}if(L=Tp(w),L===null&&fd(s,d,w,C1,g),L===C)break;C=L}C!==null&&w.stopPropagation()}else fd(s,d,w,null,g)}}function Tp(s){return s=jo(s),_m(s)}var C1=null;function _m(s){if(C1=null,s=et(s),s!==null){var d=ke(s);if(d===null)s=null;else{var g=d.tag;if(g===13){if(s=ft(d),s!==null)return s;s=null}else if(g===31){if(s=o(d),s!==null)return s;s=null}else if(g===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;s=null}else d!==s&&(s=null)}}return C1=s,null}function b0(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Bl()){case as:return 2;case As:return 8;case Ms:case Wa:return 32;case kl:return 268435456;default:return 32}default:return 32}}var z1=!1,Rl=null,cu=null,hh=null,If=new Map,gd=new Map,uu=[],w0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function gm(s,d){switch(s){case"focusin":case"focusout":Rl=null;break;case"dragenter":case"dragleave":cu=null;break;case"mouseover":case"mouseout":hh=null;break;case"pointerover":case"pointerout":If.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":gd.delete(d.pointerId)}}function Cf(s,d,g,w,C,L){return s===null||s.nativeEvent!==L?(s={blockedOn:d,domEventName:g,eventSystemFlags:w,nativeEvent:L,targetContainers:[C]},d!==null&&(d=kt(d),d!==null&&Af(d)),s):(s.eventSystemFlags|=w,d=s.targetContainers,C!==null&&d.indexOf(C)===-1&&d.push(C),s)}function T0(s,d,g,w,C){switch(d){case"focusin":return Rl=Cf(Rl,s,d,g,w,C),!0;case"dragenter":return cu=Cf(cu,s,d,g,w,C),!0;case"mouseover":return hh=Cf(hh,s,d,g,w,C),!0;case"pointerover":var L=C.pointerId;return If.set(L,Cf(If.get(L)||null,s,d,g,w,C)),!0;case"gotpointercapture":return L=C.pointerId,gd.set(L,Cf(gd.get(L)||null,s,d,g,w,C)),!0}return!1}function S0(s){var d=et(s.target);if(d!==null){var g=ke(d);if(g!==null){if(d=g.tag,d===13){if(d=ft(g),d!==null){s.blockedOn=d,Te(s.priority,function(){Mf(g)});return}}else if(d===31){if(d=o(g),d!==null){s.blockedOn=d,Te(s.priority,function(){Mf(g)});return}}else if(d===3&&g.stateNode.current.memoizedState.isDehydrated){s.blockedOn=g.tag===3?g.stateNode.containerInfo:null;return}}}s.blockedOn=null}function R1(s){if(s.blockedOn!==null)return!1;for(var d=s.targetContainers;0<d.length;){var g=Tp(s.nativeEvent);if(g===null){g=s.nativeEvent;var w=new g.constructor(g.type,g);wu=w,g.target.dispatchEvent(w),wu=null}else return d=kt(g),d!==null&&Af(d),s.blockedOn=g,!1;d.shift()}return!0}function ym(s,d,g){R1(s)&&g.delete(d)}function yd(){z1=!1,Rl!==null&&R1(Rl)&&(Rl=null),cu!==null&&R1(cu)&&(cu=null),hh!==null&&R1(hh)&&(hh=null),If.forEach(ym),gd.forEach(ym)}function D1(s,d){s.blockedOn===d&&(s.blockedOn=null,z1||(z1=!0,ae.unstable_scheduleCallback(ae.unstable_NormalPriority,yd)))}var P1=null;function vm(s){P1!==s&&(P1=s,ae.unstable_scheduleCallback(ae.unstable_NormalPriority,function(){P1===s&&(P1=null);for(var d=0;d<s.length;d+=3){var g=s[d],w=s[d+1],C=s[d+2];if(typeof w!="function"){if(_m(w||g)===null)continue;break}var L=kt(g);L!==null&&(s.splice(d,3),d-=3,El(L,{pending:!0,data:C,method:g.method,action:w},w,C))}}))}function hu(s){function d(De){return D1(De,s)}Rl!==null&&D1(Rl,s),cu!==null&&D1(cu,s),hh!==null&&D1(hh,s),If.forEach(d),gd.forEach(d);for(var g=0;g<uu.length;g++){var w=uu[g];w.blockedOn===s&&(w.blockedOn=null)}for(;0<uu.length&&(g=uu[0],g.blockedOn===null);)S0(g),g.blockedOn===null&&uu.shift();if(g=(s.ownerDocument||s).$$reactFormReplay,g!=null)for(w=0;w<g.length;w+=3){var C=g[w],L=g[w+1],X=C[J]||null;if(typeof L=="function")X||vm(g);else if(X){var he=null;if(L&&L.hasAttribute("formAction")){if(C=L,X=L[J]||null)he=X.formAction;else if(_m(C)!==null)continue}else he=X.action;typeof he=="function"?g[w+1]=he:(g.splice(w,3),w-=3),vm(g)}}}function E0(){function s(L){L.canIntercept&&L.info==="react-transition"&&L.intercept({handler:function(){return new Promise(function(X){return C=X})},focusReset:"manual",scroll:"manual"})}function d(){C!==null&&(C(),C=null),w||setTimeout(g,20)}function g(){if(!w&&!navigation.transition){var L=navigation.currentEntry;L&&L.url!=null&&navigation.navigate(L.url,{state:L.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var w=!1,C=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",d),navigation.addEventListener("navigateerror",d),setTimeout(g,100),function(){w=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",d),navigation.removeEventListener("navigateerror",d),C!==null&&(C(),C=null)}}}function Sp(s){this._internalRoot=s}dh.prototype.render=Sp.prototype.render=function(s){var d=this._internalRoot;if(d===null)throw Error(oe(409));var g=d.current,w=vr();lu(g,w,s,d,null,null)},dh.prototype.unmount=Sp.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var d=s.containerInfo;lu(s.current,2,null,s,null,null),hr(),d[pe]=null}};function dh(s){this._internalRoot=s}dh.prototype.unstable_scheduleHydration=function(s){if(s){var d=xu();s={blockedOn:null,target:s,priority:d};for(var g=0;g<uu.length&&d!==0&&d<uu[g].priority;g++);uu.splice(g,0,s),g===0&&S0(s)}};var xm=me.version;if(xm!=="19.2.0")throw Error(oe(527,xm,"19.2.0"));jt.findDOMNode=function(s){var d=s._reactInternals;if(d===void 0)throw typeof s.render=="function"?Error(oe(188)):(s=Object.keys(s).join(","),Error(oe(268,s)));return s=We(d),s=s!==null?ci(s):null,s=s===null?null:s.stateNode,s};var A0={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:yt,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var L1=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!L1.isDisabled&&L1.supportsFiber)try{Cs=L1.inject(A0),Vn=L1}catch{}}return Xm.createRoot=function(s,d){if(!Ae(s))throw Error(oe(299));var g=!1,w="",C=Kd,L=lc,X=Jd;return d!=null&&(d.unstable_strictMode===!0&&(g=!0),d.identifierPrefix!==void 0&&(w=d.identifierPrefix),d.onUncaughtError!==void 0&&(C=d.onUncaughtError),d.onCaughtError!==void 0&&(L=d.onCaughtError),d.onRecoverableError!==void 0&&(X=d.onRecoverableError)),d=v0(s,1,!1,null,null,g,w,null,C,L,X,E0),s[pe]=d.current,fa(s),new Sp(d)},Xm.hydrateRoot=function(s,d,g){if(!Ae(s))throw Error(oe(299));var w=!1,C="",L=Kd,X=lc,he=Jd,De=null;return g!=null&&(g.unstable_strictMode===!0&&(w=!0),g.identifierPrefix!==void 0&&(C=g.identifierPrefix),g.onUncaughtError!==void 0&&(L=g.onUncaughtError),g.onCaughtError!==void 0&&(X=g.onCaughtError),g.onRecoverableError!==void 0&&(he=g.onRecoverableError),g.formState!==void 0&&(De=g.formState)),d=v0(s,1,!0,d,g??null,w,C,De,L,X,he,E0),d.context=pm(null),g=d.current,w=vr(),w=pa(w),C=$s(w),C.callback=null,Ws(g,C,w),g=w,d.current.lanes=g,nt(d,g),eo(d),s[pe]=d.current,fa(s),new dh(d)},Xm.version="19.2.0",Xm}var u4;function C6(){if(u4)return m2.exports;u4=1;function ae(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ae)}catch(me){console.error(me)}}return ae(),m2.exports=I6(),m2.exports}var z6=C6();const R6=v2(z6),D6={features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[[179.2223,-8.554],[179.2023,-8.4653],[179.2312,-8.5048],[179.2223,-8.554]]]},properties:{name:"Tuvalu",id:"TV"},id:"TV"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[3.4624,-54.4471],[3.3461,-54.4511],[3.3669,-54.3997],[3.4814,-54.4001],[3.4624,-54.4471]]]},properties:{name:"Bouvet Island",id:"BV"},id:"BV"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-5.3345,36.1623],[-5.3382,36.1122],[-5.3562,36.1264],[-5.3551,36.1455],[-5.3345,36.1623]]]},properties:{name:"Gibraltar",id:"GI"},id:"GI"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[47.3029,-11.5752],[47.282,-11.5747],[47.2789,-11.5574],[47.2971,-11.5543],[47.3029,-11.5752]]]},properties:{name:"Glorioso Islands",id:"GO"},id:"GO"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[42.7579,-17.075],[42.7415,-17.0741],[42.7379,-17.0519],[42.761,-17.0652],[42.7579,-17.075]]]},properties:{name:"Juan De Nova Island",id:"JU"},id:"JU"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-160.0213,-.398],[-160.0453,-.3802],[-160.0178,-.3744],[-160.0213,-.398]]]},properties:{name:"Jarvis Island",id:"UM-DQ"},id:"UM-DQ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-176.456,.2226],[-176.4615,.215],[-176.4675,.2195],[-176.456,.2226]]]},properties:{name:"Baker Island",id:"UM-FQ"},id:"UM-FQ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-176.6311,.7952],[-176.6433,.7934],[-176.6429,.8081],[-176.6329,.8085],[-176.6311,.7952]]]},properties:{name:"Howland Island",id:"UM-HQ"},id:"UM-HQ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-169.5237,16.7305],[-169.5388,16.7243],[-169.5388,16.7296],[-169.5237,16.7305]]]},properties:{name:"Johnston Atoll",id:"UM-JQ"},id:"UM-JQ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-177.3881,28.1865],[-177.3879,28.2144],[-177.3646,28.2042],[-177.3881,28.1865]]]},properties:{name:"Midway Islands",id:"UM-MQ"},id:"UM-MQ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[166.6588,19.2829],[166.6087,19.3073],[166.6277,19.3246],[166.6588,19.3117],[166.6588,19.2829]]]},properties:{name:"Wake Island",id:"UM-WQ"},id:"UM-WQ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-68.2058,12.1446],[-68.2873,12.1717],[-68.3711,12.2574],[-68.3694,12.3018],[-68.2196,12.2312],[-68.2058,12.1446]]]},properties:{name:"Bonair, Saint Eustachius and Saba",id:"BQ"},id:"BQ"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[4.2263,51.3865],[3.9023,51.2076],[3.35,51.3776],[4.2263,51.3865]]],[[[4.2263,51.3865],[3.5871,51.454],[4.4829,52.3091],[4.7687,52.9412],[5.1203,52.3881],[5.5611,52.5948],[5.3755,53.0957],[6.0622,53.4071],[6.8164,53.4413],[7.1973,53.2823],[7.0352,52.3801],[6.7418,51.9109],[5.9486,51.7625],[6.1932,51.4888],[5.8949,50.9843],[5.9939,50.7504],[5.7972,50.7546],[5.6938,50.7748],[5.827,51.1257],[4.5033,51.4746],[4.2263,51.3865]]]]},properties:{name:"Netherlands",id:"NL"},id:"NL"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[31.2877,-22.4021],[30.4603,-22.3289],[29.6631,-22.1465],[29.3648,-22.194],[29.0372,-21.8113],[28.0455,-21.5729],[27.6696,-21.0642],[27.6997,-20.5307],[27.2807,-20.4788],[27.2217,-20.1458],[26.6784,-19.8928],[26.1683,-19.5381],[25.7613,-18.6495],[25.2242,-17.9153],[25.2588,-17.7936],[25.8634,-17.9521],[27.0206,-17.9583],[27.9323,-16.8961],[28.7606,-16.5321],[28.9129,-15.9879],[29.7297,-15.6448],[30.3959,-15.643],[30.4377,-15.9954],[31.2362,-16.0239],[31.9398,-16.4287],[32.2434,-16.4487],[32.9479,-16.7123],[32.9932,-18.3596],[32.7166,-19.0019],[33.0069,-19.8737],[32.4778,-20.7131],[32.3713,-21.335],[31.2877,-22.4021]]]},properties:{name:"Zimbabwe",id:"ZW"},id:"ZW"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[32.9199,-9.4072],[33.3509,-9.8622],[33.659,-10.5906],[33.2613,-10.8934],[33.3798,-11.1579],[33.2262,-11.5348],[33.2524,-12.1127],[33.398,-12.49],[33.0216,-12.6303],[32.9679,-13.2251],[32.6722,-13.6104],[32.9812,-14.0095],[33.2018,-14.0135],[31.729,-14.496],[30.2317,-14.9905],[30.3959,-15.643],[29.7297,-15.6448],[28.9129,-15.9879],[28.7606,-16.5321],[27.9323,-16.8961],[27.0206,-17.9583],[25.8634,-17.9521],[25.2588,-17.7936],[24.9325,-17.5433],[24.2751,-17.4812],[23.3807,-17.6405],[22.1507,-16.5974],[21.9798,-15.9555],[21.9789,-13.0009],[23.8432,-13.0009],[23.9915,-12.4221],[23.9666,-10.8716],[24.32,-11.0718],[24.5184,-11.4384],[25.1847,-11.2431],[25.3493,-11.6231],[26.0258,-11.8903],[26.5962,-11.972],[26.9496,-11.8988],[27.0459,-11.616],[27.5333,-12.1953],[28.3576,-12.482],[29.0141,-13.3689],[29.5543,-13.2491],[29.7954,-13.3929],[29.7954,-12.1553],[29.4274,-12.4314],[29.0643,-12.3489],[28.4823,-11.8122],[28.3572,-11.4828],[28.639,-10.6692],[28.6301,-9.8311],[28.4007,-9.2248],[28.9178,-8.7005],[28.9724,-8.4648],[30.7511,-8.1936],[31.0764,-8.6117],[31.3508,-8.6069],[31.9425,-9.0539],[32.4334,-9.1564],[32.9199,-9.4072]]]},properties:{name:"Zambia",id:"ZM"},id:"ZM"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[31.2877,-22.4021],[31.5456,-23.4821],[31.7995,-23.8923],[31.986,-24.4605],[31.9482,-25.9577],[31.4151,-25.7464],[31.2074,-25.8432],[30.8034,-26.4136],[30.7941,-26.7643],[31.0636,-27.1123],[31.4697,-27.2956],[31.9584,-27.3058],[32.1129,-26.8393],[32.8862,-26.8495],[32.5346,-28.1998],[32.2856,-28.6215],[31.7782,-28.9371],[31.3352,-29.3779],[30.2885,-30.9701],[28.8561,-32.2943],[27.8604,-33.0538],[27.0774,-33.5212],[26.4293,-33.7596],[25.9894,-33.7112],[25.6383,-34.0112],[25.0031,-33.9735],[24.8273,-34.1688],[23.5858,-33.9851],[23.2684,-34.0814],[22.2456,-34.0694],[21.7889,-34.3726],[21.06,-34.3646],[20.53,-34.4631],[20.0204,-34.7858],[19.6351,-34.7534],[18.8086,-34.108],[18.3545,-33.9389],[18.4331,-33.7174],[17.8782,-32.9614],[18.2511,-32.652],[18.3105,-32.1225],[18.2107,-31.7425],[17.6776,-31.019],[17.1893,-30.0997],[16.95,-29.4036],[16.4475,-28.6175],[16.7556,-28.4524],[17.0561,-28.0311],[17.3855,-28.3534],[17.4481,-28.6983],[18.1028,-28.8719],[19.2458,-28.9016],[19.6715,-28.5039],[19.9805,-28.4515],[19.9805,-26.5312],[19.9805,-24.777],[20.3453,-25.03],[20.7932,-25.9155],[20.6268,-26.4438],[20.74,-26.849],[21.6464,-26.8544],[22.0907,-26.5801],[22.6403,-26.0714],[22.8786,-25.4579],[23.2662,-25.2666],[23.8938,-25.6008],[24.7483,-25.8174],[25.5837,-25.6062],[25.9122,-24.7477],[26.3974,-24.6136],[26.835,-24.2407],[27.1462,-23.5243],[27.8906,-23.0737],[28.2102,-22.6938],[28.8397,-22.4807],[29.3648,-22.194],[29.6631,-22.1465],[30.4603,-22.3289],[31.2877,-22.4021]],[[27.8303,-28.9091],[27.2945,-29.5195],[27.0517,-29.6642],[27.3886,-30.3158],[28.018,-30.6421],[28.3922,-30.1476],[29.098,-29.919],[29.3905,-29.2696],[29.3013,-29.0898],[28.6257,-28.5816],[27.8303,-28.9091]]]},properties:{name:"South Africa",id:"ZA"},id:"ZA"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[53.0855,16.6484],[52.3278,16.2937],[52.2177,15.6554],[51.6038,15.3367],[50.5269,15.0384],[50.1669,14.8511],[49.3497,14.638],[48.6683,14.0503],[47.9901,14.0481],[47.4077,13.6614],[46.7889,13.4657],[45.6574,13.3387],[45.0386,12.8158],[44.6178,12.8171],[43.9298,12.6165],[43.4752,12.8389],[43.232,13.2672],[43.2826,13.6397],[43.089,14.0108],[43.0211,14.555],[42.7171,15.6545],[42.7992,16.3718],[43.1649,16.6892],[43.1911,17.3595],[43.418,17.5162],[43.9169,17.3249],[44.1557,17.3986],[45.1483,17.4274],[45.4066,17.32],[46.3104,17.2312],[46.6819,17.2685],[46.9758,16.9533],[47.4418,17.1118],[47.5795,17.4483],[48.172,18.1567],[49.0421,18.582],[51.9775,18.9961],[52.729,17.3005],[53.0855,16.6484]]]},properties:{name:"Yemen",id:"YE"},id:"YE"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-172.3335,-13.4653],[-172.225,-13.8044],[-172.5357,-13.7915],[-172.7441,-13.5789],[-172.3335,-13.4653]]]},properties:{name:"Samoa",id:"WS"},id:"WS"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-178.0467,-14.3184],[-178.1585,-14.3118],[-178.1423,-14.2425],[-178.0467,-14.3184]]]},properties:{name:"Wallis and Futuna",id:"WF"},id:"WF"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[34.2454,31.2085],[34.1983,31.3226],[34.4775,31.5849],[34.2454,31.2085]]],[[[35.4505,31.4793],[34.9507,31.6022],[34.9561,32.1611],[35.1931,32.5344],[35.5513,32.3955],[35.5589,31.7656],[35.4505,31.4793]]]]},properties:{name:"Palestinian Territories",id:"PS"},id:"PS"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[166.7458,-14.8267],[166.8102,-15.1574],[167.1316,-15.1352],[167.1995,-15.4859],[166.8257,-15.635],[166.6313,-15.406],[166.5274,-14.8502],[166.7458,-14.8267]]],[[[167.4125,-16.0958],[167.8365,-16.4495],[167.4494,-16.5552],[167.4125,-16.0958]]]]},properties:{name:"Vanuatu",id:"VU"},id:"VU"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[107.9727,21.5081],[107.4099,21.2848],[107.3544,21.0553],[106.6757,20.9603],[106.7534,20.7348],[106.5181,20.2887],[105.9841,19.9389],[105.6219,18.9664],[105.8882,18.5025],[106.499,17.9463],[106.479,17.7195],[107.1804,16.8978],[108.0296,16.331],[108.8215,15.378],[109.0847,14.7161],[109.3035,13.8563],[109.272,13.2792],[109.4238,12.9561],[109.2187,12.6458],[109.1988,11.7247],[108.8206,11.3155],[108.2715,10.9342],[107.2616,10.3984],[106.8128,10.4334],[106.5723,9.6411],[105.5011,9.0933],[105.3223,8.8013],[104.8921,8.5833],[104.8184,8.8017],[104.8451,9.606],[105.028,10.0672],[104.6635,10.1698],[104.4265,10.4112],[104.8504,10.5347],[105.3866,10.9399],[106.1679,11.0123],[105.8558,11.2941],[105.8514,11.6351],[106.3401,11.6817],[106.4138,11.9484],[106.9305,12.0776],[107.5062,12.3644],[107.4756,13.0302],[107.6056,13.4377],[107.3313,14.1266],[107.5195,14.705],[107.6531,15.255],[107.1897,15.7473],[107.3966,16.0429],[106.6961,16.4588],[106.5021,16.9542],[105.6916,17.7377],[105.4581,18.1545],[105.0857,18.4501],[105.115,18.6787],[104.7163,18.8035],[103.8965,19.3401],[104.0319,19.6753],[104.5463,19.6105],[104.9281,20.018],[104.6187,20.3744],[104.5832,20.6465],[104.0518,20.9413],[103.635,20.6971],[103.1046,20.8915],[102.8511,21.2657],[102.9488,21.5698],[102.1276,22.379],[102.5173,22.7408],[103.0051,22.4532],[103.3008,22.7643],[104.3719,22.704],[104.7958,22.9112],[104.8646,23.1363],[105.2752,23.3454],[105.8429,22.9228],[106.5421,22.9081],[106.7804,22.779],[106.5363,22.3954],[106.7294,22.0004],[107.3513,21.6089],[107.9727,21.5081]]]},properties:{name:"Vietnam",id:"VN"},id:"VN"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-64.7656,17.7945],[-64.6862,17.7062],[-64.889,17.7017],[-64.8848,17.7723],[-64.7656,17.7945]]]},properties:{name:"US Virgin Islands",id:"VI"},id:"VI"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-64.3952,18.4648],[-64.4261,18.5132],[-64.3246,18.5176],[-64.3952,18.4648]]]},properties:{name:"British Virgin Islands",id:"VG"},id:"VG"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-60.0175,8.5491],[-59.8315,8.3059],[-60.0324,8.0537],[-60.5136,7.8131],[-60.7191,7.4989],[-60.3951,6.9453],[-61.1457,6.6945],[-61.1286,6.2142],[-61.3767,5.9071],[-60.7422,5.2022],[-60.6046,4.9944],[-61.0028,4.5354],[-62.1531,4.0982],[-62.7122,4.0179],[-62.9685,3.594],[-63.2948,3.9224],[-64.0214,3.9291],[-64.2556,4.1404],[-64.5679,3.8998],[-64.2212,3.5873],[-64.2188,3.2047],[-63.9242,2.4523],[-63.3893,2.4119],[-63.394,2.2223],[-64.0354,1.9045],[-64.1149,1.6191],[-65.1037,1.1082],[-65.3609,.8685],[-65.6814,.9834],[-66.06,.7854],[-66.4293,.8218],[-66.8761,1.2231],[-67.2108,2.3901],[-67.8347,2.8926],[-67.3111,3.416],[-67.6616,3.8643],[-67.8553,4.507],[-67.8249,5.2705],[-67.4394,6.0256],[-67.8591,6.2897],[-68.4717,6.1565],[-69.4392,6.1348],[-70.095,6.9378],[-70.6552,7.0829],[-71.0134,6.9946],[-72.0843,7.0967],[-72.443,7.4549],[-72.4166,8.3818],[-72.6654,8.6277],[-72.7963,9.1089],[-73.3563,9.2269],[-73.0065,9.7894],[-72.8693,10.4911],[-72.6902,10.8361],[-72.2485,11.1965],[-71.958,11.6666],[-71.3197,11.8619],[-71.8686,11.6275],[-71.9469,11.4144],[-71.5942,10.6572],[-72.1129,9.8155],[-71.6868,9.0725],[-71.2979,9.1257],[-71.0858,9.3481],[-71.0527,9.7059],[-71.3867,10.2639],[-71.5445,10.7788],[-71.4695,10.9643],[-70.2326,11.3732],[-70.2865,11.8859],[-70.004,12.1779],[-69.6316,11.4801],[-68.8279,11.4318],[-68.3987,11.161],[-68.234,10.5693],[-67.8715,10.4721],[-66.9891,10.6106],[-66.2471,10.6323],[-65.8518,10.2577],[-65.1292,10.0699],[-64.8504,10.0979],[-63.8734,10.6638],[-62.7024,10.7499],[-62.8429,10.4179],[-62.5151,10.176],[-60.7923,9.3606],[-61.0531,9.0951],[-61.3039,8.4102],[-60.801,8.5922],[-60.0175,8.5491]]]},properties:{name:"Venezuela",id:"VE"},id:"VE"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-61.1745,13.1581],[-61.2773,13.2095],[-61.1821,13.356],[-61.1239,13.2939],[-61.1745,13.1581]]]},properties:{name:"Saint Vincent and the Grenadines",id:"VC"},id:"VC"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[12.4392,41.8983],[12.4307,41.8974],[12.4307,41.9054],[12.4383,41.9063],[12.4392,41.8983]]]},properties:{name:"Vatican City",id:"VA"},id:"VA"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[70.9468,42.2485],[70.8421,42.0195],[70.1811,41.5716],[70.7826,41.2626],[71.4085,41.1361],[71.7924,41.4131],[72.6585,40.8698],[73.113,40.7859],[71.6926,40.1525],[70.9579,40.239],[70.3826,40.4534],[70.7511,40.7397],[70.4417,41.0234],[69.7128,40.6572],[69.2063,40.5666],[69.2281,40.1875],[68.6528,40.1827],[68.4632,39.5368],[67.7193,39.6216],[67.3495,39.242],[67.6767,39.0086],[68.1037,38.9619],[68.0478,38.6694],[68.2941,38.0329],[67.8143,37.4869],[67.7592,37.1722],[67.069,37.3346],[66.5221,37.3484],[66.5745,38.0107],[65.8572,38.2686],[65.613,38.2384],[64.1628,38.9535],[62.6505,39.8586],[61.903,41.0935],[60.455,41.2218],[60.0897,41.3994],[60.107,41.9076],[59.8584,42.2951],[59.4509,42.2996],[58.5889,42.7785],[58.2595,42.688],[57.8143,42.1899],[57.3819,42.1562],[56.9642,41.8566],[57.0179,41.2635],[55.9774,41.3221],[55.9766,42.929],[55.9757,44.9949],[58.5551,45.5555],[61.0081,44.3939],[61.1608,44.1688],[61.9904,43.4923],[63.2071,43.6281],[64.4434,43.5513],[64.9054,43.7147],[65.4963,43.3108],[65.803,42.8771],[66.1004,42.9907],[66.0094,42.0048],[66.4986,41.9951],[66.6686,41.2706],[66.8142,41.1423],[67.9359,41.1965],[68.2919,40.6563],[69.0652,41.367],[70.0954,41.8206],[70.4159,42.0785],[70.9468,42.2485]]]},properties:{name:"Uzbekistan",id:"UZ"},id:"UZ"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-166.1355,60.3835],[-165.7298,60.3143],[-165.5917,59.9132],[-166.1876,59.7738],[-167.1389,60.0086],[-166.1355,60.3835]]],[[[-171.4631,63.6401],[-170.4304,63.6989],[-169.7778,63.0937],[-171.4631,63.6401]]],[[[-141.0021,69.6509],[-141.0021,68.4819],[-141.0021,65.56],[-141.0021,63.2222],[-141.0021,60.3003],[-139.1852,60.0837],[-137.5932,59.2263],[-137.4385,58.9031],[-136.5787,59.1522],[-136.3219,59.6049],[-135.4759,59.7934],[-134.9439,59.2882],[-133.8208,58.7049],[-131.8661,56.7929],[-131.5752,56.5989],[-130.4772,56.2307],[-130.0251,55.8882],[-130.0366,55.2978],[-130.2142,55.026],[-130.5753,54.7696],[-131.0478,55.1576],[-130.9186,55.736],[-131.8439,56.1601],[-132.8143,57.0408],[-133.4659,57.1722],[-133.5543,57.6951],[-134.0634,58.2111],[-134.7761,58.4539],[-135.3025,58.2559],[-135.8618,58.5771],[-136.5827,58.2453],[-137.544,58.5811],[-138.3525,59.0873],[-140.2168,59.7266],[-140.8432,59.749],[-141.6702,59.9698],[-142.9457,60.097],[-143.8051,60.0129],[-144.9012,60.3351],[-145.8989,60.4783],[-146.8741,61.005],[-148.3445,60.8536],[-148.1976,60.1678],[-148.4306,59.9891],[-149.4323,60.0011],[-150.9608,59.244],[-151.7383,59.1886],[-151.7345,59.9882],[-151.4515,60.2026],[-151.3217,60.7428],[-150.4412,61.0236],[-150.6124,61.3013],[-151.7341,60.9106],[-151.7505,60.7548],[-153.1061,59.875],[-154.0883,59.3632],[-154.1298,59.12],[-153.327,58.8843],[-154.0199,58.493],[-154.2469,58.1594],[-155.0069,58.016],[-156.4784,57.328],[-156.4751,57.1051],[-157.5784,56.6344],[-158.4144,56.4358],[-158.2757,56.1963],[-159.5233,55.8101],[-159.9623,55.7948],[-161.0995,55.4057],[-161.7416,55.3911],[-162.0741,55.1394],[-162.8651,54.9545],[-162.9621,55.1838],[-162.1571,55.7195],[-161.2156,56.0214],[-160.8514,55.7719],[-160.3021,56.3141],[-159.2831,56.6886],[-158.321,57.2978],[-157.6077,57.6014],[-157.5235,58.4213],[-158.5032,58.8503],[-159.0827,58.4697],[-159.6702,58.9111],[-160.3631,59.0512],[-161.7554,58.6119],[-161.8286,59.5887],[-162.2425,60.1782],[-163.2193,59.8455],[-163.9069,59.8067],[-164.6622,60.3038],[-165.3538,60.5413],[-164.8051,60.892],[-165.566,61.1024],[-166.0789,61.8031],[-165.1944,62.4736],[-164.409,63.2151],[-163.3589,63.0458],[-161.974,63.453],[-161.0997,63.558],[-160.7786,63.819],[-160.932,64.5792],[-161.7594,64.8162],[-162.807,64.3743],[-163.7132,64.5883],[-164.8995,64.4607],[-166.1428,64.5827],[-167.4039,65.4221],[-168.0884,65.6578],[-164.6742,66.5549],[-163.7755,66.5312],[-163.6954,66.0838],[-161.8164,66.0536],[-161.557,66.2504],[-160.2317,66.4202],[-160.864,66.6708],[-161.8566,66.7003],[-161.9653,67.0497],[-163.0016,67.0272],[-163.7205,67.1955],[-164.1251,67.6067],[-166.3805,68.4251],[-166.2092,68.8854],[-164.3024,68.9364],[-163.1614,69.3879],[-162.9521,69.7581],[-161.881,70.3318],[-160.9963,70.3045],[-159.3144,70.8785],[-157.9985,70.8454],[-156.7833,71.319],[-155.1669,71.0993],[-154.1952,70.801],[-153.2329,70.9326],[-152.233,70.8103],[-151.9447,70.4521],[-149.2694,70.5007],[-147.7053,70.2173],[-145.8232,70.16],[-145.1973,70.0086],[-143.2184,70.1163],[-141.4078,69.6533],[-141.0021,69.6509]]],[[[-155.5813,19.0121],[-155.8814,19.0707],[-156.0487,19.7498],[-155.8316,20.2759],[-155.1989,19.9944],[-154.8043,19.5244],[-155.5813,19.0121]]],[[[-72.5098,40.9861],[-73.1943,40.6541],[-73.5738,40.9195],[-72.5098,40.9861]]],[[[-93.3778,48.6166],[-92.9963,48.6117],[-91.5183,48.0582],[-90.8403,48.2007],[-89.4556,47.996],[-88.3782,48.3032],[-84.8759,46.9001],[-84.5617,46.4575],[-84.1921,46.5494],[-83.9777,46.0851],[-83.5926,45.817],[-82.5511,45.3473],[-82.1378,43.5709],[-82.5453,42.6245],[-83.0731,42.3005],[-83.1419,41.976],[-82.439,41.675],[-81.2778,42.209],[-80.2475,42.3662],[-79.0368,42.8025],[-79.1719,43.4666],[-78.7205,43.625],[-76.82,43.6286],[-76.4646,44.0574],[-75.1793,44.8994],[-74.7088,45.0038],[-71.5175,45.0078],[-71.3272,45.2901],[-70.898,45.2626],[-70.2963,45.9062],[-70.0078,46.7088],[-69.243,47.4629],[-68.8288,47.2032],[-68.311,47.3546],[-67.8067,47.083],[-67.7845,45.7016],[-67.4328,45.603],[-67.4725,45.2759],[-67.1249,45.1693],[-67.1067,44.8852],[-67.9071,44.4538],[-68.2775,44.5075],[-69.7916,43.8053],[-70.1789,43.7662],[-70.829,42.8251],[-71.0463,42.3311],[-70.7382,42.229],[-70.4046,41.6271],[-70.6572,41.5343],[-71.4265,41.6333],[-71.5228,41.3789],[-72.8471,41.2657],[-73.5831,41.022],[-74.2267,40.6079],[-73.9575,40.3282],[-74.1761,39.7268],[-74.4289,39.3872],[-74.897,39.1453],[-75.3922,39.0929],[-75.036,38.5034],[-75.6592,37.9539],[-76.2948,38.4945],[-76.2635,37.3568],[-75.8905,36.6568],[-76.4788,36.0283],[-75.7722,35.9],[-75.7739,35.647],[-76.513,35.2705],[-76.7449,34.9412],[-77.7508,34.2851],[-78.0134,33.9118],[-78.5778,33.8732],[-78.9202,33.6588],[-79.276,33.1354],[-80.8492,32.114],[-81.5203,30.8747],[-81.2496,29.7938],[-80.9,29.0498],[-80.524,28.4861],[-80.6501,28.1811],[-80.2262,27.2072],[-80.0413,26.5685],[-80.1263,25.8334],[-80.3669,25.3313],[-80.7366,25.1565],[-81.0978,25.3194],[-81.365,25.8312],[-81.7154,25.983],[-81.8666,26.4349],[-82.4414,27.0599],[-82.6609,27.7186],[-82.8436,27.846],[-82.6607,28.4857],[-82.6516,28.8874],[-83.2906,29.452],[-83.6943,29.9261],[-84.0443,30.1036],[-84.3828,29.9074],[-85.3189,29.6802],[-85.3536,29.8759],[-86.2573,30.4929],[-87.7903,30.2918],[-88.9051,30.4152],[-89.5885,30.1658],[-90.2253,30.3793],[-90.4131,30.1405],[-89.5894,29.915],[-90.1014,29.1817],[-90.3793,29.2953],[-90.7511,29.1311],[-91.2902,29.2891],[-91.331,29.5137],[-91.8932,29.836],[-92.2608,29.5568],[-93.1756,29.7792],[-93.6947,29.7698],[-94.8884,29.3708],[-95.2734,28.9637],[-95.8534,28.6401],[-96.4487,28.5944],[-96.5616,28.3671],[-97.1564,28.1443],[-97.1715,27.8797],[-97.5546,26.9675],[-97.4024,26.3967],[-97.1462,25.9617],[-97.3582,25.8707],[-98.0828,26.0642],[-99.1078,26.4469],[-99.4436,27.0368],[-99.5053,27.5482],[-100.2961,28.3276],[-100.6587,29.0685],[-101.4404,29.7769],[-102.269,29.871],[-102.7342,29.6438],[-102.892,29.2163],[-103.2577,29.001],[-104.1107,29.3863],[-104.504,29.6775],[-104.9179,30.5835],[-106.2558,31.5445],[-106.4533,31.77],[-108.2118,31.7793],[-108.2145,31.3292],[-111.042,31.3243],[-112.939,31.916],[-114.836,32.5082],[-114.7248,32.7155],[-117.1282,32.5335],[-117.4674,33.2957],[-118.5063,34.0174],[-119.1437,34.112],[-119.6061,34.4178],[-120.4812,34.4715],[-120.6448,34.5798],[-120.6337,35.0766],[-120.8603,35.3655],[-121.8774,36.331],[-121.79,36.7323],[-122.3948,37.2077],[-122.4669,37.838],[-122.9681,38.0968],[-122.9865,38.277],[-123.7012,38.9073],[-123.8845,39.8608],[-124.324,40.2519],[-124.3717,40.4912],[-124.0685,41.3843],[-124.5397,42.8127],[-124.1486,43.6916],[-123.9293,45.5768],[-124.0716,46.7447],[-124.3761,47.6587],[-124.6211,47.9042],[-124.6327,48.3751],[-123.9757,48.1683],[-122.2421,48.0107],[-122.7888,48.993],[-120.1281,48.993],[-118.4226,48.993],[-115.8643,48.993],[-112.4532,48.993],[-109.895,48.993],[-106.4839,48.993],[-103.9256,48.993],[-102.2201,48.993],[-99.2354,48.993],[-97.5297,48.9932],[-95.162,48.9917],[-94.6209,48.7427],[-93.7078,48.5256],[-93.3778,48.6166]]],[[[-163.4761,54.9807],[-163.3581,54.7357],[-164.5907,54.4043],[-164.8877,54.6078],[-164.5297,54.8808],[-163.4761,54.9807]]],[[[-130.9792,55.4892],[-131.0827,55.2668],[-131.8111,55.223],[-131.6249,55.8316],[-130.9792,55.4892]]],[[[-133.566,56.3392],[-133.2029,56.3199],[-131.9764,55.2086],[-131.9809,54.8049],[-132.7823,55.0484],[-133.4471,55.797],[-133.566,56.3392]]],[[[-133.3663,57.0035],[-132.9541,56.8803],[-133.2127,56.4646],[-133.6029,56.4642],[-133.8661,57.0687],[-133.3663,57.0035]]],[[[-134.9698,57.3515],[-134.6207,56.7183],[-135.787,57.3173],[-134.9698,57.3515]]],[[[-152.898,57.8238],[-152.4121,57.4547],[-153.7933,56.9895],[-154.3391,56.9209],[-154.7059,57.3353],[-154.2813,57.638],[-153.8184,57.5956],[-152.898,57.8238]]],[[[-135.7304,58.2442],[-135.002,58.0511],[-135.0848,57.5111],[-136.0767,57.6747],[-136.5123,58.0959],[-135.7304,58.2442]]],[[[-134.6802,58.1616],[-133.9611,57.6143],[-133.9253,57.3369],[-134.4354,57.057],[-134.66,57.638],[-134.6802,58.1616]]]]},properties:{name:"United States",id:"US"},id:"US"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-53.3707,-33.7422],[-53.7853,-34.3806],[-54.1686,-34.6709],[-54.9023,-34.9328],[-55.6732,-34.7756],[-56.1179,-34.9079],[-56.8552,-34.6766],[-57.1706,-34.4525],[-57.8291,-34.4773],[-58.4002,-33.9123],[-58.3534,-33.2602],[-58.0824,-32.8935],[-58.2011,-32.4718],[-58.1889,-31.9241],[-57.8105,-30.8587],[-57.8724,-30.5911],[-57.609,-30.188],[-57.2144,-30.2834],[-56.8328,-30.1072],[-56.1761,-30.6283],[-55.8736,-31.0696],[-55.5573,-30.876],[-55.2546,-31.2258],[-54.5876,-31.4851],[-54.2205,-31.8553],[-53.7618,-32.0568],[-53.6017,-32.403],[-53.1254,-32.7368],[-53.5314,-33.171],[-53.3707,-33.7422]]]},properties:{name:"Uruguay",id:"UY"},id:"UY"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[38.2142,47.0914],[37.5435,47.0745],[37.3398,46.9169],[36.2793,46.6586],[35.827,46.6244],[34.8495,46.1898],[35.0231,45.7011],[35.558,45.3109],[36.1705,45.453],[36.3934,45.0655],[35.5695,45.1192],[35.0879,44.8027],[34.7168,44.8071],[33.9098,44.3876],[33.4508,44.5537],[33.5551,45.0979],[32.508,45.4037],[33.6648,45.947],[33.2022,46.1756],[32.4769,46.0838],[32.0357,46.2609],[31.9744,46.7088],[30.7963,46.5521],[30.2193,45.8667],[29.6018,45.6825],[29.7061,45.2599],[29.2236,45.4028],[28.7606,45.2341],[28.2124,45.4503],[28.9475,46.05],[29.1464,46.5268],[29.838,46.3505],[29.8779,46.829],[29.5494,47.2467],[29.1597,47.4558],[29.1948,47.8824],[27.5493,48.4777],[26.6189,48.2597],[26.1625,47.9925],[24.8935,47.7177],[23.2027,48.0844],[22.8764,47.9472],[22.132,48.4053],[22.5386,49.0727],[22.6496,49.539],[23.7118,50.3773],[24.1056,50.8449],[23.6053,51.5179],[24.3617,51.8674],[25.9251,51.9136],[27.1422,51.752],[27.2701,51.6135],[28.5991,51.5427],[29.1357,51.6173],[29.3466,51.3825],[30.5331,51.5964],[30.9806,52.0461],[31.7636,52.1012],[32.508,52.3084],[33.7353,52.3448],[34.3976,51.7804],[34.2809,51.3117],[35.3121,51.0438],[35.4115,50.5398],[36.3059,50.2805],[37.4228,50.4115],[38.0469,49.9201],[38.2586,50.0524],[39.1748,49.8559],[39.7807,49.5721],[40.0701,49.2003],[39.6866,49.0079],[39.9609,48.238],[39.7359,47.8447],[38.9005,47.8553],[38.2875,47.5592],[38.2142,47.0914]]]},properties:{name:"Ukraine",id:"UA"},id:"UA"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[33.9031,-1.0021],[32.1942,-1.0021],[30.8447,-1.0021],[30.51,-1.0674],[30.1016,-1.3688],[29.577,-1.3878],[29.5619,-.9772],[29.7177,.0983],[29.9343,.4991],[29.9427,.8192],[30.9424,1.683],[31.2527,2.0448],[31.1763,2.2703],[30.7284,2.4554],[30.8385,3.4905],[31.1523,3.7857],[31.4799,3.6805],[31.7982,3.8026],[32.0996,3.5291],[32.3358,3.7063],[32.8382,3.7986],[33.4894,3.7551],[33.9759,4.2203],[34.165,3.8128],[34.3928,3.6916],[34.4478,3.1634],[34.7425,2.818],[34.964,2.0625],[34.9654,1.6435],[34.7874,1.2307],[34.4815,1.042],[33.9431,.1738],[33.9031,-1.0021]]]},properties:{name:"Uganda",id:"UG"},id:"UG"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[33.9031,-1.0021],[34.7709,-1.4416],[36.2633,-2.2747],[37.6438,-3.0453],[37.6087,-3.4604],[37.7974,-3.6743],[39.2219,-4.6922],[38.8192,-5.8778],[38.8738,-6.3315],[39.4722,-6.8788],[39.5193,-7.1243],[39.2884,-7.518],[39.4411,-8.0116],[39.304,-8.444],[39.7838,-9.9146],[40.4634,-10.4641],[39.9889,-10.821],[39.3217,-11.1224],[38.7948,-11.2289],[38.4917,-11.4131],[37.9204,-11.2946],[37.5417,-11.675],[36.9789,-11.5667],[36.5185,-11.7163],[35.7852,-11.4531],[35.6312,-11.5818],[34.9596,-11.5783],[34.608,-11.0807],[34.6617,-10.71],[34.5241,-10.03],[34.3208,-9.7317],[32.9199,-9.4072],[32.4334,-9.1564],[31.9425,-9.0539],[31.3508,-8.6069],[31.0764,-8.6117],[30.7511,-8.1936],[30.3134,-7.2037],[29.7097,-6.6169],[29.4802,-6.0252],[29.5943,-5.651],[29.3426,-4.9829],[29.4034,-4.4494],[29.7177,-4.456],[30.1469,-4.0854],[30.4252,-3.5891],[30.7901,-3.2744],[30.5149,-2.9175],[30.5535,-2.3999],[30.8287,-2.3387],[30.8128,-1.5632],[30.51,-1.0674],[30.8447,-1.0021],[32.1942,-1.0021],[33.9031,-1.0021]]]},properties:{name:"Tanzania",id:"TZ"},id:"TZ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[121.009,22.6205],[120.5815,22.3564],[120.3258,22.5424],[120.0723,23.1496],[120.1589,23.7089],[121.0405,25.0326],[121.5936,25.2754],[121.9291,24.9736],[121.2957,22.9667],[121.009,22.6205]]]},properties:{name:"Taiwan",id:"TW"},id:"TW"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[41.5101,41.5174],[42.4663,41.4398],[42.7876,41.5636],[43.4393,41.1073],[43.7225,40.7193],[43.5693,40.4823],[43.7917,40.0703],[44.2893,40.0406],[44.7683,39.7037],[44.8171,39.6504],[44.023,39.3774],[44.4309,38.3569],[44.2112,37.9081],[44.5614,37.7448],[44.7652,37.1424],[44.2818,36.9782],[44.1562,37.2831],[43.5161,37.2445],[42.7748,37.3719],[42.3588,37.1087],[42.2683,37.2765],[41.5154,37.0892],[40.7058,37.0976],[40.0164,36.8259],[39.3568,36.6817],[38.7669,36.6932],[38.1916,36.9014],[37.4365,36.6435],[36.6584,36.8024],[36.1275,35.8316],[35.8927,35.9164],[35.811,36.3097],[36.1883,36.659],[36.0489,36.9107],[35.5375,36.5969],[34.6014,36.7847],[33.6945,36.1819],[32.7947,36.0358],[32.3775,36.1836],[32.0219,36.5352],[31.3525,36.8011],[30.6441,36.8654],[30.4838,36.3106],[29.6893,36.1565],[29.1433,36.3971],[29.0381,36.6937],[28.4837,36.8037],[28.1339,37.0297],[27.3491,37.0195],[27.0779,37.6875],[27.2323,37.9787],[26.6828,38.1985],[26.7636,38.7098],[27.0135,38.8869],[26.6819,39.2922],[26.1133,39.4675],[26.1812,39.99],[26.7378,40.4002],[27.4756,40.3198],[28.2892,40.4033],[29.3648,40.8094],[29.3222,41.2276],[31.2549,41.1077],[31.4582,41.3199],[32.3065,41.7296],[33.3816,42.0177],[34.7505,41.9569],[35.2978,41.7287],[36.0516,41.6826],[36.5097,41.2626],[38.3811,40.9244],[39.4265,41.1064],[40.2654,40.9612],[40.9597,41.2116],[41.5101,41.5174]]],[[[28.0145,41.9689],[28.3465,41.4664],[29.0572,41.2298],[28.7802,40.9741],[28.172,41.0806],[27.4996,40.9732],[27.2581,40.6874],[26.1053,40.6114],[26.0391,40.7269],[26.6246,41.4016],[26.321,41.7167],[26.6153,41.9649],[27.2949,42.0794],[28.0145,41.9689]]]]},properties:{name:"Trkiye",id:"TR"},id:"TR"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[11.5043,33.182],[11.5048,32.4137],[10.8265,32.0807],[10.115,31.4637],[10.2162,30.7832],[9.8952,30.3873],[9.5188,30.2293],[9.0439,32.0723],[8.3332,32.5437],[8.2111,32.9268],[7.7628,33.2331],[7.5,33.8323],[7.5138,34.0805],[8.2457,34.7339],[8.3944,35.204],[8.2457,35.8707],[8.2306,36.5454],[8.5764,36.9374],[9.6879,37.3404],[10.1962,37.2059],[10.5713,36.8796],[11.1266,36.8739],[10.5256,36.3235],[10.5908,35.8871],[11.0045,35.6336],[11.1199,35.2404],[10.5349,34.5448],[10.0648,34.2119],[10.1589,33.8501],[10.7227,33.5145],[11.0844,33.5629],[11.2025,33.2491],[11.5043,33.182]]]},properties:{name:"Tunisia",id:"TN"},id:"TN"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-61.0121,10.1343],[-61.5967,10.0646],[-61.4648,10.5391],[-61.0338,10.67],[-61.0121,10.1343]]]},properties:{name:"Trinidad and Tobago",id:"TT"},id:"TT"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-175.162,-21.1695],[-175.1567,-21.2636],[-175.3354,-21.1579],[-175.2255,-21.1188],[-175.162,-21.1695]]]},properties:{name:"Tonga",id:"TO"},id:"TO"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[125.0679,-9.512],[124.9223,-8.9424],[125.178,-8.6477],[125.8043,-8.4923],[126.6198,-8.4595],[126.9149,-8.7152],[126.3823,-8.9575],[125.4079,-9.2758],[125.0679,-9.512]]]},properties:{name:"Timor-Leste",id:"TL"},id:"TL"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[66.5221,37.3484],[65.7648,37.569],[65.5549,37.2512],[64.8162,37.1322],[64.5108,36.3408],[63.8623,36.0123],[63.1086,35.8187],[63.0566,35.4459],[62.6105,35.2333],[61.262,35.6194],[61.1195,36.6426],[60.3413,36.6377],[60.0626,36.9631],[59.5623,37.1788],[59.2409,37.5206],[58.8157,37.6835],[58.4357,37.6387],[57.4236,37.9477],[57.1937,38.2162],[56.4409,38.2495],[56.2287,38.0733],[55.5784,38.0999],[55.0755,37.9024],[54.7452,37.502],[53.9142,37.3435],[53.8237,37.9281],[53.8685,38.9491],[53.6177,39.2159],[53.125,39.432],[53.4721,39.6686],[53.4042,39.9603],[52.9874,39.9878],[52.7335,40.3988],[53.1454,40.825],[53.8698,40.6487],[54.7101,40.8911],[54.5921,41.1934],[54.0949,41.5192],[53.8463,42.0914],[52.9701,41.9764],[52.4938,41.7802],[53.2502,42.2059],[54.1211,42.3351],[54.9037,41.9192],[55.5451,41.2626],[55.9774,41.3221],[57.0179,41.2635],[56.9642,41.8566],[57.3819,42.1562],[57.8143,42.1899],[58.2595,42.688],[58.5889,42.7785],[59.4509,42.2996],[59.8584,42.2951],[60.107,41.9076],[60.0897,41.3994],[60.455,41.2218],[61.903,41.0935],[62.6505,39.8586],[64.1628,38.9535],[65.613,38.2384],[65.8572,38.2686],[66.5745,38.0107],[66.5221,37.3484]]]},properties:{name:"Turkmenistan",id:"TM"},id:"TM"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-172.4791,-8.5807],[-172.4836,-8.5829],[-172.4987,-8.5478],[-172.4874,-8.5563],[-172.4791,-8.5807]]]},properties:{name:"Tokelau",id:"TK"},id:"TK"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[70.9579,40.239],[70.4514,40.049],[69.9667,40.2022],[69.5304,40.0974],[69.229,39.761],[69.5987,39.5736],[70.6077,39.5643],[70.7333,39.4134],[71.4045,39.598],[71.8062,39.2758],[72.0428,39.3521],[73.2351,39.3743],[73.6315,39.4489],[73.8015,38.6068],[74.2773,38.6597],[74.7452,38.5101],[74.8912,37.2317],[74.2596,37.4154],[73.7496,37.2317],[73.4814,37.4718],[72.8955,37.2676],[71.8022,36.6941],[71.4329,37.1273],[71.5518,37.933],[71.2558,38.3068],[70.8789,38.4564],[70.2148,37.9246],[70.2512,37.664],[69.4922,37.553],[69.2649,37.1083],[68.9604,37.3249],[68.0677,36.9498],[67.7592,37.1722],[67.8143,37.4869],[68.2941,38.0329],[68.0478,38.6694],[68.1037,38.9619],[67.6767,39.0086],[67.3495,39.242],[67.7193,39.6216],[68.4632,39.5368],[68.6528,40.1827],[69.2281,40.1875],[69.2063,40.5666],[69.7128,40.6572],[70.4417,41.0234],[70.7511,40.7397],[70.3826,40.4534],[70.9579,40.239]]]},properties:{name:"Tajikistan",id:"TJ"},id:"TJ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[100.1225,20.3167],[100.5429,20.0885],[100.3977,19.7561],[100.6254,19.4999],[101.1546,19.5794],[101.2864,18.977],[101.0507,18.4071],[101.1133,18.0333],[100.9086,17.5837],[101.1053,17.4793],[102.1014,18.2104],[102.7175,17.8922],[103.0913,18.1381],[103.3669,18.4235],[103.9497,18.3192],[104.8162,17.3005],[104.7505,16.6475],[105.047,16.1601],[105.4062,15.9874],[105.6223,15.6998],[105.5131,15.3606],[105.4754,14.5301],[105.1833,14.3464],[104.7789,14.428],[103.1996,14.3326],[102.729,13.8421],[102.3198,13.5398],[102.4995,12.6698],[102.7557,12.4261],[102.7366,12.0896],[102.9341,11.7065],[102.7628,12.0124],[101.7236,12.6893],[101.4449,12.6187],[100.8634,12.7146],[100.9628,13.4319],[100.6561,13.5212],[100.0173,13.3534],[100.0901,13.0457],[99.964,12.6902],[99.9889,12.1708],[99.6271,11.4628],[99.4869,10.8898],[99.165,10.3198],[99.1606,9.7339],[99.3936,9.2136],[99.7239,9.3144],[99.9046,9.1129],[99.9605,8.6712],[100.2792,8.2686],[100.4537,7.4425],[100.5864,7.1762],[101.0178,6.861],[101.4977,6.8654],[102.1009,6.2422],[101.8737,5.8254],[101.5563,5.908],[101.2571,5.7894],[101.0533,6.2427],[100.3453,6.5498],[100.119,6.442],[99.6959,6.8765],[99.7203,7.106],[99.051,7.8877],[98.5791,8.3445],[98.2382,8.4231],[98.3714,9.2904],[98.7025,10.1902],[98.7571,10.6612],[99.1903,11.1051],[99.6147,11.7811],[99.4052,12.5477],[99.2196,12.7399],[99.1366,13.7165],[98.2462,14.8147],[98.1911,15.204],[98.5653,15.4037],[98.6892,16.3052],[98.4388,16.9755],[97.793,17.6813],[97.4849,18.4941],[97.7539,18.621],[97.8169,19.46],[98.1112,19.7623],[98.9169,19.7729],[99.0208,20.0419],[99.3382,20.0788],[99.8904,20.4246],[100.1225,20.3167]]]},properties:{name:"Thailand",id:"TH"},id:"TH"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[.9007,10.9932],[.7799,10.3598],[1.3299,9.9971],[1.4244,9.2851],[1.6002,9.0498],[1.6224,6.2169],[1.1874,6.0895],[.7369,6.4526],[.5256,6.8508],[.6348,7.3537],[.5837,8.1456],[.688,8.3041],[.4153,8.6525],[.5291,9.3583],[.2619,9.4955],[.3627,10.2364],[-.0577,10.6305],[-.0686,11.1157],[.9007,10.9932]]]},properties:{name:"Togo",id:"TG"},id:"TG"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[22.86,10.9195],[22.4938,10.9963],[21.7063,10.5746],[21.7258,10.3664],[21.2638,9.9745],[20.7733,9.4058],[20.3422,9.1271],[19.1455,9.0161],[19.1087,8.6561],[18.4553,8.032],[17.6496,7.9836],[16.7849,7.5508],[16.3787,7.6835],[15.8452,7.4753],[15.4803,7.5237],[15.443,7.8518],[15.1163,8.5571],[14.3324,9.2034],[13.9773,9.6917],[14.2432,9.9798],[15.5411,9.9603],[15.1323,10.6483],[15.0297,11.1135],[15.0812,11.8455],[14.7612,12.6556],[14.5162,12.9796],[14.0638,13.0786],[13.6062,13.7045],[13.4481,14.3805],[14.3679,15.7499],[15.4745,16.9085],[15.7351,19.9039],[15.949,20.3034],[15.5873,20.7335],[15.6072,20.9546],[15.182,21.5232],[15.1722,21.9223],[14.9791,22.996],[15.9841,23.4452],[17.7521,22.5721],[19.6684,21.6257],[21.5847,20.6794],[23.9804,19.4968],[23.9822,17.2663],[23.9835,15.7801],[23.105,15.7024],[22.9323,15.1622],[22.6709,14.7223],[22.3815,14.5505],[22.5098,14.1275],[22.1076,13.7302],[22.2283,13.3294],[21.8253,12.7905],[22.3522,12.6604],[22.5564,11.6697],[22.9226,11.3448],[22.86,10.9195]]]},properties:{name:"Chad",id:"TD"},id:"TD"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.6615,21.7651],[-71.8304,21.7904],[-71.8062,21.8521],[-71.6684,21.8335],[-71.6615,21.7651]]]},properties:{name:"Turks and Caicos Islands",id:"TC"},id:"TC"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[42.3588,37.1087],[41.7884,36.5973],[41.4169,36.5148],[41.2456,36.0735],[41.3543,35.6403],[41.1945,34.7689],[40.9872,34.4289],[40.6894,34.3322],[38.7735,33.372],[36.8182,32.3173],[36.3721,32.387],[35.7875,32.735],[35.8691,33.4319],[35.9424,33.6676],[36.5851,34.2212],[36.4329,34.6136],[35.9761,34.6291],[35.9433,35.2239],[35.7644,35.5715],[35.8927,35.9164],[36.1275,35.8316],[36.6584,36.8024],[37.4365,36.6435],[38.1916,36.9014],[38.7669,36.6932],[39.3568,36.6817],[40.0164,36.8259],[40.7058,37.0976],[41.5154,37.0892],[42.2683,37.2765],[42.3588,37.1087]]]},properties:{name:"Syria",id:"SY"},id:"SY"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[55.5402,-4.6931],[55.3835,-4.6092],[55.4559,-4.5586],[55.5402,-4.6931]]]},properties:{name:"Seychelles",id:"SC"},id:"SC"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-63.123,18.0688],[-63.0111,18.0688],[-63.0231,18.0191],[-63.123,18.0688]]]},properties:{name:"Sint Maarten",id:"SX"},id:"SX"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[31.9482,-25.9577],[32.1129,-26.8393],[31.9584,-27.3058],[31.4697,-27.2956],[31.0636,-27.1123],[30.7941,-26.7643],[30.8034,-26.4136],[31.2074,-25.8432],[31.4151,-25.7464],[31.9482,-25.9577]]]},properties:{name:"Eswatini",id:"SZ"},id:"SZ"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[24.1557,65.8052],[23.1024,65.7353],[21.5656,65.4081],[21.1381,64.8087],[21.4653,64.3796],[20.7626,63.8678],[19.0345,63.2377],[18.4632,62.8959],[17.8955,62.8305],[17.4174,61.7407],[17.1307,61.5758],[17.251,60.7009],[17.9559,60.5897],[18.5573,60.2537],[18.9706,59.7572],[17.876,59.2709],[17.4569,58.8585],[16.6522,58.4344],[16.5279,57.0681],[15.9965,56.2227],[14.782,56.1619],[14.2152,55.8325],[14.3417,55.5278],[13.3212,55.3464],[12.5923,56.1377],[12.8835,56.6178],[12.4214,56.9063],[11.4493,58.1183],[11.147,58.9886],[11.3885,59.0365],[11.7982,59.29],[11.6806,59.5923],[12.4862,60.1067],[12.5888,60.4508],[12.294,61.0027],[12.8809,61.3523],[12.1555,61.7207],[12.3034,62.2856],[12.2181,63.0007],[11.9997,63.2917],[12.6625,63.9404],[13.9604,64.0141],[14.0776,64.464],[13.6501,64.5816],[14.4798,65.3014],[14.5432,66.1292],[15.423,66.4899],[16.4036,67.055],[16.1275,67.4259],[17.3247,68.1039],[17.9168,67.965],[18.3785,68.5624],[19.9698,68.3565],[20.6223,69.037],[21.9975,68.5207],[22.7823,68.3911],[23.639,67.9543],[23.4681,67.45],[23.9884,66.8106],[23.7012,66.4808],[24.1557,65.8052]]],[[[19.0767,57.836],[18.6998,57.2428],[18.1365,57.5566],[18.5374,57.8305],[19.0767,57.836]]]]},properties:{name:"Sweden",id:"SE"},id:"SE"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[16.5163,46.4997],[15.6361,46.2005],[15.6246,45.8338],[15.3396,45.4672],[13.8787,45.4286],[13.5778,45.5169],[13.7198,45.5875],[13.3993,46.3177],[13.6998,46.5201],[14.5037,46.4171],[15.0009,46.6262],[15.9575,46.6777],[16.0929,46.8632],[16.5163,46.4997]]]},properties:{name:"Slovenia",id:"SI"},id:"SI"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[22.5386,49.0727],[22.132,48.4053],[21.4515,48.5522],[20.4901,48.5269],[19.8988,48.1314],[18.7917,48.0005],[18.7242,47.787],[17.7619,47.7701],[17.1475,48.0058],[16.9531,48.5988],[17.1884,48.861],[17.7583,48.888],[18.161,49.2574],[18.8321,49.5108],[19.4416,49.5976],[19.802,49.1923],[20.6161,49.3916],[21.6397,49.4121],[22.5386,49.0727]]]},properties:{name:"Slovakia",id:"SK"},id:"SK"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-54.1559,5.3589],[-54.4522,5.0135],[-54.3508,4.0543],[-53.9904,3.5895],[-54.2032,3.1381],[-54.1954,2.818],[-54.6163,2.3266],[-55.0058,2.593],[-56.1295,2.2996],[-56.0198,1.8424],[-56.4828,1.9422],[-56.7043,2.0363],[-57.2097,2.8828],[-57.3036,3.3769],[-57.5497,3.3529],[-57.8327,3.6761],[-58.0544,4.1719],[-57.7111,4.9909],[-57.3309,5.0202],[-57.1948,5.5484],[-56.9698,5.9927],[-55.9395,5.7957],[-55.8283,5.9617],[-54.8338,5.9883],[-54.0543,5.8081],[-54.1559,5.3589]]]},properties:{name:"Suriname",id:"SR"},id:"SR"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[6.6602,.1205],[6.5243,.3402],[6.6868,.4041],[6.7498,.2435],[6.6602,.1205]]]},properties:{name:"Sao Tome and Principe",id:"ST"},id:"ST"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[20.2419,46.1086],[20.775,45.7499],[20.7741,45.4845],[21.4919,45.1223],[21.3845,44.8701],[22.7051,44.2376],[22.421,44.0077],[22.5546,43.4546],[22.9767,43.1878],[22.4667,42.8425],[22.3442,42.3138],[21.5625,42.2476],[21.7529,42.6698],[21.3907,42.7515],[21.0569,43.0915],[20.3445,42.8278],[19.5517,43.2122],[19.1943,43.5331],[19.4882,43.7036],[19.1517,44.3024],[19.3568,44.8586],[19.007,44.8693],[19.0549,45.5271],[18.9054,45.9315],[19.5308,46.1552],[20.2419,46.1086]]]},properties:{name:"Serbia",id:"RS"},id:"RS"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-56.2671,46.8384],[-56.3869,47.0679],[-56.2873,47.071],[-56.3148,46.9538],[-56.2671,46.8384]]]},properties:{name:"Saint Pierre and Miquelon",id:"PM"},id:"PM"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[41.5328,-1.6955],[40.9788,-.8703],[40.9699,1.378],[40.9646,2.8145],[41.3419,3.2016],[41.8839,3.9779],[42.0241,4.1377],[42.7916,4.2922],[43.0158,4.5634],[43.5383,4.8404],[44.0283,4.9509],[44.9405,4.9119],[45.9348,5.9972],[47.9781,7.9969],[46.9784,7.9969],[44.023,8.9859],[43.4828,9.3796],[43.1818,9.8799],[42.8418,10.2031],[42.6594,10.6212],[42.9226,10.9994],[43.2462,11.4997],[43.853,10.7841],[44.3865,10.4303],[44.9427,10.4365],[45.8168,10.8361],[46.5652,10.7459],[47.405,11.1739],[48.0193,11.1392],[48.6745,11.3226],[48.9031,11.2546],[50.1101,11.5294],[50.7923,11.9835],[51.2549,11.8308],[51.0844,11.3354],[51.1408,10.6567],[50.8984,10.2532],[50.8247,9.428],[50.4297,8.8452],[50.103,8.1998],[49.3484,6.9906],[49.0492,6.1739],[48.6492,5.4943],[47.9754,4.4968],[46.879,3.2854],[46.0511,2.4753],[44.9201,1.81],[44.3328,1.3909],[43.4677,.6217],[41.9798,-.9728],[41.5328,-1.6955]]]},properties:{name:"Somalia",id:"SO"},id:"SO"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[12.4853,43.9016],[12.397,43.9344],[12.441,43.9824],[12.5146,43.9531],[12.4853,43.9016]]]},properties:{name:"San Marino",id:"SM"},id:"SM"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-89.3626,14.416],[-89.0572,14.329],[-88.4491,13.851],[-88.151,13.9872],[-87.7153,13.8128],[-87.8143,13.3991],[-87.9308,13.1807],[-88.5121,13.1838],[-89.2776,13.4781],[-89.8043,13.5602],[-90.0952,13.7364],[-89.8726,14.0454],[-89.3626,14.416]]]},properties:{name:"El Salvador",id:"SV"},id:"SV"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-10.2832,8.4852],[-10.6474,7.7594],[-11.2678,7.2325],[-11.5075,6.9067],[-11.7334,7.0887],[-12.4856,7.3861],[-12.5104,7.6658],[-12.8809,7.8566],[-13.2284,8.696],[-13.2928,9.0494],[-12.7559,9.3734],[-12.5016,9.8622],[-11.911,9.9931],[-11.2056,9.9776],[-10.6905,9.3144],[-10.5005,8.6876],[-10.2832,8.4852]]]},properties:{name:"Sierra Leone",id:"SL"},id:"SL"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[161.7152,-10.3873],[162.1054,-10.4539],[162.1236,-10.8245],[161.5381,-10.5666],[161.7152,-10.3873]]],[[[159.7505,-9.2727],[159.9707,-9.4334],[160.3547,-9.4214],[160.6254,-9.5888],[160.6494,-9.9288],[159.8535,-9.7916],[159.6218,-9.5319],[159.7505,-9.2727]]],[[[160.7493,-8.3139],[160.9979,-8.6122],[161.2584,-9.3171],[160.8736,-9.1568],[160.5904,-8.3729],[160.7493,-8.3139]]],[[[159.8793,-8.5341],[158.944,-8.0409],[159.1095,-7.9037],[159.8433,-8.3272],[159.8793,-8.5341]]]]},properties:{name:"Solomon Islands",id:"SB"},id:"SB"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-5.6923,-15.9977],[-5.775,-15.9568],[-5.7078,-15.9062],[-5.6923,-15.9977]]]},properties:{name:"Saint Helena",id:"SH"},id:"SH"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-37.1034,-54.0658],[-36.3264,-54.2509],[-35.7986,-54.7636],[-36.0855,-54.8666],[-37.1034,-54.0658]]]},properties:{name:"South Georgia and South Sandwich Islands",id:"GS"},id:"GS"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[103.9697,1.3314],[103.8201,1.2653],[103.6501,1.3257],[103.8179,1.4473],[103.9697,1.3314]]]},properties:{name:"Singapore",id:"SG"},id:"SG"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-12.2807,14.8089],[-12.0193,14.2065],[-12.0543,13.633],[-11.6349,13.3698],[-11.3903,12.9419],[-11.3894,12.4043],[-12.2912,12.328],[-13.0828,12.6334],[-13.7294,12.6738],[-15.1962,12.68],[-15.5748,12.4904],[-16.7119,12.3551],[-16.7634,13.064],[-16.6488,13.1541],[-15.8343,13.1563],[-15.5096,13.5864],[-16.5623,13.5873],[-17.168,14.6407],[-17.1471,14.9221],[-16.5352,15.8383],[-16.4411,16.2045],[-16.1683,16.5472],[-15.6208,16.5068],[-15.1128,16.6448],[-14.3,16.5805],[-13.8685,16.1481],[-13.4095,16.0593],[-13.2579,15.7002],[-12.8584,15.2426],[-12.2807,14.8089]]]},properties:{name:"Senegal",id:"SN"},id:"SN"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[34.078,9.4613],[34.0945,8.5824],[33.9533,8.4435],[33.2342,8.3964],[33.0127,7.9516],[33.2262,7.7608],[33.6661,7.6711],[34.0643,7.2259],[34.7106,6.6604],[35.0821,5.6731],[35.2681,5.4925],[33.9759,4.2203],[33.4894,3.7551],[32.8382,3.7986],[32.3358,3.7063],[32.0996,3.5291],[31.7982,3.8026],[31.4799,3.6805],[31.1523,3.7857],[30.8385,3.4905],[30.5083,3.8359],[30.1949,3.9819],[29.6768,4.5869],[29.1513,4.3881],[28.7269,4.5048],[28.192,4.3503],[27.7881,4.6446],[27.4032,5.1094],[27.0836,5.777],[26.5141,6.0691],[26.3619,6.6355],[25.8891,7.0647],[25.3809,7.3333],[25.2472,7.7244],[24.8535,8.1376],[24.2915,8.2912],[24.1473,8.6654],[24.5321,8.8869],[24.7852,9.7747],[25.067,10.2936],[25.7981,10.4206],[25.8913,10.2026],[26.5514,9.5257],[27.0743,9.614],[27.8857,9.5998],[28.0491,9.3286],[28.8445,9.3259],[28.9995,9.61],[29.4731,9.7685],[29.6054,10.065],[30.0031,10.2772],[30.7395,9.7427],[31.2247,9.7991],[31.6548,10.2213],[31.9331,10.6625],[32.4041,11.0576],[32.3353,11.7158],[32.0721,12.0066],[32.7366,12.0097],[33.1991,12.2174],[33.0731,11.5916],[33.172,10.8503],[33.892,10.1991],[34.078,9.4613]]]},properties:{name:"South Sudan",id:"SS"},id:"SS"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[36.8714,21.9968],[36.9269,21.5867],[37.1507,21.1037],[37.2274,20.5568],[37.2483,19.5821],[37.4711,18.8203],[37.9217,18.5558],[38.6093,18.0049],[38.2537,17.5845],[37.7823,17.458],[37.4112,17.0616],[37.0091,17.059],[36.9136,16.2964],[36.4267,15.132],[36.5243,14.2567],[36.3907,13.6259],[36.2123,13.2712],[36.1075,12.7266],[35.5961,12.5375],[35.1123,11.8166],[34.9312,10.8649],[34.5716,10.88],[34.2756,10.528],[34.2915,10.1249],[34.078,9.4613],[33.892,10.1991],[33.172,10.8503],[33.0731,11.5916],[33.1991,12.2174],[32.7366,12.0097],[32.0721,12.0066],[32.3353,11.7158],[32.4041,11.0576],[31.9331,10.6625],[31.6548,10.2213],[31.2247,9.7991],[30.7395,9.7427],[30.0031,10.2772],[29.6054,10.065],[29.4731,9.7685],[28.9995,9.61],[28.8445,9.3259],[28.0491,9.3286],[27.8857,9.5998],[27.0743,9.614],[26.5514,9.5257],[25.8913,10.2026],[25.7981,10.4206],[25.067,10.2936],[24.7852,9.7747],[24.5321,8.8869],[24.1473,8.6654],[23.5374,8.8159],[23.6461,9.8231],[23.2559,10.4579],[22.86,10.9195],[22.9226,11.3448],[22.5564,11.6697],[22.3522,12.6604],[21.8253,12.7905],[22.2283,13.3294],[22.1076,13.7302],[22.5098,14.1275],[22.3815,14.5505],[22.6709,14.7223],[22.9323,15.1622],[23.105,15.7024],[23.9835,15.7801],[23.9822,17.2663],[23.9804,19.4968],[23.9804,19.9958],[24.9796,20.0024],[24.9805,21.9959],[27.2723,21.9955],[30.3285,21.9951],[32.6061,21.9959],[34.2467,21.9964],[36.8714,21.9968]]]},properties:{name:"Sudan",id:"SD"},id:"SD"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[46.5314,29.0964],[47.4334,28.9895],[47.6713,28.5331],[48.4424,28.5429],[48.9067,27.6289],[49.4052,27.1811],[49.9862,26.829],[50.214,26.3084],[50.0315,26.1108],[50.558,25.0868],[50.8043,24.7894],[51.2682,24.6074],[51.5683,24.286],[51.5927,24.0787],[52.555,22.933],[55.1043,22.6214],[55.186,22.704],[55.641,22.0017],[54.9774,19.9958],[53.667,19.559],[51.9775,18.9961],[49.0421,18.582],[48.172,18.1567],[47.5795,17.4483],[47.4418,17.1118],[46.9758,16.9533],[46.6819,17.2685],[46.3104,17.2312],[45.4066,17.32],[45.1483,17.4274],[44.1557,17.3986],[43.9169,17.3249],[43.418,17.5162],[43.1911,17.3595],[43.1649,16.6892],[42.7992,16.3718],[42.6989,16.7372],[42.3833,17.1225],[42.294,17.435],[41.7498,17.8855],[41.2296,18.6783],[41.1159,19.0822],[40.7591,19.7556],[40.0808,20.2661],[39.6138,20.5178],[39.0936,21.3101],[38.9879,21.8819],[39.0958,22.3928],[38.9413,22.882],[38.4641,23.712],[37.9195,24.1852],[37.5431,24.2918],[37.1808,24.82],[37.1489,25.291],[36.7627,25.7513],[36.2496,26.5947],[35.5815,27.4323],[35.1807,28.0347],[34.616,28.1483],[34.7798,28.5074],[34.9507,29.3535],[36.0156,29.1906],[36.4759,29.4951],[36.7551,29.8662],[37.4694,29.9949],[37.6336,30.3132],[37.9803,30.5],[36.9584,31.4917],[38.9622,31.9951],[39.1455,32.1247],[40.3693,31.9391],[42.0743,31.0802],[42.8578,30.4952],[44.7163,29.1937],[46.3565,29.0636],[46.5314,29.0964]]]},properties:{name:"Saudi Arabia",id:"SA"},id:"SA"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-8.6834,27.6565],[-8.6834,27.2858],[-8.6821,25.9954],[-10.5624,25.9954],[-12.0164,25.9954],[-12.0235,23.4674],[-12.6203,23.2712],[-13.0316,23],[-13.0944,22.4958],[-13.0163,21.3341],[-15.0018,21.3314],[-16.9647,21.3292],[-17.0481,20.8063],[-16.9309,21.9001],[-16.5143,22.3333],[-16.2103,23.0981],[-15.5864,24.0729],[-15.0388,24.5488],[-14.856,24.8715],[-14.7949,25.4041],[-14.4138,26.2538],[-13.5758,26.7349],[-13.1774,27.652],[-8.6834,27.6565]]]},properties:{name:"Western Sahara",id:"EH"},id:"EH"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[30.51,-1.0674],[30.8128,-1.5632],[30.8287,-2.3387],[30.5535,-2.3999],[29.9303,-2.3396],[29.8682,-2.7164],[29.3901,-2.8087],[29.0146,-2.7204],[28.8765,-2.4004],[29.1064,-2.2335],[29.1295,-1.8601],[29.577,-1.3878],[30.1016,-1.3688],[30.51,-1.0674]]]},properties:{name:"Rwanda",id:"RW"},id:"RW"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-178.8765,71.5769],[-177.5322,71.2631],[-177.8218,71.0675],[-179.5066,70.9235],[-180,70.993],[-180,71.1843],[-180,71.3998],[-180,71.5379],[-178.8765,71.5769]]],[[[178.8614,70.8265],[178.8911,71.2311],[180,71.5379],[180,70.993],[178.8614,70.8265]]],[[[60.4505,69.935],[59.5783,69.7385],[58.473,70.2668],[59.0052,70.4652],[60.4505,69.935]]],[[[169.201,69.5805],[167.789,69.8369],[168.358,70.0157],[169.375,69.8826],[169.201,69.5805]]],[[[50.265,69.1857],[49.6262,68.8596],[48.667,68.7331],[48.279,69.0403],[48.6315,69.436],[49.225,69.5113],[50.265,69.1857]]],[[[-179.7985,68.9404],[-178.8739,68.7542],[-177.4075,68.2451],[-175.3451,67.678],[-174.4476,67.1031],[-173.6797,67.1449],[-172.6405,66.9249],[-171.7956,66.9318],[-170.192,66.2014],[-170.6663,65.6214],[-172.2115,65.4252],[-172.2133,65.0482],[-172.9239,64.705],[-173.0092,64.2975],[-173.7298,64.3646],[-174.318,64.6376],[-175.3951,64.8025],[-175.8538,65.0109],[-176.0933,65.471],[-177.0563,65.6137],[-178.3103,65.4849],[-178.8794,65.9364],[-179.7283,65.8039],[-179.3521,65.5167],[-180,65.0672],[-180,65.312],[-180,65.5569],[-180,65.8014],[-180,66.0462],[-180,66.291],[-180,66.5359],[-180,66.7807],[-180,67.0252],[-180,67.2701],[-180,67.5149],[-180,67.7597],[-180,68.0045],[-180,68.2491],[-180,68.4939],[-180,68.7387],[-180,68.9835],[-179.7985,68.9404]]],[[[163.635,58.6033],[163.7611,59.015],[164.6156,58.8856],[163.635,58.6033]]],[[[21.2358,55.2641],[22.8311,54.8384],[22.7663,54.3568],[19.6045,54.4591],[19.9747,54.9212],[20.5202,54.9949],[20.8998,55.2867],[20.9579,55.279],[21.2358,55.2641]]],[[[142.761,54.3939],[142.9181,53.7942],[143.2235,53.2961],[143.3234,52.6136],[143.1556,52.0838],[143.4552,51.4715],[143.8161,50.2825],[144.272,49.3113],[143.105,49.1988],[142.5741,48.0719],[142.5568,47.7381],[143.0056,47.2228],[143.2821,46.5592],[142.5781,46.7008],[142.2088,46.0891],[141.8302,46.4508],[142.0388,47.1402],[141.9642,47.5872],[142.1817,48.0133],[141.8661,48.75],[142.1422,49.5692],[142.0712,50.5149],[142.2066,51.2225],[141.7223,51.7363],[141.8235,53.3394],[142.5262,53.4475],[142.761,54.3939]]],[[[148.5995,45.3176],[147.9137,44.9904],[147.7694,45.1906],[148.5995,45.3176]]],[[[96.5265,81.0755],[97.8316,80.7983],[97.1751,80.241],[94.565,80.1261],[93.8725,80.0102],[91.5239,80.3584],[93.2626,80.7912],[93.0651,80.9885],[95.8008,81.2804],[96.5265,81.0755]]],[[[54.719,81.1159],[57.694,80.7923],[55.7124,80.6372],[54.0665,80.8136],[54.719,81.1159]]],[[[62.168,80.8347],[61.0511,80.4186],[59.3044,80.5216],[59.5921,80.8165],[62.168,80.8347]]],[[[97.6744,80.1582],[100.0613,79.7772],[99.4394,78.8341],[97.5555,78.8266],[94.6524,79.1275],[93.0708,79.4953],[94.9871,80.0968],[97.6744,80.1582]]],[[[102.8848,79.254],[105.146,78.8188],[105.3125,78.4999],[103.7194,78.2582],[101.2043,78.192],[100.2841,78.6792],[101.5905,79.3504],[102.8848,79.254]]],[[[130.6871,42.3027],[130.5269,42.5353],[130.5771,42.8118],[131.0684,42.9024],[131.262,43.4333],[131.2553,44.0716],[131.0822,44.9101],[131.9775,45.2439],[132.9359,45.03],[133.1858,45.4947],[133.8614,46.2475],[134.1677,47.3022],[134.7523,47.7155],[134.5636,48.3219],[134.2933,48.3733],[133.4686,48.0972],[133.1441,48.1057],[132.5617,47.7683],[131.0027,47.6915],[130.712,48.1279],[130.8043,48.3414],[130.1962,48.8916],[129.5339,49.3235],[128.5267,49.5943],[127.9998,49.5685],[127.5027,49.8735],[127.5901,50.2091],[126.9247,51.1002],[126.313,52.3997],[125.649,53.0422],[124.8122,53.1339],[123.6079,53.5465],[122.338,53.485],[120.704,53.1718],[120.0945,52.7872],[120.6561,52.5666],[120.7497,52.0965],[120.067,51.6007],[119.1921,50.3797],[119.26,50.0664],[118.4517,49.8444],[117.8733,49.5135],[116.6832,49.8238],[116.1346,50.0109],[115.2743,49.9489],[114.743,50.2337],[114.2969,50.2743],[113.1641,49.7971],[113.0557,49.6162],[111.3366,49.3559],[110.8279,49.1661],[110.1997,49.1704],[109.2365,49.3348],[108.6137,49.3228],[108.034,49.594],[107.9479,49.9247],[107.2332,49.9893],[106.7112,50.3125],[106.218,50.3045],[105.3835,50.4736],[103.6328,50.1387],[102.6833,50.3871],[102.2883,50.585],[102.1116,51.3534],[101.3814,51.4526],[100.4687,51.7261],[98.8485,52.0701],[97.947,51.3483],[97.8254,50.9852],[98.2795,50.5333],[98.1032,50.0779],[97.2088,49.7308],[96.986,49.8828],[95.8518,50.0129],[95.5229,49.9112],[94.6147,50.0237],[94.2511,50.5564],[91.8044,50.6936],[89.644,49.903],[89.6542,49.7175],[88.8317,49.4485],[88.1925,49.4518],[87.8143,49.1624],[87.3229,49.0858],[86.6144,49.6098],[86.1807,49.4993],[85.21,49.6648],[84.9893,50.0615],[84.2578,50.2883],[83.9453,50.7746],[83.3571,50.9945],[82.4938,50.7275],[81.4657,50.7397],[80.8771,51.2815],[79.9862,50.7746],[79.4687,51.493],[78.4757,52.6385],[77.7042,53.3791],[76.5758,53.9424],[76.2664,54.312],[74.4518,53.6472],[73.2857,53.5984],[73.3993,53.8115],[72.9141,54.1073],[71.0933,54.2123],[71.1856,54.5994],[70.7382,55.3052],[70.1824,55.1625],[68.9773,55.3895],[68.2062,55.1609],[68.0739,54.9596],[66.2225,54.6673],[65.4767,54.6233],[65.1576,54.3643],[64.4611,54.3841],[63.0739,54.1053],[61.9287,53.9464],[61.3339,54.0492],[60.9797,53.6217],[61.1994,53.2872],[62.0148,53.1079],[61.974,52.9437],[61.0476,52.9725],[60.8021,52.7448],[60.9375,52.2805],[60.0657,51.9764],[60.4647,51.6513],[61.3632,51.442],[61.5851,51.2298],[61.3894,50.8609],[60.6379,50.6638],[59.9552,50.7992],[59.8122,50.5819],[58.8836,50.6945],[58.3594,51.0638],[57.8387,51.0917],[57.4423,50.8889],[57.0117,51.0651],[56.4915,51.0196],[55.7977,50.6021],[55.5424,50.6017],[54.727,50.9981],[54.4216,50.7804],[54.0416,51.1153],[53.3381,51.4824],[52.571,51.4817],[52.3309,51.6812],[51.6091,51.4839],[50.7941,51.7292],[50.2468,51.2895],[49.498,51.0835],[48.8086,50.6012],[48.8432,50.0131],[48.4344,49.8284],[47.706,50.378],[47.3264,50.2734],[46.8022,49.367],[47.0144,49.0984],[46.7028,48.8055],[46.661,48.4124],[47.0042,48.2846],[47.0934,47.9477],[48.1099,47.7452],[48.9595,46.7744],[48.6102,46.5663],[49.2321,46.3372],[48.1592,45.7371],[47.5244,45.6017],[46.7529,44.4205],[47.2301,44.1923],[47.5089,43.5096],[47.4632,43.0351],[48.5729,41.8446],[47.8609,41.2129],[47.2612,41.315],[46.7494,41.8126],[46.4298,41.8907],[45.6388,42.205],[45.7275,42.4749],[45.1602,42.6751],[44.5059,42.7488],[43.9573,42.5664],[43.7824,42.747],[42.4192,43.2242],[41.5807,43.2193],[40.6481,43.534],[39.9782,43.42],[38.7171,44.2882],[38.1814,44.4196],[37.8516,44.6988],[37.4112,44.7352],[36.9411,45.2896],[37.6474,45.3771],[37.9332,46.0016],[38.1836,46.0948],[37.9679,46.6182],[39.2933,47.1056],[38.2142,47.0914],[38.2875,47.5592],[38.9005,47.8553],[39.7359,47.8447],[39.9609,48.238],[39.6866,49.0079],[40.0701,49.2003],[39.7807,49.5721],[39.1748,49.8559],[38.2586,50.0524],[38.0469,49.9201],[37.4228,50.4115],[36.3059,50.2805],[35.4115,50.5398],[35.3121,51.0438],[34.2809,51.3117],[34.3976,51.7804],[33.7353,52.3448],[32.508,52.3084],[31.7636,52.1012],[31.5771,52.3122],[31.4178,53.196],[32.1422,53.0913],[32.7042,53.3363],[31.792,54.0558],[31.4036,54.1959],[31.1213,54.6484],[30.9069,55.5699],[30.2335,55.8452],[29.4824,55.6845],[29.375,55.9386],[28.7948,55.9426],[28.1481,56.143],[27.8063,56.867],[27.797,57.3169],[27.3517,57.5282],[27.753,57.8411],[27.4272,58.7331],[28.0127,59.4842],[28.014,59.7248],[28.9471,59.8289],[29.0692,60.1915],[28.6506,60.611],[27.7978,60.5362],[29.6902,61.5461],[31.2855,62.5679],[31.5341,62.8855],[31.1807,63.2082],[30.0555,63.689],[30.5038,64.0205],[30.1083,64.3661],[30.0728,64.7649],[29.604,64.9685],[29.9032,66.0911],[29.0869,66.9709],[29.9414,67.5475],[29.3439,68.062],[28.4708,68.4883],[28.9657,69.0219],[30.8696,69.7834],[31.9846,69.9536],[32.9417,69.7519],[32.3775,69.4791],[33.6843,69.3102],[35.858,69.1917],[40.3809,67.8318],[40.9663,67.7135],[41.1887,66.8262],[40.5216,66.4466],[39.2889,66.1321],[38.3975,66.0644],[35.5136,66.3958],[34.8247,66.6111],[32.4636,66.9163],[33.5667,66.321],[34.7865,65.8645],[34.4065,65.3957],[34.8034,64.986],[34.8695,64.5601],[35.6472,64.3783],[36.365,64.0028],[37.4423,63.8135],[38.0708,64.0259],[37.9537,64.3202],[37.1835,64.4085],[36.5283,64.8473],[36.883,65.1724],[38.0096,64.8788],[39.7581,64.577],[40.281,64.998],[39.8167,65.5979],[41.4759,66.1235],[42.2106,66.5197],[44.0971,66.2351],[44.4886,66.6719],[44.292,67.0996],[43.7824,67.2545],[44.2254,67.9956],[44.0483,68.5489],[45.8922,68.4797],[46.6903,67.8489],[45.5287,67.7577],[44.9396,67.4776],[45.9859,66.853],[46.6908,66.8255],[47.7091,67.045],[47.8746,67.5841],[48.8778,67.7315],[50.839,68.3498],[52.5502,68.5924],[53.8019,68.9959],[53.9679,68.2273],[54.5614,68.273],[56.0436,68.649],[57.1267,68.554],[58.9191,69.0039],[59.8975,68.422],[60.9335,68.9868],[60.1704,69.5909],[61.0161,69.8515],[63.3616,69.6753],[68.5041,68.3485],[69.1406,68.9506],[68.5427,68.9671],[68.006,69.48],[67.0645,69.6937],[66.9265,70.0142],[67.2847,70.7386],[66.6664,70.9006],[66.9176,71.2824],[68.2693,71.6828],[69.039,72.67],[69.6449,72.8975],[71.5003,72.9137],[72.8121,72.6915],[72.6243,72.0794],[71.9118,71.5478],[72.7317,70.823],[72.5297,70.1724],[72.5275,69.0805],[73.548,68.5744],[73.1521,67.8651],[72.5945,67.587],[71.5514,66.7605],[70.9393,66.5481],[69.877,66.8455],[69.1943,66.5787],[70.3396,66.3423],[71.9172,66.2467],[72.4174,66.5607],[73.7922,66.9953],[74.0745,67.4141],[74.7696,67.7663],[74.3914,68.4206],[74.5796,68.7511],[76.4591,68.9784],[77.2385,68.4697],[77.6509,68.9029],[76.001,69.2349],[74.8149,69.0907],[73.7757,69.1983],[73.56,69.7072],[74.3111,70.6536],[73.0864,71.4449],[73.6719,71.845],[75.7413,72.2962],[76.0325,71.9103],[78.4828,72.395],[79.422,72.3808],[80.7626,72.0892],[81.511,71.7463],[82.9861,71.7487],[82.1835,72.2376],[80.827,72.4882],[80.5096,73.0861],[80.5833,73.5684],[83.5449,73.6665],[86.5913,73.8943],[86.6513,74.6824],[87.6713,75.1296],[90.1851,75.591],[93.5498,75.854],[94.5756,76.1517],[96.879,75.9311],[100.3223,76.479],[100.9899,76.9904],[103.1312,77.6265],[104.0146,77.7304],[105.8944,77.4889],[104.9121,77.1748],[107.4299,76.9265],[108.0278,76.7185],[111.1151,76.723],[112.6194,76.3836],[113.8712,75.856],[113.6137,75.293],[111.8683,74.7401],[109.8402,74.3219],[108.1996,73.6941],[107.2709,73.621],[106.4782,73.1394],[107.7503,73.1731],[109.8553,73.4726],[110.2614,74.0174],[112.1471,73.7089],[114.0607,73.5846],[115.3378,73.7025],[118.4504,73.5897],[118.4304,73.2466],[119.7505,72.9792],[123.1605,72.955],[123.6222,73.1933],[123.3052,73.5329],[124.3883,73.7549],[125.617,73.5207],[127.7406,73.4817],[128.8885,73.1902],[129.4118,72.3156],[128.3589,72.0883],[129.7621,71.1195],[131.1572,70.7422],[131.562,70.9011],[132.5621,71.8952],[134.1029,71.3789],[135.8847,71.6306],[137.3153,71.3594],[138.1183,71.5663],[139.695,71.7003],[139.6014,72.496],[142.0614,72.7208],[145.4856,72.5422],[146.594,72.3025],[148.402,72.312],[149.5015,72.1644],[150.5997,71.5201],[151.5825,71.2871],[152.5089,70.8345],[153.7944,70.88],[155.8953,71.0955],[158.0371,71.0394],[159.3506,70.7908],[160.0062,70.3096],[159.8326,69.7849],[161.5367,69.3796],[162.3757,69.6491],[164.1597,69.7192],[164.5135,69.6091],[166.8204,69.4995],[167.6283,69.7403],[168.303,69.2716],[169.3106,69.0796],[169.6098,68.7862],[170.5375,68.8254],[170.9952,69.0454],[170.5824,69.5834],[170.4869,70.1076],[172.5595,69.9682],[173.2772,69.8238],[176.1075,69.8604],[176.9243,69.646],[178.8485,69.3872],[180,68.9835],[180,65.0672],[178.5196,64.6029],[177.4671,64.7368],[177.433,64.4445],[178.6501,63.9653],[178.7065,63.5216],[179.3324,63.1902],[179.5703,62.6875],[179.1206,62.3204],[177.3513,62.5874],[175.2681,62.1025],[174.5144,61.8237],[173.6235,61.7161],[172.8564,61.4693],[172.3926,61.0618],[170.6081,60.435],[169.9827,60.067],[169.2267,60.5959],[168.1374,60.5739],[166.9642,60.3069],[166.3521,60.4847],[165.0843,60.0985],[163.7802,60.041],[163.41,59.8349],[163.2728,59.3026],[162.1418,58.4475],[161.9602,58.0768],[162.4671,57.7661],[163.2138,57.6869],[162.7792,57.3577],[162.8027,56.8115],[163.2564,56.6881],[163.3354,56.2325],[162.5284,56.2606],[162.085,56.0897],[161.7294,55.358],[162.1058,54.7521],[161.7258,54.533],[160.7728,54.5414],[160.0746,54.1892],[159.8437,53.7837],[159.8975,53.3807],[158.6088,52.8735],[158.4637,52.3049],[158.1037,51.8095],[156.7476,50.9692],[156.5003,51.475],[156.3645,52.5093],[156.0986,53.0065],[155.6201,54.8646],[155.5549,55.3484],[155.9828,56.6952],[156.7285,57.1522],[157.4503,57.7994],[158.2102,58.0253],[159.0367,58.4239],[159.8473,59.1271],[161.7534,60.1522],[162.0037,60.4201],[162.9732,60.7828],[163.71,60.9168],[164.0052,61.3439],[164.2556,62.6966],[163.3318,62.5508],[163.0091,61.7915],[162.3926,61.6621],[160.7666,60.7533],[159.8832,61.2917],[160.3174,61.7933],[159.5525,61.7194],[159.0767,61.9223],[158.07,61.7536],[157.4694,61.7989],[156.6801,61.4806],[156.63,61.2724],[155.8532,60.7772],[154.9707,60.3766],[154.2929,59.8333],[154.5827,59.5401],[155.1669,59.3601],[154.011,59.0756],[153.3611,59.2147],[152.8822,58.9391],[151.99,59.1601],[151.4857,59.5241],[150.4572,59.5907],[149.6427,59.7705],[149.205,59.4882],[147.8746,59.3881],[147.5146,59.2687],[146.4444,59.4305],[145.9317,59.1983],[145.5544,59.4136],[143.192,59.3701],[142.0255,58.9997],[141.7547,58.7453],[140.6849,58.2122],[140.447,57.8136],[140.0022,57.6875],[138.6621,56.9655],[137.6913,56.1395],[136.175,55.3522],[135.2623,54.9434],[135.8514,54.5838],[136.7973,54.6209],[136.6828,53.9313],[137.1555,53.8217],[137.3282,53.5389],[138.2923,53.5924],[138.6608,53.7449],[138.6958,54.3199],[139.7075,54.2771],[140.3471,53.8126],[141.4022,53.184],[141.1696,52.3684],[141.4853,52.1786],[140.6876,51.2322],[140.4763,50.546],[140.5171,49.596],[140.1704,48.5238],[139.3728,47.8873],[139.0012,47.3835],[138.5866,47.0572],[138.3367,46.5432],[137.6855,45.8183],[136.8035,45.1711],[136.1421,44.4893],[135.8745,44.3734],[135.1309,43.5256],[133.7092,42.83],[133.1601,42.6969],[132.4813,42.9099],[132.3344,43.2388],[131.7946,43.2553],[131.1586,42.6258],[130.6871,42.3027]]],[[[67.7654,76.2376],[66.2824,75.9837],[61.3561,75.3149],[60.2224,74.7965],[58.5347,74.4988],[58.4415,74.1288],[56.9638,73.3665],[55.0067,73.4539],[53.7629,73.7662],[54.6427,73.9595],[57.0876,75.3837],[58.8814,75.8547],[62.9714,76.2367],[65.8629,76.6133],[67.5351,77.0077],[68.4859,76.9338],[68.9,76.5729],[67.7654,76.2376]]],[[[140.0488,75.829],[140.9442,75.7004],[142.4605,75.9035],[143.6856,75.8636],[145.2552,75.5857],[144.0199,75.0446],[141.9873,74.9913],[139.0993,74.6566],[138.0921,74.7974],[137.0064,75.235],[137.5013,75.9097],[138.8139,76.1996],[140.0488,75.829]]],[[[146.7951,75.3709],[150.1039,75.2193],[150.6463,74.9445],[149.5969,74.7725],[148.0926,74.8258],[146.1483,75.1984],[146.7951,75.3709]]],[[[113.3873,74.4005],[112.7823,74.0951],[111.6428,74.2729],[112.0845,74.549],[113.3873,74.4005]]],[[[142.1848,73.8958],[143.3438,73.5687],[143.1934,73.2206],[140.6627,73.4519],[141.0849,73.8658],[142.1848,73.8958]]],[[[55.32,73.3083],[56.4293,73.2011],[55.356,72.4651],[55.2978,71.9354],[57.1458,70.589],[54.6009,70.68],[53.7225,70.8145],[53.3638,71.5416],[51.8124,71.4912],[51.5825,72.0712],[52.6221,72.3009],[53.7531,73.2932],[55.32,73.3083]]]]},properties:{name:"Russia",id:"RU"},id:"RU"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[28.2124,45.4503],[28.7606,45.2341],[29.2236,45.4028],[29.7061,45.2599],[29.5574,44.8435],[29.0483,44.7574],[28.6452,44.2958],[28.5853,43.7422],[27.0867,44.1675],[26.2158,44.0072],[25.4972,43.6708],[23.2244,43.8741],[22.7051,44.2376],[21.3845,44.8701],[21.4919,45.1223],[20.7741,45.4845],[20.775,45.7499],[20.2419,46.1086],[21.1519,46.3044],[22.2905,47.7279],[22.8764,47.9472],[23.2027,48.0844],[24.8935,47.7177],[26.1625,47.9925],[26.6189,48.2597],[26.9806,48.155],[27.3366,47.6396],[28.0717,46.9786],[28.2444,46.4513],[28.0997,45.9728],[28.2124,45.4503]]]},properties:{name:"Romania",id:"RO"},id:"RO"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[55.7972,-21.3395],[55.3627,-21.2738],[55.3112,-20.904],[55.6618,-20.9062],[55.7972,-21.3395]]]},properties:{name:"Reunion",id:"RE"},id:"RE"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[51.2682,24.6074],[50.8043,24.7894],[50.763,25.4445],[51.0032,25.9816],[51.2624,26.1534],[51.543,25.9022],[51.4853,25.5249],[51.602,25.148],[51.2682,24.6074]]]},properties:{name:"Qatar",id:"QA"},id:"QA"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-149.3215,-17.6902],[-149.579,-17.7351],[-149.6114,-17.5318],[-149.3792,-17.5224],[-149.3215,-17.6902]]]},properties:{name:"French Polynesia",id:"PF"},id:"PF"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-58.1598,-20.1645],[-57.8303,-20.9981],[-57.9856,-22.0461],[-56.9374,-22.2712],[-56.5239,-22.1025],[-55.8492,-22.3076],[-55.6541,-22.8105],[-55.3662,-23.9913],[-54.6254,-23.8124],[-54.2418,-24.0472],[-54.4731,-25.2204],[-54.6158,-25.576],[-54.7552,-26.533],[-55.1358,-26.9312],[-55.4266,-27.0093],[-55.7147,-27.415],[-56.0673,-27.3076],[-56.3705,-27.5375],[-57.1118,-27.4701],[-58.6186,-27.1323],[-58.1914,-26.6302],[-58.2031,-26.3816],[-57.8906,-26.0065],[-57.5872,-25.4051],[-57.8216,-25.1365],[-58.3654,-24.9594],[-59.373,-24.4538],[-59.8924,-24.0934],[-61.0329,-23.7556],[-61.7984,-23.1821],[-62.3726,-22.439],[-62.6509,-22.2339],[-62.2767,-21.066],[-62.2763,-20.5627],[-61.917,-20.0553],[-61.7569,-19.6451],[-60.0073,-19.2976],[-59.0905,-19.286],[-58.1803,-19.8178],[-58.1598,-20.1645]]]},properties:{name:"Paraguay",id:"PY"},id:"PY"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-7.4061,37.1793],[-7.8343,37.0057],[-8.5977,37.1211],[-8.8141,37.431],[-8.9147,38.5123],[-9.4742,38.7307],[-9.3748,39.3384],[-9.1482,39.5426],[-8.8867,40.1795],[-8.6557,41.0296],[-8.7771,41.9409],[-8.2131,42.1336],[-7.9208,41.8836],[-7.4037,41.8335],[-6.6182,41.9422],[-6.2125,41.5321],[-6.9285,41.0092],[-6.8102,40.3429],[-7.0146,40.2084],[-7.0368,39.7139],[-7.4452,39.5363],[-7.0461,38.9069],[-7.3431,38.4572],[-7.1855,38.0062],[-7.5036,37.5854],[-7.4061,37.1793]]]},properties:{name:"Portugal",id:"PT"},id:"PT"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[130.5269,42.5353],[130.6871,42.3027],[130.4576,42.3018],[129.7563,41.7123],[129.7088,40.8574],[128.3043,40.0362],[127.5684,39.7818],[127.3943,39.2079],[127.7863,39.084],[128.3745,38.6233],[128.0389,38.3085],[127.1697,38.3045],[126.634,37.7816],[125.9419,37.8735],[125.4492,37.7301],[125.1931,38.0378],[124.691,38.1292],[125.0675,38.5567],[125.4097,39.2882],[125.3609,39.5266],[124.5574,39.7907],[124.3621,40.0042],[124.8895,40.4596],[125.989,40.9049],[126.9034,41.7811],[127.1795,41.5312],[128.1112,41.3891],[128.291,41.5627],[128.0451,41.9875],[128.9236,42.0381],[129.3137,42.4137],[129.7199,42.4749],[129.8983,42.9983],[130.2406,42.8917],[130.5269,42.5353]]]},properties:{name:"North Korea",id:"KP"},id:"KP"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-66.1295,18.4448],[-65.6288,18.3813],[-65.9708,17.9743],[-67.1968,17.9943],[-67.1587,18.4994],[-66.1295,18.4448]]]},properties:{name:"Puerto Rico",id:"PR"},id:"PR"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[19.6045,54.4591],[22.7663,54.3568],[23.37,54.2005],[23.4845,53.9398],[23.8872,53.0276],[23.8445,52.6642],[23.1969,52.257],[23.6523,52.0403],[23.6053,51.5179],[24.1056,50.8449],[23.7118,50.3773],[22.6496,49.539],[22.5386,49.0727],[21.6397,49.4121],[20.6161,49.3916],[19.802,49.1923],[19.4416,49.5976],[18.8321,49.5108],[18.5622,49.8792],[17.8746,49.9722],[17.152,50.3784],[16.6792,50.0974],[16.0072,50.6117],[14.8096,50.8589],[15.0164,51.2527],[14.6018,51.8324],[14.7527,52.0818],[14.6196,52.5284],[14.1286,52.8782],[14.4145,53.2835],[14.2587,53.7296],[14.2139,53.8707],[14.2112,53.9504],[16.1865,54.2904],[16.5598,54.5539],[17.2621,54.7294],[18.3234,54.8382],[18.6697,54.4309],[19.6045,54.4591]]]},properties:{name:"Poland",id:"PL"},id:"PL"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[152.9656,-4.7565],[152.6807,-4.4986],[152.5985,-3.9948],[153.1241,-4.2523],[152.9656,-4.7565]]],[[[155.9575,-6.687],[155.7191,-6.8628],[155.344,-6.7217],[155.202,-6.3075],[154.782,-5.9706],[154.7412,-5.5453],[154.9969,-5.54],[155.467,-6.145],[155.8225,-6.3803],[155.9575,-6.687]]],[[[151.9158,-4.2967],[152.4054,-4.3406],[152.4001,-4.7312],[152.0135,-5.0038],[152.1431,-5.3571],[151.8652,-5.5649],[151.515,-5.5524],[151.2291,-5.92],[150.4283,-6.2764],[149.6524,-6.2906],[149.3825,-6.078],[149.1264,-6.1277],[148.4011,-5.7651],[148.3447,-5.5449],[148.999,-5.4845],[149.2454,-5.5729],[150.2987,-5.5356],[150.953,-5.4237],[151.3268,-4.9603],[151.6712,-4.8835],[151.5518,-4.3455],[151.9158,-4.2967]]],[[[140.9761,-9.1187],[140.9748,-6.3461],[140.9739,-4.0232],[140.9734,-2.6099],[141.1856,-2.6276],[142.2115,-3.0835],[142.9053,-3.3206],[143.509,-3.4311],[144.0159,-3.7835],[144.4775,-3.8253],[145.0879,-4.349],[145.3347,-4.3854],[145.767,-4.8231],[145.8527,-5.4712],[146.4036,-5.6164],[147.0344,-5.9191],[147.3766,-5.9506],[147.8018,-6.315],[147.8453,-6.6626],[147.1191,-6.7217],[146.9607,-6.929],[147.1902,-7.3782],[147.7242,-7.8762],[148.1268,-8.1035],[148.2471,-8.5545],[148.5831,-9.0516],[149.2476,-9.0712],[149.2032,-9.4068],[149.7612,-9.8058],[149.8744,-10.0131],[150.6672,-10.2573],[150.4825,-10.6368],[150.0169,-10.5773],[149.7541,-10.3531],[147.7685,-10.0699],[146.6965,-9.0255],[146.0334,-8.0764],[144.9738,-7.8021],[144.5099,-7.5673],[143.6137,-8.2003],[143.0948,-8.3112],[143.366,-8.9611],[142.6474,-9.3277],[142.2297,-9.1697],[141.1332,-9.2212],[140.9761,-9.1187]]]]},properties:{name:"Papua New Guinea",id:"PG"},id:"PG"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[134.5956,7.3821],[134.5064,7.4372],[134.5561,7.5939],[134.6595,7.6631],[134.5956,7.3821]]]},properties:{name:"Palau",id:"PW"},id:"PW"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[126.0059,9.3211],[126.1932,9.2767],[126.3197,8.8448],[126.4355,7.8327],[126.5816,7.2476],[126.08,6.7332],[125.8243,7.3333],[125.4008,6.7957],[125.5886,6.4659],[125.6681,5.9785],[125.4559,5.6643],[124.6364,5.9981],[124.078,6.4042],[123.9853,6.9937],[124.2068,7.3963],[123.9684,7.6644],[123.493,7.8078],[123.3909,7.4074],[122.4978,7.6729],[122.176,7.0044],[122.0472,7.3635],[122.132,7.8105],[122.3371,8.0284],[122.911,8.1563],[123.0176,8.3982],[123.4344,8.7032],[124.2258,8.2712],[124.4513,8.6064],[124.731,8.5629],[124.869,8.9722],[125.5336,9.1408],[125.5211,9.7592],[126.0059,9.3211]]],[[[124.5938,9.7871],[124.3599,9.63],[123.9355,9.6238],[123.817,9.8173],[124.1726,10.1351],[124.577,10.0268],[124.5938,9.7871]]],[[[123.1308,9.064],[122.5626,9.4826],[122.4716,9.9616],[122.8556,10.0868],[122.8169,10.5036],[122.9834,10.8867],[123.2564,10.9941],[123.5676,10.7806],[123.1618,9.8644],[123.3083,9.357],[123.1308,9.064]]],[[[123.3705,9.4498],[123.386,9.9669],[123.7114,10.4738],[123.952,10.3167],[123.6435,10.0202],[123.3705,9.4498]]],[[[117.3109,8.4395],[117.35,8.7134],[117.8848,9.2407],[118.1148,9.3468],[119.0239,10.3535],[119.2241,10.4774],[119.2614,10.8449],[119.5268,10.9532],[119.6844,10.5515],[119.1917,10.061],[118.782,9.9163],[118.4348,9.2562],[117.9896,8.8772],[117.3109,8.4395]]],[[[124.5747,11.343],[124.9299,11.3727],[125.0133,10.7854],[125.2535,10.2639],[125.0266,10.0331],[124.7807,10.168],[124.7869,10.7815],[124.4456,10.9235],[124.5747,11.343]]],[[[122.4964,11.6151],[123.1583,11.5356],[123.0167,11.1166],[122.7699,10.8236],[122.1977,10.623],[121.9642,10.8716],[122.1036,11.643],[122.4964,11.6151]]],[[[125.2397,12.5277],[125.5358,12.1913],[125.4568,11.9524],[125.6281,11.1321],[125.2335,11.145],[124.8841,11.7753],[124.3848,12.2441],[124.2946,12.5695],[125.2397,12.5277]]],[[[120.7045,13.4794],[121.2029,13.4324],[121.5225,13.131],[121.5407,12.6383],[121.2367,12.2188],[120.922,12.5117],[120.7635,12.9698],[120.5082,13.2601],[120.7045,13.4794]]],[[[121.1017,18.6153],[121.8457,18.2952],[122.2998,18.4026],[122.1511,17.7563],[122.2368,17.435],[122.5191,17.1247],[122.1351,16.185],[121.5953,15.9333],[121.3925,15.3242],[121.6957,14.7374],[121.8004,14.1138],[122.4907,14.3224],[122.856,14.2509],[123.2315,13.7475],[123.4322,13.9664],[123.726,13.8843],[123.6079,13.5283],[124.1428,13.036],[124.0598,12.5672],[123.311,13.044],[123.1632,13.4417],[122.5954,13.9078],[122.4068,13.4927],[121.7778,13.9375],[121.2034,13.6401],[120.6166,14.1879],[120.922,14.4933],[120.8882,14.7157],[120.0821,14.8511],[119.8309,16.3266],[120.1598,16.0478],[120.3893,16.2218],[120.3054,16.5294],[120.4088,16.9555],[120.3582,17.6383],[120.5997,18.5078],[121.1017,18.6153]]]]},properties:{name:"Philippines",id:"PH"},id:"PH"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-69.9658,-4.2359],[-70.7995,-4.1733],[-70.9737,-4.3504],[-71.8448,-4.5044],[-72.6987,-5.0673],[-72.8871,-5.1228],[-72.9799,-5.635],[-73.2355,-6.0984],[-73.1374,-6.466],[-73.758,-6.9059],[-73.7496,-7.3356],[-74.0021,-7.5562],[-73.5491,-8.3459],[-72.9741,-8.993],[-73.2093,-9.4116],[-72.379,-9.5102],[-72.1815,-10.0038],[-71.238,-9.9661],[-70.637,-9.4782],[-70.6423,-11.0101],[-70.2202,-11.0478],[-69.5785,-10.9519],[-68.6852,-12.502],[-68.9786,-12.8802],[-69.0741,-13.6828],[-68.8803,-14.199],[-69.235,-14.5972],[-69.3748,-14.963],[-69.1726,-15.2368],[-69.4185,-15.6035],[-69.2176,-16.149],[-68.9134,-16.2618],[-69.0208,-16.6422],[-69.6249,-17.2002],[-69.5108,-17.506],[-69.8522,-17.704],[-69.9263,-18.206],[-70.4184,-18.3454],[-71.337,-17.6827],[-71.5323,-17.2943],[-72.1114,-17.0026],[-72.4676,-16.7079],[-73.825,-16.153],[-74.1471,-15.9124],[-75.1043,-15.4117],[-75.5336,-14.899],[-75.934,-14.6336],[-76.2891,-14.1333],[-76.1839,-13.5154],[-76.8322,-12.3489],[-77.1527,-12.0603],[-77.2204,-11.6635],[-77.6332,-11.288],[-77.7362,-10.8365],[-78.1856,-10.089],[-78.7622,-8.6171],[-79.3772,-7.8354],[-79.7621,-7.0666],[-80.1103,-6.6497],[-80.8117,-6.2822],[-81.1805,-5.9426],[-80.8827,-5.7589],[-81.1084,-5.0278],[-81.3366,-4.6695],[-81.2833,-4.3224],[-80.7986,-3.7312],[-80.3247,-3.388],[-80.1793,-3.8776],[-80.51,-4.0694],[-80.4885,-4.3939],[-80.1396,-4.2962],[-79.6385,-4.4547],[-79.3308,-4.9279],[-79.0763,-4.9905],[-78.4198,-3.7769],[-78.3472,-3.4311],[-77.8607,-2.9819],[-76.679,-2.5628],[-76.0898,-2.1331],[-75.5706,-1.5312],[-75.2632,-.5555],[-75.2845,-.1063],[-74.8018,-.2],[-74.4178,-.5809],[-74.2465,-.9706],[-73.6643,-1.2489],[-73.4963,-1.6932],[-73.1969,-1.8304],[-73.1545,-2.2783],[-72.3957,-2.4288],[-71.7525,-2.1527],[-71.3969,-2.3342],[-70.9146,-2.2184],[-70.0741,-2.7502],[-70.7351,-3.7818],[-70.3396,-3.8142],[-69.9658,-4.2359]]]},properties:{name:"Peru",id:"PE"},id:"PE"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-128.2901,-24.3974],[-128.3205,-24.3997],[-128.3503,-24.3402],[-128.3037,-24.3335],[-128.2901,-24.3974]]]},properties:{name:"Pitcairn Islands",id:"PN"},id:"PN"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-77.3742,8.6583],[-77.2124,8.0338],[-77.3509,7.7057],[-77.7439,7.537],[-77.9011,7.2294],[-78.1701,7.5437],[-78.4215,8.0608],[-78.1139,8.3796],[-79.0865,8.997],[-79.4416,9.0059],[-79.7505,8.5953],[-80.3687,8.289],[-80.4581,8.0768],[-80.0752,7.6671],[-80.4388,7.2752],[-80.8456,7.2201],[-81.0352,7.7111],[-81.5041,7.7213],[-81.7276,8.1376],[-82.6796,8.3218],[-82.8793,8.0706],[-82.9976,8.3676],[-82.917,8.7404],[-82.9399,9.4493],[-82.5635,9.5767],[-82.2441,9.0316],[-81.3548,8.7804],[-80.8387,8.8874],[-80.1272,9.2101],[-79.5774,9.598],[-78.5043,9.4063],[-78.0828,9.2363],[-77.3742,8.6583]]]},properties:{name:"Panama",id:"PA"},id:"PA"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[77.7992,35.496],[77.0486,35.1099],[76.5945,34.7357],[75.7093,34.5031],[74.3004,34.7654],[73.9613,34.6535],[74.1499,33.507],[73.9941,33.2424],[74.6578,32.5189],[75.3334,32.2792],[74.5099,31.7127],[74.6329,31.0345],[73.8991,30.4352],[73.809,30.0934],[73.3816,29.9345],[72.903,29.029],[72.342,28.752],[71.8701,27.9623],[70.7373,27.7293],[70.4035,28.0249],[70.1447,27.8491],[69.5681,27.1744],[69.47,26.8046],[70.1567,26.4713],[70.0777,26.0718],[70.2646,25.7064],[70.6521,25.4228],[71.048,24.6877],[71.044,24.4001],[70.5469,24.4183],[69.7163,24.1728],[69.5592,24.2731],[68.7282,24.2656],[68.7242,23.9646],[68.1649,23.8572],[67.6687,23.811],[67.3096,24.175],[67.1715,24.7561],[66.7032,24.8608],[66.6988,25.2261],[66.4284,25.5755],[65.6796,25.3553],[64.7767,25.3074],[64.6591,25.184],[63.7207,25.3859],[63.4912,25.2106],[62.5723,25.2546],[62.3153,25.1347],[61.5878,25.2022],[61.6686,25.769],[61.8697,26.2422],[62.4392,26.5609],[63.1681,26.6657],[63.1667,27.2525],[62.7632,27.2503],[62.7397,28.0023],[62.3531,28.4146],[61.8901,28.5465],[61.6229,28.7915],[61.3184,29.3725],[60.8434,29.8586],[62.4765,29.4085],[63.5676,29.4982],[64.0989,29.3921],[64.521,29.5643],[65.0954,29.5594],[66.1772,29.8355],[66.3974,30.9124],[66.9243,31.3057],[67.2874,31.2178],[67.5781,31.5063],[68.2138,31.8073],[68.869,31.6342],[69.2791,31.9369],[69.2414,32.4336],[69.5015,33.02],[69.9201,33.1123],[70.2841,33.3689],[69.8682,33.8976],[71.0516,34.0498],[70.9655,34.5306],[71.6206,35.1831],[71.4276,35.8338],[71.1852,36.042],[71.6206,36.4366],[72.623,36.8295],[73.7691,36.8885],[74.0017,36.8233],[74.5415,37.0221],[75.3467,36.9134],[75.8403,36.6497],[75.945,36.0176],[76.2518,35.8108],[77.4467,35.4756],[77.7992,35.496]]]},properties:{name:"Pakistan",id:"PK"},id:"PK"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[56.388,24.9793],[56.6406,24.4702],[57.2199,23.9229],[58.5782,23.6437],[59.7998,22.2201],[59.3714,21.4988],[58.8956,21.1126],[58.4743,20.4068],[57.8618,20.2439],[57.7153,19.6069],[57.8116,19.017],[57.1764,18.9025],[56.6553,18.5873],[56.551,18.166],[56.2704,17.9508],[55.479,17.8433],[55.0644,17.039],[54.0683,17.0057],[53.6097,16.7598],[53.0855,16.6484],[52.729,17.3005],[51.9775,18.9961],[53.667,19.559],[54.9774,19.9958],[55.641,22.0017],[55.186,22.704],[55.1997,23.0346],[55.7608,24.2425],[55.7959,24.8679],[56.064,24.7388],[56.388,24.9793]]]},properties:{name:"Oman",id:"OM"},id:"OM"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[173.1152,-41.2791],[173.738,-40.9888],[174.3026,-41.0194],[174.0922,-41.505],[174.2831,-41.7407],[173.5449,-42.518],[173.2213,-42.9765],[172.7184,-43.2589],[172.9208,-43.8914],[172.3855,-43.8297],[171.4426,-44.136],[171.1133,-45.0393],[170.7005,-45.6843],[169.6866,-46.5516],[168.382,-46.6054],[168.1889,-46.3621],[167.682,-46.193],[166.7316,-46.1979],[166.7338,-45.5436],[167.1946,-44.9634],[167.7872,-44.595],[168.3665,-44.0818],[168.8064,-43.9922],[169.6613,-43.5913],[170.3027,-43.1075],[170.7417,-42.9273],[171.2571,-42.4652],[171.4861,-41.7949],[172.0108,-41.4447],[172.1396,-40.9471],[172.6407,-40.5183],[172.9887,-40.8481],[173.1152,-41.2791]]],[[[173.2693,-34.935],[173.8441,-35.0264],[174.3204,-35.2466],[174.5437,-35.5822],[174.391,-35.7739],[174.802,-36.3093],[174.7226,-36.8411],[175.2996,-36.9933],[175.4608,-36.4757],[175.8762,-36.9578],[176.1084,-37.6449],[177.3358,-37.9907],[178.0091,-37.5548],[178.536,-37.692],[178.2679,-38.5509],[177.9763,-38.7223],[177.9656,-39.1426],[177.4077,-39.0809],[176.954,-39.3677],[177.1098,-39.6731],[176.8421,-40.1578],[175.9828,-41.2134],[175.3098,-41.6107],[174.6356,-41.2893],[175.1625,-40.6217],[175.2543,-40.2892],[175.0093,-39.9523],[173.9342,-39.5093],[173.8441,-39.1395],[174.5974,-38.7849],[174.9281,-37.8043],[174.7292,-37.4487],[174.782,-36.9436],[174.4758,-36.9418],[174.4469,-36.4509],[173.9453,-36.1761],[173.1166,-35.2053],[173.2693,-34.935]]]]},properties:{name:"New Zealand",id:"NZ"},id:"NZ"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[20.898,80.2499],[22.4507,80.4022],[26.8608,80.16],[27.1986,79.9065],[25.641,79.403],[23.9475,79.1943],[20.8611,79.3978],[18.7251,79.7607],[18.3438,80.0595],[20.898,80.2499]]],[[[16.7867,79.9068],[18.5813,79.5716],[19.0896,79.157],[20.4581,79.1293],[21.3889,78.7404],[19.7687,78.6228],[18.4393,78.0251],[16.7005,76.5794],[14.3657,77.2345],[14.921,77.6889],[13.6807,78.028],[11.7738,78.7165],[10.866,79.7965],[12.7535,79.7758],[13.3838,79.4809],[15.8163,79.6819],[16.7867,79.9068]]],[[[21.6082,78.5957],[23.1166,77.9916],[24.2383,77.8986],[23.8414,77.4978],[22.057,77.5011],[21.6082,77.9161],[20.2282,78.4779],[21.6082,78.5957]]]]},properties:{name:"Svalbard and Jan Mayen",id:"SJ"},id:"SJ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[166.9584,-.5165],[166.9163,-.5467],[166.9136,-.4992],[166.9584,-.5165]]]},properties:{name:"Nauru",id:"NR"},id:"NR"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[88.1099,27.8704],[87.9843,27.134],[88.1614,26.7247],[88.0549,26.43],[87.2874,26.3603],[87.0166,26.5556],[86.7014,26.4349],[86.3663,26.5743],[85.293,26.7412],[84.6853,27.0412],[84.6103,27.2987],[84.0909,27.4913],[83.2897,27.371],[82.7335,27.5189],[81.9877,27.9139],[81.8528,27.8669],[80.5868,28.6494],[80.0706,28.8301],[80.4017,29.7303],[81.0103,30.1645],[81.4169,30.3376],[82.0432,30.3269],[82.1591,30.1152],[82.8542,29.6833],[83.1556,29.6127],[83.5835,29.1834],[84.1016,29.2198],[84.2285,28.9118],[84.7141,28.5957],[85.1589,28.5922],[85.1225,28.3161],[85.6783,28.2775],[86.4089,27.9286],[86.5545,28.0853],[87.1413,27.8385],[88.1099,27.8704]]]},properties:{name:"Nepal",id:"NP"},id:"NP"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[30.8696,69.7834],[28.9657,69.0219],[29.1415,69.6715],[27.8897,70.0617],[26.5257,69.915],[26.0116,69.6526],[25.7484,68.9901],[24.9414,68.5933],[23.8539,68.8059],[22.4108,68.7198],[21.622,69.2707],[20.6223,69.037],[19.9698,68.3565],[18.3785,68.5624],[17.9168,67.965],[17.3247,68.1039],[16.1275,67.4259],[16.4036,67.055],[15.423,66.4899],[14.5432,66.1292],[14.4798,65.3014],[13.6501,64.5816],[14.0776,64.464],[13.9604,64.0141],[12.6625,63.9404],[11.9997,63.2917],[12.2181,63.0007],[12.3034,62.2856],[12.1555,61.7207],[12.8809,61.3523],[12.294,61.0027],[12.5888,60.4508],[12.4862,60.1067],[11.6806,59.5923],[11.7982,59.29],[11.3885,59.0365],[10.8345,59.1839],[9.6182,58.946],[8.1663,58.1452],[7.0051,58.0242],[5.7067,58.5236],[5.8452,59.3535],[5.1314,59.2265],[5.2441,60.5695],[5.0493,60.7076],[4.9276,61.7107],[5.5336,62.3109],[6.353,62.6112],[7.2838,62.6023],[7.0086,62.9576],[8.1006,63.091],[8.398,63.5351],[9.6968,63.6246],[9.7079,63.865],[11.3499,64.9059],[12.1595,65.1789],[12.2727,65.5682],[12.9763,66.0192],[13.1046,66.5394],[14.755,67.4991],[14.7989,67.8094],[16.0644,68.2],[16.6517,68.6257],[18.1015,69.1564],[18.2932,69.4751],[20.0688,69.8835],[21.163,69.8895],[21.4005,70.1744],[22.6847,70.3749],[23.0464,70.1019],[24.4198,70.702],[24.6582,71.001],[25.7684,70.8531],[27.5972,71.0913],[29.1024,70.8607],[30.9442,70.2745],[29.6014,69.9767],[29.7923,69.7279],[30.8696,69.7834]]]},properties:{name:"Norway",id:"NO"},id:"NO"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-169.8034,-19.0832],[-169.9039,-19.1378],[-169.9483,-19.0729],[-169.834,-18.966],[-169.8034,-19.0832]]]},properties:{name:"Niue",id:"NU"},id:"NU"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-83.1576,14.9931],[-83.2992,14.749],[-83.1878,14.3401],[-83.4124,13.9966],[-83.5673,13.3205],[-83.511,12.4119],[-83.7693,11.9316],[-83.6517,11.6422],[-83.8679,11.2999],[-83.6419,10.9173],[-84.1684,10.7806],[-84.3484,10.9799],[-84.9092,10.9453],[-85.6215,11.1845],[-85.7444,11.062],[-86.4688,11.7385],[-86.7556,12.1566],[-87.6676,12.9037],[-87.3373,12.9792],[-87.0592,12.9916],[-86.7108,13.3134],[-86.7336,13.7635],[-86.3317,13.7702],[-86.1512,13.9948],[-85.7868,13.8443],[-85.1796,14.3432],[-84.9851,14.7525],[-84.646,14.6611],[-83.8674,14.7947],[-83.1576,14.9931]]]},properties:{name:"Nicaragua",id:"NI"},id:"NI"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[13.6062,13.7045],[14.0638,13.0786],[14.1974,12.3839],[14.6271,12.1087],[14.5597,11.4921],[13.892,11.1401],[13.5352,10.6052],[13.2697,10.0362],[13.1756,9.5394],[12.9297,9.4263],[12.8067,8.8865],[12.4037,8.5957],[12.0162,7.5899],[11.7676,7.272],[11.5518,6.6972],[11.1532,6.438],[11.0325,6.6981],[10.6064,7.063],[10.1438,6.9964],[9.0603,6.0092],[8.801,5.1973],[8.556,4.7552],[8.2932,4.5576],[7.1546,4.5146],[6.7569,4.3437],[6.0764,4.2904],[5.5877,4.6473],[5.2326,5.4836],[4.8611,6.0265],[4.4314,6.3487],[4.126,6.4113],[2.7064,6.3692],[2.7748,6.7119],[2.686,7.874],[2.7748,9.0485],[3.0451,9.084],[3.3252,9.7783],[3.5573,9.9074],[3.5764,10.2683],[3.8343,10.6074],[3.7163,11.0797],[3.4877,11.3954],[3.5955,11.6963],[3.6466,12.5299],[3.948,12.775],[4.1477,13.4577],[4.8233,13.76],[5.4918,13.8727],[6.3863,13.6037],[6.8044,13.1074],[7.0565,13],[7.7885,13.3378],[8.0953,13.2912],[8.7504,12.9081],[9.616,12.8105],[10.1847,13.2699],[10.9588,13.3716],[11.412,13.3538],[12.4632,13.0937],[12.6549,13.3267],[13.3239,13.6707],[13.6062,13.7045]]]},properties:{name:"Nigeria",id:"NG"},id:"NG"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[167.9394,-29.0175],[167.979,-29.0756],[167.9204,-29.0827],[167.9394,-29.0175]]]},properties:{name:"Norfolk Island",id:"NF"},id:"NF"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[14.9791,22.996],[15.1722,21.9223],[15.182,21.5232],[15.6072,20.9546],[15.5873,20.7335],[15.949,20.3034],[15.7351,19.9039],[15.4745,16.9085],[14.3679,15.7499],[13.4481,14.3805],[13.6062,13.7045],[13.3239,13.6707],[12.6549,13.3267],[12.4632,13.0937],[11.412,13.3538],[10.9588,13.3716],[10.1847,13.2699],[9.616,12.8105],[8.7504,12.9081],[8.0953,13.2912],[7.7885,13.3378],[7.0565,13],[6.8044,13.1074],[6.3863,13.6037],[5.4918,13.8727],[4.8233,13.76],[4.1477,13.4577],[3.948,12.775],[3.6466,12.5299],[3.5955,11.6963],[2.8782,12.3679],[2.3659,12.2219],[2.389,11.897],[2.0912,12.2778],[2.0739,12.7142],[1.5652,12.6356],[.9872,13.0418],[.9779,13.5518],[.6183,13.7036],[.1638,14.4973],[.2175,14.9114],[.9601,14.9869],[1.3002,15.2723],[3.5041,15.3562],[3.8769,15.7553],[4.1823,16.5818],[4.2347,16.9964],[4.2276,19.1426],[5.8367,19.4791],[7.4818,20.8729],[9.3785,21.9915],[11.9678,23.518],[13.4814,23.1802],[14.2307,22.6183],[14.9791,22.996]]]},properties:{name:"Niger",id:"NE"},id:"NE"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[164.2023,-20.2462],[164.4358,-20.2821],[165.1918,-20.7691],[165.6627,-21.2671],[166.9425,-22.0901],[166.7742,-22.3759],[166.096,-21.9565],[165.2419,-21.5255],[164.4549,-20.829],[164.1699,-20.4801],[164.2023,-20.2462]]]},properties:{name:"New Caledonia",id:"NC"},id:"NC"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[23.3807,-17.6405],[24.2751,-17.4812],[24.9325,-17.5433],[25.2588,-17.7936],[24.359,-17.9783],[23.5804,-18.4528],[23.2986,-18.0276],[20.9739,-18.3188],[20.9779,-20.9684],[20.9708,-22],[19.9774,-22],[19.9805,-24.777],[19.9805,-26.5312],[19.9805,-28.4515],[19.6715,-28.5039],[19.2458,-28.9016],[18.1028,-28.8719],[17.4481,-28.6983],[17.3855,-28.3534],[17.0561,-28.0311],[16.7556,-28.4524],[16.4475,-28.6175],[15.7191,-27.9659],[15.3413,-27.3866],[14.9676,-26.3182],[14.8451,-25.7256],[14.8371,-25.0331],[14.5015,-24.2021],[14.474,-23.281],[14.5259,-22.7027],[14.3217,-22.19],[13.9733,-21.7678],[13.4504,-20.9169],[13.1685,-20.1845],[12.4583,-18.9269],[12.0956,-18.5412],[11.776,-18.0018],[11.7432,-17.2494],[12.5479,-17.2126],[13.101,-16.9676],[13.4038,-17.008],[13.9382,-17.3888],[16.9136,-17.3915],[18.3962,-17.3995],[18.8259,-17.7661],[19.6396,-17.8687],[20.3928,-17.8873],[20.625,-17.9965],[21.4169,-18.0005],[23.3807,-17.6405]]]},properties:{name:"Namibia",id:"NA"},id:"NA"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[45.1802,-12.9765],[45.0692,-12.8957],[45.1349,-12.7093],[45.2233,-12.7519],[45.1802,-12.9765]]]},properties:{name:"Mayotte",id:"YT"},id:"YT"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[102.1009,6.2422],[102.9825,5.5249],[103.4157,4.8502],[103.4686,4.3934],[103.362,3.7693],[103.4397,2.933],[103.8121,2.5805],[104.2884,1.4806],[103.6945,1.4495],[102.7273,1.8557],[101.2953,2.8851],[101.2997,3.2535],[100.7155,3.9664],[100.6143,4.6522],[100.3524,5.5875],[100.3431,5.9843],[100.119,6.442],[100.3453,6.5498],[101.0533,6.2427],[101.2571,5.7894],[101.5563,5.908],[101.8737,5.8254],[102.1009,6.2422]]],[[[117.5746,4.1706],[117.1005,4.337],[115.8962,4.3486],[115.5686,3.9389],[115.4545,3.0342],[115.0861,2.8411],[115.1509,2.4931],[114.7865,2.2503],[114.8304,1.98],[114.5459,1.4673],[113.9022,1.4344],[113.6222,1.236],[112.476,1.5592],[112.1857,1.4393],[112.0783,1.1432],[111.7698,.9994],[110.9379,1.0172],[110.5056,.8618],[109.6542,1.6151],[109.6289,2.0275],[109.9845,1.7176],[110.3493,1.7198],[110.9402,1.5174],[111.1541,1.7389],[111.242,2.4358],[111.7276,2.854],[112.7375,3.0706],[113.0446,3.2051],[113.924,4.2434],[114.0638,4.5927],[114.6085,4.0241],[114.8402,4.3934],[114.7465,4.7179],[115.0266,4.8999],[115.1398,4.8999],[115.5198,5.049],[115.419,5.413],[115.7968,5.536],[116.1386,6.1295],[116.4946,6.5219],[117.294,6.6768],[117.6456,6.4735],[117.6172,5.9408],[118.0038,6.0531],[118.1157,5.8627],[118.5946,5.5919],[119.2236,5.4126],[119.1322,5.1005],[118.1854,4.8284],[118.4979,4.3623],[117.5746,4.1706]]]]},properties:{name:"Malaysia",id:"MY"},id:"MY"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[34.9596,-11.5783],[34.6595,-11.5885],[34.3608,-12.2104],[34.5636,-13.3601],[35.2477,-13.8967],[35.8474,-14.6709],[35.7555,-16.0585],[35.3587,-16.1606],[35.1673,-16.5601],[35.2903,-17.0967],[34.3954,-16.1992],[34.248,-15.8876],[34.541,-15.2972],[34.5055,-14.5981],[34.3324,-14.4085],[33.6364,-14.5683],[33.2018,-14.0135],[32.9812,-14.0095],[32.6722,-13.6104],[32.9679,-13.2251],[33.0216,-12.6303],[33.398,-12.49],[33.2524,-12.1127],[33.2262,-11.5348],[33.3798,-11.1579],[33.2613,-10.8934],[33.659,-10.5906],[33.3509,-9.8622],[32.9199,-9.4072],[34.3208,-9.7317],[34.5241,-10.03],[34.6617,-10.71],[34.608,-11.0807],[34.9596,-11.5783]]]},properties:{name:"Malawi",id:"MW"},id:"MW"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[57.6514,-20.485],[57.3859,-20.2284],[57.5759,-19.9971],[57.7921,-20.2124],[57.6514,-20.485]]]},properties:{name:"Mauritius",id:"MU"},id:"MU"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-60.8263,14.4946],[-61.0638,14.4671],[-61.2198,14.8044],[-60.9186,14.7352],[-60.8263,14.4946]]]},properties:{name:"Martinique",id:"MQ"},id:"MQ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-62.1484,16.7403],[-62.1542,16.6812],[-62.2217,16.6994],[-62.223,16.7518],[-62.1484,16.7403]]]},properties:{name:"Montserrat",id:"MS"},id:"MS"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-12.2807,14.8089],[-12.8584,15.2426],[-13.2579,15.7002],[-13.4095,16.0593],[-13.8685,16.1481],[-14.3,16.5805],[-15.1128,16.6448],[-15.6208,16.5068],[-16.1683,16.5472],[-16.4411,16.2045],[-16.5352,15.8383],[-16.5356,16.2866],[-16.0789,17.5459],[-16.0849,18.5212],[-16.2132,19.0032],[-16.5146,19.3619],[-16.2835,19.7871],[-16.2105,20.2279],[-16.4298,20.6523],[-17.0481,20.8063],[-16.9647,21.3292],[-15.0018,21.3314],[-13.0163,21.3341],[-13.0944,22.4958],[-13.0316,23],[-12.6203,23.2712],[-12.0235,23.4674],[-12.0164,25.9954],[-10.5624,25.9954],[-8.6821,25.9954],[-8.6834,27.2858],[-6.2387,25.848],[-4.8227,24.9958],[-6.594,24.9944],[-6.3113,22.5291],[-6.1404,21.0367],[-5.8556,18.5505],[-5.6286,16.5685],[-5.36,16.2831],[-5.5125,15.4965],[-7.3555,15.496],[-9.1768,15.496],[-9.9414,15.374],[-10.6965,15.4228],[-10.8956,15.1502],[-11.5026,15.6367],[-11.7603,15.4255],[-11.8728,14.9953],[-12.2807,14.8089]]]},properties:{name:"Mauritania",id:"MR"},id:"MR"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[32.8862,-26.8495],[32.1129,-26.8393],[31.9482,-25.9577],[31.986,-24.4605],[31.7995,-23.8923],[31.5456,-23.4821],[31.2877,-22.4021],[32.3713,-21.335],[32.4778,-20.7131],[33.0069,-19.8737],[32.7166,-19.0019],[32.9932,-18.3596],[32.9479,-16.7123],[32.2434,-16.4487],[31.9398,-16.4287],[31.2362,-16.0239],[30.4377,-15.9954],[30.3959,-15.643],[30.2317,-14.9905],[31.729,-14.496],[33.2018,-14.0135],[33.6364,-14.5683],[34.3324,-14.4085],[34.5055,-14.5981],[34.541,-15.2972],[34.248,-15.8876],[34.3954,-16.1992],[35.2903,-17.0967],[35.1673,-16.5601],[35.3587,-16.1606],[35.7555,-16.0585],[35.8474,-14.6709],[35.2477,-13.8967],[34.5636,-13.3601],[34.3608,-12.2104],[34.6595,-11.5885],[34.9596,-11.5783],[35.6312,-11.5818],[35.7852,-11.4531],[36.5185,-11.7163],[36.9789,-11.5667],[37.5417,-11.675],[37.9204,-11.2946],[38.4917,-11.4131],[38.7948,-11.2289],[39.3217,-11.1224],[39.9889,-10.821],[40.4634,-10.4641],[40.5447,-11.0656],[40.403,-11.3319],[40.5806,-12.6356],[40.5451,-13.463],[40.6401,-14.3899],[40.835,-14.7916],[40.5589,-15.4734],[40.1087,-15.9795],[39.8446,-16.4358],[39.0842,-16.9729],[38.145,-17.2428],[37.2443,-17.7399],[36.5403,-18.5181],[35.6512,-19.1639],[34.9481,-19.8129],[34.7559,-19.8218],[34.6981,-20.4042],[34.9822,-20.8063],[35.2677,-21.6511],[35.3156,-22.3968],[35.5753,-22.9632],[35.3702,-23.7982],[35.4381,-24.171],[35.1558,-24.5413],[34.6072,-24.8214],[33.3474,-25.2608],[32.7921,-25.6443],[32.5905,-26.0039],[32.9337,-26.2525],[32.8862,-26.8495]]]},properties:{name:"Mozambique",id:"MZ"},id:"MZ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[145.7519,15.1334],[145.6845,15.1249],[145.7133,15.2155],[145.7821,15.1747],[145.7519,15.1334]]]},properties:{name:"Northern Mariana Islands",id:"MP"},id:"MP"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[116.6832,49.8238],[115.5575,47.945],[115.8984,47.6871],[116.7605,47.87],[117.3508,47.652],[117.7685,47.988],[118.4983,47.9841],[119.711,47.15],[119.8979,46.8579],[119.7066,46.6062],[118.3088,46.7172],[117.3335,46.3621],[116.5625,46.2897],[116.2407,45.7961],[115.6809,45.4583],[114.517,45.3646],[114.0305,44.9425],[113.5871,44.7459],[111.8981,45.0641],[111.4022,44.3672],[111.9331,43.7116],[111.0072,43.3414],[110.4004,42.7736],[109.4434,42.4558],[108.1712,42.4474],[106.7702,42.2889],[105.1971,41.738],[104.4984,41.6586],[104.4984,41.877],[103.7109,41.7514],[103.0726,42.0062],[101.9731,42.2157],[101.7139,42.4656],[99.984,42.6773],[99.4678,42.5681],[97.2057,42.7896],[96.3854,42.7204],[95.9126,43.2064],[95.3502,44.278],[94.7119,44.3508],[93.6563,44.9008],[92.7876,45.0357],[91.5842,45.0766],[90.8771,45.196],[90.6618,45.5253],[91.0019,46.0358],[91.0338,46.529],[90.87,46.9547],[90.4963,47.2854],[90.3134,47.676],[89.561,48.004],[89.0478,48.0027],[88.517,48.3844],[87.9798,48.5549],[87.8143,49.1624],[88.1925,49.4518],[88.8317,49.4485],[89.6542,49.7175],[89.644,49.903],[91.8044,50.6936],[94.2511,50.5564],[94.6147,50.0237],[95.5229,49.9112],[95.8518,50.0129],[96.986,49.8828],[97.2088,49.7308],[98.1032,50.0779],[98.2795,50.5333],[97.8254,50.9852],[97.947,51.3483],[98.8485,52.0701],[100.4687,51.7261],[101.3814,51.4526],[102.1116,51.3534],[102.2883,50.585],[102.6833,50.3871],[103.6328,50.1387],[105.3835,50.4736],[106.218,50.3045],[106.7112,50.3125],[107.2332,49.9893],[107.9479,49.9247],[108.034,49.594],[108.6137,49.3228],[109.2365,49.3348],[110.1997,49.1704],[110.8279,49.1661],[111.3366,49.3559],[113.0557,49.6162],[113.1641,49.7971],[114.2969,50.2743],[114.743,50.2337],[115.2743,49.9489],[116.1346,50.0109],[116.6832,49.8238]]]},properties:{name:"Mongolia",id:"MN"},id:"MN"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[19.1943,43.5331],[19.5517,43.2122],[20.3445,42.8278],[20.0639,42.5473],[19.6546,42.6285],[19.2809,42.1726],[19.3426,41.869],[18.5174,42.4327],[18.4362,42.5597],[18.4437,42.9685],[18.9404,43.4967],[19.1943,43.5331]]]},properties:{name:"Montenegro",id:"ME"},id:"ME"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[101.139,21.5676],[100.7564,21.3128],[100.2495,20.7304],[100.1225,20.3167],[99.8904,20.4246],[99.3382,20.0788],[99.0208,20.0419],[98.9169,19.7729],[98.1112,19.7623],[97.8169,19.46],[97.7539,18.621],[97.4849,18.4941],[97.793,17.6813],[98.4388,16.9755],[98.6892,16.3052],[98.5653,15.4037],[98.1911,15.204],[98.2462,14.8147],[99.1366,13.7165],[99.2196,12.7399],[99.4052,12.5477],[99.6147,11.7811],[99.1903,11.1051],[98.7571,10.6612],[98.7025,10.1902],[98.465,10.6758],[98.6754,10.987],[98.7416,11.5916],[98.576,13.162],[98.2453,13.7333],[97.8121,14.859],[97.7104,15.8756],[97.5843,16.0194],[97.6194,16.5374],[97.3757,16.5228],[97.1782,17.0621],[96.6224,16.564],[95.7635,16.169],[95.3897,15.7229],[94.9427,15.8183],[94.5876,16.2888],[94.2143,16.1268],[94.589,17.5695],[94.4309,18.2016],[94.07,18.8936],[93.7056,19.0267],[93.9981,19.4409],[93.3625,20.0584],[93.002,20.0748],[92.7357,20.5626],[92.3242,20.7917],[92.1795,21.2933],[92.5937,21.4673],[92.575,21.9782],[92.9643,22.0039],[93.1618,22.3604],[93.0788,22.7182],[93.366,23.1323],[93.4149,23.6823],[93.3074,24.0219],[94.1277,23.8763],[94.2929,24.3219],[94.7075,25.0486],[94.6227,25.4099],[95.1323,26.0411],[95.1287,26.5973],[96.0613,27.217],[96.6659,27.3391],[97.3353,27.9379],[97.3224,28.218],[97.5377,28.5101],[98.0988,28.1421],[98.299,27.5499],[98.651,27.5726],[98.7318,26.5836],[98.6546,25.9177],[98.0109,25.2923],[97.8196,25.2519],[97.5315,24.4915],[97.686,23.898],[98.2124,24.1106],[98.7642,24.116],[98.8636,23.1913],[99.3408,23.0959],[99.3377,22.498],[99.193,22.126],[99.9179,22.0279],[100.2148,21.4628],[101.139,21.5676]]]},properties:{name:"Myanmar",id:"MM"},id:"MM"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[14.5663,35.8529],[14.4363,35.8219],[14.3524,35.8725],[14.4482,35.9572],[14.5663,35.8529]]]},properties:{name:"Malta",id:"MT"},id:"MT"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[4.2276,19.1426],[4.2347,16.9964],[4.1823,16.5818],[3.8769,15.7553],[3.5041,15.3562],[1.3002,15.2723],[.9601,14.9869],[.2175,14.9114],[-.2359,15.0592],[-.7604,15.0477],[-1.0496,14.8195],[-1.7678,14.4862],[-2.1132,14.1684],[-2.4572,14.274],[-3.1985,13.673],[-3.3017,13.2806],[-3.5758,13.194],[-4.0512,13.3822],[-4.3286,13.119],[-4.2272,12.7936],[-4.4807,12.6724],[-4.4287,12.3377],[-4.798,12.0319],[-5.2881,11.8277],[-5.2999,11.2058],[-5.4905,11.0425],[-5.5236,10.4259],[-6.0345,10.1946],[-6.2611,10.7242],[-6.6932,10.3495],[-7.1049,10.2035],[-7.6611,10.4272],[-7.9907,10.1627],[-8.2315,10.4379],[-8.4075,11.3865],[-8.8219,11.6732],[-9.043,12.4025],[-9.8207,12.0426],[-10.2748,12.2126],[-10.6774,11.8996],[-10.9333,12.205],[-11.3053,12.0155],[-11.3894,12.4043],[-11.3903,12.9419],[-11.6349,13.3698],[-12.0543,13.633],[-12.0193,14.2065],[-12.2807,14.8089],[-11.8728,14.9953],[-11.7603,15.4255],[-11.5026,15.6367],[-10.8956,15.1502],[-10.6965,15.4228],[-9.9414,15.374],[-9.1768,15.496],[-7.3555,15.496],[-5.5125,15.4965],[-5.36,16.2831],[-5.6286,16.5685],[-5.8556,18.5505],[-6.1404,21.0367],[-6.3113,22.5291],[-6.594,24.9944],[-4.8227,24.9958],[-3.2579,23.981],[-1.2931,22.6964],[1.1457,21.1024],[1.1657,20.8174],[1.6855,20.3784],[2.2195,20.2479],[2.4063,20.0637],[3.2036,19.7898],[3.2559,19.4107],[3.1059,19.1502],[3.4007,18.9886],[4.2276,19.1426]]]},properties:{name:"Mali",id:"ML"},id:"ML"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[22.3442,42.3138],[22.8369,41.9937],[23.0056,41.7172],[22.9159,41.3363],[22.7246,41.1783],[21.9296,41.1073],[21.5758,40.8689],[20.9641,40.8498],[20.4892,41.2724],[20.566,41.8739],[21.0596,42.1713],[21.5625,42.2476],[22.3442,42.3138]]]},properties:{name:"North Macedonia",id:"MK"},id:"MK"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[171.1017,7.1384],[171.2269,7.0869],[171.2025,7.0736],[171.0955,7.1091],[171.1017,7.1384]]]},properties:{name:"Marshall Islands",id:"MH"},id:"MH"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-97.1462,25.9617],[-97.5071,25.0144],[-97.6676,24.3899],[-97.8578,22.6245],[-97.6376,21.6035],[-97.1214,20.615],[-96.456,19.8697],[-96.2895,19.3437],[-95.821,18.7546],[-95.1818,18.7005],[-94.798,18.5145],[-94.5461,18.1749],[-94.189,18.1953],[-93.5523,18.4306],[-92.8849,18.4688],[-92.7102,18.6117],[-91.9738,18.716],[-91.8031,18.4706],[-91.2753,18.6246],[-91.343,18.9007],[-90.7393,19.3521],[-90.5072,19.9119],[-90.4841,20.5564],[-90.3531,21.0096],[-89.8198,21.2746],[-88.8787,21.414],[-88.1317,21.616],[-86.8242,21.4215],[-86.8648,20.8849],[-87.4672,20.1023],[-87.4248,19.5834],[-87.7619,18.4461],[-88.1967,18.7196],[-88.2957,18.4723],[-88.523,18.4457],[-88.8064,17.9654],[-89.1615,17.8149],[-90.9892,17.8163],[-90.993,17.2525],[-91.4096,17.2561],[-90.7107,16.7083],[-90.417,16.3909],[-90.4472,16.0726],[-91.7365,16.07],[-92.1871,15.3207],[-92.0748,15.0743],[-92.2352,14.5452],[-92.809,15.1387],[-93.916,16.0536],[-94.3741,16.2848],[-94.6615,16.2018],[-94.9004,16.4176],[-95.4643,15.9745],[-96.5108,15.6518],[-97.1846,15.9093],[-97.7548,15.967],[-98.5203,16.3048],[-98.7622,16.5347],[-99.6906,16.7198],[-100.0244,16.9205],[-100.8478,17.2006],[-101.6002,17.6516],[-101.847,17.9223],[-102.6995,18.0626],[-103.4415,18.3254],[-103.9125,18.8283],[-104.9385,19.3095],[-105.4821,19.9762],[-105.6694,20.3855],[-105.237,21.1193],[-105.2086,21.4908],[-105.6492,21.988],[-105.7917,22.6276],[-106.4023,23.1958],[-106.9354,23.8812],[-107.9512,24.6149],[-108.3736,25.1942],[-109.385,25.7273],[-109.4256,26.0327],[-109.1997,26.3052],[-109.4829,26.7105],[-109.7548,26.703],[-109.9441,27.0794],[-110.4779,27.3227],[-110.5298,27.8642],[-111.1215,27.9672],[-111.6801,28.4706],[-112.1618,29.0188],[-112.2235,29.2696],[-112.7384,29.9856],[-113.1104,30.7934],[-113.0467,31.1792],[-114.1493,31.5072],[-114.8395,31.7984],[-114.8819,31.1565],[-114.6334,30.5067],[-114.6498,30.2381],[-114.3726,29.8302],[-113.7556,29.3677],[-113.4997,28.9269],[-112.8709,28.4244],[-112.7339,27.826],[-112.3291,27.5233],[-112.0091,26.9671],[-111.5696,26.7074],[-111.2917,25.7899],[-111.0345,25.5271],[-110.6774,24.7885],[-110.5471,24.2141],[-110.0229,24.1746],[-109.421,23.4803],[-109.458,23.2149],[-109.9234,22.8859],[-110.3627,23.6051],[-111.4194,24.329],[-112.0725,24.84],[-112.0557,25.488],[-112.3773,26.2138],[-113.0207,26.5831],[-113.2058,26.857],[-113.5986,26.7212],[-113.841,26.9667],[-114.4454,27.2183],[-114.9936,27.7359],[-114.3007,27.8731],[-114.0485,28.4262],[-114.1455,28.6055],[-114.9936,29.3845],[-115.6738,29.7565],[-116.0622,30.8041],[-116.6622,31.5649],[-117.1282,32.5335],[-114.7248,32.7155],[-114.836,32.5082],[-112.939,31.916],[-111.042,31.3243],[-108.2145,31.3292],[-108.2118,31.7793],[-106.4533,31.77],[-106.2558,31.5445],[-104.9179,30.5835],[-104.504,29.6775],[-104.1107,29.3863],[-103.2577,29.001],[-102.892,29.2163],[-102.7342,29.6438],[-102.269,29.871],[-101.4404,29.7769],[-100.6587,29.0685],[-100.2961,28.3276],[-99.5053,27.5482],[-99.4436,27.0368],[-99.1078,26.4469],[-98.0828,26.0642],[-97.3582,25.8707],[-97.1462,25.9617]]]},properties:{name:"Mexico",id:"MX"},id:"MX"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[73.5121,4.1644],[73.473,4.1706],[73.5041,4.2345],[73.5285,4.2434],[73.5121,4.1644]]]},properties:{name:"Maldives",id:"MV"},id:"MV"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[49.5383,-12.4323],[49.9374,-13.0724],[50.174,-14.0401],[50.2353,-14.7321],[50.4829,-15.3855],[50.2091,-15.9604],[49.8926,-15.4579],[49.6498,-15.5671],[49.8389,-16.4864],[49.4491,-17.2406],[49.478,-17.8984],[48.6071,-20.4574],[48.3509,-21.3488],[47.9084,-22.4661],[47.5581,-23.8745],[47.1773,-24.7872],[46.7285,-25.1498],[46.1586,-25.2306],[45.5078,-25.5631],[45.1154,-25.5431],[44.8131,-25.334],[44.3457,-25.2262],[44.0354,-24.9958],[43.6874,-24.3579],[43.7225,-23.5296],[43.398,-22.8864],[43.2666,-22.0492],[43.5019,-21.3563],[43.8556,-21.0767],[44.4047,-19.9221],[44.4487,-19.4285],[44.2387,-19.0752],[44.2329,-18.7405],[44.0399,-18.2886],[43.9795,-17.3915],[44.4216,-16.7026],[44.4762,-16.2174],[44.9094,-16.1743],[45.1669,-15.983],[45.5984,-15.9928],[45.7,-15.8139],[46.3317,-15.7136],[46.475,-15.5134],[47.8116,-14.5448],[47.9954,-13.9606],[48.7966,-13.2673],[48.8996,-12.4585],[49.2072,-12.0794],[49.5383,-12.4323]]]},properties:{name:"Madagascar",id:"MG"},id:"MG"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[28.2124,45.4503],[28.0997,45.9728],[28.2444,46.4513],[28.0717,46.9786],[27.3366,47.6396],[26.9806,48.155],[26.6189,48.2597],[27.5493,48.4777],[29.1948,47.8824],[29.1597,47.4558],[29.5494,47.2467],[29.8779,46.829],[29.838,46.3505],[29.1464,46.5268],[28.9475,46.05],[28.2124,45.4503]]]},properties:{name:"Moldova",id:"MD"},id:"MD"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[7.4387,43.7507],[7.3779,43.7316],[7.4143,43.7711],[7.4387,43.7507]]]},properties:{name:"Monaco",id:"MC"},id:"MC"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-2.2197,35.1041],[-1.7955,34.7521],[-1.6792,33.3187],[-1.5099,32.8775],[-1.0656,32.4683],[-1.2753,32.0892],[-2.4485,32.13],[-2.9308,32.0426],[-3.0174,31.8344],[-3.8268,31.6617],[-3.8335,31.1978],[-4.3228,30.6989],[-4.9683,30.4654],[-5.4488,29.9567],[-6.5008,29.8093],[-6.6353,29.5687],[-7.095,29.6251],[-7.6851,29.3495],[-8.6599,28.7187],[-8.6834,27.6565],[-13.1774,27.652],[-12.949,27.9144],[-11.986,28.1292],[-11.4302,28.3822],[-11.0809,28.7138],[-10.4865,29.0649],[-9.6671,30.1094],[-9.6529,30.4477],[-9.8755,30.718],[-9.8087,31.4247],[-9.3475,32.0865],[-9.2458,32.5726],[-8.5962,33.1874],[-6.901,33.969],[-6.3532,34.776],[-5.9249,35.7859],[-5.3973,35.9297],[-5.1054,35.4676],[-4.3299,35.1613],[-3.6932,35.2799],[-2.84,35.1281],[-2.2197,35.1041]]]},properties:{name:"Morocco",id:"MA"},id:"MA"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-63.0111,18.0688],[-63.123,18.0688],[-63.0631,18.1154],[-63.0111,18.0688]]]},properties:{name:"Saint Martin",id:"MF"},id:"MF"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[113.4788,22.1957],[113.4943,22.2414],[113.5467,22.2241],[113.4788,22.1957]]]},properties:{name:"Macau",id:"MO"},id:"MO"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[27.3517,57.5282],[27.797,57.3169],[27.8063,56.867],[28.1481,56.143],[27.5768,55.7988],[26.5936,55.6676],[24.9032,56.3982],[24.1206,56.2642],[22.0845,56.4067],[21.0462,56.07],[21.0711,56.8237],[21.7285,57.571],[22.5546,57.7242],[23.6479,56.9711],[24.4034,57.3251],[24.3226,57.8706],[25.111,58.0635],[25.9912,57.8382],[26.5328,57.5311],[27.3517,57.5282]]]},properties:{name:"Latvia",id:"LV"},id:"LV"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[6.1164,50.1209],[6.4875,49.7985],[6.3441,49.4527],[5.7897,49.5383],[5.744,49.9196],[6.1164,50.1209]]]},properties:{name:"Luxembourg",id:"LU"},id:"LU"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[26.5936,55.6676],[26.175,55.0033],[25.8594,54.9192],[25.5473,54.3317],[24.7683,53.9746],[23.4845,53.9398],[23.37,54.2005],[22.7663,54.3568],[22.8311,54.8384],[21.2358,55.2641],[21.0462,56.07],[22.0845,56.4067],[24.1206,56.2642],[24.9032,56.3982],[26.5936,55.6676]]]},properties:{name:"Lithuania",id:"LT"},id:"LT"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[27.8303,-28.9091],[28.6257,-28.5816],[29.3013,-29.0898],[29.3905,-29.2696],[29.098,-29.919],[28.3922,-30.1476],[28.018,-30.6421],[27.3886,-30.3158],[27.0517,-29.6642],[27.2945,-29.5195],[27.8303,-28.9091]]]},properties:{name:"Lesotho",id:"LS"},id:"LS"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[79.9822,9.8129],[80.253,9.7965],[80.7111,9.3663],[81.373,8.4315],[81.436,8.119],[81.8741,7.2885],[81.8612,6.9014],[81.6375,6.4251],[80.724,5.979],[80.0954,6.153],[79.8593,6.8295],[79.7923,7.5854],[79.929,8.8994],[80.1185,9.3268],[79.9822,9.8129]]]},properties:{name:"Sri Lanka",id:"LK"},id:"LK"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[9.5801,47.0572],[9.4877,47.0621],[9.5277,47.2707],[9.5801,47.0572]]]},properties:{name:"Liechtenstein",id:"LI"},id:"LI"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-60.8953,13.8221],[-61.0636,13.9158],[-60.8867,14.0112],[-60.8953,13.8221]]]},properties:{name:"Saint Lucia",id:"LC"},id:"LC"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[25.1505,31.655],[24.8526,31.335],[24.9738,30.7766],[24.7115,30.1316],[24.9805,29.1817],[24.9805,27.8345],[24.9805,25.8134],[24.9805,24.2416],[24.9805,21.9959],[24.9796,20.0024],[23.9804,19.9958],[23.9804,19.4968],[21.5847,20.6794],[19.6684,21.6257],[17.7521,22.5721],[15.9841,23.4452],[14.9791,22.996],[14.2307,22.6183],[13.4814,23.1802],[11.9678,23.518],[11.5075,24.3144],[10.6863,24.5514],[10.2557,24.5909],[10.0009,25.3322],[9.4482,26.0673],[9.4913,26.3337],[9.8593,26.5521],[9.7474,27.3306],[9.9161,27.7856],[9.8424,28.9668],[9.6724,29.567],[9.3102,30.1152],[9.5188,30.2293],[9.8952,30.3873],[10.2162,30.7832],[10.115,31.4637],[10.8265,32.0807],[11.5048,32.4137],[11.5043,33.182],[12.2798,32.8584],[12.7535,32.8012],[13.2835,32.9148],[14.2369,32.6813],[14.5135,32.5109],[15.1767,32.391],[15.4963,31.6568],[16.123,31.2644],[17.3491,31.0815],[18.1902,30.7775],[18.9364,30.2905],[19.2915,30.2879],[19.7132,30.4885],[20.1509,31.0784],[19.9263,31.8175],[20.1216,32.2188],[20.621,32.5801],[21.6357,32.9374],[22.1875,32.9184],[23.0908,32.6187],[23.2866,32.2139],[24.1295,32.0093],[24.6839,32.0159],[25.1505,31.655]]]},properties:{name:"Libya",id:"LY"},id:"LY"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-8.4863,7.5584],[-8.2966,7.0741],[-8.3325,6.8015],[-8.6035,6.5077],[-7.8886,6.2347],[-7.7965,5.975],[-7.4543,5.8414],[-7.4299,5.3247],[-7.5688,5.0805],[-7.5451,4.3512],[-8.2591,4.59],[-9.1322,5.0548],[-10.2763,6.0775],[-11.5075,6.9067],[-11.2678,7.2325],[-10.6474,7.7594],[-10.2832,8.4852],[-9.7683,8.5345],[-9.5182,8.3463],[-9.369,7.6396],[-9.4598,7.4425],[-9.1175,7.2157],[-8.8896,7.2627],[-8.7083,7.6591],[-8.4863,7.5584]]]},properties:{name:"Liberia",id:"LR"},id:"LR"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[35.8691,33.4319],[35.411,33.0755],[35.1087,33.0835],[35.9761,34.6291],[36.4329,34.6136],[36.5851,34.2212],[35.9424,33.6676],[35.8691,33.4319]]]},properties:{name:"Lebanon",id:"LB"},id:"LB"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[102.1276,22.379],[102.9488,21.5698],[102.8511,21.2657],[103.1046,20.8915],[103.635,20.6971],[104.0518,20.9413],[104.5832,20.6465],[104.6187,20.3744],[104.9281,20.018],[104.5463,19.6105],[104.0319,19.6753],[103.8965,19.3401],[104.7163,18.8035],[105.115,18.6787],[105.0857,18.4501],[105.4581,18.1545],[105.6916,17.7377],[106.5021,16.9542],[106.6961,16.4588],[107.3966,16.0429],[107.1897,15.7473],[107.6531,15.255],[107.5195,14.705],[106.82,14.3148],[106.5012,14.5781],[105.9788,14.3432],[105.9046,13.9247],[105.1833,14.3464],[105.4754,14.5301],[105.5131,15.3606],[105.6223,15.6998],[105.4062,15.9874],[105.047,16.1601],[104.7505,16.6475],[104.8162,17.3005],[103.9497,18.3192],[103.3669,18.4235],[103.0913,18.1381],[102.7175,17.8922],[102.1014,18.2104],[101.1053,17.4793],[100.9086,17.5837],[101.1133,18.0333],[101.0507,18.4071],[101.2864,18.977],[101.1546,19.5794],[100.6254,19.4999],[100.3977,19.7561],[100.5429,20.0885],[100.1225,20.3167],[100.2495,20.7304],[100.7564,21.3128],[101.139,21.5676],[101.2242,21.2236],[101.705,21.1503],[101.744,21.778],[101.5243,22.2538],[101.6712,22.4625],[102.1276,22.379]]]},properties:{name:"Lao People's Democratic Republic",id:"LA"},id:"LA"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[48.4424,28.5429],[47.6713,28.5331],[47.4334,28.9895],[46.5314,29.0964],[46.9056,29.5377],[47.1143,29.9611],[47.6727,30.0956],[47.9785,29.9829],[47.9696,29.6167],[48.1836,28.9793],[48.4424,28.5429]]]},properties:{name:"Kuwait",id:"KW"},id:"KW"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[21.5625,42.2476],[21.0596,42.1713],[20.566,41.8739],[20.4856,42.2232],[20.0639,42.5473],[20.3445,42.8278],[21.0569,43.0915],[21.3907,42.7515],[21.7529,42.6698],[21.5625,42.2476]]]},properties:{name:"Kosovo",id:"XK"},id:"XK"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[128.3745,38.6233],[128.619,38.1763],[129.335,37.2747],[129.4735,36.742],[129.4034,36.0522],[129.5619,35.9475],[129.2143,35.1818],[128.5112,35.101],[128.4442,34.8706],[127.7148,34.9545],[127.0308,34.6069],[126.4817,34.4937],[126.2913,35.1542],[126.7174,35.769],[126.5483,36.4775],[126.2171,36.8708],[126.7463,37.1935],[126.634,37.7816],[127.1697,38.3045],[128.0389,38.3085],[128.3745,38.6233]]]},properties:{name:"South Korea",id:"KR"},id:"KR"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-62.6307,17.2401],[-62.8389,17.3391],[-62.7945,17.4025],[-62.7137,17.3533],[-62.6307,17.2401]]]},properties:{name:"Saint Kitts and Nevis",id:"KN"},id:"KN"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-157.3422,1.8557],[-157.2461,1.7318],[-157.4201,1.7873],[-157.3422,1.8557]]]},properties:{name:"Kiribati",id:"KI"},id:"KI"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[104.4265,10.4112],[104.2622,10.5413],[103.532,10.6048],[103.722,10.8902],[103.5325,11.1468],[103.153,10.9137],[103.1254,11.4606],[102.9341,11.7065],[102.7366,12.0896],[102.7557,12.4261],[102.4995,12.6698],[102.3198,13.5398],[102.729,13.8421],[103.1996,14.3326],[104.7789,14.428],[105.1833,14.3464],[105.9046,13.9247],[105.9788,14.3432],[106.5012,14.5781],[106.82,14.3148],[107.5195,14.705],[107.3313,14.1266],[107.6056,13.4377],[107.4756,13.0302],[107.5062,12.3644],[106.9305,12.0776],[106.4138,11.9484],[106.3401,11.6817],[105.8514,11.6351],[105.8558,11.2941],[106.1679,11.0123],[105.3866,10.9399],[104.8504,10.5347],[104.4265,10.4112]]]},properties:{name:"Cambodia",id:"KH"},id:"KH"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[80.2095,42.1899],[80.2162,42.0323],[79.2938,41.7829],[78.3625,41.3718],[78.1232,41.0758],[76.8239,40.9821],[76.4804,40.4494],[75.8718,40.3034],[75.5837,40.6052],[75.0044,40.4494],[74.4118,40.1374],[73.9915,40.0433],[73.9147,39.6065],[73.6315,39.4489],[73.2351,39.3743],[72.0428,39.3521],[71.8062,39.2758],[71.4045,39.598],[70.7333,39.4134],[70.6077,39.5643],[69.5987,39.5736],[69.229,39.761],[69.5304,40.0974],[69.9667,40.2022],[70.4514,40.049],[70.9579,40.239],[71.6926,40.1525],[73.113,40.7859],[72.6585,40.8698],[71.7924,41.4131],[71.4085,41.1361],[70.7826,41.2626],[70.1811,41.5716],[70.8421,42.0195],[70.9468,42.2485],[71.2567,42.7337],[71.8168,42.822],[72.8551,42.561],[73.422,42.5934],[73.5565,43.0027],[74.209,43.2402],[75.0475,42.9046],[76.9442,42.9716],[79.1646,42.759],[79.49,42.4576],[80.2095,42.1899]]]},properties:{name:"Kyrgyzstan",id:"KG"},id:"KG"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[41.8839,3.9779],[41.3419,3.2016],[40.9646,2.8145],[40.9699,1.378],[40.9788,-.8703],[41.5328,-1.6955],[40.9956,-1.9507],[40.6441,-2.5393],[40.2224,-2.6884],[40.1154,-3.2504],[39.4909,-4.4787],[39.2219,-4.6922],[37.7974,-3.6743],[37.6087,-3.4604],[37.6438,-3.0453],[36.2633,-2.2747],[34.7709,-1.4416],[33.9031,-1.0021],[33.9431,.1738],[34.4815,1.042],[34.7874,1.2307],[34.9654,1.6435],[34.964,2.0625],[34.7425,2.818],[34.4478,3.1634],[34.3928,3.6916],[34.165,3.8128],[33.9759,4.2203],[35.2681,5.4925],[35.7448,5.3442],[35.763,4.808],[36.0818,4.4498],[36.9056,4.4116],[38.0864,3.649],[39.4944,3.4559],[39.8424,3.8514],[40.7653,4.2731],[41.2207,3.9437],[41.8839,3.9779]]]},properties:{name:"Kenya",id:"KE"},id:"KE"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[87.3229,49.0858],[86.7534,49.0088],[86.5496,48.5287],[85.7493,48.3849],[85.526,47.9157],[85.6565,47.2547],[84.786,46.8308],[83.1929,47.1864],[83.0043,47.0337],[82.3264,45.52],[82.4787,45.1236],[81.602,45.3109],[80.059,45.0064],[80.4554,44.7463],[80.3551,44.0973],[80.7857,43.1616],[80.1651,42.6653],[80.2095,42.1899],[79.49,42.4576],[79.1646,42.759],[76.9442,42.9716],[75.0475,42.9046],[74.209,43.2402],[73.5565,43.0027],[73.422,42.5934],[72.8551,42.561],[71.8168,42.822],[71.2567,42.7337],[70.9468,42.2485],[70.4159,42.0785],[70.0954,41.8206],[69.0652,41.367],[68.2919,40.6563],[67.9359,41.1965],[66.8142,41.1423],[66.6686,41.2706],[66.4986,41.9951],[66.0094,42.0048],[66.1004,42.9907],[65.803,42.8771],[65.4963,43.3108],[64.9054,43.7147],[64.4434,43.5513],[63.2071,43.6281],[61.9904,43.4923],[61.1608,44.1688],[61.0081,44.3939],[58.5551,45.5555],[55.9757,44.9949],[55.9766,42.929],[55.9774,41.3221],[55.5451,41.2626],[54.9037,41.9192],[54.1211,42.3351],[53.2502,42.2059],[52.4938,41.7802],[52.5968,42.7603],[51.8439,42.9104],[51.3019,43.4825],[50.8305,44.1928],[50.3311,44.3255],[50.4093,44.6242],[50.8603,44.6287],[51.4156,45.358],[52.5311,45.3988],[52.7739,45.5728],[53.1352,46.1916],[53.1703,46.6692],[52.9159,46.9542],[52.1888,46.8397],[51.1781,47.11],[50.4195,46.8796],[50,46.6342],[49.3475,46.5192],[49.2321,46.3372],[48.6102,46.5663],[48.9595,46.7744],[48.1099,47.7452],[47.0934,47.9477],[47.0042,48.2846],[46.661,48.4124],[46.7028,48.8055],[47.0144,49.0984],[46.8022,49.367],[47.3264,50.2734],[47.706,50.378],[48.4344,49.8284],[48.8432,50.0131],[48.8086,50.6012],[49.498,51.0835],[50.2468,51.2895],[50.7941,51.7292],[51.6091,51.4839],[52.3309,51.6812],[52.571,51.4817],[53.3381,51.4824],[54.0416,51.1153],[54.4216,50.7804],[54.727,50.9981],[55.5424,50.6017],[55.7977,50.6021],[56.4915,51.0196],[57.0117,51.0651],[57.4423,50.8889],[57.8387,51.0917],[58.3594,51.0638],[58.8836,50.6945],[59.8122,50.5819],[59.9552,50.7992],[60.6379,50.6638],[61.3894,50.8609],[61.5851,51.2298],[61.3632,51.442],[60.4647,51.6513],[60.0657,51.9764],[60.9375,52.2805],[60.8021,52.7448],[61.0476,52.9725],[61.974,52.9437],[62.0148,53.1079],[61.1994,53.2872],[60.9797,53.6217],[61.3339,54.0492],[61.9287,53.9464],[63.0739,54.1053],[64.4611,54.3841],[65.1576,54.3643],[65.4767,54.6233],[66.2225,54.6673],[68.0739,54.9596],[68.2062,55.1609],[68.9773,55.3895],[70.1824,55.1625],[70.7382,55.3052],[71.1856,54.5994],[71.0933,54.2123],[72.9141,54.1073],[73.3993,53.8115],[73.2857,53.5984],[74.4518,53.6472],[76.2664,54.312],[76.5758,53.9424],[77.7042,53.3791],[78.4757,52.6385],[79.4687,51.493],[79.9862,50.7746],[80.8771,51.2815],[81.4657,50.7397],[82.4938,50.7275],[83.3571,50.9945],[83.9453,50.7746],[84.2578,50.2883],[84.9893,50.0615],[85.21,49.6648],[86.1807,49.4993],[86.6144,49.6098],[87.3229,49.0858]]]},properties:{name:"Kazakhstan",id:"KZ"},id:"KZ"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[141.2296,41.3727],[141.4626,40.611],[141.7969,40.2914],[141.978,39.8444],[141.9007,39.1115],[141.6584,38.9748],[141.4675,38.404],[141.1084,38.3378],[140.9282,37.9494],[141.0365,37.4674],[140.9686,37.0022],[140.6272,36.5028],[140.6219,36.0593],[140.874,35.7251],[140.4572,35.5102],[140.4164,35.267],[139.7994,34.9567],[139.6502,35.409],[139.2494,35.2781],[138.9826,34.6984],[138.5773,35.0863],[138.1889,34.5963],[136.8848,34.8058],[136.5332,34.6784],[136.8537,34.3242],[136.3299,34.1768],[135.9162,33.5616],[135.4528,33.5536],[135.1753,33.898],[135.1003,34.2882],[135.3848,34.5004],[134.7399,34.7654],[134.2081,34.6975],[133.9684,34.5275],[133.1423,34.3024],[132.2381,34.227],[132.0903,33.8554],[131.7405,34.0521],[130.9188,33.9757],[131.0041,34.3925],[131.3543,34.4134],[132.923,35.5111],[133.3767,35.4588],[134.2139,35.5391],[135.1744,35.7473],[135.6805,35.5031],[136.0955,35.7677],[136.0063,35.9905],[136.6983,36.742],[137.3424,36.7705],[137.5142,36.9516],[138.3199,37.2183],[138.8849,37.8438],[139.4012,38.1425],[140.0479,39.4635],[139.9228,40.5986],[140.2814,40.8463],[141.1186,40.8822],[141.2296,41.3727]]],[[[143.8241,44.1169],[144.7985,43.9402],[145.1012,43.7644],[145.3476,43.1767],[144.6307,42.9468],[143.9693,42.8815],[143.4295,42.419],[143.2364,42.0004],[141.8515,42.5792],[140.9863,42.3422],[140.4803,42.5592],[140.3267,42.2934],[140.7337,42.1162],[140.3848,41.5192],[139.9951,41.5765],[140.1083,41.9129],[139.8211,42.3875],[139.8912,42.6494],[140.7808,43.2149],[141.2962,43.1998],[141.6446,44.0197],[141.7822,44.7166],[141.5829,45.156],[141.9376,45.5094],[142.7042,44.8191],[143.8241,44.1169]]],[[[131.1745,33.6024],[131.5829,33.6526],[131.8967,33.2548],[131.9766,32.8438],[131.7321,32.593],[131.3374,31.4047],[130.5886,31.1783],[130.2006,31.2919],[130.3218,31.6013],[130.1944,32.0909],[130.6405,32.6192],[129.5801,33.2362],[130.3649,33.6344],[130.4838,33.8345],[130.953,33.8718],[131.1745,33.6024]]],[[[134.3572,34.2562],[134.6373,34.2265],[134.739,33.8203],[134.3772,33.6082],[134.1815,33.2473],[133.6319,33.511],[133.2861,33.36],[132.9772,32.842],[132.4951,32.9166],[132.3659,33.5123],[132.7841,33.9926],[133.5822,34.017],[134.0758,34.3583],[134.3572,34.2562]]]]},properties:{name:"Japan",id:"JP"},id:"JP"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[39.1455,32.1247],[38.9622,31.9951],[36.9584,31.4917],[37.9803,30.5],[37.6336,30.3132],[37.4694,29.9949],[36.7551,29.8662],[36.4759,29.4951],[36.0156,29.1906],[34.9507,29.3535],[34.9734,29.555],[35.174,30.524],[35.4394,31.1326],[35.4505,31.4793],[35.5589,31.7656],[35.5513,32.3955],[35.7875,32.735],[36.3721,32.387],[36.8182,32.3173],[38.7735,33.372],[39.1455,32.1247]]]},properties:{name:"Jordan",id:"JO"},id:"JO"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-2.0186,49.2312],[-2.2359,49.1763],[-2.2206,49.2665],[-2.0186,49.2312]]]},properties:{name:"Jersey",id:"JE"},id:"JE"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-77.2614,18.4572],[-76.3499,18.1518],[-76.5246,17.8664],[-76.8533,17.9738],[-77.3615,17.8336],[-77.7681,17.8775],[-78.2167,18.4479],[-77.8735,18.522],[-77.2614,18.4572]]]},properties:{name:"Jamaica",id:"JM"},id:"JM"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[9.632,40.8822],[9.8051,40.4996],[9.5623,39.1661],[9.0563,39.2394],[8.8814,38.9127],[8.418,39.2056],[8.4712,40.2927],[8.1898,40.6518],[9.2831,41.2018],[9.632,40.8822]]],[[[15.5766,38.2202],[15.0994,37.4585],[15.2943,37.0133],[15.1127,36.6879],[14.5019,36.7989],[12.4356,37.8198],[13.3518,38.1807],[13.6816,38.0009],[14.5059,38.0453],[14.846,38.1718],[15.5766,38.2202]]],[[[13.6998,46.5201],[13.3993,46.3177],[13.7198,45.5875],[13.2062,45.7713],[12.2745,45.4459],[12.5235,44.9678],[12.2483,44.7223],[12.3961,44.2238],[13.564,43.5713],[14.0106,42.6898],[14.8659,42.0523],[15.1687,41.9338],[15.9641,41.9396],[16.0125,41.4353],[17.1032,41.062],[17.955,40.6554],[18.4859,40.105],[18.0779,39.9367],[17.8649,40.2803],[16.9283,40.4579],[16.5301,39.8595],[16.5976,39.6389],[17.1147,39.3805],[17.1746,38.9979],[16.5589,38.7147],[16.5456,38.4093],[16.0569,37.9419],[15.7244,37.9392],[15.9726,38.7125],[16.1967,38.7591],[16.0236,39.3535],[15.6929,39.99],[14.9507,40.239],[14.7656,40.6683],[14.1024,40.8272],[13.7331,41.2356],[13.0886,41.244],[12.6309,41.4695],[11.6375,42.2876],[10.7084,42.9361],[10.0475,44.0201],[8.766,44.4223],[8.0815,43.9189],[7.4929,43.7671],[7.6771,44.0831],[6.9673,44.2802],[7.0308,44.7166],[6.6277,45.1178],[7.1533,45.401],[7.021,45.9257],[7.9932,46.0158],[8.4584,46.2458],[8.9537,45.8298],[9.2512,46.2866],[9.9392,46.3616],[10.4528,46.865],[11.0249,46.7971],[11.2442,46.9755],[12.1542,46.9351],[12.3881,46.7025],[13.6998,46.5201]],[[12.4853,43.9016],[12.5146,43.9531],[12.441,43.9824],[12.397,43.9344],[12.4853,43.9016]]]]},properties:{name:"Italy",id:"IT"},id:"IT"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[35.7875,32.735],[35.5513,32.3955],[35.1931,32.5344],[34.9561,32.1611],[34.9507,31.6022],[35.4505,31.4793],[35.4394,31.1326],[35.174,30.524],[34.9734,29.555],[34.9041,29.4773],[34.2454,31.2085],[34.4775,31.5849],[34.6786,31.8956],[35.1087,33.0835],[35.411,33.0755],[35.8691,33.4319],[35.7875,32.735]]]},properties:{name:"Israel",id:"IL"},id:"IL"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-15.5431,66.2285],[-14.6982,66.0203],[-14.7576,65.7557],[-13.6159,65.4872],[-13.853,64.8622],[-15.0215,64.296],[-16.0605,64.1113],[-16.6404,63.8654],[-17.8156,63.7129],[-18.6537,63.4066],[-20.1982,63.5558],[-21.8328,64.2054],[-21.9502,64.515],[-22.684,65.0264],[-22.0057,65.4934],[-22.9024,65.5804],[-24.2241,65.4872],[-23.7371,66.0695],[-22.4261,66.4302],[-21.3035,65.8765],[-21.23,65.4206],[-20.3567,65.7191],[-20.3567,66.0331],[-18.7775,66.1688],[-16.7485,66.1317],[-15.9854,66.5145],[-15.5431,66.2285]]]},properties:{name:"Iceland",id:"IS"},id:"IS"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[44.7652,37.1424],[45.3618,36.0154],[45.7235,35.8365],[46.1337,35.1276],[45.6783,34.7982],[45.4377,34.4152],[45.3968,33.9708],[46.1457,33.2295],[46.1128,32.9579],[46.57,32.834],[47.3713,32.4239],[47.8298,31.7944],[47.6793,31.0025],[48.0105,30.9896],[48.0149,30.4654],[48.5467,29.9625],[47.9785,29.9829],[47.6727,30.0956],[47.1143,29.9611],[46.9056,29.5377],[46.5314,29.0964],[46.3565,29.0636],[44.7163,29.1937],[42.8578,30.4952],[42.0743,31.0802],[40.3693,31.9391],[39.1455,32.1247],[38.7735,33.372],[40.6894,34.3322],[40.9872,34.4289],[41.1945,34.7689],[41.3543,35.6403],[41.2456,36.0735],[41.4169,36.5148],[41.7884,36.5973],[42.3588,37.1087],[42.7748,37.3719],[43.5161,37.2445],[44.1562,37.2831],[44.2818,36.9782],[44.7652,37.1424]]]},properties:{name:"Iraq",id:"IQ"},id:"IQ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[46.1146,38.8776],[46.4906,38.9065],[47.773,39.6486],[47.9958,39.6842],[48.2422,38.9788],[48.0233,38.819],[48.5929,38.4111],[48.8685,38.4355],[49.0811,37.6676],[49.47,37.4967],[50.1305,37.407],[50.5331,37.0137],[51.1186,36.7425],[52.1902,36.6217],[54.0172,36.9524],[53.9142,37.3435],[54.7452,37.502],[55.0755,37.9024],[55.5784,38.0999],[56.2287,38.0733],[56.4409,38.2495],[57.1937,38.2162],[57.4236,37.9477],[58.4357,37.6387],[58.8157,37.6835],[59.2409,37.5206],[59.5623,37.1788],[60.0626,36.9631],[60.3413,36.6377],[61.1195,36.6426],[61.262,35.6194],[61.08,34.8555],[60.4856,34.0947],[60.5109,33.6388],[60.9171,33.5052],[60.5606,33.1376],[60.8292,32.2494],[60.854,31.4833],[61.6602,31.3825],[61.7844,30.8321],[61.104,30.1285],[60.8434,29.8586],[61.3184,29.3725],[61.6229,28.7915],[61.8901,28.5465],[62.3531,28.4146],[62.7397,28.0023],[62.7632,27.2503],[63.1667,27.2525],[63.1681,26.6657],[62.4392,26.5609],[61.8697,26.2422],[61.6686,25.769],[61.5878,25.2022],[61.412,25.1023],[60.6641,25.2821],[59.4562,25.4814],[59.0461,25.4175],[58.7979,25.5546],[57.7961,25.6532],[57.3344,25.7917],[56.9824,26.9054],[56.3561,27.2001],[55.6503,26.9777],[54.8957,26.5565],[53.7056,26.7256],[53.4548,26.9431],[52.6918,27.3235],[52.476,27.6165],[51.6664,27.8451],[51.2788,28.1314],[51.0622,28.7262],[50.6752,29.1466],[50.6499,29.42],[49.9831,30.2093],[49.5548,30.0291],[48.9191,30.1209],[48.5467,29.9625],[48.0149,30.4654],[48.0105,30.9896],[47.6793,31.0025],[47.8298,31.7944],[47.3713,32.4239],[46.57,32.834],[46.1128,32.9579],[46.1457,33.2295],[45.3968,33.9708],[45.4377,34.4152],[45.6783,34.7982],[46.1337,35.1276],[45.7235,35.8365],[45.3618,36.0154],[44.7652,37.1424],[44.5614,37.7448],[44.2112,37.9081],[44.4309,38.3569],[44.023,39.3774],[44.8171,39.6504],[45.4798,39.0063],[46.1146,38.8776]]]},properties:{name:"Iran",id:"IR"},id:"IR"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-6.218,54.0887],[-6.0274,52.927],[-6.5612,52.1888],[-7.5273,52.0989],[-8.8135,51.5849],[-10.3786,51.8688],[-9.9558,52.1367],[-9.2993,53.0975],[-9.7954,53.3951],[-9.996,54.276],[-8.6231,54.3468],[-8.764,54.6813],[-8.2746,55.1463],[-7.2468,55.3531],[-7.2186,55.0921],[-8.1183,54.4143],[-7.3553,54.1213],[-6.218,54.0887]]]},properties:{name:"Ireland",id:"IE"},id:"IE"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[72.492,-7.3773],[72.4671,-7.3675],[72.4738,-7.3098],[72.4356,-7.2304],[72.4938,-7.2619],[72.492,-7.3773]]]},properties:{name:"British Indian Ocean Territory",id:"IO"},id:"IO"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[78.7198,31.8876],[78.8445,31.3017],[79.1073,31.4025],[79.3386,31.1055],[79.3697,31.0798],[79.9165,30.8942],[79.9245,30.8889],[80.1913,30.5684],[80.6823,30.4148],[81.0103,30.1645],[80.4017,29.7303],[80.0706,28.8301],[80.5868,28.6494],[81.8528,27.8669],[81.9877,27.9139],[82.7335,27.5189],[83.2897,27.371],[84.0909,27.4913],[84.6103,27.2987],[84.6853,27.0412],[85.293,26.7412],[86.3663,26.5743],[86.7014,26.4349],[87.0166,26.5556],[87.2874,26.3603],[88.0549,26.43],[88.1614,26.7247],[87.9843,27.134],[88.1099,27.8704],[88.6213,28.0919],[88.8485,27.8686],[88.8912,27.316],[88.8579,26.9613],[89.7638,26.7016],[90.3458,26.8903],[90.7395,26.7718],[91.9984,26.8548],[92.0836,27.2907],[91.5949,27.5575],[91.6317,27.7599],[91.9775,27.7301],[92.6642,27.949],[92.702,28.147],[93.2067,28.5909],[93.9022,28.803],[94.6231,29.3126],[94.7696,29.1759],[95.4204,29.0543],[96.0352,29.4471],[96.4355,29.0507],[96.776,28.3671],[97.3224,28.218],[97.3353,27.9379],[96.6659,27.3391],[96.0613,27.217],[95.1287,26.5973],[95.1323,26.0411],[94.6227,25.4099],[94.7075,25.0486],[94.2929,24.3219],[94.1277,23.8763],[93.3074,24.0219],[93.4149,23.6823],[93.366,23.1323],[93.0788,22.7182],[93.1618,22.3604],[92.9643,22.0039],[92.575,21.9782],[92.4916,22.6853],[92.3615,22.929],[92.2461,23.6836],[91.938,23.5047],[91.6198,22.9796],[91.3152,23.1043],[91.1603,23.6605],[91.3672,24.0933],[91.8768,24.1954],[92.2514,24.895],[92.0499,25.1693],[90.4394,25.1578],[89.814,25.3052],[89.8229,25.9413],[89.2893,26.0376],[89.1082,26.2023],[88.4402,26.3696],[88.0846,25.8884],[88.4521,25.5746],[88.4561,25.1884],[88.1454,24.4857],[88.7336,24.2309],[88.5671,23.6743],[88.7407,23.4368],[89.0514,22.0932],[89.0518,21.6541],[88.2537,21.6222],[87.9483,21.8255],[87.1005,21.5006],[86.8595,21.2369],[86.9753,20.7002],[86.7503,20.3131],[86.2793,19.9194],[85.5748,19.693],[84.7709,19.1253],[84.1042,18.2926],[83.6541,18.0697],[83.1982,17.609],[82.3597,17.0963],[82.259,16.56],[81.7618,16.3297],[81.2385,16.264],[80.9788,15.7584],[80.6467,15.8951],[80.2934,15.7109],[80.0533,15.0739],[80.1656,14.5776],[80.1119,14.2123],[80.3422,13.3614],[80.229,12.6902],[79.8584,11.9888],[79.7541,11.5751],[79.8486,11.1969],[79.838,10.3225],[79.3905,10.306],[78.9964,9.6833],[78.9795,9.2687],[78.4215,9.1049],[78.1925,8.8909],[78.0602,8.3844],[77.5178,8.0782],[76.9669,8.4071],[76.5536,8.9029],[76.3246,9.452],[76.3463,9.9221],[75.9224,10.7841],[75.724,11.3616],[75.1966,12.0576],[74.7705,13.0773],[74.6711,13.6676],[74.3821,14.4946],[73.9493,15.0748],[73.932,15.397],[73.4761,16.0544],[73.3376,16.4597],[73.1561,17.6218],[72.8711,18.6832],[72.6678,19.8311],[72.8813,20.5631],[72.8138,21.117],[72.5431,21.6968],[72.5901,22.2783],[72.3326,22.2703],[72.037,21.8233],[72.2541,21.5312],[72.0153,21.1557],[71.0245,20.7388],[70.7191,20.7406],[70.1274,21.0948],[69.0088,22.1966],[70.1771,22.5726],[70.2512,22.9707],[69.6644,22.759],[69.2361,22.8487],[68.6408,23.19],[68.1649,23.8572],[68.7242,23.9646],[68.7282,24.2656],[69.5592,24.2731],[69.7163,24.1728],[70.5469,24.4183],[71.044,24.4001],[71.048,24.6877],[70.6521,25.4228],[70.2646,25.7064],[70.0777,26.0718],[70.1567,26.4713],[69.47,26.8046],[69.5681,27.1744],[70.1447,27.8491],[70.4035,28.0249],[70.7373,27.7293],[71.8701,27.9623],[72.342,28.752],[72.903,29.029],[73.3816,29.9345],[73.809,30.0934],[73.8991,30.4352],[74.6329,31.0345],[74.5099,31.7127],[75.3334,32.2792],[74.6578,32.5189],[73.9941,33.2424],[74.1499,33.507],[73.9613,34.6535],[74.3004,34.7654],[75.7093,34.5031],[76.5945,34.7357],[77.0486,35.1099],[77.7992,35.496],[77.8107,35.4845],[78.2821,34.654],[78.9364,34.3521],[78.7531,34.0876],[78.8019,33.4999],[79.1127,33.2264],[79.1353,33.1718],[79.2165,32.5641],[79.2192,32.5011],[78.3896,32.5197],[78.7198,31.8876]]]},properties:{name:"India",id:"IN"},id:"IN"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-4.4121,54.1854],[-4.7457,54.1189],[-4.5086,54.3768],[-4.4121,54.1854]]]},properties:{name:"Isle of Man",id:"IM"},id:"IM"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[96.4924,5.2293],[97.4512,5.2359],[97.9084,4.8799],[98.2484,4.4147],[98.3074,4.0929],[99.7323,3.1829],[100.4572,2.2574],[100.6854,2.1202],[101.0462,2.2574],[101.4768,1.6932],[101.7849,1.6213],[102.1573,1.2591],[102.4694,.7792],[102.8493,.7153],[103.0664,.492],[103.4788,.4801],[103.7868,.0468],[103.4286,-.1916],[103.4313,-.5334],[103.7211,-.8867],[104.3608,-1.0385],[104.5685,-1.9218],[104.8451,-2.0932],[104.6684,-2.3857],[105.3968,-2.3804],[105.5819,-2.4918],[106.0445,-3.1062],[105.8438,-3.6135],[105.8873,-5.0096],[105.8163,-5.6767],[105.6183,-5.7997],[105.3493,-5.5493],[105.0812,-5.7455],[104.6396,-5.5205],[104.6014,-5.9044],[103.8312,-5.0797],[102.919,-4.4707],[102.5377,-4.152],[102.1276,-3.5993],[101.5785,-3.167],[100.8478,-2.1438],[100.8554,-1.9343],[100.4865,-1.2991],[100.3081,-.8268],[99.5978,.1023],[99.1593,.3518],[98.7962,1.4948],[98.5644,1.9023],[97.7006,2.3586],[97.591,2.8464],[97.3912,2.9752],[96.9691,3.5753],[96.4449,3.8163],[95.4949,4.7614],[95.2068,5.2839],[95.2277,5.5648],[95.629,5.6092],[96.1333,5.2941],[96.4924,5.2293]]],[[[120.0124,-9.3748],[120.5038,-9.674],[120.8327,-10.0375],[120.439,-10.2941],[120.1447,-10.2],[119.6009,-9.7734],[119.0856,-9.7068],[119.1855,-9.3846],[120.0124,-9.3748]]],[[[125.0679,-9.512],[124.4274,-10.1485],[123.8574,-10.3438],[123.5893,-9.9669],[123.7092,-9.6149],[124.0363,-9.3415],[124.4442,-9.1901],[124.9223,-8.9424],[125.0679,-9.512]]],[[[116.6406,-8.614],[116.3774,-8.9291],[116.0764,-8.7449],[116.0613,-8.4373],[116.4014,-8.2043],[116.7343,-8.3871],[116.6406,-8.614]]],[[[122.7828,-8.6117],[121.6513,-8.8989],[121.0351,-8.9353],[119.8078,-8.6974],[119.9183,-8.4453],[120.6103,-8.2407],[121.4444,-8.578],[121.9664,-8.4551],[122.263,-8.6251],[122.6034,-8.4027],[122.7828,-8.6117]]],[[[118.2426,-8.3179],[118.9879,-8.3379],[119.0061,-8.7498],[118.1898,-8.8403],[117.0614,-9.0991],[116.7884,-9.0064],[116.835,-8.5323],[117.1649,-8.3672],[117.567,-8.4266],[118.1174,-8.1221],[118.2426,-8.3179]]],[[[115.4479,-8.155],[115.7045,-8.4071],[115.2361,-8.7977],[114.4753,-8.1195],[115.4479,-8.155]]],[[[126.8009,-7.668],[126.4719,-7.9503],[125.8434,-7.8167],[126.6095,-7.5717],[126.8009,-7.668]]],[[[138.5351,-8.2735],[138.2963,-8.4053],[137.6851,-8.2624],[138.0074,-7.6414],[138.2954,-7.4385],[138.77,-7.3906],[138.9893,-7.696],[138.5351,-8.2735]]],[[[131.3255,-7.9996],[131.0866,-7.8651],[131.2602,-7.4705],[131.6912,-7.439],[131.3255,-7.9996]]],[[[113.8445,-7.1052],[113.4708,-7.2184],[112.7637,-7.1398],[112.868,-6.9001],[113.9746,-6.873],[113.8445,-7.1052]]],[[[134.537,-6.4424],[134.3559,-6.8149],[134.0589,-6.7691],[134.1681,-6.1761],[134.537,-6.4424]]],[[[107.3739,-6.0074],[107.6669,-6.2156],[108.295,-6.2649],[108.6776,-6.7905],[110.4261,-6.9471],[110.7369,-6.4722],[111.1546,-6.6693],[111.5403,-6.6484],[112.0872,-6.8934],[112.5391,-6.9263],[112.7943,-7.5526],[113.2484,-7.7182],[114.0705,-7.633],[114.4442,-7.8957],[114.387,-8.4053],[114.5836,-8.7698],[113.2533,-8.2868],[112.6789,-8.4093],[111.5101,-8.305],[110.6072,-8.1497],[110.0386,-7.8904],[109.2818,-7.7049],[108.7411,-7.6671],[108.4517,-7.7968],[107.9173,-7.724],[107.2852,-7.4718],[106.6313,-7.4155],[106.5199,-7.0537],[105.4838,-6.7816],[105.8682,-6.1166],[106.0751,-5.9142],[106.8253,-6.0984],[107.0463,-5.9044],[107.3739,-6.0074]]],[[[134.747,-5.7069],[134.7559,-6.1708],[134.4411,-6.335],[134.3413,-5.7127],[134.747,-5.7069]]],[[[122.6451,-5.2692],[122.3961,-5.0699],[122.369,-4.7672],[122.702,-4.6185],[122.6451,-5.2692]]],[[[126.8612,-3.0879],[127.2274,-3.3911],[127.2297,-3.6331],[126.6863,-3.8235],[126.2145,-3.6051],[126.0263,-3.1705],[126.8612,-3.0879]]],[[[129.7545,-2.866],[130.3791,-2.9894],[130.8598,-3.5705],[130.8052,-3.8577],[129.8442,-3.3272],[129.4678,-3.4533],[128.9675,-3.3259],[128.4193,-3.416],[128.0819,-3.1838],[128.1987,-2.866],[129.4274,-2.7905],[129.7545,-2.866]]],[[[108.2071,-2.9978],[107.6145,-3.2096],[107.6665,-2.5664],[108.0744,-2.597],[108.2071,-2.9978]]],[[[124.9694,-1.7057],[124.8344,-1.8943],[124.4176,-2.0053],[124.3808,-1.6875],[124.9694,-1.7057]]],[[[135.4741,-1.5916],[136.2016,-1.6551],[136.1927,-1.8593],[135.4741,-1.5916]]],[[[106.0458,-1.6693],[106.3658,-2.4647],[106.6788,-2.704],[106.547,-3.0555],[105.9988,-2.8247],[105.7857,-2.1815],[105.1332,-2.0426],[105.5855,-1.5268],[106.0458,-1.6693]]],[[[128.153,-1.6604],[127.5617,-1.7283],[127.6465,-1.3324],[128.153,-1.6604]]],[[[99.1637,-1.778],[98.8743,-1.6639],[98.6017,-1.1979],[98.869,-.9155],[99.2671,-1.6275],[99.1637,-1.778]]],[[[135.3831,-.6514],[135.8935,-.726],[135.8389,-1.1193],[135.3831,-.6514]]],[[[140.9734,-2.6099],[140.9739,-4.0232],[140.9748,-6.3461],[140.9761,-9.1187],[139.9347,-8.1013],[139.3856,-8.1892],[138.8561,-8.1452],[139.0878,-7.5872],[138.7478,-7.2517],[138.8645,-6.8584],[138.4388,-6.3435],[138.0611,-5.4654],[137.0894,-4.9243],[136.6189,-4.8187],[135.9797,-4.531],[135.1957,-4.4507],[134.1473,-3.7968],[133.9737,-3.8182],[133.6532,-3.3645],[133.2488,-4.0623],[132.9687,-4.0947],[132.7539,-3.7036],[132.7512,-3.2948],[132.3482,-2.9752],[133.1911,-2.4377],[133.6088,-2.5473],[133.9049,-2.391],[133.9218,-2.1021],[132.963,-2.2725],[132.3078,-2.2423],[132.0233,-1.9902],[131.9305,-1.5596],[131.2935,-1.3936],[131.2571,-.8556],[131.8044,-.7038],[132.1285,-.4539],[132.6252,-.3589],[133.4726,-.726],[133.9746,-.7442],[134.2596,-1.363],[134.106,-1.7212],[134.1557,-2.1953],[135.0373,-3.333],[135.4865,-3.345],[136.2433,-2.5832],[136.3898,-2.2734],[136.843,-2.1975],[137.1236,-1.8411],[137.8063,-1.4833],[138.6497,-1.7909],[139.7896,-2.3484],[140.6223,-2.4456],[140.9734,-2.6099]]],[[[97.4814,1.4651],[97.9319,.9741],[97.8764,.6283],[97.4054,.947],[97.2443,1.4238],[97.4814,1.4651]]],[[[124.889,.9954],[124.4274,.4707],[123.754,.3056],[123.2653,.3265],[123.0824,.4858],[121.8421,.4366],[121.4258,.4947],[120.3489,.4494],[120.1274,.1667],[120.012,-.307],[120.0972,-.6501],[120.5176,-1.0394],[120.6676,-1.3701],[121.0338,-1.4065],[121.5194,-.8556],[121.9695,-.9333],[122.2798,-.7571],[122.8888,-.7553],[122.5067,-1.3479],[121.7187,-1.8628],[121.349,-1.9458],[121.8484,-2.3316],[122.3992,-3.2007],[122.2527,-3.6206],[122.8773,-4.1089],[122.8973,-4.349],[122.207,-4.4964],[121.9172,-4.848],[121.4866,-4.5812],[121.618,-4.0929],[120.9144,-3.5558],[121.0542,-3.167],[121.052,-2.7515],[120.6538,-2.6676],[120.2539,-3.0529],[120.4368,-3.7072],[120.3627,-4.0858],[120.4199,-4.6176],[120.2792,-5.1463],[120.3116,-5.5418],[119.7172,-5.6932],[119.3763,-5.425],[119.6116,-4.4236],[119.6236,-4.0343],[119.4198,-3.4755],[118.9946,-3.5376],[118.8126,-3.1568],[118.7837,-2.7648],[119.0922,-2.4829],[119.3217,-1.9298],[119.3089,-1.4083],[119.7718,-.4836],[119.8091,.2386],[120.2694,.971],[120.5167,.8174],[120.9122,1.2888],[121.44,1.2142],[121.5918,1.0678],[122.4365,1.018],[122.8924,.8498],[123.2781,.9279],[123.8468,.8383],[124.2738,1.022],[124.9893,1.7012],[125.2339,1.5023],[124.889,.9954]]],[[[127.7326,.848],[128.1609,1.1579],[128.4242,1.5174],[128.6883,1.5725],[128.7025,1.1064],[128.299,.8769],[128.6914,.3602],[127.9829,.4721],[127.8875,.2985],[128.0464,-.706],[127.6918,-.2417],[127.7086,.2883],[127.5555,.4898],[127.4201,1.252],[127.6318,1.8437],[128.0109,1.7012],[128.0118,1.3319],[127.6527,1.0141],[127.7326,.848]]],[[[117.5746,4.1706],[117.6301,3.6361],[117.1662,3.5922],[117.6105,3.0644],[118.0664,2.3178],[117.8649,1.9684],[118.0806,1.7016],[118.9848,.9821],[118.5347,.8134],[118.196,.8742],[117.745,.7295],[117.5222,.2359],[117.4627,-.3238],[117.5626,-.7708],[116.5545,-1.474],[116.4236,-2.0528],[116.5656,-2.2996],[116.3308,-2.9024],[115.9561,-3.5949],[114.6937,-4.1697],[114.5361,-3.4946],[114.0825,-3.2788],[113.7957,-3.4564],[113.5258,-3.1838],[112.9714,-3.1869],[112.6003,-3.4005],[112.2851,-3.321],[111.8222,-3.5323],[111.8231,-3.0573],[111.3676,-2.9335],[111.0445,-3.0555],[110.5739,-2.8913],[110.2326,-2.925],[110.0191,-1.3989],[109.7874,-1.0114],[109.454,-.8689],[109.1606,-.4947],[109.2574,.0313],[108.9444,.3558],[108.9058,.7939],[109.0758,1.4957],[109.3785,1.9227],[109.6289,2.0275],[109.6542,1.6151],[110.5056,.8618],[110.9379,1.0172],[111.7698,.9994],[112.0783,1.1432],[112.1857,1.4393],[112.476,1.5592],[113.6222,1.236],[113.9022,1.4344],[114.5459,1.4673],[114.8304,1.98],[114.7865,2.2503],[115.1509,2.4931],[115.0861,2.8411],[115.4545,3.0342],[115.5686,3.9389],[115.8962,4.3486],[117.1005,4.337],[117.5746,4.1706]]]]},properties:{name:"Indonesia",id:"ID"},id:"ID"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[22.132,48.4053],[22.8764,47.9472],[22.2905,47.7279],[21.1519,46.3044],[20.2419,46.1086],[19.5308,46.1552],[18.9054,45.9315],[17.9639,45.7704],[17.3105,45.9963],[16.5163,46.4997],[16.0929,46.8632],[16.4533,47.0066],[16.4342,47.3675],[17.1475,48.0058],[17.7619,47.7701],[18.7242,47.787],[18.7917,48.0005],[19.8988,48.1314],[20.4901,48.5269],[21.4515,48.5522],[22.132,48.4053]]]},properties:{name:"Hungary",id:"HU"},id:"HU"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.7791,19.7183],[-71.6571,19.1306],[-71.7683,18.0391],[-72.0599,18.2286],[-72.8767,18.1518],[-73.3851,18.2513],[-73.885,18.0418],[-74.419,18.3463],[-74.2276,18.6628],[-72.7894,18.4346],[-72.3478,18.6747],[-72.8112,19.0716],[-72.7033,19.4409],[-73.0527,19.6109],[-73.1177,19.9039],[-72.6369,19.9008],[-71.7791,19.7183]]]},properties:{name:"Haiti",id:"HT"},id:"HT"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[18.9054,45.9315],[19.0549,45.5271],[19.007,44.8693],[18.6625,45.0774],[17.8129,45.0779],[16.5305,45.2168],[16.2935,45.0086],[15.7879,45.1791],[15.7369,44.7658],[16.214,44.215],[17.6247,43.0426],[17.5852,42.9383],[16.903,43.3924],[15.9415,43.6565],[15.123,44.2567],[14.8548,45.081],[14.3861,45.342],[13.9657,44.8355],[13.6293,45.1081],[13.5778,45.5169],[13.8787,45.4286],[15.3396,45.4672],[15.6246,45.8338],[15.6361,46.2005],[16.5163,46.4997],[17.3105,45.9963],[17.9639,45.7704],[18.9054,45.9315]]],[[[17.6678,42.897],[18.4362,42.5597],[18.5174,42.4327],[17.6678,42.897]]]]},properties:{name:"Croatia",id:"HR"},id:"HR"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-83.1576,14.9931],[-83.8674,14.7947],[-84.646,14.6611],[-84.9851,14.7525],[-85.1796,14.3432],[-85.7868,13.8443],[-86.1512,13.9948],[-86.3317,13.7702],[-86.7336,13.7635],[-86.7108,13.3134],[-87.0592,12.9916],[-87.3373,12.9792],[-87.4891,13.3529],[-87.8143,13.3991],[-87.7153,13.8128],[-88.151,13.9872],[-88.4491,13.851],[-89.0572,14.329],[-89.3626,14.416],[-89.2223,14.8661],[-88.9764,15.1427],[-88.2284,15.7291],[-87.6181,15.9097],[-86.9072,15.7624],[-86.3568,15.7832],[-85.7839,16.003],[-85.4836,15.8995],[-84.9738,15.9901],[-84.2614,15.8227],[-83.7604,15.2204],[-83.3691,15.2399],[-83.1576,14.9931]]]},properties:{name:"Honduras",id:"HN"},id:"HN"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[73.7074,-53.1372],[73.465,-53.1843],[73.3363,-53.0298],[73.5858,-53.0271],[73.7074,-53.1372]]]},properties:{name:"Heard Island and McDonald Islands",id:"HM"},id:"HM"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[114.0154,22.5117],[114.2658,22.541],[114.268,22.2956],[114.0154,22.5117]]]},properties:{name:"Hong Kong",id:"HK"},id:"HK"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-57.1948,5.5484],[-57.3309,5.0202],[-57.7111,4.9909],[-58.0544,4.1719],[-57.8327,3.6761],[-57.5497,3.3529],[-57.3036,3.3769],[-57.2097,2.8828],[-56.7043,2.0363],[-56.4828,1.9422],[-56.8368,1.8814],[-57.1189,2.0141],[-57.5943,1.7043],[-58.3407,1.5876],[-58.5119,1.2848],[-58.8625,1.2036],[-59.2312,1.3758],[-59.7563,1.9005],[-59.7552,2.2743],[-59.9942,2.6902],[-59.8544,3.5873],[-59.5512,3.9335],[-59.8333,4.476],[-60.1112,4.511],[-59.9907,5.0828],[-60.142,5.239],[-60.7422,5.2022],[-61.3767,5.9071],[-61.1286,6.2142],[-61.1457,6.6945],[-60.3951,6.9453],[-60.7191,7.4989],[-60.5136,7.8131],[-60.0324,8.0537],[-59.8315,8.3059],[-60.0175,8.5491],[-59.2003,8.0746],[-58.6266,7.5459],[-58.4806,7.0381],[-57.9825,6.786],[-57.1902,6.0975],[-57.1948,5.5484]]]},properties:{name:"Guyana",id:"GY"},id:"GY"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[144.7416,13.2593],[144.6493,13.4288],[144.7905,13.5269],[144.7416,13.2593]]]},properties:{name:"Guam",id:"GU"},id:"GU"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-51.6526,4.0614],[-51.9906,3.7018],[-52.7006,2.3635],[-52.9648,2.1837],[-53.7678,2.3551],[-54.13,2.1211],[-54.6163,2.3266],[-54.1954,2.818],[-54.2032,3.1381],[-53.9904,3.5895],[-54.3508,4.0543],[-54.4522,5.0135],[-54.1559,5.3589],[-53.8472,5.7823],[-53.4544,5.5635],[-52.8993,5.425],[-52.2905,4.9421],[-51.9196,4.5244],[-51.6526,4.0614]]]},properties:{name:"French Guiana",id:"GF"},id:"GF"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-89.1615,17.8149],[-89.2374,15.8942],[-88.8941,15.8907],[-88.2284,15.7291],[-88.9764,15.1427],[-89.2223,14.8661],[-89.3626,14.416],[-89.8726,14.0454],[-90.0952,13.7364],[-90.607,13.9291],[-91.1461,13.9255],[-91.8191,14.2283],[-92.2352,14.5452],[-92.0748,15.0743],[-92.1871,15.3207],[-91.7365,16.07],[-90.4472,16.0726],[-90.417,16.3909],[-90.7107,16.7083],[-91.4096,17.2561],[-90.993,17.2525],[-90.9892,17.8163],[-89.1615,17.8149]]]},properties:{name:"Guatemala",id:"GT"},id:"GT"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-25.4324,70.9213],[-25.4022,70.6527],[-27.898,70.4541],[-27.7089,70.8971],[-25.4324,70.9213]]],[[[-52.7313,69.9447],[-52.0452,69.8071],[-52.1125,69.4891],[-53.5784,69.2567],[-53.7831,69.5064],[-54.804,69.6304],[-54.8304,70.1611],[-53.3751,70.2213],[-52.7313,69.9447]]],[[[-29.953,83.5649],[-25.9475,83.2897],[-24.4702,82.8773],[-21.5208,82.5954],[-25.1489,82.0011],[-21.3379,82.0687],[-21.1466,81.6952],[-17.2261,81.4304],[-15.5555,81.8337],[-12.1928,81.649],[-11.5288,81.424],[-14.5035,80.7633],[-16.7607,80.5733],[-16.8683,80.1982],[-19.4292,80.2577],[-20.1385,79.8033],[-19.2836,79.683],[-19.0749,79.1524],[-20.9557,78.5551],[-20.8625,77.9119],[-20.2319,77.3684],[-18.339,77.2152],[-18.5103,76.7782],[-20.9422,76.887],[-21.8772,76.5734],[-21.5692,76.2937],[-20.1037,76.2191],[-19.5091,75.7575],[-19.4261,75.2299],[-20.485,75.3143],[-19.2252,74.4795],[-19.3692,74.284],[-21.1295,74.1109],[-20.3673,73.8483],[-20.5096,73.493],[-22.1851,73.2699],[-22.0364,72.9184],[-22.2931,72.1196],[-24.0692,72.4987],[-24.6669,72.4374],[-22.0133,71.6888],[-21.7523,71.4784],[-21.5228,70.5262],[-23.3279,70.451],[-23.7917,70.5551],[-24.377,71.1463],[-25.7422,71.1836],[-26.7179,70.9506],[-27.6887,70.9934],[-28.5409,70.4769],[-28.0149,70.4024],[-26.7472,70.4756],[-23.1732,70.1145],[-23.0882,69.883],[-26.3414,68.7023],[-29.2496,68.2988],[-29.8686,68.3116],[-30.9786,68.0613],[-32.1373,68.3849],[-32.2747,67.9228],[-33.157,67.6267],[-34.1016,66.7258],[-34.6329,66.4349],[-36.3792,65.8307],[-37.7541,65.593],[-39.9609,65.5562],[-39.5779,65.3407],[-40.6554,64.9154],[-40.1822,64.48],[-40.6177,64.1317],[-40.5504,63.7254],[-42.1529,62.5686],[-42.3216,62.1526],[-42.1103,61.8572],[-42.4188,61.537],[-42.7171,60.7675],[-43.3201,59.9281],[-44.0654,59.9247],[-45.3793,60.2028],[-46.0467,60.6157],[-46.0116,61.0968],[-46.8746,60.8163],[-47.7963,60.829],[-48.922,61.2775],[-49.2891,61.59],[-49.5534,62.2328],[-50.3192,62.4731],[-50.3382,62.8287],[-51.4688,63.6423],[-51.4511,63.9047],[-52.0934,64.4158],[-52.259,65.1549],[-53.6346,66.4136],[-53.0382,66.8268],[-53.8845,67.1356],[-53.4189,67.5746],[-53.578,67.8369],[-53.0393,68.6108],[-51.2493,68.74],[-50.5,69.9358],[-52.2545,70.059],[-54.0143,70.4217],[-54.1659,70.8201],[-52.4052,70.6867],[-51.5246,70.4394],[-51.1302,70.9717],[-53.117,71.3128],[-53.4761,71.6402],[-54.6891,71.3672],[-55.5939,71.5536],[-55.3156,72.1107],[-55.6017,72.4536],[-54.7379,72.8724],[-56.104,73.5582],[-55.9295,73.8954],[-56.7063,74.2192],[-56.2556,74.5268],[-58.6035,75.3853],[-58.5163,75.6891],[-61.3747,76.1801],[-63.4388,76.3394],[-66.8262,75.9688],[-69.3728,76.3319],[-69.2521,76.6861],[-70.7928,76.869],[-70.8629,77.1755],[-69.3515,77.4671],[-72.8181,78.1945],[-72.3957,78.5043],[-68.9935,78.8574],[-67.4823,79.1169],[-65.9679,79.1324],[-64.7923,80.0007],[-66.8437,80.0761],[-66.996,80.413],[-62.9932,81.2069],[-61.436,81.1337],[-61.203,81.7469],[-58.7174,82.0932],[-54.7259,82.3513],[-52.7757,82.3218],[-50.8944,81.8952],[-48.8612,82.4054],[-45.2912,81.8288],[-44.239,82.3682],[-46.4782,82.9519],[-43.1945,83.255],[-32.9845,83.5995],[-29.953,83.5649]]]]},properties:{name:"Greenland",id:"GL"},id:"GL"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-61.7154,12.0128],[-61.715,12.185],[-61.6071,12.2232],[-61.6271,12.0541],[-61.7154,12.0128]]]},properties:{name:"Grenada",id:"GD"},id:"GD"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[23.8521,35.5355],[24.3129,35.3638],[24.7212,35.425],[25.4758,35.3061],[25.7448,35.1427],[24.7998,34.9345],[24.4638,35.1605],[23.5618,35.295],[23.8521,35.5355]]],[[[26.0391,40.7269],[25.1043,40.9945],[24.3839,40.9129],[23.8787,40.5444],[23.6643,40.2239],[23.3119,40.2164],[22.6296,40.4956],[22.5923,40.0371],[22.919,39.6291],[22.9656,39.0308],[23.2528,38.6614],[23.9671,38.2748],[23.5804,38.0107],[23.1938,37.9592],[23.1614,37.3338],[22.765,37.3932],[23.0735,36.7749],[22.6083,36.7798],[22.0805,37.0288],[21.5829,37.0807],[21.5714,37.541],[21.1448,37.9192],[21.4036,38.1967],[21.8248,38.3281],[22.7996,37.9814],[22.4219,38.4386],[21.4724,38.3214],[21.1133,38.3849],[20.7795,39.0086],[20.301,39.3273],[20.0013,39.7095],[20.6574,40.1174],[21.0312,40.6585],[20.9641,40.8498],[21.5758,40.8689],[21.9296,41.1073],[22.7246,41.1783],[22.9159,41.3363],[23.635,41.3869],[24.0558,41.5272],[25.2512,41.2436],[26.1355,41.3856],[26.321,41.7167],[26.6246,41.4016],[26.0391,40.7269]]],[[[23.4153,38.9588],[24.0989,38.6712],[23.7589,38.4013],[23.2519,38.8013],[23.4153,38.9588]]]]},properties:{name:"Greece",id:"GR"},id:"GR"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[9.5907,1.0318],[9.3861,1.1392],[9.8069,1.9276],[9.8007,2.3044],[9.98,2.1677],[11.3286,2.1673],[11.3352,.9998],[9.5907,1.0318]]]},properties:{name:"Equatorial Guinea",id:"GQ"},id:"GQ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-15.0431,10.9404],[-15.3931,11.2174],[-15.5018,11.7238],[-16.1384,11.9174],[-16.7119,12.3551],[-15.5748,12.4904],[-15.1962,12.68],[-13.7294,12.6738],[-13.7327,11.7358],[-14.6831,11.5085],[-15.0431,10.9404]]]},properties:{name:"Guinea-Bissau",id:"GW"},id:"GW"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-16.7634,13.064],[-16.8248,13.3409],[-16.5623,13.5873],[-15.5096,13.5864],[-15.8343,13.1563],[-16.6488,13.1541],[-16.7634,13.064]]]},properties:{name:"Gambia",id:"GM"},id:"GM"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-61.3272,16.2302],[-61.5221,16.228],[-61.529,16.434],[-61.4065,16.4682],[-61.3272,16.2302]]]},properties:{name:"Guadeloupe",id:"GP"},id:"GP"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-11.3894,12.4043],[-11.3053,12.0155],[-10.9333,12.205],[-10.6774,11.8996],[-10.2748,12.2126],[-9.8207,12.0426],[-9.043,12.4025],[-8.8219,11.6732],[-8.4075,11.3865],[-8.2315,10.4379],[-7.9907,10.1627],[-8.1365,10.022],[-8.137,9.4955],[-7.8962,9.416],[-7.951,8.7866],[-7.8236,8.4674],[-8.232,7.5566],[-8.4863,7.5584],[-8.7083,7.6591],[-8.8896,7.2627],[-9.1175,7.2157],[-9.4598,7.4425],[-9.369,7.6396],[-9.5182,8.3463],[-9.7683,8.5345],[-10.2832,8.4852],[-10.5005,8.6876],[-10.6905,9.3144],[-11.2056,9.9776],[-11.911,9.9931],[-12.5016,9.8622],[-12.7559,9.3734],[-13.2928,9.0494],[-13.7005,9.8511],[-14.4269,10.2483],[-14.7758,10.9315],[-15.0431,10.9404],[-14.6831,11.5085],[-13.7327,11.7358],[-13.7294,12.6738],[-13.0828,12.6334],[-12.2912,12.328],[-11.3894,12.4043]]]},properties:{name:"Guinea",id:"GN"},id:"GN"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-.0686,11.1157],[-.0577,10.6305],[.3627,10.2364],[.2619,9.4955],[.5291,9.3583],[.4153,8.6525],[.688,8.3041],[.5837,8.1456],[.6348,7.3537],[.5256,6.8508],[.7369,6.4526],[1.1874,6.0895],[.9499,5.8103],[.2597,5.7575],[-.7977,5.2266],[-1.6384,4.9807],[-2.0017,4.7623],[-3.1139,5.0885],[-3.0868,5.1285],[-3.0191,5.1307],[-2.7952,5.1844],[-3.2007,6.3483],[-3.2358,6.8073],[-2.9858,7.205],[-2.7899,7.9321],[-2.5058,8.2087],[-2.7466,9.1098],[-2.6958,9.4813],[-2.7865,10.4019],[-2.9148,10.5924],[-2.8298,10.9985],[-.7014,10.9888],[-.0686,11.1157]]]},properties:{name:"Ghana",id:"GH"},id:"GH"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-2.5124,49.4946],[-2.5475,49.4287],[-2.646,49.4682],[-2.5124,49.4946]]]},properties:{name:"Guernsey",id:"GG"},id:"GG"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[46.4298,41.8907],[46.1821,41.6573],[46.6189,41.3439],[46.4577,41.07],[45.281,41.4495],[45.0013,41.291],[43.4393,41.1073],[42.7876,41.5636],[42.4663,41.4398],[41.5101,41.5174],[41.7631,41.9702],[41.4888,42.6591],[40.8367,43.0635],[39.9782,43.42],[40.6481,43.534],[41.5807,43.2193],[42.4192,43.2242],[43.7824,42.747],[43.9573,42.5664],[44.5059,42.7488],[45.1602,42.6751],[45.7275,42.4749],[45.6388,42.205],[46.4298,41.8907]]]},properties:{name:"Georgia",id:"GE"},id:"GE"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[13.2937,2.1615],[13.1627,1.6479],[13.2741,1.2409],[13.8512,1.4189],[14.181,1.3701],[14.4345,.8116],[14.0874,.5364],[13.8845,.1906],[13.8601,-.2035],[14.4806,-.6181],[14.3839,-1.8899],[14.0874,-2.4669],[13.7842,-2.1638],[13.465,-2.3955],[12.9918,-2.3134],[12.7934,-1.9316],[12.4321,-1.929],[12.4463,-2.3298],[11.5754,-2.3973],[11.5376,-2.8367],[11.934,-3.3188],[11.5043,-3.5203],[11.1301,-3.9163],[10.3476,-3.0129],[9.6245,-2.3671],[9.2658,-1.8251],[9.3306,-1.5348],[9.0647,-1.2982],[8.8215,-.7082],[9.2969,-.3514],[9.5907,1.0318],[11.3352,.9998],[11.3286,2.1673],[11.3485,2.2996],[13.2204,2.2565],[13.2937,2.1615]]]},properties:{name:"Gabon",id:"GA"},id:"GA"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[5.7897,49.5383],[6.3441,49.4527],[6.7356,49.1606],[7.4507,49.1522],[8.1348,48.9735],[7.5843,48.0644],[7.6154,47.5925],[7.0006,47.3227],[6.06,46.4282],[6.7583,46.4158],[7.021,45.9257],[7.1533,45.401],[6.6277,45.1178],[7.0308,44.7166],[6.9673,44.2802],[7.6771,44.0831],[7.4929,43.7671],[7.4387,43.7507],[7.4143,43.7711],[7.3779,43.7316],[6.4941,43.1692],[6.1159,43.0724],[5.4066,43.2286],[5.0599,43.4444],[4.7119,43.3733],[4.0527,43.5931],[3.2591,43.1931],[3.0518,42.9152],[3.2116,42.431],[2.0326,42.3537],[1.7059,42.5033],[1.4284,42.5961],[-.0411,42.6893],[-1.2855,43.0595],[-1.794,43.4075],[-1.4848,43.5638],[-1.2456,44.5599],[-1.066,45.8059],[-1.1464,46.3115],[-1.7867,46.5148],[-2.0188,47.0377],[-3.1587,47.6946],[-4.312,47.8229],[-4.6291,48.0857],[-4.3932,48.3676],[-4.7208,48.5398],[-3.2315,48.8408],[-2.6924,48.5367],[-2.4463,48.6483],[-1.4375,48.6415],[-1.8564,49.6837],[-1.2587,49.6802],[-1.1386,49.3879],[-.1636,49.2969],[.1869,49.703],[1.2456,49.9982],[1.5514,50.2938],[1.5794,50.7393],[1.9123,50.9905],[2.5249,51.0971],[2.8396,50.7118],[4.1744,50.2466],[4.8677,49.788],[5.7897,49.5383]]],[[[9.4802,42.8056],[9.5508,42.1296],[9.1863,41.3847],[8.8077,41.5885],[8.7132,42.5499],[9.4802,42.8056]]]]},properties:{name:"France",id:"FR"},id:"FR"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[158.315,6.8135],[158.1836,6.8011],[158.1348,6.9449],[158.2946,6.9511],[158.315,6.8135]]]},properties:{name:"Federated States of Micronesia",id:"FM"},id:"FM"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-6.6311,62.2279],[-7.0135,62.094],[-7.1722,62.2856],[-6.6311,62.2279]]]},properties:{name:"Faroe Islands",id:"FO"},id:"FO"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-58.8501,-51.2698],[-58.4737,-51.509],[-57.9765,-51.3843],[-57.8382,-51.7092],[-58.6834,-51.9361],[-59.0681,-52.1731],[-59.5708,-51.9254],[-59.0596,-51.6857],[-58.8501,-51.2698]]],[[[-60.2863,-51.462],[-59.268,-51.4274],[-59.9214,-51.9693],[-60.2863,-51.462]]]]},properties:{name:"Falkland Islands",id:"FK"},id:"FK"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[178.2804,-17.372],[178.5915,-17.6516],[178.6679,-18.0808],[177.8471,-18.2549],[177.3215,-18.0773],[177.2638,-17.8633],[177.6181,-17.4612],[178.2804,-17.372]]],[[[179.9991,-16.1686],[179.7483,-16.4464],[179.9281,-16.7443],[179.007,-16.9001],[178.805,-16.6315],[179.5517,-16.2498],[179.9991,-16.1686]]]]},properties:{name:"Fiji",id:"FJ"},id:"FJ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[28.9657,69.0219],[28.4708,68.4883],[29.3439,68.062],[29.9414,67.5475],[29.0869,66.9709],[29.9032,66.0911],[29.604,64.9685],[30.0728,64.7649],[30.1083,64.3661],[30.5038,64.0205],[30.0555,63.689],[31.1807,63.2082],[31.5341,62.8855],[31.2855,62.5679],[29.6902,61.5461],[27.7978,60.5362],[25.6565,60.3331],[23.7216,59.9656],[22.7934,60.0768],[22.5759,60.3591],[21.436,60.5964],[21.3605,60.9675],[21.606,61.5916],[21.2562,61.9897],[21.1035,62.6229],[22.2434,63.4379],[23.2488,63.8963],[24.5579,64.8009],[25.3729,65.0095],[25.348,65.4792],[24.1557,65.8052],[23.7012,66.4808],[23.9884,66.8106],[23.4681,67.45],[23.639,67.9543],[22.7823,68.3911],[21.9975,68.5207],[20.6223,69.037],[21.622,69.2707],[22.4108,68.7198],[23.8539,68.8059],[24.9414,68.5933],[25.7484,68.9901],[26.0116,69.6526],[26.5257,69.915],[27.8897,70.0617],[29.1415,69.6715],[28.9657,69.0219]]]},properties:{name:"Finland",id:"FI"},id:"FI"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[42.3784,12.4665],[41.7667,11.5889],[41.7982,10.9803],[42.5577,11.0806],[42.9226,10.9994],[42.6594,10.6212],[42.8418,10.2031],[43.1818,9.8799],[43.4828,9.3796],[44.023,8.9859],[46.9784,7.9969],[47.9781,7.9969],[45.9348,5.9972],[44.9405,4.9119],[44.0283,4.9509],[43.5383,4.8404],[43.0158,4.5634],[42.7916,4.2922],[42.0241,4.1377],[41.8839,3.9779],[41.2207,3.9437],[40.7653,4.2731],[39.8424,3.8514],[39.4944,3.4559],[38.0864,3.649],[36.9056,4.4116],[36.0818,4.4498],[35.763,4.808],[35.7448,5.3442],[35.2681,5.4925],[35.0821,5.6731],[34.7106,6.6604],[34.0643,7.2259],[33.6661,7.6711],[33.2262,7.7608],[33.0127,7.9516],[33.2342,8.3964],[33.9533,8.4435],[34.0945,8.5824],[34.078,9.4613],[34.2915,10.1249],[34.2756,10.528],[34.5716,10.88],[34.9312,10.8649],[35.1123,11.8166],[35.5961,12.5375],[36.1075,12.7266],[36.2123,13.2712],[36.3907,13.6259],[36.5243,14.2567],[37.0246,14.2718],[37.2572,14.4538],[37.571,14.1493],[37.8844,14.8524],[38.5045,14.4245],[39.074,14.6282],[40.2215,14.4311],[40.7697,14.1444],[41.3627,13.4998],[41.7649,13.1838],[42.3784,12.4665]]]},properties:{name:"Ethiopia",id:"ET"},id:"ET"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[28.0127,59.4842],[27.4272,58.7331],[27.753,57.8411],[27.3517,57.5282],[26.5328,57.5311],[25.9912,57.8382],[25.111,58.0635],[24.3226,57.8706],[24.529,58.3543],[23.7678,58.3609],[23.5094,58.6585],[23.4943,59.1957],[24.3803,59.4726],[25.5091,59.6389],[26.9749,59.4507],[28.0127,59.4842]]],[[[22.6172,58.6213],[23.2928,58.4834],[22.1875,58.1543],[22.0814,58.4781],[22.6172,58.6213]]]]},properties:{name:"Estonia",id:"EE"},id:"EE"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-1.794,43.4075],[-1.2855,43.0595],[-.0411,42.6893],[1.4284,42.5961],[1.4861,42.4345],[1.7059,42.5033],[2.0326,42.3537],[3.2116,42.431],[3.248,41.9445],[2.0827,41.2875],[1.0329,41.062],[-.3269,39.5199],[-.2049,39.0627],[.2015,38.7591],[-.3813,38.4355],[-.6468,38.1518],[-.8221,37.581],[-1.3275,37.561],[-1.7975,37.233],[-2.1116,36.7767],[-4.3668,36.7181],[-4.6742,36.5063],[-5.1716,36.4238],[-5.6254,36.026],[-6.0407,36.1885],[-6.4924,36.9547],[-6.8845,37.1944],[-7.4061,37.1793],[-7.5036,37.5854],[-7.1855,38.0062],[-7.3431,38.4572],[-7.0461,38.9069],[-7.4452,39.5363],[-7.0368,39.7139],[-7.0146,40.2084],[-6.8102,40.3429],[-6.9285,41.0092],[-6.2125,41.5321],[-6.6182,41.9422],[-7.4037,41.8335],[-7.9208,41.8836],[-8.2131,42.1336],[-8.7771,41.9409],[-8.691,42.2743],[-9.2352,42.977],[-8.8736,43.3343],[-7.6982,43.7644],[-7.2621,43.5948],[-5.6658,43.5824],[-4.523,43.416],[-3.6046,43.5194],[-3.0455,43.3716],[-2.3371,43.3281],[-1.794,43.4075]]],[[[3.1454,39.7902],[3.4619,39.6979],[3.0726,39.3011],[2.3713,39.6131],[2.785,39.8546],[3.1454,39.7902]]],[[[-16.3346,28.38],[-16.6579,28.0071],[-16.9054,28.3396],[-16.3346,28.38]]]]},properties:{name:"Spain",id:"ES"},id:"ES"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[38.6093,18.0049],[38.9116,17.427],[39.1424,16.7292],[39.2991,15.9213],[39.5064,15.532],[39.8637,15.4703],[40.2042,15.014],[41.1763,14.6202],[41.6584,13.9832],[42.2452,13.5877],[42.7961,12.8642],[43.1166,12.7084],[42.67,12.3764],[42.3784,12.4665],[41.7649,13.1838],[41.3627,13.4998],[40.7697,14.1444],[40.2215,14.4311],[39.074,14.6282],[38.5045,14.4245],[37.8844,14.8524],[37.571,14.1493],[37.2572,14.4538],[37.0246,14.2718],[36.5243,14.2567],[36.4267,15.132],[36.9136,16.2964],[37.0091,17.059],[37.4112,17.0616],[37.7823,17.458],[38.2537,17.5845],[38.6093,18.0049]]]},properties:{name:"Eritrea",id:"ER"},id:"ER"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-6.218,54.0887],[-7.3553,54.1213],[-8.1183,54.4143],[-7.2186,55.0921],[-6.1293,55.2175],[-5.4703,54.5002],[-5.6068,54.2727],[-6.218,54.0887]]],[[[-3.1097,58.5154],[-3.9901,57.959],[-3.4029,57.7082],[-2.0741,57.7024],[-1.778,57.4938],[-2.6527,56.3183],[-3.1783,56.0802],[-2.1471,55.9031],[-1.6555,55.5704],[-1.2917,54.7738],[-.6714,54.5039],[-.2055,54.0217],[.5589,52.967],[1.6566,52.7537],[1.5589,52.0869],[.9553,51.8077],[.6867,51.3865],[1.4151,51.3632],[.9601,50.9259],[.2051,50.763],[-1.5168,50.7475],[-2.5477,50.6163],[-3.4047,50.6323],[-3.7933,50.2293],[-4.1726,50.3908],[-5.3422,50.2461],[-4.583,50.7764],[-4.1881,51.1885],[-3.1359,51.2049],[-4.3863,51.7412],[-4.9023,51.6262],[-5.0881,51.9959],[-4.3832,52.1973],[-3.9804,52.5417],[-4.1111,53.2189],[-3.0646,53.4268],[-2.925,53.7327],[-3.958,54.7809],[-5.1354,54.8575],[-4.7212,55.421],[-5.2457,55.9293],[-5.6097,56.0553],[-5.392,56.5148],[-5.9368,56.6058],[-5.562,57.2328],[-5.8181,57.4361],[-5.3382,58.2386],[-4.7155,58.5101],[-3.1097,58.5154]]]]},properties:{name:"United Kingdom",id:"GB"},id:"GB"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[34.1983,31.3226],[34.2454,31.2085],[34.9041,29.4773],[34.7363,29.2705],[34.3999,28.016],[34.2201,27.7643],[33.7602,28.0475],[33.2475,28.5678],[33.0757,29.0729],[32.7215,29.5217],[32.6318,28.9921],[32.8982,28.5651],[33.5471,27.8984],[33.5498,27.6072],[33.8929,27.0497],[33.9591,26.6488],[34.565,25.6913],[35.194,24.4751],[35.6246,24.0658],[35.5229,23.4426],[35.6978,22.9463],[36.2296,22.6289],[36.8714,21.9968],[34.2467,21.9964],[32.6061,21.9959],[30.3285,21.9951],[27.2723,21.9955],[24.9805,21.9959],[24.9805,24.2416],[24.9805,25.8134],[24.9805,27.8345],[24.9805,29.1817],[24.7115,30.1316],[24.9738,30.7766],[24.8526,31.335],[25.1505,31.655],[25.3822,31.513],[25.8931,31.6209],[27.2479,31.3781],[27.9674,31.0975],[28.5147,31.0505],[29.0723,30.8303],[29.5916,31.0114],[30.3951,31.4575],[30.7005,31.4038],[31.1941,31.5876],[32.1018,31.0926],[33.1299,31.1681],[33.6665,31.1304],[34.1983,31.3226]]]},properties:{name:"Egypt",id:"EG"},id:"EG"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-91.2722,.0251],[-90.7997,-.7522],[-90.9055,-.9404],[-91.3692,-.287],[-91.2722,.0251]]],[[[-75.2845,-.1063],[-75.2632,-.5555],[-75.5706,-1.5312],[-76.0898,-2.1331],[-76.679,-2.5628],[-77.8607,-2.9819],[-78.3472,-3.4311],[-78.4198,-3.7769],[-79.0763,-4.9905],[-79.3308,-4.9279],[-79.6385,-4.4547],[-80.1396,-4.2962],[-80.4885,-4.3939],[-80.51,-4.0694],[-80.1793,-3.8776],[-80.3247,-3.388],[-79.9217,-3.0902],[-79.7299,-2.5793],[-80.4501,-2.6259],[-80.9628,-2.1891],[-80.7704,-2.0768],[-80.8015,-1.3834],[-80.9024,-1.0789],[-80.554,-.8481],[-80.4823,-.3682],[-80.1334,-.006],[-80.0251,.4104],[-80.0883,.7846],[-79.7412,.9799],[-78.8996,1.2063],[-78.8597,1.4553],[-78.3121,1.046],[-77.4676,.6363],[-77.4228,.425],[-76.4946,.2355],[-76.311,.4485],[-75.8798,.1511],[-75.2845,-.1063]]]]},properties:{name:"Ecuador",id:"EC"},id:"EC"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[8.5764,36.9374],[8.2306,36.5454],[8.2457,35.8707],[8.3944,35.204],[8.2457,34.7339],[7.5138,34.0805],[7.5,33.8323],[7.7628,33.2331],[8.2111,32.9268],[8.3332,32.5437],[9.0439,32.0723],[9.5188,30.2293],[9.3102,30.1152],[9.6724,29.567],[9.8424,28.9668],[9.9161,27.7856],[9.7474,27.3306],[9.8593,26.5521],[9.4913,26.3337],[9.4482,26.0673],[10.0009,25.3322],[10.2557,24.5909],[10.6863,24.5514],[11.5075,24.3144],[11.9678,23.518],[9.3785,21.9915],[7.4818,20.8729],[5.8367,19.4791],[4.2276,19.1426],[3.4007,18.9886],[3.1059,19.1502],[3.2559,19.4107],[3.2036,19.7898],[2.4063,20.0637],[2.2195,20.2479],[1.6855,20.3784],[1.1657,20.8174],[1.1457,21.1024],[-1.2931,22.6964],[-3.2579,23.981],[-4.8227,24.9958],[-6.2387,25.848],[-8.6834,27.2858],[-8.6834,27.6565],[-8.6599,28.7187],[-7.6851,29.3495],[-7.095,29.6251],[-6.6353,29.5687],[-6.5008,29.8093],[-5.4488,29.9567],[-4.9683,30.4654],[-4.3228,30.6989],[-3.8335,31.1978],[-3.8268,31.6617],[-3.0174,31.8344],[-2.9308,32.0426],[-2.4485,32.13],[-1.2753,32.0892],[-1.0656,32.4683],[-1.5099,32.8775],[-1.6792,33.3187],[-1.7955,34.7521],[-2.2197,35.1041],[-1.9132,35.0943],[-.9175,35.6683],[.0479,35.9004],[.5149,36.2618],[1.2571,36.5197],[2.5932,36.6009],[2.9727,36.7847],[3.7788,36.8961],[4.7581,36.8965],[5.1958,36.6768],[6.0649,36.8641],[6.4866,37.0856],[6.9274,36.9196],[7.6079,36.9999],[7.9106,36.8566],[8.5764,36.9374]]]},properties:{name:"Algeria",id:"DZ"},id:"DZ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.7683,18.0391],[-71.6571,19.1306],[-71.7791,19.7183],[-71.5578,19.8954],[-70.9542,19.9141],[-70.1294,19.6362],[-69.7394,19.2993],[-68.6848,18.9047],[-68.3594,18.538],[-68.6588,18.222],[-68.9349,18.408],[-69.7707,18.4435],[-70.1831,18.2517],[-71.0278,18.273],[-71.3958,17.6462],[-71.7683,18.0391]]]},properties:{name:"Dominican Republic",id:"DO"},id:"DO"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[9.7399,54.8255],[8.6701,54.9034],[8.6159,55.4181],[8.1321,55.5999],[8.1641,56.6069],[8.6186,57.1114],[9.5543,57.2325],[9.9623,57.581],[10.5371,57.4485],[10.2828,56.6204],[10.1829,55.8651],[9.5912,55.4932],[9.7399,54.8255]]],[[[12.5688,55.785],[11.6539,55.1869],[11.2864,55.2044],[10.9788,55.7215],[12.219,56.1186],[12.5688,55.785]]],[[[10.645,55.6099],[10.7852,55.1334],[9.9889,55.1631],[9.8606,55.5156],[10.645,55.6099]]]]},properties:{name:"Denmark",id:"DK"},id:"DK"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-61.2817,15.2492],[-61.481,15.5253],[-61.3201,15.5853],[-61.2817,15.2492]]]},properties:{name:"Dominica",id:"DM"},id:"DM"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[43.2462,11.4997],[42.9226,10.9994],[42.5577,11.0806],[41.7982,10.9803],[41.7667,11.5889],[42.3784,12.4665],[42.67,12.3764],[43.1166,12.7084],[43.41,12.1899],[43.2719,11.9698],[42.7992,11.7394],[43.2462,11.4997]]]},properties:{name:"Djibouti",id:"DJ"},id:"DJ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[9.7399,54.8255],[10.3604,54.4382],[11.3996,53.9446],[12.1111,54.1684],[12.5755,54.4673],[13.0287,54.4109],[13.8654,53.8534],[14.2587,53.7296],[14.4145,53.2835],[14.1286,52.8782],[14.6196,52.5284],[14.7527,52.0818],[14.6018,51.8324],[15.0164,51.2527],[14.8096,50.8589],[14.3692,50.8986],[12.4525,50.3498],[12.2763,50.0424],[12.6318,49.4613],[13.8148,48.7669],[13.4095,48.3942],[12.8143,48.1607],[12.686,47.6693],[11.717,47.5837],[11.2979,47.4247],[10.4306,47.541],[10.3129,47.3133],[9.5241,47.5242],[8.6177,47.7661],[7.6154,47.5925],[7.5843,48.0644],[8.1348,48.9735],[7.4507,49.1522],[6.7356,49.1606],[6.3441,49.4527],[6.4875,49.7985],[6.1164,50.1209],[6.3645,50.3163],[5.9939,50.7504],[5.8949,50.9843],[6.1932,51.4888],[5.9486,51.7625],[6.7418,51.9109],[7.0352,52.3801],[7.1973,53.2823],[7.2852,53.6814],[8.0091,53.6907],[8.5387,53.5569],[8.8978,53.8357],[8.9573,54.5383],[8.6701,54.9034],[9.7399,54.8255]]]},properties:{name:"Germany",id:"DE"},id:"DE"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[14.8096,50.8589],[16.0072,50.6117],[16.6792,50.0974],[17.152,50.3784],[17.8746,49.9722],[18.5622,49.8792],[18.8321,49.5108],[18.161,49.2574],[17.7583,48.888],[17.1884,48.861],[16.9531,48.5988],[16.4777,48.8001],[16.0573,48.7549],[14.972,48.9839],[14.6915,48.5993],[14.0492,48.6024],[13.8148,48.7669],[12.6318,49.4613],[12.2763,50.0424],[12.4525,50.3498],[14.3692,50.8986],[14.8096,50.8589]]]},properties:{name:"Czechia",id:"CZ"},id:"CZ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[34.4633,35.5937],[33.9418,35.2918],[34.0501,34.9882],[32.9417,34.5758],[32.4489,34.7294],[32.3171,34.9532],[32.9417,35.3904],[33.4588,35.3358],[34.4633,35.5937]]]},properties:{name:"Cyprus",id:"CY"},id:"CY"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-81.3696,19.349],[-81.1306,19.3468],[-81.3037,19.2718],[-81.3696,19.349]]]},properties:{name:"Cayman Islands",id:"KY"},id:"KY"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[105.7253,-10.493],[105.6969,-10.564],[105.5842,-10.5125],[105.7053,-10.4308],[105.7253,-10.493]]]},properties:{name:"Christmas Island",id:"CX"},id:"CX"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-68.7511,12.0599],[-68.8033,12.0457],[-68.995,12.142],[-69.154,12.2982],[-69.0767,12.3422],[-69.0132,12.2312],[-68.8275,12.1584],[-68.7511,12.0599]]]},properties:{name:"Curaao",id:"CW"},id:"CW"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-82.5617,21.5716],[-82.8531,21.4437],[-83.0826,21.7913],[-82.7146,21.8903],[-82.5617,21.5716]]],[[[-81.8375,23.1629],[-81.1785,23.0595],[-80.6501,23.103],[-80.0752,22.9423],[-79.183,22.3879],[-78.6865,22.367],[-77.8651,21.9005],[-77.4973,21.8717],[-76.6475,21.2844],[-75.7229,21.1108],[-75.6428,20.7335],[-74.8826,20.6505],[-74.2529,20.0797],[-75.1165,19.9012],[-76.1586,19.9896],[-77.7151,19.8555],[-77.2135,20.3003],[-77.2297,20.6438],[-77.9974,20.7153],[-78.4908,21.0536],[-78.6366,21.5157],[-79.2745,21.5627],[-80.2313,21.8721],[-80.4992,22.0634],[-80.9619,22.0528],[-81.8162,22.2001],[-81.9034,22.6791],[-82.7382,22.6893],[-83.3796,22.2228],[-84.3264,22.0745],[-84.3612,22.379],[-84.045,22.6662],[-83.2577,22.9676],[-82.1014,23.1905],[-81.8375,23.1629]]]]},properties:{name:"Cuba",id:"CU"},id:"CU"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-83.6419,10.9173],[-83.4482,10.4658],[-82.7783,9.6695],[-82.5635,9.5767],[-82.9399,9.4493],[-82.917,8.7404],[-82.9976,8.3676],[-82.8793,8.0706],[-83.1625,8.5882],[-83.734,8.6144],[-83.6373,9.0352],[-83.8956,9.2762],[-84.6589,9.6469],[-85.1145,9.5816],[-85.6248,9.9025],[-85.8305,10.3979],[-85.6672,10.7451],[-85.7444,11.062],[-85.6215,11.1845],[-84.9092,10.9453],[-84.3484,10.9799],[-84.1684,10.7806],[-83.6419,10.9173]]]},properties:{name:"Costa Rica",id:"CR"},id:"CR"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-23.4442,15.0078],[-23.7054,14.9611],[-23.7007,15.2714],[-23.4442,15.0078]]]},properties:{name:"Cape Verde",id:"CV"},id:"CV"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[43.4659,-11.9014],[43.2266,-11.7518],[43.3793,-11.6142],[43.4659,-11.9014]]]},properties:{name:"Comoros",id:"KM"},id:"KM"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-71.3197,11.8619],[-71.958,11.6666],[-72.2485,11.1965],[-72.6902,10.8361],[-72.8693,10.4911],[-73.0065,9.7894],[-73.3563,9.2269],[-72.7963,9.1089],[-72.6654,8.6277],[-72.4166,8.3818],[-72.443,7.4549],[-72.0843,7.0967],[-71.0134,6.9946],[-70.6552,7.0829],[-70.095,6.9378],[-69.4392,6.1348],[-68.4717,6.1565],[-67.8591,6.2897],[-67.4394,6.0256],[-67.8249,5.2705],[-67.8553,4.507],[-67.6616,3.8643],[-67.3111,3.416],[-67.8347,2.8926],[-67.2108,2.3901],[-66.8761,1.2231],[-67.352,2.0861],[-67.8152,1.79],[-68.1765,1.7198],[-69.8486,1.7087],[-69.8522,1.0593],[-69.3615,1.0642],[-69.1633,.864],[-70.0539,.5786],[-70.0706,-.1387],[-69.6675,-.4823],[-69.4003,-1.1948],[-69.6691,-2.6676],[-69.9658,-4.2359],[-70.3396,-3.8142],[-70.7351,-3.7818],[-70.0741,-2.7502],[-70.9146,-2.2184],[-71.3969,-2.3342],[-71.7525,-2.1527],[-72.3957,-2.4288],[-73.1545,-2.2783],[-73.1969,-1.8304],[-73.4963,-1.6932],[-73.6643,-1.2489],[-74.2465,-.9706],[-74.4178,-.5809],[-74.8018,-.2],[-75.2845,-.1063],[-75.8798,.1511],[-76.311,.4485],[-76.4946,.2355],[-77.4228,.425],[-77.4676,.6363],[-78.3121,1.046],[-78.8597,1.4553],[-78.5769,1.774],[-78.6171,2.3067],[-78.1201,2.4882],[-77.67,2.8788],[-77.2428,3.5855],[-77.1666,3.8621],[-77.4272,4.0605],[-77.2863,4.7219],[-77.4017,5.4161],[-77.2492,5.7801],[-77.4694,6.177],[-77.36,6.5046],[-77.9011,7.2294],[-77.7439,7.537],[-77.3509,7.7057],[-77.2124,8.0338],[-77.3742,8.6583],[-76.8519,8.0906],[-76.8879,8.6197],[-76.2769,8.989],[-76.1355,9.2656],[-75.6394,9.4502],[-75.671,10.1964],[-75.4459,10.611],[-74.8446,11.1095],[-74.4542,10.9892],[-74.0592,11.3408],[-73.3134,11.2959],[-72.722,11.7123],[-72.275,11.8894],[-72.1358,12.1886],[-71.7145,12.4199],[-71.2622,12.3351],[-71.3197,11.8619]]]},properties:{name:"Colombia",id:"CO"},id:"CO"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-159.7406,-21.2494],[-159.8395,-21.2383],[-159.832,-21.2005],[-159.7683,-21.1885],[-159.7406,-21.2494]]]},properties:{name:"Cook Islands",id:"CK"},id:"CK"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[18.6102,3.4785],[18.4908,2.9246],[18.0722,2.0133],[18.058,1.5347],[17.9026,1.1179],[17.8875,.2341],[17.7242,-.2777],[17.753,-.5489],[17.2789,-.9994],[16.8799,-1.2258],[16.5407,-1.8402],[16.2154,-2.178],[16.2171,-3.0302],[16.1466,-3.4639],[15.8722,-3.9345],[15.6001,-4.0308],[14.7794,-4.8458],[14.4105,-4.8311],[14.3581,-4.2993],[13.4149,-4.8373],[13.0726,-4.6349],[12.8809,-4.4454],[12.3846,-4.6189],[12.0184,-5.0042],[11.7773,-4.5657],[11.1301,-3.9163],[11.5043,-3.5203],[11.934,-3.3188],[11.5376,-2.8367],[11.5754,-2.3973],[12.4463,-2.3298],[12.4321,-1.929],[12.7934,-1.9316],[12.9918,-2.3134],[13.465,-2.3955],[13.7842,-2.1638],[14.0874,-2.4669],[14.3839,-1.8899],[14.4806,-.6181],[13.8601,-.2035],[13.8845,.1906],[14.0874,.5364],[14.4345,.8116],[14.181,1.3701],[13.8512,1.4189],[13.2741,1.2409],[13.1627,1.6479],[13.2937,2.1615],[14.4842,2.1549],[14.9023,2.0124],[15.7417,1.9152],[16.0596,1.6763],[16.1834,2.2703],[16.4684,2.8318],[16.6735,3.5354],[17.4379,3.6845],[18.161,3.4998],[18.6102,3.4785]]]},properties:{name:"Republic of Congo",id:"CG"},id:"CG"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[27.4032,5.1094],[27.7881,4.6446],[28.192,4.3503],[28.7269,4.5048],[29.1513,4.3881],[29.6768,4.5869],[30.1949,3.9819],[30.5083,3.8359],[30.8385,3.4905],[30.7284,2.4554],[31.1763,2.2703],[31.2527,2.0448],[30.9424,1.683],[29.9427,.8192],[29.9343,.4991],[29.7177,.0983],[29.5619,-.9772],[29.577,-1.3878],[29.1295,-1.8601],[29.1064,-2.2335],[28.8765,-2.4004],[29.0146,-2.7204],[29.2245,-3.0533],[29.2232,-3.9109],[29.4034,-4.4494],[29.3426,-4.9829],[29.5943,-5.651],[29.4802,-6.0252],[29.7097,-6.6169],[30.3134,-7.2037],[30.7511,-8.1936],[28.9724,-8.4648],[28.9178,-8.7005],[28.4007,-9.2248],[28.6301,-9.8311],[28.639,-10.6692],[28.3572,-11.4828],[28.4823,-11.8122],[29.0643,-12.3489],[29.4274,-12.4314],[29.7954,-12.1553],[29.7954,-13.3929],[29.5543,-13.2491],[29.0141,-13.3689],[28.3576,-12.482],[27.5333,-12.1953],[27.0459,-11.616],[26.9496,-11.8988],[26.5962,-11.972],[26.0258,-11.8903],[25.3493,-11.6231],[25.1847,-11.2431],[24.5184,-11.4384],[24.32,-11.0718],[23.9666,-10.8716],[23.8339,-11.0136],[22.5613,-11.0558],[22.3069,-10.6914],[22.1977,-10.0406],[21.8133,-9.4689],[21.9056,-8.6934],[21.7511,-7.3054],[20.6077,-7.2778],[20.4821,-6.9161],[19.8753,-6.9862],[19.5277,-7.1447],[19.3408,-7.9668],[18.6532,-7.9361],[17.536,-8.076],[17.1551,-7.4612],[16.7094,-6.4717],[16.7179,-6.2414],[16.3152,-5.8658],[14.3985,-5.8925],[13.0682,-5.8649],[12.4117,-5.9866],[12.2137,-5.7589],[12.5035,-5.6958],[12.5222,-5.1489],[12.8298,-4.7366],[13.0726,-4.6349],[13.4149,-4.8373],[14.3581,-4.2993],[14.4105,-4.8311],[14.7794,-4.8458],[15.6001,-4.0308],[15.8722,-3.9345],[16.1466,-3.4639],[16.2171,-3.0302],[16.2154,-2.178],[16.5407,-1.8402],[16.8799,-1.2258],[17.2789,-.9994],[17.753,-.5489],[17.7242,-.2777],[17.8875,.2341],[17.9026,1.1179],[18.058,1.5347],[18.0722,2.0133],[18.4908,2.9246],[18.6102,3.4785],[18.5676,4.2576],[19.0687,4.8915],[19.5011,5.1276],[19.8065,5.0894],[20.2264,4.8297],[20.558,4.4627],[21.5376,4.2447],[22.4223,4.1351],[22.7557,4.6469],[23.4171,4.6633],[24.32,4.994],[24.7656,4.9301],[25.2495,5.0246],[25.5251,5.3123],[26.8222,5.0623],[27.1151,5.1977],[27.4032,5.1094]]]},properties:{name:"Democratic Republic of Congo",id:"CD"},id:"CD"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[15.4803,7.5237],[15.2459,7.2636],[14.7394,6.2799],[14.6169,5.8649],[14.7088,4.6655],[15.0226,4.3583],[15.1287,3.827],[15.775,3.127],[16.0636,2.9086],[16.1834,2.2703],[16.0596,1.6763],[15.7417,1.9152],[14.9023,2.0124],[14.4842,2.1549],[13.2937,2.1615],[13.2204,2.2565],[11.3485,2.2996],[11.3286,2.1673],[9.98,2.1677],[9.8007,2.3044],[9.8762,3.3099],[9.4252,3.9224],[8.9999,4.0916],[8.9027,4.4351],[8.556,4.7552],[8.801,5.1973],[9.0603,6.0092],[10.1438,6.9964],[10.6064,7.063],[11.0325,6.6981],[11.1532,6.438],[11.5518,6.6972],[11.7676,7.272],[12.0162,7.5899],[12.4037,8.5957],[12.8067,8.8865],[12.9297,9.4263],[13.1756,9.5394],[13.2697,10.0362],[13.5352,10.6052],[13.892,11.1401],[14.5597,11.4921],[14.6271,12.1087],[14.1974,12.3839],[14.0638,13.0786],[14.5162,12.9796],[14.7612,12.6556],[15.0812,11.8455],[15.0297,11.1135],[15.1323,10.6483],[15.5411,9.9603],[14.2432,9.9798],[13.9773,9.6917],[14.3324,9.2034],[15.1163,8.5571],[15.443,7.8518],[15.4803,7.5237]]]},properties:{name:"Cameroon",id:"CM"},id:"CM"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-5.5236,10.4259],[-5.0999,10.2417],[-4.9698,9.9301],[-4.6258,9.7134],[-3.8776,9.895],[-3.2235,9.8954],[-2.6958,9.4813],[-2.7466,9.1098],[-2.5058,8.2087],[-2.7899,7.9321],[-2.9858,7.205],[-3.2358,6.8073],[-3.2007,6.3483],[-2.7952,5.1844],[-3.0191,5.1307],[-4.0372,5.2301],[-5.5646,5.0894],[-6.9229,4.6384],[-7.5451,4.3512],[-7.5688,5.0805],[-7.4299,5.3247],[-7.4543,5.8414],[-7.7965,5.975],[-7.8886,6.2347],[-8.6035,6.5077],[-8.3325,6.8015],[-8.2966,7.0741],[-8.4863,7.5584],[-8.232,7.5566],[-7.8236,8.4674],[-7.951,8.7866],[-7.8962,9.416],[-8.137,9.4955],[-8.1365,10.022],[-7.9907,10.1627],[-7.6611,10.4272],[-7.1049,10.2035],[-6.6932,10.3495],[-6.2611,10.7242],[-6.0345,10.1946],[-5.5236,10.4259]]]},properties:{name:"Cte d'Ivoire",id:"CI"},id:"CI"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[110.8887,19.9918],[111.0138,19.6553],[110.5722,19.1719],[110.4514,18.748],[109.5193,18.2184],[108.7016,18.5354],[108.6936,19.3384],[109.6511,19.9842],[110.5886,20.0726],[110.8887,19.9918]]],[[[130.5269,42.5353],[130.2406,42.8917],[129.8983,42.9983],[129.7199,42.4749],[129.3137,42.4137],[128.9236,42.0381],[128.0451,41.9875],[128.291,41.5627],[128.1112,41.3891],[127.1795,41.5312],[126.9034,41.7811],[125.989,40.9049],[124.8895,40.4596],[124.3621,40.0042],[124.1056,39.8409],[123.3483,39.7632],[122.3349,39.3663],[121.6499,38.8652],[121.7853,39.401],[121.5177,39.6389],[122.2749,40.5418],[121.859,40.8423],[121.1745,40.9013],[120.479,40.231],[119.5912,39.9026],[118.9125,39.1666],[118.2977,39.0671],[117.7845,39.1346],[117.5577,38.625],[118.0149,38.1834],[118.94,38.0426],[119.0891,37.7008],[118.9529,37.3311],[119.45,37.1247],[120.3702,37.7008],[120.7502,37.834],[121.6402,37.4603],[122.6025,37.4265],[122.5195,36.9467],[121.9327,36.9595],[120.9899,36.5978],[120.3933,36.054],[120.0546,35.8614],[119.2156,35.0118],[119.5827,34.5821],[120.2015,34.3255],[120.8709,33.0165],[120.8532,32.6613],[121.4009,32.3719],[121.3521,31.8588],[121.0556,31.7194],[121.6606,31.3199],[121.8781,30.9168],[120.9974,30.5582],[121.1594,30.3016],[121.9442,29.8941],[121.7174,29.2562],[121.602,28.3667],[121.0986,28.2903],[120.2788,27.0972],[119.6484,25.9186],[119.5392,25.5915],[119.0248,25.2235],[118.5605,24.5803],[118.0873,24.6269],[118.0562,24.246],[116.5381,23.1798],[116.4706,22.9459],[115.4985,22.719],[115.1957,22.8171],[114.854,22.6169],[114.2658,22.541],[114.0154,22.5117],[113.6195,22.8615],[113.5467,22.2241],[113.4943,22.2414],[113.4788,22.1957],[113.0083,22.1193],[112.5861,21.7767],[111.9438,21.8495],[111.6029,21.5592],[110.771,21.3865],[110.1935,21.0376],[110.5114,20.5182],[110.123,20.2639],[109.6626,20.9168],[109.9307,21.4806],[109.5441,21.5378],[109.1486,21.4255],[109.0305,21.6266],[108.3247,21.6937],[107.9727,21.5081],[107.3513,21.6089],[106.7294,22.0004],[106.5363,22.3954],[106.7804,22.779],[106.5421,22.9081],[105.8429,22.9228],[105.2752,23.3454],[104.8646,23.1363],[104.7958,22.9112],[104.3719,22.704],[103.3008,22.7643],[103.0051,22.4532],[102.5173,22.7408],[102.1276,22.379],[101.6712,22.4625],[101.5243,22.2538],[101.744,21.778],[101.705,21.1503],[101.2242,21.2236],[101.139,21.5676],[100.2148,21.4628],[99.9179,22.0279],[99.193,22.126],[99.3377,22.498],[99.3408,23.0959],[98.8636,23.1913],[98.7642,24.116],[98.2124,24.1106],[97.686,23.898],[97.5315,24.4915],[97.8196,25.2519],[98.0109,25.2923],[98.6546,25.9177],[98.7318,26.5836],[98.651,27.5726],[98.299,27.5499],[98.0988,28.1421],[97.5377,28.5101],[97.3224,28.218],[96.776,28.3671],[96.4355,29.0507],[96.0352,29.4471],[95.4204,29.0543],[94.7696,29.1759],[94.6231,29.3126],[93.9022,28.803],[93.2067,28.5909],[92.702,28.147],[92.6642,27.949],[91.9775,27.7301],[91.6317,27.7599],[91.6056,27.9516],[90.3529,28.0804],[89.9809,28.3112],[89.537,28.1075],[88.8912,27.316],[88.8485,27.8686],[88.6213,28.0919],[88.1099,27.8704],[87.1413,27.8385],[86.5545,28.0853],[86.4089,27.9286],[85.6783,28.2775],[85.1225,28.3161],[85.1589,28.5922],[84.7141,28.5957],[84.2285,28.9118],[84.1016,29.2198],[83.5835,29.1834],[83.1556,29.6127],[82.8542,29.6833],[82.1591,30.1152],[82.0432,30.3269],[81.4169,30.3376],[81.0103,30.1645],[80.6823,30.4148],[80.1913,30.5684],[79.9245,30.8889],[79.9165,30.8942],[79.3697,31.0798],[79.3386,31.1055],[79.1073,31.4025],[78.8445,31.3017],[78.7198,31.8876],[78.3896,32.5197],[79.2192,32.5011],[79.2165,32.5641],[79.1353,33.1718],[79.1127,33.2264],[78.8019,33.4999],[78.7531,34.0876],[78.9364,34.3521],[78.2821,34.654],[77.8107,35.4845],[77.7992,35.496],[77.4467,35.4756],[76.2518,35.8108],[75.945,36.0176],[75.8403,36.6497],[75.3467,36.9134],[74.5415,37.0221],[74.8912,37.2317],[74.7452,38.5101],[74.2773,38.6597],[73.8015,38.6068],[73.6315,39.4489],[73.9147,39.6065],[73.9915,40.0433],[74.4118,40.1374],[75.0044,40.4494],[75.5837,40.6052],[75.8718,40.3034],[76.4804,40.4494],[76.8239,40.9821],[78.1232,41.0758],[78.3625,41.3718],[79.2938,41.7829],[80.2162,42.0323],[80.2095,42.1899],[80.1651,42.6653],[80.7857,43.1616],[80.3551,44.0973],[80.4554,44.7463],[80.059,45.0064],[81.602,45.3109],[82.4787,45.1236],[82.3264,45.52],[83.0043,47.0337],[83.1929,47.1864],[84.786,46.8308],[85.6565,47.2547],[85.526,47.9157],[85.7493,48.3849],[86.5496,48.5287],[86.7534,49.0088],[87.3229,49.0858],[87.8143,49.1624],[87.9798,48.5549],[88.517,48.3844],[89.0478,48.0027],[89.561,48.004],[90.3134,47.676],[90.4963,47.2854],[90.87,46.9547],[91.0338,46.529],[91.0019,46.0358],[90.6618,45.5253],[90.8771,45.196],[91.5842,45.0766],[92.7876,45.0357],[93.6563,44.9008],[94.7119,44.3508],[95.3502,44.278],[95.9126,43.2064],[96.3854,42.7204],[97.2057,42.7896],[99.4678,42.5681],[99.984,42.6773],[101.7139,42.4656],[101.9731,42.2157],[103.0726,42.0062],[103.7109,41.7514],[104.4984,41.877],[104.4984,41.6586],[105.1971,41.738],[106.7702,42.2889],[108.1712,42.4474],[109.4434,42.4558],[110.4004,42.7736],[111.0072,43.3414],[111.9331,43.7116],[111.4022,44.3672],[111.8981,45.0641],[113.5871,44.7459],[114.0305,44.9425],[114.517,45.3646],[115.6809,45.4583],[116.2407,45.7961],[116.5625,46.2897],[117.3335,46.3621],[118.3088,46.7172],[119.7066,46.6062],[119.8979,46.8579],[119.711,47.15],[118.4983,47.9841],[117.7685,47.988],[117.3508,47.652],[116.7605,47.87],[115.8984,47.6871],[115.5575,47.945],[116.6832,49.8238],[117.8733,49.5135],[118.4517,49.8444],[119.26,50.0664],[119.1921,50.3797],[120.067,51.6007],[120.7497,52.0965],[120.6561,52.5666],[120.0945,52.7872],[120.704,53.1718],[122.338,53.485],[123.6079,53.5465],[124.8122,53.1339],[125.649,53.0422],[126.313,52.3997],[126.9247,51.1002],[127.5901,50.2091],[127.5027,49.8735],[127.9998,49.5685],[128.5267,49.5943],[129.5339,49.3235],[130.1962,48.8916],[130.8043,48.3414],[130.712,48.1279],[131.0027,47.6915],[132.5617,47.7683],[133.1441,48.1057],[133.4686,48.0972],[134.2933,48.3733],[134.5636,48.3219],[134.7523,47.7155],[134.1677,47.3022],[133.8614,46.2475],[133.1858,45.4947],[132.9359,45.03],[131.9775,45.2439],[131.0822,44.9101],[131.2553,44.0716],[131.262,43.4333],[131.0684,42.9024],[130.5771,42.8118],[130.5269,42.5353]]]]},properties:{name:"China",id:"CN"},id:"CN"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-67.0799,-55.1538],[-68.07,-55.2213],[-68.107,-54.9292],[-67.2452,-54.9776],[-67.0799,-55.1538]]],[[[-69.703,-54.919],[-68.9007,-55.0176],[-68.2826,-55.255],[-68.2932,-55.5214],[-69.4119,-55.4441],[-69.9798,-55.1476],[-69.703,-54.919]]],[[[-72.9233,-53.4817],[-72.2055,-53.8075],[-73.3048,-53.9438],[-73.6865,-53.4266],[-72.9233,-53.4817]]],[[[-68.6299,-52.6525],[-68.6532,-54.8538],[-69.4862,-54.8591],[-69.7235,-54.7122],[-70.4972,-54.8094],[-71.4409,-54.6198],[-70.8982,-54.338],[-70.8678,-53.8843],[-70.0903,-53.4182],[-70.3906,-53.0263],[-69.7636,-52.7315],[-68.6299,-52.6525]]],[[[-74.4762,-49.148],[-74.5699,-49.9909],[-75.3001,-49.8475],[-75.1842,-49.0836],[-74.7934,-48.705],[-74.4762,-49.148]]],[[[-74.5672,-48.5918],[-74.923,-48.6264],[-75.2129,-48.1417],[-74.7292,-48.1261],[-74.5672,-48.5918]]],[[[-72.9861,-44.7801],[-73.4451,-44.6411],[-73.2078,-44.3348],[-72.7641,-44.5488],[-72.9861,-44.7801]]],[[[-73.7354,-44.3948],[-73.9833,-44.4946],[-73.7271,-45.1192],[-74.0991,-45.3252],[-74.6178,-44.6478],[-74.5017,-44.4733],[-73.7354,-44.3948]]],[[[-73.7733,-43.3459],[-74.355,-43.2637],[-74.2094,-42.8789],[-74.0368,-41.7953],[-73.5278,-41.8961],[-73.4708,-42.4665],[-73.7893,-42.5859],[-73.4364,-42.9366],[-73.7733,-43.3459]]],[[[-67.1948,-22.8216],[-67.0088,-23.0014],[-67.3562,-24.0339],[-68.2502,-24.3921],[-68.562,-24.8378],[-68.3842,-25.0921],[-68.6002,-25.4859],[-68.4144,-26.1539],[-68.5811,-26.5183],[-68.3461,-27.0279],[-68.8463,-27.1536],[-69.1744,-27.9246],[-69.6569,-28.4138],[-69.8278,-29.1031],[-70.0269,-29.3242],[-69.9277,-29.7694],[-69.9563,-30.358],[-70.1614,-30.4401],[-70.5196,-31.1486],[-70.5853,-31.5694],[-70.1696,-32.4718],[-70.0198,-33.2717],[-69.7978,-33.3987],[-69.8524,-34.2243],[-70.2899,-34.733],[-70.4703,-35.3261],[-70.4048,-36.0616],[-71.0556,-36.5237],[-71.1677,-37.7621],[-71.0281,-38.0413],[-70.9517,-38.7383],[-71.4256,-38.9855],[-71.5394,-39.6025],[-71.7199,-39.6354],[-71.6952,-40.3354],[-71.932,-40.6918],[-71.9114,-41.6506],[-71.7501,-42.0466],[-72.1247,-42.2983],[-72.1464,-42.9899],[-71.7816,-43.167],[-71.905,-43.44],[-71.6801,-43.9296],[-71.82,-44.3832],[-71.2127,-44.4414],[-71.2611,-44.7632],[-71.5962,-44.9794],[-71.3537,-45.2306],[-71.7727,-45.7242],[-71.8757,-46.1606],[-71.6952,-46.5783],[-71.9403,-46.8313],[-71.905,-47.2015],[-72.346,-47.4927],[-72.518,-47.8762],[-72.3549,-48.3658],[-72.6143,-48.7929],[-73.5762,-49.583],[-73.5012,-50.1254],[-73.153,-50.7384],[-72.5098,-50.6075],[-72.2763,-50.9102],[-72.4077,-51.541],[-71.9187,-51.9898],[-69.9603,-52.0084],[-68.4433,-52.3569],[-69.241,-52.2055],[-69.5606,-52.4217],[-70.795,-52.7688],[-70.9959,-53.7791],[-71.2977,-53.8834],[-72.1744,-53.6322],[-71.8528,-53.2855],[-71.4003,-53.107],[-71.3878,-52.7644],[-72.4583,-53.2544],[-73.0527,-53.2433],[-74.0143,-52.6392],[-73.5183,-52.0408],[-73.9733,-51.7847],[-73.8958,-51.3315],[-74.8147,-51.0629],[-75.0948,-50.6812],[-74.3337,-49.9745],[-74.3411,-48.5958],[-74.5772,-48.2744],[-74.6549,-47.7022],[-74.1584,-47.1824],[-74.152,-46.9742],[-75.6567,-46.6102],[-74.9245,-46.1597],[-75.0666,-45.8751],[-74.1579,-45.7673],[-74.0377,-45.4175],[-73.5498,-45.4836],[-73.3625,-44.978],[-72.739,-44.7343],[-72.6638,-44.4365],[-73.2651,-44.1688],[-72.9965,-43.6317],[-72.7852,-42.3014],[-72.4993,-41.9809],[-72.6698,-41.6595],[-73.0149,-41.5441],[-73.5214,-41.7971],[-73.966,-41.1184],[-73.6694,-40.0824],[-73.4104,-39.7889],[-73.2264,-39.2243],[-73.5325,-38.3667],[-73.4648,-38.0405],[-73.6619,-37.6987],[-73.6017,-37.1886],[-73.216,-37.1669],[-73.1181,-36.6884],[-72.8747,-36.3905],[-72.6239,-35.5857],[-72.2237,-35.0961],[-72.0029,-34.1653],[-71.6644,-33.6526],[-71.743,-33.0951],[-71.4522,-32.6596],[-71.5259,-31.806],[-71.6619,-31.1695],[-71.6695,-30.3305],[-71.4005,-30.1432],[-71.3157,-29.6496],[-71.5192,-28.9265],[-71.1863,-28.3778],[-71.0527,-27.7275],[-70.6465,-26.3293],[-70.7138,-25.7842],[-70.4455,-25.1725],[-70.5742,-24.6442],[-70.4878,-23.7818],[-70.5633,-23.0569],[-70.3316,-22.8487],[-70.0875,-21.493],[-70.1971,-20.7256],[-70.1483,-19.8049],[-70.4184,-18.3454],[-69.9263,-18.206],[-69.8522,-17.704],[-69.5108,-17.506],[-69.3133,-17.9432],[-69.094,-18.0507],[-68.9684,-18.9682],[-68.4628,-19.4329],[-68.6983,-19.721],[-68.7451,-20.4588],[-68.4999,-20.6119],[-68.1969,-21.3004],[-67.9883,-22.0572],[-67.8795,-22.8229],[-67.1948,-22.8216]]]]},properties:{name:"Chile",id:"CL"},id:"CL"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[9.5241,47.5242],[9.5277,47.2707],[9.4877,47.0621],[9.5801,47.0572],[10.4528,46.865],[9.9392,46.3616],[9.2512,46.2866],[8.9537,45.8298],[8.4584,46.2458],[7.9932,46.0158],[7.021,45.9257],[6.7583,46.4158],[6.06,46.4282],[7.0006,47.3227],[7.6154,47.5925],[8.6177,47.7661],[9.5241,47.5242]]]},properties:{name:"Switzerland",id:"CH"},id:"CH"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[96.8404,-12.182],[96.835,-12.1797],[96.8279,-12.1509],[96.8257,-12.126],[96.8328,-12.126],[96.8395,-12.1602],[96.8404,-12.182]]]},properties:{name:"Cocos (Keeling) Islands",id:"CC"},id:"CC"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-105.289,72.9199],[-106.9216,73.4799],[-105.5123,73.7657],[-104.583,73.3538],[-105.289,72.9199]]],[[[-79.5373,73.6546],[-77.2066,73.4996],[-76.2895,73.081],[-76.4005,72.8207],[-77.836,72.8968],[-79.5006,72.7559],[-80.8241,73.3807],[-80.849,73.7211],[-79.5373,73.6546]]],[[[-86.5894,71.0107],[-84.7896,71.0933],[-84.6995,71.6315],[-85.9115,71.9866],[-85.3411,72.4216],[-85.6445,72.7745],[-85.0184,73.3356],[-82.6596,73.7296],[-81.406,73.6346],[-80.2748,72.7455],[-80.9413,72.2101],[-78.453,72.4352],[-77.7532,72.7248],[-75.2943,72.4809],[-74.9032,72.1005],[-73.7136,71.7198],[-71.6406,71.5163],[-70.7926,71.1033],[-70.5609,70.7382],[-69.1686,70.7641],[-67.3637,70.0344],[-66.6852,69.2858],[-67.7517,69.0387],[-68.038,68.5507],[-67.033,68.3261],[-66.2252,67.9588],[-64.5275,67.8127],[-64.0079,67.3473],[-61.9684,67.019],[-61.2997,66.6488],[-61.9915,66.0354],[-62.6589,65.6399],[-63.3643,65.5433],[-63.4018,65.1185],[-64.6653,65.1689],[-65.4015,65.7639],[-65.3054,66.0085],[-66.4771,66.2797],[-67.1833,66.0345],[-68.2568,65.9386],[-67.3034,65.4829],[-66.8606,65.0917],[-65.2748,64.6316],[-64.6784,64.0281],[-64.5144,63.2639],[-65.0688,63.2635],[-65.2659,62.7151],[-65.9788,63.0007],[-67.676,63.0935],[-66.2813,62.3027],[-66.2567,61.8683],[-67.4401,62.1513],[-69.0823,62.4052],[-69.5452,62.7446],[-70.2362,62.7634],[-71.2538,63.0424],[-73.4437,64.4236],[-74.5124,64.6702],[-75.0675,64.4567],[-76.7239,64.242],[-77.7912,64.367],[-78.0957,64.9392],[-77.4474,65.1616],[-77.3267,65.4532],[-75.8283,65.227],[-73.5607,65.5429],[-74.434,66.139],[-73.0333,66.7283],[-72.2201,67.2543],[-73.3283,68.2668],[-74.648,68.7076],[-74.9172,68.9828],[-76.4034,68.6923],[-75.7873,69.3186],[-77.1289,69.6526],[-78.9797,70.5813],[-79.3475,70.3722],[-78.7778,70.0477],[-79.3033,69.8948],[-81.0982,70.0912],[-82.1387,69.8413],[-86.3219,70.1454],[-86.6244,70.4013],[-87.9006,70.2519],[-88.8483,70.5229],[-89.3655,71.0671],[-88.0387,70.9512],[-87.8724,71.2085],[-89.0794,71.2879],[-89.8458,71.4924],[-90.0251,71.9489],[-89.2631,73.0691],[-87.7197,73.7229],[-85.1105,73.8081],[-86.6293,72.8709],[-86.0361,71.7709],[-85.0233,71.3532],[-86.5894,71.0107]]],[[[-100.002,73.946],[-99.1579,73.7316],[-97.5819,73.8876],[-97.0017,73.6665],[-97.7959,73.2852],[-97.0519,72.6367],[-96.6133,71.8339],[-98.663,71.3021],[-99.167,71.3672],[-100.5944,72.1524],[-101.7239,72.3149],[-102.7137,72.783],[-100.4847,72.773],[-100.2828,73.1203],[-101.4509,73.4311],[-100.9151,73.8053],[-100.002,73.946]]],[[[-93.171,74.161],[-92.2228,73.9724],[-90.3547,73.8687],[-92.118,72.7539],[-93.3407,72.8018],[-94.0377,72.0288],[-95.1929,72.0275],[-95.5475,72.7816],[-95.633,73.6954],[-95.0397,74.0239],[-93.171,74.161]]],[[[-119.7363,74.1126],[-117.5149,74.2318],[-115.5107,73.6188],[-115.4468,73.4388],[-118.9615,72.6842],[-120.18,72.2126],[-120.6192,71.5057],[-123.2107,71.1235],[-124.0077,71.6775],[-125.7626,72.1375],[-124.9871,72.5881],[-124.8364,73.0762],[-123.7973,73.7682],[-124.6962,74.3481],[-121.3153,74.5299],[-119.7363,74.1126]]],[[[-93.5427,75.028],[-93.5472,74.691],[-94.6973,74.6422],[-96.5658,75.0988],[-95.6707,75.5287],[-94.4272,75.5935],[-93.5427,75.028]]],[[[-102.2275,76.0149],[-103.3148,75.7641],[-104.3506,76.1823],[-102.5841,76.2817],[-102.2275,76.0149]]],[[[-97.7009,76.4664],[-97.4097,75.5522],[-97.7994,75.1167],[-100.2344,75.0078],[-100.712,75.4064],[-102.5413,75.5136],[-101.4313,75.9919],[-102.1378,76.2848],[-100.388,76.6135],[-97.7009,76.4664]]],[[[-108.2924,76.0571],[-105.481,75.7457],[-105.8625,75.1915],[-107.1533,74.9272],[-108.8312,75.0648],[-110.9408,74.6387],[-112.5193,74.4169],[-113.5141,74.43],[-114.4518,75.0879],[-115.7289,74.9682],[-117.6001,75.2716],[-116.6098,76.0738],[-115.5806,76.4375],[-114.1939,76.4515],[-112.6975,76.2016],[-111.0527,75.5484],[-109.0865,75.5065],[-108.9449,75.6989],[-110.2701,76.4169],[-108.467,76.7376],[-108.2924,76.0571]]],[[[-94.2949,76.9125],[-92.7162,76.6029],[-91.3051,76.6808],[-90.2515,76.0536],[-88.2014,75.512],[-86.0687,75.5023],[-83.932,75.819],[-82.1538,75.831],[-79.6602,75.4494],[-79.508,74.8801],[-80.2777,74.5816],[-81.8089,74.4766],[-88.4231,74.4942],[-89.8444,74.5485],[-91.9616,74.7931],[-92.4281,75.3828],[-92.1851,75.8465],[-93.0917,76.3541],[-95.2739,76.2644],[-96.6397,76.703],[-95.6383,77.0639],[-94.2949,76.9125]]],[[[-115.5513,77.3633],[-116.2205,76.6111],[-119.3679,76.2218],[-119.9128,75.8589],[-121.9083,76.0347],[-121.6138,76.4415],[-119.0903,77.3051],[-115.5513,77.3633]]],[[[-95.4843,77.7921],[-93.301,77.7399],[-93.5196,77.4745],[-95.987,77.484],[-95.4843,77.7921]]],[[[-110.4581,78.1032],[-109.7718,77.9574],[-110.1984,77.5246],[-111.952,77.3442],[-113.1643,77.5302],[-113.1872,77.9124],[-110.4581,78.1032]]],[[[-109.816,78.6503],[-109.3905,78.3367],[-113.1499,78.4084],[-110.4077,78.7566],[-109.816,78.6503]]],[[[-96.2045,78.5314],[-94.8873,78.3452],[-95.087,77.9927],[-96.9895,77.8061],[-98.2548,78.4293],[-96.2045,78.5314]]],[[[-103.426,79.3157],[-99.6094,78.5831],[-99.1664,77.8569],[-100.5859,77.8917],[-101.0742,78.1938],[-102.7313,78.3711],[-103.5183,78.7691],[-105.5358,79.0325],[-105.3877,79.3235],[-103.426,79.3157]]],[[[-91.8857,81.1328],[-90.643,80.5937],[-87.6749,80.3722],[-87.1442,79.6626],[-85.5014,79.5303],[-85.2899,79.2083],[-87.0164,78.8987],[-88.7911,78.1925],[-90.6144,78.1498],[-92.6782,78.3891],[-95.1032,79.29],[-95.297,79.6531],[-96.7734,80.1358],[-95.6146,80.3962],[-96.1328,80.6913],[-95.2697,81.0007],[-91.8857,81.1328]]],[[[-69.4889,83.0169],[-63.641,82.8127],[-61.4771,82.4674],[-62.1766,82.0434],[-64.5741,81.7336],[-65.4839,81.2848],[-70.1434,80.3977],[-71.3878,79.7618],[-75.2595,79.4209],[-76.2558,79.0068],[-74.4332,78.724],[-75.866,78.0098],[-78.0127,77.9461],[-78.0762,77.5191],[-79.3408,77.1584],[-78.2888,76.978],[-78.2844,76.5711],[-80.6903,76.1765],[-81.1708,76.5128],[-83.8856,76.4531],[-85.1412,76.3046],[-89.5701,76.4919],[-89.4997,76.8268],[-88.3982,77.104],[-86.8737,77.2004],[-88.0946,77.7193],[-87.0179,77.8922],[-87.5517,78.1767],[-86.808,78.7744],[-84.3162,78.9753],[-85.0899,79.6122],[-86.4207,79.8453],[-86.3073,80.3194],[-83.7236,80.229],[-80.0511,80.5287],[-83.4013,80.714],[-85.3074,80.526],[-88.9214,80.8057],[-89.9474,81.1725],[-88.9784,81.5414],[-90.4903,81.8772],[-86.5807,82.1873],[-82.1225,82.6019],[-79.8864,82.9386],[-69.97,83.1161],[-69.4889,83.0169]]],[[[-61.1053,45.9448],[-60.8061,45.738],[-60.5049,46.204],[-59.8651,46.1597],[-60.3862,45.6545],[-61.2837,45.5737],[-61.4953,45.9413],[-60.8703,46.7966],[-60.3318,46.7678],[-60.5768,46.1721],[-61.1053,45.9448]]],[[[-63.8113,46.4686],[-63.1294,46.422],[-62.1635,46.4872],[-62.8784,46.0012],[-63.641,46.2307],[-63.8113,46.4686]]],[[[-74.7088,45.0038],[-73.558,45.425],[-73.1596,46.0101],[-71.901,46.632],[-71.2611,46.7562],[-70.5196,47.0323],[-68.987,48.2748],[-67.5608,48.8559],[-66.1781,49.2132],[-64.8364,49.1917],[-64.2618,48.9218],[-64.2538,48.5505],[-65.2595,48.0213],[-65.9266,48.1887],[-65.6665,47.696],[-65.2282,47.8114],[-64.7033,47.7248],[-64.9121,47.3688],[-65.3189,47.1012],[-64.9057,46.8881],[-64.5415,46.2404],[-63.2928,45.7522],[-62.4831,45.6217],[-61.9556,45.868],[-61.4924,45.6869],[-61.2837,45.2355],[-63.7611,44.4862],[-64.286,44.5501],[-64.8624,43.8678],[-65.7382,43.5607],[-66.1257,43.8137],[-66.0995,44.3677],[-65.6567,44.7605],[-64.4489,45.2559],[-64.8979,45.6261],[-65.8845,45.223],[-66.8726,45.0672],[-67.1249,45.1693],[-67.4725,45.2759],[-67.4328,45.603],[-67.7845,45.7016],[-67.8067,47.083],[-68.311,47.3546],[-68.8288,47.2032],[-69.243,47.4629],[-70.0078,46.7088],[-70.2963,45.9062],[-70.898,45.2626],[-71.3272,45.2901],[-71.5175,45.0078],[-74.7088,45.0038]]],[[[-61.8011,49.094],[-62.2195,49.0791],[-63.5658,49.3994],[-64.1315,49.9416],[-62.8584,49.7055],[-61.8171,49.2835],[-61.8011,49.094]]],[[[-127.1973,50.6403],[-125.4821,50.3167],[-124.6429,49.4287],[-123.9959,49.2241],[-123.497,48.582],[-123.5946,48.3334],[-124.6893,48.5975],[-125.8285,49.0918],[-125.8354,49.2767],[-126.5485,49.4189],[-126.683,49.8764],[-127.1143,49.8797],[-128.2675,50.6092],[-127.9182,50.8605],[-127.1973,50.6403]]],[[[-55.4588,51.5365],[-55.8714,50.9073],[-56.6939,50.0597],[-55.7648,49.9605],[-55.892,49.5803],[-54.9827,49.268],[-54.579,49.4908],[-53.9577,49.4418],[-53.5733,49.1413],[-53.853,48.8112],[-53.5312,48.2317],[-52.955,48.0293],[-53.1756,47.6529],[-52.6536,47.5495],[-53.0697,46.6812],[-53.6164,46.6803],[-54.1737,46.8805],[-53.8692,47.387],[-54.8566,47.3848],[-56.2211,47.6716],[-56.9525,47.5743],[-58.3332,47.6769],[-59.1169,47.5708],[-59.3624,47.8655],[-58.7105,48.325],[-58.7165,48.598],[-58.0158,49.5426],[-57.4656,50.4636],[-56.7503,51.2748],[-56.0256,51.5685],[-55.4588,51.5365]]],[[[-80.7318,52.7472],[-81.8391,52.9579],[-81.8473,53.1862],[-81.1357,53.2058],[-80.7318,52.7472]]],[[[-132.6556,54.1275],[-131.7026,53.9864],[-132.0113,53.2653],[-132.7475,53.3105],[-133.0522,53.7782],[-132.6556,54.1275]]],[[[-78.9356,56.2662],[-79.1755,55.8851],[-80.0009,55.9322],[-79.5963,56.2444],[-78.9356,56.2662]]],[[[-79.5452,62.4117],[-79.324,62.0261],[-79.7144,61.6126],[-80.2652,61.8182],[-80.0215,62.3431],[-79.5452,62.4117]]],[[[-82.0004,62.9543],[-82.1138,62.6522],[-83.0158,62.2099],[-83.699,62.1602],[-83.8994,62.4765],[-83.3765,62.905],[-82.0004,62.9543]]],[[[-84.9197,65.261],[-83.4071,65.1039],[-82.0501,64.6442],[-81.7161,64.0219],[-80.829,64.09],[-80.3021,63.7622],[-81.0463,63.4615],[-82.3782,63.7067],[-82.4672,63.9269],[-83.4943,64.0993],[-83.7283,63.8135],[-84.6329,63.3092],[-85.4954,63.1392],[-85.7142,63.6579],[-87.1888,63.6723],[-86.252,64.1368],[-86.3743,64.5659],[-85.9617,65.7042],[-85.241,65.7954],[-84.9197,65.261]]],[[[-75.6758,68.3225],[-75.1538,68.234],[-75.1274,67.5373],[-75.7801,67.2836],[-77.0048,67.2669],[-77.3058,67.7062],[-76.7403,68.2313],[-75.6758,68.3225]]],[[[-97.4394,69.6427],[-96.2999,69.3444],[-95.6856,68.7358],[-96.4016,68.4708],[-97.472,68.5438],[-99.254,68.8632],[-99.5641,69.0341],[-97.4394,69.6427]]],[[[-74.7088,45.0038],[-75.1793,44.8994],[-76.4646,44.0574],[-76.82,43.6286],[-78.7205,43.625],[-79.1719,43.4666],[-79.0368,42.8025],[-80.2475,42.3662],[-81.2778,42.209],[-82.439,41.675],[-83.1419,41.976],[-83.0731,42.3005],[-82.5453,42.6245],[-82.1378,43.5709],[-82.5511,45.3473],[-83.5926,45.817],[-83.9777,46.0851],[-84.1921,46.5494],[-84.5617,46.4575],[-84.8759,46.9001],[-88.3782,48.3032],[-89.4556,47.996],[-90.8403,48.2007],[-91.5183,48.0582],[-92.9963,48.6117],[-93.3778,48.6166],[-93.7078,48.5256],[-94.6209,48.7427],[-95.162,48.9917],[-97.5297,48.9932],[-99.2354,48.993],[-102.2201,48.993],[-103.9256,48.993],[-106.4839,48.993],[-109.895,48.993],[-112.4532,48.993],[-115.8643,48.993],[-118.4226,48.993],[-120.1281,48.993],[-122.7888,48.993],[-123.0491,48.993],[-123.3356,49.4591],[-123.859,49.4829],[-124.4833,49.8082],[-125.21,50.4763],[-126.4045,50.5298],[-126.6318,50.9151],[-127.0577,50.8676],[-127.7082,51.1512],[-127.6449,51.4784],[-128.3576,52.1589],[-128.1088,52.858],[-128.6524,53.2437],[-129.2842,53.3931],[-129.5637,53.2515],[-130.3351,53.724],[-130.0433,54.1335],[-130.4304,54.4209],[-129.6666,55.4366],[-130.0251,55.8882],[-130.4772,56.2307],[-131.5752,56.5989],[-131.8661,56.7929],[-133.8208,58.7049],[-134.9439,59.2882],[-135.4759,59.7934],[-136.3219,59.6049],[-136.5787,59.1522],[-137.4385,58.9031],[-137.5932,59.2263],[-139.1852,60.0837],[-141.0021,60.3003],[-141.0021,63.2222],[-141.0021,65.56],[-141.0021,68.4819],[-141.0021,69.6509],[-139.1815,69.5155],[-138.1283,69.1519],[-136.7174,68.8891],[-135.8763,68.9169],[-135.6914,69.3111],[-135.1409,69.4678],[-133.1632,69.4338],[-130.4985,70.1431],[-128.9715,69.7123],[-127.765,70.2219],[-127.1385,70.2392],[-126.6122,69.7303],[-125.9073,69.4185],[-124.7679,69.99],[-123.6091,69.3774],[-123.0258,69.81],[-120.9624,69.6604],[-120.2925,69.4205],[-118.8687,69.2571],[-118.0953,69.043],[-116.0651,68.8554],[-115.6312,68.9726],[-114.4138,68.6597],[-115.1332,67.8191],[-112.4352,67.6849],[-110.9901,67.7907],[-110.0426,67.9772],[-109.6305,67.7328],[-108.5929,67.591],[-107.6263,67.0031],[-108.2611,68.1498],[-108.3134,68.6108],[-106.1646,68.9198],[-105.4286,68.4584],[-104.1935,68.0311],[-103.4741,68.115],[-102.692,67.8116],[-101.555,67.6931],[-100.4561,67.8396],[-99.1468,67.7237],[-98.4171,67.8265],[-98.2184,68.3174],[-97.2659,68.453],[-96.0361,68.1578],[-96.3714,67.5539],[-95.7826,67.1937],[-95.2588,67.2625],[-95.6505,67.7375],[-93.6517,68.5431],[-93.6814,68.8874],[-94.2707,69.4551],[-96.0503,69.8311],[-96.4924,70.1249],[-96.2265,70.5418],[-96.549,70.8088],[-96.4056,71.2737],[-95.2013,71.9036],[-94.3084,71.7649],[-92.9488,71.2622],[-92.9814,70.8523],[-91.5641,70.1782],[-92.751,69.7139],[-90.8221,69.2904],[-90.4683,68.8638],[-89.0567,69.266],[-88.0413,68.8117],[-87.8103,68.4042],[-88.347,68.2883],[-88.1958,67.7659],[-87.2663,67.1839],[-86.5363,67.5162],[-85.9526,68.0724],[-85.7338,68.6301],[-84.8622,69.074],[-85.3869,69.2318],[-85.5074,69.8453],[-82.6183,69.691],[-82.6421,69.4584],[-81.3286,69.12],[-81.2815,68.6572],[-82.5526,68.4464],[-81.9764,67.862],[-81.2702,67.4598],[-81.4675,67.0699],[-82.6416,66.5876],[-84.4784,66.1794],[-85.6039,66.5683],[-86.6331,66.5314],[-86.0429,66.0225],[-87.2914,65.3549],[-87.9701,65.3489],[-89.7494,65.9359],[-89.9241,65.7804],[-88.974,65.3482],[-87.0275,65.1982],[-87.2805,64.8262],[-88.1057,64.1832],[-88.653,64.0094],[-90.1418,63.9819],[-90.0135,63.8044],[-91.3301,63.5067],[-90.7466,63.3516],[-90.8711,62.9459],[-91.4491,62.8041],[-92.3613,62.8194],[-93.4206,61.7059],[-93.9127,61.4815],[-94.6467,60.4164],[-94.7858,59.9534],[-94.7135,58.9034],[-94.2871,58.716],[-93.2782,58.7564],[-92.249,57.009],[-91.1113,57.2412],[-90.5922,57.2246],[-89.7909,56.9813],[-88.9484,56.8512],[-88.0751,56.4673],[-87.5608,56.0565],[-85.8305,55.6569],[-85.061,55.2856],[-83.9107,55.3147],[-82.5775,55.1487],[-82.2195,54.8136],[-82.4181,54.3559],[-82.1413,53.8177],[-82.2605,52.9612],[-81.5994,52.4325],[-81.6613,52.2938],[-80.6579,51.7582],[-80.368,51.3299],[-79.8362,51.1734],[-79.4975,51.5698],[-78.9777,51.7338],[-78.4917,52.2521],[-78.7238,52.6278],[-79.2418,54.0989],[-79.6655,54.6975],[-77.8911,55.2364],[-77.3249,55.5555],[-76.6504,56.1073],[-76.5729,57.1813],[-77.1569,58.0189],[-78.5152,58.6823],[-77.7606,59.3801],[-77.3118,60.0424],[-77.8715,60.7859],[-77.7362,61.4373],[-78.1372,62.1074],[-78.0682,62.3555],[-77.3724,62.5726],[-74.69,62.1835],[-73.6299,62.4543],[-72.0814,61.7283],[-71.4227,61.159],[-70.2792,61.0687],[-69.6405,60.6898],[-69.7559,60.3886],[-69.682,59.3417],[-69.1735,58.8967],[-68.6981,58.9045],[-67.5697,58.2135],[-66.608,58.5489],[-65.6061,59.1107],[-64.9312,60.2519],[-64.4995,60.2683],[-63.1854,58.8579],[-62.5939,58.4741],[-62.3056,57.9723],[-61.899,57.8613],[-61.851,57.3812],[-61.3337,57.0106],[-61.5146,56.3903],[-59.9303,55.2594],[-58.997,55.1494],[-58.7802,54.8384],[-58.1951,54.8659],[-57.4046,54.5705],[-58.1514,54.3504],[-57.4161,54.1628],[-57.1489,53.8476],[-56.4651,53.7651],[-55.7979,53.212],[-55.8336,52.3104],[-55.6951,52.1378],[-56.976,51.4577],[-58.5103,51.295],[-59.1655,50.7799],[-60.0801,50.2546],[-61.2897,50.202],[-62.7155,50.3016],[-64.868,50.2754],[-65.2686,50.32],[-66.4955,50.2119],[-66.9411,49.9938],[-67.3719,49.3486],[-68.2819,49.1972],[-68.9291,48.829],[-69.775,48.0981],[-69.9055,47.8322],[-70.7058,47.1398],[-71.2678,46.7958],[-71.8797,46.687],[-72.981,46.2098],[-73.974,45.3451],[-74.7088,45.0038]]],[[[-114.5215,72.593],[-113.5001,72.6944],[-112.7537,72.986],[-111.2698,72.7137],[-108.7549,72.551],[-107.72,73.329],[-106.4822,73.1962],[-105.415,72.7883],[-104.3495,71.434],[-104.5697,71.1039],[-103.9535,70.7626],[-100.9732,70.0295],[-100.9351,69.7152],[-102.2343,69.8422],[-102.9197,69.5648],[-101.9756,69.4069],[-101.857,69.0239],[-103.4681,68.8086],[-105.0195,69.0814],[-106.1408,69.1621],[-106.6591,69.4396],[-107.4399,69.0021],[-108.946,68.7598],[-111.3108,68.542],[-113.1277,68.4941],[-113.6941,69.195],[-116.5135,69.4247],[-117.1354,70.1001],[-114.5923,70.3125],[-112.6378,70.2253],[-112.1143,70.4468],[-113.7573,70.6907],[-115.991,70.5864],[-117.587,70.6296],[-118.2642,70.8882],[-117.8141,71.1585],[-118.8683,71.6868],[-118.9447,71.9855],[-118.2136,72.2629],[-118.3745,72.5339],[-117.5517,72.8311],[-114.6382,73.3727],[-114.1091,72.8611],[-114.5215,72.593]]]]},properties:{name:"Canada",id:"CA"},id:"CA"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[22.86,10.9195],[23.2559,10.4579],[23.6461,9.8231],[23.5374,8.8159],[24.1473,8.6654],[24.2915,8.2912],[24.8535,8.1376],[25.2472,7.7244],[25.3809,7.3333],[25.8891,7.0647],[26.3619,6.6355],[26.5141,6.0691],[27.0836,5.777],[27.4032,5.1094],[27.1151,5.1977],[26.8222,5.0623],[25.5251,5.3123],[25.2495,5.0246],[24.7656,4.9301],[24.32,4.994],[23.4171,4.6633],[22.7557,4.6469],[22.4223,4.1351],[21.5376,4.2447],[20.558,4.4627],[20.2264,4.8297],[19.8065,5.0894],[19.5011,5.1276],[19.0687,4.8915],[18.5676,4.2576],[18.6102,3.4785],[18.161,3.4998],[17.4379,3.6845],[16.6735,3.5354],[16.4684,2.8318],[16.1834,2.2703],[16.0636,2.9086],[15.775,3.127],[15.1287,3.827],[15.0226,4.3583],[14.7088,4.6655],[14.6169,5.8649],[14.7394,6.2799],[15.2459,7.2636],[15.4803,7.5237],[15.8452,7.4753],[16.3787,7.6835],[16.7849,7.5508],[17.6496,7.9836],[18.4553,8.032],[19.1087,8.6561],[19.1455,9.0161],[20.3422,9.1271],[20.7733,9.4058],[21.2638,9.9745],[21.7258,10.3664],[21.7063,10.5746],[22.4938,10.9963],[22.86,10.9195]]]},properties:{name:"Central African Republic",id:"CF"},id:"CF"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[5.6938,50.7748],[5.7972,50.7546],[5.9939,50.7504],[6.3645,50.3163],[6.1164,50.1209],[5.744,49.9196],[5.7897,49.5383],[4.8677,49.788],[4.1744,50.2466],[2.8396,50.7118],[2.5249,51.0971],[3.35,51.3776],[3.9023,51.2076],[4.2263,51.3865],[4.5033,51.4746],[5.827,51.1257],[5.6938,50.7748]]]},properties:{name:"Belgium",id:"BE"},id:"BE"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[25.2588,-17.7936],[25.2242,-17.9153],[25.7613,-18.6495],[26.1683,-19.5381],[26.6784,-19.8928],[27.2217,-20.1458],[27.2807,-20.4788],[27.6997,-20.5307],[27.6696,-21.0642],[28.0455,-21.5729],[29.0372,-21.8113],[29.3648,-22.194],[28.8397,-22.4807],[28.2102,-22.6938],[27.8906,-23.0737],[27.1462,-23.5243],[26.835,-24.2407],[26.3974,-24.6136],[25.9122,-24.7477],[25.5837,-25.6062],[24.7483,-25.8174],[23.8938,-25.6008],[23.2662,-25.2666],[22.8786,-25.4579],[22.6403,-26.0714],[22.0907,-26.5801],[21.6464,-26.8544],[20.74,-26.849],[20.6268,-26.4438],[20.7932,-25.9155],[20.3453,-25.03],[19.9805,-24.777],[19.9774,-22],[20.9708,-22],[20.9779,-20.9684],[20.9739,-18.3188],[23.2986,-18.0276],[23.5804,-18.4528],[24.359,-17.9783],[25.2588,-17.7936]]]},properties:{name:"Botswana",id:"BW"},id:"BW"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[91.6317,27.7599],[91.5949,27.5575],[92.0836,27.2907],[91.9984,26.8548],[90.7395,26.7718],[90.3458,26.8903],[89.7638,26.7016],[88.8579,26.9613],[88.8912,27.316],[89.537,28.1075],[89.9809,28.3112],[90.3529,28.0804],[91.6056,27.9516],[91.6317,27.7599]]]},properties:{name:"Bhutan",id:"BT"},id:"BT"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[115.0266,4.8999],[114.7465,4.7179],[114.8402,4.3934],[114.6085,4.0241],[114.0638,4.5927],[114.2995,4.6074],[115.0266,4.8999],[115.1398,4.8999],[115.0266,4.8999]]]},properties:{name:"Brunei",id:"BN"},id:"BN"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-59.4933,13.0822],[-59.6114,13.1021],[-59.5916,13.3179],[-59.4276,13.1527],[-59.4933,13.0822]]]},properties:{name:"Barbados",id:"BB"},id:"BB"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-51.8326,-1.4336],[-51.5461,-.6497],[-51.1608,-.6665],[-51.2764,-1.0216],[-51.8326,-1.4336]]],[[[-49.6287,-.2293],[-49.1169,-.1636],[-48.3798,-.3527],[-48.5396,-.801],[-48.9289,-1.4824],[-49.5878,-1.7123],[-50.5076,-1.7878],[-50.7597,-1.2405],[-50.7713,-.6452],[-50.6454,-.2728],[-50.2481,-.1165],[-49.6287,-.2293]]],[[[-56.4828,1.9422],[-56.0198,1.8424],[-56.1295,2.2996],[-55.0058,2.593],[-54.6163,2.3266],[-54.13,2.1211],[-53.7678,2.3551],[-52.9648,2.1837],[-52.7006,2.3635],[-51.9906,3.7018],[-51.6526,4.0614],[-51.2198,4.0938],[-51.0525,3.2819],[-50.659,2.1309],[-50.459,1.8295],[-49.9572,1.6599],[-49.8988,1.1628],[-50.2945,.8356],[-50.8163,.1724],[-51.2829,-.085],[-51.7026,-.7624],[-51.9476,-1.5867],[-51.2973,-1.2236],[-50.9177,-1.1153],[-50.69,-1.7616],[-50.4033,-2.0155],[-49.9991,-1.8317],[-49.7195,-1.9263],[-49.3137,-1.7319],[-48.9913,-1.83],[-48.115,-.7375],[-47.3981,-.6266],[-46.8113,-.7797],[-46.6173,-.9706],[-46.2192,-1.0314],[-45.6448,-1.3479],[-45.0764,-1.4664],[-44.6513,-1.7456],[-44.3082,-2.5353],[-43.9329,-2.5832],[-42.9368,-2.4652],[-42.2496,-2.7919],[-41.8761,-2.7466],[-41.3181,-2.9361],[-40.4745,-2.7954],[-39.9647,-2.8616],[-38.4757,-3.7174],[-38.0489,-4.2163],[-37.1746,-4.9123],[-36.5907,-5.0975],[-35.9799,-5.0544],[-35.5493,-5.1294],[-35.2355,-5.5666],[-34.9882,-6.3936],[-34.8056,-7.2885],[-34.8347,-7.9717],[-35.1578,-8.9305],[-35.3409,-9.2305],[-36.3983,-10.4841],[-36.9378,-10.8206],[-37.4119,-11.497],[-37.6887,-12.0998],[-38.2397,-12.8443],[-38.788,-12.7826],[-38.8352,-13.147],[-39.0894,-13.5882],[-38.9422,-14.0308],[-39.0596,-14.6549],[-38.8805,-15.8645],[-39.2152,-17.3156],[-39.1539,-17.704],[-39.4869,-17.9903],[-39.7399,-18.6397],[-39.6999,-19.278],[-40.0013,-19.7419],[-40.396,-20.5693],[-40.7892,-20.9062],[-41.0471,-21.5059],[-41.1226,-22.0843],[-41.7054,-22.3098],[-41.9804,-22.5806],[-42.0424,-22.9472],[-42.9583,-22.9672],[-43.5327,-23.0462],[-43.8661,-22.9104],[-44.6373,-23.0555],[-45.4233,-23.6854],[-45.9721,-23.7955],[-46.8672,-24.2363],[-47.8766,-24.9976],[-48.5451,-25.8161],[-48.6776,-26.703],[-48.5542,-27.1962],[-48.6208,-28.0755],[-48.7997,-28.5753],[-49.2714,-28.871],[-49.7461,-29.3633],[-50.2994,-30.4259],[-51.1572,-30.3642],[-51.4637,-31.0527],[-51.9724,-31.3839],[-52.1935,-31.8854],[-52.1274,-32.1678],[-52.6523,-33.1377],[-53.3707,-33.7422],[-53.5314,-33.171],[-53.1254,-32.7368],[-53.6017,-32.403],[-53.7618,-32.0568],[-54.2205,-31.8553],[-54.5876,-31.4851],[-55.2546,-31.2258],[-55.5573,-30.876],[-55.8736,-31.0696],[-56.1761,-30.6283],[-56.8328,-30.1072],[-57.2144,-30.2834],[-57.609,-30.188],[-56.9387,-29.595],[-55.7255,-28.2043],[-55.1014,-27.8669],[-54.8291,-27.5508],[-54.3271,-27.4234],[-53.8381,-27.1212],[-53.6712,-26.2249],[-53.8912,-25.6687],[-54.1546,-25.5231],[-54.6158,-25.576],[-54.4731,-25.2204],[-54.2418,-24.0472],[-54.6254,-23.8124],[-55.3662,-23.9913],[-55.6541,-22.8105],[-55.8492,-22.3076],[-56.5239,-22.1025],[-56.9374,-22.2712],[-57.9856,-22.0461],[-57.8303,-20.9981],[-58.1598,-20.1645],[-58.1314,-19.7446],[-57.8005,-19.0809],[-57.5741,-18.2793],[-57.8325,-17.5122],[-58.396,-17.2343],[-58.538,-16.3284],[-60.1756,-16.2693],[-60.299,-14.6185],[-60.5065,-13.7897],[-61.0769,-13.4897],[-61.79,-13.5256],[-62.176,-13.1337],[-62.7654,-12.9974],[-63.0675,-12.6694],[-63.5858,-12.5189],[-64.4205,-12.4399],[-64.5135,-12.2508],[-64.9925,-11.9751],[-65.39,-11.2462],[-65.334,-10.8929],[-65.4368,-10.449],[-65.3132,-10.2533],[-65.3962,-9.7126],[-66.2635,-9.8262],[-66.7301,-9.9754],[-67.5824,-10.5058],[-68.0717,-10.7029],[-68.398,-11.0185],[-69.5785,-10.9519],[-70.2202,-11.0478],[-70.6423,-11.0101],[-70.637,-9.4782],[-71.238,-9.9661],[-72.1815,-10.0038],[-72.379,-9.5102],[-73.2093,-9.4116],[-72.9741,-8.993],[-73.5491,-8.3459],[-74.0021,-7.5562],[-73.7496,-7.3356],[-73.758,-6.9059],[-73.1374,-6.466],[-73.2355,-6.0984],[-72.9799,-5.635],[-72.8871,-5.1228],[-72.6987,-5.0673],[-71.8448,-4.5044],[-70.9737,-4.3504],[-70.7995,-4.1733],[-69.9658,-4.2359],[-69.6691,-2.6676],[-69.4003,-1.1948],[-69.6675,-.4823],[-70.0706,-.1387],[-70.0539,.5786],[-69.1633,.864],[-69.3615,1.0642],[-69.8522,1.0593],[-69.8486,1.7087],[-68.1765,1.7198],[-67.8152,1.79],[-67.352,2.0861],[-66.8761,1.2231],[-66.4293,.8218],[-66.06,.7854],[-65.6814,.9834],[-65.3609,.8685],[-65.1037,1.1082],[-64.1149,1.6191],[-64.0354,1.9045],[-63.394,2.2223],[-63.3893,2.4119],[-63.9242,2.4523],[-64.2188,3.2047],[-64.2212,3.5873],[-64.5679,3.8998],[-64.2556,4.1404],[-64.0214,3.9291],[-63.2948,3.9224],[-62.9685,3.594],[-62.7122,4.0179],[-62.1531,4.0982],[-61.0028,4.5354],[-60.6046,4.9944],[-60.7422,5.2022],[-60.142,5.239],[-59.9907,5.0828],[-60.1112,4.511],[-59.8333,4.476],[-59.5512,3.9335],[-59.8544,3.5873],[-59.9942,2.6902],[-59.7552,2.2743],[-59.7563,1.9005],[-59.2312,1.3758],[-58.8625,1.2036],[-58.5119,1.2848],[-58.3407,1.5876],[-57.5943,1.7043],[-57.1189,2.0141],[-56.8368,1.8814],[-56.4828,1.9422]]]]},properties:{name:"Brazil",id:"BR"},id:"BR"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-58.1598,-20.1645],[-58.1803,-19.8178],[-59.0905,-19.286],[-60.0073,-19.2976],[-61.7569,-19.6451],[-61.917,-20.0553],[-62.2763,-20.5627],[-62.2767,-21.066],[-62.6509,-22.2339],[-62.8434,-21.9973],[-63.8186,-22.0053],[-63.9762,-22.0728],[-64.3739,-22.7612],[-64.6056,-22.229],[-65.0579,-22.103],[-65.771,-22.0994],[-66.0986,-21.8353],[-66.3652,-22.1136],[-66.7117,-22.2161],[-67.1948,-22.8216],[-67.8795,-22.8229],[-67.9883,-22.0572],[-68.1969,-21.3004],[-68.4999,-20.6119],[-68.7451,-20.4588],[-68.6983,-19.721],[-68.4628,-19.4329],[-68.9684,-18.9682],[-69.094,-18.0507],[-69.3133,-17.9432],[-69.5108,-17.506],[-69.6249,-17.2002],[-69.0208,-16.6422],[-68.9134,-16.2618],[-69.2176,-16.149],[-69.4185,-15.6035],[-69.1726,-15.2368],[-69.3748,-14.963],[-69.235,-14.5972],[-68.8803,-14.199],[-69.0741,-13.6828],[-68.9786,-12.8802],[-68.6852,-12.502],[-69.5785,-10.9519],[-68.398,-11.0185],[-68.0717,-10.7029],[-67.5824,-10.5058],[-66.7301,-9.9754],[-66.2635,-9.8262],[-65.3962,-9.7126],[-65.3132,-10.2533],[-65.4368,-10.449],[-65.334,-10.8929],[-65.39,-11.2462],[-64.9925,-11.9751],[-64.5135,-12.2508],[-64.4205,-12.4399],[-63.5858,-12.5189],[-63.0675,-12.6694],[-62.7654,-12.9974],[-62.176,-13.1337],[-61.79,-13.5256],[-61.0769,-13.4897],[-60.5065,-13.7897],[-60.299,-14.6185],[-60.1756,-16.2693],[-58.538,-16.3284],[-58.396,-17.2343],[-57.8325,-17.5122],[-57.5741,-18.2793],[-57.8005,-19.0809],[-58.1314,-19.7446],[-58.1598,-20.1645]]]},properties:{name:"Bolivia",id:"BO"},id:"BO"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-64.7303,32.2934],[-64.8202,32.2596],[-64.6946,32.387],[-64.7303,32.2934]]]},properties:{name:"Bermuda",id:"BM"},id:"BM"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-88.8941,15.8907],[-89.2374,15.8942],[-89.1615,17.8149],[-88.8064,17.9654],[-88.523,18.4457],[-88.2957,18.4723],[-88.0973,18.1217],[-88.2717,17.6098],[-88.3134,16.6328],[-88.8941,15.8907]]]},properties:{name:"Belize",id:"BZ"},id:"BZ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[28.1481,56.143],[28.7948,55.9426],[29.375,55.9386],[29.4824,55.6845],[30.2335,55.8452],[30.9069,55.5699],[31.1213,54.6484],[31.4036,54.1959],[31.792,54.0558],[32.7042,53.3363],[32.1422,53.0913],[31.4178,53.196],[31.5771,52.3122],[31.7636,52.1012],[30.9806,52.0461],[30.5331,51.5964],[29.3466,51.3825],[29.1357,51.6173],[28.5991,51.5427],[27.2701,51.6135],[27.1422,51.752],[25.9251,51.9136],[24.3617,51.8674],[23.6053,51.5179],[23.6523,52.0403],[23.1969,52.257],[23.8445,52.6642],[23.8872,53.0276],[23.4845,53.9398],[24.7683,53.9746],[25.5473,54.3317],[25.8594,54.9192],[26.175,55.0033],[26.5936,55.6676],[27.5768,55.7988],[28.1481,56.143]]]},properties:{name:"Belarus",id:"BY"},id:"BY"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-62.832,17.8766],[-62.8655,17.9184],[-62.7996,17.9086],[-62.832,17.8766]]]},properties:{name:"Saint Barthelemy",id:"BL"},id:"BL"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-77.7439,24.7072],[-78.0449,24.2873],[-78.2988,24.7538],[-78.0333,25.1431],[-77.7439,24.7072]]],[[[-77.2257,25.904],[-77.4032,26.0247],[-77.2468,26.1565],[-77.2062,26.489],[-77.0384,26.3332],[-77.1673,26.2404],[-77.2257,25.904]]]]},properties:{name:"Bahamas",id:"BS"},id:"BS"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[50.6072,25.8831],[50.4661,25.9657],[50.4523,26.1907],[50.6099,26.1246],[50.6072,25.8831]]]},properties:{name:"Bahrain",id:"BH"},id:"BH"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[19.007,44.8693],[19.3568,44.8586],[19.1517,44.3024],[19.4882,43.7036],[19.1943,43.5331],[18.9404,43.4967],[18.4437,42.9685],[18.4362,42.5597],[17.6678,42.897],[17.5852,42.9383],[17.6247,43.0426],[16.214,44.215],[15.7369,44.7658],[15.7879,45.1791],[16.2935,45.0086],[16.5305,45.2168],[17.8129,45.0779],[18.6625,45.0774],[19.007,44.8693]]]},properties:{name:"Bosnia and Herzegovina",id:"BA"},id:"BA"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[28.5853,43.7422],[28.4655,43.3893],[27.9288,43.186],[27.8888,42.7497],[27.4849,42.4683],[28.0145,41.9689],[27.2949,42.0794],[26.6153,41.9649],[26.321,41.7167],[26.1355,41.3856],[25.2512,41.2436],[24.0558,41.5272],[23.635,41.3869],[22.9159,41.3363],[23.0056,41.7172],[22.8369,41.9937],[22.3442,42.3138],[22.4667,42.8425],[22.9767,43.1878],[22.5546,43.4546],[22.421,44.0077],[22.7051,44.2376],[23.2244,43.8741],[25.4972,43.6708],[26.2158,44.0072],[27.0867,44.1675],[28.5853,43.7422]]]},properties:{name:"Bulgaria",id:"BG"},id:"BG"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[92.575,21.9782],[92.5937,21.4673],[92.1795,21.2933],[92.3242,20.7917],[92.0561,21.1747],[92.0082,21.6848],[91.693,22.5046],[91.4094,22.7972],[90.9455,22.597],[90.6334,23.0941],[90.435,22.7519],[90.5895,22.2583],[90.1589,21.8171],[89.8118,21.9835],[89.2343,21.7225],[89.0514,22.0932],[88.7407,23.4368],[88.5671,23.6743],[88.7336,24.2309],[88.1454,24.4857],[88.4561,25.1884],[88.4521,25.5746],[88.0846,25.8884],[88.4402,26.3696],[89.1082,26.2023],[89.2893,26.0376],[89.8229,25.9413],[89.814,25.3052],[90.4394,25.1578],[92.0499,25.1693],[92.2514,24.895],[91.8768,24.1954],[91.3672,24.0933],[91.1603,23.6605],[91.3152,23.1043],[91.6198,22.9796],[91.938,23.5047],[92.2461,23.6836],[92.3615,22.929],[92.4916,22.6853],[92.575,21.9782]]]},properties:{name:"Bangladesh",id:"BD"},id:"BD"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[.2175,14.9114],[.1638,14.4973],[.6183,13.7036],[.9779,13.5518],[.9872,13.0418],[1.5652,12.6356],[2.0739,12.7142],[2.0912,12.2778],[2.389,11.897],[1.9802,11.4184],[1.4267,11.4473],[.9007,10.9932],[-.0686,11.1157],[-.7014,10.9888],[-2.8298,10.9985],[-2.9148,10.5924],[-2.7865,10.4019],[-2.6958,9.4813],[-3.2235,9.8954],[-3.8776,9.895],[-4.6258,9.7134],[-4.9698,9.9301],[-5.0999,10.2417],[-5.5236,10.4259],[-5.4905,11.0425],[-5.2999,11.2058],[-5.2881,11.8277],[-4.798,12.0319],[-4.4287,12.3377],[-4.4807,12.6724],[-4.2272,12.7936],[-4.3286,13.119],[-4.0512,13.3822],[-3.5758,13.194],[-3.3017,13.2806],[-3.1985,13.673],[-2.4572,14.274],[-2.1132,14.1684],[-1.7678,14.4862],[-1.0496,14.8195],[-.7604,15.0477],[-.2359,15.0592],[.2175,14.9114]]]},properties:{name:"Burkina Faso",id:"BF"},id:"BF"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[3.5955,11.6963],[3.4877,11.3954],[3.7163,11.0797],[3.8343,10.6074],[3.5764,10.2683],[3.5573,9.9074],[3.3252,9.7783],[3.0451,9.084],[2.7748,9.0485],[2.686,7.874],[2.7748,6.7119],[2.7064,6.3692],[1.6224,6.2169],[1.6002,9.0498],[1.4244,9.2851],[1.3299,9.9971],[.7799,10.3598],[.9007,10.9932],[1.4267,11.4473],[1.9802,11.4184],[2.389,11.897],[2.3659,12.2219],[2.8782,12.3679],[3.5955,11.6963]]]},properties:{name:"Benin",id:"BJ"},id:"BJ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[30.5535,-2.3999],[30.5149,-2.9175],[30.7901,-3.2744],[30.4252,-3.5891],[30.1469,-4.0854],[29.7177,-4.456],[29.4034,-4.4494],[29.2232,-3.9109],[29.2245,-3.0533],[29.0146,-2.7204],[29.3901,-2.8087],[29.8682,-2.7164],[29.9303,-2.3396],[30.5535,-2.3999]]]},properties:{name:"Burundi",id:"BI"},id:"BI"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[48.5729,41.8446],[49.1064,41.3017],[49.2263,41.026],[49.7758,40.5839],[49.3244,39.6083],[49.363,39.3495],[49.0137,39.1342],[48.8685,38.4355],[48.5929,38.4111],[48.0233,38.819],[48.2422,38.9788],[47.9958,39.6842],[47.773,39.6486],[46.4906,38.9065],[46.5501,39.2012],[45.7897,39.8812],[45.9646,40.2337],[45.376,40.6381],[45.5877,40.8467],[45.0013,41.291],[45.281,41.4495],[46.4577,41.07],[46.6189,41.3439],[46.1821,41.6573],[46.4298,41.8907],[46.7494,41.8126],[47.2612,41.315],[47.8609,41.2129],[48.5729,41.8446]]],[[[46.1146,38.8776],[45.4798,39.0063],[44.8171,39.6504],[44.7683,39.7037],[45.0315,39.7649],[45.7662,39.3783],[46.1146,38.8776]]]]},properties:{name:"Azerbaijan",id:"AZ"},id:"AZ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[16.9531,48.5988],[17.1475,48.0058],[16.4342,47.3675],[16.4533,47.0066],[16.0929,46.8632],[15.9575,46.6777],[15.0009,46.6262],[14.5037,46.4171],[13.6998,46.5201],[12.3881,46.7025],[12.1542,46.9351],[11.2442,46.9755],[11.0249,46.7971],[10.4528,46.865],[9.5801,47.0572],[9.5277,47.2707],[9.5241,47.5242],[10.3129,47.3133],[10.4306,47.541],[11.2979,47.4247],[11.717,47.5837],[12.686,47.6693],[12.8143,48.1607],[13.4095,48.3942],[13.8148,48.7669],[14.0492,48.6024],[14.6915,48.5993],[14.972,48.9839],[16.0573,48.7549],[16.4777,48.8001],[16.9531,48.5988]]]},properties:{name:"Austria",id:"AT"},id:"AT"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[145.0431,-40.7868],[145.2832,-40.7699],[146.3175,-41.1637],[146.99,-40.9923],[147.4547,-41.0017],[147.9687,-40.7797],[148.2928,-40.9471],[148.3017,-42.0399],[147.9244,-42.5726],[147.9807,-43.1572],[147.4081,-42.894],[146.8741,-43.6126],[146.0431,-43.5474],[145.2681,-42.5442],[145.2384,-42.0195],[144.778,-41.4189],[144.6462,-40.9808],[145.0431,-40.7868]]],[[[137.5963,-35.7384],[137.4485,-36.0749],[136.7551,-36.0332],[136.6388,-35.7491],[137.334,-35.5924],[137.5963,-35.7384]]],[[[136.7147,-13.8039],[136.8945,-14.2931],[136.3632,-14.2288],[136.4249,-13.8648],[136.7147,-13.8039]]],[[[130.6188,-11.3763],[131.2682,-11.1899],[131.5385,-11.4367],[130.9508,-11.9263],[130.645,-11.7425],[130.6188,-11.3763]]],[[[143.1787,-11.9547],[143.1103,-12.3036],[143.4015,-12.6401],[143.5866,-13.4435],[143.5485,-13.7409],[143.7562,-14.349],[143.9617,-14.4627],[144.4731,-14.2319],[144.648,-14.4924],[145.2876,-14.943],[145.2717,-15.4765],[145.4581,-16.0563],[145.4261,-16.406],[145.902,-17.0701],[146.1257,-17.6352],[146.0325,-18.2731],[146.3334,-18.5536],[146.4813,-19.0787],[147.1387,-19.393],[147.4183,-19.3783],[147.9155,-19.8693],[148.7593,-20.2897],[148.6839,-20.5804],[149.205,-21.1251],[149.7039,-22.4408],[150.0763,-22.1647],[150.5415,-22.5593],[150.7639,-22.5761],[150.8429,-23.4582],[151.1537,-23.784],[151.9025,-24.2008],[152.1298,-24.5976],[152.4565,-24.8023],[152.9137,-25.4321],[153.1649,-25.9644],[153.0842,-26.3039],[153.117,-27.1944],[153.5755,-28.2407],[153.6044,-28.8546],[153.3483,-29.2905],[153.2724,-29.8924],[153.0304,-30.5635],[152.9439,-31.4349],[152.5595,-32.0457],[152.4703,-32.439],[151.8128,-32.9011],[151.4839,-33.3476],[151.2313,-34.0294],[150.9601,-34.2971],[150.6902,-35.1778],[150.1953,-35.8334],[149.9605,-36.8455],[149.9325,-37.5286],[149.2986,-37.8021],[148.2626,-37.8309],[147.3957,-38.2189],[146.8568,-38.6632],[145.9353,-38.9016],[145.791,-38.6668],[144.6653,-38.21],[143.5391,-38.8208],[142.6123,-38.4515],[141.725,-38.2713],[141.4244,-38.3636],[141.0112,-38.0769],[140.6272,-38.0285],[139.7843,-37.2459],[139.8575,-36.6622],[139.5486,-36.0967],[139.0376,-35.6892],[138.1845,-35.6128],[138.5112,-35.0242],[138.4899,-34.7636],[138.0895,-34.1697],[137.6918,-35.1432],[136.8834,-35.2399],[137.0144,-34.9159],[137.3908,-34.9132],[137.4938,-34.1613],[137.9319,-33.5789],[137.8524,-33.2007],[137.4423,-33.1936],[137.2372,-33.6295],[136.4307,-34.0299],[135.6476,-34.9394],[135.1855,-33.9069],[134.7909,-33.3285],[134.3013,-33.1652],[134.1002,-32.7488],[134.2343,-32.5486],[133.5511,-32.1829],[133.212,-32.1837],[132.7575,-31.956],[132.2146,-32.0071],[131.7214,-31.6964],[131.1435,-31.4957],[130.783,-31.604],[130.1296,-31.5792],[128.9462,-31.7026],[128.0677,-32.0666],[127.3198,-32.2641],[125.9171,-32.2969],[124.759,-32.8829],[124.126,-33.1292],[123.6506,-33.8364],[123.2076,-33.9882],[122.7774,-33.891],[122.1511,-33.9917],[121.4054,-33.8266],[119.854,-33.9748],[119.4505,-34.3681],[118.8951,-34.48],[118.1356,-34.9865],[117.5817,-35.0979],[116.5172,-34.9878],[115.9868,-34.7952],[115.7262,-34.5262],[115.0089,-34.2558],[115.1815,-33.6433],[115.5154,-33.5314],[115.6831,-33.1927],[115.6982,-31.6946],[115.1767,-30.8081],[114.9947,-30.2164],[114.9592,-29.4334],[114.5375,-28.5429],[114.165,-28.0808],[114.0283,-27.3471],[113.5818,-26.5583],[113.853,-26.3319],[113.5889,-26.0984],[113.5396,-25.6252],[114.2156,-26.2893],[114.2143,-25.8516],[113.671,-24.9772],[113.4175,-24.4356],[113.5529,-23.7329],[113.7571,-23.4182],[113.683,-22.6378],[113.9586,-21.9392],[114.1637,-22.3231],[114.3777,-22.3413],[114.8588,-21.7359],[115.4563,-21.4917],[116.0107,-21.0305],[116.7068,-20.6536],[117.4063,-20.7211],[118.1991,-20.3753],[118.7513,-20.2617],[119.1047,-19.9954],[119.5858,-20.0384],[120.8785,-19.6651],[121.4937,-19.1067],[121.8337,-18.4772],[122.2372,-17.9685],[122.1604,-17.3138],[122.7202,-16.7878],[122.9705,-16.4367],[123.5254,-17.4856],[123.778,-16.8677],[123.4903,-16.4908],[124.577,-16.1135],[124.3817,-15.758],[124.8389,-15.1609],[125.2432,-14.9448],[125.1789,-14.7148],[125.6814,-14.3881],[126.0209,-14.4946],[126.1115,-14.1142],[126.5696,-14.1608],[126.9034,-13.744],[127.6727,-14.195],[128.1996,-14.7517],[129.4589,-14.9332],[129.7536,-14.7894],[129.3785,-14.3926],[129.7097,-13.9802],[129.8389,-13.5731],[130.2597,-13.3024],[130.1682,-12.9574],[130.3999,-12.688],[130.898,-12.5238],[131.0458,-12.1895],[131.4382,-12.277],[132.3722,-12.2392],[132.5839,-12.1101],[132.6829,-11.5055],[133.0247,-11.4527],[133.1854,-11.7057],[133.904,-11.8322],[134.2369,-12.008],[134.7301,-11.9844],[135.2179,-12.2215],[135.7883,-11.9072],[136.0818,-12.4226],[136.5403,-11.9578],[136.9473,-12.3498],[136.5372,-12.7843],[136.5945,-13.0036],[135.9273,-13.3041],[135.9894,-13.8102],[135.8833,-14.1533],[135.4053,-14.7583],[135.5309,-15.0002],[136.2052,-15.4033],[136.7844,-15.8942],[137.0019,-15.8783],[137.7037,-16.2329],[138.2448,-16.7181],[139.0097,-16.8992],[139.2485,-17.3285],[140.0359,-17.7027],[140.5114,-17.6245],[140.8305,-17.4146],[141.2189,-16.6462],[141.412,-16.0696],[141.6255,-15.0566],[141.523,-14.4702],[141.5945,-14.1528],[141.4724,-13.7977],[141.6455,-13.2593],[141.6779,-12.4914],[141.9513,-11.8961],[142.1684,-10.9466],[142.4565,-10.7074],[142.8369,-11.3071],[142.8724,-11.8215],[143.1787,-11.9547]]]]},properties:{name:"Australia",id:"AU"},id:"AU"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[69.185,-49.1093],[69.9157,-49.3486],[69.6129,-49.6509],[68.8721,-49.4445],[69.185,-49.1093]]]},properties:{name:"French Southern and Antarctic Lands",id:"TF"},id:"TF"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-59.7339,-80.3442],[-60.5828,-80.9484],[-64.2683,-80.7486],[-65.9801,-80.3846],[-62.5189,-80.3736],[-61.3432,-79.8866],[-59.7064,-79.8755],[-59.7339,-80.3442]]],[[[-159.053,-79.8076],[-161.8655,-79.7037],[-164.2259,-79.3206],[-163.2562,-78.7223],[-161.6431,-78.9012],[-159.6842,-79.4023],[-159.053,-79.8076]]],[[[-70.334,-79.6797],[-71.7836,-79.4445],[-70.544,-78.8838],[-67.4785,-78.3627],[-66.7281,-78.3836],[-69.2509,-79.2101],[-70.334,-79.6797]]],[[[-45.2226,-78.8106],[-43.722,-78.8186],[-42.9654,-79.4769],[-43.5278,-80.1916],[-49.1875,-80.643],[-49.773,-80.7842],[-54.1626,-80.8703],[-53.4823,-80.1889],[-52.2971,-80.1414],[-50.3391,-79.4796],[-50.7331,-79.2829],[-50.2197,-78.6051],[-49.0811,-78.0476],[-46.8257,-77.7852],[-45.5302,-77.8815],[-43.8086,-78.2864],[-43.9473,-78.5975],[-45.2226,-78.8106]]],[[[-120.5562,-73.756],[-120.2726,-73.9891],[-121.0625,-74.3375],[-122.8591,-74.3428],[-122.6247,-73.9655],[-123.1121,-73.6823],[-120.5562,-73.756]]],[[[-126.3299,-73.2864],[-124.9933,-73.8297],[-124.8731,-74.2083],[-127.4143,-73.5163],[-126.3299,-73.2864]]],[[[-74.3544,-73.0986],[-74.5748,-73.6113],[-75.9009,-73.3325],[-75.3769,-72.8203],[-74.3544,-73.0986]]],[[[-91.1608,-73.1821],[-91.6699,-72.6236],[-90.8072,-72.6108],[-91.1608,-73.1821]]],[[[-98.0911,-71.9125],[-96.8695,-71.8508],[-95.6095,-72.0683],[-96.0518,-72.5775],[-98.4078,-72.5477],[-100.1951,-72.2725],[-102.2647,-72.1354],[-102.128,-71.9853],[-98.6155,-71.7638],[-98.0911,-71.9125]]],[[[-73.7067,-70.635],[-74.205,-70.924],[-76.1763,-71.1326],[-76.5004,-70.9413],[-75.0076,-70.6088],[-73.7067,-70.635]]],[[[-74.9871,-69.7277],[-74.8489,-70.1791],[-75.7267,-70.0961],[-74.9871,-69.7277]]],[[[-70.0511,-69.1892],[-69.417,-69.5834],[-68.3361,-70.8561],[-68.2411,-71.822],[-69.2092,-72.5344],[-72.3675,-72.6698],[-73.0864,-72.4079],[-71.1066,-72.047],[-72.4121,-71.6622],[-73.8994,-72.1522],[-75.3531,-71.8783],[-75.2925,-71.6151],[-74.1872,-71.383],[-72.6216,-71.3883],[-71.1941,-70.9848],[-71.0611,-70.5369],[-70.328,-70.3611],[-71.8537,-69.9692],[-71.869,-68.9411],[-70.417,-68.7889],[-70.0511,-69.1892]]],[[[-67.9885,-67.4745],[-68.5804,-67.7328],[-69.0825,-67.403],[-68.3359,-66.802],[-67.6878,-67.1473],[-67.9885,-67.4745]]],[[[-57.0206,-63.3729],[-58.2631,-63.7636],[-58.8954,-64.389],[-59.9632,-64.4312],[-61.0598,-64.9812],[-61.7361,-65.0335],[-62.1453,-65.3318],[-62.3051,-65.8405],[-61.8754,-66.296],[-63.7525,-66.2778],[-64.0778,-66.6542],[-64.6862,-66.8064],[-64.8193,-67.3076],[-65.4432,-67.3262],[-65.6394,-68.1306],[-64.8984,-68.6734],[-63.3436,-68.8106],[-63.4559,-69.0419],[-62.4505,-69.5843],[-61.9611,-70.1201],[-61.9611,-70.9005],[-61.0172,-71.1668],[-61.2136,-71.5641],[-60.7193,-72.0728],[-60.3846,-73.0072],[-61.4054,-73.467],[-60.8789,-73.6122],[-61.0107,-74.4782],[-62.2257,-74.5057],[-63.9247,-75.0047],[-63.3634,-75.4517],[-66.3705,-76.0132],[-69.3044,-76.3506],[-70.0954,-76.6546],[-71.7987,-76.7527],[-75.2683,-76.5814],[-77.19,-76.6298],[-76.2487,-77.2747],[-75.3869,-77.474],[-72.852,-77.5903],[-73.2515,-77.8944],[-74.812,-78.1776],[-80.6015,-77.7519],[-81.4411,-77.8855],[-77.4325,-78.4346],[-77.8691,-78.7454],[-80.2923,-78.8226],[-83.246,-78.3569],[-83.26,-78.7742],[-80.1512,-79.2683],[-76.499,-79.3255],[-76.5578,-79.9035],[-75.2366,-80.8028],[-73.0296,-80.9173],[-70.239,-80.8565],[-64.7501,-81.5219],[-64.1371,-81.8695],[-65.9133,-82.1833],[-62.7357,-82.5273],[-61.5898,-83.3414],[-59.5159,-83.4586],[-57.3535,-82.8403],[-53.9862,-82.2006],[-48.3607,-81.8921],[-43.6692,-82.2699],[-41.4338,-81.2977],[-38.7718,-80.8823],[-37.2093,-81.0638],[-35.3269,-80.6505],[-29.3291,-80.172],[-24.2403,-80.0619],[-25.2586,-79.7623],[-29.9494,-79.599],[-30.3161,-79.1631],[-32.9943,-79.2288],[-36.2391,-78.7742],[-36.181,-78.4684],[-34.0758,-77.4252],[-32.0634,-77.1598],[-28.9336,-76.3701],[-26.0594,-75.9573],[-24.2696,-75.7668],[-19.4931,-75.54],[-17.2989,-74.334],[-15.6725,-74.4072],[-15.7488,-73.9456],[-16.5188,-73.6441],[-15.5959,-73.0968],[-14.3211,-73.123],[-14.2978,-72.7328],[-13.2087,-72.7852],[-11.497,-72.4128],[-10.8254,-71.5534],[-9.8879,-71.0274],[-9.2307,-71.1739],[-8.6466,-71.6728],[-7.7137,-71.5463],[-7.8735,-70.9404],[-5.9364,-70.7127],[-5.5879,-70.8569],[-5.9499,-71.3417],[-2.8121,-71.3208],[-.8958,-71.3492],[-.5431,-71.7128],[.835,-71.2023],[2.6096,-70.9],[5.1132,-70.6559],[8.5232,-70.4739],[9.1415,-70.1836],[10.2175,-70.5081],[11.7014,-70.7664],[12.9292,-70.2133],[13.8228,-70.3434],[15.807,-70.3238],[18.1246,-70.5405],[19.1966,-70.2932],[19.2649,-70.9022],[21.0707,-70.8436],[21.705,-70.2586],[22.979,-70.8103],[23.8037,-70.4046],[24.7567,-70.892],[25.9743,-71.0372],[27.207,-70.9111],[30.0035,-70.2999],[31.3787,-70.2257],[32.6212,-70.0007],[32.9892,-69.6243],[32.5675,-69.0743],[33.1214,-68.689],[34.193,-68.7023],[35.2246,-69.6371],[37.5599,-69.7184],[38.8592,-70.006],[39.7053,-69.4258],[39.8637,-68.9669],[41.1328,-68.5749],[42.409,-68.3521],[42.8196,-68.123],[44.6999,-67.9042],[44.9893,-67.7692],[47.1174,-67.5726],[48.6479,-67.7941],[48.7136,-67.217],[49.2472,-66.9414],[50.6059,-67.15],[50.3325,-66.4447],[51.8843,-66.0199],[53.6719,-65.8587],[54.9481,-65.9164],[55.7102,-66.0798],[57.1853,-66.6133],[56.4533,-66.7798],[56.8919,-67.0563],[57.6274,-67.0142],[58.7376,-67.2295],[59.2507,-67.4851],[60.4821,-67.3853],[62.6878,-67.6476],[63.6989,-67.5082],[68.3279,-67.8895],[69.4163,-67.743],[69.9822,-68.4644],[69.5344,-68.7369],[69.6293,-69.2314],[68.9062,-69.3726],[69.0825,-69.8666],[68.1783,-69.8373],[67.2678,-70.2732],[67.9408,-70.4228],[69.2503,-70.4313],[68.8725,-71.0354],[68.0375,-71.391],[67.4321,-72.0031],[66.8919,-72.9486],[67.9714,-73.0857],[68.4197,-72.5149],[69.5548,-72.3746],[71.2766,-71.624],[71.9047,-70.7069],[72.7601,-70.3957],[72.8223,-70.0961],[73.9422,-69.7432],[75.4239,-69.8933],[75.8913,-69.5754],[77.8174,-69.069],[78.7265,-68.2779],[79.288,-68.1195],[82.017,-67.6902],[83.3043,-67.6032],[84.4851,-67.1145],[85.7107,-67.1611],[87.9803,-66.7882],[89.6986,-66.8229],[92.0734,-66.5077],[93.9644,-66.6897],[94.8397,-66.5015],[95.5411,-66.6311],[98.2577,-66.4673],[99.3701,-66.6484],[100.8891,-66.3581],[101.4746,-65.9511],[102.674,-65.8654],[103.9511,-65.9879],[108.1578,-66.6391],[109.4629,-66.9085],[110.6223,-66.5241],[110.9069,-66.0767],[113.0992,-65.8001],[113.7096,-65.9297],[114.3368,-66.3603],[115.3103,-66.561],[115.2739,-67.0279],[113.991,-67.2117],[114.0265,-67.4412],[116.7134,-67.047],[118.1388,-67.0825],[119.1331,-67.3706],[121.4875,-67.0905],[122.1826,-66.8593],[123.9693,-66.608],[124.5978,-66.7083],[125.8656,-66.3643],[126.6646,-66.4975],[127.5413,-67.051],[129.2369,-67.0417],[129.7412,-66.4686],[130.9517,-66.1912],[131.831,-66.2356],[133.4446,-66.0816],[134.9716,-66.3301],[135.352,-66.1273],[136.1941,-66.2924],[137.7539,-66.4065],[139.9001,-66.715],[141.9726,-66.8069],[142.8884,-67],[143.4481,-66.877],[144.6214,-67.1416],[143.9422,-67.7941],[145.9752,-67.6241],[146.8279,-67.9645],[147.0938,-68.3685],[148.4561,-68.467],[151.068,-68.3849],[151.562,-68.6939],[153.0819,-68.8568],[154.1997,-68.4178],[155.5202,-69.0246],[157.4813,-69.3087],[158.1578,-69.2088],[159.7838,-69.5217],[160.2095,-69.9749],[161.0369,-70.3172],[161.4244,-70.8268],[162.6749,-70.3047],[163.3487,-70.6208],[164.4034,-70.5103],[166.6269,-70.6643],[167.5692,-70.8103],[168.1725,-71.1832],[170.1625,-71.6307],[169.8287,-72.7288],[169.545,-73.0502],[167.6158,-73.337],[164.7758,-74.0286],[165.3027,-74.5936],[163.1672,-74.6021],[162.5337,-75.1671],[161.6797,-75.2177],[162.8156,-75.8463],[162.7628,-76.7456],[164.4296,-78.0422],[166.2087,-78.4515],[164.6347,-78.6033],[160.4829,-79.2017],[160.542,-80.425],[160.9078,-81.3901],[162.8214,-81.8664],[167.2328,-82.9521],[168.1099,-83.3618],[171.9172,-83.6441],[179.403,-84.2061],[180,-84.3517],[180,-89.9989],[-180,-89.9989],[-180,-89.583],[-180,-89.2931],[-180,-88.5869],[-180,-87.8811],[-180,-87.1753],[-180,-86.4695],[-180,-85.7633],[-180,-85.0575],[-180,-84.3517],[-171.7037,-84.5426],[-162.9335,-84.9012],[-157.1276,-85.1858],[-156.9864,-84.8111],[-163.5685,-84.5288],[-164.951,-83.8057],[-167.5528,-83.8111],[-169.1677,-83.4497],[-174.0661,-82.9002],[-171.8213,-82.8474],[-168.4178,-83.2287],[-163.111,-83.329],[-159.4445,-83.5434],[-157.6796,-83.1292],[-155.4594,-82.9805],[-153.0098,-82.4496],[-154.7175,-81.9409],[-153.9566,-81.7003],[-157.0326,-81.319],[-156.5283,-81.1623],[-148.1228,-80.9009],[-150.5755,-80.3536],[-148.3172,-80.0708],[-148.1765,-79.7761],[-152.0914,-79.2416],[-155.21,-78.9646],[-156.4693,-78.6353],[-154.7164,-78.3982],[-155.3416,-78.1918],[-157.2667,-78.1998],[-158.5003,-77.7786],[-158.2136,-77.1571],[-154.8149,-77.1269],[-153.4606,-77.4159],[-151.719,-77.4261],[-149.7177,-77.7976],[-145.967,-77.0688],[-145.7504,-76.7492],[-147.3404,-76.4384],[-146.383,-76.0998],[-143.5742,-75.5635],[-142.3298,-75.4907],[-141.5057,-75.6905],[-139.6911,-75.2129],[-137.6181,-75.0757],[-136.5494,-75.1396],[-135.362,-74.6904],[-133.4748,-74.852],[-132.0495,-74.7659],[-129.7907,-74.8915],[-127.8633,-74.7193],[-123.8894,-74.773],[-119.6771,-74.6544],[-118.3421,-74.3815],[-115.1052,-74.4551],[-114.7909,-73.9886],[-113.5085,-74.0889],[-113.9318,-74.982],[-111.6963,-74.7921],[-111.8064,-74.2696],[-110.307,-74.3668],[-110.3005,-74.7108],[-111.4631,-75.1334],[-109.2722,-75.1849],[-106.6189,-75.3438],[-104.9019,-75.1152],[-101.7081,-75.1272],[-101.0394,-75.4219],[-98.5578,-75.1898],[-101.2518,-74.4858],[-101.7154,-74.0237],[-102.7663,-73.8838],[-102.4108,-73.6166],[-100.9854,-73.7573],[-99.7812,-73.7201],[-100.0209,-73.4027],[-102.6751,-73.321],[-102.4092,-72.9876],[-98.0125,-73.0334],[-96.1521,-73.3095],[-94.2463,-73.313],[-92.241,-73.1785],[-90.9209,-73.3192],[-90.2954,-72.9779],[-88.1945,-72.8585],[-88.4193,-73.2291],[-87.0379,-73.3538],[-85.9808,-73.2087],[-84.9811,-73.5021],[-82.1835,-73.8568],[-81.3088,-73.7383],[-81.2624,-73.3148],[-80.4421,-72.9446],[-79.5217,-73.0897],[-78.4078,-73.5558],[-76.8506,-73.4604],[-77.1349,-73.8177],[-75.293,-73.6388],[-73.9961,-73.6996],[-72.9293,-73.4479],[-68.821,-73.1053],[-67.6671,-72.8345],[-66.8277,-72.0905],[-67.4603,-71.5268],[-67.8884,-70.4215],[-68.4033,-70.0198],[-68.7078,-69.4321],[-67.3717,-69.4125],[-66.9749,-69.1608],[-67.3906,-68.8612],[-66.7933,-68.2402],[-67.1498,-68.0245],[-66.705,-67.5273],[-67.5859,-67.435],[-67.4934,-67.1127],[-66.371,-66.6089],[-65.7664,-66.6249],[-65.6172,-66.1353],[-64.0658,-65.5538],[-64.0381,-65.1791],[-62.5761,-64.7557],[-61.6317,-64.6047],[-60.8643,-64.0734],[-59.5102,-63.8208],[-58.8721,-63.5518],[-57.3897,-63.2264],[-57.0206,-63.3729]]]]},properties:{name:"Antarctica",id:"AQ"},id:"AQ"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-170.7262,-14.3513],[-170.8205,-14.3122],[-170.6891,-14.2576],[-170.7262,-14.3513]]]},properties:{name:"American Samoa",id:"AS"},id:"AS"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[46.4906,38.9065],[46.1146,38.8776],[45.7662,39.3783],[45.0315,39.7649],[44.7683,39.7037],[44.2893,40.0406],[43.7917,40.0703],[43.5693,40.4823],[43.7225,40.7193],[43.4393,41.1073],[45.0013,41.291],[45.5877,40.8467],[45.376,40.6381],[45.9646,40.2337],[45.7897,39.8812],[46.5501,39.2012],[46.4906,38.9065]]]},properties:{name:"Armenia",id:"AM"},id:"AM"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[-62.6509,-22.2339],[-62.3726,-22.439],[-61.7984,-23.1821],[-61.0329,-23.7556],[-59.8924,-24.0934],[-59.373,-24.4538],[-58.3654,-24.9594],[-57.8216,-25.1365],[-57.5872,-25.4051],[-57.8906,-26.0065],[-58.2031,-26.3816],[-58.1914,-26.6302],[-58.6186,-27.1323],[-57.1118,-27.4701],[-56.3705,-27.5375],[-56.0673,-27.3076],[-55.7147,-27.415],[-55.4266,-27.0093],[-55.1358,-26.9312],[-54.7552,-26.533],[-54.6158,-25.576],[-54.1546,-25.5231],[-53.8912,-25.6687],[-53.6712,-26.2249],[-53.8381,-27.1212],[-54.3271,-27.4234],[-54.8291,-27.5508],[-55.1014,-27.8669],[-55.7255,-28.2043],[-56.9387,-29.595],[-57.609,-30.188],[-57.8724,-30.5911],[-57.8105,-30.8587],[-58.1889,-31.9241],[-58.2011,-32.4718],[-58.1709,-32.9592],[-58.4244,-33.1115],[-58.5471,-33.6637],[-58.2835,-34.6837],[-57.3036,-35.1884],[-57.1589,-35.5058],[-57.354,-35.7202],[-57.265,-36.1441],[-56.6981,-36.4265],[-56.6721,-36.8513],[-57.3957,-37.7448],[-57.5471,-38.0857],[-58.1792,-38.436],[-59.8282,-38.8381],[-61.1122,-38.993],[-62.067,-38.9189],[-62.3382,-39.1506],[-62.0537,-39.3739],[-62.2869,-39.8955],[-62.395,-40.8907],[-62.959,-41.1095],[-63.7731,-41.1499],[-64.8531,-40.8139],[-65.1334,-40.8805],[-65.059,-41.9698],[-64.4205,-42.4337],[-63.596,-42.4066],[-63.6925,-42.8052],[-64.1306,-42.8616],[-64.6504,-42.5313],[-65.0269,-42.759],[-64.4323,-43.0591],[-64.9856,-43.2935],[-65.2837,-43.6299],[-65.3613,-44.4773],[-65.6476,-44.6615],[-65.6388,-45.0078],[-66.1901,-44.9647],[-66.9414,-45.2573],[-67.5566,-45.9701],[-67.5633,-46.3452],[-66.7769,-47.0057],[-65.9985,-47.0936],[-65.7382,-47.3449],[-65.8101,-47.941],[-67.033,-48.6277],[-67.6849,-49.2465],[-67.7834,-49.8591],[-68.9396,-50.3824],[-69.2352,-50.9506],[-69.0325,-51.6364],[-68.4433,-52.3569],[-69.9603,-52.0084],[-71.9187,-51.9898],[-72.4077,-51.541],[-72.2763,-50.9102],[-72.5098,-50.6075],[-73.153,-50.7384],[-73.5012,-50.1254],[-73.5762,-49.583],[-72.6143,-48.7929],[-72.3549,-48.3658],[-72.518,-47.8762],[-72.346,-47.4927],[-71.905,-47.2015],[-71.9403,-46.8313],[-71.6952,-46.5783],[-71.8757,-46.1606],[-71.7727,-45.7242],[-71.3537,-45.2306],[-71.5962,-44.9794],[-71.2611,-44.7632],[-71.2127,-44.4414],[-71.82,-44.3832],[-71.6801,-43.9296],[-71.905,-43.44],[-71.7816,-43.167],[-72.1464,-42.9899],[-72.1247,-42.2983],[-71.7501,-42.0466],[-71.9114,-41.6506],[-71.932,-40.6918],[-71.6952,-40.3354],[-71.7199,-39.6354],[-71.5394,-39.6025],[-71.4256,-38.9855],[-70.9517,-38.7383],[-71.0281,-38.0413],[-71.1677,-37.7621],[-71.0556,-36.5237],[-70.4048,-36.0616],[-70.4703,-35.3261],[-70.2899,-34.733],[-69.8524,-34.2243],[-69.7978,-33.3987],[-70.0198,-33.2717],[-70.1696,-32.4718],[-70.5853,-31.5694],[-70.5196,-31.1486],[-70.1614,-30.4401],[-69.9563,-30.358],[-69.9277,-29.7694],[-70.0269,-29.3242],[-69.8278,-29.1031],[-69.6569,-28.4138],[-69.1744,-27.9246],[-68.8463,-27.1536],[-68.3461,-27.0279],[-68.5811,-26.5183],[-68.4144,-26.1539],[-68.6002,-25.4859],[-68.3842,-25.0921],[-68.562,-24.8378],[-68.2502,-24.3921],[-67.3562,-24.0339],[-67.0088,-23.0014],[-67.1948,-22.8216],[-66.7117,-22.2161],[-66.3652,-22.1136],[-66.0986,-21.8353],[-65.771,-22.0994],[-65.0579,-22.103],[-64.6056,-22.229],[-64.3739,-22.7612],[-63.9762,-22.0728],[-63.8186,-22.0053],[-62.8434,-21.9973],[-62.6509,-22.2339]]],[[[-68.6532,-54.8538],[-68.6299,-52.6525],[-68.2782,-52.9841],[-68.0085,-53.5638],[-67.2943,-54.0499],[-65.346,-54.8777],[-66.5112,-55.0322],[-66.9305,-54.9248],[-68.6532,-54.8538]]]]},properties:{name:"Argentina",id:"AR"},id:"AR"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[56.2979,25.6505],[56.388,24.9793],[56.064,24.7388],[55.7959,24.8679],[55.7608,24.2425],[55.1997,23.0346],[55.186,22.704],[55.1043,22.6214],[52.555,22.933],[51.5927,24.0787],[51.5683,24.286],[51.9061,23.9855],[52.6483,24.1546],[53.8934,24.0769],[54.3972,24.278],[54.747,24.8102],[55.941,25.7939],[56.0804,26.0624],[56.2979,25.6505]]]},properties:{name:"United Arab Emirates",id:"AE"},id:"AE"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[1.7059,42.5033],[1.4861,42.4345],[1.4284,42.5961],[1.7059,42.5033]]]},properties:{name:"Andorra",id:"AD"},id:"AD"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[19.9893,60.3511],[20.2588,60.2612],[19.7461,60.099],[19.6871,60.2677],[19.9893,60.3511]]]},properties:{name:"Aland Islands",id:"AX"},id:"AX"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[20.0639,42.5473],[20.4856,42.2232],[20.566,41.8739],[20.4892,41.2724],[20.9641,40.8498],[21.0312,40.6585],[20.6574,40.1174],[20.0013,39.7095],[19.8517,40.0437],[19.3981,40.2847],[19.4407,41.4247],[19.3426,41.869],[19.2809,42.1726],[19.6546,42.6285],[20.0639,42.5473]]]},properties:{name:"Albania",id:"AL"},id:"AL"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-63.0012,18.222],[-63.1534,18.2002],[-63.026,18.2699],[-63.0012,18.222]]]},properties:{name:"Anguilla",id:"AI"},id:"AI"},{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[[[[12.2137,-5.7589],[12.0184,-5.0042],[12.3846,-4.6189],[12.8809,-4.4454],[13.0726,-4.6349],[12.8298,-4.7366],[12.5222,-5.1489],[12.5035,-5.6958],[12.2137,-5.7589]]],[[[23.9666,-10.8716],[23.9915,-12.4221],[23.8432,-13.0009],[21.9789,-13.0009],[21.9798,-15.9555],[22.1507,-16.5974],[23.3807,-17.6405],[21.4169,-18.0005],[20.625,-17.9965],[20.3928,-17.8873],[19.6396,-17.8687],[18.8259,-17.7661],[18.3962,-17.3995],[16.9136,-17.3915],[13.9382,-17.3888],[13.4038,-17.008],[13.101,-16.9676],[12.5479,-17.2126],[11.7432,-17.2494],[11.8191,-16.7043],[11.7507,-15.8321],[11.9678,-15.6341],[12.2803,-14.6376],[12.5506,-13.4377],[12.9834,-12.7759],[13.4171,-12.5202],[13.7855,-11.8127],[13.8477,-11.0545],[13.2093,-9.7033],[12.9985,-9.0481],[13.3589,-8.6872],[13.3785,-8.3698],[12.8622,-7.2317],[12.8236,-6.9547],[12.5213,-6.5903],[12.3025,-6.0927],[13.0682,-5.8649],[14.3985,-5.8925],[16.3152,-5.8658],[16.7179,-6.2414],[16.7094,-6.4717],[17.1551,-7.4612],[17.536,-8.076],[18.6532,-7.9361],[19.3408,-7.9668],[19.5277,-7.1447],[19.8753,-6.9862],[20.4821,-6.9161],[20.6077,-7.2778],[21.7511,-7.3054],[21.9056,-8.6934],[21.8133,-9.4689],[22.1977,-10.0406],[22.3069,-10.6914],[22.5613,-11.0558],[23.8339,-11.0136],[23.9666,-10.8716]]]]},properties:{name:"Angola",id:"AO"},id:"AO"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[74.8912,37.2317],[74.5415,37.0221],[74.0017,36.8233],[73.7691,36.8885],[72.623,36.8295],[71.6206,36.4366],[71.1852,36.042],[71.4276,35.8338],[71.6206,35.1831],[70.9655,34.5306],[71.0516,34.0498],[69.8682,33.8976],[70.2841,33.3689],[69.9201,33.1123],[69.5015,33.02],[69.2414,32.4336],[69.2791,31.9369],[68.869,31.6342],[68.2138,31.8073],[67.5781,31.5063],[67.2874,31.2178],[66.9243,31.3057],[66.3974,30.9124],[66.1772,29.8355],[65.0954,29.5594],[64.521,29.5643],[64.0989,29.3921],[63.5676,29.4982],[62.4765,29.4085],[60.8434,29.8586],[61.104,30.1285],[61.7844,30.8321],[61.6602,31.3825],[60.854,31.4833],[60.8292,32.2494],[60.5606,33.1376],[60.9171,33.5052],[60.5109,33.6388],[60.4856,34.0947],[61.08,34.8555],[61.262,35.6194],[62.6105,35.2333],[63.0566,35.4459],[63.1086,35.8187],[63.8623,36.0123],[64.5108,36.3408],[64.8162,37.1322],[65.5549,37.2512],[65.7648,37.569],[66.5221,37.3484],[67.069,37.3346],[67.7592,37.1722],[68.0677,36.9498],[68.9604,37.3249],[69.2649,37.1083],[69.4922,37.553],[70.2512,37.664],[70.2148,37.9246],[70.8789,38.4564],[71.2558,38.3068],[71.5518,37.933],[71.4329,37.1273],[71.8022,36.6941],[72.8955,37.2676],[73.4814,37.4718],[73.7496,37.2317],[74.2596,37.4154],[74.8912,37.2317]]]},properties:{name:"Afghanistan",id:"AF"},id:"AF"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-61.7161,17.0368],[-61.8597,17.0133],[-61.8173,17.1691],[-61.7161,17.0368]]]},properties:{name:"Antigua and Barbuda",id:"AG"},id:"AG"},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-69.8992,12.4518],[-69.9421,12.4385],[-70.0661,12.5468],[-69.9732,12.5677],[-69.8992,12.4518]]]},properties:{name:"Aruba",id:"AW"},id:"AW"}]};function T4(ae){var me,Ie,oe="";if(typeof ae=="string"||typeof ae=="number")oe+=ae;else if(typeof ae=="object")if(Array.isArray(ae)){var Ae=ae.length;for(me=0;me<Ae;me++)ae[me]&&(Ie=T4(ae[me]))&&(oe&&(oe+=" "),oe+=Ie)}else for(Ie in ae)ae[Ie]&&(oe&&(oe+=" "),oe+=Ie);return oe}function S4(){for(var ae,me,Ie=0,oe="",Ae=arguments.length;Ie<Ae;Ie++)(ae=arguments[Ie])&&(me=T4(ae))&&(oe&&(oe+=" "),oe+=me);return oe}const P6=({visited:ae})=>Bi.jsx("span",{className:S4("pill",ae?"pill--success":"pill--muted"),children:ae?"Visited":"Not yet"}),L6=ae=>{if(!ae||ae.length!==2)return"";const me=ae.toUpperCase(),Ie=me.codePointAt(0),oe=me.codePointAt(1);if(!Ie||!oe)return"";const Ae=127462,ke="A".codePointAt(0)??65;return String.fromCodePoint(Ae+(Ie-ke),Ae+(oe-ke))},O6=({region:ae,filteredCountries:me,selectedId:Ie,hoveredId:oe,onSelect:Ae,registerRef:ke})=>{const ft=ae.countries.filter(o=>o.visited).length;return Bi.jsxs("div",{className:"region",children:[Bi.jsxs("div",{className:"region__header",children:[Bi.jsx("div",{className:"region__title",children:ae.name}),Bi.jsxs("div",{className:"region__meta",children:[ft,"/",ae.countries.length]})]}),Bi.jsx("div",{className:"region__list",children:me.map(o=>Bi.jsxs("button",{className:S4("country",o.visited&&"country--visited",o.id===Ie&&"country--active",o.id===oe&&"country--hovered"),ref:ke(o.id),onMouseEnter:()=>Ae(o.id,{hoverOnly:!0}),onMouseLeave:()=>Ae(null,{hoverOnly:!0}),onFocus:()=>Ae(o.id,{hoverOnly:!0}),onBlur:()=>Ae(null,{hoverOnly:!0}),onClick:()=>Ae(o.id),children:[Bi.jsxs("div",{className:"country__name",children:[Bi.jsx("span",{className:"country__flag","aria-hidden":"true",children:L6(o.id)}),Bi.jsx("span",{className:"country__label",children:o.name})]}),Bi.jsx("div",{className:"country__code",children:o.id}),Bi.jsx(P6,{visited:o.visited}),o.description?Bi.jsx("div",{className:"country__note",children:o.description}):null]},o.id))})]})},F6=({regions:ae,selectedId:me,hoveredId:Ie,onSelect:oe,search:Ae,visitedOnly:ke,registerRef:ft})=>{const o=Ae.trim().toLowerCase();return Bi.jsx("aside",{className:"panel panel--list","aria-label":"Visited countries list",children:Bi.jsx("div",{className:"panel__content",children:ae.map(Tt=>{const We=Tt.countries.filter(ci=>ke&&!ci.visited?!1:o.length?ci.name.toLowerCase().includes(o)||ci.id.toLowerCase().includes(o):!0);return We.length?Bi.jsx(O6,{region:Tt,filteredCountries:We,selectedId:me,hoveredId:Ie,onSelect:oe,registerRef:ft},Tt.name):null})})})};function E4(ae,me,Ie){if(ae!==null)for(var oe,Ae,ke,ft,o,Tt,We,ci=0,Ft=0,Pi,Hi=ae.type,yn=Hi==="FeatureCollection",hi=Hi==="Feature",$i=yn?ae.features.length:1,vn=0;vn<$i;vn++){We=yn?ae.features[vn].geometry:hi?ae.geometry:ae,Pi=We?We.type==="GeometryCollection":!1,o=Pi?We.geometries.length:1;for(var Ci=0;Ci<o;Ci++){var ki=0,si=0;if(ft=Pi?We.geometries[Ci]:We,ft!==null){Tt=ft.coordinates;var _n=ft.type;switch(ci=0,_n){case null:break;case"Point":if(me(Tt,Ft,vn,ki,si)===!1)return!1;Ft++,ki++;break;case"LineString":case"MultiPoint":for(oe=0;oe<Tt.length;oe++){if(me(Tt[oe],Ft,vn,ki,si)===!1)return!1;Ft++,_n==="MultiPoint"&&ki++}_n==="LineString"&&ki++;break;case"Polygon":case"MultiLineString":for(oe=0;oe<Tt.length;oe++){for(Ae=0;Ae<Tt[oe].length-ci;Ae++){if(me(Tt[oe][Ae],Ft,vn,ki,si)===!1)return!1;Ft++}_n==="MultiLineString"&&ki++,_n==="Polygon"&&si++}_n==="Polygon"&&ki++;break;case"MultiPolygon":for(oe=0;oe<Tt.length;oe++){for(si=0,Ae=0;Ae<Tt[oe].length;Ae++){for(ke=0;ke<Tt[oe][Ae].length-ci;ke++){if(me(Tt[oe][Ae][ke],Ft,vn,ki,si)===!1)return!1;Ft++}si++}ki++}break;case"GeometryCollection":for(oe=0;oe<ft.geometries.length;oe++)if(E4(ft.geometries[oe],me)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function B6(ae,me={}){if(ae.bbox!=null&&me.recompute!==!0)return ae.bbox;const Ie=[1/0,1/0,-1/0,-1/0];return E4(ae,oe=>{Ie[0]>oe[0]&&(Ie[0]=oe[0]),Ie[1]>oe[1]&&(Ie[1]=oe[1]),Ie[2]<oe[0]&&(Ie[2]=oe[0]),Ie[3]<oe[1]&&(Ie[3]=oe[1])}),Ie}var k6=B6;const N6="modulepreload",U6=function(ae,me){return new URL(ae,me).href},h4={},V6=function(me,Ie,oe){let Ae=Promise.resolve();if(Ie&&Ie.length>0){let We=function(ci){return Promise.all(ci.map(Ft=>Promise.resolve(Ft).then(Pi=>({status:"fulfilled",value:Pi}),Pi=>({status:"rejected",reason:Pi}))))};const ft=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),Tt=o?.nonce||o?.getAttribute("nonce");Ae=We(Ie.map(ci=>{if(ci=U6(ci,oe),ci in h4)return;h4[ci]=!0;const Ft=ci.endsWith(".css"),Pi=Ft?'[rel="stylesheet"]':"";if(oe)for(let yn=ft.length-1;yn>=0;yn--){const hi=ft[yn];if(hi.href===ci&&(!Ft||hi.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${ci}"]${Pi}`))return;const Hi=document.createElement("link");if(Hi.rel=Ft?"stylesheet":N6,Ft||(Hi.as="script"),Hi.crossOrigin="",Hi.href=ci,Tt&&Hi.setAttribute("nonce",Tt),document.head.appendChild(Hi),Ft)return new Promise((yn,hi)=>{Hi.addEventListener("load",yn),Hi.addEventListener("error",()=>hi(new Error(`Unable to preload CSS for ${ci}`)))})}))}function ke(ft){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=ft,window.dispatchEvent(o),!o.defaultPrevented)throw ft}return Ae.then(ft=>{for(const o of ft||[])o.status==="rejected"&&ke(o.reason);return me().catch(ke)})},j6=di.createContext(null);function G6(ae){return{longitude:ae.center.lng,latitude:ae.center.lat,zoom:ae._seaLevelZoom??ae.zoom,pitch:ae.pitch,bearing:ae.bearing,padding:ae.padding,elevation:ae._centerAltitude}}function H6(ae){return Number.isFinite(ae.longitude)||Number.isFinite(ae.latitude)||Number.isFinite(ae.zoom)||Number.isFinite(ae.pitch)||Number.isFinite(ae.bearing)}function q6(ae,me){return!!(Number.isFinite(me.longitude)&&ae.center.lng!==me.longitude||Number.isFinite(me.latitude)&&ae.center.lat!==me.latitude||Number.isFinite(me.bearing)&&ae.bearing!==me.bearing||Number.isFinite(me.pitch)&&ae.pitch!==me.pitch||Number.isFinite(me.zoom)&&(ae._seaLevelZoom??ae.zoom)!==me.zoom||me.padding&&!ae.isPaddingEqual(me.padding))}function d4(){}function Z6(ae,me){const Ie=ae._constrain,oe=ae._calcMatrices;if(ae._constrain=d4,ae._calcMatrices=d4,Number.isFinite(me.bearing)&&(ae.bearing=me.bearing),Number.isFinite(me.pitch)&&(ae.pitch=me.pitch),me.padding&&!ae.isPaddingEqual(me.padding)&&(ae.padding=me.padding),Number.isFinite(me.longitude)||Number.isFinite(me.latitude)){const Ae=ae.center;ae._center=new Ae.constructor(me.longitude??Ae.lng,me.latitude??Ae.lat)}if(Number.isFinite(me.zoom))if(ae._centerAltitude=me.elevation??0,ae.elevation){ae._seaLevelZoom=me.zoom;const Ae=ae.pixelsPerMeter/ae.worldSize*ae._centerAltitude,ke=ae._mercatorZfromZoom(me.zoom),ft=ae._mercatorZfromZoom(ae._maxZoom),o=Math.max(ke-Ae,ft);ae._setZoom(ae._zoomFromMercatorZ(o))}else ae._seaLevelZoom=null,ae.zoom=me.zoom;ae._constrain=Ie,ae._calcMatrices=oe,ae._unmodified||(ae._constrain(),ae._calcMatrices())}const X6=new Set(["_calcMatrices","_calcFogMatrices","_updateCameraState","_updateSeaLevelZoom"]);function $6(ae){let me=!1,Ie={};const oe=ae;let Ae=null;const ke={get(ft,o){return o==="$reactViewState"?Ie:o==="$proposedTransform"?Ae:o==="$internalUpdate"?me:o==="_setZoom"?Tt=>{me&&Ae?.[o](Tt),Number.isFinite(Ie.zoom)||oe[o](Tt)}:(me&&o==="_translateCameraConstrained"&&H6(Ie)&&(Ae=Ae||oe.clone()),X6.has(o)?function(...Tt){Ae?.[o](...Tt),oe[o](...Tt)}:me&&Ae?Ae[o]:oe[o])},set(ft,o,Tt){if(o==="$reactViewState")return Ie=Tt,Z6(oe,Ie),!0;if(o==="$proposedTransform")return Ae=Tt,!0;if(o==="$internalUpdate")return me=Tt,!0;let We=Tt;return o==="center"||o==="_center"?(Number.isFinite(Ie.longitude)||Number.isFinite(Ie.latitude))&&(We=new Tt.constructor(Ie.longitude??Tt.lng,Ie.latitude??Tt.lat)):o==="zoom"||o==="_zoom"||o==="_seaLevelZoom"?Number.isFinite(Ie.zoom)&&(We=oe[o]):o==="_centerAltitude"?Number.isFinite(Ie.elevation)&&(We=oe[o]):o==="pitch"||o==="_pitch"?Number.isFinite(Ie.pitch)&&(We=oe[o]):(o==="bearing"||o==="rotation"||o==="angle")&&Number.isFinite(Ie.bearing)&&(We=oe[o]),me&&We!==Tt&&(Ae=Ae||oe.clone()),me&&Ae&&(Ae[o]=Tt),oe[o]=We,!0}};return new Proxy(ae,ke)}const W6=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function f4(ae){if(!ae)return null;if(typeof ae=="string"||("toJS"in ae&&(ae=ae.toJS()),!ae.layers))return ae;const me={};for(const oe of ae.layers)me[oe.id]=oe;const Ie=ae.layers.map(oe=>{let Ae=null;"interactive"in oe&&(Ae=Object.assign({},oe),delete Ae.interactive);const ke=me[oe.ref];if(ke){Ae=Ae||Object.assign({},oe),delete Ae.ref;for(const ft of W6)ft in ke&&(Ae[ft]=ke[ft])}return Ae||oe});return{...ae,layers:Ie}}function Y6(ae,me){const Ie=Array.isArray(ae)?ae[0]:ae?ae.x:0,oe=Array.isArray(ae)?ae[1]:ae?ae.y:0,Ae=Array.isArray(me)?me[0]:me?me.x:0,ke=Array.isArray(me)?me[1]:me?me.y:0;return Ie===Ae&&oe===ke}function _c(ae,me){if(ae===me)return!0;if(!ae||!me)return!1;if(Array.isArray(ae)){if(!Array.isArray(me)||ae.length!==me.length)return!1;for(let Ie=0;Ie<ae.length;Ie++)if(!_c(ae[Ie],me[Ie]))return!1;return!0}else if(Array.isArray(me))return!1;if(typeof ae=="object"&&typeof me=="object"){const Ie=Object.keys(ae),oe=Object.keys(me);if(Ie.length!==oe.length)return!1;for(const Ae of Ie)if(!me.hasOwnProperty(Ae)||!_c(ae[Ae],me[Ae]))return!1;return!0}return!1}var p4={};const m4={version:8,sources:{},layers:[]},_4={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},g4={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},y4={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},K6=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],J6=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Vp{constructor(me,Ie,oe){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=Ae=>{const ke=this.props[y4[Ae.type]];ke?ke(Ae):Ae.type==="error"&&console.error(Ae.error)},this._onPointerEvent=Ae=>{(Ae.type==="mousemove"||Ae.type==="mouseout")&&this._updateHover(Ae);const ke=this.props[_4[Ae.type]];ke&&(this.props.interactiveLayerIds&&Ae.type!=="mouseover"&&Ae.type!=="mouseout"&&(Ae.features=this._hoveredFeatures||this._queryRenderedFeatures(Ae.point)),ke(Ae),delete Ae.features)},this._onCameraEvent=Ae=>{if(!this._internalUpdate){const ke=this.props[g4[Ae.type]],ft=this._proxyTransform;ke&&(Ae.viewState=G6(ft.$proposedTransform??ft),ke(Ae)),Ae.type==="moveend"&&(ft.$proposedTransform=null)}Ae.type in this._deferredEvents&&(this._deferredEvents[Ae.type]=!1)},this._MapClass=me,this.props=Ie,this._initialize(oe)}get map(){return this._map}get transform(){return this._map.transform}setProps(me){const Ie=this.props;this.props=me;const oe=this._updateSettings(me,Ie);oe&&this._createProxyTransform(this._map);const Ae=this._updateSize(me),ke=this._updateViewState(me,!0);this._updateStyle(me,Ie),this._updateStyleComponents(me,Ie),this._updateHandlers(me,Ie),(oe||Ae||ke&&!this._map.isMoving())&&this.redraw()}static reuse(me,Ie){const oe=Vp.savedMaps.pop();if(!oe)return null;const Ae=oe.map,ke=Ae.getContainer();for(Ie.className=ke.className;ke.childNodes.length>0;)Ie.appendChild(ke.childNodes[0]);Ae._container=Ie,oe.setProps({...me,styleDiffing:!1}),Ae.resize();const{initialViewState:ft}=me;return ft&&(ft.bounds?Ae.fitBounds(ft.bounds,{...ft.fitBoundsOptions,duration:0}):oe._updateViewState(ft,!1)),Ae.isStyleLoaded()?Ae.fire("load"):Ae.once("styledata",()=>Ae.fire("load")),Ae._update(),oe}_initialize(me){const{props:Ie}=this,{mapStyle:oe=m4}=Ie,Ae={...Ie,...Ie.initialViewState,accessToken:Ie.mapboxAccessToken||Q6()||null,container:me,style:f4(oe)},ke=Ae.initialViewState||Ae.viewState||Ae;if(Object.assign(Ae,{center:[ke.longitude||0,ke.latitude||0],zoom:ke.zoom||0,pitch:ke.pitch||0,bearing:ke.bearing||0}),Ie.gl){const Ft=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=Ft,Ie.gl)}const ft=new this._MapClass(Ae);ke.padding&&ft.setPadding(ke.padding),Ie.cursor&&(ft.getCanvas().style.cursor=Ie.cursor),this._createProxyTransform(ft);const o=ft._render;ft._render=Ft=>{this._inRender=!0,o.call(ft,Ft),this._inRender=!1};const Tt=ft._renderTaskQueue.run;ft._renderTaskQueue.run=Ft=>{this._proxyTransform.$internalUpdate=!0,Tt.call(ft._renderTaskQueue,Ft),this._proxyTransform.$internalUpdate=!1,this._fireDefferedEvents()};const We=ft.jumpTo;ft.jumpTo=(...Ft)=>(this._proxyTransform.$internalUpdate=!0,We.apply(ft,Ft),this._proxyTransform.$internalUpdate=!1,ft);const ci=ft.fire;ft.fire=this._fireEvent.bind(this,ci),ft.on("styledata",()=>{this._updateStyleComponents(this.props,{})}),ft.on("sourcedata",()=>{this._updateStyleComponents(this.props,{})});for(const Ft in _4)ft.on(Ft,this._onPointerEvent);for(const Ft in g4)ft.on(Ft,this._onCameraEvent);for(const Ft in y4)ft.on(Ft,this._onEvent);this._map=ft}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),Vp.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const me=this._map;!this._inRender&&me.style&&(me._frame&&(me._frame.cancel(),me._frame=null),me._render())}_createProxyTransform(me){const Ie=$6(me.transform);me.transform=Ie,me.painter.transform=Ie,this._proxyTransform=Ie}_updateSize(me){const{viewState:Ie}=me;if(Ie){const oe=this._map;if(Ie.width!==oe.transform.width||Ie.height!==oe.transform.height)return oe.resize(),!0}return!1}_updateViewState(me,Ie){const oe=me.viewState||me,Ae=this._proxyTransform,{zoom:ke,pitch:ft,bearing:o}=Ae,Tt=q6(this._proxyTransform,oe);if(Ae.$reactViewState=oe,Tt&&Ie){const We=this._deferredEvents;We.move=!0,We.zoom||(We.zoom=ke!==Ae.zoom),We.rotate||(We.rotate=o!==Ae.bearing),We.pitch||(We.pitch=ft!==Ae.pitch)}return Tt}_updateSettings(me,Ie){const oe=this._map;let Ae=!1;for(const ke of K6)ke in me&&!_c(me[ke],Ie[ke])&&(Ae=!0,oe[`set${ke[0].toUpperCase()}${ke.slice(1)}`]?.call(oe,me[ke]));return Ae}_updateStyle(me,Ie){if(me.cursor!==Ie.cursor&&(this._map.getCanvas().style.cursor=me.cursor||""),me.mapStyle!==Ie.mapStyle){const{mapStyle:oe=m4,styleDiffing:Ae=!0}=me,ke={diff:Ae};return"localIdeographFontFamily"in me&&(ke.localIdeographFontFamily=me.localIdeographFontFamily),this._map.setStyle(f4(oe),ke),!0}return!1}_updateStyleComponents(me,Ie){const oe=this._map;let Ae=!1;return oe.isStyleLoaded()&&("light"in me&&oe.setLight&&!_c(me.light,Ie.light)&&(Ae=!0,oe.setLight(me.light)),"fog"in me&&oe.setFog&&!_c(me.fog,Ie.fog)&&(Ae=!0,oe.setFog(me.fog)),"terrain"in me&&oe.setTerrain&&!_c(me.terrain,Ie.terrain)&&(!me.terrain||oe.getSource(me.terrain.source))&&(Ae=!0,oe.setTerrain(me.terrain))),Ae}_updateHandlers(me,Ie){const oe=this._map;let Ae=!1;for(const ke of J6){const ft=me[ke]??!0,o=Ie[ke]??!0;_c(ft,o)||(Ae=!0,ft?oe[ke].enable(ft):oe[ke].disable())}return Ae}_queryRenderedFeatures(me){const Ie=this._map,{interactiveLayerIds:oe=[]}=this.props;try{return Ie.queryRenderedFeatures(me,{layers:oe.filter(Ie.getLayer.bind(Ie))})}catch{return[]}}_updateHover(me){const{props:Ie}=this;if(Ie.interactiveLayerIds&&(Ie.onMouseMove||Ie.onMouseEnter||Ie.onMouseLeave)){const Ae=me.type,ke=this._hoveredFeatures?.length>0,ft=this._queryRenderedFeatures(me.point),o=ft.length>0;!o&&ke&&(me.type="mouseleave",this._onPointerEvent(me)),this._hoveredFeatures=ft,o&&!ke&&(me.type="mouseenter",this._onPointerEvent(me)),me.type=Ae}else this._hoveredFeatures=null}_fireEvent(me,Ie,oe){const Ae=this._map,ke=this._proxyTransform,ft=ke.$internalUpdate;try{ke.$internalUpdate=!1,me.call(Ae,Ie,oe)}finally{ke.$internalUpdate=ft}return Ae}_fireDefferedEvents(){const me=this._map;this._internalUpdate=!0;for(const Ie in this._deferredEvents)this._deferredEvents[Ie]&&me.fire(Ie);this._internalUpdate=!1}}Vp.savedMaps=[];function Q6(){let ae=null;if(typeof location<"u"){const me=/access_token=([^&\/]*)/.exec(location.search);ae=me&&me[1]}try{ae=ae||p4.MapboxAccessToken}catch{}try{ae=ae||p4.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return ae}const e7=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function t7(ae){if(!ae)return null;const me=ae.map,Ie={getMap:()=>me,getCenter:()=>ae.transform.center,getZoom:()=>ae.transform.zoom,getBearing:()=>ae.transform.bearing,getPitch:()=>ae.transform.pitch,getPadding:()=>ae.transform.padding,getBounds:()=>ae.transform.getBounds(),project:oe=>{const Ae=me.transform;me.transform=ae.transform;const ke=me.project(oe);return me.transform=Ae,ke},unproject:oe=>{const Ae=me.transform;me.transform=ae.transform;const ke=me.unproject(oe);return me.transform=Ae,ke},queryTerrainElevation:(oe,Ae)=>{const ke=me.transform;me.transform=ae.transform;const ft=me.queryTerrainElevation(oe,Ae);return me.transform=ke,ft},queryRenderedFeatures:(oe,Ae)=>{const ke=me.transform;me.transform=ae.transform;const ft=me.queryRenderedFeatures(oe,Ae);return me.transform=ke,ft}};for(const oe of i7(me))!(oe in Ie)&&!e7.includes(oe)&&(Ie[oe]=me[oe].bind(me));return Ie}function i7(ae){const me=new Set;let Ie=ae;for(;Ie;){for(const oe of Object.getOwnPropertyNames(Ie))oe[0]!=="_"&&typeof ae[oe]=="function"&&oe!=="fire"&&oe!=="setEventedParent"&&me.add(oe);Ie=Object.getPrototypeOf(Ie)}return Array.from(me)}const n7=typeof document<"u"?di.useLayoutEffect:di.useEffect,r7=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function a7(ae,me){for(const oe of r7)oe in me&&(ae[oe]=me[oe]);const{RTLTextPlugin:Ie="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=me;Ie&&ae.getRTLTextPluginStatus&&ae.getRTLTextPluginStatus()==="unavailable"&&ae.setRTLTextPlugin(Ie,oe=>{oe&&console.error(oe)},!0)}const jp=di.createContext(null);function o7(ae,me){const Ie=di.useContext(j6),[oe,Ae]=di.useState(null),ke=di.useRef(),{current:ft}=di.useRef({mapLib:null,map:null});di.useEffect(()=>{const We=ae.mapLib;let ci=!0,Ft;return Promise.resolve(We||V6(()=>Promise.resolve().then(()=>T7),void 0,import.meta.url)).then(Pi=>{if(!ci)return;if(!Pi)throw new Error("Invalid mapLib");const Hi="Map"in Pi?Pi:Pi.default;if(!Hi.Map)throw new Error("Invalid mapLib");a7(Hi,ae),ae.reuseMaps&&(Ft=Vp.reuse(ae,ke.current)),Ft||(Ft=new Vp(Hi.Map,ae,ke.current)),ft.map=t7(Ft),ft.mapLib=Hi,Ae(Ft),Ie?.onMapMount(ft.map,ae.id)}).catch(Pi=>{const{onError:Hi}=ae;Hi?Hi({type:"error",target:null,error:Pi}):console.error(Pi)}),()=>{ci=!1,Ft&&(Ie?.onMapUnmount(ae.id),ae.reuseMaps?Ft.recycle():Ft.destroy())}},[]),n7(()=>{oe&&oe.setProps(ae)}),di.useImperativeHandle(me,()=>ft.map,[oe]);const o=di.useMemo(()=>({position:"relative",width:"100%",height:"100%",...ae.style}),[ae.style]),Tt={height:"100%"};return di.createElement("div",{id:ae.id,ref:ke,style:o},oe&&di.createElement(jp.Provider,{value:ft},di.createElement("div",{"mapboxgl-children":"",style:Tt},ae.children)))}const s7=di.forwardRef(o7);var A4=w4();const l7=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function V1(ae,me){if(!ae||!me)return;const Ie=ae.style;for(const oe in me){const Ae=me[oe];Number.isFinite(Ae)&&!l7.test(oe)?Ie[oe]=`${Ae}px`:Ie[oe]=Ae}}function M4(ae,me){if(ae===me)return null;const Ie=v4(ae),oe=v4(me),Ae=[];for(const ke of oe)Ie.has(ke)||Ae.push(ke);for(const ke of Ie)oe.has(ke)||Ae.push(ke);return Ae.length===0?null:Ae}function v4(ae){return new Set(ae?ae.trim().split(/\s+/):[])}di.memo(di.forwardRef((ae,me)=>{const{map:Ie,mapLib:oe}=di.useContext(jp),Ae=di.useRef({props:ae}),ke=di.useMemo(()=>{let vn=!1;di.Children.forEach(ae.children,si=>{si&&(vn=!0)});const Ci={...ae,element:vn?document.createElement("div"):null},ki=new oe.Marker(Ci);return ki.setLngLat([ae.longitude,ae.latitude]),ki.getElement().addEventListener("click",si=>{Ae.current.props.onClick?.({type:"click",target:ki,originalEvent:si})}),ki.on("dragstart",si=>{const _n=si;_n.lngLat=ke.getLngLat(),Ae.current.props.onDragStart?.(_n)}),ki.on("drag",si=>{const _n=si;_n.lngLat=ke.getLngLat(),Ae.current.props.onDrag?.(_n)}),ki.on("dragend",si=>{const _n=si;_n.lngLat=ke.getLngLat(),Ae.current.props.onDragEnd?.(_n)}),ki},[]);di.useEffect(()=>(ke.addTo(Ie.getMap()),()=>{ke.remove()}),[]);const{longitude:ft,latitude:o,offset:Tt,style:We,draggable:ci=!1,popup:Ft=null,rotation:Pi=0,rotationAlignment:Hi="auto",pitchAlignment:yn="auto"}=ae;di.useEffect(()=>{V1(ke.getElement(),We)},[We]),di.useImperativeHandle(me,()=>ke,[]);const hi=Ae.current.props;(ke.getLngLat().lng!==ft||ke.getLngLat().lat!==o)&&ke.setLngLat([ft,o]),Tt&&!Y6(ke.getOffset(),Tt)&&ke.setOffset(Tt),ke.isDraggable()!==ci&&ke.setDraggable(ci),ke.getRotation()!==Pi&&ke.setRotation(Pi),ke.getRotationAlignment()!==Hi&&ke.setRotationAlignment(Hi),ke.getPitchAlignment()!==yn&&ke.setPitchAlignment(yn),ke.getPopup()!==Ft&&ke.setPopup(Ft);const $i=M4(hi.className,ae.className);if($i)for(const vn of $i)ke.toggleClassName(vn);return Ae.current.props=ae,A4.createPortal(ae.children,ke.getElement())}));di.memo(di.forwardRef((ae,me)=>{const{map:Ie,mapLib:oe}=di.useContext(jp),Ae=di.useMemo(()=>document.createElement("div"),[]),ke=di.useRef({props:ae}),ft=di.useMemo(()=>{const o={...ae},Tt=new oe.Popup(o);return Tt.setLngLat([ae.longitude,ae.latitude]),Tt.once("open",We=>{ke.current.props.onOpen?.(We)}),Tt},[]);if(di.useEffect(()=>{const o=Tt=>{ke.current.props.onClose?.(Tt)};return ft.on("close",o),ft.setDOMContent(Ae).addTo(Ie.getMap()),()=>{ft.off("close",o),ft.isOpen()&&ft.remove()}},[]),di.useEffect(()=>{V1(ft.getElement(),ae.style)},[ae.style]),di.useImperativeHandle(me,()=>ft,[]),ft.isOpen()){const o=ke.current.props;(ft.getLngLat().lng!==ae.longitude||ft.getLngLat().lat!==ae.latitude)&&ft.setLngLat([ae.longitude,ae.latitude]),ae.offset&&!_c(o.offset,ae.offset)&&(ft.options.anchor=ae.anchor,ft.setOffset(ae.offset)),(o.anchor!==ae.anchor||o.maxWidth!==ae.maxWidth)&&ft.setMaxWidth(ae.maxWidth);const Tt=M4(o.className,ae.className);if(Tt)for(const We of Tt)ft.toggleClassName(We);ke.current.props=ae}return A4.createPortal(ae.children,Ae)}));function Wm(ae,me,Ie,oe){const Ae=di.useContext(jp),ke=di.useMemo(()=>ae(Ae),[]);return di.useEffect(()=>{const ft=me,o=null,Tt=typeof me=="function"?me:null,{map:We}=Ae;return We.hasControl(ke)||(We.addControl(ke,ft?.position),o&&o(Ae)),()=>{Tt&&Tt(Ae),We.hasControl(ke)&&We.removeControl(ke)}},[]),ke}function c7(ae){const me=Wm(({mapLib:Ie})=>new Ie.AttributionControl(ae),{position:ae.position});return di.useEffect(()=>{V1(me._container,ae.style)},[ae.style]),null}di.memo(c7);function u7(ae){const me=Wm(({mapLib:Ie})=>new Ie.FullscreenControl({container:ae.containerId&&document.getElementById(ae.containerId)}),{position:ae.position});return di.useEffect(()=>{V1(me._controlContainer,ae.style)},[ae.style]),null}di.memo(u7);function h7(ae,me){const Ie=di.useRef({props:ae}),oe=Wm(({mapLib:Ae})=>{const ke=new Ae.GeolocateControl(ae),ft=ke._setupUI.bind(ke);return ke._setupUI=o=>{ke._container.hasChildNodes()||ft(o)},ke.on("geolocate",o=>{Ie.current.props.onGeolocate?.(o)}),ke.on("error",o=>{Ie.current.props.onError?.(o)}),ke.on("outofmaxbounds",o=>{Ie.current.props.onOutOfMaxBounds?.(o)}),ke.on("trackuserlocationstart",o=>{Ie.current.props.onTrackUserLocationStart?.(o)}),ke.on("trackuserlocationend",o=>{Ie.current.props.onTrackUserLocationEnd?.(o)}),ke},{position:ae.position});return Ie.current.props=ae,di.useImperativeHandle(me,()=>oe,[]),di.useEffect(()=>{V1(oe._container,ae.style)},[ae.style]),null}di.memo(di.forwardRef(h7));function d7(ae){const me=Wm(({mapLib:Ie})=>new Ie.NavigationControl(ae),{position:ae.position});return di.useEffect(()=>{V1(me._container,ae.style)},[ae.style]),null}di.memo(d7);function f7(ae){const me=Wm(({mapLib:ke})=>new ke.ScaleControl(ae),{position:ae.position}),Ie=di.useRef(ae),oe=Ie.current;Ie.current=ae;const{style:Ae}=ae;return ae.maxWidth!==void 0&&ae.maxWidth!==oe.maxWidth&&(me.options.maxWidth=ae.maxWidth),ae.unit!==void 0&&ae.unit!==oe.unit&&me.setUnit(ae.unit),di.useEffect(()=>{V1(me._container,Ae)},[Ae]),null}di.memo(f7);function l_(ae,me){if(!ae)throw new Error(me)}let p7=0;function m7(ae,me,Ie){if(ae.style&&ae.style._loaded){const oe={...Ie};return delete oe.id,delete oe.children,ae.addSource(me,oe),ae.getSource(me)}return null}function _7(ae,me,Ie){l_(me.id===Ie.id,"source id changed"),l_(me.type===Ie.type,"source type changed");let oe="",Ae=0;for(const ft in me)ft!=="children"&&ft!=="id"&&!_c(Ie[ft],me[ft])&&(oe=ft,Ae++);if(!Ae)return;const ke=me.type;ke==="geojson"?ae.setData(me.data):ke==="image"?ae.updateImage({url:me.url,coordinates:me.coordinates}):"setCoordinates"in ae&&Ae===1&&oe==="coordinates"?ae.setCoordinates(me.coordinates):"setUrl"in ae&&oe==="url"?ae.setUrl(me.url):"setTiles"in ae&&oe==="tiles"?ae.setTiles(me.tiles):console.warn(`Unable to update <Source> prop: ${oe}`)}function g7(ae){const me=di.useContext(jp).map.getMap(),Ie=di.useRef(ae),[,oe]=di.useState(0),Ae=di.useMemo(()=>ae.id||`jsx-source-${p7++}`,[]);di.useEffect(()=>{if(me){const ft=()=>setTimeout(()=>oe(o=>o+1),0);return me.on("styledata",ft),ft(),()=>{if(me.off("styledata",ft),me.style&&me.style._loaded&&me.getSource(Ae)){const o=me.getStyle()?.layers;if(o)for(const Tt of o)Tt.source===Ae&&me.removeLayer(Tt.id);me.removeSource(Ae)}}}},[me]);let ke=me&&me.style&&me.getSource(Ae);return ke?_7(ke,ae,Ie.current):ke=m7(me,Ae,ae),Ie.current=ae,ke&&di.Children.map(ae.children,ft=>ft&&di.cloneElement(ft,{source:Ae}))||null}function y7(ae,me,Ie,oe){if(l_(Ie.id===oe.id,"layer id changed"),l_(Ie.type===oe.type,"layer type changed"),Ie.type==="custom"||oe.type==="custom")return;const{layout:Ae={},paint:ke={},filter:ft,minzoom:o,maxzoom:Tt,beforeId:We}=Ie;if(We!==oe.beforeId&&ae.moveLayer(me,We),Ae!==oe.layout){const ci=oe.layout||{};for(const Ft in Ae)_c(Ae[Ft],ci[Ft])||ae.setLayoutProperty(me,Ft,Ae[Ft]);for(const Ft in ci)Ae.hasOwnProperty(Ft)||ae.setLayoutProperty(me,Ft,void 0)}if(ke!==oe.paint){const ci=oe.paint||{};for(const Ft in ke)_c(ke[Ft],ci[Ft])||ae.setPaintProperty(me,Ft,ke[Ft]);for(const Ft in ci)ke.hasOwnProperty(Ft)||ae.setPaintProperty(me,Ft,void 0)}_c(ft,oe.filter)||ae.setFilter(me,ft),(o!==oe.minzoom||Tt!==oe.maxzoom)&&ae.setLayerZoomRange(me,o,Tt)}function v7(ae,me,Ie){if(ae.style&&ae.style._loaded&&(!("source"in Ie)||ae.getSource(Ie.source))){const oe={...Ie,id:me};delete oe.beforeId,ae.addLayer(oe,Ie.beforeId)}}let x7=0;function o_(ae){const me=di.useContext(jp).map.getMap(),Ie=di.useRef(ae),[,oe]=di.useState(0),Ae=di.useMemo(()=>ae.id||`jsx-layer-${x7++}`,[]);if(di.useEffect(()=>{if(me){const ft=()=>oe(o=>o+1);return me.on("styledata",ft),ft(),()=>{me.off("styledata",ft),me.style&&me.style._loaded&&me.getLayer(Ae)&&me.removeLayer(Ae)}}},[me]),me&&me.style&&me.getLayer(Ae))try{y7(me,Ae,ae,Ie.current)}catch(ft){console.warn(ft)}else v7(me,Ae,ae);return Ie.current=ae,null}var s_={exports:{}},b7=s_.exports,x4;function w7(){return x4||(x4=1,(function(ae,me){(function(Ie,oe){ae.exports=oe()})(b7,(function(){var Ie,oe,Ae;function ke(o,Tt){if(!Ie)Ie=Tt;else if(!oe)oe=Tt;else{var We="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Ie+")(sharedChunk); ("+oe+")(sharedChunk); self.onerror = null;",ci={};Ie(ci),Ae=Tt(ci),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Ae.workerUrl=window.URL.createObjectURL(new Blob([We],{type:"text/javascript"})))}}ke(["exports"],(function(o){var Tt=1e-6,We=typeof Float32Array<"u"?Float32Array:Array;function ci(n,e){var i=e[0],a=e[1],l=e[2],h=e[3],f=i*h-l*a;return f?(n[0]=h*(f=1/f),n[1]=-a*f,n[2]=-l*f,n[3]=i*f,n):null}function Ft(){var n=new We(9);return We!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Pi(n,e){var i=e[0],a=e[1],l=e[2],h=e[3],f=e[4],m=e[5],v=e[6],x=e[7],S=e[8];return n[0]=f*S-m*x,n[1]=l*x-a*S,n[2]=a*m-l*f,n[3]=m*v-h*S,n[4]=i*S-l*v,n[5]=l*h-i*m,n[6]=h*x-f*v,n[7]=a*v-i*x,n[8]=i*f-a*h,n}function Hi(n,e,i){var a=e[0],l=e[1],h=e[2],f=e[3],m=e[4],v=e[5],x=e[6],S=e[7],E=e[8],A=i[0],R=i[1],D=i[2],F=i[3],k=i[4],U=i[5],q=i[6],$=i[7],Y=i[8];return n[0]=A*a+R*f+D*x,n[1]=A*l+R*m+D*S,n[2]=A*h+R*v+D*E,n[3]=F*a+k*f+U*x,n[4]=F*l+k*m+U*S,n[5]=F*h+k*v+U*E,n[6]=q*a+$*f+Y*x,n[7]=q*l+$*m+Y*S,n[8]=q*h+$*v+Y*E,n}function yn(){var n=new We(16);return We!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function hi(n){var e=new We(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function $i(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function vn(n,e){var i=e[0],a=e[1],l=e[2],h=e[3],f=e[4],m=e[5],v=e[6],x=e[7],S=e[8],E=e[9],A=e[10],R=e[11],D=e[12],F=e[13],k=e[14],U=e[15],q=i*m-a*f,$=i*v-l*f,Y=i*x-h*f,le=a*v-l*m,ne=a*x-h*m,de=l*x-h*v,_e=S*F-E*D,ye=S*k-A*D,Be=S*U-R*D,Ee=E*k-A*F,Ve=E*U-R*F,Xe=A*U-R*k,tt=q*Xe-$*Ve+Y*Ee+le*Be-ne*ye+de*_e;return tt?(n[0]=(m*Xe-v*Ve+x*Ee)*(tt=1/tt),n[1]=(l*Ve-a*Xe-h*Ee)*tt,n[2]=(F*de-k*ne+U*le)*tt,n[3]=(A*ne-E*de-R*le)*tt,n[4]=(v*Be-f*Xe-x*ye)*tt,n[5]=(i*Xe-l*Be+h*ye)*tt,n[6]=(k*Y-D*de-U*$)*tt,n[7]=(S*de-A*Y+R*$)*tt,n[8]=(f*Ve-m*Be+x*_e)*tt,n[9]=(a*Be-i*Ve-h*_e)*tt,n[10]=(D*ne-F*Y+U*q)*tt,n[11]=(E*Y-S*ne-R*q)*tt,n[12]=(m*ye-f*Ee-v*_e)*tt,n[13]=(i*Ee-a*ye+l*_e)*tt,n[14]=(F*$-D*le-k*q)*tt,n[15]=(S*le-E*$+A*q)*tt,n):null}function Ci(n,e,i){var a=e[0],l=e[1],h=e[2],f=e[3],m=e[4],v=e[5],x=e[6],S=e[7],E=e[8],A=e[9],R=e[10],D=e[11],F=e[12],k=e[13],U=e[14],q=e[15],$=i[0],Y=i[1],le=i[2],ne=i[3];return n[0]=$*a+Y*m+le*E+ne*F,n[1]=$*l+Y*v+le*A+ne*k,n[2]=$*h+Y*x+le*R+ne*U,n[3]=$*f+Y*S+le*D+ne*q,n[4]=($=i[4])*a+(Y=i[5])*m+(le=i[6])*E+(ne=i[7])*F,n[5]=$*l+Y*v+le*A+ne*k,n[6]=$*h+Y*x+le*R+ne*U,n[7]=$*f+Y*S+le*D+ne*q,n[8]=($=i[8])*a+(Y=i[9])*m+(le=i[10])*E+(ne=i[11])*F,n[9]=$*l+Y*v+le*A+ne*k,n[10]=$*h+Y*x+le*R+ne*U,n[11]=$*f+Y*S+le*D+ne*q,n[12]=($=i[12])*a+(Y=i[13])*m+(le=i[14])*E+(ne=i[15])*F,n[13]=$*l+Y*v+le*A+ne*k,n[14]=$*h+Y*x+le*R+ne*U,n[15]=$*f+Y*S+le*D+ne*q,n}function ki(n,e,i){var a,l,h,f,m,v,x,S,E,A,R,D,F=i[0],k=i[1],U=i[2];return e===n?(n[12]=e[0]*F+e[4]*k+e[8]*U+e[12],n[13]=e[1]*F+e[5]*k+e[9]*U+e[13],n[14]=e[2]*F+e[6]*k+e[10]*U+e[14],n[15]=e[3]*F+e[7]*k+e[11]*U+e[15]):(l=e[1],h=e[2],f=e[3],m=e[4],v=e[5],x=e[6],S=e[7],E=e[8],A=e[9],R=e[10],D=e[11],n[0]=a=e[0],n[1]=l,n[2]=h,n[3]=f,n[4]=m,n[5]=v,n[6]=x,n[7]=S,n[8]=E,n[9]=A,n[10]=R,n[11]=D,n[12]=a*F+m*k+E*U+e[12],n[13]=l*F+v*k+A*U+e[13],n[14]=h*F+x*k+R*U+e[14],n[15]=f*F+S*k+D*U+e[15]),n}function si(n,e,i){var a=i[0],l=i[1],h=i[2];return n[0]=e[0]*a,n[1]=e[1]*a,n[2]=e[2]*a,n[3]=e[3]*a,n[4]=e[4]*l,n[5]=e[5]*l,n[6]=e[6]*l,n[7]=e[7]*l,n[8]=e[8]*h,n[9]=e[9]*h,n[10]=e[10]*h,n[11]=e[11]*h,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function _n(n,e,i){var a=Math.sin(i),l=Math.cos(i),h=e[4],f=e[5],m=e[6],v=e[7],x=e[8],S=e[9],E=e[10],A=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=h*l+x*a,n[5]=f*l+S*a,n[6]=m*l+E*a,n[7]=v*l+A*a,n[8]=x*l-h*a,n[9]=S*l-f*a,n[10]=E*l-m*a,n[11]=A*l-v*a,n}function mr(n,e,i){var a=Math.sin(i),l=Math.cos(i),h=e[0],f=e[1],m=e[2],v=e[3],x=e[8],S=e[9],E=e[10],A=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=h*l-x*a,n[1]=f*l-S*a,n[2]=m*l-E*a,n[3]=v*l-A*a,n[8]=h*a+x*l,n[9]=f*a+S*l,n[10]=m*a+E*l,n[11]=v*a+A*l,n}function ln(n,e,i){var a=Math.sin(i),l=Math.cos(i),h=e[0],f=e[1],m=e[2],v=e[3],x=e[4],S=e[5],E=e[6],A=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=h*l+x*a,n[1]=f*l+S*a,n[2]=m*l+E*a,n[3]=v*l+A*a,n[4]=x*l-h*a,n[5]=S*l-f*a,n[6]=E*l-m*a,n[7]=A*l-v*a,n}function ea(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Oa(n,e,i){var a,l,h,f=i[0],m=i[1],v=i[2],x=Math.sqrt(f*f+m*m+v*v);return x<Tt?null:(f*=x=1/x,m*=x,v*=x,a=Math.sin(e),l=Math.cos(e),n[0]=f*f*(h=1-l)+l,n[1]=m*f*h+v*a,n[2]=v*f*h-m*a,n[3]=0,n[4]=f*m*h-v*a,n[5]=m*m*h+l,n[6]=v*m*h+f*a,n[7]=0,n[8]=f*v*h+m*a,n[9]=m*v*h-f*a,n[10]=v*v*h+l,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function Ss(n,e){var i=e[0],a=e[1],l=e[2],h=e[4],f=e[5],m=e[6],v=e[8],x=e[9],S=e[10];return n[0]=Math.sqrt(i*i+a*a+l*l),n[1]=Math.sqrt(h*h+f*f+m*m),n[2]=Math.sqrt(v*v+x*x+S*S),n}function no(n,e){var i=e[0],a=e[1],l=e[2],h=e[3],f=i+i,m=a+a,v=l+l,x=i*f,S=a*f,E=a*m,A=l*f,R=l*m,D=l*v,F=h*f,k=h*m,U=h*v;return n[0]=1-E-D,n[1]=S+U,n[2]=A-k,n[3]=0,n[4]=S-U,n[5]=1-x-D,n[6]=R+F,n[7]=0,n[8]=A+k,n[9]=R-F,n[10]=1-x-E,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}var xa=Ci;function Yi(){var n=new We(3);return We!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Bo(n){var e=new We(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function zr(n){var e=n[0],i=n[1],a=n[2];return Math.sqrt(e*e+i*i+a*a)}function yt(n,e,i){var a=new We(3);return a[0]=n,a[1]=e,a[2]=i,a}function jt(n,e,i,a){return n[0]=e,n[1]=i,n[2]=a,n}function _i(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function On(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function Fn(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function Ue(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function Pt(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function qt(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function gi(n,e,i,a){return n[0]=e[0]+i[0]*a,n[1]=e[1]+i[1]*a,n[2]=e[2]+i[2]*a,n}function fn(n,e){var i=e[0]-n[0],a=e[1]-n[1],l=e[2]-n[2];return Math.sqrt(i*i+a*a+l*l)}function En(n,e){var i=e[0]-n[0],a=e[1]-n[1],l=e[2]-n[2];return i*i+a*a+l*l}function Kn(n){var e=n[0],i=n[1],a=n[2];return e*e+i*i+a*a}function Lr(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function Li(n,e){var i=e[0],a=e[1],l=e[2],h=i*i+a*a+l*l;return h>0&&(h=1/Math.sqrt(h)),n[0]=e[0]*h,n[1]=e[1]*h,n[2]=e[2]*h,n}function br(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Br(n,e,i){var a=e[0],l=e[1],h=e[2],f=i[0],m=i[1],v=i[2];return n[0]=l*v-h*m,n[1]=h*f-a*v,n[2]=a*m-l*f,n}function Ol(n,e,i,a){var l=e[0],h=e[1],f=e[2];return n[0]=l+a*(i[0]-l),n[1]=h+a*(i[1]-h),n[2]=f+a*(i[2]-f),n}function sr(n,e,i){var a=e[0],l=e[1],h=e[2],f=i[3]*a+i[7]*l+i[11]*h+i[15];return n[0]=(i[0]*a+i[4]*l+i[8]*h+i[12])/(f=f||1),n[1]=(i[1]*a+i[5]*l+i[9]*h+i[13])/f,n[2]=(i[2]*a+i[6]*l+i[10]*h+i[14])/f,n}function ro(n,e,i){var a=e[0],l=e[1],h=e[2];return n[0]=a*i[0]+l*i[3]+h*i[6],n[1]=a*i[1]+l*i[4]+h*i[7],n[2]=a*i[2]+l*i[5]+h*i[8],n}function $a(n,e,i){var a=i[0],l=i[1],h=i[2],f=i[3],m=e[0],v=e[1],x=e[2],S=l*x-h*v,E=h*m-a*x,A=a*v-l*m;return n[0]=m+f*(S+=S)+l*(A+=A)-h*(E+=E),n[1]=v+f*E+h*S-a*A,n[2]=x+f*A+a*E-l*S,n}function wo(n){return n[0]=0,n[1]=0,n[2]=0,n}function Es(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}var Sr=On,gc=Fn,ol=zr;function Fa(){var n=new We(4);return We!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Fl(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function _h(n,e){var i=e[0],a=e[1],l=e[2],h=e[3],f=i*i+a*a+l*l+h*h;return f>0&&(f=1/Math.sqrt(f)),n[0]=i*f,n[1]=a*f,n[2]=l*f,n[3]=h*f,n}function Er(n,e,i){var a=e[0],l=e[1],h=e[2],f=e[3];return n[0]=i[0]*a+i[4]*l+i[8]*h+i[12]*f,n[1]=i[1]*a+i[5]*l+i[9]*h+i[13]*f,n[2]=i[2]*a+i[6]*l+i[10]*h+i[14]*f,n[3]=i[3]*a+i[7]*l+i[11]*h+i[15]*f,n}function Bl(){var n=new We(4);return We!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function as(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function As(n,e,i){i*=.5;var a=e[0],l=e[1],h=e[2],f=e[3],m=Math.sin(i),v=Math.cos(i);return n[0]=a*v+f*m,n[1]=l*v+h*m,n[2]=h*v-l*m,n[3]=f*v-a*m,n}function Ms(n,e,i){i*=.5;var a=e[0],l=e[1],h=e[2],f=e[3],m=Math.sin(i),v=Math.cos(i);return n[0]=a*v-h*m,n[1]=l*v+f*m,n[2]=h*v+a*m,n[3]=f*v-l*m,n}Yi(),Fa();var Wa,kl,Is,gu=_h,Cs=(Wa=Yi(),kl=yt(1,0,0),Is=yt(0,1,0),function(n,e,i){var a=br(e,i);return a<-.999999?(Br(Wa,kl,e),ol(Wa)<1e-6&&Br(Wa,Is,e),Li(Wa,Wa),(function(l,h,f){f*=.5;var m=Math.sin(f);l[0]=m*h[0],l[1]=m*h[1],l[2]=m*h[2],l[3]=Math.cos(f)})(n,Wa,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Br(Wa,e,i),n[0]=Wa[0],n[1]=Wa[1],n[2]=Wa[2],n[3]=1+a,gu(n,n))});function Vn(){var n=new We(2);return We!=Float32Array&&(n[0]=0,n[1]=0),n}function ao(n,e){var i=new We(2);return i[0]=n,i[1]=e,i}function ba(n,e,i){return n[0]=e,n[1]=i,n}function sl(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n}function os(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n}function ko(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n}function Zn(n){var e=n[0],i=n[1];return Math.sqrt(e*e+i*i)}function ta(n,e){var i=e[0],a=e[1],l=i*i+a*a;return l>0&&(l=1/Math.sqrt(l)),n[0]=e[0]*l,n[1]=e[1]*l,n}function zs(n,e){return n[0]*e[0]+n[1]*e[1]}Bl(),Bl(),Ft();var oo,Ba,Nl=os;function gh(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}Vn();var bd=(function(){if(Ba)return oo;function n(e,i,a,l){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(l-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=a,this.p2y=l}return Ba=1,oo=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,l=0;l<8;l++){var h=this.sampleCurveX(a)-e;if(Math.abs(h)<i)return a;var f=this.sampleCurveDerivativeX(a);if(Math.abs(f)<1e-6)break;a-=h/f}var m=0,v=1;for(a=e,l=0;l<20&&(h=this.sampleCurveX(a),!(Math.abs(h-e)<i));l++)e>h?m=a:v=a,a=.5*(v-m)+m;return a},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},oo})(),Ul=gh(bd);function nt(n,e){this.x=n,this.y=e}function ll(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!ll(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!ll(n[i],e[i]))return!1;return!0}return n===e}nt.prototype={clone(){return new nt(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),i=Math.sin(n),a=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=a,this},_rotateAround(n,e){const i=Math.cos(n),a=Math.sin(n),l=e.y+a*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-a*(this.y-e.y),this.y=l,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:nt},nt.convert=function(n){if(n instanceof nt)return n;if(Array.isArray(n))return new nt(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new nt(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};const yu=Math.PI/180,vu=180/Math.PI;function Ui(n){return n*yu}function pa(n){return n*vu}const yh=[[0,0],[1,0],[1,1],[0,1]];function xu(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function Te(n,e,i,a){const l=new Ul(n,e,i,a);return function(h){return l.solve(h)}}const V=Te(.25,.1,.25,1);function G(n,e,i){return Math.min(i,Math.max(e,n))}function J(n,e,i){return(i=G((i-n)/(e-n),0,1))*i*(3-2*i)}function pe(n,e,i){const a=i-e,l=((n-e)%a+a)%a+e;return l===e?i:l}function fe(n,e,i){if(!n.length)return i(null,[]);let a=n.length;const l=new Array(n.length);let h=null;n.forEach(((f,m)=>{e(f,((v,x)=>{v&&(h=v),l[m]=x,--a==0&&i(h,l)}))}))}let xe=1;function Pe(){return xe++}function be(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log2(n)))}function Ce(n,e){n.forEach((i=>{e[i]&&(e[i]=e[i].bind(e))}))}function ct(n,e,i){const a={};for(const l in n)a[l]=e.call(this,n[l],l,n);return a}function et(n,e,i){const a={};for(const l in n)e.call(this,n[l],l,n)&&(a[l]=n[l]);return a}function kt(n){return Array.isArray(n)?n.map(kt):typeof n=="object"&&n?ct(n,kt):n}function ei(n,e){for(let i=0;i<n.length;i++)if(e.indexOf(n[i])>=0)return!0;return!1}const Jt={};function Gt(n){Jt[n]||(typeof console<"u"&&console.warn(n),Jt[n]=!0)}function Ei(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function Mi(n){let e=0;for(let i,a,l=0,h=n.length,f=h-1;l<h;f=l++)i=n[l],a=n[f],e+=(a.x-i.x)*(i.y+a.y);return e}function rn([n,e,i]){const a=Ui(e+90),l=Ui(i);return{x:n*Math.cos(a)*Math.sin(l),y:n*Math.sin(a)*Math.sin(l),z:n*Math.cos(l),azimuthal:e,polar:i}}function jn(n){return(typeof self<"u"||n!==void 0)&&typeof WorkerGlobalScope<"u"&&(n!==void 0?n:self)instanceof WorkerGlobalScope}function Pr(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,a,l,h)=>{const f=l||h;return e[a]=!f||f.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let wr=null;function _r(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function xn(n,e,i,a){for(;e<i;){const l=e+i>>1;n[l]<a?e=l+1:i=l}return e}function Oi(n,e,i,a){for(;e<i;){const l=e+i>>1;n[l]<=a?e=l+1:i=l}return e}function Rn(n){return n>0?1/(1.001-n):1+n}function An(n){return n>0?1-1/(1.001-n):-n}function qi(n,e,i){return(n-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Bn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Bn.API_URL)return null;try{const n=new URL(Bn.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function kr(n){return Bn.API_URL_REGEX.test(n)}function ma(n){return Bn.API_SPRITE_REGEX.test(n)}let To,Rs,Xr,Nr,wa,No;function ka(){return To==null&&(To=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),To}const _a={now:()=>Nr!==void 0?Nr:performance.now(),setNow(n){Nr=n},restoreNow(){Nr=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:a}=n;wa||(wa=document.createElement("canvas"));const l=wa.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(i>wa.width||a>wa.height)&&(wa.width=i,wa.height=a),l.clearRect(-e,-e,i+2*e,a+2*e),l.drawImage(n,0,0,i,a),l.getImageData(-e,-e,i+2*e,a+2*e)},resolveURL:n=>(Rs||(Rs=document.createElement("a")),Rs.href=n,Rs.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Xr==null&&(Xr=window.matchMedia("(prefers-reduced-motion: reduce)")),Xr.matches)},hasCanvasFingerprintNoise(){if(No!==void 0)return No;if(!ka())return No=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let i=0;for(let l=0;l<n.width;++l)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(l,0,1,1);const a=e.getImageData(0,0,n.width,n.height);i=0;for(let l=0;l<a.data.length;++l)if(l%4!=3&&i++!==a.data[l])return No=!0,!0;return No=!1,!1}};function vh(n,e){const i=n.indexOf("?");if(i<0)return`${n}?${new URLSearchParams(e).toString()}`;const a=new URLSearchParams(n.slice(i));for(const l in e)a.set(l,e[l]);return`${n.slice(0,i)}?${a.toString()}`}function bu(n,e={persistentParams:[]}){const i=n.indexOf("?");if(i<0)return n;const a=new URLSearchParams,l=new URLSearchParams(n.slice(i));for(const f of e.persistentParams){const m=l.get(f);m&&a.set(f,m)}const h=a.toString();return`${n.slice(0,i)}${h.length>0?`?${h}`:""}`}const Ds="mapbox-tiles";let xh=500,Na=50;const Uo=["language","worldview","jobid"];let Ta,So;function cl(){try{return caches}catch{}}function Ps(){const n=cl();n&&Ta==null&&(Ta=n.open(Ds))}let Vo=1/0;const wu={supported:!1,testSupport:function(n){!Vl&&Eo&&(Of?wd(n):jo=n)}};let jo,Eo,Vl=!1,Of=!1;const so=typeof self<"u"?self:{};function wd(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Eo),n.isContextLost())return;wu.supported=!0}catch{}n.deleteTexture(e),Vl=!0}so.document&&(Eo=so.document.createElement("img"),Eo.onload=function(){jo&&wd(jo),jo=null,Of=!0},Eo.onerror=function(){Vl=!0,jo=null},Eo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ss={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ss);class Ya extends Error{constructor(e,i,a){i===401&&kr(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const bh=jn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ul=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(bh())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(a,l){const h=new AbortController,f=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:bh(),referrerPolicy:a.referrerPolicy,signal:h.signal});let m=!1,v=!1;const x=(S=f.url).indexOf("sku=")>0&&kr(S);var S;a.type==="json"&&f.headers.set("Accept","application/json");const E=(R,D,F)=>{if(v)return;if(R&&R.message!=="SecurityError"&&Gt(R.toString()),D&&F)return A(D);const k=Date.now();fetch(f).then((U=>{if(U.ok){const q=x?U.clone():null;return A(U,q,k)}return l(new Ya(U.statusText,U.status,a.url))})).catch((U=>{U.name!=="AbortError"&&l(new Error(`${U.message} ${a.url}`))}))},A=(R,D,F)=>{(a.type==="arrayBuffer"?R.arrayBuffer():a.type==="json"?R.json():R.text()).then((k=>{v||(D&&F&&(function(U,q,$){if(Ps(),Ta==null)return;const Y=Pr(q.headers.get("Cache-Control")||"");if(Y["no-store"])return;const le={status:q.status,statusText:q.statusText,headers:new Headers};q.headers.forEach(((_e,ye)=>le.headers.set(ye,_e))),Y["max-age"]&&le.headers.set("Expires",new Date($+1e3*Y["max-age"]).toUTCString());const ne=le.headers.get("Expires");if(!ne||new Date(ne).getTime()-$<42e4)return;let de=bu(U.url,{persistentParams:Uo});if(q.status===206){const _e=U.headers.get("Range");if(!_e)return;le.status=200,de=vh(de,{range:_e})}(function(_e,ye){if(So===void 0)try{new Response(new ReadableStream),So=!0}catch{So=!1}So?ye(_e.body):_e.blob().then(ye).catch((Be=>Gt(Be.message)))})(q,(_e=>{const ye=new Response((Be=q.status)!==200&&Be!==404&&[101,103,204,205,304].includes(Be)?null:_e,le);var Be;Ps(),Ta?.then((Ee=>Ee.put(de,ye))).catch((Ee=>Gt(Ee.message)))}))})(f,D,F),m=!0,l(null,k,R.headers))})).catch((k=>{v||l(new Error(k.message))}))};return x?(function(R,D){if(Ps(),Ta==null)return D(null);Ta.then((F=>{let k=bu(R.url,{persistentParams:Uo});const U=R.headers.get("Range");U&&(k=vh(k,{range:U})),F.match(k).then((q=>{const $=(function(Y){if(!Y)return!1;const le=new Date(Y.headers.get("Expires")||0),ne=Pr(Y.headers.get("Cache-Control")||"");return Number(le)>Date.now()&&!ne["no-cache"]})(q);F.delete(k).catch(D),$&&F.put(k,q.clone()).catch(D),D(null,q,$)})).catch(D)})).catch(D)})(f,E):E(null,null),{cancel:()=>{v=!0,m||h.abort()}}})(n,e);if(jn(self)&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return(function(a,l){const h=new XMLHttpRequest;h.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const f in a.headers)h.setRequestHeader(f,a.headers[f]);return a.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=a.credentials==="include",h.onerror=()=>{l(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let f=h.response;if(a.type==="json")try{f=JSON.parse(h.response)}catch(v){return l(v)}const m=new Headers;h.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((v=>{const x=v.split(": "),S=x.shift(),E=x.join(": ");m.append(S,E)})),l(null,f,m)}else l(new Ya(h.statusText,h.status,a.url))},h.send(a.body),{cancel:()=>h.abort()}})(n,e)},Ao=function(n,e){return ul(Object.assign(n,{type:"arrayBuffer"}),e)};function Ki(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const Tu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Su,jl;Su=[],jl=0;const Eu=function(n,e){if(wu.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),jl>=Bn.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Su.push(h),h}jl++;let i=!1;const a=()=>{if(!i)for(i=!0,jl--;Su.length&&jl<Bn.MAX_PARALLEL_IMAGE_REQUESTS;){const h=Su.shift(),{requestParameters:f,callback:m,cancelled:v}=h;v||(h.cancel=Eu(f,m).cancel)}},l=Ao(n,((h,f,m)=>{a(),h?e(h):f&&(self.createImageBitmap?(function(v,x){const S=new Blob([new Uint8Array(v)],{type:"image/png"});createImageBitmap(S).then((E=>{x(null,E)})).catch((E=>{x(new Error(`Could not load image because of ${E.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(f,((v,x)=>e(v,x,m))):(function(v,x){const S=new Image;S.onload=()=>{x(null,S),URL.revokeObjectURL(S.src),S.onload=null,requestAnimationFrame((()=>{S.src=Tu}))},S.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const E=new Blob([new Uint8Array(v)],{type:"image/png"});S.src=v.byteLength?URL.createObjectURL(E):Tu})(f,((v,x)=>e(v,x,m))))}));return{cancel:()=>{l.cancel(),a()}}};var Au,Sa,ls,Ls={exports:{}},Mu={exports:{}},Td={exports:{}},Ff=(function(){if(ls)return Ls.exports;ls=1;var n=(Au||(Au=1,Mu.exports=function(i,a){var l,h,f,m,v,x,S,E;for(h=i.length-(l=3&i.length),f=a,v=3432918353,x=461845907,E=0;E<h;)S=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,f=27492+(65535&(m=5*(65535&(f=(f^=S=(65535&(S=(S=(65535&S)*v+(((S>>>16)*v&65535)<<16)&4294967295)<<15|S>>>17))*x+(((S>>>16)*x&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(S=0,l){case 3:S^=(255&i.charCodeAt(E+2))<<16;case 2:S^=(255&i.charCodeAt(E+1))<<8;case 1:f^=S=(65535&(S=(S=(65535&(S^=255&i.charCodeAt(E)))*v+(((S>>>16)*v&65535)<<16)&4294967295)<<15|S>>>17))*x+(((S>>>16)*x&65535)<<16)&4294967295}return f^=i.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),Mu.exports),e=(Sa||(Sa=1,Td.exports=function(i,a){for(var l,h=i.length,f=a^h,m=0;h>=4;)l=1540483477*(65535&(l=255&i.charCodeAt(m)|(255&i.charCodeAt(++m))<<8|(255&i.charCodeAt(++m))<<16|(255&i.charCodeAt(++m))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++m;switch(h){case 3:f^=(255&i.charCodeAt(m+2))<<16;case 2:f^=(255&i.charCodeAt(m+1))<<8;case 1:f=1540483477*(65535&(f^=255&i.charCodeAt(m)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),Td.exports);return Ls.exports=n,Ls.exports.murmur3=n,Ls.exports.murmur2=e,Ls.exports})(),yc=gh(Ff);class Ra{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class Gl extends Ra{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function vc(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function wh(n,e,i){if(i&&i[n]){const a=i[n].indexOf(e);a!==-1&&i[n].splice(a,1)}}class hl{on(e,i){return this._listeners=this._listeners||{},vc(e,i,this._listeners),this}off(e,i){return wh(e,i,this._listeners),wh(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},vc(e,i,this._oneTimeListeners),this):new Promise((a=>{this.once(e,a)}))}fire(e,i){const a=typeof e=="string"?new Ra(e,i):e,l=a.type;if(this.listens(l)){a.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const v of h)v.call(this,a);const f=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const v of f)wh(l,v,this._oneTimeListeners),v.call(this,a);const m=this._eventedParent;if(m){const v=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(a,v),m.fire(a)}}else a instanceof Gl&&console.error(a.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class Ur{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Ur(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,a]=e.split("");return new Ur({name:i,iconsetId:a})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return Ur.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Th,Bf={},kf=(function(){if(Th)return Bf;Th=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(h){return(h=Math.round(h))<0?0:h>255?255:h}function i(h){return e(h[h.length-1]==="%"?parseFloat(h)/100*255:parseInt(h))}function a(h){return(f=h[h.length-1]==="%"?parseFloat(h)/100:parseFloat(h))<0?0:f>1?1:f;var f}function l(h,f,m){return m<0?m+=1:m>1&&(m-=1),6*m<1?h+(f-h)*m*6:2*m<1?f:3*m<2?h+(f-h)*(2/3-m)*6:h}try{Bf.parseCSSColor=function(h){var f,m=h.replace(/ /g,"").toLowerCase();if(m in n)return n[m].slice();if(m[0]==="#")return m.length===4?(f=parseInt(m.substr(1),16))>=0&&f<=4095?[(3840&f)>>4|(3840&f)>>8,240&f|(240&f)>>4,15&f|(15&f)<<4,1]:null:m.length===7&&(f=parseInt(m.substr(1),16))>=0&&f<=16777215?[(16711680&f)>>16,(65280&f)>>8,255&f,1]:null;var v=m.indexOf("("),x=m.indexOf(")");if(v!==-1&&x+1===m.length){var S=m.substr(0,v),E=m.substr(v+1,x-(v+1)).split(","),A=1;switch(S){case"rgba":if(E.length!==4)return null;A=a(E.pop());case"rgb":return E.length!==3?null:[i(E[0]),i(E[1]),i(E[2]),A];case"hsla":if(E.length!==4)return null;A=a(E.pop());case"hsl":if(E.length!==3)return null;var R=(parseFloat(E[0])%360+360)%360/360,D=a(E[1]),F=a(E[2]),k=F<=.5?F*(D+1):F+D-F*D,U=2*F-k;return[e(255*l(U,k,R+1/3)),e(255*l(U,k,R)),e(255*l(U,k,R-1/3)),A];default:return null}}return null}}catch{}return Bf})();class pn{constructor(e,i,a,l=1){this.r=e,this.g=i,this.b=a,this.a=l}static parse(e){if(!e)return;if(e instanceof pn)return e;if(typeof e!="string")return;const i=kf.parseCSSColor(e);return i?new pn(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,a,l]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*a)},${l})`}toNonPremultipliedRenderColor(e){const{r:i,g:a,b:l,a:h}=this;return new j1(e,i,a,l,h)}toPremultipliedRenderColor(e){const{r:i,g:a,b:l,a:h}=this;return new Uf(e,i*h,a*h,l*h,h)}clone(){return new pn(this.r,this.g,this.b,this.a)}}class Nf{constructor(e,i,a,l,h,f=!1){if(this.premultiplied=!1,this.premultiplied=f,e){const m=e.image.height,v=m*m;this.premultiplied?(i=h===0?0:i/h*(m-1),a=h===0?0:a/h*(m-1),l=h===0?0:l/h*(m-1)):(i*=m-1,a*=m-1,l*=m-1);const x=Math.floor(i),S=Math.floor(a),E=Math.floor(l),A=Math.ceil(i),R=Math.ceil(a),D=Math.ceil(l),F=i-x,k=a-S,U=l-E,q=e.image.data,$=4*(x+S*v+E*m),Y=4*(x+S*v+D*m),le=4*(x+R*v+E*m),ne=4*(x+R*v+D*m),de=4*(A+S*v+E*m),_e=4*(A+S*v+D*m),ye=4*(A+R*v+E*m),Be=4*(A+R*v+D*m);if($<0||Be>=q.length)throw new Error("out of range");this.r=ti(ti(ti(q[$],q[Y],U),ti(q[le],q[ne],U),k),ti(ti(q[de],q[_e],U),ti(q[ye],q[Be],U),k),F)/255*(this.premultiplied?h:1),this.g=ti(ti(ti(q[$+1],q[Y+1],U),ti(q[le+1],q[ne+1],U),k),ti(ti(q[de+1],q[_e+1],U),ti(q[ye+1],q[Be+1],U),k),F)/255*(this.premultiplied?h:1),this.b=ti(ti(ti(q[$+2],q[Y+2],U),ti(q[le+2],q[ne+2],U),k),ti(ti(q[de+2],q[_e+2],U),ti(q[ye+2],q[Be+2],U),k),F)/255*(this.premultiplied?h:1),this.a=h}else this.r=i,this.g=a,this.b=l,this.a=h}toArray(){const{r:e,g:i,b:a,a:l}=this;return[255*e,255*i,255*a,l]}toHslaArray(){let{r:e,g:i,b:a,a:l}=this;if(this.premultiplied){if(l===0)return[0,0,0,0];const D=1/l;e*=D,i*=D,a*=D}const h=Math.min(Math.max(e,0),1),f=Math.min(Math.max(i,0),1),m=Math.min(Math.max(a,0),1),v=Math.min(h,f,m),x=Math.max(h,f,m),S=x-v,E=.5*(v+x);if(S===0)return[0,0,100*E,l];const A=E>.5?S/(2-x-v):S/(x+v);let R;switch(x){case h:R=60*((f-m)/S+(f<m?6:0));break;case f:R=60*((m-h)/S+2);break;default:R=60*((h-f)/S+4)}return[R,100*A,100*E,l]}toArray01(){const{r:e,g:i,b:a,a:l}=this;return[e,i,a,l]}toArray01Scaled(e){const{r:i,g:a,b:l}=this;return[i*e,a*e,l*e]}toArray01Linear(){const{r:e,g:i,b:a,a:l}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(a,2.2),l]}}class j1 extends Nf{constructor(e,i,a,l,h){super(e,i,a,l,h,!1)}}class Uf extends Nf{constructor(e,i,a,l,h){super(e,i,a,l,h,!0)}}function ti(n,e,i){return n*(1-i)+e*i}function Sh(n,e,i){return n.map(((a,l)=>ti(a,e[l],i)))}pn.black=new pn(0,0,0,1),pn.white=new pn(1,1,1,1),pn.transparent=new pn(0,0,0,0),pn.red=new pn(1,0,0,1),pn.blue=new pn(0,0,1,1);var dl=Object.freeze({__proto__:null,array:Sh,color:function(n,e,i){return new pn(ti(n.r,e.r,i),ti(n.g,e.g,i),ti(n.b,e.b,i),ti(n.a,e.a,i))},number:ti});class Go extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class lo{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[a,l]of i)this.bindings[a]=l}concat(e){return new lo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Iu={kind:"null"},Xt={kind:"number"},Ji={kind:"string"},on={kind:"boolean"},co={kind:"color"},Cu={kind:"object"},gn={kind:"value"},Eh={kind:"collator"},xc={kind:"formatted"},Ah={kind:"resolvedImage"};function sa(n,e){return{kind:"array",itemType:n,N:e}}function Or(n){if(n.kind==="array"){const e=Or(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Gp=[Iu,Xt,Ji,on,co,xc,Cu,sa(gn),Ah];function bc(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!bc(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of Gp)if(!bc(i,e))return null}}return`Expected ${Or(n)} but found ${Or(e)} instead.`}function wc(n,e){return e.some((i=>i.kind===n.kind))}function Mh(n,e){return e.some((i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n))}function Ih(n,e){return n.kind==="array"&&e.kind==="array"?n.N===e.N&&Ih(n.itemType,e.itemType):n.kind===e.kind}class Sd{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class zu{constructor(e,i,a,l,h){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=a,this.fontStack=l,this.textColor=h}}class $r{constructor(e){this.sections=e}static fromString(e){return new $r([new zu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||!!e.image&&e.image.hasPrimary()))}static factory(e){return e instanceof $r?e:$r.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const l=i.image.getPrimary().id.toString();e.push(["image",l]);continue}e.push(i.text);const a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(a)}return e}}class Os{constructor(e,i={}){if(this.id=Ur.from(e),this.options=Object.assign({},i),i.transform){const{a,b:l,c:h,d:f,e:m,f:v}=i.transform;this.options.transform=new DOMMatrix([a,l,h,f,m,v])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:a,d:l,e:h,f}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:a,d:l,e:h,f}})}static parse(e){let i,a,l,h;try{({name:i,iconsetId:a,params:l,transform:h}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:f,b:m,c:v,d:x,e:S,f:E}=h||{};return new Os({name:i,iconsetId:a},{params:l,transform:new DOMMatrix([f,m,v,x,S,E])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class la{constructor(e,i,a,l,h=!1){this.primaryId=Ur.from(e),this.primaryOptions=i,a&&(this.secondaryId=Ur.from(a)),this.secondaryOptions=l,this.available=h}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Os(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Os(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?la.build({name:e}):e}static build(e,i,a,l){return!e||typeof e=="object"&&!("name"in e)?null:new la(e,a,i,l)}}function Ed(n,e,i,a){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,e,i,a]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ru(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof pn||n instanceof Sd||n instanceof $r||n instanceof la)return!0;if(Array.isArray(n)){for(const e of n)if(!Ru(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Ru(n[e]))return!1;return!0}return!1}function Wr(n){if(n===null)return Iu;if(typeof n=="string")return Ji;if(typeof n=="boolean")return on;if(typeof n=="number")return Xt;if(n instanceof pn)return co;if(n instanceof Sd)return Eh;if(n instanceof $r)return xc;if(n instanceof la)return Ah;if(Array.isArray(n)){const e=n.length;let i;for(const a of n){const l=Wr(a);if(i){if(i===l)continue;i=gn;break}i=l}return sa(i||gn,e)}return Cu}function cs(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof $r||n instanceof la||n instanceof pn?n.toString():JSON.stringify(n)}class Fs{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ru(e[1]))return i.error("invalid value");const a=e[1];let l=Wr(a);const h=i.expectedType;return l.kind!=="array"||l.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(l=h),new Fs(l,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof pn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof $r?this.value.serialize():this.value}}class lr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const xi={string:Ji,number:Xt,boolean:on,object:Cu};class Ut{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,l=1;const h=e[0];if(h==="array"){let m,v;if(e.length>2){const x=e[1];if(typeof x!="string"||!(x in xi)||x==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);m=xi[x],l++}else m=gn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);v=e[2],l++}a=sa(m,v)}else a=xi[h];const f=[];for(;l<e.length;l++){const m=i.parse(e[l],l,gn);if(!m)return null;f.push(m)}return new Ut(a,f)}evaluate(e){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(e);if(!bc(this.type,Wr(a)))return a;if(i===this.args.length-1)throw new lr(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Or(Wr(a))} but was expected to be of type ${Or(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){i.push(a.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&i.push(l)}}return i.concat(this.args.map((a=>a.serialize())))}}class Bs{constructor(e){this.type=xc,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const l=[];let h=!1;for(let f=1;f<=e.length-1;++f){const m=e[f];if(h&&typeof m=="object"&&!Array.isArray(m)){h=!1;let v=null;if(m["font-scale"]&&(v=i.parseObjectValue(m["font-scale"],f,"font-scale",Xt),!v))return null;let x=null;if(m["text-font"]&&(x=i.parseObjectValue(m["text-font"],f,"text-font",sa(Ji)),!x))return null;let S=null;if(m["text-color"]&&(S=i.parseObjectValue(m["text-color"],f,"text-color",co),!S))return null;const E=l[l.length-1];E.scale=v,E.font=x,E.textColor=S}else{const v=i.parse(e[f],f,gn);if(!v)return null;const x=v.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,l.push({content:v,scale:null,font:null,textColor:null})}}return new Bs(l)}evaluate(e){return new $r(this.sections.map((i=>{const a=i.content.evaluate(e);return Ih(Wr(a),Ah)?new zu("",a,null,null,null):new zu(cs(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),e.push(a)}return e}}class li{constructor(e,i,a,l){this._imageWarnHistory={},this.type=Ah,this.namePrimary=e,this.nameSecondary=i,a&&(this.paramsPrimary=a.params,this.iconsetIdPrimary=a.iconset?a.iconset.id:void 0),l&&(this.paramsSecondary=l.params,this.iconsetIdSecondary=l.iconset?l.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let a=1;const l=[];function h(){if(a<e.length){const m=i.parse(e[a],a++,Ji);return m?(l.push({image:m,options:{}}),!0):(i.error(l.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function f(){if(a<e.length){const v=e[a];if((m=v)===null||typeof m!="object"||Array.isArray(m))return!0;const x=v.params,S=v.iconset,E=i.concat(a);if(!x&&!S)return a++,!0;if(x){if(typeof x!="object"||x.constructor!==Object)return E.error('Image options "params" should be an object'),!1;const A={},R=E.concat(void 0,"params");for(const D in x){if(!D)return R.error("Image parameter name should be non-empty"),!1;const F=R.concat(void 0,D).parse(x[D],void 0,co,void 0,{typeAnnotation:"coerce"});if(!F)return!1;A[D]=F}l[l.length-1].options.params=A}if(S){if(typeof S!="object"||S.constructor!==Object)return E.error('Image options "iconset" should be an object'),!1;if(!S.id)return E.error('Image options "iconset" should have an "id" property'),!1;l[l.length-1].options.iconset=S}return a++,!0}var m;return!0}for(let m=0;m<2;m++)if(!h()||!f())return;return new li(l[0].image,l[1]?l[1].image:void 0,l[0].options,l[1]?l[1].options:void 0)}evaluateParams(e,i){const a={};if(i){for(const l in i)if(i[l])try{a[l]=i[l].evaluate(e)}catch{continue}if(Object.keys(a).length!==0)return{params:a}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},a=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,l=la.build(i,a,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(l&&e.availableImages){const h=l.getPrimary().id;if(l.available=e.availableImages.some((f=>Ur.isEqual(f,h))),l.available){const f=l.getSecondary()?l.getSecondary().id:null;f&&(l.available=e.availableImages.some((m=>Ur.isEqual(m,f))))}}return l}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const a={};if(i&&(a.iconset={id:i}),e){a.params={};for(const l in e)e[l]&&(a.params[l]=e[l].serialize())}return Object.keys(a).length>0?a:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function Tc(n){return ii(n)?"string":Pu(n)?"number":Ch(n)?"boolean":Array.isArray(n)?"array":n===null?"null":Du(n)?"object":typeof n}function Du(n){return n!=null&&!Array.isArray(n)&&typeof n!="function"&&!(n instanceof String||n instanceof Number||n instanceof Boolean)&&typeof n=="object"}function ii(n){return typeof n=="string"||n instanceof String}function Pu(n){return typeof n=="number"||n instanceof Number}function Ch(n){return typeof n=="boolean"||n instanceof Boolean}const Vf={"to-boolean":on,"to-color":co,"to-number":Xt,"to-string":Ji};class ks{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[0],l=[];let h=Iu;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const f=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);h=sa(i.expectedType.itemType,f)}else{if(!(f>0&&Ru(e[1][0])))return null;h=sa(Wr(e[1][0]),f)}for(let m=0;m<f;m++){const v=e[1][m];let x;if(Array.isArray(v))x=i.parse(v,void 0,h.itemType);else{const S=Tc(v);if(S!==h.itemType.kind)return i.error(`Expected ${h.itemType.kind} but found ${S}.`);x=i.registry.literal.parse(["literal",v===void 0?null:v],i)}if(!x)return null;l.push(x)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return i.error("Expected one argument.");h=Vf[a];for(let f=1;f<e.length;f++){const m=i.parse(e[f],f,gn);if(!m)return null;l.push(m)}}return new ks(h,l)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,a;for(const l of this.args){if(i=l.evaluate(e),a=null,i instanceof pn)return i;if(typeof i=="string"){const h=e.parseColor(i);if(h)return h}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Ed(i[0],i[1],i[2],i[3]),!a))return new pn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new lr(a||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const a of this.args){if(i=a.evaluate(e),i===null)return 0;const l=Number(i);if(!isNaN(l))return l}throw new lr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?$r.fromString(cs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?la.build(cs(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map((i=>i.evaluate(e))):cs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new Bs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new li(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((i=>{e.push(i.serialize())})),e}}const Ad=["Unknown","Point","LineString","Polygon"];class ca{constructor(e,i,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=a}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ad[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:a,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*i-e[0])+this.featureDistanceData.bearing[1]*(l*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=pn.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Da{constructor(e,i,a,l,h){this.name=e,this.type=i,this._evaluate=a,this.args=l,this._overloadIndex=h}evaluate(e){if(!this._evaluate){const i=Da.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,i){const a=e[0],l=Da.definitions[a];if(!l)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,m=[];let v=null,x=-1;for(const[S,E]of f){if(Array.isArray(S)&&S.length!==e.length-1)continue;m.push(S),x++,v=new Fh(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const A=[];let R=!1;for(let D=1;D<e.length;D++){const F=e[D],k=Array.isArray(S)?S[D-1]:S.type,U=v.parse(F,1+A.length,k);if(!U){R=!0;break}A.push(U)}if(!R)if(Array.isArray(S)&&S.length!==A.length)v.error(`Expected ${S.length} arguments, but found ${A.length} instead.`);else{for(let D=0;D<A.length;D++){const F=Array.isArray(S)?S[D]:S.type,k=A[D];v.concat(D+1).checkSubtype(F,k.type)}if(v.errors.length===0)return new Da(a,h,E,A,x)}}if(m.length===1)i.errors.push(...v.errors);else{const S=(m.length?m:f.map((([A])=>A))).map(Sc).join(" | "),E=[];for(let A=1;A<e.length;A++){const R=i.parse(e[A],1+E.length);if(!R)return null;E.push(Or(R.type))}i.error(`Expected arguments of type ${S}, but found (${E.join(", ")}) instead.`)}return null}static register(e,i){Da.definitions=i;for(const a in i)e[a]=Da}}function Sc(n){return Array.isArray(n)?`(${n.map(Or).join(", ")})`:`(${Or(n.type)}...)`}class Ea{constructor(e,i,a){this.type=Eh,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const l=a["case-sensitive"]===void 0?i.parse(!1,1,on):i.parseObjectValue(a["case-sensitive"],1,"case-sensitive",on);if(!l)return null;const h=a["diacritic-sensitive"]===void 0?i.parse(!1,1,on):i.parseObjectValue(a["diacritic-sensitive"],1,"diacritic-sensitive",on);if(!h)return null;let f=null;return a.locale&&(f=i.parseObjectValue(a.locale,1,"locale",Ji),!f)?null:new Ea(l,h,f)}evaluate(e){return new Sd(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Mo(n,e,i=0,a=n.length-1,l=G1){for(;a>i;){if(a-i>600){const v=a-i+1,x=e-i+1,S=Math.log(v),E=.5*Math.exp(2*S/3),A=.5*Math.sqrt(S*E*(v-E)/v)*(x-v/2<0?-1:1);Mo(n,e,Math.max(i,Math.floor(e-x*E/v+A)),Math.min(a,Math.floor(e+(v-x)*E/v+A)),l)}const h=n[e];let f=i,m=a;for(ia(n,i,e),l(n[a],h)>0&&ia(n,i,a);f<m;){for(ia(n,f,m),f++,m--;l(n[f],h)<0;)f++;for(;l(n[m],h)>0;)m--}l(n[i],h)===0?ia(n,i,m):(m++,ia(n,m,a)),m<=e&&(i=m+1),e<=m&&(a=m-1)}}function ia(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}function G1(n,e){return n<e?-1:n>e?1:0}function H1(n){let e=0;for(let i,a,l=0,h=n.length,f=h-1;l<h;f=l++)i=n[l],a=n[f],e+=(a.x-i.x)*(i.y+a.y);return e}function Lu(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Ns(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function q1(n,e,i){const a=n[0]-e[0],l=n[1]-e[1],h=n[0]-i[0],f=n[1]-i[1];return a*f-h*l==0&&a*h<=0&&l*f<=0}function Pa(n,e,i=!1){let a=!1;for(let m=0,v=e.length;m<v;m++){const x=e[m];for(let S=0,E=x.length,A=E-1;S<E;A=S++){const R=x[A],D=x[S];if(q1(n,R,D))return i;(h=R)[1]>(l=n)[1]!=(f=D)[1]>l[1]&&l[0]<(f[0]-h[0])*(l[1]-h[1])/(f[1]-h[1])+h[0]&&(a=!a)}}var l,h,f;return a}function Md(n,e,i,a){const l=a[0]-i[0],h=a[1]-i[1],f=(n[0]-i[0])*h-l*(n[1]-i[1]),m=(e[0]-i[0])*h-l*(e[1]-i[1]);return f>0&&m<0||f<0&&m>0}function Hl(n,e,i,a){return(l=[a[0]-i[0],a[1]-i[1]])[0]*(h=[e[0]-n[0],e[1]-n[1]])[1]-l[1]*h[0]!=0&&!(!Md(n,e,i,a)||!Md(i,a,n,e));var l,h}function Ec(n){const e=new nt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new nt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const a of n[0])e.x>a.x&&(e.x=a.x),e.y>a.y&&(e.y=a.y),i.x<a.x&&(i.x=a.x),i.y<a.y&&(i.y=a.y);return{min:e,max:i}}const fl=8192;function Ac(n,e){const i=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(i*l*fl),Math.round(a*l*fl)]}function Mc(n,e){for(let i=0;i<e.length;i++)if(Pa(n,e[i]))return!0;return!1}function jf(n,e,i){for(const a of i)for(let l=0,h=a.length,f=h-1;l<h;f=l++)if(Hl(n,e,a[f],a[l]))return!0;return!1}function pl(n,e){for(let i=0;i<n.length;++i)if(!Pa(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(jf(n[i],n[i+1],e))return!1;return!0}function Ic(n,e){for(let i=0;i<e.length;i++)if(pl(n,e[i]))return!0;return!1}function Id(n,e,i){const a=[];for(let l=0;l<n.length;l++){const h=[];for(let f=0;f<n[l].length;f++){const m=Ac(n[l][f],i);Lu(e,m),h.push(m)}a.push(h)}return a}function zh(n,e,i){const a=[];for(let l=0;l<n.length;l++){const h=Id(n[l],e,i);a.push(h)}return a}function Cd(n,e,i,a){if(n[0]<i[0]||n[0]>i[2]){const l=.5*a;let h=n[0]-i[0]>l?-a:i[0]-n[0]>l?a:0;h===0&&(h=n[0]-i[2]>l?-a:i[2]-n[0]>l?a:0),n[0]+=h}Lu(e,n)}function Gf(n,e,i,a){const l=Math.pow(2,a.z)*fl,h=[a.x*fl,a.y*fl],f=[];if(!n)return f;for(const m of n)for(const v of m){const x=[v.x+h[0],v.y+h[1]];Cd(x,e,i,l),f.push(x)}return f}function Ho(n,e,i,a){const l=Math.pow(2,a.z)*fl,h=[a.x*fl,a.y*fl],f=[];if(!n)return f;for(const v of n){const x=[];for(const S of v){const E=[S.x+h[0],S.y+h[1]];Lu(e,E),x.push(E)}f.push(x)}if(e[2]-e[0]<=l/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const v of f)for(const x of v)Cd(x,e,i,l)}var m;return f}class Cc{constructor(e,i){this.type=on,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ru(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let l=0;l<a.features.length;++l){const h=a.features[l].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Cc(a,a.features[l].geometry)}else if(a.type==="Feature"){const l=a.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Cc(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Cc(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,a){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(a.type==="Polygon"){const m=Id(a.coordinates,h,f),v=Gf(i.geometry(),l,h,f);if(!Ns(l,h))return!1;for(const x of v)if(!Pa(x,m))return!1}if(a.type==="MultiPolygon"){const m=zh(a.coordinates,h,f),v=Gf(i.geometry(),l,h,f);if(!Ns(l,h))return!1;for(const x of v)if(!Mc(x,m))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,a){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(a.type==="Polygon"){const m=Id(a.coordinates,h,f),v=Ho(i.geometry(),l,h,f);if(!Ns(l,h))return!1;for(const x of v)if(!pl(x,m))return!1}if(a.type==="MultiPolygon"){const m=zh(a.coordinates,h,f),v=Ho(i.geometry(),l,h,f);if(!Ns(l,h))return!1;for(const x of v)if(!Ic(x,m))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ou={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},zd=1/298.257223563,Rh=zd*(2-zd),Ua=Math.PI/180;class ml{static fromTile(e,i,a){const l=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),h=Math.atan(.5*(Math.exp(l)-Math.exp(-l)))/Ua;return new ml(h,a)}static get units(){return Ou}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!Ou[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(Ou).join(", ")}`);const a=6378.137*Ua*(i?Ou[i]:1),l=Math.cos(e*Ua),h=1/(1-Rh*(1-l*l)),f=Math.sqrt(h);this.kx=a*f*l,this.ky=a*f*h*(1-Rh)}distance(e,i){const a=Ka(e[0]-i[0])*this.kx,l=(e[1]-i[1])*this.ky;return Math.sqrt(a*a+l*l)}bearing(e,i){const a=Ka(i[0]-e[0])*this.kx;return Math.atan2(a,(i[1]-e[1])*this.ky)/Ua}destination(e,i,a){const l=a*Ua;return this.offset(e,Math.sin(l)*i,Math.cos(l)*i)}offset(e,i,a){return[e[0]+i/this.kx,e[1]+a/this.ky]}lineDistance(e){let i=0;for(let a=0;a<e.length-1;a++)i+=this.distance(e[a],e[a+1]);return i}area(e){let i=0;for(let a=0;a<e.length;a++){const l=e[a];for(let h=0,f=l.length,m=f-1;h<f;m=h++)i+=Ka(l[h][0]-l[m][0])*(l[h][1]+l[m][1])*(a?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let a=0;if(i<=0)return e[0];for(let l=0;l<e.length-1;l++){const h=e[l],f=e[l+1],m=this.distance(h,f);if(a+=m,a>i)return _l(h,f,(i-(a-m))/m)}return e[e.length-1]}pointToSegmentDistance(e,i,a){let[l,h]=i,f=Ka(a[0]-l)*this.kx,m=(a[1]-h)*this.ky;if(f!==0||m!==0){const v=(Ka(e[0]-l)*this.kx*f+(e[1]-h)*this.ky*m)/(f*f+m*m);v>1?(l=a[0],h=a[1]):v>0&&(l+=f/this.kx*v,h+=m/this.ky*v)}return f=Ka(e[0]-l)*this.kx,m=(e[1]-h)*this.ky,Math.sqrt(f*f+m*m)}pointOnLine(e,i){let a=1/0,l=e[0][0],h=e[0][1],f=0,m=0;for(let v=0;v<e.length-1;v++){let x=e[v][0],S=e[v][1],E=Ka(e[v+1][0]-x)*this.kx,A=(e[v+1][1]-S)*this.ky,R=0;E===0&&A===0||(R=(Ka(i[0]-x)*this.kx*E+(i[1]-S)*this.ky*A)/(E*E+A*A),R>1?(x=e[v+1][0],S=e[v+1][1]):R>0&&(x+=E/this.kx*R,S+=A/this.ky*R)),E=Ka(i[0]-x)*this.kx,A=(i[1]-S)*this.ky;const D=E*E+A*A;D<a&&(a=D,l=x,h=S,f=v,m=R)}return{point:[l,h],index:f,t:Math.max(0,Math.min(1,m))}}lineSlice(e,i,a){let l=this.pointOnLine(a,e),h=this.pointOnLine(a,i);if(l.index>h.index||l.index===h.index&&l.t>h.t){const x=l;l=h,h=x}const f=[l.point],m=l.index+1,v=h.index;!uo(a[m],f[0])&&m<=v&&f.push(a[m]);for(let x=m+1;x<=v;x++)f.push(a[x]);return uo(a[v],h.point)||f.push(h.point),f}lineSliceAlong(e,i,a){let l=0;const h=[];for(let f=0;f<a.length-1;f++){const m=a[f],v=a[f+1],x=this.distance(m,v);if(l+=x,l>e&&h.length===0&&h.push(_l(m,v,(e-(l-x))/x)),l>=i)return h.push(_l(m,v,(i-(l-x))/x)),h;l>e&&h.push(v)}return h}bufferPoint(e,i){const a=i/this.ky,l=i/this.kx;return[e[0]-l,e[1]-a,e[0]+l,e[1]+a]}bufferBBox(e,i){const a=i/this.ky,l=i/this.kx;return[e[0]-l,e[1]-a,e[2]+l,e[3]+a]}insideBBox(e,i){return Ka(e[0]-i[0])>=0&&Ka(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function uo(n,e){return n[0]===e[0]&&n[1]===e[1]}function _l(n,e,i){const a=Ka(e[0]-n[0]);return[n[0]+a*i,n[1]+(e[1]-n[1])*i]}function Ka(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class zc{constructor(e=[],i=((a,l)=>a<l?-1:a>l?1:0)){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:a}=this,l=i[e];for(;e>0;){const h=e-1>>1,f=i[h];if(a(l,f)>=0)break;i[e]=f,e=h}i[e]=l}_down(e){const{data:i,compare:a}=this,l=this.length>>1,h=i[e];for(;e<l;){let f=1+(e<<1);const m=f+1;if(m<this.length&&a(i[m],i[f])<0&&(f=m),a(i[f],h)>=0)break;i[e]=i[f],e=f}i[e]=h}}var pt=8192;function Dh(n,e){return e.dist-n.dist}const qo=100,Rc=50;function ql(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}function Us(n){return n[1]-n[0]+1}function Vs(n,e){const i=n[1]>=n[0]&&n[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Va(n,e){if(n[0]>n[1])return[null,null];const i=Us(n);if(e){if(i===2)return[n,null];const a=Math.floor(i/2);return[[n[0],n[0]+a],[n[0]+a,n[1]]]}{if(i===1)return[n,null];const a=Math.floor(i/2)-1;return[[n[0],n[0]+a],[n[0]+a+1,n[1]]]}}function ho(n,e){const i=[1/0,1/0,-1/0,-1/0];if(!Vs(e,n.length))return i;for(let a=e[0];a<=e[1];++a)Lu(i,n[a]);return i}function Ai(n){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<n.length;++i)for(let a=0;a<n[i].length;++a)Lu(e,n[i][a]);return e}function Dc(n,e,i){if(ql(n)||ql(e))return NaN;let a=0,l=0;return n[2]<e[0]&&(a=e[0]-n[2]),n[0]>e[2]&&(a=n[0]-e[2]),n[1]>e[3]&&(l=n[1]-e[3]),n[3]<e[1]&&(l=e[1]-n[3]),i.distance([0,0],[a,l])}function Rd(n){return 360*n-180}function Pc(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Fu(n,e){const i=Math.pow(2,e.z),a=(n.y/pt+e.y)/i;return[Rd((n.x/pt+e.x)/i),Pc(a)]}function Z1(n,e){const i=[];for(let a=0;a<n.length;++a)i.push(Fu(n[a],e));return i}function Xn(n,e,i){const a=i.pointOnLine(e,n).point;return i.distance(n,a)}function Hf(n,e,i,a,l){const h=i.slice(a[0],a[1]+1);let f=1/0;for(let m=e[0];m<=e[1];++m)if((f=Math.min(f,Xn(n[m],h,l)))===0)return 0;return f}function fo(n,e,i,a,l){const h=Math.min(l.pointToSegmentDistance(n,i,a),l.pointToSegmentDistance(e,i,a)),f=Math.min(l.pointToSegmentDistance(i,n,e),l.pointToSegmentDistance(a,n,e));return Math.min(h,f)}function Bu(n,e,i,a,l){if(!Vs(e,n.length)||!Vs(a,i.length))return NaN;let h=1/0;for(let f=e[0];f<e[1];++f)for(let m=a[0];m<a[1];++m){if(Hl(n[f],n[f+1],i[m],i[m+1]))return 0;h=Math.min(h,fo(n[f],n[f+1],i[m],i[m+1],l))}return h}function ku(n,e,i,a,l){if(!Vs(e,n.length)||!Vs(a,i.length))return NaN;let h=1/0;for(let f=e[0];f<=e[1];++f)for(let m=a[0];m<=a[1];++m)if((h=Math.min(h,l.distance(n[f],i[m])))===0)return h;return h}function Dd(n,e,i){if(Pa(n,e,!0))return 0;let a=1/0;for(const l of e){const h=l.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(l[0]!==l[h-1]&&(a=Math.min(a,i.pointToSegmentDistance(n,l[h-1],l[0])))===0||(a=Math.min(a,Xn(n,l,i)))===0)return a}return a}function Ph(n,e,i,a){if(!Vs(e,n.length))return NaN;for(let h=e[0];h<=e[1];++h)if(Pa(n[h],i,!0))return 0;let l=1/0;for(let h=e[0];h<e[1];++h)for(const f of i)for(let m=0,v=f.length,x=v-1;m<v;x=m++){if(Hl(n[h],n[h+1],f[x],f[m]))return 0;l=Math.min(l,fo(n[h],n[h+1],f[x],f[m],a))}return l}function Io(n,e){for(const i of n)for(let a=0;a<=i.length-1;++a)if(Pa(i[a],e,!0))return!0;return!1}function Zo(n,e,i,a=1/0){const l=Ai(n),h=Ai(e);if(a!==1/0&&Dc(l,h,i)>=a)return a;if(Ns(l,h)){if(Io(n,e))return 0}else if(Io(e,n))return 0;let f=a;for(const m of n)for(let v=0,x=m.length,S=x-1;v<x;S=v++)for(const E of e)for(let A=0,R=E.length,D=R-1;A<R;D=A++){if(Hl(m[S],m[v],E[D],E[A]))return 0;f=Math.min(f,fo(m[S],m[v],E[D],E[A],i))}return f}function us(n,e,i,a,l,h,f){if(h===null||f===null)return;const m=Dc(ho(a,h),ho(l,f),i);m<e&&n.push({dist:m,range1:h,range2:f})}function js(n,e,i,a,l=1/0){let h=Math.min(a.distance(n[0],i[0][0]),l);if(h===0)return h;const f=new zc([{dist:0,range1:[0,n.length-1],range2:[0,0]}],Dh),m=e?Rc:qo,v=Ai(i);for(;f.length;){const x=f.pop();if(x.dist>=h)continue;const S=x.range1;if(Us(S)<=m){if(!Vs(S,n.length))return NaN;if(e){const E=Ph(n,S,i,a);if((h=Math.min(h,E))===0)return h}else for(let E=S[0];E<=S[1];++E){const A=Dd(n[E],i,a);if((h=Math.min(h,A))===0)return h}}else{const E=Va(S,e);if(E[0]!==null){const A=Dc(ho(n,E[0]),v,a);A<h&&f.push({dist:A,range1:E[0],range2:[0,0]})}if(E[1]!==null){const A=Dc(ho(n,E[1]),v,a);A<h&&f.push({dist:A,range1:E[1],range2:[0,0]})}}}return h}function hs(n,e,i,a,l,h=1/0){let f=Math.min(h,l.distance(n[0],i[0]));if(f===0)return f;const m=new zc([{dist:0,range1:[0,n.length-1],range2:[0,i.length-1]}],Dh),v=e?Rc:qo,x=a?Rc:qo;for(;m.length;){const S=m.pop();if(S.dist>=f)continue;const E=S.range1,A=S.range2;if(Us(E)<=v&&Us(A)<=x){if(!Vs(E,n.length)||!Vs(A,i.length))return NaN;if(e&&a?f=Math.min(f,Bu(n,E,i,A,l)):e||a?e&&!a?f=Math.min(f,Hf(i,A,n,E,l)):!e&&a&&(f=Math.min(f,Hf(n,E,i,A,l))):f=Math.min(f,ku(n,E,i,A,l)),f===0)return f}else{const R=Va(E,e),D=Va(A,a);us(m,f,l,n,i,R[0],D[0]),us(m,f,l,n,i,R[0],D[1]),us(m,f,l,n,i,R[1],D[0]),us(m,f,l,n,i,R[1],D[1])}}return f}function ds(n,e,i,a,l=1/0){let h=l;const f=ho(n,[0,n.length-1]);for(const m of i)if(!(h!==1/0&&Dc(f,ho(m,[0,m.length-1]),a)>=h)&&(h=Math.min(h,hs(n,e,m,!0,a,h)),h===0))return h;return h}function Lh(n,e,i,a,l=1/0){let h=l;const f=ho(n,[0,n.length-1]);for(const m of i){if(h!==1/0&&Dc(f,Ai(m),a)>=h)continue;const v=js(n,e,m,a,h);if(isNaN(v))return v;if((h=Math.min(h,v))===0)return h}return h}function Oh(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class gl{constructor(e,i){this.type=Xt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ru(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let l=0;l<a.features.length;++l)if(Oh(a.features[l].geometry.type))return new gl(a,a.features[l].geometry)}else if(a.type==="Feature"){if(Oh(a.geometry.type))return new gl(a,a.geometry)}else if(Oh(a.type))return new gl(a,a)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),a=e.canonicalID();if(i!=null&&a!=null){if(e.geometryType()==="Point")return(function(l,h,f){const m=[];for(const x of l)for(const S of x)m.push(Fu(S,h));const v=new ml(m[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?hs(m,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",v):f.type==="MultiLineString"?ds(m,!1,f.coordinates,v):f.type==="Polygon"||f.type==="MultiPolygon"?Lh(m,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,v):null})(i,a,this.geometries);if(e.geometryType()==="LineString")return(function(l,h,f){const m=[];for(const x of l){const S=[];for(const E of x)S.push(Fu(E,h));m.push(S)}const v=new ml(m[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return ds(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",m,v);if(f.type==="MultiLineString"){let x=1/0;for(let S=0;S<f.coordinates.length;S++){const E=ds(f.coordinates[S],!0,m,v,x);if(isNaN(E))return E;if((x=Math.min(x,E))===0)return x}return x}if(f.type==="Polygon"||f.type==="MultiPolygon"){let x=1/0;for(let S=0;S<m.length;S++){const E=Lh(m[S],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,v,x);if(isNaN(E))return E;if((x=Math.min(x,E))===0)return x}return x}return null})(i,a,this.geometries);if(e.geometryType()==="Polygon")return(function(l,h,f){const m=[];for(const x of(function(S,E){const A=S.length;if(A<=1)return[S];const R=[];let D,F;for(let k=0;k<A;k++){const U=H1(S[k]);U!==0&&(S[k].area=Math.abs(U),F===void 0&&(F=U<0),F===U<0?(D&&R.push(D),D=[S[k]]):D.push(S[k]))}return D&&R.push(D),R})(l)){const S=[];for(let E=0;E<x.length;++E)S.push(Z1(x[E],h));m.push(S)}const v=new ml(m[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return Lh(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",m,v);if(f.type==="MultiLineString"){let x=1/0;for(let S=0;S<f.coordinates.length;S++){const E=Lh(f.coordinates[S],!0,m,v,x);if(isNaN(E))return E;if((x=Math.min(x,E))===0)return x}return x}return f.type==="Polygon"||f.type==="MultiPolygon"?(function(x,S,E){let A=1/0;for(const R of x)for(const D of S){const F=Zo(R,D,E,A);if(isNaN(F))return F;if((A=Math.min(A,F))===0)return A}return A})(f.type==="Polygon"?[f.coordinates]:f.coordinates,m,v):null})(i,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Lc(n){if(n instanceof Da&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Cc||n instanceof gl)return!1;if(n instanceof Zl)return n.featureConstant;let e=!0;return n.eachChild((i=>{e&&!Lc(i)&&(e=!1)})),e}function na(n){if(n instanceof Da&&n.name==="feature-state")return!1;let e=!0;return n.eachChild((i=>{e&&!na(i)&&(e=!1)})),e}function gr(n,e){if(n instanceof Da&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild((a=>{i&&!gr(a,e)&&(i=!1)})),i}function Gn(n,e,i){return[n,e,i].filter(Boolean).join("")}function Gs(n,e){switch(n){case"string":return cs(e);case"number":return+e;case"boolean":return!!e;case"color":return pn.parse(e);case"formatted":return $r.fromString(cs(e));case"resolvedImage":return la.build(cs(e))}return e}function Co(n,e,i,a){return a!==void 0&&(n=a*Math.round(n/a)),e!==void 0&&n<e&&(n=e),i!==void 0&&n>i&&(n=i),n}class Zl{constructor(e,i,a,l=!1){this.type=e,this.key=i,this.scope=a,this.featureConstant=l}static parse(e,i){let a=i.expectedType;if(a==null&&(a=gn),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const l=i.parse(e[1],1);if(!(l instanceof Fs))return i.error("Key name of 'config' expression must be a string literal.");let h,f=!0;const m=cs(l.value);if(e.length>=3){const v=i.parse(e[2],2);if(!(v instanceof Fs))return i.error("Scope of 'config' expression must be a string literal.");h=cs(v.value)}if(i.options){const v=Gn(m,h,i._scope),x=i.options.get(v);x&&(f=Lc(x.value||x.default))}return new Zl(a,m,h,f)}evaluate(e){const i=Gn(this.key,this.scope,e.scope),a=e.getConfig(i);if(!a)return null;const{type:l,value:h,values:f,minValue:m,maxValue:v,stepValue:x}=a,S=a.default.evaluate(e);let E=S;if(h){const A=e.scope;e.scope=(A||"").split("").slice(1).join(""),E=h.evaluate(e),e.scope=A}return l&&(E=Gs(l,E)),E===void 0||m===void 0&&v===void 0&&x===void 0||(typeof E=="number"?E=Co(E,m,v,x):Array.isArray(E)&&(E=E.map((A=>typeof A=="number"?Co(A,m,v,x):A)))),h!==void 0&&E!==void 0&&f&&!f.includes(E)&&(E=S,l&&(E=Gs(l,E))),(l&&l!==this.type||E!==void 0&&!Ih(Wr(E),this.type))&&(E=Gs(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class fs{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=e[1];return i.scope.has(a)?new fs(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Fh{constructor(e,i=[],a,l=new lo,h=[],f,m,v){this.registry=e,this.path=i,this.key=i.map((x=>typeof x=="string"?`['${x}']`:`[${x}]`)).join(""),this.scope=l,this.errors=h,this.expectedType=a,this._scope=f,this.options=m,this.iconImageUseTheme=v}parse(e,i,a,l,h={}){return i||a?this.concat(i,null,a,l)._parse(e,h):this._parse(e,h)}parseObjectValue(e,i,a,l,h,f={}){return this.concat(i,a,l,h)._parse(e,f)}_parse(e,i){function a(l,h,f){return f==="assert"?new Ut(h,[l]):f==="coerce"?new ks(h,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(l){let h=l.parse(e,this);if(!h)return null;if(this.expectedType){const f=this.expectedType,m=h.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||m.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||m.kind!=="value"&&m.kind!=="string"){if(this.checkSubtype(f,m))return null}else h=a(h,f,i.typeAnnotation||"coerce");else h=a(h,f,i.typeAnnotation||"assert")}if(!(h instanceof Fs)&&h.type.kind!=="resolvedImage"&&Pd(h)){const f=new ca(this._scope,this.options,this.iconImageUseTheme);try{h=new Fs(h.type,h.evaluate(f))}catch(m){return this.error(m.message),null}}return h}return ks.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a,l){let h=typeof e=="number"?this.path.concat(e):this.path;h=typeof i=="string"?h.concat(i):h;const f=l?this.scope.concat(l):this.scope;return new Fh(this.registry,h,a||null,f,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const a=`${this.key}${i.map((l=>`[${l}]`)).join("")}`;this.errors.push(new Go(a,e))}checkSubtype(e,i){const a=bc(e,i);return a&&this.error(a),a}}function Pd(n){if(n instanceof fs)return Pd(n.boundExpression);if(n instanceof Da&&n.name==="error"||n instanceof Ea||n instanceof Cc||n instanceof gl||n instanceof Zl)return!1;const e=n instanceof ks||n instanceof Ut;let i=!0;return n.eachChild((a=>{i=e?i&&Pd(a):i&&a instanceof Fs})),!!i&&Lc(n)&&gr(n,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function yl(n,e){const i=n.length-1;let a,l,h=0,f=i,m=0;for(;h<=f;)if(m=Math.floor((h+f)/2),a=n[m],l=n[m+1],a<=e){if(m===i||e<l)return m;h=m+1}else{if(!(a>e))throw new lr("Input is not a number.");f=m-1}return 0}class ps{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[l,h]of a)this.labels.push(l),this.outputs.push(h)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(e[1],1,Xt);if(!a)return null;const l=[];let h=null;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);for(let f=1;f<e.length;f+=2){const m=f===1?-1/0:e[f],v=e[f+1],x=f,S=f+1;if(typeof m!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(l.length&&l[l.length-1][0]>=m)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);const E=i.parse(v,S,h);if(!E)return null;h=h||E.type,l.push([m,E])}return new ps(h,a,l)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const l=this.input.evaluate(e);if(l<=i[0])return a[0].evaluate(e);const h=i.length;return l>=i[h-1]?a[h-1].evaluate(e):a[yl(i,l)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Ld=.95047,Nu=1.08883,Od=4/29,Xo=6/29,$o=3*Xo*Xo,Xl=Xo*Xo*Xo,Hs=Math.PI/180,qf=180/Math.PI;function Bh(n){return n>Xl?Math.pow(n,1/3):n/$o+Od}function $l(n){return n>Xo?n*n*n:$o*(n-Od)}function Oc(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function qs(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Vr(n){const e=qs(n.r),i=qs(n.g),a=qs(n.b),l=Bh((.4124564*e+.3575761*i+.1804375*a)/Ld),h=Bh((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*h-16,a:500*(l-h),b:200*(h-Bh((.0193339*e+.119192*i+.9503041*a)/Nu)),alpha:n.a}}function Uu(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,a=isNaN(n.b)?e:e-n.b/200;return e=1*$l(e),i=Ld*$l(i),a=Nu*$l(a),new pn(Oc(3.2404542*i-1.5371385*e-.4985314*a),Oc(-.969266*i+1.8760108*e+.041556*a),Oc(.0556434*i-.2040259*e+1.0572252*a),n.alpha)}function Zf(n,e,i){const a=e-n;return n+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const kh={forward:Vr,reverse:Uu,interpolate:function(n,e,i){return{l:ti(n.l,e.l,i),a:ti(n.a,e.a,i),b:ti(n.b,e.b,i),alpha:ti(n.alpha,e.alpha,i)}}},Fc={forward:function(n){const{l:e,a:i,b:a}=Vr(n),l=Math.atan2(a,i)*qf;return{h:l<0?l+360:l,c:Math.sqrt(i*i+a*a),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Hs,i=n.c;return Uu({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:Zf(n.h,e.h,i),c:ti(n.c,e.c,i),l:ti(n.l,e.l,i),alpha:ti(n.alpha,e.alpha,i)}}};var Fd=Object.freeze({__proto__:null,hcl:Fc,lab:kh});class cr{constructor(e,i,a,l,h){this.type=e,this.operator=i,this.interpolation=a,this.input=l,this.labels=[],this.outputs=[];for(const[f,m]of h)this.labels.push(f),this.outputs.push(m)}static interpolationFactor(e,i,a,l){let h=0;if(e.name==="exponential")h=Nh(i,e.base,a,l);else if(e.name==="linear")h=Nh(i,1,a,l);else if(e.name==="cubic-bezier"){const f=e.controlPoints;h=new Ul(f[0],f[1],f[2],f[3]).solve(Nh(i,1,a,l))}return h}static parse(e,i){let[a,l,h,...f]=e;if(!Array.isArray(l)||l.length===0)return i.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const x=l[1];if(typeof x!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:x}}else{if(l[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const x=l.slice(1);if(x.length!==4||x.some((S=>typeof S!="number"||S<0||S>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(h=i.parse(h,2,Xt),!h)return null;const m=[];let v=null;a==="interpolate-hcl"||a==="interpolate-lab"?v=co:i.expectedType&&i.expectedType.kind!=="value"&&(v=i.expectedType);for(let x=0;x<f.length;x+=2){const S=f[x],E=f[x+1],A=x+3,R=x+4;if(typeof S!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(m.length&&m[m.length-1][0]>=S)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const D=i.parse(E,R,v);if(!D)return null;v=v||D.type,m.push([S,D])}return v.kind==="number"||v.kind==="color"||v.kind==="array"&&v.itemType.kind==="number"&&typeof v.N=="number"?new cr(v,a,l,h,m):i.error(`Type ${Or(v)} is not interpolatable.`)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const l=this.input.evaluate(e);if(l<=i[0])return a[0].evaluate(e);const h=i.length;if(l>=i[h-1])return a[h-1].evaluate(e);const f=yl(i,l),m=cr.interpolationFactor(this.interpolation,l,i[f],i[f+1]),v=a[f].evaluate(e),x=a[f+1].evaluate(e);return this.operator==="interpolate"?dl[this.type.kind.toLowerCase()](v,x,m):this.operator==="interpolate-hcl"?Fc.reverse(Fc.interpolate(Fc.forward(v),Fc.forward(x),m)):kh.reverse(kh.interpolate(kh.forward(v),kh.forward(x),m))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function Nh(n,e,i,a){const l=a-i,h=n-i;return l===0?0:e===1?h/l:(Math.pow(e,h)-1)/(Math.pow(e,l)-1)}class vl{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null;const l=i.expectedType;l&&l.kind!=="value"&&(a=l);const h=[];for(const m of e.slice(1)){const v=i.parse(m,1+h.length,a,void 0,{typeAnnotation:"omit"});if(!v)return null;a=a||v.type,h.push(v)}const f=l&&h.some((m=>bc(l,m.type)));return new vl(f?gn:a,h)}evaluate(e){let i,a=null,l=0;for(const h of this.args){if(l++,a=h.evaluate(e),a&&a instanceof la&&!a.available&&(i||(i=a),a=null,l===this.args.length))return i;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class xl{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let h=1;h<e.length-1;h+=2){const f=e[h];if(typeof f!="string")return i.error(`Expected string, but found ${typeof f} instead.`,h);if(/[^a-zA-Z0-9_]/.test(f))return i.error("Variable names must contain only alphanumeric characters or '_'.",h);const m=i.parse(e[h+1],h+1);if(!m)return null;a.push([f,m])}const l=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return l?new xl(a,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,a]of this.bindings)e.push(i,a.serialize());return e.push(this.result.serialize()),e}}class Uh{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Xt),l=i.parse(e[2],2,sa(i.expectedType||gn));return a&&l?new Uh(l.type.itemType,a,l):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new lr("Array index out of bounds: negative index");if(i>=a.length)throw new lr("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new lr("Array index must be an integer. Use at-interpolated for fractional indices");return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Wl{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Xt),l=i.parse(e[2],2,sa(i.expectedType||gn));return a&&l?new Wl(l.type.itemType,a,l):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new lr(`Array index out of bounds: ${i} < 0.`);if(i>a.length-1)throw new lr(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i===Math.floor(i))return a[i];const l=Math.floor(i),h=Math.ceil(i),f=a[l],m=a[h];if(typeof f!="number"||typeof m!="number")throw new lr(`Cannot interpolate between non-number values at index ${i}.`);const v=i-l;return f*(1-v)+m*v}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Yl{constructor(e,i){this.type=on,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,gn),l=i.parse(e[2],2,gn);return a&&l?wc(a.type,[on,Ji,Xt,Iu,gn])?new Yl(a,l):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Or(a.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Mh(i,["boolean","string","number","null"]))throw new lr(`Expected first argument to be of type boolean, string, number or null, but found ${Or(Wr(i))} instead.`);if(!Mh(a,["string","array"]))throw new lr(`Expected second argument to be of type array or string, but found ${Or(Wr(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Vh{constructor(e,i,a){this.type=Xt,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,gn),l=i.parse(e[2],2,gn);if(!a||!l)return null;if(!wc(a.type,[on,Ji,Xt,Iu,gn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Or(a.type)} instead`);if(e.length===4){const h=i.parse(e[3],3,Xt);return h?new Vh(a,l,h):null}return new Vh(a,l)}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Mh(i,["boolean","string","number","null"]))throw new lr(`Expected first argument to be of type boolean, string, number or null, but found ${Or(Wr(i))} instead.`);if(!Mh(a,["string","array"]))throw new lr(`Expected second argument to be of type array or string, but found ${Or(Wr(a))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return a.indexOf(i,l)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class jh{constructor(e,i,a,l,h,f){this.inputType=e,this.type=i,this.input=a,this.cases=l,this.outputs=h,this.otherwise=f}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const h={},f=[];for(let x=2;x<e.length-1;x+=2){let S=e[x];const E=e[x+1];Array.isArray(S)||(S=[S]);const A=i.concat(x);if(S.length===0)return A.error("Expected at least one branch label.");for(const D of S){if(typeof D!="number"&&typeof D!="string")return A.error("Branch labels must be numbers or strings.");if(typeof D=="number"&&Math.abs(D)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof D=="number"&&Math.floor(D)!==D)return A.error("Numeric branch labels must be integer values.");if(a){if(A.checkSubtype(a,Wr(D)))return null}else a=Wr(D);if(h[String(D)]!==void 0)return A.error("Branch labels must be unique.");h[String(D)]=f.length}const R=i.parse(E,x,l);if(!R)return null;l=l||R.type,f.push(R)}const m=i.parse(e[1],1,gn);if(!m)return null;const v=i.parse(e[e.length-1],e.length-1,l);return v?m.type.kind!=="value"&&i.concat(1).checkSubtype(a,m.type)?null:new jh(a,l,m,h,f,v):null}evaluate(e){const i=this.input.evaluate(e);return(Ih(Wr(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],l={};for(const f of i){const m=l[this.cases[f]];m===void 0?(l[this.cases[f]]=a.length,a.push([this.cases[f],[f]])):a[m][1].push(f)}const h=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,m]of a)e.push(m.length===1?h(m[0]):m.map(h)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class Vu{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const l=[];for(let f=1;f<e.length-1;f+=2){const m=i.parse(e[f],f,on);if(!m)return null;const v=i.parse(e[f+1],f+1,a);if(!v)return null;l.push([m,v]),a=a||v.type}const h=i.parse(e[e.length-1],e.length-1,a);return h?new Vu(a,l,h):null}evaluate(e){for(const[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class Gh{constructor(e,i,a,l){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=l}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,gn),l=i.parse(e[2],2,Xt);if(!a||!l)return null;if(!wc(a.type,[sa(gn),Ji,gn]))return i.error(`Expected first argument to be of type array or string, but found ${Or(a.type)} instead`);if(e.length===4){const h=i.parse(e[3],3,Xt);return h?new Gh(a.type,a,l,h):null}return new Gh(a.type,a,l)}evaluate(e){const i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Mh(i,["string","array"]))throw new lr(`Expected first argument to be of type array or string, but found ${Or(Wr(i))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return i.slice(a,l)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Zs{constructor(e,i){this.type=sa(Ji),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Ji),l=i.parse(e[2],2,Ji);return a&&l?new Zs(a,l):void 0}evaluate(e){const i=this.str.evaluate(e),a=this.delimiter.evaluate(e);return i.split(a)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Bd(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Hh(n,e,i,a){return a.compare(e,i)===0}function Bc(n,e,i){const a=n!=="=="&&n!=="!=";return class I4{constructor(h,f,m){this.type=on,this.lhs=h,this.rhs=f,this.collator=m,this.hasUntypedArgument=h.type.kind==="value"||f.type.kind==="value"}static parse(h,f){if(h.length!==3&&h.length!==4)return f.error("Expected two or three arguments.");const m=h[0];let v=f.parse(h[1],1,gn);if(!v)return null;if(!Bd(m,v.type))return f.concat(1).error(`"${m}" comparisons are not supported for type '${Or(v.type)}'.`);let x=f.parse(h[2],2,gn);if(!x)return null;if(!Bd(m,x.type))return f.concat(2).error(`"${m}" comparisons are not supported for type '${Or(x.type)}'.`);if(v.type.kind!==x.type.kind&&v.type.kind!=="value"&&x.type.kind!=="value")return f.error(`Cannot compare types '${Or(v.type)}' and '${Or(x.type)}'.`);a&&(v.type.kind==="value"&&x.type.kind!=="value"?v=new Ut(x.type,[v]):v.type.kind!=="value"&&x.type.kind==="value"&&(x=new Ut(v.type,[x])));let S=null;if(h.length===4){if(v.type.kind!=="string"&&x.type.kind!=="string"&&v.type.kind!=="value"&&x.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(S=f.parse(h[3],3,Eh),!S)return null}return new I4(v,x,S)}evaluate(h){const f=this.lhs.evaluate(h),m=this.rhs.evaluate(h);if(a&&this.hasUntypedArgument){const v=Wr(f),x=Wr(m);if(v.kind!==x.kind||v.kind!=="string"&&v.kind!=="number")throw new lr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${v.kind}, ${x.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const v=Wr(f),x=Wr(m);if(v.kind!=="string"||x.kind!=="string")return e(h,f,m)}return this.collator?i(h,f,m,this.collator.evaluate(h)):e(h,f,m)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[n];return this.eachChild((f=>{h.push(f.serialize())})),h}}}const kc=Bc("==",(function(n,e,i){return e===i}),Hh),kd=Bc("!=",(function(n,e,i){return e!==i}),(function(n,e,i,a){return!Hh(0,e,i,a)})),Nd=Bc("<",(function(n,e,i){return e<i}),(function(n,e,i,a){return a.compare(e,i)<0})),Ud=Bc(">",(function(n,e,i){return e>i}),(function(n,e,i,a){return a.compare(e,i)>0})),X1=Bc("<=",(function(n,e,i){return e<=i}),(function(n,e,i,a){return a.compare(e,i)<=0})),qh=Bc(">=",(function(n,e,i){return e>=i}),(function(n,e,i,a){return a.compare(e,i)>=0}));class bl{constructor(e,i,a,l,h,f){this.type=Ji,this.number=e,this.locale=i,this.currency=a,this.unit=l,this.minFractionDigits=h,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const a=i.parse(e[1],1,Xt);if(!a)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return i.error("NumberFormat options argument must be an object.");let h=null;if(l.locale&&(h=i.parseObjectValue(l.locale,2,"locale",Ji),!h))return null;let f=null;if(l.currency&&(f=i.parseObjectValue(l.currency,2,"currency",Ji),!f))return null;let m=null;if(l.unit&&(m=i.parseObjectValue(l.unit,2,"unit",Ji),!m))return null;let v=null;if(l["min-fraction-digits"]&&(v=i.parseObjectValue(l["min-fraction-digits"],2,"min-fraction-digits",Xt),!v))return null;let x=null;return l["max-fraction-digits"]&&(x=i.parseObjectValue(l["max-fraction-digits"],2,"max-fraction-digits",Xt),!x)?null:new bl(a,h,f,m,v,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class wl{constructor(e){this.type=Xt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=i.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Or(a.type)} instead.`):new wl(a):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new lr(`Expected value to be of type string or array, but found ${Or(Wr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((i=>{e.push(i.serialize())})),e}}function Xf(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Nc={"==":kc,"!=":kd,">":Ud,"<":Nd,">=":qh,"<=":X1,array:Ut,at:Uh,"at-interpolated":Wl,boolean:Ut,case:Vu,coalesce:vl,collator:Ea,format:Bs,image:li,in:Yl,"index-of":Vh,interpolate:cr,"interpolate-hcl":cr,"interpolate-lab":cr,length:wl,let:xl,literal:Fs,match:jh,number:Ut,"number-format":bl,object:Ut,slice:Gh,step:ps,string:Ut,"to-boolean":ks,"to-color":ks,"to-number":ks,"to-string":ks,var:fs,within:Cc,distance:gl,config:Zl,split:Zs};function Kl(n,[e,i,a,l]){e=e.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);const h=l?l.evaluate(n):1,f=Ed(e,i,a,h);if(f)throw new lr(f);return new pn(e/255,i/255,a/255,h)}function ju(n,[e,i,a,l]){e=e.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);const h=l?l.evaluate(n):1,f=(function(x,S,E,A){return typeof x=="number"&&x>=0&&x<=360?typeof S=="number"&&S>=0&&S<=100&&typeof E=="number"&&E>=0&&E<=100?A===void 0||typeof A=="number"&&A>=0&&A<=1?null:`Invalid hsla value [${[x,S,E,A].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof A=="number"?[x,S,E,A]:[x,S,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof A=="number"?[x,S,E,A]:[x,S,E]).join(", ")}]: 'h' must be between 0 and 360.`})(e,i,a,h);if(f)throw new lr(f);const m=`hsla(${e}, ${i}%, ${a}%, ${h})`,v=pn.parse(m);if(!v)throw new lr(`Failed to parse HSLA color: ${m}`);return v}function Zh(n,e){return n in e}function Jl(n,e){const i=e[n];return i===void 0?null:i}function Wo(n){return{type:n}}function Gu(n){if(n instanceof Zl)return new Set([n.key]);let e=new Set;return n.eachChild((i=>{e=new Set([...e,...Gu(i)])})),e}function Xs(n){if(n instanceof Da&&n.name==="is-active-floor")return!0;let e=!1;return n.eachChild((i=>{!e&&Xs(i)&&(e=!0)})),e}function Ql(n){return{result:"success",value:n}}function Ja(n){return{result:"error",value:n}}function Xh(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function Hu(n){return n["property-type"]==="data-driven"}function $s(n){return Xh(n.expression,"measure-light")}function Ws(n){return Xh(n.expression,"zoom")}function ec(n){return!!n.expression&&n.expression.interpolated}function qu(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function $h(n){return n}function tc(n,e){const i=e.type==="color",a=n.stops&&typeof n.stops[0][0]=="object",l=a||!(a||n.property!==void 0),h=n.type||(ec(e)?"exponential":"interval");if(i&&((n=Object.assign({},n)).stops&&(n.stops=n.stops.map((x=>[x[0],pn.parse(x[1])]))),n.default=pn.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!Fd[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let f,m,v;if(h==="exponential")f=Uc;else if(h==="interval")f=Tl;else if(h==="categorical"){f=$1,m=Object.create(null);for(const x of n.stops)m[x[0]]=x[1];v=typeof n.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);f=Vd}if(a){const x={},S=[];for(let R=0;R<n.stops.length;R++){const D=n.stops[R],F=D[0].zoom;x[F]===void 0&&(x[F]={zoom:F,type:n.type,property:n.property,default:n.default,stops:[]},S.push(F)),x[F].stops.push([D[0].value,D[1]])}const E=[];for(const R of S)E.push([x[R].zoom,tc(x[R],e)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:cr.interpolationFactor.bind(void 0,A),zoomStops:E.map((R=>R[0])),evaluate:({zoom:R},D)=>Uc({stops:E,base:n.base},e,R).evaluate(R,D)}}if(l){const x=h==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:cr.interpolationFactor.bind(void 0,x),zoomStops:n.stops.map((S=>S[0])),evaluate:({zoom:S})=>f(n,e,S,m,v)}}return{kind:"source",evaluate(x,S){const E=S&&S.properties?S.properties[n.property]:void 0;return E===void 0?Ys(n.default,e.default):f(n,e,E,m,v)}}}function Ys(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function $1(n,e,i,a,l){return Ys(typeof i===l?a[i]:void 0,n.default,e.default)}function Tl(n,e,i){if(!Pu(i))return Ys(n.default,e.default);const a=n.stops.length;if(a===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[a-1][0])return n.stops[a-1][1];const l=yl(n.stops.map((h=>h[0])),i);return n.stops[l][1]}function Uc(n,e,i){const a=n.base!==void 0?n.base:1;if(!Pu(i))return Ys(n.default,e.default);const l=n.stops.length;if(l===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[l-1][0])return n.stops[l-1][1];const h=yl(n.stops.map((S=>S[0])),i),f=(function(S,E,A,R){const D=R-A,F=S-A;return D===0?0:E===1?F/D:(Math.pow(E,F)-1)/(Math.pow(E,D)-1)})(i,a,n.stops[h][0],n.stops[h+1][0]),m=n.stops[h][1],v=n.stops[h+1][1];let x=dl[e.type]||$h;if(n.colorSpace&&n.colorSpace!=="rgb"){const S=Fd[n.colorSpace];x=(E,A)=>S.reverse(S.interpolate(S.forward(E),S.forward(A),f))}return typeof m.evaluate=="function"?{evaluate(...S){const E=m.evaluate.apply(void 0,S),A=v.evaluate.apply(void 0,S);if(E!==void 0&&A!==void 0)return x(E,A,f)}}:x(m,v,f)}function Vd(n,e,i){return e.type==="color"?i=pn.parse(i):e.type==="formatted"?i=$r.fromString(i.toString()):e.type==="resolvedImage"?i=la.build(i.toString()):Tc(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Ys(i,n.default,e.default)}Da.register(Nc,{error:[{kind:"error"},[Ji],(n,[e])=>{throw new lr(e.evaluate(n))}],typeof:[Ji,[gn],(n,[e])=>Or(Wr(e.evaluate(n)))],"to-rgba":[sa(Xt,4),[co],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[sa(Xt,4),[co],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[co,[Xt,Xt,Xt],Kl],rgba:[co,[Xt,Xt,Xt,Xt],Kl],hsl:[co,[Xt,Xt,Xt],ju],hsla:[co,[Xt,Xt,Xt,Xt],ju],has:{type:on,overloads:[[[Ji],(n,[e])=>Zh(e.evaluate(n),n.properties())],[[Ji,Cu],(n,[e,i])=>Zh(e.evaluate(n),i.evaluate(n))]]},get:{type:gn,overloads:[[[Ji],(n,[e])=>Jl(e.evaluate(n),n.properties())],[[Ji,Cu],(n,[e,i])=>Jl(e.evaluate(n),i.evaluate(n))]]},"feature-state":[gn,[Ji],(n,[e])=>Jl(e.evaluate(n),n.featureState||{})],properties:[Cu,[],n=>n.properties()],"geometry-type":[Ji,[],n=>n.geometryType()],worldview:[Ji,[],n=>n.globals.worldview||""],"is-active-floor":[on,Wo(Ji),(n,e)=>{if(!(n.globals.activeFloors&&n.globals.activeFloors.size>0))return!1;const i=n.globals.activeFloors;return e.some((a=>{const l=a.evaluate(n);return i.has(l)}))}],id:[gn,[],n=>n.id()],zoom:[Xt,[],n=>n.globals.zoom],pitch:[Xt,[],n=>n.globals.pitch||0],"distance-from-center":[Xt,[],n=>n.distanceFromCenter()],"measure-light":[Xt,[Ji],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[Xt,[],n=>n.globals.heatmapDensity||0],"line-progress":[Xt,[],n=>n.globals.lineProgress||0],"raster-value":[Xt,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[Xt,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[Xt,[],n=>n.globals.skyRadialProgress||0],accumulated:[gn,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Xt,Wo(Xt),(n,e)=>{let i=0;for(const a of e)i+=a.evaluate(n);return i}],"*":[Xt,Wo(Xt),(n,e)=>{let i=1;for(const a of e)i*=a.evaluate(n);return i}],"-":{type:Xt,overloads:[[[Xt,Xt],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Xt],(n,[e])=>-e.evaluate(n)]]},"/":[Xt,[Xt,Xt],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Xt,[Xt,Xt],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Xt,[],()=>Math.LN2],pi:[Xt,[],()=>Math.PI],e:[Xt,[],()=>Math.E],"^":[Xt,[Xt,Xt],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Xt,[Xt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Xt,[Xt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Xt,[Xt],(n,[e])=>Math.log(e.evaluate(n))],log2:[Xt,[Xt],(n,[e])=>Math.log2(e.evaluate(n))],sin:[Xt,[Xt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Xt,[Xt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Xt,[Xt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Xt,[Xt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Xt,[Xt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Xt,[Xt],(n,[e])=>Math.atan(e.evaluate(n))],min:[Xt,Wo(Xt),(n,e)=>Math.min(...e.map((i=>i.evaluate(n))))],max:[Xt,Wo(Xt),(n,e)=>Math.max(...e.map((i=>i.evaluate(n))))],abs:[Xt,[Xt],(n,[e])=>Math.abs(e.evaluate(n))],round:[Xt,[Xt],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Xt,[Xt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Xt,[Xt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[on,[Ji,gn],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[on,[gn],(n,[e])=>n.id()===e.value],"filter-type-==":[on,[Ji],(n,[e])=>n.geometryType()===e.value],"filter-<":[on,[Ji,gn],(n,[e,i])=>{const a=n.properties()[e.value],l=i.value;return typeof a==typeof l&&a<l}],"filter-id-<":[on,[gn],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[on,[Ji,gn],(n,[e,i])=>{const a=n.properties()[e.value],l=i.value;return typeof a==typeof l&&a>l}],"filter-id->":[on,[gn],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[on,[Ji,gn],(n,[e,i])=>{const a=n.properties()[e.value],l=i.value;return typeof a==typeof l&&a<=l}],"filter-id-<=":[on,[gn],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[on,[Ji,gn],(n,[e,i])=>{const a=n.properties()[e.value],l=i.value;return typeof a==typeof l&&a>=l}],"filter-id->=":[on,[gn],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[on,[gn],(n,[e])=>e.value in n.properties()],"filter-has-id":[on,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[on,[sa(Ji)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[on,[sa(gn)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[on,[Ji,sa(gn)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[on,[Ji,sa(gn)],(n,[e,i])=>(function(a,l,h,f){for(;h<=f;){const m=h+f>>1;if(l[m]===a)return!0;l[m]>a?f=m-1:h=m+1}return!1})(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:on,overloads:[[[on,on],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[Wo(on),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:on,overloads:[[[on,on],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[Wo(on),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[on,[on],(n,[e])=>!e.evaluate(n)],"is-supported-script":[on,[Ji],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[Ji,[Ji],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Ji,[Ji],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Ji,Wo(gn),(n,e)=>e.map((i=>cs(i.evaluate(n)))).join("")],"resolved-locale":[Ji,[Eh],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[Xt,[Xt,Xt,gn],(n,e)=>{const[i,a,l]=e.map((f=>f.evaluate(n)));if(i>a||i===a)return i;let h;if(typeof l=="string")h=(function(f){let m=0;if(f.length===0)return m;for(let v=0;v<f.length;v++)m=(m<<5)-m+f.charCodeAt(v),m|=0;return m})(l);else{if(typeof l!="number")throw new lr(`Invalid seed input: ${l}`);h=l}return i+Xf(h)()*(a-i)}]});class Wh{constructor(e,i,a,l,h){this.expression=e,this._warningHistory={},this._scope=a,this._options=l,this._iconImageUseTheme=h,this._evaluator=new ca(a,l,h),this._defaultValue=i?(function(f){return f.type==="color"&&(qu(f.default)||Array.isArray(f.default))?new pn(0,0,0,0):f.type==="color"?pn.parse(f.default)||null:f.default===void 0?null:f.default})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=Gu(e),this.isIndoorDependent=Xs(e)}evaluateWithoutErrorHandling(e,i,a,l,h,f,m,v){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=l||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=v||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,l,h,f,m,v,x){this._evaluator||(this._evaluator=new ca(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=v||null,this._evaluator.iconImageUseTheme=x||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new lr(`Expected value to be one of ${Object.keys(this._enumValues).map((E=>JSON.stringify(E))).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${S.message}`)),this._defaultValue}}}function Zu(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Nc}function Yo(n,e,i,a,l){const h=new Fh(Nc,[],e?(function(m){const v={color:co,string:Ji,number:Xt,enum:Ji,boolean:on,formatted:xc,resolvedImage:Ah};return m.type==="array"?sa(v[m.value]||gn,m.length):v[m.type]})(e):void 0,void 0,void 0,i,a,l),f=h.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Ql(new Wh(f,e,i,a,l)):Ja(h.errors)}class La{constructor(e,i,a,l){this.kind=e,this._styleExpression=i,this.isLightConstant=a,this.isLineProgressConstant=l,this.isStateDependent=e!=="constant"&&!na(i.expression),this.configDependencies=Gu(i.expression),this.isIndoorDependent=Xs(i.expression)}evaluateWithoutErrorHandling(e,i,a,l,h,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,l,h,f)}evaluate(e,i,a,l,h,f,m){return this._styleExpression.evaluate(e,i,a,l,h,f,void 0,void 0,m)}}class ga{constructor(e,i,a,l,h,f){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!na(i.expression),this.isIndoorDependent=Xs(i.expression),this.isLightConstant=h,this.isLineProgressConstant=f,this.configDependencies=Gu(i.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,i,a,l,h,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,l,h,f)}evaluate(e,i,a,l,h,f){return this._styleExpression.evaluate(e,i,a,l,h,f)}interpolationFactor(e,i,a){return this.interpolationType?cr.interpolationFactor(this.interpolationType,e,i,a):0}}function Ks(n,e,i,a,l){if((n=Yo(n,e,i,a,l)).result==="error")return n;const h=n.value.expression,f=Lc(h);if(!f&&!Hu(e))return Ja([new Go("","data expressions not supported")]);const m=gr(h,["zoom","pitch","distance-from-center"]);if(!m&&!Ws(e))return Ja([new Go("","zoom expressions not supported")]);const v=gr(h,["measure-light"]);if(!v&&!$s(e))return Ja([new Go("","measure-light expression not supported")]);const x=gr(h,["line-progress"]);if(!x&&!(function(A){return Xh(A.expression,"line-progress")})(e))return Ja([new Go("","line-progress expression not supported")]);const S=e.expression&&e.expression.relaxZoomRestriction,E=Yh(h);return E||m||S?E instanceof Go?Ja([E]):E instanceof cr&&!ec(e)?Ja([new Go("",'"interpolate" expressions cannot be used with this property')]):Ql(E?new ga(f&&x?"camera":"composite",n.value,E.labels,E instanceof cr?E.interpolation:void 0,v,x):new La(f&&x?"constant":"source",n.value,v,x)):Ja([new Go("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Xu{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,tc(this._parameters,this._specification))}static deserialize(e){return new Xu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Yh(n){let e=null;if(n instanceof xl)e=Yh(n.result);else if(n instanceof vl){for(const i of n.args)if(e=Yh(i),e)break}else(n instanceof ps||n instanceof cr)&&n.input instanceof Da&&n.input.name==="zoom"&&(e=n);return e instanceof Go||n.eachChild((i=>{const a=Yh(i);a instanceof Go?e=a:e&&a&&e!==a&&(e=new Go("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var Ko,ja,Yr=(function(){if(ja)return Ko;ja=1,Ko=e;var n=3;function e(i,a,l){var h=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var f=new Int32Array(this.arrayBuffer);i=f[0],this.d=(a=f[1])+2*(l=f[2]);for(var m=0;m<this.d*this.d;m++){var v=f[n+m],x=f[n+m+1];h.push(v===x?null:f.subarray(v,x))}var S=f[n+h.length+1];this.keys=f.subarray(f[n+h.length],S),this.bboxes=f.subarray(S),this.insert=this._insertReadonly}else{this.d=a+2*l;for(var E=0;E<this.d*this.d;E++)h.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=i,this.padding=l,this.scale=a/i,this.uid=0;var A=l/a*i;this.min=-A,this.max=i+A}return e.prototype.insert=function(i,a,l,h,f){this._forEachCell(a,l,h,f,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(f)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,a,l,h,f,m){this.cells[f].push(m)},e.prototype.query=function(i,a,l,h,f){var m=this.min,v=this.max;if(i<=m&&a<=m&&v<=l&&v<=h&&!f)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(i,a,l,h,this._queryCell,x,{},f),x},e.prototype._queryCell=function(i,a,l,h,f,m,v,x){var S=this.cells[f];if(S!==null)for(var E=this.keys,A=this.bboxes,R=0;R<S.length;R++){var D=S[R];if(v[D]===void 0){var F=4*D;(x?x(A[F+0],A[F+1],A[F+2],A[F+3]):i<=A[F+2]&&a<=A[F+3]&&l>=A[F+0]&&h>=A[F+1])?(v[D]=!0,m.push(E[D])):v[D]=!1}}},e.prototype._forEachCell=function(i,a,l,h,f,m,v,x){for(var S=this._convertToCellCoord(i),E=this._convertToCellCoord(a),A=this._convertToCellCoord(l),R=this._convertToCellCoord(h),D=S;D<=A;D++)for(var F=E;F<=R;F++){var k=this.d*F+D;if((!x||x(this._convertFromCellCoord(D),this._convertFromCellCoord(F),this._convertFromCellCoord(D+1),this._convertFromCellCoord(F+1)))&&f.call(this,i,a,l,h,k,m,v,x))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,a=n+this.cells.length+1+1,l=0,h=0;h<this.cells.length;h++)l+=this.cells[h].length;var f=new Int32Array(a+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var m=a,v=0;v<i.length;v++){var x=i[v];f[n+v]=m,f.set(x,m),m+=x.length}return f[n+i.length]=m,f.set(this.keys,m),f[n+i.length+1]=m+=this.keys.length,f.set(this.bboxes,m),m+=this.bboxes.length,f.buffer},Ko})(),Js=gh(Yr);const po={};function st(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),po[e]={klass:n,omit:i.omit||[]}}st(Object,"Object"),Js.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.add(i),{buffer:i}},Js.deserialize=function(n){return new Js(n.buffer)},Object.defineProperty(Js,"name",{value:"Grid"}),st(Js,"Grid"),delete nt.prototype.constructor,typeof DOMMatrix<"u"&&st(DOMMatrix,"DOMMatrix"),st(pn,"Color"),st(Error,"Error"),st($r,"Formatted"),st(zu,"FormattedSection"),st(Ya,"AJAXError"),st(la,"ResolvedImage"),st(Xu,"StylePropertyFunction"),st(Wh,"StyleExpression",{omit:["_evaluator"]}),st(Ur,"ImageId"),st(Os,"ImageVariant"),st(ga,"ZoomDependentExpression"),st(La,"ZoomConstantExpression"),st(Da,"CompoundExpression",{omit:["_evaluate"]});for(const n in Nc)po[Nc[n]._classRegistryKey]||st(Nc[n],`Expression${n}`);function yr(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Ar(n){return self.ImageBitmap&&n instanceof ImageBitmap}function ms(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(yr(n)||Ar(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n))return e&&e.add(n.buffer),n;if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const a of n)i.push(ms(a,e));return i}if(n instanceof Map){const i={$name:"Map",entries:[]};for(const[a,l]of n.entries())i.entries.push(ms(a),ms(l,e));return i}if(n instanceof Set){const i={$name:"Set"};let a=0;for(const l of n.values())i[++a]=ms(l);return i}if(n instanceof DOMMatrix){const i={$name:"DOMMatrix"},a=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const l of a)i[l]=n[l];return i}if(typeof n=="bigint")return{$name:"BigInt",value:n.toString()};if(typeof n=="object"){const i=n.constructor,a=i._classRegistryKey;if(!a)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const l=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const h in n)n.hasOwnProperty(h)&&(po[a].omit.indexOf(h)>=0||(l[h]=ms(n[h],e)));n instanceof Error&&(l.message=n.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(l.$name=a),l}throw new Error("can't serialize object of type "+typeof n)}function zo(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||yr(n)||Ar(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(zo);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const l=n.entries||[],h=new Map;for(let f=0;f<l.length;f+=2)h.set(zo(l[f]),zo(l[f+1]));return h}if(e==="Set"){const l=new Set;for(const h of Object.keys(n))h!=="$name"&&l.add(zo(n[h]));return l}if(e==="DOMMatrix"){let l;return l=n.is2D?[n.a,n.b,n.c,n.d,n.e,n.f]:[n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44],new DOMMatrix(l)}if(e==="BigInt")return BigInt(n.value);const{klass:i}=po[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(n);const a=Object.create(i.prototype);for(const l of Object.keys(n))l!=="$name"&&(a[l]=zo(n[l]));return a}throw new Error("can't deserialize object of type "+typeof n)}const Wt={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,Osage:n=>n>=66736&&n<=66815,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function $u(n){for(const e of n)if(jd(e.charCodeAt(0)))return!0;return!1}function Wu(n){for(const e of n)if(!Sl(e.charCodeAt(0)))return!1;return!0}function Sl(n){return!(Wt.Arabic(n)||Wt["Arabic Supplement"](n)||Wt["Arabic Extended-A"](n)||Wt["Arabic Presentation Forms-A"](n)||Wt["Arabic Presentation Forms-B"](n))}function jd(n){return!(n!==746&&n!==747&&(n<4352||!(Wt["Bopomofo Extended"](n)||Wt.Bopomofo(n)||Wt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Wt["CJK Compatibility Ideographs"](n)||Wt["CJK Compatibility"](n)||Wt["CJK Radicals Supplement"](n)||Wt["CJK Strokes"](n)||!(!Wt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Wt["CJK Unified Ideographs Extension A"](n)||Wt["CJK Unified Ideographs"](n)||Wt["Enclosed CJK Letters and Months"](n)||Wt["Hangul Compatibility Jamo"](n)||Wt["Hangul Jamo Extended-A"](n)||Wt["Hangul Jamo Extended-B"](n)||Wt["Hangul Jamo"](n)||Wt["Hangul Syllables"](n)||Wt.Hiragana(n)||Wt["Ideographic Description Characters"](n)||Wt.Kanbun(n)||Wt["Kangxi Radicals"](n)||Wt["Katakana Phonetic Extensions"](n)||Wt.Katakana(n)&&n!==12540||!(!Wt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Wt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Wt["Unified Canadian Aboriginal Syllabics"](n)||Wt["Unified Canadian Aboriginal Syllabics Extended"](n)||Wt["Vertical Forms"](n)||Wt["Yijing Hexagram Symbols"](n)||Wt["Yi Syllables"](n)||Wt["Yi Radicals"](n))))}function Fr(n){return!(jd(n)||(function(e){return!!(Wt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Wt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Wt["Letterlike Symbols"](e)||Wt["Number Forms"](e)||Wt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Wt["Control Pictures"](e)&&e!==9251||Wt["Optical Character Recognition"](e)||Wt["Enclosed Alphanumerics"](e)||Wt["Geometric Shapes"](e)||Wt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Wt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Wt["CJK Symbols and Punctuation"](e)||Wt.Katakana(e)||Wt["Private Use Area"](e)||Wt["CJK Compatibility Forms"](e)||Wt["Small Form Variants"](e)||Wt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(n))}function Kh(n){return Wt.Arabic(n)||Wt["Arabic Supplement"](n)||Wt["Arabic Extended-A"](n)||Wt["Arabic Presentation Forms-A"](n)||Wt["Arabic Presentation Forms-B"](n)}function Gd(n){return n>=1424&&n<=2303||Wt["Arabic Presentation Forms-A"](n)||Wt["Arabic Presentation Forms-B"](n)}function W1(n,e){return!(!e&&Gd(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Wt.Khmer(n))}function Y1(n){for(const e of n)if(Gd(e.charCodeAt(0)))return!0;return!1}const mo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Jh=null,Aa=mo.unavailable,Qs=null;const Ga=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(Aa=mo.error),Jh&&Jh(n)};function jr(){Yu.fire(new Ra("pluginStateChange",{pluginStatus:Aa,pluginURL:Qs}))}const Yu=new hl,Vc=function(){return Aa},Ku=function(){if(Aa!==mo.deferred||!Qs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Aa=mo.loading,jr(),Qs&&Ao({url:Qs},(n=>{n?Ga(n):(Aa=mo.loaded,jr())}))},Ha={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Aa===mo.loaded||Ha.applyArabicShaping!=null,isLoading:()=>Aa===mo.loading,setState(n){Aa=n.pluginStatus,Qs=n.pluginURL},isParsing:()=>Aa===mo.parsing,isParsed:()=>Aa===mo.parsed,getPluginURL:()=>Qs};class mn{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview,this.activeFloors=i.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(i,a){for(const l of i)if(!W1(l.charCodeAt(0),a))return!1;return!0})(e,Ha.isLoaded())}}class ic{constructor(e,i,a,l,h){this.property=e,this.value=i,this.expression=(function(f,m,v,x,S){if(qu(f))return new Xu(f,m);if(Zu(f)||Array.isArray(f)&&f.length>0){const E=Ks(f,m,v,x,S);if(E.result==="error")throw new Error(E.value.map((A=>`${A.key}: ${A.message}`)).join(", "));return E.value}{let E=f;return typeof f=="string"&&m.type==="color"&&(E=pn.parse(f)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>E}}})(i===void 0?e.specification.default:i,e.specification,a,l,h)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,a,l){return this.property.possiblyEvaluate(this,e,i,a,l)}}class nc{constructor(e,i,a,l){this.property=e,this.value=new ic(e,void 0,i,a,l)}transitioned(e,i){return new $f(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new $f(this.property,this.value,null,{},0)}}class Hd{constructor(e,i,a,l){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=a,this._iconImageUseTheme=l,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return kt(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new nc(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new ic(this._values[e].property,i===null?void 0:kt(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,i){i&&(this._options=i);const a=this._properties.properties;if(e)for(const l in e){const h=e[l];if(l.endsWith("-transition")){const f=l.slice(0,-11);a[f]&&this.setTransition(f,h)}else a.hasOwnProperty(l)&&this.setValue(l,h)}}getTransition(e){return kt(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new nc(this._values[e].property)),this._values[e].transition=kt(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a);const l=this.getTransition(i);l!==void 0&&(e[`${i}-transition`]=l)}return e}transitioned(e,i){const a=new el(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].transitioned(e,i._values[l]);return a}untransitioned(){const e=new el(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class $f{constructor(e,i,a,l,h){const f=l.delay||0,m=l.duration||0;h=h||0,this.property=e,this.value=i,this.begin=h+f,this.end=this.begin+m,e.specification.transition&&(l.delay||l.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){const l=e.now||0,h=this.value.possiblyEvaluate(e,i,a),f=this.prior;if(f){if(l>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(l<this.begin)return f.possiblyEvaluate(e,i,a);{const m=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,i,a),h,xu(m))}}return h}}class el{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){const l=new rc(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,i,a);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class qd{constructor(e,i,a,l){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=a,this._iconImageUseTheme=l,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return kt(this._values[e].value)}setValue(e,i){this._values[e]=new ic(this._values[e].property,i===null?void 0:kt(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a)}return e}possiblyEvaluate(e,i,a,l){const h=new rc(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(e,i,a,l);return h}isIndoorDependent(){return this._isIndoorDependent}}class Ro{constructor(e,i,a,l){this.property=e,this.value=i,this.parameters=a,this.iconImageUseTheme=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,a,l){return this.property.evaluate(this.value,this.parameters,e,i,a,l,this.iconImageUseTheme)}}class rc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ut{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,a){const l=dl[this.specification.type];return l?l(e,i,a):e}}class It{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,l,h){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Ro(this,{kind:"constant",value:e.expression.evaluate(i,null,{},a,l,void 0,h)},i):new Ro(this,e.expression,i,h)}interpolate(e,i,a){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Ro(this,{kind:"constant",value:void 0},e.parameters);const l=dl[this.specification.type];return l?new Ro(this,{kind:"constant",value:l(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,l,h,f,m){return e.kind==="constant"?e.value:e.evaluate(i,a,l,h,f,void 0,m)}}class jc{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,l){return!!e.expression.evaluate(i,null,{},a,l)}interpolate(){return!1}}class fr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new mn(0,{});for(const a in e){const l=e[a];l.specification.overridable&&this.overridableProperties.push(a);const h=this.defaultPropertyValues[a]=new ic(l,void 0),f=this.defaultTransitionablePropertyValues[a]=new nc(l);this.defaultTransitioningPropertyValues[a]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=h.possiblyEvaluate(i)}}}st(It,"DataDrivenProperty"),st(ut,"DataConstantProperty"),st(jc,"ColorRampProperty");var Se=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Zd(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Gc(n){if(Array.isArray(n))return n.map(Gc);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Gc(n[i]);return e}return Zd(n)}function ac(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!ac(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Qh(n,e="",i=null,a="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ac(n)||(n=Ma(n));const l=n;let h=!0;try{h=(function(S){if(!qc(S))return S;let E=Gc(S);return Hc(E),E=ed(E),E})(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(l,null,2)}
        `)}let f=null,m=null;if(a!=="background"&&a!=="sky"&&a!=="slot"){m=Se[`filter_${a}`];const S=Yo(h,m,e,i);if(S.result==="error")throw new Error(S.value.map((E=>`${E.key}: ${E.message}`)).join(", "));f=(E,A,R)=>S.value.evaluate(E,A,{},R)}let v=null,x=null;if(h!==l){const S=Yo(l,m,e,i);if(S.result==="error")throw new Error(S.value.map((E=>`${E.key}: ${E.message}`)).join(", "));v=(E,A,R,D,F)=>S.value.evaluate(E,A,{},R,void 0,void 0,D,F),x=!Lc(S.value.expression)}return{filter:f,dynamicFilter:v||void 0,needGeometry:Wf(h),needFeature:!!x}}function ed(n){if(!Array.isArray(n))return n;const e=(function(i){if(K1.has(i[0])){for(let a=1;a<i.length;a++)if(qc(i[a]))return!0}return i})(n);return e===!0?e:e.map((i=>ed(i)))}function Hc(n){let e=!1;const i=[];if(n[0]==="case"){for(let a=1;a<n.length-1;a+=2)e=e||qc(n[a]),i.push(n[a+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||qc(n[1]);for(let a=2;a<n.length-1;a+=2)i.push(n[a+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||qc(n[1]);for(let a=1;a<n.length-1;a+=2)i.push(n[a+1])}e&&(n.length=0,n.push("any",...i));for(let a=1;a<n.length;a++)Hc(n[a])}function qc(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(qc(n[i]))return!0;return!1}const K1=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function J1(n,e){return n<e?-1:n>e?1:0}function Wf(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(Wf(n[e]))return!0;return!1}function Ma(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Xd(n[1],n[2],"=="):e==="!="?id(Xd(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Xd(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(Ma))):e==="all"?["all"].concat(n.slice(1).map(Ma)):e==="none"?["all"].concat(n.slice(1).map(Ma).map(id)):e==="in"?Ju(n[1],n.slice(2)):e==="!in"?id(Ju(n[1],n.slice(2))):e==="has"?td(n[1]):e!=="!has"||id(td(n[1]));var i}function Xd(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function Ju(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",n,["literal",e.sort(J1)]]:["filter-in-small",n,["literal",e]]}}function td(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function id(n){return["!",n]}const Zc="";function Xc(n,e){return e?`${n}${Zc}${e}`:n}let Yf;const Kf=()=>Yf||(Yf=new fr({"icon-size":new It(Se.layout_symbol["icon-size"]),"icon-image":new It(Se.layout_symbol["icon-image"]),"icon-rotate":new It(Se.layout_symbol["icon-rotate"]),"icon-offset":new It(Se.layout_symbol["icon-offset"])}));class Q1{constructor(e,i,a,l,h,f){this.cachedIconPrimary=null;const m=Yo(e,Se.appearance.condition);if(m.result==="success"&&(this.condition=m.value),this.name=i,a){this.properties=new rc(Kf()),this.unevaluatedLayout=new qd(Kf(),l,h,f);for(const v in a)this.unevaluatedLayout.setValue(v,a[v])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(e){this.cachedIconPrimary=e}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(e,i,a){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,i,a))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}}const Jf="-transition",ep=new Set(["fill","line","background","hillshade","raster"]);class ya extends hl{constructor(e,i,a,l,h,f){if(super(),this.id=e.id,this.fqid=Xc(this.id,a),this.type=e.type,this.scope=a,this.lut=l,this.options=h,this.iconImageUseTheme=f,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const m=Yo(this.filter,Se[`filter_${e.type}`]);m.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...m.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||m.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),i.layout&&(this._unevaluatedLayout=new qd(i.layout,this.scope,h,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),i.paint){this._transitionablePaint=new Hd(i.paint,this.scope,h);for(const m in e.paint)this.setPaintProperty(m,e.paint[m]);for(const m in e.layout)this.setLayoutProperty(m,e.layout[m]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new rc(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&ep.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...a.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||a.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach((i=>{this.appearances.push(new Q1(i.condition,i.name,i.properties,this.scope,this.options,this.iconImageUseTheme))}))}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Jf)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,i){const a=this._transitionablePaint,l=a._properties.properties;if(e.endsWith(Jf)){const E=e.slice(0,-11);return l[E]&&a.setTransition(E,i||void 0),!1}if(!l[e])return!1;const h=a._values[e],f=h.value.isDataDriven(),m=h.value;a.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...a.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||a.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const v=a._values[e].value,x=v.isDataDriven(),S=e.endsWith("pattern")||e==="line-dasharray";return x||f||S||this._handleOverridablePaintPropertyUpdate(e,m,v)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,a){return null}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map((i=>i.serialize()))),et(e,((i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length)))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ro&&Hu(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}for(const e of this.appearances)if(!na(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Qh(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,i,a){return{}}queryRadius(e){}queryIntersectsFeature(e,i,a,l,h,f,m,v,x){}}const tp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qu{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ln{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function zi(n,e=1){let i=0,a=0;return{members:n.map((l=>{const h=tp[l.type].BYTES_PER_ELEMENT,f=i=$d(i,Math.max(e,h)),m=l.components||1;return a=Math.max(a,h),i+=h*m,{name:l.name,type:l.type,components:m,offset:f}})),size:$d(i,Math.max(a,e)),alignment:e}}function $d(n,e){return Math.ceil(n/e)*e}class Qa extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const l=2*e;return this.int16[l+0]=i,this.int16[l+1]=a,e}}Qa.prototype.bytesPerElement=4,st(Qa,"StructArrayLayout2i4");class El extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,a)}emplace(e,i,a,l){const h=3*e;return this.int16[h+0]=i,this.int16[h+1]=a,this.int16[h+2]=l,e}}El.prototype.bytesPerElement=6,st(El,"StructArrayLayout3i6");class $c extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,a,l)}emplace(e,i,a,l,h){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=a,this.int16[f+2]=l,this.int16[f+3]=h,e}}$c.prototype.bytesPerElement=8,st($c,"StructArrayLayout4i8");class tl extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}tl.prototype.bytesPerElement=4,st(tl,"StructArrayLayout1f4");class nd extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,a)}emplace(e,i,a,l){const h=4*e,f=2*e;return this.int16[h+0]=i,this.int16[h+1]=a,this.float32[f+1]=l,e}}nd.prototype.bytesPerElement=8,st(nd,"StructArrayLayout2i1f8");class Wd extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,a)}emplace(e,i,a,l){const h=4*e;return this.int16[h+0]=i,this.int16[h+1]=a,this.int16[h+2]=l,e}}Wd.prototype.bytesPerElement=8,st(Wd,"StructArrayLayout3i8");class rd extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,l,h)}emplace(e,i,a,l,h,f){const m=5*e;return this.int16[m+0]=i,this.int16[m+1]=a,this.int16[m+2]=l,this.int16[m+3]=h,this.int16[m+4]=f,e}}rd.prototype.bytesPerElement=10,st(rd,"StructArrayLayout5i10");class Yd extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,a,l,h,f,m)}emplace(e,i,a,l,h,f,m,v){const x=6*e,S=12*e,E=3*e;return this.int16[x+0]=i,this.int16[x+1]=a,this.uint8[S+4]=l,this.uint8[S+5]=h,this.uint8[S+6]=f,this.uint8[S+7]=m,this.float32[E+2]=v,e}}Yd.prototype.bytesPerElement=12,st(Yd,"StructArrayLayout2i4ub1f12");class Do extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,a)}emplace(e,i,a,l){const h=3*e;return this.float32[h+0]=i,this.float32[h+1]=a,this.float32[h+2]=l,e}}Do.prototype.bytesPerElement=12,st(Do,"StructArrayLayout3f12");class Al extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,l,h)}emplace(e,i,a,l,h,f){const m=6*e,v=3*e;return this.uint16[m+0]=i,this.uint16[m+1]=a,this.uint16[m+2]=l,this.uint16[m+3]=h,this.float32[v+2]=f,e}}Al.prototype.bytesPerElement=12,st(Al,"StructArrayLayout4ui1f12");class _s extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,a,l)}emplace(e,i,a,l,h){const f=4*e;return this.uint16[f+0]=i,this.uint16[f+1]=a,this.uint16[f+2]=l,this.uint16[f+3]=h,e}}_s.prototype.bytesPerElement=8,st(_s,"StructArrayLayout4ui8");class eh extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,l,h,f)}emplace(e,i,a,l,h,f,m){const v=6*e;return this.int16[v+0]=i,this.int16[v+1]=a,this.int16[v+2]=l,this.int16[v+3]=h,this.int16[v+4]=f,this.int16[v+5]=m,e}}eh.prototype.bytesPerElement=12,st(eh,"StructArrayLayout6i12");class Wc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h,f,m,v,x,S,E,A){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,a,l,h,f,m,v,x,S,E,A)}emplace(e,i,a,l,h,f,m,v,x,S,E,A,R){const D=12*e;return this.int16[D+0]=i,this.int16[D+1]=a,this.int16[D+2]=l,this.int16[D+3]=h,this.uint16[D+4]=f,this.uint16[D+5]=m,this.uint16[D+6]=v,this.uint16[D+7]=x,this.int16[D+8]=S,this.int16[D+9]=E,this.int16[D+10]=A,this.int16[D+11]=R,e}}Wc.prototype.bytesPerElement=24,st(Wc,"StructArrayLayout4i4ui4i24");class Yc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,l,h,f)}emplace(e,i,a,l,h,f,m){const v=10*e,x=5*e;return this.int16[v+0]=i,this.int16[v+1]=a,this.int16[v+2]=l,this.float32[x+2]=h,this.float32[x+3]=f,this.float32[x+4]=m,e}}Yc.prototype.bytesPerElement=20,st(Yc,"StructArrayLayout3i3f20");class Ml extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,a,l)}emplace(e,i,a,l,h){const f=4*e;return this.float32[f+0]=i,this.float32[f+1]=a,this.float32[f+2]=l,this.float32[f+3]=h,e}}Ml.prototype.bytesPerElement=16,st(Ml,"StructArrayLayout4f16");class Kc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Kc.prototype.bytesPerElement=4,st(Kc,"StructArrayLayout1ul4");class Po extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const l=2*e;return this.uint16[l+0]=i,this.uint16[l+1]=a,e}}Po.prototype.bytesPerElement=4,st(Po,"StructArrayLayout2ui4");class ad extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h,f,m,v,x,S,E,A,R){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,a,l,h,f,m,v,x,S,E,A,R)}emplace(e,i,a,l,h,f,m,v,x,S,E,A,R,D){const F=20*e,k=10*e;return this.int16[F+0]=i,this.int16[F+1]=a,this.int16[F+2]=l,this.int16[F+3]=h,this.int16[F+4]=f,this.float32[k+3]=m,this.float32[k+4]=v,this.float32[k+5]=x,this.float32[k+6]=S,this.int16[F+14]=E,this.uint32[k+8]=A,this.uint16[F+18]=R,this.uint16[F+19]=D,e}}ad.prototype.bytesPerElement=40,st(ad,"StructArrayLayout5i4f1i1ul2ui40");class od extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,a,l,h,f,m)}emplace(e,i,a,l,h,f,m,v){const x=8*e;return this.int16[x+0]=i,this.int16[x+1]=a,this.int16[x+2]=l,this.int16[x+4]=h,this.int16[x+5]=f,this.int16[x+6]=m,this.int16[x+7]=v,e}}od.prototype.bytesPerElement=16,st(od,"StructArrayLayout3i2i2i16");class oc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,l,h)}emplace(e,i,a,l,h,f){const m=4*e,v=8*e;return this.float32[m+0]=i,this.float32[m+1]=a,this.float32[m+2]=l,this.int16[v+6]=h,this.int16[v+7]=f,e}}oc.prototype.bytesPerElement=16,st(oc,"StructArrayLayout2f1f2i16");class sc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,l,h,f)}emplace(e,i,a,l,h,f,m){const v=20*e,x=5*e;return this.uint8[v+0]=i,this.uint8[v+1]=a,this.float32[x+1]=l,this.float32[x+2]=h,this.float32[x+3]=f,this.float32[x+4]=m,e}}sc.prototype.bytesPerElement=20,st(sc,"StructArrayLayout2ub4f20");class Hn extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,a)}emplace(e,i,a,l){const h=3*e;return this.uint16[h+0]=i,this.uint16[h+1]=a,this.uint16[h+2]=l,e}}Hn.prototype.bytesPerElement=6,st(Hn,"StructArrayLayout3ui6");class Jc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h,f,m,v,x,S,E,A,R,D,F,k,U,q,$,Y,le){const ne=this.length;return this.resize(ne+1),this.emplace(ne,e,i,a,l,h,f,m,v,x,S,E,A,R,D,F,k,U,q,$,Y,le)}emplace(e,i,a,l,h,f,m,v,x,S,E,A,R,D,F,k,U,q,$,Y,le,ne){const de=30*e,_e=15*e,ye=60*e;return this.int16[de+0]=i,this.int16[de+1]=a,this.int16[de+2]=l,this.float32[_e+2]=h,this.float32[_e+3]=f,this.uint16[de+8]=m,this.uint16[de+9]=v,this.uint32[_e+5]=x,this.uint32[_e+6]=S,this.uint32[_e+7]=E,this.uint16[de+16]=A,this.uint16[de+17]=R,this.uint16[de+18]=D,this.float32[_e+10]=F,this.float32[_e+11]=k,this.uint8[ye+48]=U,this.uint8[ye+49]=q,this.uint8[ye+50]=$,this.uint32[_e+13]=Y,this.int16[de+28]=le,this.uint8[ye+58]=ne,e}}Jc.prototype.bytesPerElement=60,st(Jc,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Il extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h,f,m,v,x,S,E,A,R,D,F,k,U,q,$,Y,le,ne,de,_e,ye,Be,Ee,Ve,Xe,tt,gt,ot,Ye){const at=this.length;return this.resize(at+1),this.emplace(at,e,i,a,l,h,f,m,v,x,S,E,A,R,D,F,k,U,q,$,Y,le,ne,de,_e,ye,Be,Ee,Ve,Xe,tt,gt,ot,Ye)}emplace(e,i,a,l,h,f,m,v,x,S,E,A,R,D,F,k,U,q,$,Y,le,ne,de,_e,ye,Be,Ee,Ve,Xe,tt,gt,ot,Ye,at){const Fe=20*e,Le=40*e,rt=80*e;return this.float32[Fe+0]=i,this.float32[Fe+1]=a,this.int16[Le+4]=l,this.int16[Le+5]=h,this.int16[Le+6]=f,this.int16[Le+7]=m,this.int16[Le+8]=v,this.int16[Le+9]=x,this.int16[Le+10]=S,this.int16[Le+11]=E,this.int16[Le+12]=A,this.uint16[Le+13]=R,this.uint16[Le+14]=D,this.uint16[Le+15]=F,this.uint16[Le+16]=k,this.uint16[Le+17]=U,this.uint16[Le+18]=q,this.uint16[Le+19]=$,this.uint16[Le+20]=Y,this.uint16[Le+21]=le,this.uint16[Le+22]=ne,this.uint16[Le+23]=de,this.uint16[Le+24]=_e,this.uint16[Le+25]=ye,this.uint16[Le+26]=Be,this.uint16[Le+27]=Ee,this.uint32[Fe+14]=Ve,this.float32[Fe+15]=Xe,this.float32[Fe+16]=tt,this.float32[Fe+17]=gt,this.float32[Fe+18]=ot,this.uint8[rt+76]=Ye,this.uint16[Le+39]=at,e}}Il.prototype.bytesPerElement=80,st(Il,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Kd extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,l,h,f)}emplace(e,i,a,l,h,f,m){const v=6*e;return this.float32[v+0]=i,this.float32[v+1]=a,this.float32[v+2]=l,this.float32[v+3]=h,this.float32[v+4]=f,this.float32[v+5]=m,e}}Kd.prototype.bytesPerElement=24,st(Kd,"StructArrayLayout6f24");class lc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,l,h)}emplace(e,i,a,l,h,f){const m=5*e;return this.float32[m+0]=i,this.float32[m+1]=a,this.float32[m+2]=l,this.float32[m+3]=h,this.float32[m+4]=f,e}}lc.prototype.bytesPerElement=20,st(lc,"StructArrayLayout5f20");class Jd extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,a,l,h,f,m)}emplace(e,i,a,l,h,f,m,v){const x=7*e;return this.float32[x+0]=i,this.float32[x+1]=a,this.float32[x+2]=l,this.float32[x+3]=h,this.float32[x+4]=f,this.float32[x+5]=m,this.float32[x+6]=v,e}}Jd.prototype.bytesPerElement=28,st(Jd,"StructArrayLayout7f28");class cc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h,f,m,v,x,S,E){const A=this.length;return this.resize(A+1),this.emplace(A,e,i,a,l,h,f,m,v,x,S,E)}emplace(e,i,a,l,h,f,m,v,x,S,E,A){const R=11*e;return this.float32[R+0]=i,this.float32[R+1]=a,this.float32[R+2]=l,this.float32[R+3]=h,this.float32[R+4]=f,this.float32[R+5]=m,this.float32[R+6]=v,this.float32[R+7]=x,this.float32[R+8]=S,this.float32[R+9]=E,this.float32[R+10]=A,e}}cc.prototype.bytesPerElement=44,st(cc,"StructArrayLayout11f44");class Qd extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h,f,m,v,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,a,l,h,f,m,v,x)}emplace(e,i,a,l,h,f,m,v,x,S){const E=9*e;return this.float32[E+0]=i,this.float32[E+1]=a,this.float32[E+2]=l,this.float32[E+3]=h,this.float32[E+4]=f,this.float32[E+5]=m,this.float32[E+6]=v,this.float32[E+7]=x,this.float32[E+8]=S,e}}Qd.prototype.bytesPerElement=36,st(Qd,"StructArrayLayout9f36");class il extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const l=2*e;return this.float32[l+0]=i,this.float32[l+1]=a,e}}il.prototype.bytesPerElement=8,st(il,"StructArrayLayout2f8");class ef extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,a,l)}emplace(e,i,a,l,h){const f=6*e;return this.uint32[3*e+0]=i,this.uint16[f+2]=a,this.uint16[f+3]=l,this.uint16[f+4]=h,e}}ef.prototype.bytesPerElement=12,st(ef,"StructArrayLayout1ul3ui12");class sd extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}sd.prototype.bytesPerElement=2,st(sd,"StructArrayLayout1ui2");class tf extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h,f,m,v,x,S,E,A,R,D,F,k){const U=this.length;return this.resize(U+1),this.emplace(U,e,i,a,l,h,f,m,v,x,S,E,A,R,D,F,k)}emplace(e,i,a,l,h,f,m,v,x,S,E,A,R,D,F,k,U){const q=16*e;return this.float32[q+0]=i,this.float32[q+1]=a,this.float32[q+2]=l,this.float32[q+3]=h,this.float32[q+4]=f,this.float32[q+5]=m,this.float32[q+6]=v,this.float32[q+7]=x,this.float32[q+8]=S,this.float32[q+9]=E,this.float32[q+10]=A,this.float32[q+11]=R,this.float32[q+12]=D,this.float32[q+13]=F,this.float32[q+14]=k,this.float32[q+15]=U,e}}tf.prototype.bytesPerElement=64,st(tf,"StructArrayLayout16f64");class uc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,l,h,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,a,l,h,f,m)}emplace(e,i,a,l,h,f,m,v){const x=10*e,S=5*e;return this.uint16[x+0]=i,this.uint16[x+1]=a,this.uint16[x+2]=l,this.uint16[x+3]=h,this.float32[S+2]=f,this.float32[S+3]=m,this.float32[S+4]=v,e}}uc.prototype.bytesPerElement=20,st(uc,"StructArrayLayout4ui3f20");class Kr extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Kr.prototype.bytesPerElement=2,st(Kr,"StructArrayLayout1i2");class ua extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}ua.prototype.bytesPerElement=1,st(ua,"StructArrayLayout1ub1");class nf extends Qu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}nf.prototype.size=40;class Qf extends ad{get(e){return new nf(this,e)}}st(Qf,"CollisionBoxArray");class ld extends Qu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}ld.prototype.size=60;class th extends Jc{get(e){return new ld(this,e)}}st(th,"PlacedSymbolArray");class Qc extends Qu{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Qc.prototype.size=80;class e1 extends Il{get(e){return new Qc(this,e)}}st(e1,"SymbolInstanceArray");class ih extends tl{getoffsetX(e){return this.float32[1*e+0]}}st(ih,"GlyphOffsetArray");class t1 extends Qa{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}st(t1,"SymbolLineVertexArray");class rf extends Qu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}rf.prototype.size=12;class cd extends ef{get(e){return new rf(this,e)}}st(cd,"FeatureIndexArray");class af extends Po{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}st(af,"FillExtrusionCentroidArray");class i1 extends Qu{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}i1.prototype.size=6;class n1 extends El{get(e){return new i1(this,e)}}st(n1,"FillExtrusionWallArray");const r1=zi([{name:"a_pos",components:2,type:"Int16"}],4),a1=zi([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),o1=zi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class $n{constructor(e=[]){this.segments=e}_prepareSegment(e,i,a,l){let h=this.segments[this.segments.length-1];return e>$n.MAX_VERTEX_ARRAY_LENGTH&&Gt(`Max vertices per segment is ${$n.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>$n.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==l)&&(h={vertexOffset:i,primitiveOffset:a,vertexLength:0,primitiveLength:0},l!==void 0&&(h.sortKey=l),this.segments.push(h)),h}prepareSegment(e,i,a,l){return this._prepareSegment(e,i.length,a.length,l)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,l){return new $n([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:l,vaos:{},sortKey:0}])}}function s1(n,e){return 256*(n=G(Math.floor(n),0,255))+G(Math.floor(e),0,255)}$n.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,st($n,"SegmentVector");const l1=zi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),of=zi([{name:"a_pattern_b",components:4,type:"Uint16"}]),c1=zi([{name:"a_dash",components:4,type:"Uint16"}]);class nh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,a,l){this.ids.push(eu(e)),this.positions.push(i,a,l)}eachPosition(e,i){const a=eu(e);let l=0,h=this.ids.length-1;for(;l<h;){const f=l+h>>1;this.ids[f]>=a?h=f:l=f+1}for(;this.ids[l]===a;)i(this.positions[3*l],this.positions[3*l+1],this.positions[3*l+2]),l++}static serialize(e,i){const a=new Float64Array(e.ids),l=new Uint32Array(e.positions);return sf(a,l,0,a.length-1),i&&(i.add(a.buffer),i.add(l.buffer)),{ids:a,positions:l}}static deserialize(e){const i=new nh;let a;i.ids=e.ids,i.positions=e.positions;for(const l of i.ids)l!==a&&i.uniqueIds.push(l),a=l;return i.indexed=!0,i}}function eu(n){const e=+n;return Number.isSafeInteger(e)?e:yc(String(n))}function sf(n,e,i,a){for(;i<a;){const l=n[i+a>>1];let h=i-1,f=a+1;for(;;){do h++;while(n[h]<l);do f--;while(n[f]>l);if(h>=f)break;Jo(n,h,f),Jo(e,3*h,3*f),Jo(e,3*h+1,3*f+1),Jo(e,3*h+2,3*f+2)}f-i<a-f?(sf(n,e,i,f),i=f+1):(sf(n,e,f+1,a),a=f)}}function Jo(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}st(nh,"FeaturePositionMap");class _o{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class lf extends _o{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class Mr extends _o{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Ia extends _o{constructor(e){super(e),this.current=[0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class hc extends _o{constructor(e){super(e),this.current=[0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class rh extends _o{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class ah extends _o{constructor(e){super(e),this.current=pn.transparent.toPremultipliedRenderColor(null)}set(e,i,a){this.fetchUniformLocation(e,i)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const oh=new Float32Array(16);class Tr extends _o{constructor(e){super(e),this.current=oh}set(e,i,a){if(this.fetchUniformLocation(e,i)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let l=1;l<16;l++)if(a[l]!==this.current[l]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const Hp=new Float32Array(9),ip=new Float32Array(4);class cf extends _o{constructor(e){super(e),this.current=ip}set(e,i,a){if(this.fetchUniformLocation(e,i)){for(let l=0;l<4;l++)if(a[l]!==this.current[l]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function tu(n){return[s1(255*n.r,255*n.g),s1(255*n.b,255*n.a)]}function gs(n,e,i,a,l,h,f,m){return!!n&&(n.kind==="composite"||n.kind==="source"?n.evaluate(new mn(0,{brightness:h,worldview:m}),e,i,l,a,f)==="none":n.value==="none")}class ud{constructor(e,i,a,l){this.value=e,this.uniformNames=i.map((h=>`u_${h}`)),this.type=a,this.context=l}setUniform(e,i,a,l,h){const f=l.constantOr(this.value);i.set(e,h,f instanceof pn?f.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):f)}getBinding(e,i){return this.type==="color"?new ah(e):new Mr(e)}}class sh{constructor(e,i){this.uniformNames=i.map((a=>`u_${a}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,a,l,h){let f=null;h!=="u_pattern"&&h!=="u_dash"||(f=this.pattern),h==="u_pattern_b"&&(f=this.patternTransition),h==="u_pixel_ratio"&&(f=this.pixelRatio),f&&i.set(e,h,f)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new rh(e):new Mr(e)}}class Lo{constructor(e,i,a,l){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map((h=>({name:`a_${h}`,type:"Float32",components:a==="color"?2:1,offset:0}))),this.paintVertexArray=new l}populatePaintArray(e,i,a,l,h,f,m,v){const x=this.paintVertexArray.length,S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new mn(0,{brightness:f,worldview:v}),i,{},h,l,m):this.expression.kind==="constant"&&this.expression.value,E=gs(this.lutExpression,i,{},l,h,f,m,v);this.paintVertexArray.resize(e),this._setPaintValue(x,e,S,E?null:this.context.lut)}updatePaintArray(e,i,a,l,h,f,m,v){const x=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:m,worldview:v},a,l,void 0,h):this.expression.kind==="constant"&&this.expression.value,S=gs(this.lutExpression,a,l,h,void 0,m,void 0,v);this._setPaintValue(e,i,x,S?null:this.context.lut)}_setPaintValue(e,i,a,l){if(this.type==="color"){const h=tu(a.toPremultipliedRenderColor(l));for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,h[0],h[1])}else{for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ha{constructor(e,i,a,l,h,f){this.expression=e,this.uniformNames=i.map((m=>`u_${m}_t`)),this.type=a,this.useIntegerZoom=l,this.context=h,this.maxValue=0,this.paintVertexAttributes=i.map((m=>({name:`a_${m}`,type:"Float32",components:a==="color"?4:2,offset:0}))),this.paintVertexArray=new f}populatePaintArray(e,i,a,l,h,f,m,v){const x=this.expression.evaluate(new mn(this.context.zoom,{brightness:f,worldview:v}),i,{},h,l,m),S=this.expression.evaluate(new mn(this.context.zoom+1,{brightness:f,worldview:v}),i,{},h,l,m),E=gs(this.lutExpression,i,{},l,h,f,m,v),A=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(A,e,x,S,E?null:this.context.lut)}updatePaintArray(e,i,a,l,h,f,m,v){const x=this.expression.evaluate({zoom:this.context.zoom,brightness:m,worldview:v},a,l,void 0,h),S=this.expression.evaluate({zoom:this.context.zoom+1,brightness:m,worldview:v},a,l,void 0,h),E=gs(this.lutExpression,a,l,h,void 0,m,void 0,v);this._setPaintValue(e,i,x,S,E?null:this.context.lut)}_setPaintValue(e,i,a,l,h){if(this.type==="color"){const f=tu(a.toPremultipliedRenderColor(h)),m=tu(a.toPremultipliedRenderColor(h));for(let v=e;v<i;v++)this.paintVertexArray.emplace(v,f[0],f[1],m[0],m[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,a,l);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,a,l,h){const f=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,m=G(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);i.set(e,h,m)}getBinding(e,i){return new Mr(e)}}class va{constructor(e,i,a,l,h){this.expression=e,this.layerId=h,this.paintVertexAttributes=(a==="array"?c1:l1).members;for(let f=0;f<i.length;++f);this.paintVertexArray=new l,this.paintTransitionVertexArray=new _s}populatePaintArray(e,i,a,l){const h=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(h,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,l,h,f,m){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],f)}_setPaintValues(e,i,a,l){if(!l||!a)return;const h=l[a[0]],f=l[a[1]];if(h){if(h){const{tl:m,br:v,pixelRatio:x}=h;for(let S=e;S<i;S++)this.paintVertexArray.emplace(S,m[0],m[1],v[0],v[1],x)}if(f){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:m,br:v}=f;for(let x=e;x<i;x++)this.paintTransitionVertexArray.emplace(x,m[0],m[1],v[0],v[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,of.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class ys{constructor(e,i,a=(()=>!0)){this.binders={},this._buffers=[],this.context=i;const l=[];for(const h in e.paint._values){const f=e.paint.get(h);if(h.endsWith("-use-theme")||!a(h)||!(f instanceof Ro&&Hu(f.property.specification)))continue;const m=h1(h,e.type),v=f.value,x=f.property.specification.type,S=!!f.property.useIntegerZoom,E=h==="line-dasharray"||h.endsWith("pattern"),A=e.paint.get(`${h}-use-theme`),R=h==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||A&&A.value.kind!=="constant";if(v.kind!=="constant"||R)if(v.kind==="source"||R||E){const D=vs(h,x,"source");this.binders[h]=E?new va(v,m,x,D,e.id):new Lo(v,m,x,D),l.push(`/a_${h}`)}else{const D=vs(h,x,"composite");this.binders[h]=new ha(v,m,x,S,i,D),l.push(`/z_${h}`)}else this.binders[h]=E?new sh(v.value,m):new ud(v.value,m,x,i),l.push(`/u_${h}`);A&&(this.binders[h].lutExpression=A.value)}this.cacheKey=l.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Lo||i instanceof ha?i.maxValue:0}populatePaintArrays(e,i,a,l,h,f,m,v){for(const x in this.binders){const S=this.binders[x];S.context=this.context,(S instanceof Lo||S instanceof ha||S instanceof va)&&S.populatePaintArray(e,i,a,l,h,f,m,v)}}setConstantPatternPositions(e,i){for(const a in this.binders){const l=this.binders[a];l instanceof sh&&l.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof va?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,a,l,h,f,m,v,x,S){let E=!1;const A=Object.keys(e),R=A.length!==0&&!v,D=R?A:i.uniqueIds;this.context.lut=h.lut;for(const F in this.binders){const k=this.binders[F];if(k.context=this.context,(k instanceof Lo||k instanceof ha||k instanceof va)&&k.expression&&k.expression.kind&&k.expression.kind!=="constant"&&(k.expression.isStateDependent===!0||k.expression.isLightConstant===!1)){const U=h.paint.get(F);k.expression=U.value;for(const q of D){const $=e[q.toString()];i.eachPosition(q,((Y,le,ne)=>{const de=l.feature(Y);k.updatePaintArray(le,ne,de,$,f,m,x,S)}))}if(!R)for(const q of a.uniqueIds){const $=e[q.toString()];a.eachPosition(q,((Y,le,ne)=>{const de=l.feature(Y);k.updatePaintArray(le,ne,de,$,f,m,x,S)}))}E=!0}}return E}defines(){const e=[];for(const i in this.binders){const a=this.binders[i];(a instanceof ud||a instanceof sh)&&e.push(...a.uniformNames.map((l=>`#define HAS_UNIFORM_${l}`)))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const a in this.binders){const l=this.binders[a];if(l instanceof ud||l instanceof sh||l instanceof ha)for(const h of l.uniformNames)i.push({name:h,property:a,binding:l.getBinding(e,h)})}return i}setUniforms(e,i,a,l,h){for(const{name:f,property:m,binding:v}of a)this.binders[m].setUniform(e,v,h,l.get(m),f)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Lo||i instanceof ha||i instanceof va)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof va&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const a=this.binders[i];(a instanceof Lo||a instanceof ha||a instanceof va)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Lo||i instanceof ha||i instanceof va)&&i.destroy()}}}class Qo{constructor(e,i,a=(()=>!0)){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new ys(l,i,a);this.needsUpload=!1,this._featureMap=new nh,this._featureMapWithoutIds=new nh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,a,l,h,f,m,v,x){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(e,i,l,h,f,m,v,x);i.id!==void 0?this._featureMap.add(i.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,l,h,f,m,v){for(const x of a)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,x,l,h,f,m||0,v)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const u1={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function h1(n,e){return u1[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const uf={"line-pattern":{source:Al,composite:Al},"fill-pattern":{source:Al,composite:Al},"fill-extrusion-pattern":{source:Al,composite:Al},"line-dasharray":{source:_s,composite:_s}},np={color:{source:il,composite:Ml},number:{source:tl,composite:il}};function vs(n,e,i){const a=uf[n];return a&&a[i]||np[e][i]}st(ud,"ConstantBinder"),st(sh,"PatternConstantBinder"),st(Lo,"SourceExpressionBinder"),st(va,"PatternCompositeBinder"),st(ha,"CompositeExpressionBinder"),st(ys,"ProgramConfiguration",{omit:["_buffers"]}),st(Qo,"ProgramConfigurationSet");const Jn=pt/Math.PI/2,c=5,t=6,r=16383,u=64,p=[u,32,16],_=-Jn,y=Jn;function b(n,e,i,a=Jn){return i=Ui(i),[n*Math.sin(i)*a,-e*a,n*Math.cos(i)*a]}function T(n,e,i){return b(Math.cos(Ui(n)),Math.sin(Ui(n)),e,i)}const M=63710088e-1,I=2*Math.PI*M;class P{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new P(pe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,a=this.lat*i,l=e.lat*i,h=Math.sin(a)*Math.sin(l)+Math.cos(a)*Math.cos(l)*Math.cos((e.lng-this.lng)*i);return M*Math.acos(Math.min(h,1))}toBounds(e=0){const i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new z({lng:this.lng-a,lat:this.lat-i},{lng:this.lng+a,lat:this.lat+i})}toEcef(e){return T(this.lat,this.lng,Jn+e*Jn/M)}static convert(e){if(e instanceof P)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new P(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new P(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class z{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof P?new P(e.lng,e.lat):P.convert(e),this}setSouthWest(e){return this._sw=e instanceof P?new P(e.lng,e.lat):P.convert(e),this}extend(e){const i=this._sw,a=this._ne;let l,h;if(e instanceof P)l=e,h=e;else{if(!(e instanceof z))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(z.convert(e)):this.extend(P.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(P.convert(e)):this;if(l=e._sw,h=e._ne,!l||!h)return this}return i||a?(i.lng=Math.min(l.lng,i.lng),i.lat=Math.min(l.lat,i.lat),a.lng=Math.max(h.lng,a.lng),a.lat=Math.max(h.lat,a.lat)):(this._sw=new P(l.lng,l.lat),this._ne=new P(h.lng,h.lat)),this}getCenter(){return new P((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new P(this.getWest(),this.getNorth())}getSouthEast(){return new P(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=P.convert(e);let l=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&l}static convert(e){if(e)return e instanceof z?e:new z(e)}}const O=0,B=25.5;function N(n){return I*Math.cos(n*Math.PI/180)}function H(n){return(180+n)/360}function j(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Z(n,e){return n/N(e)}function K(n){return 360*n-180}function W(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function se(n,e){return n*N(W(e))}const Q=85.051129;function ce(n){return Math.cos(Ui(G(n,-Q,Q)))}function ie(n,e){const i=G(e,O,B),a=Math.pow(2,i);return ce(n)*I/(512*a)}function te(n){return 1/Math.cos(n*Math.PI/180)}function ue(n,e=0){const i=Math.exp(Math.PI*(1-(n.y+e/pt)/(1<<n.z)*2));return 80150034*i/(i*i+1)/pt/(1<<n.z)}class we{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){const a=P.convert(e);return new we(H(a.lng),j(a.lat),Z(i,a.lat))}toLngLat(){return new P(K(this.x),W(this.y))}toAltitude(){return se(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/I*te(W(this.y))}}function ve(n,e,i,a,l,h,f,m,v){const x=(e+a)/2,S=(i+l)/2,E=new nt(x,S);m(E),(function(A,R,D,F,k,U){const q=D-k,$=F-U;return Math.abs((F-R)*q-(D-A)*$)/Math.hypot(q,$)})(E.x,E.y,h.x,h.y,f.x,f.y)>=v?(ve(n,e,i,x,S,h,E,m,v),ve(n,x,S,a,l,E,f,m,v)):n.push(f)}function Oe(n,e,i){let a=n[0],l=a.x,h=a.y;e(a);const f=[a];for(let m=1;m<n.length;m++){const v=n[m],{x,y:S}=v;e(v),ve(f,l,h,x,S,a,v,e,i),l=x,h=S,a=v}return f}function ze(n,e,i,a){if(a(e,i)){const l=e.add(i)._mult(.5);ze(n,e,l,a),ze(n,l,i,a)}else n.push(i)}function je(n,e){let i=n[0];const a=[i];for(let l=1;l<n.length;l++){const h=n[l];ze(a,i,h,e),i=h}return a}const lt=Math.pow(2,14)-1,Me=-lt-1;function ge(n,e){const i=Math.round(n.x*e),a=Math.round(n.y*e);return n.x=G(i,Me,lt),n.y=G(a,Me,lt),(i<n.x||i>n.x+1||a<n.y||a>n.y+1)&&Gt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Ge(n,e,i){const a=n.loadGeometry(),l=n.extent,h=pt/l;if(e&&i&&i.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:m,x:v,y:x,projection:S}=i,E=A=>{const R=K((e.x+A.x/l)/f),D=W((e.y+A.y/l)/f),F=S.project(R,D);A.x=(F.x*m-v)*l,A.y=(F.y*m-x)*l};for(let A=0;A<a.length;A++)if(n.type!==1)a[A]=Oe(a[A],E,1);else{const R=[];for(const D of a[A])D.x<0||D.x>=l||D.y<0||D.y>=l||(E(D),R.push(D));a[A]=R}}for(const f of a)for(const m of f)ge(m,h);return a}function Re(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Ge(n):[]}}class it{constructor(e,i,a,l,h){this.properties={},this.extent=a,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=l,this._values=h,e.readFields(Je,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,a=[];let l,h=1,f=0,m=0,v=0;for(;e.pos<i;){if(f<=0){const x=e.readVarint();h=7&x,f=x>>3}if(f--,h===1||h===2)m+=e.readSVarint(),v+=e.readSVarint(),h===1&&(l&&a.push(l),l=[]),l&&l.push(new nt(m,v));else{if(h!==7)throw new Error(`unknown command ${h}`);l&&l.push(l[0].clone())}}return l&&a.push(l),a}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let a=1,l=0,h=0,f=0,m=1/0,v=-1/0,x=1/0,S=-1/0;for(;e.pos<i;){if(l<=0){const E=e.readVarint();a=7&E,l=E>>3}if(l--,a===1||a===2)h+=e.readSVarint(),f+=e.readSVarint(),h<m&&(m=h),h>v&&(v=h),f<x&&(x=f),f>S&&(S=f);else if(a!==7)throw new Error(`unknown command ${a}`)}return[m,x,v,S]}toGeoJSON(e,i,a){const l=this.extent*Math.pow(2,a),h=this.extent*e,f=this.extent*i,m=this.loadGeometry();function v(A){return[360*(A.x+h)/l-180,360/Math.PI*Math.atan(Math.exp((1-2*(A.y+f)/l)*Math.PI))-90]}function x(A){return A.map(v)}let S;if(this.type===1){const A=[];for(const D of m)A.push(D[0]);const R=x(A);S=A.length===1?{type:"Point",coordinates:R[0]}:{type:"MultiPoint",coordinates:R}}else if(this.type===2){const A=m.map(x);S=A.length===1?{type:"LineString",coordinates:A[0]}:{type:"MultiLineString",coordinates:A}}else{if(this.type!==3)throw new Error("unknown feature type");{const A=(function(D){const F=D.length;if(F<=1)return[D];const k=[];let U,q;for(let $=0;$<F;$++){const Y=vt(D[$]);Y!==0&&(q===void 0&&(q=Y<0),q===Y<0?(U&&k.push(U),U=[D[$]]):U&&U.push(D[$]))}return U&&k.push(U),k})(m),R=[];for(const D of A)R.push(D.map(x));S=R.length===1?{type:"Polygon",coordinates:R[0]}:{type:"MultiPolygon",coordinates:R}}}const E={type:"Feature",geometry:S,properties:this.properties};return this.id!=null&&(E.id=this.id),E}}function Je(n,e,i){n===1?e.id=i.readVarint():n===2?(function(a,l){const h=a.readVarint()+a.pos;for(;a.pos<h;){const f=l._keys[a.readVarint()],m=l._values[a.readVarint()];l.properties[f]=m}})(i,e):n===3?e.type=i.readVarint():n===4&&(e._geometry=i.pos)}function vt(n){let e=0;for(let i,a,l=0,h=n.length,f=h-1;l<h;f=l++)i=n[l],a=n[f],e+=(a.x-i.x)*(i.y+a.y);return e}it.types=["Unknown","Point","LineString","Polygon"];class Ze{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields($e,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new it(this._pbf,i,this.extent,this._keys,this._values)}}function $e(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push((function(a){let l=null;const h=a.readVarint()+a.pos;for(;a.pos<h;){const f=a.readVarint()>>3;l=f===1?a.readString():f===2?a.readFloat():f===3?a.readDouble():f===4?a.readVarint64():f===5?a.readVarint():f===6?a.readSVarint():f===7?a.readBoolean():null}if(l==null)throw new Error("unknown feature value");return l})(i))}class xt{constructor(e,i){this.layers=e.readFields(Mt,{},i)}}function Mt(n,e,i){if(n===3){const a=new Ze(i,i.readVarint()+i.pos);a.length&&(e[a.name]=a)}}const St="3d_elevation_id",Rt="level";class Kt{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,a){return this.get(e,!0,i,a)}optional(e,i,a){return this.get(e,!1,i,a)}success(){return this._valid}get(e,i,a,l){const h=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&h!==void 0&&!Number.isNaN(h)?a(l?l(h):h):i&&(this._valid=!1),this}}class Ti{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,a){return this.featureFunc(e,i,a)}parseVertex(e,i,a){return this.vertexFunc(e,i,a)}}const fi=new Ti(((n,e,i)=>n.reset(e).require(St,(a=>{i.id=a})).optional("fixed_height_relative",(a=>{i.constantHeight=a}),Qt.decodeRelativeHeight).geometry((a=>{i.bounds=a}),Ec).success()),((n,e,i)=>n.reset(e).require(St,(a=>{i.id=a})).require("elevation_idx",(a=>{i.idx=a})).require("extent",(a=>{i.extent=a})).require("height_relative",(a=>{i.height=a}),Qt.decodeRelativeHeight).geometry((a=>{i.position=a}),Qt.getPoint).success())),Qi=new Ti(((n,e,i)=>n.reset(e).require(St,(a=>{i.id=a})).optional("fixed_height",(a=>{i.constantHeight=a}),Qt.decodeMetricHeight).geometry((a=>{i.bounds=a}),Ec).success()),((n,e,i)=>n.reset(e).require(St,(a=>{i.id=a})).require("elevation_idx",(a=>{i.idx=a})).require("extent",(a=>{i.extent=a})).require("height",(a=>{i.height=a}),Qt.decodeMetricHeight).geometry((a=>{i.position=a}),Qt.getPoint).success()));class Qt{static getPoint(e){return ao(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Qi:void 0:fi}static parse(e){const i=[],a=[],l=e.length,h=new Kt;for(let f=0;f<l;f++){const m=e.feature(f),v=m.properties.version,x=Qt.getVersionSchema(v);if(x===void 0){Gt(`Unknown elevation feature version number ${v||"(unknown)"}`);continue}const S=m.properties.type;if(!S)continue;const E=it.types[m.type];if(E==="Point"&&S==="curve_point"){const A={};x.parseVertex(h,m,A)&&i.push(A)}else if(E==="Polygon"&&S==="curve_meta"){const A={};x.parseFeature(h,m,A)&&a.push(A)}}return{vertices:i,features:a}}}class Ni{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const l=zs(i,this.dir);if(Math.abs(l)<1e-6)return!1;const h=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/l;return a[0]=this.pos[0]+this.dir[0]*h,a[1]=this.pos[1]+this.dir[1]*h,!0}}class oi{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const l=br(i,this.dir);if(Math.abs(l)<1e-6)return!1;const h=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/l;return a[0]=this.pos[0]+this.dir[0]*h,a[1]=this.pos[1]+this.dir[1]*h,a[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(e,i,a){if((function(R,D){var F=R[0],k=R[1],U=R[2],q=D[0],$=D[1],Y=D[2];return Math.abs(F-q)<=Tt*Math.max(1,Math.abs(F),Math.abs(q))&&Math.abs(k-$)<=Tt*Math.max(1,Math.abs(k),Math.abs($))&&Math.abs(U-Y)<=Tt*Math.max(1,Math.abs(U),Math.abs(Y))})(this.pos,e)||i===0)return a[0]=a[1]=a[2]=0,!1;const[l,h,f]=this.dir,m=this.pos[0]-e[0],v=this.pos[1]-e[1],x=this.pos[2]-e[2],S=l*l+h*h+f*f,E=2*(m*l+v*h+x*f),A=E*E-4*S*(m*m+v*v+x*x-i*i);if(A<0){const R=Math.max(-E/2,0),D=m+l*R,F=v+h*R,k=x+f*R,U=Math.hypot(D,F,k);return a[0]=D*i/U,a[1]=F*i/U,a[2]=k*i/U,!1}{const R=(-E-Math.sqrt(A))/(2*S);if(R<0){const D=Math.hypot(m,v,x);return a[0]=m*i/D,a[1]=v*i/D,a[2]=x*i/D,!1}return a[0]=m+l*R,a[1]=v+h*R,a[2]=x+f*R,!0}}}class en{constructor(e,i,a,l,h){this.TL=e,this.TR=i,this.BR=a,this.BL=l,this.horizon=h}static fromInvProjectionMatrix(e,i,a){const l=[-1,1,1],h=[1,1,1],f=[1,-1,1],m=[-1,-1,1],v=sr(l,l,e),x=sr(h,h,e),S=sr(f,f,e),E=sr(m,m,e);return new en(v,x,S,E,i/a)}}function Fi(n,e,i){let a=1/0,l=-1/0;const h=[];for(const f of n){Sr(h,f,e);const m=br(h,i);a=Math.min(a,m),l=Math.max(l,m)}return[a,l]}function Zi(n,e){let i=!0;for(let a=0;a<n.planes.length;a++){const l=n.planes[a];let h=0;for(let f=0;f<e.length;f++)h+=+(br(l,e[f])+l[3]>=0);if(h===0)return 0;h!==e.length&&(i=!1)}return i?2:1}function Xi(n,e){for(const i of n.projections){const a=Fi(e,n.points[0],i.axis);if(i.projection[1]<a[0]||i.projection[0]>a[1])return 0}return 1}function yi(n,e){let i=0;const a=[0,0,0,0];for(let f=0;f<n.length;f++)a[0]=n[f][0],a[1]=n[f][1],a[2]=n[f][2],a[3]=1,(l=a)[0]*(h=e)[0]+l[1]*h[1]+l[2]*h[2]+l[3]*h[3]>=0&&i++;var l,h;return i}class an{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Si.fromPoints(this.points),this.projections=[],this.frustumEdges=[Sr([],this.points[2],this.points[3]),Sr([],this.points[0],this.points[3]),Sr([],this.points[4],this.points[0]),Sr([],this.points[5],this.points[1]),Sr([],this.points[6],this.points[2]),Sr([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const l=[0,-a[2],a[1]],h=[a[2],0,-a[0]];this.projections.push({axis:l,projection:Fi(this.points,this.points[0],l)}),this.projections.push({axis:h,projection:Fi(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(e,i,a,l){const h=Math.pow(2,a),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((x=>{const S=Er([],x,e),E=1/S[3]/i*h;return(A=S)[0]=(R=S)[0]*(D=[E,E,l?1/S[3]:E,E])[0],A[1]=R[1]*D[1],A[2]=R[2]*D[2],A[3]=R[3]*D[3],A;var A,R,D})),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((x=>{const S=Li([],Br([],Sr([],f[x[0]],f[x[1]]),Sr([],f[x[2]],f[x[1]]))),E=-br(S,f[x[1]]);return S.concat(E)})),v=[];for(let x=0;x<f.length;x++)v.push([f[x][0],f[x][1],f[x][2]]);return new an(v,m)}intersectsPrecise(e,i,a){for(let l=0;l<i.length;l++)if(!yi(e,i[l]))return 0;for(let l=0;l<this.planes.length;l++)if(!yi(e,this.planes[l]))return 0;for(const l of a)for(const h of this.frustumEdges){const f=Br([],l,h),m=zr(f);if(m===0)continue;qt(f,f,1/m);const v=Fi(this.points,this.points[0],f),x=Fi(e,this.points[0],f);if(v[0]>x[1]||x[0]>v[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const a=i[3];if(br([i[0],i[1],i[2]],e)+a<0)return!1}return!0}}class Si{static fromPoints(e){const i=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const l of e)Ue(i,i,l),Pt(a,a,l);return new Si(i,a)}static fromTileIdAndHeight(e,i,a){const l=1<<e.canonical.z,h=e.canonical.x,f=e.canonical.y;return new Si([h/l,f/l,i],[(h+1)/l,(f+1)/l,a])}static applyTransform(e,i){const a=e.getCorners();for(let l=0;l<a.length;++l)sr(a[l],a[l],i);return Si.fromPoints(a)}static applyTransformFast(e,i){const a=[i[12],i[13],i[14]],l=[...a];for(let h=0;h<3;h++)for(let f=0;f<3;f++){const m=i[4*f+h],v=m*e.min[f],x=m*e.max[f];a[h]+=Math.min(v,x),l[h]+=Math.max(v,x)}return new Si(a,l)}static projectAabbCorners(e,i){const a=e.getCorners();for(let l=0;l<a.length;++l)sr(a[l],a[l],i);return a}constructor(e,i){this.min=e,this.max=i,this.center=qt([],_i([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],a=Bo(this.min),l=Bo(this.max);for(let h=0;h<i.length;h++)a[h]=i[h]?this.min[h]:this.center[h],l[h]=i[h]?this.center[h]:this.max[h];return l[2]=this.max[2],new Si(a,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Zi(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Zi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Xi(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Xi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}st(Si,"Aabb");class Mn{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,a=i[1],l=-i[0],h=(e.extent+1)*this.metersToTile;return[new nt(Math.trunc(e.position[0]+a*h),Math.trunc(e.position[1]+l*h)),new nt(Math.trunc(e.position[0]-a*h),Math.trunc(e.position[1]-l*h))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Vi{constructor(e,i,a,l,h,f){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Vn(),Vn(),Vn(),Vn(),Vn(),Vn(),Vn()],this.id=e,this.heightRange={min:a,max:a},this.safeArea=i,this.constantHeight=a,this.constantHeight==null&&(this.constantHeight!=null||l.length!==0)){this.vertices=l,this.edges=h,this.edges=this.edges.filter((m=>{return m.a<this.vertices.length&&m.b<this.vertices.length&&!((v=this.vertices[m.a].position)[0]===(x=this.vertices[m.b].position)[0]&&v[1]===x[1]);var v,x})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const m of this.vertices)this.vertexProps.push({dir:ao(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,m.height),this.heightRange.max=Math.max(this.heightRange.max,m.height);for(const m of this.edges){const v=this.vertices[m.a].position,x=this.vertices[m.b].position,S=os(Vn(),x,v),E=Zn(S),A=ko(Vn(),S,1/E);this.edgeProps.push({vec:S,dir:A,len:E});const R=this.vertexProps[m.a].dir,D=this.vertexProps[m.b].dir;sl(R,R,A),sl(D,D,A)}for(const m of this.vertexProps)m.dir[0]===0&&m.dir[1]===0||ta(m.dir,m.dir);this.tessellate(f)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[a,l]=i;return ti(this.vertices[this.edges[a].a].height,this.vertices[this.edges[a].b].height,l)}computeSlopeNormal(e,i){const a=this.getClosestEdge(e);if(!a)return yt(0,0,1);const l=a[0],h=this.edges[l],f=this.edgeProps[l].vec,m=yt(f[0],f[1],(this.vertices[h.b].height-this.vertices[h.a].height)*i),v=yt(m[1],-m[0],0);Br(v,v,m);const x=zr(v);return x>0?qt(v,v,1/x):jt(v,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,a=Number.POSITIVE_INFINITY,l=0;const[h,f,m,v,x,S,E]=this._tmpVec2;ba(E,e.x,e.y);const A=new Ni(E,null);for(let R=0;R<this.edges.length;R++){const D=this.edges[R],F=this.edgeProps[R].dir;A.dir=F;const k=this.vertices[D.a].position,U=this.vertices[D.b].position,q=A.intersectsPlane(k,this.vertexProps[D.a].dir,h),$=A.intersectsPlane(U,this.vertexProps[D.b].dir,f);if(!q||!$)continue;os(m,f,h),os(v,E,h);const Y=zs(m,m),le=Y>0?zs(v,m)/Y:0,ne=G(le,0,1),de=Math.abs((le-ne)*this.edgeProps[R].len);os(x,E,k),ba(S,F[1],-F[0]);const _e=de+Math.abs(zs(x,S));_e<a&&(i=R,a=_e,l=ne)}return[i,l]}tessellate(e){const i=Yi(),a=Yi(),l=Yi(),h=Yi();for(let f=this.edges.length-1;f>=0;--f){const m=this.edges[f].a,v=this.edges[f].b,{position:x,height:S,extent:E}=this.vertices[m],{position:A,height:R,extent:D}=this.vertices[v],F=this.vertexProps[m].dir,k=this.vertexProps[v].dir;if(jt(i,x[0]/e,x[1]/e,S),jt(a,A[0]/e,A[1]/e,R),jt(l,F[1],-F[0],0),qt(l,l,E),jt(h,k[1],-k[0],0),qt(h,h,D),this.distSqLines(yt(i[0]+.5*l[0],i[1]+.5*l[1],i[2]+.5*l[2]),yt(a[0]-.5*h[0],a[1]-.5*h[1],a[2]-.5*h[2]),yt(i[0]-.5*l[0],i[1]-.5*l[1],i[2]-.5*l[2]),yt(a[0]+.5*h[0],a[1]+.5*h[1],a[2]+.5*h[2]))<=.0025000000000000005)continue;const U=this.vertices.length,q=sl(Vn(),x,A);this.vertices.push({position:ko(q,q,.5),height:.5*(S+R),extent:.5*(E+D)});const $=sl(Vn(),F,k);this.vertexProps.push({dir:ta($,$)}),this.edges.splice(f,1),this.edgeProps.splice(f,1),this.edges.push({a:m,b:U}),this.edges.push({a:U,b:v});const Y=os(Vn(),this.vertices[U].position,x),le=Zn(Y),ne={vec:Y,dir:ko(Vn(),Y,1/le),len:le};this.edgeProps.push(ne),this.edgeProps.push(ne)}}distSqLines(e,i,a,l){const h=On(Yi(),i,e),f=On(Yi(),l,a),m=On(Yi(),e,a),v=br(h,h),x=br(h,f),S=br(h,m),E=br(f,f),A=br(f,m),R=v*E-x*x;if(R===0)return En(Ol(h,a,l,br(m,f)/br(f,f)),e);const D=(v*A-x*S)/R;return En(Ol(h,e,i,(x*A-S*E)/R),Ol(f,a,l,D))}}class $t{static parseFrom(e,i){const a=Qt.parse(e);if(!a)return[];let{vertices:l,features:h}=a;const f=1/ue(i);h.sort(((S,E)=>S.id-E.id)),l.sort(((S,E)=>S.id-E.id||S.idx-E.idx)),l=l.filter(((S,E,A)=>E===A.findIndex((R=>R.id===S.id&&R.idx===S.idx))));const m=new Array;let v=0;const x=l.length;for(const S of h){if(S.constantHeight){m.push(new Vi(S.id,S.bounds,S.constantHeight));continue}for(;v!==x&&l[v].id<S.id;)v++;if(v===x||l[v].id!==S.id)continue;const E=new Array,A=new Array,R=v;for(;v!==x&&l[v].id===S.id;){const D=l[v];if(E.push({position:D.position,height:D.height,extent:D.extent}),v!==R&&l[v-1].idx===D.idx-1){const F=v-R;A.push({a:F-1,b:F})}v++}m.push(new Vi(S.id,S.bounds,void 0,E,A,f))}return m}static getElevationFeature(e,i){if(!i)return;const a=+e.properties[St];return Number.isNaN(a)?void 0:i.find((l=>l.id===a))}}class Ri{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*pt,this.yOffset=(e.y*this.zScale-i.y)*pt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,a){const l=this.constantElevation(i,a);return l??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),a))}computeBiasedHeight(e,i){return i<=0?e:e+i*J(0,i,e>=0?e:Math.abs(.5*e))}}st(Vi,"ElevationFeature");class Dn{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Qa,this.indexArray=new Hn,this.segments=new $n,this.programConfigurations=new Qo(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new tl),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,l){}populate(e,i,a,l){const h=this.layers[0],f=[];let m=null;h.type==="circle"&&(m=h.layout.get("circle-sort-key"));for(const{feature:x,id:S,index:E,sourceLayerIndex:A}of e){const R=this.layers[0]._featureFilter.needGeometry,D=Re(x,R);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),D,a))continue;const F=m?m.evaluate(D,{},a):void 0,k={id:S,properties:x.properties,type:x.type,sourceLayerIndex:A,index:E,geometry:R?D.geometry:Ge(x,a,l),patterns:{},sortKey:F};f.push(k)}m&&f.sort(((x,S)=>x.sortKey-S.sortKey));let v=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new eh,v=l.projection);for(const x of f){const{geometry:S,index:E,sourceLayerIndex:A}=x,R=e[E].feature;this.addFeature(x,S,E,i.availableImages,a,v,i.brightness,i.elevationFeatures),i.featureIndex.insert(R,S,E,A,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,a,l,h,f,m){this.programConfigurations.updatePaintArrays(e,i,h,a,l,f,m,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,r1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,o1.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,a1.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,a,l,h,f,m,v){let x;this.elevationMode!=="none"&&(x=$t.getElevationFeature(e,v));for(const S of i)for(const E of S){const A=E.x,R=E.y;if(A<0||A>=pt||R<0||R>=pt)continue;if(f){const k=f.projectTilePoint(A,R,h),U=f.upVector(h,A,R);this.addGlobeExtVertex(k,U),this.addGlobeExtVertex(k,U),this.addGlobeExtVertex(k,U),this.addGlobeExtVertex(k,U)}const D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),F=D.vertexLength;if(this.addCircleVertex(A,R,-1,-1),this.addCircleVertex(A,R,1,-1),this.addCircleVertex(A,R,1,1),this.addCircleVertex(A,R,-1,1),this.elevationMode!=="none"){const k=x?x.pointElevation(new nt(A,R)):0;this.hasElevation=this.hasElevation||k!==0;for(let U=0;U<4;U++)this.elevatedLayoutVertexArray.emplaceBack(k)}this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+2,F+3),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},l,h,m,void 0,this.worldview)}addCircleVertex(e,i,a,l){this.layoutVertexArray.emplaceBack(2*e+(a+1)/2,2*i+(l+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function kn(n,e){for(let i=0;i<n.length;i++)if(aa(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(aa(n,e[i]))return!0;return!!da(n,e)}function Wn(n,e,i){return!!aa(n,e)||!!ur(e,n,i)}function rr(n,e){if(n.length===1)return Oo(e,n[0]);for(let i=0;i<e.length;i++){const a=e[i];for(let l=0;l<a.length;l++)if(aa(n,a[l]))return!0}for(let i=0;i<n.length;i++)if(Oo(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(da(n,e[i]))return!0;return!1}function qa(n,e,i){if(n.length>1){if(da(n,e))return!0;for(let a=0;a<e.length;a++)if(ur(e[a],n,i))return!0}for(let a=0;a<n.length;a++)if(ur(n[a],e,i))return!0;return!1}function da(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const a=n[i],l=n[i+1];for(let h=0;h<e.length-1;h++)if(ra(a,l,e[h],e[h+1]))return!0}return!1}function ra(n,e,i,a){return Ei(n,i,a)!==Ei(e,i,a)&&Ei(n,e,i)!==Ei(n,e,a)}function vr(n,e,i){return(n.x-i.x)*(e.y-i.y)-(n.y-i.y)*(e.x-i.x)}function go(n,e,i,a){const l=vr(n,e,a),h=vr(n,e,i);if(Math.sign(l)===Math.sign(h))return;const f=vr(i,a,n),m=f+h-l;return Math.sign(f)!==Math.sign(m)?[f/(f-m),h/(h-l)]:void 0}function ur(n,e,i){const a=i*i;if(e.length===1)return n.distSqr(e[0])<a;for(let l=1;l<e.length;l++)if(yo(n,e[l-1],e[l])<a)return!0;return!1}function yo(n,e,i){const a=e.distSqr(i);if(a===0)return n.distSqr(e);const l=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/a;return n.distSqr(l<0?e:l>1?i:i.sub(e)._mult(l)._add(e))}function Oo(n,e){let i,a,l,h=!1;for(let f=0;f<n.length;f++){i=n[f];for(let m=0,v=i.length-1;m<i.length;v=m++)a=i[m],l=i[v],a.y>e.y!=l.y>e.y&&e.x<(l.x-a.x)*(e.y-a.y)/(l.y-a.y)+a.x&&(h=!h)}return h}function aa(n,e){let i=!1;for(let a=0,l=n.length-1;a<n.length;l=a++){const h=n[a],f=n[l];h.y>e.y!=f.y>e.y&&e.x<(f.x-h.x)*(e.y-h.y)/(f.y-h.y)+h.x&&(i=!i)}return i}function Pn(n,e,i,a,l){for(const f of n)if(e<=f.x&&i<=f.y&&a>=f.x&&l>=f.y)return!0;const h=[new nt(e,i),new nt(e,l),new nt(a,l),new nt(a,i)];if(n.length>2){for(const f of h)if(aa(n,f))return!0}for(let f=0;f<n.length-1;f++)if(hr(n[f],n[f+1],h))return!0;return!1}function hr(n,e,i){const a=i[0],l=i[2];if(n.x<a.x&&e.x<a.x||n.x>l.x&&e.x>l.x||n.y<a.y&&e.y<a.y||n.y>l.y&&e.y>l.y)return!1;const h=Ei(n,e,i[0]);return h!==Ei(n,e,i[1])||h!==Ei(n,e,i[2])||h!==Ei(n,e,i[3])}function wn(n,e,i,a,l,h){let f=e.y-n.y,m=n.x-e.x;if(h=h||0){const v=f*f+m*m;if(v===0)return!0;const x=Math.sqrt(v);f/=x,m/=x}return!((i.x-n.x)*f+(i.y-n.y)*m-h<0||(a.x-n.x)*f+(a.y-n.y)*m-h<0||(l.x-n.x)*f+(l.y-n.y)*m-h<0)}function ar(n,e,i,a,l,h,f){return!(wn(n,e,a,l,h,f)||wn(e,i,a,l,h,f)||wn(i,n,a,l,h,f)||wn(a,l,n,e,i,f)||wn(l,h,n,e,i,f)||wn(h,a,n,e,i,f))}function Jr(n,e,i){const a=e.paint.get(n).value;return a.kind==="constant"?a.value:i.programConfigurations.get(e.id).getMaxValue(n)}function or(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function vo(n,e,i,a,l){if(!e[0]&&!e[1])return n;const h=nt.convert(e)._mult(l);i==="viewport"&&h._rotate(-a);const f=[];for(let m=0;m<n.length;m++)f.push(n[m].sub(h));return f}function iu(n,e,i,a){const l=nt.convert(n)._mult(a);return e==="viewport"&&l._rotate(-i),l}let es,dc;function lh(n,e,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[n*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}st(Dn,"CircleBucket",{omit:["layers"]});class Fo{constructor(e,i,a){this.z=e,this.x=i,this.y=a,this.key=xo(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const a=(function(h,f,m){var v=lh(256*h,256*(f=Math.pow(2,m)-f-1),m),x=lh(256*(h+1),256*(f+1),m);return v[0]+","+v[1]+","+x[0]+","+x[1]})(this.x,this.y,this.z),l=(function(h,f,m){let v,x="";for(let S=h;S>0;S--)v=1<<S-1,x+=(f&v?1:0)+(m&v?2:0);return x})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class nl{constructor(e,i){this.wrap=e,this.canonical=i,this.key=xo(e,i.z,i.z,i.x,i.y)}}class Gr{constructor(e,i,a,l,h){this.overscaledZ=e,this.wrap=i,this.canonical=new Fo(a,+l,+h),this.key=i===0&&e===a?this.canonical.key:xo(i,e,a,l,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Gr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Gr(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return xo(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return xo(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Gr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,l=2*this.canonical.y;return[new Gr(i,this.wrap,i,a,l),new Gr(i,this.wrap,i,a+1,l),new Gr(i,this.wrap,i,a,l+1),new Gr(i,this.wrap,i,a+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Gr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Gr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new nl(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function xo(n,e,i,a,l){const h=1<<Math.min(i,22);let f=h*(l%h)+a%h;return n&&i<22&&(f+=h*h*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*f+i)+(e-i)}const ts=[n=>{let e=n.canonical.x-1,i=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,i--),new Gr(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,i=n.wrap;return e===1<<n.canonical.z&&(e=0,i++),new Gr(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>new Gr(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new Gr(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];st(Fo,"CanonicalTileID"),st(Gr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const hd=zi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:dd}=hd,Ym=zi([{name:"a_pos_3",components:3,type:"Int16"}]);var qp=zi([{name:"a_pos",type:"Int16",components:2}]);function d1(n){return n*Jn/M}const Km=[new Si([_,_,_],[y,y,y]),new Si([_,_,_],[0,0,y]),new Si([0,_,_],[y,0,y]),new Si([_,0,_],[0,y,y]),new Si([0,0,_],[y,y,y])];function Zp(n,e,i,a=!0){const l=qt([],n._camera.position,n.worldSize),h=[e,i,1,1];Er(h,h,n.pixelMatrixInverse),Fl(h,h,1/h[3]);const f=Li([],Sr([],h,l)),m=n.globeMatrix,v=[m[12],m[13],m[14]],x=Sr([],v,l),S=zr(x),E=Li([],x),A=n.worldSize/(2*Math.PI),R=br(E,f),D=Math.asin(A/S);if(D<Math.acos(R)){if(!a)return null;const Be=[],Ee=[];qt(Be,f,S/R),Li(Ee,Sr(Ee,Be,x)),Li(f,_i(f,x,qt(f,Ee,Math.tan(D)*S)))}const F=[];new oi(l,f).closestPointOnSphere(v,A,F);const k=Li([],_r(m,0)),U=Li([],_r(m,1)),q=Li([],_r(m,2)),$=br(k,F),Y=br(U,F),le=br(q,F),ne=pa(Math.asin(-Y/A));let de=pa(Math.atan2($,le));de=n.center.lng+(function(Be,Ee){const Ve=(Ee-Be+180)%360-180;return Ve<-180?Ve+360:Ve})(n.center.lng,de);const _e=H(de),ye=G(j(ne),0,1);return new we(_e,ye)}class rp{constructor(e,i,a){this.a=Sr([],e,a),this.b=Sr([],i,a),this.center=a;const l=Li([],this.a),h=Li([],this.b);this.angle=Math.acos(br(l,h))}}function ap(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:(function(a,l,h,f){const m=Math.sin(h);return a*(Math.sin((1-f)*h)/m)+l*(Math.sin(f*h)/m)})(n.a[e],n.b[e],n.angle,G(i,0,1))+n.center[e]}function Cl(n){if(n.z<=1)return Km[n.z+2*n.y+n.x];const e=Xp(f1(n));return Si.fromPoints(e)}function Yn(n,e,i){return qt(n,n,1-i),gi(n,n,e,i)}function op(n,e,i){for(const a of n)sr(a,a,e),qt(a,a,i)}function Jm(n,e,i,a){const l=e/n.worldSize,h=n.globeMatrix;if(i.z<=1){const ye=Cl(i).getCorners();return op(ye,h,l),Si.fromPoints(ye)}const f=f1(i,a),m=Xp(f,Jn+d1(n._tileCoverLift));op(m,h,l);const v=Number.MAX_VALUE,x=[-v,-v,-v],S=[v,v,v];if(f.contains(n.center)){for(const Ee of m)Ue(S,S,Ee),Pt(x,x,Ee);x[2]=0;const ye=n.point,Be=[ye.x*l,ye.y*l,0];return Ue(S,S,Be),Pt(x,x,Be),new Si(S,x)}if(n._tileCoverLift>0){for(const ye of m)Ue(S,S,ye),Pt(x,x,ye);return new Si(S,x)}const E=[h[12]*l,h[13]*l,h[14]*l],A=f.getCenter(),R=G(n.center.lat,-Q,Q),D=G(A.lat,-Q,Q),F=H(n.center.lng),k=j(R);let U=F-H(A.lng);const q=k-j(D);U>.5?U-=1:U<-.5&&(U+=1);let $=0;Math.abs(U)>Math.abs(q)?$=U>=0?1:3:($=q>=0?0:2,gi(E,E,[h[4]*l,h[5]*l,h[6]*l],-Math.sin(Ui(q>=0?f.getSouth():f.getNorth()))*Jn));const Y=m[$],le=m[($+1)%4],ne=new rp(Y,le,E),de=[ap(ne,0)||Y[0],ap(ne,1)||Y[1],ap(ne,2)||Y[2]],_e=eo(n.zoom);if(_e>0){const ye=(function({x:Ee,y:Ve,z:Xe},tt,gt,ot,Ye){const at=1/(1<<Xe);let Fe=Ee*at,Le=Fe+at,rt=Ve*at,mt=rt+at,Ke=0;const Lt=(Fe+Le)/2-ot;return Lt>.5?Ke=-1:Lt<-.5&&(Ke=1),Fe=((Fe+Ke)*tt-(ot*=tt))*gt+ot,Le=((Le+Ke)*tt-ot)*gt+ot,rt=(rt*tt-(Ye*=tt))*gt+Ye,mt=(mt*tt-Ye)*gt+Ye,[[Fe,mt,0],[Le,mt,0],[Le,rt,0],[Fe,rt,0]]})(i,e,n._pixelsPerMercatorPixel,F,k);for(let Ee=0;Ee<m.length;Ee++)Yn(m[Ee],ye[Ee],_e);const Be=_i([],ye[$],ye[($+1)%4]);qt(Be,Be,.5),Yn(de,Be,_e)}for(const ye of m)Ue(S,S,ye),Pt(x,x,ye);return S[2]=Math.min(Y[2],le[2]),Ue(S,S,de),Pt(x,x,de),new Si(S,x)}function f1({x:n,y:e,z:i},a=!1){const l=1/(1<<i),h=new P(K(n*l),e===(1<<i)-1&&a?-90:W((e+1)*l)),f=new P(K((n+1)*l),e===0&&a?90:W(e*l));return new z(h,f)}function Xp(n,e=Jn){const i=Ui(n.getNorth()),a=Ui(n.getSouth()),l=Math.cos(i),h=Math.cos(a),f=Math.sin(i),m=Math.sin(a),v=n.getWest(),x=n.getEast();return[b(h,m,v,e),b(h,m,x,e),b(l,f,x,e),b(l,f,v,e)]}function p1(n,e,i,a){const l=1<<i.z,h=(n/pt+i.x)/l;return T(W((e/pt+i.y)/l),K(h),a)}function sp({min:n,max:e}){return r/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const m1=new Float64Array(16);function nu(n){const e=sp(n),i=ea(m1,[e,e,e]);return ki(i,i,Lr([],n.min))}function _1(n){const e=(a=n.min,(i=m1)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=a[0],i[13]=a[1],i[14]=a[2],i[15]=1,i);var i,a;const l=1/sp(n);return si(e,e,[l,l,l])}function hf(n){const e=pt/(2*Math.PI);return n/(2*Math.PI)/e}function lp(n,e){return pt/(512*Math.pow(2,n))*sp(Cl(e))}function ru(n,e,i,a,l){const h=hf(i),f=[n,e,-i/(2*Math.PI)],m=$i(new Float64Array(16));return ki(m,m,f),si(m,m,[h,h,h]),_n(m,m,Ui(-l)),mr(m,m,Ui(-a)),m}function eo(n){return J(c,t,n)}function df(n,e){const i=T(e.lat,e.lng),a=(function(D){const F=T(D._center.lat,D._center.lng);let k=Br([],yt(0,1,0),F);const U=Oa([],-D.angle,F);k=sr(k,k,U),Oa(U,-D._pitch,k);const q=Li([],F);return qt(q,q,d1(D.cameraToCenterDistance/D.pixelsPerMeter)),sr(q,q,U),_i([],F,q)})(n);return f=(l=On([],a,i))[0],m=l[1],v=l[2],x=(h=i)[0],S=h[1],E=h[2],R=(A=Math.sqrt((f*f+m*m+v*v)*(x*x+S*S+E*E)))&&br(l,h)/A,Math.acos(Math.min(Math.max(R,-1),1));var l,h,f,m,v,x,S,E,A,R}function $p(n,e){return df(n,e)>Math.PI/2*1.01}const Wp=Ui(85),Qm=Math.cos(Wp),e0=Math.sin(Wp),t0=yn(),i0=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function cp(n,e,i,a,l,h,f,m,v){if(h&&n.queryGeometry.isAboveHorizon)return!1;h&&(v*=n.pixelToTileUnitsFactor);const x=n.tileID.canonical,S=i.projection.upVectorScale(x,i.center.lat,i.worldSize).metersToTile;for(const E of e)for(const A of E){const R=A.add(m),D=l&&i.elevation?i.elevation.exaggeration()*l.getElevationAt(R.x,R.y,!0):0,F=i.projection.projectTilePoint(R.x,R.y,x);if(D>0){const $=i.projection.upVector(x,R.x,R.y);F.x+=$[0]*S*D,F.y+=$[1]*S*D,F.z+=$[2]*S*D}const k=h?R:n0(F.x,F.y,F.z,a),U=h?n.tilespaceRays.map(($=>Kp($,D))):n.queryGeometry.screenGeometry,q=Er([],[F.x,F.y,F.z,1],a);if(!f&&h?v*=q[3]/i.cameraToCenterDistance:f&&!h&&(v*=i.cameraToCenterDistance/q[3]),h){const $=W((A.y/pt+x.y)/(1<<x.z));v/=i.projection.pixelsPerMeter($,1)/Z(1,$)}if(Wn(U,k,v))return!0}return!1}function n0(n,e,i,a){const l=Er([],[n,e,i,1],a);return new nt(l[0]/l[3],l[1]/l[3])}const Yp=yt(0,0,0),c_=yt(0,0,1);function Kp(n,e){const i=Yi();return Yp[2]=e,n.intersectsPlane(Yp,c_,i),new nt(i[0],i[1])}class up extends Dn{}let r0,a0,ff,o0;function Jp(n,{width:e,height:i},a,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*i*a)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*i*a);return n.width=e,n.height=i,n.data=l,n}function qn(n,e,i){const{width:a,height:l}=e;a===n.width&&l===n.height||(g1(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,a),height:Math.min(n.height,l)},i,null),n.width=a,n.height=l,n.data=e.data)}function g1(n,e,i,a,l,h,f,m){if(l.width===0||l.height===0)return e;if(l.width>n.width||l.height>n.height||i.x>n.width-l.width||i.y>n.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||a.x>e.width-l.width||a.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const v=n.data,x=e.data,S=h===4&&m;for(let E=0;E<l.height;E++){const A=((i.y+E)*n.width+i.x)*h,R=((a.y+E)*e.width+a.x)*h;if(S)for(let D=0;D<l.width;D++){const F=A+D*h+3,k=R+D*h;x[k+0]=255,x[k+1]=255,x[k+2]=255,x[k+3]=v[F]}else if(f)for(let D=0;D<l.width;D++){const F=A+D*h,k=R+D*h,U=new pn(v[F+0]/255,v[F+1]/255,v[F+2]/255,v[F+3]).toNonPremultipliedRenderColor(f).toArray();x[k+0]=U[0],x[k+1]=U[1],x[k+2]=U[2],x[k+3]=U[3]}else for(let D=0;D<l.width*h;D++)x[R+D]=v[A+D]}return e}st(up,"HeatmapBucket",{omit:["layers"]});class zl{constructor(e,i){Jp(this,e,1,i)}resize(e){qn(this,new zl(e),1)}clone(){return new zl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,l,h){g1(e,i,a,l,h,1,null)}}class fa{constructor(e,i){Jp(this,e,4,i)}resize(e){qn(this,new fa(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new fa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,l,h,f,m){g1(e,i,a,l,h,4,f,m)}}class Qp{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function fd(n){const e={},i=n.resolution||256,a=n.clips?n.clips.length:1,l=n.image||new fa({width:i,height:a}),h=(f,m,v)=>{e[n.evaluationKey]=v;const x=n.expression.evaluate(e),S=x?x.toNonPremultipliedRenderColor(null):null;S&&(l.data[f+m+0]=Math.floor(255*S.r),l.data[f+m+1]=Math.floor(255*S.g),l.data[f+m+2]=Math.floor(255*S.b),l.data[f+m+3]=Math.floor(255*S.a))};if(n.clips)for(let f=0,m=0;f<a;++f,m+=4*i)for(let v=0,x=0;v<i;v++,x+=4){const S=v/(i-1),{start:E,end:A}=n.clips[f];h(m,x,E*(1-S)+A*S)}else for(let f=0,m=0;f<i;f++,m+=4)h(0,m,f/(i-1));return l}st(zl,"AlphaImage"),st(fa,"RGBAImage");const y1=zi([{name:"a_pos",components:2,type:"Int16"}],4),hp=zi([{name:"a_road_z_offset",components:1,type:"Float32"}],4),u_=zi([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),s0=zi([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function pf(n,e,i=2){const a=e&&e.length,l=a?e[0]*i:n.length;let h=l0(n,0,l,i,!0);const f=[];if(!h||h.next===h.prev)return f;let m,v,x;if(a&&(h=(function(S,E,A,R){const D=[];for(let F=0,k=E.length;F<k;F++){const U=l0(S,E[F]*R,F<k-1?E[F+1]*R:S.length,R,!1);U===U.next&&(U.steiner=!0),D.push(dp(U))}D.sort(c0);for(let F=0;F<D.length;F++)A=d_(D[F],A);return A})(n,e,h,i)),n.length>80*i){m=n[0],v=n[1];let S=m,E=v;for(let A=i;A<l;A+=i){const R=n[A],D=n[A+1];R<m&&(m=R),D<v&&(v=D),R>S&&(S=R),D>E&&(E=D)}x=Math.max(S-m,E-v),x=x!==0?32767/x:0}return mf(h,f,i,m,v,x,0),f}function l0(n,e,i,a,l){let h;if(l===(function(f,m,v,x){let S=0;for(let E=m,A=v-x;E<v;E+=x)S+=(f[A]-f[E])*(f[E+1]+f[A+1]),A=E;return S})(n,e,i,a)>0)for(let f=e;f<i;f+=a)h=au(f/a|0,n[f],n[f+1],h);else for(let f=i-a;f>=e;f-=a)h=au(f/a|0,n[f],n[f+1],h);return h&&gf(h,h.next)&&(yf(h),h=h.next),h}function ch(n,e){if(!n)return n;e||(e=n);let i,a=n;do if(i=!1,a.steiner||!gf(a,a.next)&&Hr(a.prev,a,a.next)!==0)a=a.next;else{if(yf(a),a=e=a.prev,a===a.next)break;i=!0}while(i||a!==e);return e}function mf(n,e,i,a,l,h,f){if(!n)return;!f&&h&&(function(v,x,S,E){let A=v;do A.z===0&&(A.z=v1(A.x,A.y,x,S,E)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==v);A.prevZ.nextZ=null,A.prevZ=null,(function(R){let D,F=1;do{let k,U=R;R=null;let q=null;for(D=0;U;){D++;let $=U,Y=0;for(let ne=0;ne<F&&(Y++,$=$.nextZ,$);ne++);let le=F;for(;Y>0||le>0&&$;)Y!==0&&(le===0||!$||U.z<=$.z)?(k=U,U=U.nextZ,Y--):(k=$,$=$.nextZ,le--),q?q.nextZ=k:R=k,k.prevZ=q,q=k;U=$}q.nextZ=null,F*=2}while(D>1)})(A)})(n,a,l,h);let m=n;for(;n.prev!==n.next;){const v=n.prev,x=n.next;if(h?em(n,a,l,h):Rr(n))e.push(v.i,n.i,x.i),yf(n),n=x.next,m=x.next;else if((n=x)===m){f?f===1?mf(n=to(ch(n),e),e,i,a,l,h,2):f===2&&h_(n,e,i,a,l,h):mf(ch(n),e,i,a,l,h,1);break}}}function Rr(n){const e=n.prev,i=n,a=n.next;if(Hr(e,i,a)>=0)return!1;const l=e.x,h=i.x,f=a.x,m=e.y,v=i.y,x=a.y,S=Math.min(l,h,f),E=Math.min(m,v,x),A=Math.max(l,h,f),R=Math.max(m,v,x);let D=a.next;for(;D!==e;){if(D.x>=S&&D.x<=A&&D.y>=E&&D.y<=R&&_f(l,m,h,v,f,x,D.x,D.y)&&Hr(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function em(n,e,i,a){const l=n.prev,h=n,f=n.next;if(Hr(l,h,f)>=0)return!1;const m=l.x,v=h.x,x=f.x,S=l.y,E=h.y,A=f.y,R=Math.min(m,v,x),D=Math.min(S,E,A),F=Math.max(m,v,x),k=Math.max(S,E,A),U=v1(R,D,e,i,a),q=v1(F,k,e,i,a);let $=n.prevZ,Y=n.nextZ;for(;$&&$.z>=U&&Y&&Y.z<=q;){if($.x>=R&&$.x<=F&&$.y>=D&&$.y<=k&&$!==l&&$!==f&&_f(m,S,v,E,x,A,$.x,$.y)&&Hr($.prev,$,$.next)>=0||($=$.prevZ,Y.x>=R&&Y.x<=F&&Y.y>=D&&Y.y<=k&&Y!==l&&Y!==f&&_f(m,S,v,E,x,A,Y.x,Y.y)&&Hr(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;$&&$.z>=U;){if($.x>=R&&$.x<=F&&$.y>=D&&$.y<=k&&$!==l&&$!==f&&_f(m,S,v,E,x,A,$.x,$.y)&&Hr($.prev,$,$.next)>=0)return!1;$=$.prevZ}for(;Y&&Y.z<=q;){if(Y.x>=R&&Y.x<=F&&Y.y>=D&&Y.y<=k&&Y!==l&&Y!==f&&_f(m,S,v,E,x,A,Y.x,Y.y)&&Hr(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function to(n,e){let i=n;do{const a=i.prev,l=i.next.next;!gf(a,l)&&rm(a,i,i.next,l)&&b1(a,l)&&b1(l,a)&&(e.push(a.i,i.i,l.i),yf(i),yf(i.next),i=n=l),i=i.next}while(i!==n);return ch(i)}function h_(n,e,i,a,l,h){let f=n;do{let m=f.next.next;for(;m!==f.prev;){if(f.i!==m.i&&nm(f,m)){let v=u0(f,m);return f=ch(f,f.next),v=ch(v,v.next),mf(f,e,i,a,l,h,0),void mf(v,e,i,a,l,h,0)}m=m.next}f=f.next}while(f!==n)}function c0(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function d_(n,e){const i=(function(l,h){let f=h;const m=l.x,v=l.y;let x,S=-1/0;if(gf(l,f))return f;do{if(gf(l,f.next))return f.next;if(v<=f.y&&v>=f.next.y&&f.next.y!==f.y){const F=f.x+(v-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(F<=m&&F>S&&(S=F,x=f.x<f.next.x?f:f.next,F===m))return x}f=f.next}while(f!==h);if(!x)return null;const E=x,A=x.x,R=x.y;let D=1/0;f=x;do{if(m>=f.x&&f.x>=A&&m!==f.x&&im(v<R?m:S,v,A,R,v<R?S:m,v,f.x,f.y)){const F=Math.abs(v-f.y)/(m-f.x);b1(f,l)&&(F<D||F===D&&(f.x>x.x||f.x===x.x&&tm(x,f)))&&(x=f,D=F)}f=f.next}while(f!==E);return x})(n,e);if(!i)return e;const a=u0(i,n);return ch(a,a.next),ch(i,i.next)}function tm(n,e){return Hr(n.prev,n,e.prev)<0&&Hr(e.next,n,n.next)<0}function v1(n,e,i,a,l){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*l|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function dp(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function im(n,e,i,a,l,h,f,m){return(l-f)*(e-m)>=(n-f)*(h-m)&&(n-f)*(a-m)>=(i-f)*(e-m)&&(i-f)*(h-m)>=(l-f)*(a-m)}function _f(n,e,i,a,l,h,f,m){return!(n===f&&e===m)&&im(n,e,i,a,l,h,f,m)}function nm(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!(function(i,a){let l=i;do{if(l.i!==i.i&&l.next.i!==i.i&&l.i!==a.i&&l.next.i!==a.i&&rm(l,l.next,i,a))return!0;l=l.next}while(l!==i);return!1})(n,e)&&(b1(n,e)&&b1(e,n)&&(function(i,a){let l=i,h=!1;const f=(i.x+a.x)/2,m=(i.y+a.y)/2;do l.y>m!=l.next.y>m&&l.next.y!==l.y&&f<(l.next.x-l.x)*(m-l.y)/(l.next.y-l.y)+l.x&&(h=!h),l=l.next;while(l!==i);return h})(n,e)&&(Hr(n.prev,n,e.prev)||Hr(n,e.prev,e))||gf(n,e)&&Hr(n.prev,n,n.next)>0&&Hr(e.prev,e,e.next)>0)}function Hr(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function gf(n,e){return n.x===e.x&&n.y===e.y}function rm(n,e,i,a){const l=x1(Hr(n,e,i)),h=x1(Hr(n,e,a)),f=x1(Hr(i,a,n)),m=x1(Hr(i,a,e));return l!==h&&f!==m||!(l!==0||!fp(n,i,e))||!(h!==0||!fp(n,a,e))||!(f!==0||!fp(i,n,a))||!(m!==0||!fp(i,e,a))}function fp(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function x1(n){return n>0?1:n<0?-1:0}function b1(n,e){return Hr(n.prev,n,n.next)<0?Hr(n,e,n.next)>=0&&Hr(n,n.prev,e)>=0:Hr(n,e,n.prev)<0||Hr(n,n.next,e)<0}function u0(n,e){const i=pp(n.i,n.x,n.y),a=pp(e.i,e.x,e.y),l=n.next,h=e.prev;return n.next=e,e.prev=n,i.next=l,l.prev=i,a.next=i,i.prev=a,h.next=a,a.prev=h,a}function au(n,e,i,a){const l=pp(n,e,i);return a?(l.next=a.next,l.prev=a,a.next.prev=l,a.next=l):(l.prev=l,l.next=l),l}function yf(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function pp(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function pd(n,e){const i=n.length;if(i<=1)return[n];const a=[];let l,h;for(let f=0;f<i;f++){const m=Mi(n[f]);m!==0&&(n[f].area=Math.abs(m),h===void 0&&(h=m<0),h===m<0?(l&&a.push(l),l=[n[f]]):l.push(n[f]))}if(l&&a.push(l),e>1)for(let f=0;f<a.length;f++)a[f].length<=e||(Mo(a[f],e,1,a[f].length-1,f_),a[f]=a[f].slice(0,e));return a}function f_(n,e){return e.area-n.area}function h0(n,e,i=1){if(!n)return null;const a=typeof n=="string"?la.from(n).getPrimary():n.getPrimary(),l=typeof n=="string"?null:n.getSecondary();for(const h of[a,l]){if(!h)continue;const f=h.id.toString();e.has(f)||e.set(f,[]),h.scaleSelf(i),e.get(f).push(h)}return{primary:a.toString(),secondary:l?l.toString():null}}function mp(n,e,i,a){const l=a.patternDependencies;let h=!1;for(const f of e){const m=f.paint.get(`${n}-pattern`);m.isConstant()||(h=!0),h0(m.constantOr(null),l,i)&&(h=!0)}return h}function w1(n,e,i,a,l,h){const f=h.patternDependencies;for(const m of e){const v=m.paint.get(`${n}-pattern`).value;if(v.kind!=="constant"){let x=v.evaluate({zoom:a},i,{},h.availableImages);x=x&&x.name?x.name:x;const S=h0(x,f,l);if(!S)continue;const{primary:E,secondary:A}=S;E&&(i.patterns[m.id]=[E,A].filter(Boolean))}}return i}class _p{constructor(){this.polygons=new Map}add(e,...i){const a=this.polygons.get(e);a?a.push(...i):this.polygons.set(e,i)}merge(e){for(const[i,a]of e.polygons)this.add(i,...a)}}class ou{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=pt&&i>=pt}static evaluate(e){if(e.length===0)return new ou;let i=[];for(const v of e)i.push(...v.portals);if(i.length===0)return new ou;for(const v of i){const x=v.va,S=v.vb;(ou.isOnBorder(x.x,S.x)||ou.isOnBorder(x.y,S.y))&&(v.type="border")}const a=i.filter((v=>v.type!=="unevaluated")),l=i.filter((v=>v.type==="unevaluated"));if(l.length===0)return new ou;l.sort(((v,x)=>v.hash===x.hash?v.isTunnel===x.isTunnel?0:v.isTunnel?-1:1:v.hash<x.hash?1:-1)),i=a.concat(l);let h=a.length,f=h,m=h;do if(f++,f===i.length||i[h].hash!==i[f].hash){if(f-h==2){m<h&&(i[m]=i[h],i[h]=null);const v=i[m],x=i[f-1];v.type=v.isTunnel!==x.isTunnel?"tunnel":"polygon",v.connection={a:v.connection.a,b:x.connection.a},m++}h=f}while(h!==i.length);return i.splice(m),i.sort(((v,x)=>v.hash<x.hash?1:-1)),{portals:i}}}st(ou,"ElevationPortalGraph"),st(_p,"ElevationPolygons");class rl{constructor(e,i,a){this.outPositions=e,this.outNormals=i,this.outIndices=a,this.vertexLookup=new Map}addVertex(e,i,a){let l=e[2];a!=null&&(l*=a);const h=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,f=this.vertexLookup.get(h);if(f!=null)return f;const m=this.outPositions.length;this.vertexLookup.set(h,m);const v=Math.trunc(16384*i[0]),x=Math.trunc(16384*i[1]),S=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],l),this.outNormals.emplaceBack(v,x,S),m}addTriangle(e,i,a){this.outIndices.emplaceBack(e,i,a)}addTriangles(e,i,a){if(e.length===0)return;const l=a.length===1,h=Yi(),f=Yi();for(let m=0;m<e.length;m+=3){const v=i[e[m+0]],x=i[e[m+1]],S=i[e[m+2]],E=l?a[0]:a[e[m+1]],A=l?a[0]:a[e[m+2]];jt(h,v.x,v.y,l?a[0]:a[e[m+0]]);const R=this.addVertex(h,f);jt(h,x.x,x.y,E);const D=this.addVertex(h,f);jt(h,S.x,S.y,A);const F=this.addVertex(h,f);this.outIndices.emplaceBack(R,D,F)}}addQuad(e,i,a,l,h,f){const m=this.addVertex(e,h,f),v=this.addVertex(i,h,f),x=this.addVertex(a,h,f),S=this.addVertex(l,h,f);this.addTriangle(m,v,x),this.addTriangle(x,S,m)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class io{constructor(e,i,a,l){this.unevaluatedPortals=new ou,this.portalPolygons=new _p,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new nd,this.vertexNormals=new Wd,this.indexArray=new Hn,this.tileToMeters=ue(e),this.bridgeProgramConfigurations=new Qo(i,{zoom:a,lut:l},(h=>h!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new Qo(i,{zoom:a,lut:l},(h=>h!=="fill-bridge-guard-rail-color"))}addVertices(e,i){const a=this.unevalVertices.length;for(let l=0;l<e.length;l++)this.unevalVertices.push(e[l]),this.unevalHeights.push(i[l]);return a}addTriangles(e,i,a){const l=a?this.unevalTunnelTriangles:this.unevalTriangles;for(const h of e)l.push(h+i)}addRenderableRing(e,i,a,l,h,f){const m=[new nt(h.min.x,h.min.y),new nt(h.max.x,h.min.y),new nt(h.max.x,h.max.y),new nt(h.min.x,h.max.y)];for(let v=0;v<a-1;v++){const x=i+v,S=x+1,E=this.unevalVertices[x],A=this.unevalVertices[S];if(!(E.x>=h.min.x&&E.x<=h.max.x&&E.y>=h.min.y&&E.y<=h.max.y||A.x>=h.min.x&&A.x<=h.max.x&&A.y>=h.min.y&&A.y<=h.max.y||hr(E,A,m))||this.isOnBorder(E.x,A.x)||this.isOnBorder(E.y,A.y))continue;const R=io.computeEdgeHash(this.unevalVertices[x],this.unevalVertices[S]);let D,F=this.vertexHashLookup.get(io.computePosHash(E));F!=null?D=F.next:(F=this.vertexHashLookup.get(io.computePosHash(A)),D=F!=null?F.prev:R),this.unevalEdges.push({polygonIdx:e,a:x,b:S,hash:R,portalHash:D,isTunnel:l,type:"unevaluated",featureInfo:f})}}addPortalCandidates(e,i,a,l,h){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:h});const f=i[0];this.vertexHashLookup.clear();let m=io.computeEdgeHash(f[f.length-2],f[f.length-1]);for(let v=0;v<f.length-1;v++){const x=f[v+0],S=f[v+1],E=ao(S.x-x.x,S.y-x.y),A=Zn(E);if(A===0)continue;let R="unevaluated";const D=l.pointElevation(x),F=l.pointElevation(S);Math.abs(D)<.01&&Math.abs(F)<.01?R="entrance":(this.isOnBorder(x.x,S.x)||this.isOnBorder(x.y,S.y))&&(R="border");const k=io.computeEdgeHash(x,S);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:x,vb:S,vab:E,length:A,hash:k,isTunnel:a,type:R});const U=io.computePosHash(x);this.vertexHashLookup.set(U,{prev:m,next:k}),m=k}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),a=A=>{A.primitiveLength=this.indexArray.length-A.primitiveOffset},l=new rl(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const h=i(),f=i(),m=i(),v=(A,R)=>{A.sort(((F,k)=>F.type===R&&k.type!==R?-1:F.type!==R&&k.type===R?1:0));const D=A.findIndex((F=>F.type!==R));return D>=0?D:A.length};let x=0;this.unevalEdges.length>0&&(x=v(this.unevalEdges,"none"),this.constructBridgeStructures(l,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:x},this.tileToMeters)),a(m);const S=i(),E=i();if(this.unevalEdges.length>0){const A=this.unevalEdges.splice(x),R=v(A,"tunnel")+x;this.unevalEdges.push(...A),this.constructTunnelStructures(l,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:x},{min:x,max:R})}a(S),l.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),a(E),l.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),a(f),l.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),a(h),this.maskSegments=$n.simpleSegment(0,E.primitiveOffset,0,E.primitiveLength),this.depthSegments=$n.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength),this.renderableBridgeSegments=$n.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength),this.renderableTunnelSegments=$n.simpleSegment(0,S.primitiveOffset,0,S.primitiveLength),this.shadowCasterSegments=$n.simpleSegment(0,h.primitiveOffset,0,h.primitiveLength)}update(e,i,a,l,h,f,m,v){this.bridgeProgramConfigurations.updatePaintArrays(e,i,h,a,l,f,m,v),this.tunnelProgramConfigurations.updatePaintArrays(e,i,h,a,l,f,m,v)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,u_.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,s0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,a,l,h){const f=(m,v)=>{for(let x=0;x<v.length-1;x++){const S=v[x].featureIndex,E=v[x+1].vertexStart,A=e.feature(S);m.populatePaintArrays(E,A,S,{},a,i,l,void 0,h)}};f(this.bridgeProgramConfigurations,this.bridgeFeatureSections),f(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,a,l,h){const f=new Map;for(let m=l;m<h;m++){const v=a[m],x=v.a,S=v.b,E=io.computePosHash(e[x]),A=io.computePosHash(e[S]);let R=f.get(E);R||(R={},f.set(E,R));let D=f.get(A);D||(D={},f.set(A,D)),i[x]<=0&&i[S]<=0||(R.to=S,D.from=x)}return f}isTerminalVertex(e,i){const a=io.computePosHash(this.unevalVertices[e]),l=i.get(a);return!l||!l.from||!l.to}constructBridgeStructures(e,i,a,l,h,f){e.clearVertexLookup();const m=this.computeVertexConnections(i,a,l,h.min,h.max),v=1/f,x=.5*v,S=(gt,ot)=>jt(gt,i[ot].x,i[ot].y,a[ot]*v),E=Yi(),A=Yi(),R=Yi(),D=Yi(),F=Yi(),k=(gt,ot)=>{const Ye=m.get(io.computePosHash(i[ot])),at=Ye.from,Fe=Ye.to;if(!at||!Fe)return;S(E,at),S(A,ot),S(R,Fe),wo(D),Es(E,A)||(Sr(F,A,E),Li(D,F)),Es(R,A)||(Sr(F,R,A),_i(D,D,Li(F,F)));const Le=ol(D);return Le>0?qt(gt,D,1/Le):void 0};let U=Number.POSITIVE_INFINITY;this.sortSubarray(l,h.min,h.max,((gt,ot)=>gt.featureInfo.featureIndex-ot.featureInfo.featureIndex));const q=Yi(),$=Yi(),Y=Yi(),le=Yi(),ne=Yi(),de=Yi(),_e=Yi(),ye=Yi(),Be=Yi(),Ee=[Yi(),Yi(),Yi(),Yi()],Ve=[Yi(),Yi(),Yi(),Yi()],Xe=[{coord:new nt(0,0),height:0},{coord:new nt(0,0),height:0}],tt=(gt,ot)=>gt>ot;for(let gt=h.min;gt<h.max;gt++){const ot=l[gt];if(!ot.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Xe,i,a,ot,tt))continue;const[Ye,at]=Xe;if(jt(q,Ye.coord.x,Ye.coord.y,v*Ye.height),jt($,at.coord.x,at.coord.y,v*at.height),Es(q,$))continue;Sr(Y,$,q),Li(Y,Y);const Fe=k(ye,ot.a)||Y,Le=k(Be,ot.b)||Y;jt(le,Fe[1],-Fe[0],0),Li(le,le),jt(ne,Le[1],-Le[0],0),Li(ne,ne),Br(ye,le,Fe),Li(de,ye),Br(ye,ne,Le),Li(_e,ye),_i(Ee[0],q,qt(ye,Sr(ye,le,de),x)),_i(Ee[1],q,qt(ye,_i(ye,le,de),x)),_i(Ee[2],q,qt(ye,de,x)),Ee[3]=q,_i(Ve[0],$,qt(ye,Sr(ye,ne,_e),x)),_i(Ve[1],$,qt(ye,_i(ye,ne,_e),x)),_i(Ve[2],$,qt(ye,_e,x)),Ve[3]=$,U=this.addFeatureSection(ot.featureInfo.featureIndex,U,this.bridgeFeatureSections,e);const rt=e.addVertex(Ee[0],le,f),mt=e.addVertex(Ee[1],le,f),Ke=e.addVertex(Ve[0],ne,f),Lt=e.addVertex(Ve[1],ne,f);e.addTriangle(rt,mt,Ke),e.addTriangle(mt,Lt,Ke);const Nt=e.addVertex(Ee[1],de,f),zt=e.addVertex(Ee[2],de,f),Et=e.addVertex(Ve[1],_e,f),ui=e.addVertex(Ve[2],_e,f);e.addTriangle(Nt,zt,Et),e.addTriangle(zt,ui,Et),Lr(le,le),Lr(ne,ne);const Ct=e.addVertex(Ee[2],le,f),Yt=e.addVertex(Ee[3],le,f),pi=e.addVertex(Ve[2],ne,f),Ii=e.addVertex(Ve[3],ne,f);e.addTriangle(Ct,Yt,pi),e.addTriangle(Yt,Ii,pi);const tn=this.isTerminalVertex(ot.a,m),vi=this.isTerminalVertex(ot.b,m);Ye.height<.01&&tn&&e.addQuad(Ee[3],Ee[2],Ee[1],Ee[0],Lr(Fe,Fe),f),at.height<.01&&vi&&e.addQuad(Ve[0],Ve[1],Ve[2],Ve[3],Le,f)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,a,l,h,f){e.clearVertexLookup();let m=Number.POSITIVE_INFINITY;const v=(U,q)=>U.featureInfo.featureIndex-q.featureInfo.featureIndex;this.sortSubarray(l,h.min,h.max,v),this.sortSubarray(l,f.min,f.max,v);const x=U=>Li(U,U),S=[{coord:new nt(0,0),height:0},{coord:new nt(0,0),height:0}],E=(U,q)=>U<q,A=Yi(),R=Yi(),D=Yi(),F=Yi(),k=Yi();for(let U=h.min;U<h.max;U++){if(!this.prepareEdgePoints(S,i,a,l[U],E))continue;const[q,$]=S,Y=x(jt(k,-($.coord.y-q.coord.y),$.coord.x-q.coord.x,0));m=this.addFeatureSection(l[U].featureInfo.featureIndex,m,this.tunnelFeatureSections,e),e.addQuad(jt(A,q.coord.x,q.coord.y,q.height),jt(R,$.coord.x,$.coord.y,$.height),jt(D,$.coord.x,$.coord.y,l[U].isTunnel?-.1:0),jt(F,q.coord.x,q.coord.y,l[U].isTunnel?-.1:0),Y)}for(let U=f.min;U<f.max;U++){const q=l[U];q.isTunnel&&([q.a,q.b]=[q.b,q.a]);const $=i[q.a],Y=i[q.b],le=x(jt(k,-(Y.y-$.y),Y.x-$.x,0));m=this.addFeatureSection(q.featureInfo.featureIndex,m,this.tunnelFeatureSections,e),e.addQuad(jt(A,Y.x,Y.y,0),jt(R,$.x,$.y,0),jt(D,$.x,$.y,a[q.a]+4),jt(F,Y.x,Y.y,a[q.b]+4),le),e.addQuad(jt(A,$.x,$.y,0),jt(R,Y.x,Y.y,0),jt(D,Y.x,Y.y,a[q.b]+4),jt(F,$.x,$.y,a[q.a]+4),le)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,a,l){e.coord.x=i,e.coord.y=a,e.height=l}prepareEdgePoints(e,i,a,l,h){let f=i[l.a].x,m=i[l.a].y,v=i[l.b].x,x=i[l.b].y,S=a[l.a],E=a[l.b];const A=h(S,0),R=h(E,0);if(A&&R)return this.setElevatedPoint(e[0],f,m,S),this.setElevatedPoint(e[1],v,x,E),!0;if(!A&&!R)return!1;if(A){if(!R){const D=E/(E-S);v=ti(v,f,D),x=ti(x,m,D),E=ti(E,S,D)}}else{const D=S/(S-E);f=ti(f,v,D),m=ti(m,x,D),S=ti(S,E,D)}return this.setElevatedPoint(e[0],f,m,S),this.setElevatedPoint(e[1],v,x,E),!0}prepareEdges(e,i){if(i.length===0)return;i.sort(((m,v)=>m.hash===v.hash?v.polygonIdx-m.polygonIdx:v.hash>m.hash?1:-1));let a=0,l=0,h=0,f=i[a].polygonIdx;do l++,(l===i.length||i[a].hash!==i[l].hash)&&((l-a==1||i[l-1].polygonIdx!==f)&&(h<a&&(i[h]=i[a],i[a]=null),i[h].type="none",h++),a=l,a!==i.length&&(f=i[a].polygonIdx));while(a!==i.length);if(i.splice(h),i.length!==0&&e.length!==0){i.sort(((x,S)=>x.portalHash<S.portalHash?1:-1));let m=0,v=0;for(;m!==i.length&&v!==e.length;){const x=i[m],S=e[v];x.portalHash>S.hash?m++:S.hash>x.portalHash?v++:(x.type=S.type,m++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=pt&&i>=pt}addFeatureSection(e,i,a,l){return e!==i&&(i=e,a.push({featureIndex:e,vertexStart:l.getVertexCount()}),l.clearVertexLookup()),i}sortSubarray(e,i,a,l){const h=e.slice(i,a);h.sort(l),e.splice(i,h.length,...h)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(io.computePosHash(e))<<32n|BigInt(io.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var am,om={exports:{}},sm=(am||(am=1,(function(n,e){(function(i){function a(re,ee){return re>ee?1:re<ee?-1:0}var l=function(re,ee){re===void 0&&(re=a),ee===void 0&&(ee=!1),this._compare=re,this._root=null,this._size=0,this._noDuplicates=!!ee},h={size:{configurable:!0}};function f(re,ee,He,bt,qe){var At=qe-bt;if(At>0){var Zt=bt+Math.floor(At/2),Ht={key:ee[Zt],data:He[Zt],parent:re};return Ht.left=f(Ht,ee,He,bt,Zt),Ht.right=f(Ht,ee,He,Zt+1,qe),Ht}return null}function m(re,ee,He,bt,qe){if(!(He>=bt)){for(var At=re[He+bt>>1],Zt=He-1,Ht=bt+1;;){do Zt++;while(qe(re[Zt],At)<0);do Ht--;while(qe(re[Ht],At)>0);if(Zt>=Ht)break;var bi=re[Zt];re[Zt]=re[Ht],re[Ht]=bi,bi=ee[Zt],ee[Zt]=ee[Ht],ee[Ht]=bi}m(re,ee,He,Ht,qe),m(re,ee,Ht+1,bt,qe)}}l.prototype.rotateLeft=function(re){var ee=re.right;ee&&(re.right=ee.left,ee.left&&(ee.left.parent=re),ee.parent=re.parent),re.parent?re===re.parent.left?re.parent.left=ee:re.parent.right=ee:this._root=ee,ee&&(ee.left=re),re.parent=ee},l.prototype.rotateRight=function(re){var ee=re.left;ee&&(re.left=ee.right,ee.right&&(ee.right.parent=re),ee.parent=re.parent),re.parent?re===re.parent.left?re.parent.left=ee:re.parent.right=ee:this._root=ee,ee&&(ee.right=re),re.parent=ee},l.prototype._splay=function(re){for(;re.parent;){var ee=re.parent;ee.parent?ee.left===re&&ee.parent.left===ee?(this.rotateRight(ee.parent),this.rotateRight(ee)):ee.right===re&&ee.parent.right===ee?(this.rotateLeft(ee.parent),this.rotateLeft(ee)):ee.left===re&&ee.parent.right===ee?(this.rotateRight(ee),this.rotateLeft(ee)):(this.rotateLeft(ee),this.rotateRight(ee)):ee.left===re?this.rotateRight(ee):this.rotateLeft(ee)}},l.prototype.splay=function(re){for(var ee,He,bt,qe,At;re.parent;)(He=(ee=re.parent).parent)&&He.parent?((bt=He.parent).left===He?bt.left=re:bt.right=re,re.parent=bt):(re.parent=null,this._root=re),qe=re.left,At=re.right,re===ee.left?(He&&(He.left===ee?(ee.right?(He.left=ee.right,He.left.parent=He):He.left=null,ee.right=He,He.parent=ee):(qe?(He.right=qe,qe.parent=He):He.right=null,re.left=He,He.parent=re)),At?(ee.left=At,At.parent=ee):ee.left=null,re.right=ee,ee.parent=re):(He&&(He.right===ee?(ee.left?(He.right=ee.left,He.right.parent=He):He.right=null,ee.left=He,He.parent=ee):(At?(He.left=At,At.parent=He):He.left=null,re.right=He,He.parent=re)),qe?(ee.right=qe,qe.parent=ee):ee.right=null,re.left=ee,ee.parent=re)},l.prototype.replace=function(re,ee){re.parent?re===re.parent.left?re.parent.left=ee:re.parent.right=ee:this._root=ee,ee&&(ee.parent=re.parent)},l.prototype.minNode=function(re){if(re===void 0&&(re=this._root),re)for(;re.left;)re=re.left;return re},l.prototype.maxNode=function(re){if(re===void 0&&(re=this._root),re)for(;re.right;)re=re.right;return re},l.prototype.insert=function(re,ee){var He=this._root,bt=null,qe=this._compare;if(this._noDuplicates)for(;He;){if(bt=He,qe(He.key,re)===0)return;He=qe(He.key,re)<0?He.right:He.left}else for(;He;)bt=He,He=qe(He.key,re)<0?He.right:He.left;return He={key:re,data:ee,left:null,right:null,parent:bt},bt?qe(bt.key,He.key)<0?bt.right=He:bt.left=He:this._root=He,this.splay(He),this._size++,He},l.prototype.find=function(re){for(var ee=this._root,He=this._compare;ee;){var bt=He(ee.key,re);if(bt<0)ee=ee.right;else{if(!(bt>0))return ee;ee=ee.left}}return null},l.prototype.contains=function(re){for(var ee=this._root,He=this._compare;ee;){var bt=He(re,ee.key);if(bt===0)return!0;ee=bt<0?ee.left:ee.right}return!1},l.prototype.remove=function(re){var ee=this.find(re);if(!ee)return!1;if(this.splay(ee),ee.left)if(ee.right){var He=this.minNode(ee.right);He.parent!==ee&&(this.replace(He,He.right),He.right=ee.right,He.right.parent=He),this.replace(ee,He),He.left=ee.left,He.left.parent=He}else this.replace(ee,ee.left);else this.replace(ee,ee.right);return this._size--,!0},l.prototype.removeNode=function(re){if(!re)return!1;if(this.splay(re),re.left)if(re.right){var ee=this.minNode(re.right);ee.parent!==re&&(this.replace(ee,ee.right),ee.right=re.right,ee.right.parent=ee),this.replace(re,ee),ee.left=re.left,ee.left.parent=ee}else this.replace(re,re.left);else this.replace(re,re.right);return this._size--,!0},l.prototype.erase=function(re){var ee=this.find(re);if(ee){this.splay(ee);var He=ee.left,bt=ee.right,qe=null;He&&(He.parent=null,qe=this.maxNode(He),this.splay(qe),this._root=qe),bt&&(He?qe.right=bt:this._root=bt,bt.parent=qe),this._size--}},l.prototype.pop=function(){var re=this._root,ee=null;if(re){for(;re.left;)re=re.left;ee={key:re.key,data:re.data},this.remove(re.key)}return ee},l.prototype.next=function(re){var ee=re;if(ee)if(ee.right)for(ee=ee.right;ee&&ee.left;)ee=ee.left;else for(ee=re.parent;ee&&ee.right===re;)re=ee,ee=ee.parent;return ee},l.prototype.prev=function(re){var ee=re;if(ee)if(ee.left)for(ee=ee.left;ee&&ee.right;)ee=ee.right;else for(ee=re.parent;ee&&ee.left===re;)re=ee,ee=ee.parent;return ee},l.prototype.forEach=function(re){for(var ee=this._root,He=[],bt=!1,qe=0;!bt;)ee?(He.push(ee),ee=ee.left):He.length>0?(re(ee=He.pop(),qe++),ee=ee.right):bt=!0;return this},l.prototype.range=function(re,ee,He,bt){for(var qe=[],At=this._compare,Zt=this._root;qe.length!==0||Zt;)if(Zt)qe.push(Zt),Zt=Zt.left;else{if(At((Zt=qe.pop()).key,ee)>0)break;if(At(Zt.key,re)>=0&&He.call(bt,Zt))return this;Zt=Zt.right}return this},l.prototype.keys=function(){for(var re=this._root,ee=[],He=[],bt=!1;!bt;)re?(ee.push(re),re=re.left):ee.length>0?(re=ee.pop(),He.push(re.key),re=re.right):bt=!0;return He},l.prototype.values=function(){for(var re=this._root,ee=[],He=[],bt=!1;!bt;)re?(ee.push(re),re=re.left):ee.length>0?(re=ee.pop(),He.push(re.data),re=re.right):bt=!0;return He},l.prototype.at=function(re){for(var ee=this._root,He=[],bt=!1,qe=0;!bt;)if(ee)He.push(ee),ee=ee.left;else if(He.length>0){if(ee=He.pop(),qe===re)return ee;qe++,ee=ee.right}else bt=!0;return null},l.prototype.load=function(re,ee,He){if(re===void 0&&(re=[]),ee===void 0&&(ee=[]),He===void 0&&(He=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var bt=re.length;return He&&m(re,ee,0,bt-1,this._compare),this._root=f(null,re,ee,0,bt),this._size=bt,this},l.prototype.min=function(){var re=this.minNode(this._root);return re?re.key:null},l.prototype.max=function(){var re=this.maxNode(this._root);return re?re.key:null},l.prototype.isEmpty=function(){return this._root===null},h.size.get=function(){return this._size},l.createTree=function(re,ee,He,bt,qe){return new l(He,qe).load(re,ee,bt)},Object.defineProperties(l.prototype,h);var v=0,x=1,S=2,E=3,A=0,R=1,D=2,F=3;function k(re,ee,He){ee===null?(re.inOut=!1,re.otherInOut=!0):(re.isSubject===ee.isSubject?(re.inOut=!ee.inOut,re.otherInOut=ee.otherInOut):(re.inOut=!ee.otherInOut,re.otherInOut=ee.isVertical()?!ee.inOut:ee.inOut),ee&&(re.prevInResult=!U(ee,He)||ee.isVertical()?ee.prevInResult:ee));var bt=U(re,He);re.resultTransition=bt?(function(qe,At){var Zt,Ht=!qe.inOut,bi=!qe.otherInOut;switch(At){case A:Zt=Ht&&bi;break;case R:Zt=Ht||bi;break;case F:Zt=Ht^bi;break;case D:Zt=qe.isSubject?Ht&&!bi:bi&&!Ht}return Zt?1:-1})(re,He):0}function U(re,ee){switch(re.type){case v:switch(ee){case A:return!re.otherInOut;case R:return re.otherInOut;case D:return re.isSubject&&re.otherInOut||!re.isSubject&&!re.otherInOut;case F:return!0}break;case S:return ee===A||ee===R;case E:return ee===D;case x:return!1}return!1}var q=function(re,ee,He,bt,qe){this.left=ee,this.point=re,this.otherEvent=He,this.isSubject=bt,this.type=qe||v,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},$={inResult:{configurable:!0}};function Y(re,ee){return re[0]===ee[0]&&re[1]===ee[1]}q.prototype.isBelow=function(re){var ee=this.point,He=this.otherEvent.point;return this.left?(ee[0]-re[0])*(He[1]-re[1])-(He[0]-re[0])*(ee[1]-re[1])>0:(He[0]-re[0])*(ee[1]-re[1])-(ee[0]-re[0])*(He[1]-re[1])>0},q.prototype.isAbove=function(re){return!this.isBelow(re)},q.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},$.inResult.get=function(){return this.resultTransition!==0},q.prototype.clone=function(){var re=new q(this.point,this.left,this.otherEvent,this.isSubject,this.type);return re.contourId=this.contourId,re.resultTransition=this.resultTransition,re.prevInResult=this.prevInResult,re.isExteriorRing=this.isExteriorRing,re.inOut=this.inOut,re.otherInOut=this.otherInOut,re},Object.defineProperties(q.prototype,$);var le=11102230246251565e-32,ne=134217729,de=(3+8*le)*le;function _e(re,ee,He,bt,qe){var At,Zt,Ht,bi,ni=ee[0],Vt=bt[0],sn=0,In=0;Vt>ni==Vt>-ni?(At=ni,ni=ee[++sn]):(At=Vt,Vt=bt[++In]);var ai=0;if(sn<re&&In<He)for(Vt>ni==Vt>-ni?(Ht=At-((Zt=ni+At)-ni),ni=ee[++sn]):(Ht=At-((Zt=Vt+At)-Vt),Vt=bt[++In]),At=Zt,Ht!==0&&(qe[ai++]=Ht);sn<re&&In<He;)Vt>ni==Vt>-ni?(Ht=At-((Zt=At+ni)-(bi=Zt-At))+(ni-bi),ni=ee[++sn]):(Ht=At-((Zt=At+Vt)-(bi=Zt-At))+(Vt-bi),Vt=bt[++In]),At=Zt,Ht!==0&&(qe[ai++]=Ht);for(;sn<re;)Ht=At-((Zt=At+ni)-(bi=Zt-At))+(ni-bi),ni=ee[++sn],At=Zt,Ht!==0&&(qe[ai++]=Ht);for(;In<He;)Ht=At-((Zt=At+Vt)-(bi=Zt-At))+(Vt-bi),Vt=bt[++In],At=Zt,Ht!==0&&(qe[ai++]=Ht);return At===0&&ai!==0||(qe[ai++]=At),ai}function ye(re){return new Float64Array(re)}var Be=33306690738754716e-32,Ee=22204460492503146e-32,Ve=11093356479670487e-47,Xe=ye(4),tt=ye(8),gt=ye(12),ot=ye(16),Ye=ye(4);function at(re,ee,He){var bt=(function(qe,At,Zt,Ht,bi,ni){var Vt=(At-ni)*(Zt-bi),sn=(qe-bi)*(Ht-ni),In=Vt-sn;if(Vt===0||sn===0||Vt>0!=sn>0)return In;var ai=Math.abs(Vt+sn);return Math.abs(In)>=Be*ai?In:-(function(Wi,Cn,bn,xr,tr,Nn,Sn){var hn,wi,dn,Un,ri,nn,ir,Cr,Dr,Qr,nr,qr,is,Zr,bs,Za,Pl,ns,ws=Wi-tr,Xa=bn-tr,Ts=Cn-Nn,Ll=xr-Nn;Xe[0]=(bs=(Cr=ws-(ir=(nn=ne*ws)-(nn-ws)))*(Qr=Ll-(Dr=(nn=ne*Ll)-(nn-Ll)))-((Zr=ws*Ll)-ir*Dr-Cr*Dr-ir*Qr))-((nr=bs-(Pl=(Cr=Ts-(ir=(nn=ne*Ts)-(nn-Ts)))*(Qr=Xa-(Dr=(nn=ne*Xa)-(nn-Xa)))-((Za=Ts*Xa)-ir*Dr-Cr*Dr-ir*Qr)))+(ri=bs-nr))+(ri-Pl),Xe[1]=(is=Zr-((qr=Zr+nr)-(ri=qr-Zr))+(nr-ri))-((nr=is-Za)+(ri=is-nr))+(ri-Za),Xe[2]=qr-((ns=qr+nr)-(ri=ns-qr))+(nr-ri),Xe[3]=ns;var za=(function(Lf,mh){for(var a_=mh[0],Np=1;Np<4;Np++)a_+=mh[Np];return a_})(0,Xe),bo=Ee*Sn;if(za>=bo||-za>=bo||(hn=Wi-(ws+(ri=Wi-ws))+(ri-tr),dn=bn-(Xa+(ri=bn-Xa))+(ri-tr),wi=Cn-(Ts+(ri=Cn-Ts))+(ri-Nn),Un=xr-(Ll+(ri=xr-Ll))+(ri-Nn),hn===0&&wi===0&&dn===0&&Un===0)||(bo=Ve*Sn+de*Math.abs(za),(za+=ws*Un+Ll*hn-(Ts*dn+Xa*wi))>=bo||-za>=bo))return za;Ye[0]=(bs=(Cr=hn-(ir=(nn=ne*hn)-(nn-hn)))*(Qr=Ll-(Dr=(nn=ne*Ll)-(nn-Ll)))-((Zr=hn*Ll)-ir*Dr-Cr*Dr-ir*Qr))-((nr=bs-(Pl=(Cr=wi-(ir=(nn=ne*wi)-(nn-wi)))*(Qr=Xa-(Dr=(nn=ne*Xa)-(nn-Xa)))-((Za=wi*Xa)-ir*Dr-Cr*Dr-ir*Qr)))+(ri=bs-nr))+(ri-Pl),Ye[1]=(is=Zr-((qr=Zr+nr)-(ri=qr-Zr))+(nr-ri))-((nr=is-Za)+(ri=is-nr))+(ri-Za),Ye[2]=qr-((ns=qr+nr)-(ri=ns-qr))+(nr-ri),Ye[3]=ns;var ph=_e(4,Xe,4,Ye,tt);Ye[0]=(bs=(Cr=ws-(ir=(nn=ne*ws)-(nn-ws)))*(Qr=Un-(Dr=(nn=ne*Un)-(nn-Un)))-((Zr=ws*Un)-ir*Dr-Cr*Dr-ir*Qr))-((nr=bs-(Pl=(Cr=Ts-(ir=(nn=ne*Ts)-(nn-Ts)))*(Qr=dn-(Dr=(nn=ne*dn)-(nn-dn)))-((Za=Ts*dn)-ir*Dr-Cr*Dr-ir*Qr)))+(ri=bs-nr))+(ri-Pl),Ye[1]=(is=Zr-((qr=Zr+nr)-(ri=qr-Zr))+(nr-ri))-((nr=is-Za)+(ri=is-nr))+(ri-Za),Ye[2]=qr-((ns=qr+nr)-(ri=ns-qr))+(nr-ri),Ye[3]=ns;var Pf=_e(ph,tt,4,Ye,gt);Ye[0]=(bs=(Cr=hn-(ir=(nn=ne*hn)-(nn-hn)))*(Qr=Un-(Dr=(nn=ne*Un)-(nn-Un)))-((Zr=hn*Un)-ir*Dr-Cr*Dr-ir*Qr))-((nr=bs-(Pl=(Cr=wi-(ir=(nn=ne*wi)-(nn-wi)))*(Qr=dn-(Dr=(nn=ne*dn)-(nn-dn)))-((Za=wi*dn)-ir*Dr-Cr*Dr-ir*Qr)))+(ri=bs-nr))+(ri-Pl),Ye[1]=(is=Zr-((qr=Zr+nr)-(ri=qr-Zr))+(nr-ri))-((nr=is-Za)+(ri=is-nr))+(ri-Za),Ye[2]=qr-((ns=qr+nr)-(ri=ns-qr))+(nr-ri),Ye[3]=ns;var kp=_e(Pf,gt,4,Ye,ot);return ot[kp-1]})(qe,At,Zt,Ht,bi,ni,ai)})(re[0],re[1],ee[0],ee[1],He[0],He[1]);return bt>0?-1:bt<0?1:0}function Fe(re,ee){var He=re.point,bt=ee.point;return He[0]>bt[0]?1:He[0]<bt[0]?-1:He[1]!==bt[1]?He[1]>bt[1]?1:-1:(function(qe,At,Zt,Ht){return qe.left!==At.left?qe.left?1:-1:at(Zt,qe.otherEvent.point,At.otherEvent.point)!==0?qe.isBelow(At.otherEvent.point)?-1:1:!qe.isSubject&&At.isSubject?1:-1})(re,ee,He)}function Le(re,ee,He){var bt=new q(ee,!1,re,re.isSubject),qe=new q(ee,!0,re.otherEvent,re.isSubject);return Y(re.point,re.otherEvent.point)&&console.warn("what is that, a collapsed segment?",re),bt.contourId=qe.contourId=re.contourId,Fe(qe,re.otherEvent)>0&&(re.otherEvent.left=!0,qe.left=!1),re.otherEvent.otherEvent=qe,re.otherEvent=bt,He.push(qe),He.push(bt),He}function rt(re,ee){return re[0]*ee[1]-re[1]*ee[0]}function mt(re,ee){return re[0]*ee[0]+re[1]*ee[1]}function Ke(re,ee,He){var bt=(function(bi,ni,Vt,sn,In){var ai=[ni[0]-bi[0],ni[1]-bi[1]],Wi=[sn[0]-Vt[0],sn[1]-Vt[1]];function Cn(nn,ir,Cr){return[nn[0]+ir*Cr[0],nn[1]+ir*Cr[1]]}var bn=[Vt[0]-bi[0],Vt[1]-bi[1]],xr=rt(ai,Wi),tr=xr*xr,Nn=mt(ai,ai);if(tr>0){var Sn=rt(bn,Wi)/xr;if(Sn<0||Sn>1)return null;var hn=rt(bn,ai)/xr;return hn<0||hn>1?null:Sn===0||Sn===1?[Cn(bi,Sn,ai)]:hn===0||hn===1?[Cn(Vt,hn,Wi)]:[Cn(bi,Sn,ai)]}if((tr=(xr=rt(bn,ai))*xr)>0)return null;var wi=mt(ai,bn)/Nn,dn=wi+mt(ai,Wi)/Nn,Un=Math.min(wi,dn),ri=Math.max(wi,dn);return Un<=1&&ri>=0?Un===1?[Cn(bi,Un>0?Un:0,ai)]:ri===0?[Cn(bi,ri<1?ri:1,ai)]:[Cn(bi,Un>0?Un:0,ai),Cn(bi,ri<1?ri:1,ai)]:null})(re.point,re.otherEvent.point,ee.point,ee.otherEvent.point),qe=bt?bt.length:0;if(qe===0||qe===1&&(Y(re.point,ee.point)||Y(re.otherEvent.point,ee.otherEvent.point))||qe===2&&re.isSubject===ee.isSubject)return 0;if(qe===1)return Y(re.point,bt[0])||Y(re.otherEvent.point,bt[0])||Le(re,bt[0],He),Y(ee.point,bt[0])||Y(ee.otherEvent.point,bt[0])||Le(ee,bt[0],He),1;var At=[],Zt=!1,Ht=!1;return Y(re.point,ee.point)?Zt=!0:Fe(re,ee)===1?At.push(ee,re):At.push(re,ee),Y(re.otherEvent.point,ee.otherEvent.point)?Ht=!0:Fe(re.otherEvent,ee.otherEvent)===1?At.push(ee.otherEvent,re.otherEvent):At.push(re.otherEvent,ee.otherEvent),Zt&&Ht||Zt?(ee.type=x,re.type=ee.inOut===re.inOut?S:E,Zt&&!Ht&&Le(At[1].otherEvent,At[0].point,He),2):Ht?(Le(At[0],At[1].point,He),3):At[0]!==At[3].otherEvent?(Le(At[0],At[1].point,He),Le(At[1],At[2].point,He),3):(Le(At[0],At[1].point,He),Le(At[3].otherEvent,At[2].point,He),3)}function Lt(re,ee){if(re===ee)return 0;if(at(re.point,re.otherEvent.point,ee.point)!==0||at(re.point,re.otherEvent.point,ee.otherEvent.point)!==0)return Y(re.point,ee.point)?re.isBelow(ee.otherEvent.point)?-1:1:re.point[0]===ee.point[0]?re.point[1]<ee.point[1]?-1:1:Fe(re,ee)===1?ee.isAbove(re.point)?-1:1:re.isBelow(ee.point)?-1:1;if(re.isSubject!==ee.isSubject)return re.isSubject?-1:1;var He=re.point,bt=ee.point;return He[0]===bt[0]&&He[1]===bt[1]?(He=re.otherEvent.point)[0]===(bt=ee.otherEvent.point)[0]&&He[1]===bt[1]?0:re.contourId>ee.contourId?1:-1:Fe(re,ee)===1?1:-1}var Nt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function zt(re,ee,He,bt){var qe,At=re+1,Zt=ee[re].point,Ht=ee.length;for(At<Ht&&(qe=ee[At].point);At<Ht&&qe[0]===Zt[0]&&qe[1]===Zt[1];){if(!He[At])return At;++At<Ht&&(qe=ee[At].point)}for(At=re-1;He[At]&&At>bt;)At--;return At}Nt.prototype.isExterior=function(){return this.holeOf==null};var Et=Ct,ui=Ct;function Ct(re,ee){if(!(this instanceof Ct))return new Ct(re,ee);if(this.data=re||[],this.length=this.data.length,this.compare=ee||Yt,this.length>0)for(var He=(this.length>>1)-1;He>=0;He--)this._down(He)}function Yt(re,ee){return re<ee?-1:re>ee?1:0}Ct.prototype={push:function(re){this.data.push(re),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var re=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),re}},peek:function(){return this.data[0]},_up:function(re){for(var ee=this.data,He=this.compare,bt=ee[re];re>0;){var qe=re-1>>1,At=ee[qe];if(He(bt,At)>=0)break;ee[re]=At,re=qe}ee[re]=bt},_down:function(re){for(var ee=this.data,He=this.compare,bt=this.length>>1,qe=ee[re];re<bt;){var At=1+(re<<1),Zt=At+1,Ht=ee[At];if(Zt<this.length&&He(ee[Zt],Ht)<0&&(At=Zt,Ht=ee[Zt]),He(Ht,qe)>=0)break;ee[re]=Ht,re=At}ee[re]=qe}},Et.default=ui;var pi=Math.max,Ii=Math.min,tn=0;function vi(re,ee,He,bt,qe,At){var Zt,Ht,bi,ni,Vt,sn;for(Zt=0,Ht=re.length-1;Zt<Ht;Zt++)if(ni=re[Zt+1],Vt=new q(bi=re[Zt],!1,void 0,ee),sn=new q(ni,!1,Vt,ee),Vt.otherEvent=sn,bi[0]!==ni[0]||bi[1]!==ni[1]){Vt.contourId=sn.contourId=He,At||(Vt.isExteriorRing=!1,sn.isExteriorRing=!1),Fe(Vt,sn)>0?sn.left=!0:Vt.left=!0;var In=bi[0],ai=bi[1];qe[0]=Ii(qe[0],In),qe[1]=Ii(qe[1],ai),qe[2]=pi(qe[2],In),qe[3]=pi(qe[3],ai),bt.push(Vt),bt.push(sn)}}var cn=[];function un(re,ee,He){typeof re[0][0][0]=="number"&&(re=[re]),typeof ee[0][0][0]=="number"&&(ee=[ee]);var bt=(function(ai,Wi,Cn){var bn=null;return ai.length*Wi.length==0&&(Cn===A?bn=cn:Cn===D?bn=ai:Cn!==R&&Cn!==F||(bn=ai.length===0?Wi:ai)),bn})(re,ee,He);if(bt)return bt===cn?null:bt;var qe=[1/0,1/0,-1/0,-1/0],At=[1/0,1/0,-1/0,-1/0],Zt=(function(ai,Wi,Cn,bn,xr){var tr,Nn,Sn,hn,wi,dn,Un=new Et(null,Fe);for(Sn=0,hn=ai.length;Sn<hn;Sn++)for(wi=0,dn=(tr=ai[Sn]).length;wi<dn;wi++)(Nn=wi===0)&&tn++,vi(tr[wi],!0,tn,Un,Cn,Nn);for(Sn=0,hn=Wi.length;Sn<hn;Sn++)for(wi=0,dn=(tr=Wi[Sn]).length;wi<dn;wi++)Nn=wi===0,xr===D&&(Nn=!1),Nn&&tn++,vi(tr[wi],!1,tn,Un,bn,Nn);return Un})(re,ee,qe,At,He);if(bt=(function(ai,Wi,Cn,bn,xr){var tr=null;return(Cn[0]>bn[2]||bn[0]>Cn[2]||Cn[1]>bn[3]||bn[1]>Cn[3])&&(xr===A?tr=cn:xr===D?tr=ai:xr!==R&&xr!==F||(tr=ai.concat(Wi))),tr})(re,ee,qe,At,He))return bt===cn?null:bt;for(var Ht=(function(ai){var Wi,Cn,bn=(function(Sn){var hn,wi,dn,Un,ri=[];for(wi=0,dn=Sn.length;wi<dn;wi++)((hn=Sn[wi]).left&&hn.inResult||!hn.left&&hn.otherEvent.inResult)&&ri.push(hn);for(var nn=!1;!nn;)for(nn=!0,wi=0,dn=ri.length;wi<dn;wi++)wi+1<dn&&Fe(ri[wi],ri[wi+1])===1&&(Un=ri[wi],ri[wi]=ri[wi+1],ri[wi+1]=Un,nn=!1);for(wi=0,dn=ri.length;wi<dn;wi++)(hn=ri[wi]).otherPos=wi;for(wi=0,dn=ri.length;wi<dn;wi++)(hn=ri[wi]).left||(Un=hn.otherPos,hn.otherPos=hn.otherEvent.otherPos,hn.otherEvent.otherPos=Un);return ri})(ai),xr={},tr=[],Nn=function(){if(!xr[Wi]){var Sn=tr.length,hn=(function(ri,nn,ir){var Cr=new Nt;if(ri.prevInResult!=null){var Dr=ri.prevInResult,Qr=Dr.outputContourId;if(Dr.resultTransition>0){var nr=nn[Qr];if(nr.holeOf!=null){var qr=nr.holeOf;nn[qr].holeIds.push(ir),Cr.holeOf=qr,Cr.depth=nn[Qr].depth}else nn[Qr].holeIds.push(ir),Cr.holeOf=Qr,Cr.depth=nn[Qr].depth+1}else Cr.holeOf=null,Cr.depth=nn[Qr].depth}else Cr.holeOf=null,Cr.depth=0;return Cr})(bn[Wi],tr,Sn),wi=function(ri){xr[ri]=!0,ri<bn.length&&bn[ri]&&(bn[ri].outputContourId=Sn)},dn=Wi,Un=Wi;for(hn.points.push(bn[Wi].point);wi(dn),wi(dn=bn[dn].otherPos),hn.points.push(bn[dn].point),!((dn=zt(dn,bn,xr,Un))==Un||dn>=bn.length)&&bn[dn];);tr.push(hn)}};for(Wi=0,Cn=bn.length;Wi<Cn;Wi++)Nn();return tr})((function(ai,Wi,Cn,bn,xr,tr){for(var Nn,Sn,hn,wi=new l(Lt),dn=[],Un=Math.min(bn[2],xr[2]);ai.length!==0;){var ri=ai.pop();if(dn.push(ri),tr===A&&ri.point[0]>Un||tr===D&&ri.point[0]>bn[2])break;if(ri.left){Sn=Nn=wi.insert(ri),Nn=Nn!==(hn=wi.minNode())?wi.prev(Nn):null,Sn=wi.next(Sn);var nn=Nn?Nn.key:null;if(k(ri,nn,tr),Sn&&Ke(ri,Sn.key,ai)===2&&(k(ri,nn,tr),k(Sn.key,ri,tr)),Nn&&Ke(Nn.key,ri,ai)===2){var ir=Nn;k(nn,(ir=ir!==hn?wi.prev(ir):null)?ir.key:null,tr),k(ri,nn,tr)}}else Sn=Nn=wi.find(ri=ri.otherEvent),Nn&&Sn&&(Nn=Nn!==hn?wi.prev(Nn):null,Sn=wi.next(Sn),wi.remove(ri),Sn&&Nn&&Ke(Nn.key,Sn.key,ai))}return dn})(Zt,0,0,qe,At,He)),bi=[],ni=0;ni<Ht.length;ni++){var Vt=Ht[ni];if(Vt.isExterior()){for(var sn=[Vt.points],In=0;In<Vt.holeIds.length;In++)sn.push(Ht[Vt.holeIds[In]].points);bi.push(sn)}}return bi}var dr={UNION:R,DIFFERENCE:D,INTERSECTION:A,XOR:F};i.diff=function(re,ee){return un(re,ee,D)},i.intersection=function(re,ee){return un(re,ee,A)},i.operations=dr,i.union=function(re,ee){return un(re,ee,R)},i.xor=function(re,ee){return un(re,ee,F)},Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,om.exports)),om.exports);function uh(n,e,i,a){const l=[],h=a===0?(f,m,v,x,S,E)=>{f.push(new nt(E,v+(E-m)/(x-m)*(S-v)))}:(f,m,v,x,S,E)=>{f.push(new nt(m+(E-v)/(S-v)*(x-m),E))};for(const f of n){const m=[];for(const v of f){if(v.length<=2)continue;const x=[];for(let A=0;A<v.length-1;A++){const R=v[A].x,D=v[A].y,F=v[A+1].x,k=v[A+1].y,U=a===0?R:D,q=a===0?F:k;U<e?q>e&&h(x,R,D,F,k,e):U>i?q<i&&h(x,R,D,F,k,i):x.push(v[A]),q<e&&U>=e&&h(x,R,D,F,k,e),q>i&&U<=i&&h(x,R,D,F,k,i)}let S=v[v.length-1];const E=a===0?S.x:S.y;E>=e&&E<=i&&x.push(S),x.length&&(S=x[x.length-1],x[0].x===S.x&&x[0].y===S.y||x.push(x[0]),m.push(x))}m.length&&l.push(m)}return l}function al(n,e){const i=vf(n),a=vf([e]),l=sm.intersection(i,a);return l==null?[]:fc(l)}function d0(n,e){let a=vf(n,65536);const l=[];for(;e.valid();e.next()){const[h,f]=e.get(),m=h.x*65536,v=h.y*65536,x=f.x*65536,S=f.y*65536,E=x-m,A=S-v,R=Math.hypot(E,A);if(R===0)continue;const D=Math.trunc(A/R*3),F=-Math.trunc(E/R*3);l.push([[[m,v],[x,S],[x+D,S+F],[m+D,v+F],[m,v]]])}return l.length>0&&(a=sm.diff(a,l)),fc(a,1/65536)}function vf(n,e=1){return[n.map((i=>i.map((a=>[a.x*e,a.y*e]))))]}function fc(n,e=1){return n.map((i=>i.map(((a,l)=>{const h=a.map((f=>new nt(f[0]*e,f[1]*e).round()));return l>0&&h.reverse(),h}))))}class lm{constructor(e,i){this.layoutVertexArray=new Qa,this.indexArray=new Hn,this.lineIndexArray=new Po,this.triangleSegments=new $n,this.lineSegments=new $n,this.programConfigurations=new Qo(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new tl)}update(e,i,a,l,h,f,m,v){this.programConfigurations.updatePaintArrays(e,i,h,a,l,f,m,v)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,y1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,hp.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,a,l,h,f,m){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,a,l,h,f,void 0,m)}}class cm{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new lm(e,!1),this.elevationBufferData=new lm(e,!0),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,l){}populate(e,i,a,l){this.hasPattern=mp("fill",this.layers,this.pixelRatio,i);const h=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:m,id:v,index:x,sourceLayerIndex:S}of e){const E=this.layers[0]._featureFilter.needGeometry,A=Re(m,E);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),A,a))continue;const R=h?h.evaluate(A,{},a,i.availableImages):void 0,D={id:v,properties:m.properties,type:m.type,sourceLayerIndex:S,index:x,geometry:E?A.geometry:Ge(m,a,l),patterns:{},sortKey:R};f.push(D)}h&&f.sort(((m,v)=>m.sortKey-v.sortKey));for(const m of f){const{geometry:v,index:x,sourceLayerIndex:S}=m;if(this.hasPattern){const E=w1("fill",this.layers,m,this.zoom,this.pixelRatio,i);this.patternFeatures.push(E)}else this.addFeature(m,v,x,a,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[x].feature,v,x,S,this.index)}}update(e,i,a,l,h,f,m){this.bufferData.update(e,i,a,l,h,f,m,this.worldview),this.elevationBufferData.update(e,i,a,l,h,f,m,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,a,l,h,f,m,this.worldview)}addFeatures(e,i,a,l,h,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,i,a,l,f,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,a,l,h,f=[],m,v){const x=pd(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,x,l,a,v):this.addGeometry(x,this.bufferData),this.bufferData.populatePaintArrays(e,a,h,f,l,m,this.worldview),this.elevationBufferData.populatePaintArrays(e,a,h,f,l,m,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,a,l,h){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,a,l,h,this.worldview))}addElevatedRoadFeature(e,i,a,l,h){const f=new Array,m=$t.getElevationFeature(e,h);if(!m)return void this.addGeometry(i,this.bufferData);{const x=this.clipPolygonsToTile(i,1);x.length>0&&f.push({polygons:x,elevationFeature:m,elevationTileID:a})}const v={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},a),featureIndex:l};for(const x of f)if(x.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new io(x.elevationTileID,this.layers,this.zoom,this.lut));const E=x.elevationFeature.isTunnel();let A=0;e.properties.hasOwnProperty(Rt)&&(A=+e.properties[Rt]);for(const R of x.polygons)this.elevatedStructures.addPortalCandidates(x.elevationFeature.id,R,E,x.elevationFeature,A)}x.elevationFeature.constantHeight==null&&(x.polygons=this.prepareElevatedPolygons(x.polygons,x.elevationFeature,x.elevationTileID));const S=new Ri(a,x.elevationTileID);this.addElevatedGeometry(x.polygons,S,x.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,l,v)}}addElevatedGeometry(e,i,a,l,h,f){const m={elevation:a,elevationSampler:i,bias:l,index:h,featureInfo:f},[v,x]=this.addGeometry(e,this.elevationBufferData,m);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:v,max:x}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,v),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,x))}addGeometry(e,i,a){let l=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,f=null;a&&(f=a.elevationSampler.constantElevation(a.elevation,a.bias),f!=null&&(l=f,h=f));const m=(v,x,S)=>{if(a!=null)if(x.push(v),f!=null)i.elevatedLayoutVertexArray.emplaceBack(f),S.push(f);else{const E=a.elevationSampler.pointElevation(v,a.elevation,a.bias);i.elevatedLayoutVertexArray.emplaceBack(E),S.push(E),l=Math.min(l,E),h=Math.max(h,E)}};for(const v of e){let x=0;for(const $ of v)x+=$.length;const S=i.triangleSegments.prepareSegment(x,i.layoutVertexArray,i.indexArray),E=S.vertexLength,A=[],R=[],D=[],F=[],k=[],U=i.layoutVertexArray.length;for(const $ of v){if($.length===0)continue;$!==v[0]&&R.push(A.length/2);const Y=i.lineSegments.prepareSegment($.length,i.layoutVertexArray,i.lineIndexArray),le=Y.vertexLength;a&&k.push(i.layoutVertexArray.length-U),m($[0],D,F),i.layoutVertexArray.emplaceBack($[0].x,$[0].y),i.lineIndexArray.emplaceBack(le+$.length-1,le),A.push($[0].x),A.push($[0].y);for(let ne=1;ne<$.length;ne++)m($[ne],D,F),i.layoutVertexArray.emplaceBack($[ne].x,$[ne].y),i.lineIndexArray.emplaceBack(le+ne-1,le+ne),A.push($[ne].x),A.push($[ne].y);Y.vertexLength+=$.length,Y.primitiveLength+=$.length}const q=pf(A,R);for(let $=0;$<q.length;$+=3)i.indexArray.emplaceBack(E+q[$],E+q[$+1],E+q[$+2]);if(q.length>0&&a&&this.elevationMode==="hd-road-base"){const $=a.elevation.isTunnel(),Y=a.elevation.safeArea,le=this.elevatedStructures.addVertices(D,F);this.elevatedStructures.addTriangles(q,le,$);const ne=k.length;if(ne>0){for(let de=0;de<ne-1;de++)this.elevatedStructures.addRenderableRing(a.index,k[de]+le,k[de+1]-k[de],$,Y,a.featureInfo);this.elevatedStructures.addRenderableRing(a.index,k[ne-1]+le,D.length-k[ne-1],$,Y,a.featureInfo)}}S.vertexLength+=x,S.primitiveLength+=q.length/3}return[l,h]}prepareElevatedPolygons(e,i,a){const l=1/ue(a),h=[];for(const f of e){const m=d0(f,new Mn(i,l));h.push(...m)}return h}clipPolygonsToTile(e,i){const a=-i,l=-i,h=pt+i,f=pt+i;let m=0;const v=[],x=[];for(;m<e.length;m++){const A=e[m],R=Ec(A);(R.min.x>=a&&R.max.x<=h&&R.min.y>=l&&R.max.y<=f?v:x).push(A)}if(v.length===e.length)return e;const S=[new nt(a,l),new nt(h,l),new nt(h,f),new nt(a,f),new nt(a,l)],E=v;for(const A of x)E.push(...al(A,S));return E}}let md,um,f0,p0;st(cm,"FillBucket",{omit:["layers","patternFeatures"]}),st(lm,"FillBufferData"),st(io,"ElevatedStructures");class gp{constructor(e,i,a,l){if(this.triangleCount=i.length/3,this.min=new nt(0,0),this.max=new nt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[h,f]=[e[0].clone(),e[0].clone()];for(let E=1;E<e.length;++E){const A=e[E];h.x=Math.min(h.x,A.x),h.y=Math.min(h.y,A.y),f.x=Math.max(f.x,A.x),f.y=Math.max(f.y,A.y)}if(l){const E=Math.ceil(Math.max(f.x-h.x,f.y-h.y)/l);a=Math.max(a,E)}if(a===0)return;this.min=h,this.max=f;const m=this.max.sub(this.min);m.x=Math.max(m.x,1),m.y=Math.max(m.y,1);const v=Math.max(m.x,m.y)/a;this.cellsX=Math.max(1,Math.ceil(m.x/v)),this.cellsY=Math.max(1,Math.ceil(m.y/v)),this.xScale=1/v,this.yScale=1/v;const x=[];for(let E=0;E<this.triangleCount;E++){const A=e[i[3*E+0]].sub(this.min),R=e[i[3*E+1]].sub(this.min),D=e[i[3*E+2]].sub(this.min),F=pc(Math.floor(Math.min(A.x,R.x,D.x)),this.xScale,this.cellsX),k=pc(Math.floor(Math.max(A.x,R.x,D.x)),this.xScale,this.cellsX),U=pc(Math.floor(Math.min(A.y,R.y,D.y)),this.yScale,this.cellsY),q=pc(Math.floor(Math.max(A.y,R.y,D.y)),this.yScale,this.cellsY),$=new nt(0,0),Y=new nt(0,0),le=new nt(0,0),ne=new nt(0,0);for(let de=U;de<=q;++de){$.y=Y.y=de*v,le.y=ne.y=(de+1)*v;for(let _e=F;_e<=k;++_e)$.x=le.x=_e*v,Y.x=ne.x=(_e+1)*v,(ar(A,R,D,$,Y,ne)||ar(A,R,D,$,ne,le))&&x.push({cellIdx:de*this.cellsX+_e,triIdx:E})}}if(x.length===0)return;x.sort(((E,A)=>E.cellIdx-A.cellIdx||E.triIdx-A.triIdx));let S=0;for(;S<x.length;){const E=x[S].cellIdx,A={start:this.payload.length,len:0};for(;S<x.length&&x[S].cellIdx===E;)++A.len,this.payload.push(x[S++].triIdx);this.cells[E]=A}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const a=pc(e.x-this.min.x,this.xScale,this.cellsX),l=pc(e.y-this.min.y,this.yScale,this.cellsY),h=this.cells[l*this.cellsX+a];if(h){this._lazyInitLookup();for(let f=0;f<h.len;f++){const m=this.payload[h.start+f],v=Math.floor(m/8),x=1<<m%8;if(!(this.lookup[v]&x)&&(this.lookup[v]|=x,i.push(m),i.length===this.triangleCount))return}}}query(e,i,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const l=pc(e.x-this.min.x,this.xScale,this.cellsX),h=pc(i.x-this.min.x,this.xScale,this.cellsX),f=pc(e.y-this.min.y,this.yScale,this.cellsY),m=pc(i.y-this.min.y,this.yScale,this.cellsY);for(let v=f;v<=m;v++)for(let x=l;x<=h;x++){const S=this.cells[v*this.cellsX+x];if(S)for(let E=0;E<S.len;E++){const A=this.payload[S.start+E],R=Math.floor(A/8),D=1<<A%8;if(!(this.lookup[R]&D)&&(this.lookup[R]|=D,a.push(A),a.length===this.triangleCount))return}}}}function pc(n,e,i){return Math.max(0,Math.min(i-1,Math.floor(n*e)))}st(gp,"TriangleGridIndex");class m0{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){for(const a of this.footprints)i.push({footprint:a,id:e})}updateAppearances(e,i,a,l){}populate(e,i,a,l){const h=[];for(const{feature:f,id:m,index:v,sourceLayerIndex:x}of e){const S=this.layers[0]._featureFilter.needGeometry,E=Re(f,S);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),E,a))continue;const A={id:m,properties:f.properties,type:f.type,sourceLayerIndex:x,index:v,geometry:S?E.geometry:Ge(f,a,l),patterns:{}};h.push(A)}for(const f of h){const{geometry:m,index:v,sourceLayerIndex:x}=f;this.addFeature(f,m,v,a,{},i.availableImages,i.brightness),i.featureIndex.insert(e[v].feature,m,v,x,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,a,l,h,f,m){}destroy(){}addFeature(e,i,a,l,h,f=[],m){for(const v of pd(i,2)){const x=[],S=[],E=[],A=new nt(1/0,1/0),R=new nt(-1/0,-1/0);for(const k of v)if(k.length!==0){k!==v[0]&&E.push(S.length/2);for(let U=0;U<k.length;U++)S.push(k[U].x),S.push(k[U].y),x.push(k[U]),A.x=Math.min(A.x,k[U].x),A.y=Math.min(A.y,k[U].y),R.x=Math.max(R.x,k[U].x),R.y=Math.max(R.y,k[U].y)}const D=pf(S,E),F=new gp(x,D,8,256);this.footprints.push({vertices:x,indices:D,grid:F,min:A,max:R})}}}st(m0,"ClipBucket",{omit:["layers"]});const p_=zi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),m_=zi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),_0=zi([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),xf=zi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),T1=zi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),g0=zi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),__=zi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:bf}=p_,su=Number.MAX_SAFE_INTEGER,hm=su-1;function S1(n,e,i,a){return n.order<e||n.order===su||!(n.clipMask&i)||(function(l,h){return h.length!==0&&h.find((f=>f===l))===void 0})(a,n.clipScope)}function wf(n,e){return n.x-e.x||n.y-e.y}function yp(n,e){return wf(n.min,e.min)===0&&wf(n.max,e.max)===0}function Tf(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function E1(n,e){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(n[i].sourceId!==e[i].sourceId||!yp(n[i],e[i])||n[i].order!==e[i].order||n[i].clipMask!==e[i].clipMask||!ll(n[i].clipScope,e[i].clipScope))return!1;return!0}function dm(n,e,i){const a=1/pt,l=1/(1<<i.canonical.z),h=(e.x*a+i.canonical.x)*l+i.wrap,f=(e.y*a+i.canonical.y)*l;return{min:new nt((n.x*a+i.canonical.x)*l+i.wrap,(n.y*a+i.canonical.y)*l),max:new nt(h,f)}}function g_(n,e,i){const a=1<<i.canonical.z,l=((e.x-i.wrap)*a-i.canonical.x)*pt,h=(e.y*a-i.canonical.y)*pt;return{min:new nt(((n.x-i.wrap)*a-i.canonical.x)*pt,(n.y*a-i.canonical.y)*pt),max:new nt(l,h)}}function vp(n,e,i,a,l,h,f){const m=n.indices,v=n.vertices,x=[];for(let S=a;S<a+l;S+=3){const E=e[i[S+0]+h],A=e[i[S+1]+h],R=e[i[S+2]+h],D=Math.min(E.x,A.x,R.x),F=Math.max(E.x,A.x,R.x),k=Math.min(E.y,A.y,R.y),U=Math.max(E.y,A.y,R.y);x.length=0,n.grid.query(new nt(D,k),new nt(F,U),x);for(let q=0;q<x.length;q++){const $=x[q];if(ar(v[m[3*$+0]],v[m[3*$+1]],v[m[3*$+2]],E,A,R,f))return!0}}return!1}function y0(n,e,i,a){if(!n||!i)return!1;let l=n.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(i.vertices.length<n.vertices.length)return y0(i,a,n,e);const h=e.canonical,f=a.canonical,m=Math.pow(2,f.z-h.z);l=n.vertices.map((v=>new nt((v.x+h.x*pt)*m-f.x*pt,(v.y+h.y*pt)*m-f.y*pt)))}return vp(i,l,n.indices,0,n.indices.length,0,0)}function xp(n,e,i,a){const l=Math.pow(2,a.z-i.z);return new nt((n+i.x*pt)*l-a.x*pt,(e+i.y*pt)*l-a.y*pt)}function fm(n,e){const i=[];e.grid.queryPoint(n,i);const a=e.indices,l=e.vertices;for(let h=0;h<i.length;h++){const f=i[h];if(aa([l[a[3*f+0]],l[a[3*f+1]],l[a[3*f+2]]],n))return!0}return!1}const Sf=[new nt(0,0),new nt(pt,0),new nt(pt,pt),new nt(0,pt)];function A1(n,e){const i=[];let a=[];if(!e||n.length<2)return[n];if(n.length===2)return hr(n[0],n[1],Sf)?[n]:[];for(let l=0;l<n.length+2;l++){const h=n[l%n.length],f=n[(l+1)%n.length],m=hr(l===0?n[n.length-1]:n[(l-1)%n.length],h,Sf),v=hr(h,f,Sf),x=m||v;x&&a.push(h),x&&v||a.length>0&&(a.length>1&&i.push(a),a=[])}return a.length>1&&i.push(a),i}const Ef=it.types,y_=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],M1=["fill-extrusion-flood-light-ground-radius"],v_=Math.pow(2,13),v0=Math.pow(2,15)-1,pm=new nt(0,1),lu=2147483648,mm=7,bp=450;function Af(n,e,i,a,l,h,f,m){n.emplaceBack((e<<1)+f,(i<<1)+h,(Math.floor(a*v_)<<1)+l,Math.round(m))}function Mf(n,e,i){n.emplaceBack(e.x*pt,e.y*pt,i?1:0)}function _d(n,e,i,a,l,h){n.emplaceBack(e.x,e.y,(i.x<<1)+a,(i.y<<1)+l,h)}function I1(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class x0{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class wp{constructor(){this.centroidXY=new nt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new nt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new nt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new nt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Tp{constructor(){this.acc=new nt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,a){this.accCount++,this.acc._add(i);let l=!!this.borders;i.x<e.min.x?(e.min.x=i.x,l=!0):i.x>e.max.x&&(e.max.x=i.x,l=!0),i.y<e.min.y?(e.min.y=i.y,l=!0):i.y>e.max.y&&(e.max.y=i.y,l=!0),((i.x===0||i.x===pt)&&i.x===a.x)!=((i.y===0||i.y===pt)&&i.y===a.y)&&this.processBorderOverlap(i,a),l&&this.checkBorderIntersection(i,a)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,ti(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>pt!=e.x>pt&&this.addBorderIntersection(1,ti(i.y,e.y,(pt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,ti(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>pt!=e.y>pt&&this.addBorderIntersection(3,ti(i.x,e.x,(pt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new nt(0,0):new nt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,i)=>e+ +(i[0]!==Number.MAX_VALUE)),0):0}}function C1(n,e){const i=n.add(e)._unit(),a=G(n.x*i.x+n.y*i.y,-1,1);var l,h,f;return l=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(l)))/4*v0*((h=n).x*(f=e).y-h.y*f.x<0?-1:1)}const _m=[n=>n.x<0,n=>n.x>pt,n=>n.y<0,n=>n.y>pt];function b0(n,e,i,a){const l=[4];if(a===0)return l;i._mult(a);const h=n.sub(i),f=e.sub(i),m=[n,e,h,f];for(let v=0;v<4;v++)for(const x of m)if(_m[v](x)){l.push(v);break}return l}class z1{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new rd,this.indexArray=new Hn,this.programConfigurations=new Qo(e.layers,{zoom:e.zoom,lut:e.lut},(i=>M1.includes(i))),this._segments=new $n,this.hiddenByLandmarkVertexArray=new ua,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new $n}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,a,l=!1){const h=e.length;if(h>2){let f=Math.max(0,this._segments.get().length-1);const m=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let v;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const x=e[0],S=e[1];v=C1(x.sub(e[h-1])._perp()._unit(),S.sub(x)._perp()._unit())}for(let x=0;x<h;x++){const S=x===h-1?0:x+1,E=e[x],A=e[S],R=e[S===h-1?0:S+1],D=A.sub(E)._perp()._unit(),F=C1(D,R.sub(A)._perp()._unit()),k=v,U=F;if(gd(E,A,i)||l&&uu(E,i)&&uu(A,i)){v=F;continue}const q=m.vertexLength;_d(this.vertexArray,E,A,1,1,k),_d(this.vertexArray,E,A,1,0,k),_d(this.vertexArray,E,A,0,1,U),_d(this.vertexArray,E,A,0,0,U),m.vertexLength+=4;const $=b0(E,A,D,a);for(const Y of $)this._segmentToGroundQuads[f].push({id:q,region:Y}),this._segmentToRegionTriCounts[f][Y]+=2,m.primitiveLength+=2;v=F}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let a=0;a<i;a++)this._segmentToGroundQuads[a].sort(((l,h)=>l.region-h.region));for(let a=0;a<i;a++){const l=this._segmentToGroundQuads[a],h=e[a],f=this._segmentToRegionTriCounts[a];f.reduce(((v,x)=>v+x),0);let m=0;for(let v=0;v<=4;v++){const x=f[v];if(x!==0){let S=this.regionSegments[v];S||(S=this.regionSegments[v]=new $n);const E={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+m,vertexLength:h.vertexLength,primitiveLength:x};S.get().push(E)}m+=x}for(let v=0;v<l.length;v++){const x=l[v].id;this.indexArray.emplaceBack(x,x+1,x+3),this.indexArray.emplaceBack(x,x+3,x+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,a,l,h,f,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,a,l,h,f,void 0,m)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,m_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,_0.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,a,l,h,f,m,v){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,a,l,h,f,m,v)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&lu))}updateHiddenByLandmarkRange(e,i,a){if(!this.hasData())return;const l=i+e;if(i!==0){for(let h=e;h<l;++h)this.hiddenByLandmarkVertexArray.emplace(h,a?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,g0.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Rl{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Hn,this.footprintVertices=new Qa,this.footprintSegments=[],this.layoutVertexArray=new $c,this.centroidVertexArray=new af,this.wallVertexArray=new n1,this.indexArray=new Hn,this.programConfigurations=new Qo(e.layers,{zoom:e.zoom,lut:e.lut},(i=>y_.includes(i))),this.segments=new $n,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.groundEffect=new z1(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,l){}populate(e,i,a,l){this.features=[],this.hasPattern=mp("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=ue(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:h,id:f,index:m,sourceLayerIndex:v}of e){const x=this.layers[0]._featureFilter.needGeometry,S=Re(h,x);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),S,a))continue;const E={id:f,sourceLayerIndex:v,index:m,geometry:x?S.geometry:Ge(h,a,l),properties:h.properties,type:h.type,patterns:{}},A=this.layoutVertexArray.length,R=Ef[E.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:h.id,feature:w1("fill-extrusion",this.layers,E,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const D of E.geometry)for(const F of A1(D,R))this.addFeature(h.id,E,[F],m,a,{},i.availableImages,l,i.brightness);else this.addFeature(h.id,E,E.geometry,m,a,{},i.availableImages,l,i.brightness);i.featureIndex.insert(h,E.geometry,m,v,this.index,A)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,a,l,h,f){for(const{featureId:m,feature:v}of this.features){const x=Ef[v.type]==="Polygon",{geometry:S}=v;if(this.wallMode)for(const E of S)for(const A of A1(E,x))this.addFeature(m,v,[A],v.index,i,a,l,h,f);else this.addFeature(m,v,S,v.index,i,a,l,h,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,a,l,h,f,m){this.programConfigurations.updatePaintArrays(e,i,h,a,l,f,m,this.worldview),this.groundEffect.update(e,i,h,a,l,f,m,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,T1.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,__.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,xf.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,l,h,f,m,v,x){const S=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,E=[new nt(0,0),new nt(pt,pt)],A=v.projection,R=A.name==="globe",D=this.wallMode||Ef[i.type]==="Polygon",F=new Tp;F.centroidDataIndex=this.centroidData.length;const k=new wp;k.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(k.buildingId=i.properties.building_id);const U=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},h)<=0,q=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},h);let $;if(k.height=q,k.vertexArrayOffset=this.layoutVertexArray.length,k.groundVertexArrayOffset=this.groundEffect.vertexArray.length,R&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new eh),this.wallMode){if(R)return void Gt("Non zero fill-extrusion-line-width is not yet supported on globe.");if(a.length!==1)return;$=(function(Ee){const Ve=Ee[0].x===Ee[Ee.length-1].x&&Ee[0].y===Ee[Ee.length-1].y;(function(zt){let Et=0;const ui=zt.length;for(let Ct=0;Ct<ui;Ct++)Et+=(zt[(Ct+1)%ui].x-zt[Ct].x)*(zt[(Ct+1)%ui].y+zt[Ct].y);return Et>=0})(Ee)||(Ee=Ee.reverse());const tt={geometry:[],joinNormals:[],indices:[]},gt=[],ot=[],Ye=[];let at=Ee.length;for(;at>=2&&Ee[at-1].equals(Ee[at-2]);)at--;if(at<(Ve?3:2))return tt;let Fe,Le,rt,mt,Ke,Lt=0;for(;Lt<at-1&&Ee[Lt].equals(Ee[Lt+1]);)Lt++;Ve&&(Fe=Ee[at-2],Ke=Ee[Lt].sub(Fe)._unit()._perp());for(let zt=Lt;zt<at;zt++){if(rt=zt===at-1?Ve?Ee[Lt+1]:void 0:Ee[zt+1],rt&&Ee[zt].equals(rt))continue;Ke&&(mt=Ke),Fe&&(Le=Fe),Fe=Ee[zt],Ke=rt?rt.sub(Fe)._unit()._perp():mt,mt=mt||Ke;let Et=mt.add(Ke);Et.x===0&&Et.y===0||Et._unit();const ui=Et.x*Ke.x+Et.y*Ke.y,Ct=ui!==0?1/ui:1/0,Yt=mt.x*Ke.y-mt.y*Ke.x>0;let pi="miter";const Ii=2;pi==="miter"&&Ct>Ii&&(pi="bevel"),pi==="bevel"&&(Ct>100&&(pi="flipbevel"),Ct<Ii&&(pi="miter"));const tn=(vi,cn,un,dr)=>{const re=new nt(vi.x,vi.y),ee=new nt(vi.x,vi.y);re.x+=cn.x*dr,re.y+=cn.y*dr,ee.x-=cn.x*Math.max(un,1),ee.y-=cn.y*Math.max(un,1),Ye.push(cn),gt.push(re),ot.push(ee)};if(pi==="miter")Et._mult(Ct),tn(Fe,Et,0,0);else if(pi==="flipbevel")Et=Ke.mult(-1),tn(Fe,Et,0,0),tn(Fe,Et.mult(-1),0,0);else{const vi=-Math.sqrt(Ct*Ct-1),cn=Yt?vi:0,un=Yt?0:vi;Le&&tn(Fe,mt,cn,un),rt&&tn(Fe,Ke,cn,un)}}tt.geometry=[...gt,...ot.reverse(),gt[0]],tt.joinNormals=[...Ye,...Ye.reverse(),Ye[Ye.length-1]];const Nt=tt.geometry.length-1;for(let zt=0;zt<Nt/2;zt++)if(zt+1<Nt/2){let Et=zt,ui=zt+1,Ct=Nt-1-zt,Yt=Nt-2-zt;Et=Et===0?Nt-1:Et-1,ui=ui===0?Nt-1:ui-1,Ct=Ct===0?Nt-1:Ct-1,Yt=Yt===0?Nt-1:Yt-1,tt.indices.push(Ct),tt.indices.push(ui),tt.indices.push(Et),tt.indices.push(Ct),tt.indices.push(Yt),tt.indices.push(ui)}return tt})(a[0]),a=[$.geometry]}const Y=(Ee,Ve)=>Ee<(Ve.length-1)/2||Ee===Ve.length-1,le=this.wallMode?[a]:pd(a,500);for(let Ee=le.length-1;Ee>=0;Ee--){const Ve=le[Ee];(Ve.length===0||(ne=Ve[0]).every((Xe=>Xe.x<=0))||ne.every((Xe=>Xe.x>=pt))||ne.every((Xe=>Xe.y<=0))||ne.every((Xe=>Xe.y>=pt)))&&le.splice(Ee,1)}var ne;let de;if(R)de=T0(le,E,h);else{de=[];for(const Ee of le)de.push({polygon:Ee,bounds:E})}const _e=D?this.edgeRadius:0,ye=_e>0&&this.zoom<17,Be=(Ee,Ve)=>{if(Ee.length===0)return!1;const Xe=Ee[Ee.length-1];return Ve.x===Xe.x&&Ve.y===Xe.y};for(const{polygon:Ee,bounds:Ve}of de){let Xe=0,tt=0;for(const at of Ee)D&&!at[0].equals(at[at.length-1])&&at.push(at[0]),tt+=D?at.length-1:at.length;const gt=this.segments.prepareSegment((D?5:4)*tt,this.layoutVertexArray,this.indexArray);k.footprintSegIdx<0&&(k.footprintSegIdx=this.footprintSegments.length),k.polygonSegIdx<0&&(k.polygonSegIdx=this.polygonSegments.length);const ot={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ye=new x0;if(Ye.vertexOffset=this.footprintVertices.length,Ye.indexOffset=3*this.footprintIndices.length,Ye.ringIndices=[],D){const at=[],Fe=[];Xe=gt.vertexLength;for(let rt=0;rt<Ee.length;rt++){const mt=Ee[rt];mt.length&&rt!==0&&Fe.push(at.length/2);const Ke=[];let Lt,Nt;Lt=mt[1].sub(mt[0])._perp()._unit(),Ye.ringIndices.push(mt.length-1);for(let zt=1;zt<mt.length;zt++){const Et=mt[zt],ui=mt[zt===mt.length-1?1:zt+1],Ct=Et.clone();if(_e){Nt=ui.sub(Et)._perp()._unit();const Yt=Lt.add(Nt)._unit(),pi=_e*Math.min(4,1/(Lt.x*Yt.x+Lt.y*Yt.y));Ct.x+=pi*Yt.x,Ct.y+=pi*Yt.y,Ct.x=Math.round(Ct.x),Ct.y=Math.round(Ct.y),Lt=Nt}if(!U||_e!==0&&!ye||Be(Ke,Ct)||Ke.push(Ct),Af(this.layoutVertexArray,Ct.x,Ct.y,0,0,1,1,0),this.wallMode){const Yt=Y(zt,mt);Mf(this.wallVertexArray,$.joinNormals[zt],!Yt)}gt.vertexLength++,this.footprintVertices.emplaceBack(Et.x,Et.y),at.push(Et.x,Et.y),R&&I1(this.layoutVertexExtArray,A.projectTilePoint(Ct.x,Ct.y,h),A.upVector(h,Ct.x,Ct.y))}U&&(_e===0||ye)&&(Ke.length!==0&&Be(Ke,Ke[0])&&Ke.pop(),this.groundEffect.addData(Ke,Ve,S))}const Le=this.wallMode?$.indices:pf(at,Fe);for(let rt=0;rt<Le.length;rt+=3)this.footprintIndices.emplaceBack(Ye.vertexOffset+Le[rt+0],Ye.vertexOffset+Le[rt+1],Ye.vertexOffset+Le[rt+2]),this.indexArray.emplaceBack(Xe+Le[rt],Xe+Le[rt+2],Xe+Le[rt+1]),gt.primitiveLength++;Ye.indexCount+=Le.length,Ye.vertexCount+=this.footprintVertices.length-Ye.vertexOffset}for(let at=0;at<Ee.length;at++){const Fe=Ee[at];F.startRing(k,Fe[0]);let Le=Fe.length>4&&w0(Fe[Fe.length-2],Fe[0],Fe[1]),rt=_e?hh(Fe[Fe.length-2],Fe[0],Fe[1],_e):0;const mt=[];let Ke,Lt,Nt;Lt=Fe[1].sub(Fe[0])._perp()._unit();let zt=!0;for(let Et=1,ui=0;Et<Fe.length;Et++){let Ct=Fe[Et-1],Yt=Fe[Et];const pi=Fe[Et===Fe.length-1?1:Et+1];if(F.appendEdge(k,Yt,Ct),gd(Yt,Ct,Ve)){_e&&(Lt=pi.sub(Yt)._perp()._unit(),zt=!zt);continue}const Ii=Yt.sub(Ct)._perp(),tn=Ii.x/(Math.abs(Ii.x)+Math.abs(Ii.y)),vi=Ii.y>0?1:0,cn=Ct.dist(Yt);if(ui+cn>32768&&(ui=0),_e){Nt=pi.sub(Yt)._perp()._unit();let ee=If(Ct,Yt,pi,cu(Lt,Nt),_e);isNaN(ee)&&(ee=0);const He=Yt.sub(Ct)._unit();Ct=Ct.add(He.mult(rt))._round(),Yt=Yt.add(He.mult(-ee))._round(),rt=ee,Lt=Nt,U&&this.zoom>=17&&(Be(mt,Ct)||mt.push(Ct),Be(mt,Yt)||mt.push(Yt))}const un=gt.vertexLength,dr=Fe.length>4&&w0(Ct,Yt,pi);let re=gm(ui,Le,zt);if(Af(this.layoutVertexArray,Ct.x,Ct.y,tn,vi,0,0,re),Af(this.layoutVertexArray,Ct.x,Ct.y,tn,vi,0,1,re),this.wallMode){const ee=Y(Et-1,Fe),He=$.joinNormals[Et-1];Mf(this.wallVertexArray,He,ee),Mf(this.wallVertexArray,He,ee)}if(ui+=cn,re=gm(ui,dr,!zt),Le=dr,Af(this.layoutVertexArray,Yt.x,Yt.y,tn,vi,0,0,re),Af(this.layoutVertexArray,Yt.x,Yt.y,tn,vi,0,1,re),this.wallMode){const ee=Y(Et,Fe),He=$.joinNormals[Et];Mf(this.wallVertexArray,He,ee),Mf(this.wallVertexArray,He,ee)}if(gt.vertexLength+=4,this.indexArray.emplaceBack(un+0,un+1,un+2),this.indexArray.emplaceBack(un+1,un+3,un+2),gt.primitiveLength+=2,_e){const ee=Xe+(Et===1?Fe.length-2:Et-2),He=Et===1?Xe:ee+1;if(this.indexArray.emplaceBack(un+1,ee,un+3),this.indexArray.emplaceBack(ee,He,un+3),gt.primitiveLength+=2,Ke===void 0&&(Ke=un),!gd(pi,Fe[Et],Ve)){const bt=Et===Fe.length-1?Ke:gt.vertexLength;this.indexArray.emplaceBack(un+2,un+3,bt),this.indexArray.emplaceBack(un+3,bt+1,bt),this.indexArray.emplaceBack(un+3,He,bt+1),gt.primitiveLength+=3}zt=!zt}if(R){const ee=this.layoutVertexExtArray,He=A.projectTilePoint(Ct.x,Ct.y,h),bt=A.projectTilePoint(Yt.x,Yt.y,h),qe=A.upVector(h,Ct.x,Ct.y),At=A.upVector(h,Yt.x,Yt.y);I1(ee,He,qe),I1(ee,He,qe),I1(ee,bt,At),I1(ee,bt,At)}}D&&(Xe+=Fe.length-1),U&&_e&&this.zoom>=17&&(mt.length!==0&&Be(mt,mt[0])&&mt.pop(),this.groundEffect.addData(mt,Ve,S,_e>0))}this.footprintSegments.push(Ye),ot.triangleCount=this.indexArray.length-ot.triangleArrayOffset,this.polygonSegments.push(ot),++k.footprintSegLen,++k.polygonSegLen}if(k.vertexCount=this.layoutVertexArray.length-k.vertexArrayOffset,k.groundVertexCount=this.groundEffect.vertexArray.length-k.groundVertexArrayOffset,k.vertexCount!==0){if(k.centroidXY=F.borders?pm:this.encodeCentroid(F,k),this.centroidData.push(k),F.borders){this.featuresOnBorder.push(F);const Ee=this.featuresOnBorder.length-1;for(let Ve=0;Ve<F.borders.length;Ve++)F.borders[Ve][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ve].push(Ee)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,f,m,h,x,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,l,f,m,h,x,this.worldview),this.maxHeight=Math.max(this.maxHeight,q)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((i,a)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[a].borders[e][0]))}splitToSubtiles(){const e=[];for(let m=0;m<this.centroidData.length;m++){const v=this.centroidData[m],x=+(v.min.y+v.max.y>pt),S=2*x+(+(v.min.x+v.max.x>pt)^x);for(let E=0;E<v.polygonSegLen;E++){const A=v.polygonSegIdx+E;e.push({centroidIdx:m,subtile:S,polygonSegmentIdx:A,triangleSegmentIdx:this.polygonSegments[A].triangleSegIdx})}}const i=new Hn;e.sort(((m,v)=>m.triangleSegmentIdx===v.triangleSegmentIdx?m.subtile-v.subtile:m.triangleSegmentIdx-v.triangleSegmentIdx));let a=0,l=0,h=0;for(const m of e){if(m.triangleSegmentIdx!==a)break;h++}const f=e.length;for(;l!==e.length;){a=e[l].triangleSegmentIdx;let m=0,v=l,x=l;for(let S=v;S<h&&e[S].subtile===m;S++)x++;for(;v!==h;){const S=e[v];m=S.subtile;const E=this.centroidData[S.centroidIdx].min.clone(),A=this.centroidData[S.centroidIdx].max.clone(),R={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let D=v;D<x;D++){const F=e[D],k=this.polygonSegments[F.polygonSegmentIdx],U=this.centroidData[F.centroidIdx].min,q=this.centroidData[F.centroidIdx].max,$=this.indexArray.uint16;for(let Y=k.triangleArrayOffset;Y<k.triangleArrayOffset+k.triangleCount;Y++)i.emplaceBack($[3*Y],$[3*Y+1],$[3*Y+2]);R.primitiveLength+=k.triangleCount,E.x=Math.min(E.x,U.x),E.y=Math.min(E.y,U.y),A.x=Math.max(A.x,q.x),A.y=Math.max(A.y,q.y)}R.primitiveLength>0&&this.triangleSubSegments.push({segment:R,min:E,max:A}),v=x;for(let D=v;D<h&&e[D].subtile===e[v].subtile;D++)x++}l=h;for(let S=l;S<f&&e[S].triangleSegmentIdx===e[l].triangleSegmentIdx;S++)h++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,a){const l=new $n;if(this.wallMode){for(const F of this.triangleSubSegments)l.segments.push(F.segment);return l}let h=0,f=0;const m=1<<e.canonical.z;if(i){const F=i.getMinMaxForTile(e);F&&(h=F.min,f=F.max)}f+=this.maxHeight;const v=e.toUnwrapped();let x;const S=[v.canonical.x/m+v.wrap,v.canonical.y/m],E=[(v.canonical.x+1)/m+v.wrap,(v.canonical.y+1)/m],A=(F,k,U)=>[F[0]*(1-U[0])+k[0]*U[0],F[1]*(1-U[1])+k[1]*U[1]],R=[],D=[];for(const F of this.triangleSubSegments){R[0]=F.min.x/pt,R[1]=F.min.y/pt,D[0]=F.max.x/pt,D[1]=F.max.y/pt;const k=A(S,E,R),U=A(S,E,D);if(new Si([k[0],k[1],h],[U[0],U[1],f]).intersectsPrecise(a)===0){x&&(l.segments.push(x),x=void 0);continue}const q=F.segment;x&&x.vertexOffset!==q.vertexOffset&&(l.segments.push(x),x=void 0),x?(x.vertexLength+=q.vertexLength,x.primitiveLength+=q.primitiveLength):x={vertexOffset:q.vertexOffset,primitiveLength:q.primitiveLength,vertexLength:q.vertexLength,primitiveOffset:q.primitiveOffset,sortKey:void 0,vaos:{}}}return x&&l.segments.push(x),l}encodeCentroid(e,i){const a=e.centroid(),l=i.span(),h=Math.min(7,Math.round(l.x*this.tileToMeter/10)),f=Math.min(7,Math.round(l.y*this.tileToMeter/10));return new nt(G(a.x,1,pt-1)<<3|h,G(a.y,1,pt-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new nt(0,0);const i=e.borders,a=Number.MAX_VALUE;if(i[0][0]!==a||i[1][0]!==a){const l=i[0][0]!==a?0:1;return new nt(6|(i[0][0]!==a?0:65528),(i[l][0]+i[l][1])/2<<3|6)}{const l=i[2][0]!==a?2:3;return new nt((i[l][0]+i[l][1])/2<<3|6,6|(i[2][0]!==a?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,l=e.flags&lu?pm:e.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==l.y||h!==l.x){for(let f=i;f<a;++f)this.centroidVertexArray.emplace(f,l.x,l.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped());if(E1(this.activeReplacements,l))return;if(this.activeReplacements=l,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const h=[];for(const f of this.activeReplacements){if(f.order<a)continue;const m=Math.max(1,Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z));if(f.footprint.buildingId){const v=f.footprint.buildingId;for(const x of this.centroidData)x.buildingId===v&&(x.flags|=lu)}else for(const v of this.centroidData)if(!(v.flags&lu||f.min.x>v.max.x||v.min.x>f.max.x||f.min.y>v.max.y||v.min.y>f.max.y))for(let x=0;x<v.footprintSegLen;x++){const S=this.footprintSegments[v.footprintSegIdx+x];if(h.length=0,S0(this.footprintVertices,S.vertexOffset,S.vertexCount,f.footprintTileId.canonical,e.canonical,h),vp(f.footprint,h,this.footprintIndices.uint16,S.indexOffset,S.indexCount,-S.vertexOffset,-m)){v.flags|=lu;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,a){let l=!1;for(let h=0;h<a.footprintSegLen;h++){const f=this.footprintSegments[a.footprintSegIdx+h];let m=0;for(const v of f.ringIndices){for(let x=m,S=v+m-1;x<v+m;S=x++){const E=this.footprintVertices.int16[2*(x+f.vertexOffset)+0],A=this.footprintVertices.int16[2*(x+f.vertexOffset)+1],R=this.footprintVertices.int16[2*(S+f.vertexOffset)+1];A>i!=R>i&&e<(this.footprintVertices.int16[2*(S+f.vertexOffset)+0]-E)*(i-A)/(R-A)+E&&(l=!l)}m=v}}return l}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,l=!0;const h=4*(e+pt)*pt+(i+pt);if(this.partLookup.hasOwnProperty(h)){const f=this.partLookup[h];return f?{height:f.height,hidden:!!(f.flags&lu)}:void 0}for(const f of this.centroidData)e>f.max.x||f.min.x>e||i>f.max.y||f.min.y>i||f.height<=a||this.footprintContainsPoint(e,i,f)&&(a=f.height,this.partLookup[h]=f,l=!!(f.flags&lu));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:l};this.partLookup[h]=void 0}}function cu(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function hh(n,e,i,a){const l=e.sub(n)._perp()._unit(),h=i.sub(e)._perp()._unit();return If(n,e,i,cu(l,h),a)}function If(n,e,i,a,l){const h=Math.sqrt(1-a*a);return Math.min(n.dist(e)/3,e.dist(i)/3,l*h/a)}function gd(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function uu(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function w0(n,e,i){if(n.x<0||n.x>=pt||e.x<0||e.x>=pt||i.x<0||i.x>=pt)return!1;const a=i.sub(e),l=a.perp(),h=n.sub(e);return(a.x*h.x+a.y*h.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(h.x*h.x+h.y*h.y))>-.866&&l.x*h.x+l.y*h.y<0}function gm(n,e,i){const a=e?2|n:-3&n;return i?1|a:-2&a}function Cf(){const n=Math.PI/32,e=Math.tan(n),i=M;return i*Math.sqrt(1+2*e*e)-i}function T0(n,e,i){const a=1<<i.z,l=K(i.x/a),h=K((i.x+1)/a),f=W(i.y/a),m=W((i.y+1)/a);return(function(v,x,S,E,A=0,R){const D=[];if(!v.length||!S||!E)return D;const F=(ne,de)=>{for(const _e of ne)D.push({polygon:_e,bounds:de})},k=Math.ceil(Math.log2(S)),U=Math.ceil(Math.log2(E)),q=k-U,$=[];for(let ne=0;ne<Math.abs(q);ne++)$.push(q>0?0:1);for(let ne=0;ne<Math.min(k,U);ne++)$.push(0),$.push(1);let Y=v;if(Y=uh(Y,x[0].y-A,x[1].y+A,1),Y=uh(Y,x[0].x-A,x[1].x+A,0),!Y.length)return D;const le=[];for($.length?le.push({polygons:Y,bounds:x,depth:0}):F(Y,x);le.length;){const ne=le.pop(),de=ne.depth,_e=$[de],ye=ne.bounds[0],Be=ne.bounds[1],Ee=_e===0?ye.x:ye.y,Ve=_e===0?Be.x:Be.y,Xe=R?R(_e,Ee,Ve):.5*(Ee+Ve),tt=uh(ne.polygons,Ee-A,Xe+A,_e),gt=uh(ne.polygons,Xe-A,Ve+A,_e);if(tt.length){const ot=[ye,new nt(_e===0?Xe:Be.x,_e===1?Xe:Be.y)];$.length>de+1?le.push({polygons:tt,bounds:ot,depth:de+1}):F(tt,ot)}if(gt.length){const ot=[new nt(_e===0?Xe:ye.x,_e===1?Xe:ye.y),Be];$.length>de+1?le.push({polygons:gt,bounds:ot,depth:de+1}):F(gt,ot)}}return D})(n,e,Math.ceil((h-l)/11.25),Math.ceil((f-m)/11.25),1,((v,x,S)=>{if(v===0)return .5*(x+S);{const E=W((i.y+x/pt)/a);return(j(.5*(W((i.y+S/pt)/a)+E))*a-i.y)*pt}}))}function S0(n,e,i,a,l,h){const f=Math.pow(2,a.z-l.z);for(let m=0;m<i;m++){let v=n.int16[2*(m+e)+0],x=n.int16[2*(m+e)+1];v=(v+l.x*pt)*f-a.x*pt,x=(x+l.y*pt)*f-a.y*pt,h.push(new nt(v,x))}}let R1,ym;st(Rl,"FillExtrusionBucket",{omit:["layers","features"]}),st(wp,"PartData"),st(x0,"FootprintSegment"),st(Tp,"BorderCentroidData"),st(z1,"GroundEffect");class yd extends nt{constructor(e,i,a){super(e,i),this.z=a}}class D1 extends yd{constructor(e,i,a,l){super(e,i,a),this.w=l}}function P1(n,e,i,a){const l=i==="x"?"y":"x",h=(a-n[i])/(e[i]-n[i]);n[l]=Math.round(n[l]+(e[l]-n[l])*h),n[i]=a,n.hasOwnProperty("z")&&(n.z=ti(n.z,e.z,h)),n.hasOwnProperty("w")&&(n.w=ti(n.w,e.w,h))}function vm(n,e,i,a){const l=i,h=a;for(const f of["x","y"]){let m=n,v=e;m[f]>=v[f]&&(m=e,v=n),m[f]<l&&v[f]>l&&P1(m,v,f,l),m[f]<h&&v[f]>h&&P1(v,m,f,h)}}function hu(n,e,i,a,l,h){const f=[];for(let m=0;m<n.length;m++){const v=n[m];let x;const S=f.length;let E=0;for(let A=0;A<v.length-1;A++){let R=v[A],D=v[A+1],F=0;const k=E;let U,q;h&&(F=Math.hypot(D.x-R.x,D.y-R.y),E+=F,U=R,q=D),R.x<e&&D.x<e||(R.x<e?R=new nt(e,R.y+(e-R.x)/(D.x-R.x)*(D.y-R.y))._round():D.x<e&&(D=new nt(e,R.y+(e-R.x)/(D.x-R.x)*(D.y-R.y))._round()),R.y<i&&D.y<i||(R.y<i?R=new nt(R.x+(i-R.y)/(D.y-R.y)*(D.x-R.x),i)._round():D.y<i&&(D=new nt(R.x+(i-R.y)/(D.y-R.y)*(D.x-R.x),i)._round()),R.x>=a&&D.x>=a||(R.x>=a?R=new nt(a,R.y+(a-R.x)/(D.x-R.x)*(D.y-R.y))._round():D.x>=a&&(D=new nt(a,R.y+(a-R.x)/(D.x-R.x)*(D.y-R.y))._round()),R.y>=l&&D.y>=l||(R.y>=l?R=new nt(R.x+(l-R.y)/(D.y-R.y)*(D.x-R.x),l)._round():D.y>=l&&(D=new nt(R.x+(l-R.y)/(D.y-R.y)*(D.x-R.x),l)._round()),x&&R.equals(x[x.length-1])||(x=[R],f.push(x),h&&h.push({progress:{min:k+Sp(U,q,R)*F,max:1},parentIndex:m,prevPoint:U,nextPoint:q})),x.push(D),h&&(h[h.length-1].progress.max=k+Sp(U,q,D)*F,h[h.length-1].nextPoint=q)))))}if(h&&E>0)for(let A=S;A<f.length;A++)h[A].progress.min/=E,h[A].progress.max/=E}return f}function E0(n,e,i,a,l){if(n.length<2)return void a.push(n);const h=[];for(;e.valid();){const[x,S]=e.get();for(let E=0;E<n.length-1;E++){const A=n[E],R=n[E+1],D=go(A,R,x,S);if(D){const[F]=D,k=new nt(ti(A.x,R.x,F),ti(A.y,R.y,F));h.push({t:E+F,distance:0,point:k})}}e.next()}if(h.length===0)return void a.push(n);h.sort(((x,S)=>x.t-S.t));let f=0,m=0,v=[];for(a.push(v);f!==n.length;){if(m===h.length){for(;f!==n.length;)v.length!==0&&v[v.length-1].equals(n[f])||v.push(n[f]),f++;break}h[m].t<=f?(v.length!==0&&v[v.length-1].equals(h[m].point)||v.push(h[m].point),Math.trunc(h[m].t),m++):(v.length!==0&&v[v.length-1].equals(n[f])||v.push(n[f]),f++)}}function Sp(n,e,i){return n.x!==e.x?(i.x-n.x)/(e.x-n.x):n.y!==e.y?(i.y-n.y)/(e.y-n.y):0}function dh(n,e){return n.x*e.x+n.y*e.y}function xm(n,e){if(n.length===1){let i=0;const a=e[i++];let l;for(;!l||a.equals(l);)if(l=e[i++],!l)return 1/0;for(;i<e.length;i++){const h=e[i],f=n[0],m=l.sub(a),v=h.sub(a),x=f.sub(a),S=dh(m,m),E=dh(m,v),A=dh(v,v),R=dh(x,m),D=dh(x,v),F=S*A-E*E,k=(A*R-E*D)/F,U=(S*D-E*R)/F,q=a.z*(1-k-U)+l.z*k+h.z*U;if(isFinite(q))return q}return 1/0}{let i=1/0;for(const a of e)i=Math.min(i,a.z);return i}}function A0(n,e,i){let a=1/0;rr(i,e)&&(a=xm(i,e[0]));for(let l=0;l<e.length;l++){const h=e[l],f=n[l];for(let m=0;m<h.length-1;m++){const v=h[m],x=[v,h[m+1],f[m+1],f[m],v];kn(i,x)&&(a=Math.min(a,xm(i,x)))}}return a!==1/0&&a}function L1(n,e,i,a,l,h,f,m,v,x,S){return n.projection.name==="globe"?(function(E,A,R,D,F,k,U,q,$,Y,le){const ne=[],de=[],_e=E.projection.upVectorScale(le,E.center.lat,E.worldSize).metersToTile,ye=[0,0,0,1],Be=[0,0,0,1],Ee=(Xe,tt,gt,ot)=>{Xe[0]=tt,Xe[1]=gt,Xe[2]=ot,Xe[3]=1},Ve=Cf();R>0&&(R+=Ve),D+=Ve;for(const Xe of A){const tt=[],gt=[];for(const ot of Xe){const Ye=ot.x+F.x,at=ot.y+F.y,Fe=E.projection.projectTilePoint(Ye,at,le),Le=E.projection.upVector(le,ot.x,ot.y);let rt=R,mt=D;if(U){const Ke=s(Ye,at,R,D,U,q,$,Y);rt+=Ke.base,mt+=Ke.top}R!==0?Ee(ye,Fe.x+Le[0]*_e*rt,Fe.y+Le[1]*_e*rt,Fe.z+Le[2]*_e*rt):Ee(ye,Fe.x,Fe.y,Fe.z),Ee(Be,Fe.x+Le[0]*_e*mt,Fe.y+Le[1]*_e*mt,Fe.z+Le[2]*_e*mt),sr(ye,ye,k),sr(Be,Be,k),tt.push(new yd(ye[0],ye[1],ye[2])),gt.push(new yd(Be[0],Be[1],Be[2]))}ne.push(tt),de.push(gt)}return[ne,de]})(n,e,i,a,l,h,f,m,v,x,S):f?(function(E,A,R,D,F,k,U,q,$){const Y=[],le=[],ne=[0,0,0,1];for(const de of E){const _e=[],ye=[];for(const Be of de){const Ee=Be.x+D.x,Ve=Be.y+D.y,Xe=s(Ee,Ve,A,R,k,U,q,$);ne[0]=Ee,ne[1]=Ve,ne[2]=Xe.base,ne[3]=1,Er(ne,ne,F),ne[3]=Math.max(ne[3],1e-5);const tt=new yd(ne[0]/ne[3],ne[1]/ne[3],ne[2]/ne[3]);ne[0]=Ee,ne[1]=Ve,ne[2]=Xe.top,ne[3]=1,Er(ne,ne,F),ne[3]=Math.max(ne[3],1e-5);const gt=new yd(ne[0]/ne[3],ne[1]/ne[3],ne[2]/ne[3]);_e.push(tt),ye.push(gt)}Y.push(_e),le.push(ye)}return[Y,le]})(e,i,a,l,h,f,m,v,x):(function(E,A,R,D,F){const k=[],U=[],q=F[8]*A,$=F[9]*A,Y=F[10]*A,le=F[11]*A,ne=F[8]*R,de=F[9]*R,_e=F[10]*R,ye=F[11]*R;for(const Be of E){const Ee=[],Ve=[];for(const Xe of Be){const tt=Xe.x+D.x,gt=Xe.y+D.y,ot=F[0]*tt+F[4]*gt+F[12],Ye=F[1]*tt+F[5]*gt+F[13],at=F[2]*tt+F[6]*gt+F[14],Fe=F[3]*tt+F[7]*gt+F[15],Le=ot+q,rt=Ye+$,mt=at+Y,Ke=Math.max(Fe+le,1e-5),Lt=ot+ne,Nt=Ye+de,zt=at+_e,Et=Math.max(Fe+ye,1e-5);Ee.push(new yd(Le/Ke,rt/Ke,mt/Ke)),Ve.push(new yd(Lt/Et,Nt/Et,zt/Et))}k.push(Ee),U.push(Ve)}return[k,U]})(e,i,a,l,h)}function s(n,e,i,a,l,h,f,m){const v=f*l.getElevationAt(n,e,!0,!0),x=h[0]!==0,S=x?h[1]===0?f*(h[0]/mm-bp):f*(function(E,A,R){const D=Math.floor(A[0]/8),F=Math.floor(A[1]/8),k=10*(A[0]-8*D),U=10*(A[1]-8*F),q=E.getElevationAt(D,F,!0,!0),$=E.getMeterToDEM(R),Y=Math.floor(.5*(k*$-1)),le=Math.floor(.5*(U*$-1)),ne=E.tileCoordToPixel(D,F),de=2*Y+1,_e=2*le+1,ye=(function(gt,ot,Ye,at,Fe){return[gt.getElevationAtPixel(ot,Ye,!0),gt.getElevationAtPixel(ot+Fe,Ye,!0),gt.getElevationAtPixel(ot,Ye+Fe,!0),gt.getElevationAtPixel(ot+at,Ye+Fe,!0)]})(E,ne.x-Y,ne.y-le,de,_e),Be=Math.abs(ye[0]-ye[1]),Ee=Math.abs(ye[2]-ye[3]),Ve=Math.abs(ye[0]-ye[2])+Math.abs(ye[1]-ye[3]),Xe=Math.min(.25,.5*$*(Be+Ee)/de),tt=Math.min(.25,.5*$*Ve/_e);return q+Math.max(Xe*k,tt*U)})(l,h,m):v;return{base:v+(i===0?-1:i),top:x?Math.max(S+a,v+i+2):v+a}}class d{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class g{constructor(){this.tasks={},this.taskQueue=[],Ce(["process"],this),this.invoker=new d(this.process),this.nextId=0}add(e,i){const a=this.nextId++,l=(function({type:h,isSymbolTile:f,zoom:m}){return m=m||0,h==="message"?0:h!=="maybePrepare"||f?h!=="parseTile"||f?h==="parseTile"&&f?300-m:h==="maybePrepare"&&f?400-m:500:200-m:100-m})(i);if(l===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:i,priority:l,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((a=>!!this.tasks[a])),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let l=0;l<this.taskQueue.length;l++){const h=this.tasks[this.taskQueue[l]];h.priority<i&&(i=h.priority,e=l)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class w{constructor(e,i,a){this.target=e,this.parent=i,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Ce(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new g}send(e,i,a,l,h=!1,f){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=f,this.callbacks[m]=a);const v=new Set;return this.target.postMessage({id:m,type:e,hasCallback:!!a,targetMapId:l,mustQueue:h,sourceMapId:this.mapId,data:ms(i,v)},v),{cancel:()=>{a&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const a=i.id;if(a&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const l=this.cancelCallbacks[a];delete this.cancelCallbacks[a],l&&l.cancel()}else if(i.mustQueue||jn(self)){const l=this.callbacks[a],h=this.scheduler.add((()=>this.processTask(a,i)),l&&l.metadata||{type:"message"});h&&(this.cancelCallbacks[a]=h)}else this.processTask(a,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(i.error?a(zo(i.error)):a(null,zo(i.data)))}else{const a=new Set,l=i.hasCallback?(f,m)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?ms(f):null,data:ms(m,a)},a)}:()=>{},h=zo(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,h,l);else if(this.parent.getWorkerSource){const f=i.type.split("."),{source:m,scope:v}=h;this.parent.getWorkerSource(i.sourceMapId,f[0],m,v)[f[1]](h,l)}else l(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var C={workerUrl:"",workerClass:null,workerParams:void 0};const L="mapboxgl_preloaded_worker_pool";class X{constructor(){this.active={}}acquire(e,i=X.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(C.workerClass!=null?new C.workerClass:new self.Worker(C.workerUrl,C.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach((i=>{i.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[L]}numActive(){return Object.keys(this.active).length}}X.workerCount=2;class he{constructor(e,i,a="Worker",l=X.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Pe();const h=this.workerPool.acquire(this.id,l);for(let f=0;f<h.length;f++){const m=new he.Actor(h[f],i,this.id);m.name=`${a} ${f}`,this.actors.push(m)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,i,a){fe(this.actors,((l,h)=>{l.send(e,i,h)}),a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}let De,ht;function Dt(){return De||(De=new X),De}he.Actor=w;class Bt{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),a=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,a/i.BYTES_PER_ELEMENT),a}createFloatArray(e){const i=new Float32Array(e),a=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,a/i.BYTES_PER_ELEMENT),a}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let a=0;a<e.length;++a)this.module.heapU8[i+a]=e.charCodeAt(a);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,a=e.facadeGlazingColorRgb,l=e.roofColorRgb,h=e.wallColorRgb,f=e.normalScale;this.module.setStyle(i[0],i[1],i[2],a[0],a[1],a[2],l[0],l[1],l[2],h[0],h[1],h[2],f[0],f[1],f[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,a){this.module.setFauxFacadeOptions(e?1:0,i?1:0,a)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){for(const m of e){const v=this.createStringBuffer(m.roofType),x=[0],S=[];for(const R of m.coordinates)if(Array.isArray(R)){for(const D of R)S.push(D.x),S.push(D.y);x.push(S.length)}const E=this.createIntArray(x),A=this.createFloatArray(S);this.module.addFeature(m.id,m.sourceId,m.minHeight,m.height,v,m.roofType.length,A,E,x.length-1),this.module.free(v),this.module.free(E),this.module.free(A)}for(const m of i){let v;v=m.entrances?JSON.parse(m.entrances):[];const x=this.createFloatArray(v),S=[];for(const A of m.coordinates)S.push(A.x),S.push(A.y);const E=this.createFloatArray(S);this.module.addFacade(m.sourceId,m.crossPerc,m.distanceToRoad,x,v.length,E,S.length),this.module.free(x),this.module.free(E)}if(!this.module.generateMesh()){const m=this.module.getLastError();return this.readStringBuffer(m)}const a=this.module.getMeshCount(),l=new Array(a);for(let m=0;m<a;m++){const v=this.module.getPositionsPtr(m),x=this.module.getPositionsLength(m),S=new Float32Array(this.module.heapF32.buffer,v,x),E=this.module.getNormalsPtr(m),A=this.module.getNormalsLength(m),R=new Float32Array(this.module.heapF32.buffer,E,A),D=this.module.getColorsPtr(m),F=this.module.getColorsLength(m),k=new Uint8Array(this.module.heapU8.buffer,D,F),U=this.module.getAOPtr(m),q=this.module.getAOLength(m),$=new Float32Array(this.module.heapF32.buffer,U,q),Y=this.module.getUVPtr(m),le=this.module.getUVLength(m),ne=new Float32Array(this.module.heapF32.buffer,Y,le),de=this.module.getFauxFacadePtr(m),_e=this.module.getFauxFacadeLength(m),ye=new Uint8Array(this.module.heapU8.buffer,de,_e),Be=this.module.getIndicesPtr(m),Ee=this.module.getIndicesLength(m),Ve=new Int32Array(this.module.heap32.buffer,Be,Ee),Xe=this.module.getBuildingPart(m),tt=this.readStringBuffer(Xe);l[m]={positions:S,normals:R,colors:k,ao:$,uv:ne,isFauxFacade:ye,indices:Ve,buildingPart:tt}}const h=this.module.getRingCount(),f=[];for(let m=0;m<h;m++){const v=this.module.getRingPtr(m),x=this.module.getRingLength(m),S=new Float32Array(this.module.heapF32.buffer,v,x);f.push(S)}return{meshes:l,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:f}}}let _t,wt,mi,ji,Ir,Qe=null,Ne=null,dt=null,Ot=null;function Gi(){return jn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:wt||Bn.DRACO_URL}function pr(){if(jn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(ji)return ji;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return ji=WebAssembly.validate(n)?Bn.MESHOPT_SIMD_URL:Bn.MESHOPT_URL,ji}function Di(){return Ot}const Tn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Qn={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},er={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function du(n,e,i){const a=i.json.bufferViews.length,l=i.buffers.length;e.bufferView=a,i.json.bufferViews[a]={buffer:l,byteLength:n.byteLength},i.buffers[l]=n}const bm="KHR_draco_mesh_compression";function R4(n,e){const i=n.extensions&&n.extensions[bm];if(!i)return;const a=new mi.Decoder,l=S2(e,i.bufferView),h=new mi.Mesh;if(!a.DecodeArrayToMesh(l,l.byteLength,h))throw new Error("Failed to decode Draco mesh");const f=e.json.accessors[n.indices],m=Tn[f.componentType],v=f.count*m.BYTES_PER_ELEMENT,x=mi._malloc(v);m===Uint16Array?a.GetTrianglesUInt16Array(h,v,x):a.GetTrianglesUInt32Array(h,v,x),du(mi.memory.buffer.slice(x,x+v),f,e),mi._free(x);for(const S of Object.keys(i.attributes)){const E=a.GetAttributeByUniqueId(h,i.attributes[S]),A=e.json.accessors[n.attributes[S]],R=Qn[A.componentType],D=A.count*er[A.type]*Tn[A.componentType].BYTES_PER_ELEMENT,F=mi._malloc(D);a.GetAttributeDataArrayForAllPoints(h,E,mi[R],D,F),du(mi.memory.buffer.slice(F,F+D),A,e),mi._free(F)}a.destroy(),h.destroy(),delete n.extensions[bm]}const M0="EXT_meshopt_compression";function D4(n,e){if(!n.extensions||!n.extensions[M0])return;const i=n.extensions[M0],a=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),l=new Uint8Array(i.count*i.byteStride);Ir.decodeGltfBuffer(l,i.count,i.byteStride,a,i.mode,i.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=l.buffer,delete n.extensions[M0]}const b2=1179937895,w2=new TextDecoder("utf8");function T2(n,e){return new URL(n,e).href}function P4(n,e,i,a){return fetch(T2(n.uri,a)).then((l=>l.arrayBuffer())).then((l=>{e.buffers[i]=l}))}function S2(n,e){const i=n.json.bufferViews[e];return new Uint8Array(n.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function L4(n,e,i,a){if(n.uri){const l=T2(n.uri,a);return fetch(l).then((h=>h.blob())).then((h=>createImageBitmap(h))).then((h=>{e.images[i]=h}))}if(n.bufferView!==void 0){const l=S2(e,n.bufferView),h=new Blob([l],{type:n.mimeType});return createImageBitmap(h).then((f=>{e.images[i]=f}))}}function E2(n,e=0,i){const a={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===b2){const S=new Uint32Array(n,e);let E=2;const A=(S[E++]>>2)-3,R=S[E++]>>2;if(E++,a.json=JSON.parse(w2.decode(S.subarray(E,E+R))),E+=R,E<A){const D=S[E++];E++;const F=e+(E<<2);a.buffers[0]=n.slice(F,F+D)}}else a.json=JSON.parse(w2.decode(new Uint8Array(n,e)));const{buffers:l,images:h,meshes:f,extensionsUsed:m,bufferViews:v}=a.json;let x=Promise.resolve();if(l){const S=[];for(let E=0;E<l.length;E++){const A=l[E];A.uri?S.push(P4(A,a,E,i)):a.buffers[E]||(a.buffers[E]=null)}x=Promise.all(S)}return x.then((()=>{const S=[],E=m&&m.includes(bm),A=m&&m.includes(M0);if(E&&S.push((function(){if(!mi)return _t??(_t=(function(R){let D,F=null;function k(){D=new Uint8Array(F.buffer)}function U(){throw new Error("Unexpected Draco error.")}const q={a:{a:U,d:function($,Y,le){return D.copyWithin($,Y,Y+le)},c:function($){const Y=D.length,le=Math.max($>>>0,Math.ceil(1.2*Y)),ne=Math.ceil((le-Y)/65536);try{return F.grow(ne),k(),!0}catch{return!1}},b:U}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(R,q):R.then(($=>$.arrayBuffer())).then(($=>WebAssembly.instantiate($,q)))).then(($=>{const{Rb:Y,Qb:le,P:ne,T:de,X:_e,Ja:ye,La:Be,Qa:Ee,Va:Ve,Wa:Xe,eb:tt,jb:gt,f:ot,e:Ye,yb:at,zb:Fe,Ab:Le,Bb:rt,Db:mt,Gb:Ke}=$.instance.exports;F=Ye;const Lt=(()=>{let Nt=0,zt=0,Et=0,ui=0;return Ct=>{Et&&(Y(ui),Y(Nt),zt+=Et,Et=Nt=0),Nt||(zt+=128,Nt=le(zt));const Yt=Ct.length+7&-8;let pi=Nt;Yt>=zt&&(Et=Yt,pi=ui=le(Yt));for(let Ii=0;Ii<Ct.length;Ii++)D[pi+Ii]=Ct[Ii];return pi}})();return k(),ot(),{memory:Ye,_free:Y,_malloc:le,Mesh:class{constructor(){this.ptr=ne()}destroy(){de(this.ptr)}},Decoder:class{constructor(){this.ptr=ye()}destroy(){gt(this.ptr)}DecodeArrayToMesh(Nt,zt,Et){const ui=Lt(Nt),Ct=Be(this.ptr,ui,zt,Et.ptr);return!!_e(Ct)}GetAttributeByUniqueId(Nt,zt){return{ptr:Ee(this.ptr,Nt.ptr,zt)}}GetTrianglesUInt16Array(Nt,zt,Et){Ve(this.ptr,Nt.ptr,zt,Et)}GetTrianglesUInt32Array(Nt,zt,Et){Xe(this.ptr,Nt.ptr,zt,Et)}GetAttributeDataArrayForAllPoints(Nt,zt,Et,ui,Ct){tt(this.ptr,Nt.ptr,zt.ptr,Et,ui,Ct)}},DT_INT8:at(),DT_UINT8:Fe(),DT_INT16:Le(),DT_UINT16:rt(),DT_UINT32:mt(),DT_FLOAT32:Ke()}}))})(fetch(Gi())),_t.then((R=>{mi=R,_t=void 0})))})()),A&&S.push((function(){if(Ir)return;const R=(function(D){let F;const k=WebAssembly.instantiateStreaming(D,{}).then(($=>{F=$.instance,F.exports.__wasm_call_ctors()})),U={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},q={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:k,supported:!0,decodeGltfBuffer($,Y,le,ne,de,_e){(function(ye,Be,Ee,Ve,Xe,tt,gt){const ot=ye.exports.sbrk,Ye=Ve+3&-4,at=ot(Ye*Xe),Fe=ot(tt.length),Le=new Uint8Array(ye.exports.memory.buffer);Le.set(tt,Fe);const rt=Be(at,Ve,Xe,Fe,tt.length);if(rt===0&&gt&&gt(at,Ye,Xe),Ee.set(Le.subarray(at,at+Ve*Xe)),ot(at-ot(0)),rt!==0)throw new Error(`Malformed buffer data: ${rt}`)})(F,F.exports[q[de]],$,Y,le,ne,F.exports[U[_e]])}}})(fetch(pr()));return R.ready.then((()=>{Ir=R}))})()),h)for(let R=0;R<h.length;R++)S.push(L4(h[R],a,R,i));return(S.length?Promise.all(S):Promise.resolve()).then((()=>{if(E&&f)for(const{primitives:R}of f)for(const D of R)R4(D,a);if(A&&f&&v)for(const R of v)D4(R,a);return a}))}))}function A2(n){return fetch(n).then((e=>e.arrayBuffer())).then((e=>E2(e,0,n)))}function x_(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function b_(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class w_{constructor(e,i,a,l){this.context=e,this.format=a,this.useMipmap=l&&l.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:l&&l.premultiply})}update(e,i){const a=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,l=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:h}=this,{gl:f}=h,{x:m,y:v}=i&&i.position?i.position:{x:0,y:0},x=m+a,S=v+l;!this.size||this.size[0]===x&&this.size[1]===S||(f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(this.texture),this.texture=f.createTexture(),this.size=null),f.bindTexture(f.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA8&&(!i||i.premultiply!==!1));const E=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&x>0&&S>0){const A=this.useMipmap?Math.floor(Math.log2(Math.max(x,S)))+1:1;f.texStorage2D(f.TEXTURE_2D,A,this.format,x,S),this.size=[x,S]}this.size&&(E?f.texSubImage2D(f.TEXTURE_2D,0,m,v,x_(this.format),b_(this.format),e):"data"in e&&e.data&&f.texSubImage2D(f.TEXTURE_2D,0,m,v,a,l,x_(this.format),b_(this.format),e.data)),this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,i,a=!1){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,a,l,h){const{context:f}=this,{gl:m}=f;m.bindTexture(m.TEXTURE_2D,this.texture),i!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,a),this.wrapS=a),l!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,l),this.wrapT=l),h!==this.compareMode&&(h?(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_COMPARE_MODE,m.COMPARE_REF_TO_TEXTURE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_COMPARE_FUNC,h)):m.texParameteri(m.TEXTURE_2D,m.TEXTURE_COMPARE_MODE,m.NONE),this.compareMode=h)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class wm{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:a}=this,{gl:l}=a;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,i),this.wrapS=i)}}const O4=zi([{name:"a_pos_3f",components:3,type:"Float32"}]),F4=zi([{name:"a_color_3f",components:3,type:"Float32"}]),B4=zi([{name:"a_color_4f",components:4,type:"Float32"}]),k4=zi([{name:"a_uv_2f",components:2,type:"Float32"}]),N4=zi([{name:"a_normal_3f",components:3,type:"Float32"}]),U4=zi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),V4=zi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function M2(n,e){const i=I0(n.projection,n.zoom,n.width,n.height),a=(function(h,f,m,v,x){const S=new P(m.lng-180*zf,m.lat),E=new P(m.lng+180*zf,m.lat),A=h.project(S.lng,S.lat),R=h.project(E.lng,E.lat),D=-Math.atan2(R.y-A.y,R.x-A.x),F=we.fromLngLat(m);F.y=G(F.y,-1+zf,1-zf);const k=F.toLngLat(),U=h.project(k.lng,k.lat),q=we.fromLngLat(k);q.x+=zf;const $=q.toLngLat(),Y=h.project($.lng,$.lat),le=C2(Y.x-U.x,Y.y-U.y,D),ne=we.fromLngLat(k);ne.y+=zf;const de=ne.toLngLat(),_e=h.project(de.lng,de.lat),ye=C2(_e.x-U.x,_e.y-U.y,D),Be=Math.abs(le.x)/Math.abs(ye.y),Ee=$i([]);ln(Ee,Ee,-D*(1-(x?0:v)));const Ve=$i([]);return si(Ve,Ve,[1,1-(1-Be)*v,1]),Ve[4]=-ye.x/ye.y*v,ln(Ve,Ve,D),Ci(Ve,Ee,Ve),Ve})(n.projection,0,n.center,i,e),l=I2(n);return si(a,a,[l,l,1]),a}function I2(n){const e=n.projection,i=I0(n.projection,n.zoom,n.width,n.height),a=T_(e,n.center),l=T_(e,P.convert(e.center));return Math.pow(2,a*i+(1-i)*l)}function I0(n,e,i,a,l=1/0){const h=n.range;if(!h)return 0;const f=Math.min(l,Math.max(i,a)),m=Math.log2(f/1024);return J(h[0]+m,h[1]+m,e)}const zf=1/4e4;function T_(n,e){const i=G(e.lat,-Q,Q),a=new P(e.lng-180*zf,i),l=new P(e.lng+180*zf,i),h=n.project(a.lng,i),f=n.project(l.lng,i),m=we.fromLngLat(a),v=we.fromLngLat(l),x=f.x-h.x,S=f.y-h.y,E=v.x-m.x,A=v.y-m.y,R=Math.sqrt((E*E+A*A)/(x*x+S*S));return Math.log2(R)}function C2(n,e,i){const a=Math.cos(i),l=Math.sin(i);return{x:n*a-e*l,y:n*l+e*a}}function z2(n,e,i){$i(n),ln(n,n,Ui(e[2])),_n(n,n,Ui(e[0])),mr(n,n,Ui(e[1])),si(n,n,i),Ci(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function C0(n,e,i,a,l,h,f,m){const v=[i[0]-e[0],i[1]-e[1],0],x=[a[0]-e[0],a[1]-e[1],0];if(zr(v)<1e-12||zr(x)<1e-12)return as(n);const S=Br([],v,x);Li(S,S),On(x,a,e),v[2]=(h-l)*m,x[2]=(f-l)*m;const E=v;return Br(E,v,x),Li(E,E),Cs(n,S,E)}function z0(n,e,i=!1){const a=eo(e.zoom),l=(function(h,f,m){const v=f.worldSize,x=[h[12],h[13],h[14]],S=W(x[1]/v),E=K(x[0]/v),A=$i([]),R=Z(1,S)*v,D=Z(1,0)*v*ie(S,f.zoom),F=1/hf(v);let k=D*F;if(m){const Y=I0(f.projection,f.zoom,f.width,f.height,1024);k=F*f.projection.pixelSpaceConversion(f.center.lat,v,Y)}const U=T(S,E);_i(U,U,qt([],Li([],U),R*k*x[2]));const q=(function(Y){const le=[Y[0],Y[1],Y[2]];let ne=[0,1,0];const de=Br([],ne,le);return Br(ne,le,de),Kn(ne)===0&&(ne=[0,1,0],Br(de,le,ne)),Li(de,de),Li(ne,ne),Li(le,le),[de[0],de[1],de[2],0,ne[0],ne[1],ne[2],0,le[0],le[1],le[2],0,Y[0],Y[1],Y[2],1]})(U);si(A,A,[k,k,k*R]),ki(A,A,[-x[0],-x[1],-x[2]]);const $=Ci([],f.globeMatrix,q);return Ci($,$,A),Ci($,$,h),$})(n,e,i);if(a>0){const h=(function(f,m){const v=m.worldSize,x=Z(1,0)*v*ie(m.center.lat,m.zoom)/hf(v),S=Z(1,m.center.lat)*v,E=$i([]);mr(E,E,Ui(m.center.lng)),_n(E,E,Ui(m.center.lat)),ki(E,E,[0,0,Jn]),si(E,E,[x,x,x*S]);const A=m.point;return ki(E,E,[-A.x,-A.y,0]),Ci(E,E,f),Ci(E,m.globeMatrix,E)})(n,e);return(function(f,m,v){const x=(D,F,k)=>{const U=zr(D),q=zr(F),$=Yn(D,F,k);return qt($,$,1/zr($)*ti(U,q,k))},S=x([f[0],f[1],f[2]],[m[0],m[1],m[2]],v),E=x([f[4],f[5],f[6]],[m[4],m[5],m[6]],v),A=x([f[8],f[9],f[10]],[m[8],m[9],m[10]],v),R=Yn([f[12],f[13],f[14]],[m[12],m[13],m[14]],v);return[S[0],S[1],S[2],0,E[0],E[1],E[2],0,A[0],A[1],A[2],0,R[0],R[1],R[2],1]})(l,h,a)}return l}function S_(n,e,i,a){const l=Si.projectAabbCorners(a,i);let h=Number.MAX_VALUE;for(let m=0;m<l.length;++m){const v=l[m];v[0]=(.5*v[0]+.5)*e.width,v[1]=(.5-.5*v[1])*e.height,v[2]<h&&(h=v[2])}const f=(function(m){const v=[];let x=0;for(let R=1;R<m.length;R++)(m[R][0]<m[x][0]||m[R][0]===m[x][0]&&m[R][1]<m[x][1])&&(x=R);let S,E=x;const A=new Uint8Array(m.length);do{if(A[E])break;v.push(new nt(m[E][0],m[E][1])),A[E]=1,S=(E+1)%m.length;for(let R=0;R<m.length;R++){if(m[R][0]===m[S][0]&&m[R][1]===m[S][1]||m[R][0]===m[E][0]&&m[R][1]===m[E][1])continue;const D=[m[R][0]-m[E][0],m[R][1]-m[E][1]],F=[m[S][0]-m[E][0],m[S][1]-m[E][1]],k=D[0]*F[1]-D[1]*F[0];(k>0||k===0&&D[0]*F[0]+D[1]*F[1]>=0&&D[0]*D[0]+D[1]*D[1]>F[0]*F[0]+F[1]*F[1])&&(S=R)}E=S}while(E!==x);return v.length>0&&v.push(v[0]),v})(l);if(kn(n,f))return h}const O1=64,Ep={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function R0(n,e,i,a,l,h,f,m,v,x=!1){const S=i.zoom,E=i.project(a),A=ie(a.lat,S),R=1/A;$i(n),ki(n,n,[E.x+f[0]*R,E.y+f[1]*R,f[2]]);let D=1,F=1;const k=i.worldSize;if(x){if(i.projection.name==="mercator"){let Y=0;i.elevation&&(Y=i.elevation.getAtPointOrZero(new we(E.x/k,E.y/k),0));const le=Er([],[E.x,E.y,Y,1],i.projMatrix)[3]/i.cameraToCenterDistance;D=le,F=le*ie(i.center.lat,S)}else if(i.projection.name==="globe"){const Y=z0(n,i),le=[0,0,0,1];Er(le,le,Ci([],i.projMatrix,Y));const ne=le[3]/i.cameraToCenterDistance,de=eo(S),_e=i.projection.pixelsPerMeter(a.lat,k)*ie(a.lat,S),ye=i.projection.pixelsPerMeter(i.center.lat,k)*ie(i.center.lat,S);D=ne/ti(_e,ce(i.center.lat),de),F=ne*A/_e,D*=ye,F*=ye}}else D=R;si(n,n,[D,D,F]);const U=[...n],q=e.orientation,$=[];if(z2($,[q[0]+(l?l[0]:0),q[1]+(l?l[1]:0),q[2]+(l?l[2]:0)],h),Ci(n,U,$),m&&i.elevation){let Y=0;const le=[];if(v&&i.elevation){Y=(function(de,_e,ye,Be,Ee){const Ve=_e.elevation;if(!Ve)return 0;const Xe=Si.projectAabbCorners(ye,Be),tt=Z(1,Ee.lat)*_e.worldSize,gt=(function(zt,Et){const ui=[0,0,1],Ct=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Yt of Ct){const pi=zt[Yt.corners[0]],Ii=zt[Yt.corners[1]],tn=zt[Yt.corners[2]],vi=[Ii[0]-pi[0],Ii[1]-pi[1],Et*(Ii[2]-pi[2])],cn=Br(vi,vi,[tn[0]-pi[0],tn[1]-pi[1],Et*(tn[2]-pi[2])]);Li(cn,cn),Yt.dotProductWithUp=br(cn,ui)}return Ct.sort(((Yt,pi)=>Yt.dotProductWithUp-pi.dotProductWithUp)),Ct[0].corners})(Xe,tt),ot=Xe[gt[0]],Ye=Xe[gt[1]],at=Xe[gt[2]],Fe=Xe[gt[3]],Le=Ve.getAtPointOrZero(new we(ot[0]/_e.worldSize,ot[1]/_e.worldSize),0),rt=Ve.getAtPointOrZero(new we(Ye[0]/_e.worldSize,Ye[1]/_e.worldSize),0),mt=Ve.getAtPointOrZero(new we(at[0]/_e.worldSize,at[1]/_e.worldSize),0),Ke=Ve.getAtPointOrZero(new we(Fe[0]/_e.worldSize,Fe[1]/_e.worldSize),0),Lt=(Le+Ke)/2,Nt=(rt+mt)/2;return Lt>Nt?rt<mt?C0(de,Ye,Fe,ot,rt,Ke,Le,tt):C0(de,at,ot,Fe,mt,Le,Ke,tt):Le<Ke?C0(de,ot,Ye,at,Le,rt,mt,tt):C0(de,Fe,at,Ye,Ke,mt,rt,tt),Math.max(Lt,Nt)})(le,i,e.aabb,n,a);const ne=Ci([],no([],le),$);Ci(n,U,ne)}else Y=i.elevation.getAtPointOrZero(new we(E.x/k,E.y/k),0);Y!==0&&(n[14]+=Y)}}class R2{constructor(e,i,a,l,h){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=i,this.position=a!=null?new P(a[0],a[1]):new P(0,0),this.orientation=l??[0,0,0],this.nodes=h,this.uploaded=!1,this.aabb=new Si([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){Ci(e.globalMatrix,i,e.localMatrix);const a=this.nodeOverrides.get(e.name);if(a!==void 0){const f=[];h=a.orientation,$i(l=f),mr(l,l,Ui(h[1])),ln(l,l,Ui(h[2])),_n(l,l,Ui(h[0])),Ci(e.globalMatrix,e.globalMatrix,f)}var l,h;if(e.meshes)for(const f of e.meshes){const m=Si.applyTransformFast(f.aabb,e.globalMatrix);this.aabb.encapsulate(m)}if(e.children)for(const f of e.children)this._applyTransformations(f,e.globalMatrix)}computeBoundsAndApplyParent(){const e=$i([]);this.aabb=new Si([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.nodes)this._applyTransformations(i,e)}computeModelMatrix(e,i,a,l,h,f,m=!1){R0(this.matrix,this,e.transform,this.position,i,a,l,h,f,m)}upload(e){if(!this.uploaded){for(const i of this.nodes)E_(i,e);for(const i of this.nodes)D0(i);this.uploaded=!0}}destroy(){for(const e of this.nodes)A_(e)}}function Tm(n,e,i=!1){n.uploaded||(n.gfxTexture=new w_(e,n.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function j4(n,e,i){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,O4.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,N4.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,k4.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?F4:B4).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,V4.members,!0)),n.segments=$n.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const a=n.material;a.pbrMetallicRoughness.baseColorTexture&&Tm(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&Tm(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&Tm(a.normalTexture,e),a.occlusionTexture&&Tm(a.occlusionTexture,e,i),a.emissionTexture&&Tm(a.emissionTexture,e)}function E_(n,e,i){if(n.meshes)for(const a of n.meshes)j4(a,e,i);if(n.children)for(const a of n.children)E_(a,e,i)}function D0(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)D0(e)}function A_(n){if(n.meshes)for(const i of n.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const i of n.children)A_(i)}function F1(n,e){const i=n.json.bufferViews[e.bufferView],a=Tn[e.componentType];return new a(n.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==er[e.type]*a.BYTES_PER_ELEMENT?i.byteStride/a.BYTES_PER_ELEMENT:er[e.type]))}function M_(n,e,i,a){const l=Tn[e.componentType],h=(function(S){switch(S){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(l),f=n.json.bufferViews[e.bufferView],m=f.byteStride?f.byteStride/l.BYTES_PER_ELEMENT:er[e.type],v=i.float32,x=v.length/i.capacity;for(let S=0,E=0;S<e.count*m;S+=m,E+=x)for(let A=0;A<x;A++)v[E+A]=a[S+A]*h;i._trim()}function G4(n,e,i){const a=n.indices,l=n.attributes,h={};h.indexArray=new Hn;const f=e.json.accessors[a],m=f.count/3;h.indexArray.reserve(m);const v=F1(e,f);for(let A=0;A<m;A++)h.indexArray.emplaceBack(v[3*A],v[3*A+1],v[3*A+2]);h.indexArray._trim(),h.vertexArray=new Do;const x=e.json.accessors[l.POSITION];h.vertexArray.reserve(x.count);const S=F1(e,x);for(let A=0;A<x.count;A++)h.vertexArray.emplaceBack(S[3*A],S[3*A+1],S[3*A+2]);if(h.vertexArray._trim(),h.aabb=new Si(x.min,x.max),h.centroid=(function(A,R){const D=[0,0,0],F=A.length;if(F>0){for(let k=0;k<F;k++){const U=3*A[k];D[0]+=R[U],D[1]+=R[U+1],D[2]+=R[U+2]}D[0]/=F,D[1]/=F,D[2]/=F}return D})(v,S),l.COLOR_0!==void 0){const A=e.json.accessors[l.COLOR_0],R=er[A.type],D=F1(e,A);h.colorArray=R===3?new Do:new Ml,h.colorArray.resize(A.count),M_(e,A,h.colorArray,D)}if(l.NORMAL!==void 0){h.normalArray=new Do;const A=e.json.accessors[l.NORMAL];h.normalArray.resize(A.count);const R=F1(e,A);M_(e,A,h.normalArray,R)}if(l.TEXCOORD_0!==void 0&&i.length>0){h.texcoordArray=new il;const A=e.json.accessors[l.TEXCOORD_0];h.texcoordArray.resize(A.count);const R=F1(e,A);M_(e,A,h.texcoordArray,R)}if(l._FEATURE_ID_RGBA4444!==void 0){const A=e.json.accessors[l._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=F1(e,A))}l._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(F1(e,e.json.accessors[l._FEATURE_RGBA4444]).buffer));const E=n.material;return h.material=(function(A,R){const{emissiveFactor:D=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:k=.5,normalTexture:U,occlusionTexture:q,emissiveTexture:$,doubleSided:Y,name:le}=A,{baseColorFactor:ne=[1,1,1,1],metallicFactor:de=1,roughnessFactor:_e=1,baseColorTexture:ye,metallicRoughnessTexture:Be}=A.pbrMetallicRoughness||{},Ee=q?R[q.index]:void 0;if(q&&q.extensions&&q.extensions.KHR_texture_transform&&Ee){const Ve=q.extensions.KHR_texture_transform;Ee.offsetScale=[Ve.offset[0],Ve.offset[1],Ve.scale[0],Ve.scale[1]]}return{name:le,pbrMetallicRoughness:{baseColorFactor:new pn(...ne),metallicFactor:de,roughnessFactor:_e,baseColorTexture:ye?R[ye.index]:void 0,metallicRoughnessTexture:Be?R[Be.index]:void 0},doubleSided:Y,emissiveFactor:new pn(...D),alphaMode:F,alphaCutoff:k,normalTexture:U?R[U.index]:void 0,occlusionTexture:Ee,emissionTexture:$?R[$.index]:void 0,defined:A.defined===void 0}})(E!==void 0?e.json.materials[E]:{defined:!1},i),h}function D2(n,e,i){const{matrix:a,rotation:l,translation:h,scale:f,mesh:m,extras:v,children:x,name:S}=n,E={};if(E.name=S,E.localMatrix=a||(function(A,R,D,F){var k=R[0],U=R[1],q=R[2],$=R[3],Y=k+k,le=U+U,ne=q+q,de=k*Y,_e=k*le,ye=k*ne,Be=U*le,Ee=U*ne,Ve=q*ne,Xe=$*Y,tt=$*le,gt=$*ne,ot=F[0],Ye=F[1],at=F[2];return A[0]=(1-(Be+Ve))*ot,A[1]=(_e+gt)*ot,A[2]=(ye-tt)*ot,A[3]=0,A[4]=(_e-gt)*Ye,A[5]=(1-(de+Ve))*Ye,A[6]=(Ee+Xe)*Ye,A[7]=0,A[8]=(ye+tt)*at,A[9]=(Ee-Xe)*at,A[10]=(1-(de+Be))*at,A[11]=0,A[12]=D[0],A[13]=D[1],A[14]=D[2],A[15]=1,A})([],l||[0,0,0,1],h||[0,0,0],f||[1,1,1]),E.globalMatrix=hi(E.localMatrix),m!==void 0){E.meshes=i[m];const A=E.anchor=[0,0];for(const R of E.meshes){const{min:D,max:F}=R.aabb;A[0]+=D[0]+F[0],A[1]+=D[1]+F[1]}A[0]=Math.floor(A[0]/E.meshes.length/2),A[1]=Math.floor(A[1]/E.meshes.length/2)}if(v&&(v.id&&(E.id=v.id),v.lights&&(E.lights=(function(A){if(!A.length)return[];const R=(function(q){const $=atob(q),Y=new Uint8Array($.length);for(let le=0;le<$.length;le++)Y[le]=$.codePointAt(le);return Y})(A),D=[],F=R.length/24,k=new Uint16Array(R.buffer),U=new Float32Array(R.buffer);for(let q=0;q<F;q++){const $=k[2*q*6]/30,Y=k[2*q*6+1]/30,le=k[2*q*6+10]/100,ne=U[6*q+1],de=U[6*q+2],_e=U[6*q+3],ye=U[6*q+4],Be=_e-ne,Ee=ye-de,Ve=Math.hypot(Be,Ee);D.push({pos:[ne+.5*Be,de+.5*Ee,Y],normal:[Ee/Ve,-Be/Ve,0],width:Ve,height:$,depth:le,points:[ne,de,_e,ye]})}return D})(v.lights)),v.MAPBOX_geometry_bloom&&(E.isGeometryBloom=v.MAPBOX_geometry_bloom)),x){const A=[];for(const R of x)A.push(D2(e.json.nodes[R],e,i));E.children=A}return E}function H4(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new gp(n.vertices,n.indices,8,256),[i,a]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:i,max:a}}function q4(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const a=[];for(const f of i){if(!Array.isArray(f)||f.length!==2)continue;const m=f[0],v=f[1];typeof m=="number"&&typeof v=="number"&&a.push(new nt(m,v))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let l=0;for(let f=0;f<a.length;f++){const m=a[f],v=a[(f+1)%a.length],x=a[(f+2)%a.length];l+=(m.x-v.x)*(x.y-v.y)-(x.x-v.x)*(m.y-v.y)}l>0&&a.reverse();const h=pf(a.flatMap((f=>[f.x,f.y])),[]);return h.length===0?null:{vertices:a,indices:h}}function Z4(n,e){const i=[],a=[];let l=0;const h=[];for(const f of n){l=i.length;const m=f.vertexArray.float32,v=f.indexArray.uint16;for(let x=0;x<f.vertexArray.length;x++)h[0]=m[3*x+0],h[1]=m[3*x+1],h[2]=m[3*x+2],sr(h,h,e),i.push(new nt(h[0],h[1]));for(let x=0;x<3*f.indexArray.length;x++)a.push(v[x]+l)}if(a.length%3!=0)return null;for(let f=0;f<a.length;f+=3){const m=i[a[f+0]],v=i[a[f+1]],x=i[a[f+2]];(m.x-v.x)*(x.y-v.y)-(x.x-v.x)*(m.y-v.y)>0&&([a[f+1],a[f+2]]=[a[f+2],a[f+1]])}return{vertices:i,indices:a}}function I_(n){const e=(function(v,x){const S=[],E=WebGL2RenderingContext;if(v.json.textures)for(const A of v.json.textures){const R={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};A.sampler!==void 0&&Object.assign(R,v.json.samplers[A.sampler]),S.push({image:x[A.source],sampler:R,uploaded:!1})}return S})(n,n.images),i=(function(v,x){const S=[];for(const E of v.json.meshes){const A=[];for(const R of E.primitives)A.push(G4(R,v,x));S.push(A)}return S})(n,e),{scenes:a,scene:l,nodes:h}=n.json,f=a?a[l||0].nodes:[...h.keys()],m=[];for(const v of f)m.push(D2(h[v],n,i));return(function(v,x,S){const E={},A=new Set;for(let R=0;R<v.length;R++){const D=S[x[R]];if(!D.extras)continue;const F=D.extras["mapbox:footprint:version"],k=D.extras["mapbox:footprint:id"];(F||k)&&A.add(R),F==="1.0.0"&&k&&(E[k]=R)}for(let R=0;R<v.length;R++){if(A.has(R))continue;const D=v[R],F=S[x[R]];if(!F.extras)continue;let k=null;D.id in E&&(k=Z4(v[E[D.id]].meshes,D.localMatrix)),k||(k=q4(F)),k&&(D.footprint=H4(k))}if(A.size>0){const R=Array.from(A.values()).sort(((D,F)=>D-F));for(let D=R.length-1;D>=0;D--)v.splice(R[D],1)}})(m,f,n.json.nodes),m}function X4(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,i=n.aabb.min[0]-1,a=n.aabb.min[1]-1,l=O1/(n.aabb.max[0]-i+2),h=O1/(n.aabb.max[1]-a+2);for(let f=0;f<e.length;f+=3){const m=e[f+2],v=(e[f+0]-i)*l|0,x=(e[f+1]-a)*h|0;m>n.heightmap[x*O1+v]&&(n.heightmap[x*O1+v]=m)}}function P2(n,e,i,a,l){i.reserve(i.length+4*n.length),a.reserve(a.length+10*n.length),l.reserve(l.length+10*n.length);let h=a.length;for(const f of n){const m=Math.min(10,Math.max(4,1.3*f.height))*e,v=[-f.normal[1],f.normal[0],0],x=Math.min(.29,.1*f.width/f.depth),S=f.width-2*f.depth*e*(x+.01),E=gi([],f.pos,v,S/2),A=gi([],f.pos,v,-S/2),R=[E[0],E[1],E[2]+f.height],D=[A[0],A[1],A[2]+f.height],F=gi([],f.normal,v,x);qt(F,F,m);const k=gi([],f.normal,v,-x);qt(k,k,m),_i(F,E,F),_i(k,A,k),E[2]+=.1,A[2]+=.1,a.emplaceBack(F[0],F[1],F[2]),a.emplaceBack(k[0],k[1],k[2]),a.emplaceBack(E[0],E[1],E[2]),a.emplaceBack(A[0],A[1],A[2]),a.emplaceBack(R[0],R[1],R[2]),a.emplaceBack(D[0],D[1],D[2]),a.emplaceBack(E[0],E[1],E[2]),a.emplaceBack(A[0],A[1],A[2]),a.emplaceBack(F[0],F[1],F[2]),a.emplaceBack(k[0],k[1],k[2]);const U=S/m/2;l.emplaceBack(-U-x,-1,U,.8),l.emplaceBack(U+x,-1,U,.8),l.emplaceBack(-U,0,U,1.3),l.emplaceBack(U,0,U,1.3),l.emplaceBack(U+x,-.8,U,.7),l.emplaceBack(U+x,-.8,U,.7),l.emplaceBack(0,0,U,1.3),l.emplaceBack(0,0,U,1.3),l.emplaceBack(U+x,-1.2,U,.8),l.emplaceBack(U+x,-1.2,U,.8),i.emplaceBack(6+h,4+h,8+h),i.emplaceBack(7+h,9+h,5+h),i.emplaceBack(0+h,1+h,2+h),i.emplaceBack(1+h,3+h,2+h),h+=10}}function $4(n,e){const i={};i.indexArray=new Hn,i.vertexArray=new Do,i.colorArray=new Ml,P2(n,e,i.indexArray,i.vertexArray,i.colorArray);const a={defined:!0};a.emissiveFactor=pn.black;const l={};return l.baseColorFactor=pn.white,a.pbrMetallicRoughness=l,i.material=a,i.aabb=new Si([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const L2=zi([{name:"a_pos_3f",components:3,type:"Float32"}]),W4=zi([{name:"a_normal_3",components:3,type:"Int16"}]),Y4=zi([{name:"a_centroid_3",components:3,type:"Int16"}]),O2=zi([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),K4=zi([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),J4=zi([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),Q4=zi([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),ey=zi([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),ty=zi([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),F2=it.types,P0=32767;function iy(n,e){const i=pt+e;for(const a of n)for(const l of a)if(l.x<-e||l.x>i||l.y<-e||l.y>i)return!1;return!0}class B2{constructor(){this.layoutVertexArray=new Do,this.layoutAttenuationArray=new Ml,this.layoutColorArray=new Po,this.indexArray=new Hn,this.indexArrayForConflation=new Hn,this.segmentsBucket=new $n}}class C_{constructor(){this.layoutVertexArray=new Do,this.layoutNormalArray=new El,this.layoutCentroidArray=new El,this.layoutColorArray=new Po,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new sd,this.layoutAOArray=new tl,this.indexArray=new Hn,this.indexArrayForConflation=new Hn,this.segmentsBucket=new $n,this.entranceBloom=new B2}}class k2{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new C_,this.buildingWithFacade=new C_,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new Po,this.buildingWithFacade.layoutFacadeDataArray=new _s,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new Po,this.programConfigurations=new Qo(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.groundEffect=new z1(e),this.groundEffect.groundRadiusArray=new tl,this.hasAppearances=null}updateFootprints(e,i){for(const a of this.footprints)i.push({footprint:a,id:e})}updateAppearances(e,i,a,l){}prepare(){return(function(){if(Ot!=null||dt!=null)return null;if(Ne!=null)return Ne;const e=fetch(Bn.BUILDING_GEN_URL);return Ne=(function(i){let a,l,h,f;function m(){a=new Uint8Array(f.buffer),l=new Int32Array(f.buffer),h=new Float32Array(f.buffer)}function v(){throw new Error("Unexpected BuildingGen error.")}const x=()=>{},S={a:{a:v,f:function(E){const A=a.length,R=Math.max(E>>>0,Math.ceil(1.2*A)),D=Math.ceil((R-A)/65536);try{return f.grow(D),m(),!0}catch{return!1}},g:v,b:x,c:x,d:x,e:x}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,S):i.then((E=>E.arrayBuffer())).then((E=>WebAssembly.instantiate(E,S)))).then((E=>{const A=E.instance.exports;return(0,A.g)(),f=A.f,m(),new Bt({setStyle:A.h,setAOOptions:A.i,setMetricOptions:A.j,setStructuralOptions:A.k,setFacadeOptions:A.l,setFauxFacadeOptions:A.m,setFacadeClassifierOptions:A.n,addFeature:A.o,addFacade:A.p,generateMesh:A.q,getLastError:A.r,getOuterRingLength:A.s,getMeshCount:A.t,getPositionsPtr:A.u,getPositionsLength:A.v,getNormalsPtr:A.w,getNormalsLength:A.x,getColorsPtr:A.y,getColorsLength:A.z,getAOPtr:A.A,getAOLength:A.B,getUVPtr:A.C,getUVLength:A.D,getFauxFacadePtr:A.E,getFauxFacadeLength:A.F,getIndicesPtr:A.G,getIndicesLength:A.H,getBuildingPart:A.I,getRingCount:A.J,getRingPtr:A.K,getRingLength:A.L,free:A.M,malloc:A.N,heapU8:a,heap32:l,heapF32:h})}))})(e).then((i=>(Ne=null,Ot=i,Ot))).catch((i=>{Gt("Could not load building-gen"),Ne=null,dt=i})),Ne})()}populate(e,i,a,l){const h=Di();if(!h)return;const f=ue(a);this.tileToMeter=f,this.brightness=i.brightness,h.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,f],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:f,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),h.setAOOptions(!1,.3),h.setMetricOptions(!1,16),h.setStructuralOptions(!0),h.setFacadeClassifierOptions(3);const m=new Map,v=new Map;for(const{feature:x}of e){if(F2[x.type]!=="LineString"){m.set(x.id,x.properties.source_id);continue}const S=this.layers[0]._featureFilter.needGeometry,E=Re(x,S);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),E,a))continue;const A=S?E.geometry:Ge(x,a,l),R=[];for(const U of A)for(const q of U)R.push({x:q.x,y:q.y});const D={coordinates:R,crossPerc:x.properties.cross_perc,distanceToRoad:x.properties.distance_to_road,entrances:x.properties.entrances,sourceId:0},F=x.properties.source_id;let k=v.get(F);k||(k=[],v.set(F,k)),k.push(D)}this.maxHeight=0;for(const{feature:x,id:S,index:E,sourceLayerIndex:A}of e){if(F2[x.type]==="LineString")continue;const R=this.layers[0]._featureFilter.needGeometry,D=Re(x,R);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),D,a))continue;const F=R?D.geometry:Ge(x,a,l),k=pd(F,500);if(!iy(F,163))continue;const U=this.layers[0],q=U.layout.get("building-roof-shape").evaluate(x,{},a);if(q==="flat")continue;const $=U.layout.get("building-base").evaluate(x,{},a),Y=U.layout.get("building-height").evaluate(x,{},a),le=U.layout.get("building-flood-light-ground-radius").evaluate(x,{},a),ne=U.paint.get("building-ambient-occlusion-intensity"),de=le/this.tileToMeter;let _e=U.layout.get("building-flood-light-wall-radius").evaluate(x,{},a);_e=G(_e,0,2048);const ye=_e/2048*P0,Be=m.get(S);let Ee;Ee=v.has(Be)?v.get(Be):[];const Ve=Ee.length!==0&&U.layout.get("building-facade").evaluate(x,{},a);h.setFacadeOptions(4,!0),h.setFauxFacadeOptions(Ve,!1,1);let Xe=0,tt=0,gt=0,ot=0,Ye=0,at=0;if(Ve){let qe=Math.round(U.layout.get("building-facade-floors").evaluate(x,{},a));if($===0){qe=Math.max(1,qe-(Ee.length>0?1:0));let Zt=4;if(Y>100){const Ht=[10,13,15];Zt=Ht[x.id?x.id%Ht.length:0],h.setFacadeOptions(Zt,!0)}Ye=1.6803*Zt/f}else Ye=$/f;at=Y/f,Ye=Math.min(Ye,at),gt=U.layout.get("building-facade-unit-width").evaluate(x,{},a)/f,ot=(at-Ye)/qe,h.setFauxFacadeOptions(!0,!0,gt);const At=U.layout.get("building-facade-window").evaluate(x,{},a);Xe=At[0],tt=At[1]}const Fe=[],Le=new nt(1/0,1/0),rt=new nt(-1/0,-1/0),mt=new nt(0,0);let Ke=0;for(const qe of k)if(qe.length>0){const At=[];for(const Zt of qe){const Ht=[];for(let bi=Zt.length-1;bi>=0;bi--){const ni=Zt[bi];Ht.push({x:ni.x,y:ni.y}),Le.x=Math.min(Le.x,ni.x),Le.y=Math.min(Le.y,ni.y),rt.x=Math.max(rt.x,ni.x),rt.y=Math.max(rt.y,ni.y),mt.x+=ni.x,mt.y+=ni.y,Ke++}At.push(Ht)}Fe.push({id:x.id?x.id:0,height:Y,minHeight:$,sourceId:0,roofType:q,coordinates:At})}mt.x/=Ke||1,mt.y/=Ke||1;const Lt=h.generateMesh(Fe,Ee);if(typeof Lt=="string"){Gt(`Unable to generate building ${x.id}: ${Lt}`);continue}if(Lt.meshes.length===0||Lt.modifiedPolygonRings.length===0)continue;let Nt=0;for(const qe of Lt.meshes)Nt+=qe.positions.length/3;const zt=Ve?this.buildingWithFacade:this.buildingWithoutFacade,Et=zt.segmentsBucket.prepareSegment(Nt,zt.layoutVertexArray,zt.indexArray),ui=[];let Ct=null,Yt=0,pi=-1;const Ii=zt.layoutVertexArray.length,tn=zt.indexArray.length;let vi=0;for(const qe of Lt.meshes){const At=zt.layoutVertexArray.length;if(qe.buildingPart==="entrance"){const Vt=new Array;for(let Wi=0;Wi<qe.positions.length;Wi+=12){const Cn=qe.positions[Wi+0],bn=qe.positions[Wi+1],xr=qe.positions[Wi+3],tr=qe.positions[Wi+4],Nn=qe.positions[Wi+2],Sn=qe.positions[Wi+8]-Nn,hn=1,wi=xr-Cn,dn=tr-bn,Un=Math.hypot(wi,dn);Vt.push({pos:[Cn+.5*wi,bn+.5*dn,Nn],normal:[dn/Un,-wi/Un,0],width:Un,height:Sn,depth:hn,points:[Cn,bn,xr,tr]})}const sn=zt.entranceBloom.segmentsBucket.prepareSegment(10*Vt.length,zt.entranceBloom.layoutVertexArray,zt.entranceBloom.indexArray),In=zt.entranceBloom.layoutVertexArray.length;Yt=zt.entranceBloom.indexArray.length,P2(Vt,.5/this.tileToMeter,zt.entranceBloom.indexArray,zt.entranceBloom.layoutVertexArray,zt.entranceBloom.layoutAttenuationArray);const ai=zt.entranceBloom.layoutVertexArray.length-In;pi=zt.entranceBloom.indexArray.length-Yt;for(let Wi=0;Wi<ai;Wi++)zt.entranceBloom.layoutColorArray.emplaceBack(65535,65535);sn.vertexLength+=ai,sn.primitiveLength+=pi,Ct={part:qe.buildingPart,vertexOffset:In,vertexLength:ai}}for(let Vt=0;Vt<qe.positions.length;Vt+=3)vi=Math.max(vi,qe.positions[Vt+2]),zt.layoutVertexArray.emplaceBack(qe.positions[Vt],qe.positions[Vt+1],qe.positions[Vt+2]);const Zt=Math.floor(mt.x),Ht=Math.floor(mt.y),bi=Math.floor(vi);for(let Vt=0;Vt<qe.positions.length;Vt+=3)zt.layoutCentroidArray.emplaceBack(Zt,Ht,bi),zt.layoutFloodLightDataArray.emplaceBack(qe.buildingPart==="wall"?ye:0);for(let Vt=0;Vt<qe.normals.length;Vt+=3)zt.layoutNormalArray.emplaceBack(qe.normals[Vt+0]*P0,qe.normals[Vt+1]*P0,qe.normals[Vt+2]*P0);for(let Vt=0;Vt<qe.ao.length;Vt++)zt.layoutAOArray.emplaceBack(qe.ao[Vt]);for(let Vt=0;Vt<qe.colors.length;Vt+=3){const sn=1+(qe.ao[Vt/3]-1)*ne;zt.layoutColorArray.emplaceBack(qe.colors[Vt]*sn<<8|qe.colors[Vt+1]*sn,qe.colors[Vt+2]*sn<<8)}if(Ve){for(let Vt=0;Vt<qe.positions.length;Vt+=3)zt.layoutFacadePaintArray.emplaceBack(65535,255);for(let Vt=0;Vt<qe.isFauxFacade.length;Vt++)if(qe.isFauxFacade[Vt]){const sn=1|Math.min(65535,Math.floor(qe.uv[2*Vt]*Lt.outerRingLength)),In=Math.floor(255*Xe)<<8|Math.floor(255*tt),ai=Math.floor(65535*Math.min(1,gt/pt)),Wi=Math.floor(65535*Math.min(1,ot/pt));zt.layoutFacadeDataArray.emplaceBack(sn,In,ai,Wi);const Cn=Math.floor(65535*Math.min(1,Ye/pt)),bn=Math.floor(65535*Math.min(1,at/pt));zt.layoutFacadeVerticalRangeArray.emplaceBack(Cn,bn)}else zt.layoutFacadeDataArray.emplaceBack(0,0,0,0),zt.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const ni=Et.vertexLength;for(let Vt=0;Vt<qe.indices.length;Vt+=3)zt.indexArray.emplaceBack(ni+qe.indices[Vt],ni+qe.indices[Vt+1],ni+qe.indices[Vt+2]);Et.vertexLength+=qe.positions.length/3,Et.primitiveLength+=qe.indices.length/3,(qe.buildingPart==="roof"||qe.buildingPart==="wall"||qe.buildingPart==="facade_glazing"||qe.buildingPart==="entrance")&&ui.push({part:qe.buildingPart,vertexOffset:At,vertexLength:qe.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,vi),this.buildingFeatures.push({promoteId:S,feature:D,hasFauxFacade:Ve,segment:Et,parts:ui,buildingBloom:Ct});const cn=zt.indexArray.length-tn,un=[],dr=[],re=new nt(1/0,1/0),ee=new nt(-1/0,-1/0),He=this.groundEffect.vertexArray.length;for(const qe of Lt.modifiedPolygonRings){const At=[],Zt=new nt(1/0,1/0),Ht=new nt(-1/0,-1/0);for(let bi=0;bi<qe.length;bi+=2){const ni=qe.length-bi-2;Zt.x=Math.min(Zt.x,qe[ni]),Zt.y=Math.min(Zt.y,qe[ni+1]),Ht.x=Math.max(Ht.x,qe[ni]),Ht.y=Math.max(Ht.y,qe[ni+1]);const Vt=new nt(qe[ni],qe[ni+1]);At.push(Vt),un.push(Vt.x,Vt.y),dr.push(Vt.clone())}re.x=Math.min(re.x,Zt.x),re.y=Math.min(re.y,Zt.y),ee.x=Math.max(ee.x,Ht.x),ee.y=Math.max(ee.y,Ht.y),this.groundEffect.addData(At,[Zt,Ht],de)}const bt=this.groundEffect.vertexArray.length-He;for(let qe=0;qe<bt;qe++)this.groundEffect.groundRadiusArray.emplaceBack(le);(Le.x<0||rt.x>pt||Le.y<0||rt.y>pt)&&this.featuresOnBorder.push({featureId:x.id,footprintIndex:this.footprints.length});{const qe=pf(un,null,2),At=new gp(dr,qe,8,256);let Zt=x.id;x.properties&&x.properties.hasOwnProperty("building_id")&&(Zt=x.properties.building_id);const Ht={vertices:dr,indices:qe,grid:At,min:re,max:ee,buildingId:Zt,hiddenFlags:0,indicesOffset:tn,indicesLength:cn,bloomIndicesOffset:Yt,bloomIndicesLength:pi,groundEffectVertexOffset:He,groundEffectVertexLength:bt,hasFauxFacade:Ve,segment:Et,height:vi};x.id!==void 0&&this.featureFootprintLookup.set(x.id,this.footprints.length),this.footprints.push(Ht)}this.programConfigurations.populatePaintArrays(zt.layoutVertexArray.length,x,E,{},i.availableImages,a,i.brightness),this.groundEffect.addPaintPropertiesData(x,E,{},i.availableImages,a,i.brightness),i.featureIndex.insert(x,F,E,A,this.index,Ii)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,i,a,l,h,f,m){this.programConfigurations.updatePaintArrays(e,i,h,a,l,f,m),this.groundEffect.update(e,i,h,a,l,f,m),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=a=>{a.layoutVertexBuffer=e.createVertexBuffer(a.layoutVertexArray,L2.members),a.layoutNormalBuffer=e.createVertexBuffer(a.layoutNormalArray,W4.members),a.layoutCentroidBuffer=e.createVertexBuffer(a.layoutCentroidArray,Y4.members),a.layoutFloodLightDataBuffer=e.createVertexBuffer(a.layoutFloodLightDataArray,ty.members),a.layoutFacadeDataArray&&a.layoutFacadeDataArray.length&&(a.layoutFacadeDataBuffer=e.createVertexBuffer(a.layoutFacadeDataArray,J4.members)),a.layoutFacadeVerticalRangeArray&&a.layoutFacadeVerticalRangeArray.length&&(a.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(a.layoutFacadeVerticalRangeArray,Q4.members)),a.entranceBloom.layoutVertexArray.length&&(a.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(a.entranceBloom.layoutVertexArray,L2.members),a.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(a.entranceBloom.layoutAttenuationArray,ey.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,a=!0){let l=!1;const h=a?i:0,f=0|(a?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const m of e){const v=this.footprints[m],x=v.hiddenFlags&f|h;v.hiddenFlags!==x&&(v.hiddenFlags=x,l=!0,this.groundEffect.updateHiddenByLandmarkRange(v.groundEffectVertexOffset,v.groundEffectVertexLength,v.hiddenFlags!==0))}return l&&(this.indexArrayForConflationUploaded=!1),l}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=l=>{l.indexArray.length!==0&&(l.indexArrayForConflation.resize(l.indexArray.length),l.indexArrayForConflation.uint16.set(l.indexArray.uint16),l.entranceBloom.indexArrayForConflation.resize(l.entranceBloom.indexArray.length),l.entranceBloom.indexArrayForConflation.uint16.set(l.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const l of this.footprints){const h=l.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,f=l.indicesOffset+l.indicesLength;if(l.hiddenFlags!==0){for(let v=l.indicesOffset;v<f;v++)h.indexArrayForConflation.uint16[3*v+0]=0,h.indexArrayForConflation.uint16[3*v+1]=0,h.indexArrayForConflation.uint16[3*v+2]=0;const m=l.bloomIndicesOffset+l.bloomIndicesLength;for(let v=l.bloomIndicesOffset;v<m;v++)h.entranceBloom.indexArrayForConflation.uint16[3*v+0]=0,h.entranceBloom.indexArrayForConflation.uint16[3*v+1]=0,h.entranceBloom.indexArrayForConflation.uint16[3*v+2]=0}}const a=l=>{l.indexArray.length!==0&&(l.indexBuffer?l.indexBuffer.updateData(l.indexArrayForConflation):l.indexBuffer=e.createIndexBuffer(l.indexArrayForConflation,!0),l.entranceBloom.indexBuffer?l.entranceBloom.indexBuffer.updateData(l.entranceBloom.indexArrayForConflation):l.entranceBloom.indexBuffer=e.createIndexBuffer(l.entranceBloom.indexArrayForConflation,!0))};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=a=>{a.layoutColorBuffer?a.layoutColorBuffer.updateData(a.layoutColorArray):a.layoutColorBuffer=e.createVertexBuffer(a.layoutColorArray,O2.members,!0),a.layoutFacadePaintArray&&(a.layoutFacadePaintBuffer?a.layoutFacadePaintBuffer.updateData(a.layoutFacadePaintArray):a.layoutFacadePaintBuffer=e.createVertexBuffer(a.layoutFacadePaintArray,K4.members,!0)),a.entranceBloom.layoutColorBuffer?a.entranceBloom.layoutColorBuffer.updateData(a.entranceBloom.layoutColorArray):a.entranceBloom.layoutColorBuffer=e.createVertexBuffer(a.entranceBloom.layoutColorArray,O2.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const a=e.paint.get("building-ambient-occlusion-intensity");for(const l of this.buildingFeatures){const h=i[l.promoteId],f=l.feature;f.properties["building-part"]="roof";const m=e.paint.get("building-color").evaluate(f,h,this.canonical).toPremultipliedRenderColor(this.lut),v=e.paint.get("building-emissive-strength").evaluate(f,h,this.canonical);f.properties["building-part"]="wall";const x=e.paint.get("building-color").evaluate(f,h,this.canonical).toPremultipliedRenderColor(this.lut),S=e.paint.get("building-emissive-strength").evaluate(f,h,this.canonical);f.properties["building-part"]="window";const E=e.paint.get("building-color").evaluate(f,h,this.canonical).toPremultipliedRenderColor(this.lut),A=e.paint.get("building-emissive-strength").evaluate(f,h,this.canonical);f.properties["building-part"]="door";const R=e.paint.get("building-color").evaluate(f,h,this.canonical).toPremultipliedRenderColor(this.lut),D=e.paint.get("building-emissive-strength").evaluate(f,h,this.canonical),F=l.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const U of l.parts){let q,$=m;U.part==="roof"?($=m,q=v):U.part==="wall"?($=x,q=S):U.part==="facade_glazing"?($=E,q=A):U.part==="entrance"&&($=R,q=D),q=G(q,0,1);for(let Y=0;Y<U.vertexLength;Y++){const le=U.vertexOffset+Y,ne=1+(F.layoutAOArray.float32[le]-1)*a;F.layoutColorArray.emplace(le,$.r*ne*255<<8|$.g*ne*255,$.b*ne*255<<8|255*q),l.hasFauxFacade&&F.layoutFacadePaintArray.emplace(le,255*E.r<<8|255*E.g,255*E.b<<8|255*A)}}const k=l.buildingBloom;if(k)for(let U=0;U<k.vertexLength;U++)F.entranceBloom.layoutColorArray.emplace(k.vertexOffset+U,255*R.r<<8|255*R.g,255*R.b<<8|51*D)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped());if(E1(this.activeReplacements,l))return;this.activeReplacements=l;for(const f of this.footprints)f.hiddenFlags&=-2;const h=[];for(const f of this.activeReplacements){if(f.order<=hm)continue;const m=Math.max(1,Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z));for(const v of this.footprints)v.min.x>f.max.x||v.max.x<f.min.x||v.min.y>f.max.y||v.max.y<f.min.y||(h.length=0,ny(v.vertices,0,v.vertices.length,f.footprintTileId.canonical,e.canonical,h),vp(f.footprint,h,v.indices,0,v.indices.length,0,-m)&&(v.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const f of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(f.groundEffectVertexOffset,f.groundEffectVertexLength,f.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const i=this.featureFootprintLookup.get(e.id);return this.footprints[i]}return null}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,l=!0;const h=4*(e+pt)*pt+(i+pt);if(this.footprintLookup.hasOwnProperty(h)){const m=this.footprintLookup[h];return m?{height:m.height,hidden:m.hiddenFlags!==0}:void 0}const f=new nt(e,i);for(const m of this.footprints)e>m.max.x||m.min.x>e||i>m.max.y||m.min.y>i||m.height<=a||fm(f,m)&&(a=m.height,this.footprintLookup[h]=m,l=m.hiddenFlags!==0);if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:l};this.footprintLookup[h]=void 0}}function ny(n,e,i,a,l,h){const f=Math.pow(2,a.z-l.z);for(let m=0;m<i;m++){let v=n[m+e].x,x=n[m+e].y;v=(v+l.x*pt)*f-a.x*pt,x=(x+l.y*pt)*f-a.y*pt,h.push(new nt(v,x))}}let N2,U2;st(k2,"BuildingBucket",{omit:["layers"]}),st(C_,"BuildingGeometry"),st(B2,"BuildingBloomGeometry");const ry=zi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),ay=zi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:oy}=ry,sy=zi([{name:"a_packed",components:3,type:"Float32"}]),{members:ly}=sy,cy=zi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:uy}=cy;class V2{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new zl({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const a=this.getKey(e,i);return this.positions[a]}trim(){const e=this.width,i=this.height=be(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,a){const l=[];let h=e.length%2==1?-e[e.length-1]*a:0,f=e[0]*a,m=!0;l.push({left:h,right:f,isDash:m,zeroLength:e[0]===0});let v=e[0];for(let x=1;x<e.length;x++){m=!m;const S=e[x];h=v*a,v+=S,f=v*a,l.push({left:h,right:f,isDash:m,zeroLength:S===0})}return l}addRoundDash(e,i,a){const l=i/2;for(let h=-a;h<=a;h++){const f=this.width*(this.nextRow+a+h);let m=0,v=e[m];for(let x=0;x<this.width;x++){x/v.right>1&&(v=e[++m]);const S=Math.abs(x-v.left),E=Math.abs(x-v.right),A=Math.min(S,E);let R;const D=h/a*(l+1);if(v.isDash){const F=l-Math.abs(D);R=Math.sqrt(A*A+F*F)}else R=l-Math.sqrt(A*A+D*D);this.image.data[f+x]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e,i){for(let v=e.length-1;v>=0;--v){const x=e[v],S=e[v+1];x.zeroLength?e.splice(v,1):S&&S.isDash===x.isDash&&(S.left=x.left,e.splice(v,1))}const a=e[0],l=e[e.length-1];a.isDash===l.isDash&&(a.left=l.left-this.width,l.right=a.right+this.width);const h=this.width*this.nextRow;let f=0,m=e[f];for(let v=0;v<this.width;v++){v/m.right>1&&(m=e[++f]);const x=Math.abs(v-m.left),S=Math.abs(v-m.right),E=Math.min(x,S);this.image.data[h+v]=Math.max(0,Math.min(255,(m.isDash?E:-E)+i+128))}}addDash(e,i){const a=this.getKey(e,i);if(this.positions[a])return this.positions[a];const l=i==="round",h=l?7:0,f=2*h+1;if(this.nextRow+f>this.height)return Gt("LineAtlas out of space"),null;e.length===0&&e.push(1);let m=0;for(let S=0;S<e.length;S++)e[S]<0&&(Gt("Negative value is found in line dasharray, replacing values with 0"),e[S]=0),m+=e[S];if(m!==0){const S=this.width/m,E=this.getDashRanges(e,this.width,S);l?this.addRoundDash(E,S,h):this.addRegularDash(E,i==="square"?.5*S:0)}const v=this.nextRow+h;this.nextRow+=f;const x={tl:[v,h],br:[m,0]};return this.positions[a]=x,x}}st(V2,"LineAtlas");const hy=it.types,dy=Math.cos(Math.PI/180*37.5),fy=Math.cos(Math.PI/180*5);class z_{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new Yd,this.layoutVertexArray2=new Do,this.patternVertexArray=new Do,this.indexArray=new Hn,this.programConfigurations=new Qo(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new $n,this.maxLineLength=0,this.zOffsetVertexArray=new Do,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:pt/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,l){}populate(e,i,a,l){this.hasPattern=mp("line",this.layers,this.pixelRatio,i);const h=this.layers[0].layout.get("line-sort-key");this.tileToMeter=ue(a);const f=this.layers[0].layout.get("line-elevation-reference");if(f==="hd-road-markup")this.elevationType="road";else{const A=this.layers[0].layout.get("line-z-offset"),R=A.isConstant()&&!A.constantOr(0);this.elevationType=f!=="sea"&&f!=="ground"&&R?"none":"offset",this.elevationType==="offset"&&f==="none"&&Gt(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const m=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&m!==void 0;const v=[];for(const{feature:A,id:R,index:D,sourceLayerIndex:F}of e){const k=this.layers[0]._featureFilter.needGeometry,U=Re(A,k);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),U,a))continue;const q=h?h.evaluate(U,{},a):void 0,$={id:R,properties:A.properties,type:A.type,sourceLayerIndex:F,index:D,geometry:k?U.geometry:Ge(A,a,l),patterns:{},sortKey:q};v.push($)}h&&v.sort(((A,R)=>A.sortKey-R.sortKey));const{lineAtlas:x,featureIndex:S}=i,E=this.addConstantDashes(x);for(const A of v){const{geometry:R,index:D,sourceLayerIndex:F}=A;if(E&&this.addFeatureDashes(A,x),this.hasPattern){const k=w1("line",this.layers,A,this.zoom,this.pixelRatio,i);this.patternFeatures.push(k)}else this.addFeature(A,R,D,a,x.positions,i.availableImages,i.brightness,i.elevationFeatures);S.insert(e[D].feature,R,D,F,this.index)}}addConstantDashes(e){let i=!1;for(const a of this.layers){const l=a.paint.get("line-dasharray").value,h=a.layout.get("line-cap").value;if(l.kind!=="constant"||h.kind!=="constant")i=!0;else{const f=h.value,m=l.value;if(!m)continue;e.addDash(m,f)}}return i}addFeatureDashes(e,i){const a=this.zoom;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(h.kind==="constant"&&f.kind==="constant")continue;let m,v;if(h.kind==="constant"){if(m=h.value,!m)continue}else m=h.evaluate({zoom:a},e);v=f.kind==="constant"?f.value:f.evaluate({zoom:a},e),i.addDash(m,v),e.patterns[l.id]=[i.getKey(m,v)]}}update(e,i,a,l,h,f,m,v){this.programConfigurations.updatePaintArrays(e,i,h,a,l,f,m,v)}addFeatures(e,i,a,l,h,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,i,a,l,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ly)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,uy)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,ay.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oy),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let a,l;if(i&&i>0?(a=`mapbox_clip_start_${i}`,l=`mapbox_clip_end_${i}`):(a="mapbox_clip_start",l="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(a)&&e.properties.hasOwnProperty(l))return{start:+e.properties[a],end:+e.properties[l]}}addFeature(e,i,a,l,h,f,m,v){const x=this.layers[0].layout,S=x.get("line-join").evaluate(e,{}),E=x.get("line-cap").evaluate(e,{}),A=x.get("line-miter-limit"),R=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const D=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=x.get("line-z-offset").value;const F=this.layers[0].paint.get("line-width").value;if(F.kind!=="constant"&&F.isLineProgressConstant===!1&&(this.variableWidthValue=F),this.elevationType==="road"){const k=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,l,v,S,E,A,R)){const[U,q]=this.clipRuntimeLinesToTile(i,1);for(let $=0;$<U.length;$++){const Y=U[$],le=q[$],ne={progress:{min:le.progress.min,max:le.progress.max},nextDir:this.computeSegNextDir(le,Y),prevDir:this.computeSegPrevDir(le,Y)};this.addLine(Y,e,l,S,E,A,R,ne,D&&le.parentIndex>0?le.parentIndex:null)}this.fillNonElevatedRoadSegment(k)}}else for(let k=0;k<i.length;k++)this.addLine(i[k],e,l,S,E,A,R,void 0,D&&k>0?k:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,h,f,l,m,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return hu(e,-i,-i,pt+i,pt+i)}clipRuntimeLinesToTile(e,i){const a=[];return[hu(e,-i,-i,pt+i,pt+i,a),a]}addElevatedRoadFeature(e,i,a,l,h,f,m,v){const x=[],S=$t.getElevationFeature(e,l);if(S){const E=this.clipLinesToTile(i,1),A=this.prepareElevatedLines(E,S,a);for(const R of A)x.push({geometry:R,elevation:S,elevationTileID:a,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(x.length===0)return!1;for(const E of x){const A=this.layoutVertexArray.length;this.addLine(E.geometry,e,a,h,f,m,v);const R=new Ri(a,E.elevationTileID);if(E.elevation)for(let D=A;D<this.layoutVertexArray.length;D++){const F=new nt(this.layoutVertexArray.int16[6*D]>>1,this.layoutVertexArray.int16[6*D+1]>>1),k=R.pointElevation(F,E.elevation,.05);this.updateHeightRange(k),this.zOffsetVertexArray.emplaceBack(k,0,0)}else this.fillNonElevatedRoadSegment(A)}return!0}prepareElevatedLines(e,i,a){if(i.constantHeight!=null)return e;const l=[],h=1/ue(a);for(const f of e)E0(f,new Mn(i,h),0,l);return l}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,a,l,h,f,m,v,x){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=x?this.lineFeatureClips(i,x):this.lineClips;const S=l==="none";this.patternJoinNone=this.hasPattern&&S,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const E=v&&v.progress.min>0,A=v&&v.progress.max<1;if(this.lineClips){let ye={min:this.lineClips.start,max:this.lineClips.end},Be=1;if(v){const Xe=this.lineClips.end-this.lineClips.start;ye=(function(tt,gt,ot){return{min:qi(tt.min,gt,ot),max:qi(tt.max,gt,ot)}})(v.progress,{min:0,max:1},ye),Xe>0&&(Be=(ye.max-ye.min)/Xe)}const Ee=+i.properties.mapbox_clip_feature_len,Ve=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Ee)||Number.isNaN(Ve)){for(let tt=0;tt<e.length-1;tt++)this.totalDistance+=e[tt].dist(e[tt+1]);const Xe=this.totalDistance/(ye.max-ye.min);this.totalFeatureLength=Number.isFinite(Xe)?Xe:0,this.lineClips.start=ye.min,this.lineClips.end=ye.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ee,this.distance=Ve*Be,this.lineClips.start=ye.min,this.lineClips.end=ye.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const R=hy[i.type]==="Polygon";let D=e.length;for(;D>=2&&e[D-1].equals(e[D-2]);)D--;let F=0;for(;F<D-1&&e[F].equals(e[F+1]);)F++;if(D<(R?3:2))return;l==="bevel"&&(f=1.05);const k=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let U,q,$,Y,le,ne,de,_e;v&&v.prevDir&&(ne=v.prevDir.perp()),v&&v.nextDir&&(de=v.nextDir.perp()),this.e1=this.e2=-1,R&&(U=e[D-2],le=e[F].sub(U)._unit()._perp());for(let ye=F;ye<D;ye++){if($=ye===D-1?R?e[F+1]:void 0:e[ye+1],$&&e[ye].equals($))continue;le&&(Y=le),U&&(q=U),U=e[ye],_e=this.evaluateLineProgressFeatures(q?q.dist(U):0),le=$?$.sub(U)._unit()._perp():Y,Y=Y||le;const Be=q&&$;let Ee=Be?l:R||S?"butt":h;const Ve=Y.x*le.x+Y.y*le.y;if(S){const Le=function(rt){if(rt.patternJoinNone){const mt=rt.segmentPoints.length/2,Ke=rt.lineSoFar-rt.segmentStart;for(let Lt=0;Lt<mt;++Lt){const Nt=rt.segmentPoints[2*Lt+1],zt=Math.round(rt.segmentPoints[2*Lt])+.5+.25*Nt;rt.patternVertexArray.emplaceBack(zt,Ke,rt.segmentStart),rt.patternVertexArray.emplaceBack(zt,Ke,rt.segmentStart)}rt.segmentPoints.length=0}rt.e1=rt.e2=-1};if(Be&&Ve<fy){this.updateDistance(q,U),this.addCurrentVertex(U,Y,1,1,k,_e),Le(this),this.addCurrentVertex(U,le,-1,-1,k,_e);continue}if(q){if(!$){this.updateDistance(q,U),this.addCurrentVertex(U,Y,1,1,k,_e),Le(this);continue}Ee="miter"}}let Xe=Y.add(le);Xe.x===0&&Xe.y===0||Xe._unit();const tt=Xe.x*le.x+Xe.y*le.y,gt=tt!==0?1/tt:1/0,ot=2*Math.sqrt(2-2*tt),Ye=tt<dy&&q&&$,at=Y.x*le.y-Y.y*le.x>0,Fe=this.overscaling<=16?15*pt/(512*this.overscaling):0;if(Be&&Ee==="round"){if(gt<m)Ee="miter";else if(gt<=2){const Le=R_(U,-10,pt+10);Ee=this.elevationType==="offset"&&(Le||this.hasCrossSlope)?"miter":"fakeround"}}if(Ee==="miter"&&gt>f&&(Ee="bevel"),Ee==="bevel"&&(gt>2&&(Ee="flipbevel"),gt<f&&(Ee="miter")),q&&!(Ee==="miter"&&Ye)&&this.updateDistance(q,U),Ee==="miter")if(Ye){const Le=U.dist(q);if(Le>2*Fe){const mt=U.sub(U.sub(q)._mult(Fe/Le)._round());this.updateDistance(q,mt),this.addCurrentVertex(mt,Y,0,0,k,_e),q=mt}this.updateDistance(q,U),Xe._mult(gt),this.addCurrentVertex(U,Xe,0,0,k,_e);const rt=U.dist($);if(rt>2*Fe){const mt=U.add($.sub(U)._mult(Fe/rt)._round());this.updateDistance(U,mt),this.addCurrentVertex(mt,le,0,0,k,_e),U=mt}}else Xe._mult(gt),this.addCurrentVertex(U,Xe,0,0,k,_e);else if(Ee==="flipbevel"){if(gt>100)Xe=le.mult(-1);else{const Le=gt*Y.add(le).mag()/Y.sub(le).mag();Xe._perp()._mult(Le*(at?-1:1))}this.addCurrentVertex(U,Xe,0,0,k,_e),this.addCurrentVertex(U,Xe.mult(-1),0,0,k,_e)}else if(Ee==="bevel"||Ee==="fakeround"){_e!=null&&q&&this.addCurrentVertex(U,de||Y,-1,-1,k,_e);const Le=U.dist(q)<=2*Fe&&Ee!=="bevel",rt=Xe.mult(at?1:-1);rt._mult(gt);const mt=le.mult(at?-1:1),Ke=Y.mult(at?-1:1),Lt=this.evaluateLineProgressFeatures(this.distance);if(_e==null&&(this.addHalfVertex(U,rt.x,rt.y,!1,!at,0,k,Lt),Le||this.addHalfVertex(U,rt.x+2*Ke.x,rt.y+2*Ke.y,!1,at,0,k,Lt)),Ee==="fakeround"){const Nt=Math.round(180*ot/Math.PI/20);this.addHalfVertex(U,Ke.x,Ke.y,!1,at,0,k,Lt);for(let zt=0;zt<Nt;zt++){let Et=zt/Nt;if(Et!==.5){const Ct=Et-.5;Et+=Et*Ct*(Et-1)*((1.0904+Ve*(Ve*(3.55645-1.43519*Ve)-3.2452))*Ct*Ct+(.848013+Ve*(.215638*Ve-1.06021)))}const ui=mt.sub(Ke)._mult(Et)._add(Ke)._unit();this.addHalfVertex(U,ui.x,ui.y,!1,at,0,k,Lt)}this.addHalfVertex(U,mt.x,mt.y,!1,at,0,k,Lt)}Le||_e!=null||this.addHalfVertex(U,rt.x+2*mt.x,rt.y+2*mt.y,!1,at,0,k,Lt),_e!=null&&$&&this.addCurrentVertex(U,ne||le,1,1,k,_e)}else if(Ee==="butt")this.addCurrentVertex(U,Xe,0,0,k,_e);else if(Ee==="square"){if(!q){const Le=E?0:-1;this.addCurrentVertex(U,Xe,Le,Le,k,_e)}if(this.addCurrentVertex(U,Xe,0,0,k,_e),q){const Le=A?0:1;this.addCurrentVertex(U,Xe,Le,Le,k,_e)}}else if(Ee==="round"){if(q){const Le=!Be&&de?de:Y;this.addCurrentVertex(U,Le,0,0,k,_e),!Be&&A||this.addCurrentVertex(U,Le,1,1,k,_e,!0)}if($){const Le=!Be&&ne?ne:le;!Be&&E||this.addCurrentVertex(U,Le,-1,-1,k,_e,!0),this.addCurrentVertex(U,Le,0,0,k,_e)}}}}addVerticesTo(e,i,a,l,h,f,m,v,x,S){const E=(i.w-e.w)/this.tessellationStep|0;let A=0;const R=this.scaledDistance;if(E>1){this.lineSoFar=e.w;const F=(i.x-e.x)/E,k=(i.y-e.y)/E,U=(i.z-e.z)/E,q=(i.w-e.w)/E;for(let $=1;$<E;++$){e.x+=F,e.y+=k,e.z+=U,this.lineSoFar+=q,A+=q;const Y=this.evaluateLineProgressFeatures(this.prevDistance+A);this.scaledDistance=(this.prevDistance+A)/this.totalDistance,this.addHalfVertex(e,a,l,S,!1,m,x,Y),this.addHalfVertex(e,h,f,S,!0,-v,x,Y)}}this.lineSoFar=i.w,this.scaledDistance=R;const D=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,a,l,S,!1,m,x,D),this.addHalfVertex(i,h,f,S,!0,-v,x,D)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Gt(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,a,l,h,f,m=!1){const v=i.x+i.y*a,x=i.y-i.x*a,S=i.y*l-i.x,E=-i.y-i.x*l;if(f!=null){const A=this.elevationType==="offset",R=-10,D=pt+10,F=f.zOffset,k=new D1(e.x,e.y,F,this.lineSoFar),U=!!A&&R_(e,R,D),q=this.lineSoFar,$=this.distance;if(this.currentVertex)if(U){const Y=this.currentVertexIsOutside,le=this.currentVertex,ne=new D1(e.x,e.y,F,this.lineSoFar);if(vm(le,ne,R,D),!R_(ne,R,D)){if(Y){this.e1=this.e2=-1,this.distance-=le.dist(k),this.lineSoFar=le.w;const de=this.evaluateLineProgressFeatures(le.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(le,v,x,m,!1,a,h,de),this.addHalfVertex(le,S,E,m,!0,-l,h,de),this.prevDistance=this.distance}this.distance=this.prevDistance+le.dist(ne),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(le,ne,v,x,S,E,a,l,h,m),this.distance=$,this.scaledDistance=this.distance/this.totalDistance}}else{const Y=this.currentVertex;if(this.currentVertexIsOutside){vm(Y,k,R,D),this.e1=this.e2=-1,this.distance-=Y.dist(k),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Y.w;const le=this.evaluateLineProgressFeatures(Y.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Y,v,x,m,!1,a,h,le),this.addHalfVertex(Y,S,E,m,!0,-l,h,le),this.prevDistance=this.distance,this.distance=$,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Y,k,v,x,S,E,a,l,h,m)}else U||(this.addHalfVertex(e,v,x,m,!1,a,h,f),this.addHalfVertex(e,S,E,m,!0,-l,h,f));this.currentVertex=k,this.currentVertexIsOutside=U,this.lineSoFar=q}else this.addHalfVertex(e,v,x,m,!1,a,h,f),this.addHalfVertex(e,S,E,m,!0,-l,h,f)}addHalfVertex({x:e,y:i},a,l,h,f,m,v,x){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,m)),this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(i<<1)+(f?1:0),Math.round(63*a)+128,Math.round(63*l)+128,1+(m===0?0:m<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const E=ti(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,E)}const S=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),v.primitiveLength++),f?this.e2=S:this.e1=S,x!=null&&this.zOffsetVertexArray.emplaceBack(x.zOffset,x.variableWidth,x.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function R_(n,e,i){return n.x<e||n.x>i||n.y<e||n.y>i}let j2,G2;function H2(n,e,i){return e*(pt/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}st(z_,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const q2=(n,e,i)=>(1-i)*n+i*e;function Z2(n,e){return 1/H2(n,1,e.tileZoom)}function X2(n,e,i,a){return n.translatePosMatrix(a||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const $2=n=>{const e=[];W2(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=n.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const a=n.layout.get("line-join").constantOr("miter")==="none",l=!!n.paint.get("line-pattern").constantOr(1);return a&&l&&e.push("LINE_JOIN_NONE"),e};function W2(n){const e=n.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let D_;const Y2=()=>D_||(D_={layout:j2||(j2=new fr({"line-cap":new It(Se.layout_line["line-cap"]),"line-join":new It(Se.layout_line["line-join"]),"line-miter-limit":new ut(Se.layout_line["line-miter-limit"]),"line-round-limit":new ut(Se.layout_line["line-round-limit"]),"line-sort-key":new It(Se.layout_line["line-sort-key"]),"line-z-offset":new It(Se.layout_line["line-z-offset"]),"line-elevation-reference":new ut(Se.layout_line["line-elevation-reference"]),"line-cross-slope":new ut(Se.layout_line["line-cross-slope"]),visibility:new ut(Se.layout_line.visibility),"line-width-unit":new ut(Se.layout_line["line-width-unit"])})),paint:G2||(G2=new fr({"line-opacity":new It(Se.paint_line["line-opacity"]),"line-color":new It(Se.paint_line["line-color"]),"line-translate":new ut(Se.paint_line["line-translate"]),"line-translate-anchor":new ut(Se.paint_line["line-translate-anchor"]),"line-width":new It(Se.paint_line["line-width"]),"line-gap-width":new It(Se.paint_line["line-gap-width"]),"line-offset":new It(Se.paint_line["line-offset"]),"line-blur":new It(Se.paint_line["line-blur"]),"line-dasharray":new It(Se.paint_line["line-dasharray"]),"line-pattern":new It(Se.paint_line["line-pattern"]),"line-pattern-cross-fade":new ut(Se.paint_line["line-pattern-cross-fade"]),"line-gradient":new jc(Se.paint_line["line-gradient"]),"line-trim-offset":new ut(Se.paint_line["line-trim-offset"]),"line-trim-fade-range":new ut(Se.paint_line["line-trim-fade-range"]),"line-trim-color":new ut(Se.paint_line["line-trim-color"]),"line-emissive-strength":new ut(Se.paint_line["line-emissive-strength"]),"line-border-width":new It(Se.paint_line["line-border-width"]),"line-border-color":new It(Se.paint_line["line-border-color"]),"line-occlusion-opacity":new ut(Se.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},D_);class py extends It{possiblyEvaluate(e,i){return i=new mn(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,a,l){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,a,l)}}let Sm;function K2(n,e){return e>0?e+2*n:n}const my=zi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),_y=zi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),gy=zi([{name:"a_projected_pos",components:4,type:"Float32"}],4);zi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const yy=zi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),vy=zi([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),xy=zi([{name:"a_texb",components:2,type:"Uint16"}]),by=zi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),wy=zi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);zi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const J2=zi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ty=zi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);zi([{name:"triangle",components:3,type:"Uint16"}]),zi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),zi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),zi([{type:"Float32",name:"offsetX"}]),zi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ca=24;function Sy(n,e,i){return n.sections.forEach((a=>{a.text=(function(l,h,f){const m=h.layout.get("text-transform").evaluate(f,{});return m==="uppercase"?l=l.toLocaleUpperCase():m==="lowercase"&&(l=l.toLocaleLowerCase()),Ha.applyArabicShaping&&(l=Ha.applyArabicShaping(l)),l})(a.text,e,i)})),n}const Em={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Ey(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}function Ay(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}const P_=4294967296,Q2=1/P_,eg=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let L0=class{constructor(n=new Uint8Array(16)){this.buf=ArrayBuffer.isView(n)?n:new Uint8Array(n),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(n,e,i=this.length){for(;this.pos<i;){const a=this.readVarint(),l=a>>3,h=this.pos;this.type=7&a,n(l,e,this),this.pos===h&&this.skip(a)}return e}readMessage(n,e){return this.readFields(n,e,this.readVarint()+this.pos)}readFixed32(){const n=this.dataView.getUint32(this.pos,!0);return this.pos+=4,n}readSFixed32(){const n=this.dataView.getInt32(this.pos,!0);return this.pos+=4,n}readFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*P_;return this.pos+=8,n}readSFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*P_;return this.pos+=8,n}readFloat(){const n=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,n}readDouble(){const n=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,n}readVarint(n){const e=this.buf;let i,a;return a=e[this.pos++],i=127&a,a<128?i:(a=e[this.pos++],i|=(127&a)<<7,a<128?i:(a=e[this.pos++],i|=(127&a)<<14,a<128?i:(a=e[this.pos++],i|=(127&a)<<21,a<128?i:(a=e[this.pos],i|=(15&a)<<28,(function(l,h,f){const m=f.buf;let v,x;if(x=m[f.pos++],v=(112&x)>>4,x<128||(x=m[f.pos++],v|=(127&x)<<3,x<128)||(x=m[f.pos++],v|=(127&x)<<10,x<128)||(x=m[f.pos++],v|=(127&x)<<17,x<128)||(x=m[f.pos++],v|=(127&x)<<24,x<128)||(x=m[f.pos++],v|=(1&x)<<31,x<128))return Ap(l,v,h);throw new Error("Expected varint not more than 10 bytes")})(i,n,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const n=this.readVarint();return n%2==1?(n+1)/-2:n/2}readBoolean(){return!!this.readVarint()}readString(){const n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&eg?eg.decode(this.buf.subarray(e,n)):(function(i,a,l){let h="",f=a;for(;f<l;){const m=i[f];let v,x,S,E=null,A=m>239?4:m>223?3:m>191?2:1;if(f+A>l)break;A===1?m<128&&(E=m):A===2?(v=i[f+1],(192&v)==128&&(E=(31&m)<<6|63&v,E<=127&&(E=null))):A===3?(v=i[f+1],x=i[f+2],(192&v)==128&&(192&x)==128&&(E=(15&m)<<12|(63&v)<<6|63&x,(E<=2047||E>=55296&&E<=57343)&&(E=null))):A===4&&(v=i[f+1],x=i[f+2],S=i[f+3],(192&v)==128&&(192&x)==128&&(192&S)==128&&(E=(15&m)<<18|(63&v)<<12|(63&x)<<6|63&S,(E<=65535||E>=1114112)&&(E=null))),E===null?(E=65533,A=1):E>65535&&(E-=65536,h+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),h+=String.fromCharCode(E),f+=A}return h})(this.buf,e,n)}readBytes(){const n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e}readPackedVarint(n=[],e){const i=this.readPackedEnd();for(;this.pos<i;)n.push(this.readVarint(e));return n}readPackedSVarint(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSVarint());return n}readPackedBoolean(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readBoolean());return n}readPackedFloat(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFloat());return n}readPackedDouble(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readDouble());return n}readPackedFixed32(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFixed32());return n}readPackedSFixed32(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSFixed32());return n}readPackedFixed64(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFixed64());return n}readPackedSFixed64(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSFixed64());return n}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(n){const e=7&n;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(n,e){this.writeVarint(n<<3|e)}realloc(n){let e=this.length||16;for(;e<this.pos+n;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeSFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*Q2),!0),this.pos+=8}writeSFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*Q2),!0),this.pos+=8}writeVarint(n){(n=+n||0)>268435455||n<0?(function(e,i){let a,l;if(e>=0?(a=e%4294967296|0,l=e/4294967296|0):(a=~(-e%4294967296),l=~(-e/4294967296),4294967295^a?a=a+1|0:(a=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),(function(h,f,m){m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,m.buf[m.pos]=127&(h>>>=7)})(a,0,i),(function(h,f){const m=(7&h)<<4;f.buf[f.pos++]|=m|((h>>>=3)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h)))))})(l,i)})(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))}writeSVarint(n){this.writeVarint(n<0?2*-n-1:2*n)}writeBoolean(n){this.writeVarint(+n)}writeString(n){n=String(n),this.realloc(4*n.length),this.pos++;const e=this.pos;this.pos=(function(a,l,h){for(let f,m,v=0;v<l.length;v++){if(f=l.charCodeAt(v),f>55295&&f<57344){if(!m){f>56319||v+1===l.length?(a[h++]=239,a[h++]=191,a[h++]=189):m=f;continue}if(f<56320){a[h++]=239,a[h++]=191,a[h++]=189,m=f;continue}f=m-55296<<10|f-56320|65536,m=null}else m&&(a[h++]=239,a[h++]=191,a[h++]=189,m=null);f<128?a[h++]=f:(f<2048?a[h++]=f>>6|192:(f<65536?a[h++]=f>>12|224:(a[h++]=f>>18|240,a[h++]=f>>12&63|128),a[h++]=f>>6&63|128),a[h++]=63&f|128)}return h})(this.buf,n,this.pos);const i=this.pos-e;i>=128&&tg(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(n){this.realloc(4),this.dataView.setFloat32(this.pos,n,!0),this.pos+=4}writeDouble(n){this.realloc(8),this.dataView.setFloat64(this.pos,n,!0),this.pos+=8}writeBytes(n){const e=n.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=n[i]}writeRawMessage(n,e){this.pos++;const i=this.pos;n(e,this);const a=this.pos-i;a>=128&&tg(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a}writeMessage(n,e,i){this.writeTag(n,2),this.writeRawMessage(e,i)}writePackedVarint(n,e){e.length&&this.writeMessage(n,My,e)}writePackedSVarint(n,e){e.length&&this.writeMessage(n,Iy,e)}writePackedBoolean(n,e){e.length&&this.writeMessage(n,Ry,e)}writePackedFloat(n,e){e.length&&this.writeMessage(n,Cy,e)}writePackedDouble(n,e){e.length&&this.writeMessage(n,zy,e)}writePackedFixed32(n,e){e.length&&this.writeMessage(n,Dy,e)}writePackedSFixed32(n,e){e.length&&this.writeMessage(n,Py,e)}writePackedFixed64(n,e){e.length&&this.writeMessage(n,Ly,e)}writePackedSFixed64(n,e){e.length&&this.writeMessage(n,Oy,e)}writeBytesField(n,e){this.writeTag(n,2),this.writeBytes(e)}writeFixed32Field(n,e){this.writeTag(n,5),this.writeFixed32(e)}writeSFixed32Field(n,e){this.writeTag(n,5),this.writeSFixed32(e)}writeFixed64Field(n,e){this.writeTag(n,1),this.writeFixed64(e)}writeSFixed64Field(n,e){this.writeTag(n,1),this.writeSFixed64(e)}writeVarintField(n,e){this.writeTag(n,0),this.writeVarint(e)}writeSVarintField(n,e){this.writeTag(n,0),this.writeSVarint(e)}writeStringField(n,e){this.writeTag(n,2),this.writeString(e)}writeFloatField(n,e){this.writeTag(n,5),this.writeFloat(e)}writeDoubleField(n,e){this.writeTag(n,1),this.writeDouble(e)}writeBooleanField(n,e){this.writeVarintField(n,+e)}};function Ap(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function tg(n,e,i){const a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(a);for(let l=i.pos-1;l>=n;l--)i.buf[l+a]=i.buf[l]}function My(n,e){for(let i=0;i<n.length;i++)e.writeVarint(n[i])}function Iy(n,e){for(let i=0;i<n.length;i++)e.writeSVarint(n[i])}function Cy(n,e){for(let i=0;i<n.length;i++)e.writeFloat(n[i])}function zy(n,e){for(let i=0;i<n.length;i++)e.writeDouble(n[i])}function Ry(n,e){for(let i=0;i<n.length;i++)e.writeBoolean(n[i])}function Dy(n,e){for(let i=0;i<n.length;i++)e.writeFixed32(n[i])}function Py(n,e){for(let i=0;i<n.length;i++)e.writeSFixed32(n[i])}function Ly(n,e){for(let i=0;i<n.length;i++)e.writeFixed64(n[i])}function Oy(n,e){for(let i=0;i<n.length;i++)e.writeSFixed64(n[i])}const L_=3;function Fy(n,e,i){e.glyphs=[],n===1&&i.readMessage(By,e)}function By(n,e,i){if(n===3){const{id:a,bitmap:l,width:h,height:f,left:m,top:v,advance:x}=i.readMessage(ky,{});e.glyphs.push({id:a,bitmap:new zl({width:h+2*L_,height:f+2*L_},l),metrics:{width:h,height:f,left:m,top:v,advance:x}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function ky(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const ig=L_,xs={horizontal:1,vertical:2,horizontalOnly:3};class Am{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const a=new Am;return a.scale=e||1,a.fontStack=i,a}static forImage(e){const i=new Am;return i.image=e,i}}class Mp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,a){const l=new Mp;for(let h=0;h<e.sections.length;h++){const f=e.sections[h];f.image?l.addImageSection(f,a):l.addTextSection(f,i)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(i,a){let l="";for(let h=0;h<i.length;h++){const f=i.charCodeAt(h+1)||null,m=i.charCodeAt(h-1)||null;l+=!a&&(f&&Fr(f)&&!Em[i[h+1]]||m&&Fr(m)&&!Em[i[h-1]])||!Em[i[h]]?i[h]:Em[i[h]]}return l})(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&O0[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&O0[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const a=new Mp;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Am.forText(e.scale,e.fontStack||i));const a=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(a)}addImageSection(e,i){const a=e.image?e.image.getPrimary():null;if(!a)return void Gt("Can't add FormattedSection with an empty image.");a.scaleSelf(i);const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCodePoint(l),this.sections.push(Am.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Gt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function O_(n,e,i,a,l,h,f,m,v,x,S,E,A,R,D,F=1){const k=Mp.fromFeature(n,l,F);E===xs.vertical&&k.verticalizePunctuation(A);let U=[];const q=(function(de,_e,ye,Be,Ee,Ve){if(!de)return[];const Xe=[],tt=(function(at,Fe,Le,rt,mt,Ke){let Lt=0;for(let Nt=0;Nt<at.length();Nt++){const zt=at.getSection(Nt);Lt+=ng(at.getCodePoint(Nt),zt,rt,mt,Fe,Ke)}return Lt/Math.max(1,Math.ceil(Lt/Le))})(de,_e,ye,Be,Ee,Ve),gt=de.text.indexOf("")>=0;let ot=0;for(let at=0;at<de.length();at++){const Fe=de.getSection(at),Le=de.getCodePoint(at);if(O0[Le]||(ot+=ng(Le,Fe,Be,Ee,_e,Ve)),at<de.length()-1){const rt=!((Ye=Le)<11904||!(Wt["Bopomofo Extended"](Ye)||Wt.Bopomofo(Ye)||Wt["CJK Compatibility Forms"](Ye)||Wt["CJK Compatibility Ideographs"](Ye)||Wt["CJK Compatibility"](Ye)||Wt["CJK Radicals Supplement"](Ye)||Wt["CJK Strokes"](Ye)||Wt["CJK Symbols and Punctuation"](Ye)||Wt["CJK Unified Ideographs Extension A"](Ye)||Wt["CJK Unified Ideographs"](Ye)||Wt["Enclosed CJK Letters and Months"](Ye)||Wt["Halfwidth and Fullwidth Forms"](Ye)||Wt.Hiragana(Ye)||Wt["Ideographic Description Characters"](Ye)||Wt["Kangxi Radicals"](Ye)||Wt["Katakana Phonetic Extensions"](Ye)||Wt.Katakana(Ye)||Wt["Vertical Forms"](Ye)||Wt["Yi Radicals"](Ye)||Wt["Yi Syllables"](Ye)));(Ny[Le]||rt||Fe.image)&&Xe.push(ag(at+1,ot,tt,Xe,Uy(Le,de.getCodePoint(at+1),rt&&gt),!1))}}var Ye;return og(ag(de.length(),ot,tt,Xe,0,!0))})(k,x,h,e,a,R),{processBidirectionalText:$,processStyledBidirectionalText:Y}=Ha;if($&&k.sections.length===1){const de=$(k.toString(),q);for(const _e of de){const ye=new Mp;ye.text=_e,ye.sections=k.sections;for(let Be=0;Be<_e.length;Be++)ye.sectionIndex.push(0);U.push(ye)}}else if(Y){const de=Y(k.text,k.sectionIndex,q);for(const _e of de){const ye=new Mp;ye.text=_e[0],ye.sectionIndex=_e[1],ye.sections=k.sections,U.push(ye)}}else U=(function(de,_e){const ye=[],Be=de.text;let Ee=0;for(const Ve of _e)ye.push(de.substring(Ee,Ve)),Ee=Ve;return Ee<Be.length&&ye.push(de.substring(Ee,Be.length)),ye})(k,q);const le=[],ne={positionedLines:le,text:k.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(de,_e,ye,Be,Ee,Ve,Xe,tt,gt,ot,Ye,at){let Fe=0,Le=0,rt=0;const mt=tt==="right"?1:tt==="left"?0:.5;let Ke=!1;for(const Ct of Ee){const Yt=Ct.getSections();for(const pi of Yt){if(pi.image)continue;const Ii=_e[pi.fontStack];if(Ii&&(Ke=Ii.ascender!==void 0&&Ii.descender!==void 0,!Ke))break}if(!Ke)break}let Lt=0;for(const Ct of Ee){Ct.trim();const Yt=Ct.getMaxScale(),pi=(Yt-1)*Ca,Ii={positionedGlyphs:[],lineOffset:0};de.positionedLines[Lt]=Ii;const tn=Ii.positionedGlyphs;let vi=0;if(!Ct.length()){Le+=Ve,++Lt;continue}let cn=0,un=0;for(let re=0;re<Ct.length();re++){const ee=Ct.getSection(re),He=Ct.getSectionIndex(re),bt=Ct.getCodePoint(re);let qe=ee.scale,At=null,Zt=null,Ht=null,bi=Ca,ni=0,Vt=gt;Vt===xs.vertical&&((Nt=bt)===12312||Nt===12313||Nt===12316||Nt===12540||Nt===12448)&&(Vt=xs.horizontal);const sn=!(Vt===xs.horizontal||!Ye&&!jd(bt)||Ye&&(O0[bt]||Kh(bt)));if(ee.image){const In=Be.get(ee.image.toString());if(!In)continue;Ht=ee.image,de.iconsInText=de.iconsInText||!0,Zt=In.paddedRect;const ai=In.displaySize;qe=qe*Ca/at,At={width:ai[0],height:ai[1],left:0,top:-ig,advance:sn?ai[1]:ai[0],localGlyph:!1},ni=Ke?-At.height*qe:Yt*Ca-17-ai[1]*qe,bi=At.advance;const Wi=(sn?ai[0]:ai[1])*qe-Ca*Yt;Wi>0&&Wi>vi&&(vi=Wi)}else{const In=ye[ee.fontStack];if(!In)continue;In[bt]&&(Zt=In[bt]);const ai=_e[ee.fontStack];if(!ai)continue;const Wi=ai.glyphs[bt];if(!Wi)continue;if(At=Wi.metrics,bi=bt!==8203?Ca:0,Ke){const Cn=ai.ascender!==void 0?Math.abs(ai.ascender):0,bn=ai.descender!==void 0?Math.abs(ai.descender):0,xr=(Cn+bn)*qe;cn<xr&&(cn=xr,un=(Cn-bn)/2*qe),ni=-Cn*qe}else ni=(Yt-qe)*Ca-17}sn?(de.verticalizable=!0,tn.push({glyph:bt,image:Ht,x:Fe,y:Le+ni,vertical:sn,scale:qe,localGlyph:At.localGlyph,fontStack:ee.fontStack,sectionIndex:He,metrics:At,rect:Zt}),Fe+=bi*qe+ot):(tn.push({glyph:bt,image:Ht,x:Fe,y:Le+ni,vertical:sn,scale:qe,localGlyph:At.localGlyph,fontStack:ee.fontStack,sectionIndex:He,metrics:At,rect:Zt}),Fe+=At.advance*qe+ot)}tn.length!==0&&(rt=Math.max(Fe-ot,rt),Ke?sg(tn,mt,vi,un,Ve*Yt/2):sg(tn,mt,vi,0,Ve/2)),Fe=0;const dr=Ve*Yt+vi;Ii.lineOffset=Math.max(vi,pi),Le+=dr,++Lt}var Nt;const zt=Le,{horizontalAlign:Et,verticalAlign:ui}=F_(Xe);(function(Ct,Yt,pi,Ii,tn,vi){const cn=(Yt-pi)*tn,un=-vi*Ii;for(const dr of Ct)for(const re of dr.positionedGlyphs)re.x+=cn,re.y+=un})(de.positionedLines,mt,Et,ui,rt,zt),de.top+=-ui*zt,de.bottom=de.top+zt,de.left+=-Et*rt,de.right=de.left+rt,de.hasBaseline=Ke})(ne,e,i,a,U,f,m,v,E,x,A,D),!(function(de){for(const _e of de)if(_e.positionedGlyphs.length!==0)return!1;return!0})(le))return ne}const O0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ny={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ng(n,e,i,a,l,h){if(e.image){const f=a.get(e.image.toString());return f?f.displaySize[0]*e.scale*Ca/h+l:0}{const f=i[e.fontStack],m=f&&f.glyphs[n];return m?m.metrics.advance*e.scale+l:0}}function rg(n,e,i,a){const l=Math.pow(n-e,2);return a?n<e?l/2:2*l:l+Math.abs(i)*i}function Uy(n,e,i){let a=0;return n===10&&(a-=1e4),i&&(a+=150),n!==40&&n!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function ag(n,e,i,a,l,h){let f=null,m=rg(e,i,l,h);for(const v of a){const x=rg(e-v.x,i,l,h)+v.badness;x<=m&&(f=v,m=x)}return{index:n,x:e,priorBreak:f,badness:m}}function og(n){return n?og(n.priorBreak).concat(n.index):[]}function F_(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function sg(n,e,i,a,l){if(!(e||i||a||l))return;const h=n.length-1,f=n[h],m=(f.x+f.metrics.advance*f.scale)*e;for(let v=0;v<=h;v++)n[v].x-=m,n[v].y+=i+a+l}function lg(n){return n.imagePrimary!==void 0&&n.top!==void 0&&n.bottom!==void 0&&n.left!==void 0&&n.right!==void 0}function F0(n,e,i,a){const{horizontalAlign:l,verticalAlign:h}=F_(a),f=i[0]-n.displaySize[0]*l,m=i[1]-n.displaySize[1]*h;return{imagePrimary:n,imageSecondary:e,top:m,bottom:m+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function B_(n,e,i,a,l,h){const f=n.imagePrimary;let m;if(f.content){const k=f.content,U=f.pixelRatio||1;m=[k[0]/U,k[1]/U,f.displaySize[0]-k[2]/U,f.displaySize[1]-k[3]/U]}const v=e.left*h,x=e.right*h;let S,E,A,R;i==="width"||i==="both"?(R=l[0]+v-a[3],E=l[0]+x+a[1]):(R=l[0]+(v+x-f.displaySize[0])/2,E=R+f.displaySize[0]);const D=e.top*h,F=e.bottom*h;return i==="height"||i==="both"?(S=l[1]+D-a[0],A=l[1]+F+a[2]):(S=l[1]+(D+F-f.displaySize[1])/2,A=S+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:S,right:E,bottom:A,left:R,collisionPadding:m}}function cg(n){return!n.imagePrimary.stretchX}function ug(n){return!n.imagePrimary.stretchY}function hg(n){return{width:n.right-n.left,height:n.bottom-n.top}}const fu=128;function Ip(n,e,i){const{expression:a}=e;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new mn(n+1,{worldview:i}))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:h}=a;let f=0;for(;f<l.length&&l[f]<=n;)f++;f=Math.max(0,f-1);let m=f;for(;m<l.length&&l[m]<n+1;)m++;m=Math.min(l.length-1,m);const v=l[f],x=l[m];return a.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:x,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:x,minSize:a.evaluate(new mn(v,{worldview:i})),maxSize:a.evaluate(new mn(x,{worldview:i})),interpolationType:h}}}function k_(n,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:l}){return n.kind==="source"?a/fu:n.kind==="composite"?ti(a/fu,l/fu,i):e}function Cp(n,e,i=1){let a=0,l=0;if(n.kind==="constant")l=n.layoutSize*i;else if(n.kind!=="source"){const{interpolationType:h,minZoom:f,maxZoom:m}=n,v=h?G(cr.interpolationFactor(h,e,f,m),0,1):0;n.kind==="camera"?l=ti(n.minSize,n.maxSize,v)*i:a=v*i}return{uSizeT:a,uSize:l}}class vd extends nt{constructor(e,i,a,l,h){super(e,i),this.angle=l,this.z=a,h!==void 0&&(this.segment=h)}clone(){return new vd(this.x,this.y,this.z,this.angle,this.segment)}}function dg(n,e,i,a,l){if(e.segment===void 0)return!0;let h=e,f=e.segment+1,m=0;for(;m>-i/2;){if(f--,f<0)return!1;m-=n[f].dist(h),h=n[f]}m+=n[f].dist(n[f+1]),f++;const v=[];let x=0;for(;m<i/2;){const S=n[f],E=n[f+1];if(!E)return!1;let A=n[f-1].angleTo(S)-S.angleTo(E);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:m,angleDelta:A}),x+=A;m-v[0].distance>a;)x-=v.shift().angleDelta;if(x>l)return!1;f++,m+=S.dist(E)}return!0}function fg(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function pg(n,e,i){return n?.6*e*i:0}function mg(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function Vy(n,e,i,a,l,h){const f=pg(i,l,h),m=mg(i,a)*h;let v=0;const x=fg(n)/2;for(let S=0;S<n.length-1;S++){const E=n[S],A=n[S+1],R=E.dist(A);if(v+R>x){const D=(x-v)/R,F=ti(E.x,A.x,D),k=ti(E.y,A.y,D),U=new vd(F,k,0,A.angleTo(E),S);return!f||dg(n,U,m,f,e)?U:void 0}v+=R}}function jy(n,e,i,a,l,h,f,m,v){const x=pg(a,h,f),S=mg(a,l),E=S*f,A=n[0].x===0||n[0].x===v||n[0].y===0||n[0].y===v;return e-E<e/4&&(e=E+e/4),_g(n,A?e/2*m%e:(S/2+2*h)*f*m%e,e,x,i,E,A,!1,v)}function _g(n,e,i,a,l,h,f,m,v){const x=h/2,S=fg(n);let E=0,A=e-i,R=[];for(let D=0;D<n.length-1;D++){const F=n[D],k=n[D+1],U=F.dist(k),q=k.angleTo(F);for(;A+i<E+U;){A+=i;const $=(A-E)/U,Y=ti(F.x,k.x,$),le=ti(F.y,k.y,$);if(Y>=0&&Y<v&&le>=0&&le<v&&A-x>=0&&A+x<=S){const ne=new vd(Y,le,0,q,D);a&&!dg(n,ne,h,a,l)||R.push(ne)}}E+=U}return m||R.length||f||(R=_g(n,E/2,i,a,l,h,f,!0,v)),R}function gg(n){let e=0,i=0;for(const f of n)e+=f.w*f.h,i=Math.max(i,f.w);n.sort(((f,m)=>m.h-f.h));const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let l=0,h=0;for(const f of n)for(let m=a.length-1;m>=0;m--){const v=a[m];if(!(f.w>v.w||f.h>v.h)){if(f.x=v.x,f.y=v.y,h=Math.max(h,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===v.w&&f.h===v.h){const x=a.pop();x&&m<a.length&&(a[m]=x)}else f.h===v.h?(v.x+=f.w,v.w-=f.w):f.w===v.w?(v.y+=f.h,v.h-=f.h):(a.push({x:v.x+f.w,y:v.y,w:v.w-f.w,h:f.h}),v.y+=f.h,v.h-=f.h);break}}return{w:l,h,fill:e/(l*h)||0}}st(vd,"Anchor");const B1=1;class Mm{static getImagePositionScale(e,i,a){if(i&&e&&e.options&&e.options.transform){const l=e.options.transform;return{x:l.a,y:l.d}}return{x:a,y:a}}constructor(e,i,a,l){this.paddedRect=e;const{pixelRatio:h,version:f,stretchX:m,stretchY:v,content:x,sdf:S,usvg:E}=i;this.pixelRatio=h,this.stretchX=m,this.stretchY=v,this.content=x,this.version=f,this.padding=a,this.sdf=S,this.usvg=E,this.scale=Mm.getImagePositionScale(l,E,h)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function N_(n,e,i){const a=Os.parse(n),l=(function(h,f,m=[1,1]){return{x:0,y:0,w:(h.data?h.data.width:h.width*m[0])+2*f,h:(h.data?h.data.height:h.height*m[1])+2*f}})(e,i,[a.options.transform.a,a.options.transform.d]);return{bin:l,imagePosition:new Mm(l,e,i,a),imageVariant:a}}class yg{constructor(e,i,a){const l=new Map,h=new Map;this.haveRenderCallbacks=[];const f=[];this.addImages(e,l,B1,f),this.addImages(i,h,2,f);const{w:m,h:v}=gg(f),x=new fa({width:m||1,height:v||1});for(const[S,E]of e.entries()){const A=l.get(S).paddedRect;fa.copy(E.data,x,{x:0,y:0},{x:A.x+B1,y:A.y+B1},E.data,null,E.sdf)}for(const[S,E]of i.entries()){const A=h.get(S),R=A.paddedRect;let D=A.padding;const F=R.x+D,k=R.y+D,U=E.data.width,q=E.data.height;D=D>1?D-1:D,fa.copy(E.data,x,{x:0,y:0},{x:F,y:k},E.data,a),fa.copy(E.data,x,{x:0,y:q-D},{x:F,y:k-D},{width:U,height:D},a),fa.copy(E.data,x,{x:0,y:0},{x:F,y:k+q},{width:U,height:D},a),fa.copy(E.data,x,{x:U-D,y:0},{x:F-D,y:k},{width:D,height:q},a),fa.copy(E.data,x,{x:0,y:0},{x:F+U,y:k},{width:D,height:q},a),fa.copy(E.data,x,{x:U-D,y:q-D},{x:F-D,y:k-D},{width:D,height:D},a),fa.copy(E.data,x,{x:0,y:q-D},{x:F+U,y:k-D},{width:D,height:D},a),fa.copy(E.data,x,{x:0,y:0},{x:F+U,y:k+q},{width:D,height:D},a),fa.copy(E.data,x,{x:U-D,y:0},{x:F-D,y:k+q},{width:D,height:D},a)}this.lut=a,this.image=x,this.iconPositions=l,this.patternPositions=h}addImages(e,i,a,l){for(const[h,f]of e.entries()){const{bin:m,imagePosition:v,imageVariant:x}=N_(h,f,a);i.set(h,v),l.push(m),f.hasRenderCallback&&this.haveRenderCallbacks.push(x.id)}}patchUpdatedImages(e,i,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((l=>e.hasImage(l,a))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const l of e.getUpdatedImages(a)){for(const h of this.iconPositions.keys()){const f=Os.parse(h);if(Ur.isEqual(f.id,l)){const m=e.getImage(l,a);this.patchUpdatedImage(this.iconPositions.get(h),m,i,null)}}for(const h of this.patternPositions.keys()){const f=Os.parse(h);if(Ur.isEqual(f.id,l)){const m=e.getImage(l,a);this.patchUpdatedImage(this.patternPositions.get(h),m,i,this.lut)}}}}patchUpdatedImage(e,i,a,l=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[h,f]=e.tl,m=e.sdf;if(this.lut||m){const v={width:i.data.width,height:i.data.height},x=new fa(v);fa.copy(i.data,x,{x:0,y:0},{x:0,y:0},v,l,m),a.update(x,{position:{x:h,y:f}})}else a.update(i.data,{position:{x:h,y:f}})}}st(Mm,"ImagePosition"),st(yg,"ImageAtlas");const Im=1e20;function vg(n,e,i,a,l,h,f,m,v){for(let x=e;x<e+a;x++)xg(n,i*h+x,h,l,f,m,v);for(let x=i;x<i+l;x++)xg(n,x*h+e,1,a,f,m,v)}function xg(n,e,i,a,l,h,f){h[0]=0,f[0]=-Im,f[1]=Im,l[0]=n[e];for(let m=1,v=0,x=0;m<a;m++){l[m]=n[e+m*i];const S=m*m;do{const E=h[v];x=(l[m]-l[E]+S-E*E)/(m-E)/2}while(x<=f[v]&&--v>-1);v++,h[v]=m,f[v]=x,f[v+1]=Im}for(let m=0,v=0;m<a;m++){for(;f[v+1]<m;)v++;const x=h[v],S=m-x;n[e+m*i]=l[x]+S*S}}const pu=2,U_={none:0,ideographs:1,all:2};class zp{constructor(e,i,a){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=a,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const a=[],l=this.url||Bn.GLYPHS_URL;for(const h in e)for(const f of e[h])a.push({stack:h,id:f});fe(a,(({stack:h,id:f},m)=>{let v=this.entries[h];v||(v=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=v.glyphs[f];if(x!==void 0)return void m(null,{stack:h,id:f,glyph:x});if(x=this._tinySDF(v,h,f),x)return v.glyphs[f]=x,void m(null,{stack:h,id:f,glyph:x});const S=Math.floor(f/256);if(256*S>65535)return Gt("glyphs > 65535 not supported"),void m(null,{stack:h,id:f,glyph:x});if(v.ranges[S])return void m(null,{stack:h,id:f,glyph:x});let E=v.requests[S];E||(E=v.requests[S]=[],zp.loadGlyphRange(h,S,l,this.requestManager,((A,R)=>{if(R){v.ascender=R.ascender,v.descender=R.descender;for(const D in R.glyphs)this._doesCharSupportLocalGlyph(+D)||(v.glyphs[+D]=R.glyphs[+D]);v.ranges[S]=!0}for(const D of E)D(A,R);delete v.requests[S]}))),E.push(((A,R)=>{A?m(A):R&&m(null,{stack:h,id:f,glyph:R.glyphs[f]||null})}))}),((h,f)=>{if(h)i(h);else if(f){const m={};for(const{stack:v,id:x,glyph:S}of f)m[v]===void 0&&(m[v]={}),m[v].glyphs===void 0&&(m[v].glyphs={}),m[v].glyphs[x]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},m[v].ascender=this.entries[v].ascender,m[v].descender=this.entries[v].descender;i(null,m)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==U_.none&&(this.localGlyphMode===U_.all?!!this.localFontFamily:!!this.localFontFamily&&(Wt["CJK Unified Ideographs"](e)||Wt["Hangul Syllables"](e)||Wt.Hiragana(e)||Wt.Katakana(e)||Wt["CJK Symbols and Punctuation"](e)||Wt["CJK Unified Ideographs Extension A"](e)||Wt["CJK Unified Ideographs Extension B"](e)||Wt.Osage(e)))}_tinySDF(e,i,a){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(a))return;let h=e.tinySDF;if(!h){let F="400";/bold/i.test(i)?F="900":/medium/i.test(i)?F="500":/light/i.test(i)&&(F="200"),h=e.tinySDF=new zp.TinySDF({fontFamily:l,fontWeight:F,fontSize:24*pu,buffer:3*pu,radius:8*pu}),h.fontWeight=F}if(this.localGlyphs[h.fontWeight][a])return this.localGlyphs[h.fontWeight][a];const f=String.fromCodePoint(a),{data:m,width:v,height:x,glyphWidth:S,glyphHeight:E,glyphLeft:A,glyphTop:R,glyphAdvance:D}=h.draw(f);return this.localGlyphs[h.fontWeight][a]={id:a,bitmap:new zl({width:v,height:x},m),metrics:{width:S/pu,height:E/pu,left:A/pu,top:R/pu-27,advance:D/pu,localGlyph:!0}}}}zp.loadGlyphRange=function(n,e,i,a,l){const h=256*e,f=h+255,m=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${h}-${f}`),ss.Glyphs);Ao(m,((v,x)=>{if(v)l(v);else if(x){const S={},E=(function(A){return new L0(A).readFields(Fy,{})})(x);for(const A of E.glyphs)S[A.id]=A;l(null,{glyphs:S,ascender:E.ascender,descender:E.descender})}}))},zp.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:l="sans-serif",fontWeight:h="normal",fontStyle:f="normal",lang:m=null}={}){this.buffer=e,this.cutoff=a,this.radius=i,this.lang=m;const v=this.size=n+4*e,x=this._createCanvas(v),S=this.ctx=x.getContext("2d",{willReadFrequently:!0});S.font=`${f} ${h} ${n}px ${l}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:l,actualBoundingBoxRight:h}=this.ctx.measureText(n),f=Math.ceil(i),m=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-l))),v=Math.min(this.size-this.buffer,f+Math.ceil(a)),x=m+2*this.buffer,S=v+2*this.buffer,E=Math.max(x*S,0),A=new Uint8ClampedArray(E),R={data:A,width:x,height:S,glyphWidth:m,glyphHeight:v,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(m===0||v===0)return R;const{ctx:D,buffer:F,gridInner:k,gridOuter:U}=this;this.lang&&(D.lang=this.lang),D.clearRect(F,F,m,v),D.fillText(n,F,F+f);const q=D.getImageData(F,F,m,v);U.fill(Im,0,E),k.fill(0,0,E);for(let $=0;$<v;$++)for(let Y=0;Y<m;Y++){const le=q.data[4*($*m+Y)+3]/255;if(le===0)continue;const ne=($+F)*x+Y+F;if(le===1)U[ne]=0,k[ne]=Im;else{const de=.5-le;U[ne]=de>0?de*de:0,k[ne]=de<0?de*de:0}}vg(U,0,0,x,S,x,this.f,this.v,this.z),vg(k,F,F,m,v,x,this.f,this.v,this.z);for(let $=0;$<E;$++){const Y=Math.sqrt(U[$])-Math.sqrt(k[$]);A[$]=Math.round(255-255*(Y/this.radius+this.cutoff))}return R}};const fh=B1;function bg(n,e){return n+e[1]-e[0]}function V_(n,e,i,a,l=1){const h=[],f=n.imagePrimary,m=f.pixelRatio,v=f.paddedRect.w-2*fh,x=f.paddedRect.h-2*fh,S=(n.right-n.left)*l,E=(n.bottom-n.top)*l,A=f.stretchX||[[0,v]],R=f.stretchY||[[0,x]],D=A.reduce(bg,0),F=R.reduce(bg,0),k=v-D,U=x-F;let q=0,$=D,Y=0,le=F,ne=0,de=k,_e=0,ye=U;if(f.content&&a){const Ee=f.content;q=B0(A,0,Ee[0]),Y=B0(R,0,Ee[1]),$=B0(A,Ee[0],Ee[2]),le=B0(R,Ee[1],Ee[3]),ne=Ee[0]-q,_e=Ee[1]-Y,de=Ee[2]-Ee[0]-$,ye=Ee[3]-Ee[1]-le}const Be=(Ee,Ve,Xe,tt)=>{const gt=k0(Ee.stretch-q,$,S,n.left*l),ot=N0(Ee.fixed-ne,de,Ee.stretch,D),Ye=k0(Ve.stretch-Y,le,E,n.top*l),at=N0(Ve.fixed-_e,ye,Ve.stretch,F),Fe=k0(Xe.stretch-q,$,S,n.left*l),Le=N0(Xe.fixed-ne,de,Xe.stretch,D),rt=k0(tt.stretch-Y,le,E,n.top*l),mt=N0(tt.fixed-_e,ye,tt.stretch,F),Ke=new nt(gt,Ye),Lt=new nt(Fe,Ye),Nt=new nt(Fe,rt),zt=new nt(gt,rt),Et=new nt(ot/m,at/m),ui=new nt(Le/m,mt/m),Ct=e*Math.PI/180;if(Ct){const cn=Math.sin(Ct),un=Math.cos(Ct),dr=[un,-cn,cn,un];Ke._matMult(dr),Lt._matMult(dr),zt._matMult(dr),Nt._matMult(dr)}const Yt=Ee.stretch+Ee.fixed,pi=Xe.stretch+Xe.fixed,Ii=Ve.stretch+Ve.fixed,tn=tt.stretch+tt.fixed,vi=n.imageSecondary;return{tl:Ke,tr:Lt,bl:zt,br:Nt,texPrimary:{x:f.paddedRect.x+fh+Yt,y:f.paddedRect.y+fh+Ii,w:pi-Yt,h:tn-Ii},texSecondary:vi?{x:vi.paddedRect.x+fh+Yt,y:vi.paddedRect.y+fh+Ii,w:pi-Yt,h:tn-Ii}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Et,pixelOffsetBR:ui,minFontScaleX:de/m/S,minFontScaleY:ye/m/E,isSDF:i}};if(a&&(f.stretchX||f.stretchY)){const Ee=wg(A,k,D),Ve=wg(R,U,F);for(let Xe=0;Xe<Ee.length-1;Xe++){const tt=Ee[Xe],gt=Ee[Xe+1];for(let ot=0;ot<Ve.length-1;ot++)h.push(Be(tt,Ve[ot],gt,Ve[ot+1]))}}else h.push(Be({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:x+1}));return h}function Gy(n,e){const i=n.stretchY||[[0,n.paddedRect.h-2*fh]];return e&&(n.stretchX||n.stretchY)?Tg(n.stretchX||[[0,n.paddedRect.w-2*fh]])*Tg(i):1}function B0(n,e,i){let a=0;for(const l of n)a+=Math.max(e,Math.min(i,l[1]))-Math.max(e,Math.min(i,l[0]));return a}function wg(n,e,i){const a=[{fixed:-fh,stretch:0}];for(const[l,h]of n){const f=a[a.length-1];a.push({fixed:l-f.stretch,stretch:f.stretch}),a.push({fixed:l-f.stretch,stretch:f.stretch+(h-l)})}return a.push({fixed:e+fh,stretch:i}),a}function Tg(n){return 2*n.length+1}function k0(n,e,i,a){return n/e*i+a}function N0(n,e,i,a){return n-e*i/a}function Hy(n,e,i,a){const l=e+n.positionedLines[a].lineOffset;return a===0?i+l/2:i+(l+(e+n.positionedLines[a-1].lineOffset))/2}function qy(n,e=1,i=!1){let a=1/0,l=1/0,h=-1/0,f=-1/0;const m=n[0];for(let R=0;R<m.length;R++){const D=m[R];(!R||D.x<a)&&(a=D.x),(!R||D.y<l)&&(l=D.y),(!R||D.x>h)&&(h=D.x),(!R||D.y>f)&&(f=D.y)}const v=Math.min(h-a,f-l);let x=v/2;const S=new zc([],Zy);if(v===0)return new nt(a,l);for(let R=a;R<h;R+=v)for(let D=l;D<f;D+=v)S.push(new Rp(R+x,D+x,x,n));let E=(function(R){let D=0,F=0,k=0;const U=R[0];for(let q=0,$=U.length,Y=$-1;q<$;Y=q++){const le=U[q],ne=U[Y],de=le.x*ne.y-ne.x*le.y;F+=(le.x+ne.x)*de,k+=(le.y+ne.y)*de,D+=3*de}return new Rp(F/D,k/D,0,R)})(n),A=S.length;for(;S.length;){const R=S.pop();(R.d>E.d||!E.d)&&(E=R,i&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,A)),R.max-E.d<=e||(x=R.h/2,S.push(new Rp(R.p.x-x,R.p.y-x,x,n)),S.push(new Rp(R.p.x+x,R.p.y-x,x,n)),S.push(new Rp(R.p.x-x,R.p.y+x,x,n)),S.push(new Rp(R.p.x+x,R.p.y+x,x,n)),A+=4)}return i&&(console.log(`num probes: ${A}`),console.log(`best distance: ${E.d}`)),E.p}function Zy(n,e){return e.max-n.max}class Rp{constructor(e,i,a,l){this.p=new nt(e,i),this.h=a,this.d=(function(h,f){let m=!1,v=1/0;for(let x=0;x<f.length;x++){const S=f[x];for(let E=0,A=S.length,R=A-1;E<A;R=E++){const D=S[E],F=S[R];D.y>h.y!=F.y>h.y&&h.x<(F.x-D.x)*(h.y-D.y)/(F.y-D.y)+D.x&&(m=!m),v=Math.min(v,yo(h,D,F))}}return(m?1:-1)*Math.sqrt(v)})(this.p,l),this.max=this.d+this.h*Math.SQRT2}}const Xy=Object.keys,j_=Number.POSITIVE_INFINITY,$y=Math.sqrt(2);function U0(n,e,i,a){const l=n.collisionPadding||[0,0,0,0],h={top:n.top-l[1],bottom:n.bottom+l[3],left:n.left-l[0],right:n.right+l[2],scaled:!1};return a!==void 0&&(function(f,m){f.top*=m,f.bottom*=m,f.left*=m,f.right*=m,f.scaled=!0})(h,a),i&&(function(f,m){if(!m)return;const v=Ui(m),x=new nt(f.left,f.top),S=new nt(f.right,f.top),E=new nt(f.left,f.bottom),A=new nt(f.right,f.bottom);x._rotateAround(v,new nt(0,0)),S._rotateAround(v,new nt(0,0)),E._rotateAround(v,new nt(0,0)),A._rotateAround(v,new nt(0,0)),f.left=Math.min(x.x,S.x,E.x,A.x),f.right=Math.max(x.x,S.x,E.x,A.x),f.top=Math.min(x.y,S.y,E.y,A.y),f.bottom=Math.max(x.y,S.y,E.y,A.y)})(h,i),e?{top:Math.min(e.top,h.top),bottom:Math.max(e.bottom,h.bottom),left:Math.min(e.left,h.left),right:Math.max(e.right,h.right),scaled:e.scaled||h.scaled}:h}function Sg(n,[e,i]){let a=0,l=0;if(i===j_){e<0&&(e=0);const h=e/$y;switch(n){case"top-right":case"top-left":l=h-7;break;case"bottom-right":case"bottom-left":l=7-h;break;case"bottom":l=7-e;break;case"top":l=e-7}switch(n){case"top-right":case"bottom-right":a=-h;break;case"top-left":case"bottom-left":a=h;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":l=i-7;break;case"bottom-right":case"bottom-left":case"bottom":l=7-i}switch(n){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,l]}function Wy(n,e,i,a,l,h,f,m,v,x,S){const E=n.layers[0],A=E.appearances;if(A.length===0)return{iconBBox:null,iconVerticalBBox:null};let R=null,D=null;const F=a.get("icon-rotate").evaluate(l,{},h);e&&(R=U0(e,R,F,f),i)&&(D=U0(i,D,F+90,f));const[k,U]=a.get("icon-size-scale-range"),q=G(1,k,U);for(const $ of A){const Y=$.getUnevaluatedProperties(),le=Y._values["icon-image"].value!==void 0,ne=Y._values["icon-size"].value!==void 0,de=Y._values["icon-offset"].value!==void 0,_e=Y._values["icon-rotate"].value!==void 0;if(le||ne||de||_e){const ye=de?E.getAppearanceValueAndResolveTokens($,"icon-offset",l,h,[]):null,Be=ye&&Array.isArray(ye)?ye:m,Ee=_e?E.getAppearanceValueAndResolveTokens($,"icon-rotate",l,h,[]):null,Ve=typeof Ee=="number"?Ee:F,Xe=ne?E.getAppearanceValueAndResolveTokens($,"icon-size",l,h,[]):null,tt=typeof Xe=="number"?Xe*v.iconScaleFactor:f;let gt=null,ot=null,Ye=null;if(le){const at=E.getAppearanceValueAndResolveTokens($,"icon-image",l,h,[]);if(at){const Fe=n.getResolvedImageFromTokens(at),Le=Y._values["icon-size"],rt=Cm(Fe,Ip(n.zoom,Le,n.worldview),Le,h,n.zoom,l,n.pixelRatio,q,n.worldview);Ye=x.get(rt.iconPrimary.toString())}}else e&&(Ye=e.imagePrimary);Ye&&(gt=F0(Ye,null,Be,S),n.allowVerticalPlacement&&(ot=F0(Ye,null,Be,S))),gt&&(R=U0(gt,R,Ve,tt)),ot&&(D=U0(ot,D,Ve+90,tt))}}return{iconBBox:R,iconVerticalBBox:D}}function V0(n,e,i,a,l,h,f,m,v){if(!e||!e.usvg)return;const x=hg(a),S=hg(l),E=h!=="both"&&h!=="width"||!cg(a)?1:S.width/x.width,A=h!=="both"&&h!=="height"||!ug(a)?1:S.height/x.height;i.scaleSelf(E,A);const R=i.toString();f.set(R,i),m.set(R,e);const{imagePosition:D}=N_(R,e,B1);v.set(R,D)}function Eg(n,e,i,a,l,h,f,m,v){if(!n)return;const x=(function(S,E,A,R,D,F){if(S.kind==="camera")return S.maxSize;if(S.kind==="composite"){const k=E.possiblyEvaluate(new mn(S.maxZoom,{worldview:F}),A).evaluate(D,{},A),U=E.possiblyEvaluate(new mn(S.minZoom,{worldview:F}),A).evaluate(D,{},A);return Math.max(k,U)}return E.possiblyEvaluate(new mn(R,{worldview:F})).evaluate(D,{},A)})(e,i,a,l,h,v);return n.scaleSelf(x*m*f)}function Cm(n,e,i,a,l,h,f,m,v){return{iconPrimary:Eg(n.getPrimary(),e,i,a,l,h,f,m,v),iconSecondary:Eg(n.getSecondary(),e,i,a,l,h,f,m,v)}}function Yy(n,e,i){if(!e)return;const a=i.get(n.toString()),l=i.get(e.toString());a&&l&&(a.paddedRect.w===l.paddedRect.w&&a.paddedRect.h===l.paddedRect.h||Gt(`Mismatch in icon variant sizes: ${n.toString()} and ${e.toString()}`),a.usvg!==l.usvg&&Gt(`Mismatch in icon variant image types: ${n.id} and ${e.id}`))}function Ag(n,e,i,a){if(!n)return;const l=e.get(i.toString());if(n.imagePrimary=l,a){const h=e.get(a.toString());n.imageSecondary=h}}function Ky(n,e){for(const i in n.horizontal)Mg(n.horizontal[i],e);Mg(n.vertical,e)}function Mg(n,e){if(n){for(const i of n.positionedLines)for(const a of i.positionedGlyphs)if(a.image!==null){const l=a.image.toString();a.rect=e.get(l).paddedRect}}}function G_(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Jy(n,e,i,a,l,h,f,m,v){const x=H_(h.horizontal)||h.vertical,S=i.get("icon-text-fit-padding").evaluate(a,{},l);let E,A=e;return e&&v!=="none"&&(n.allowVerticalPlacement&&h.vertical&&(E=B_(e,h.vertical,v,S,m,f)),x&&(A=B_(e,x,v,S,m,f))),{defaultShapedIcon:A,verticallyShapedIcon:E}}function Qy(n,e,i,a,l,h,f,m,v,x,S,E,A,R,D,F,k,U,q,$,Y,le){let ne=f.textMaxSize.evaluate(e,{},A);ne===void 0?ne=m*f.textScaleFactor:ne*=f.textScaleFactor;const de=n.layers[0].layout,_e=Ca,ye=m*f.textScaleFactor/_e,Be=H_(i.horizontal)||i.vertical;if(k!=="none"&&n.appearanceFeatureData&&e.index<n.appearanceFeatureData.length){const Ke=n.appearanceFeatureData[e.index];Ke&&(Ke.textShaping=Be,Ke.iconTextFitPadding=de.get("icon-text-fit-padding").evaluate(e,{},A),Ke.fontScale=ye)}const Ee=R.name==="globe",Ve=n.tilePixelRatio*ne/_e,Xe=(Fe=n.overscaling,n.zoom>18&&Fe>2&&(Fe>>=1),Math.max(pt/(512*Fe),1)*de.get("symbol-spacing")),tt=de.get("text-padding")*n.tilePixelRatio,gt=de.get("icon-padding")*n.tilePixelRatio,ot=Ui(de.get("text-max-angle")),Ye=de.get("icon-rotation-alignment")==="map"&&$!=="point",at=Xe/2;var Fe;n.hasAnyIconTextFit===!1&&k!=="none"&&(n.hasAnyIconTextFit=!0);const Le=e.properties?+e.properties[St]:null,rt=Le&&n.elevationFeatureIdToIndex?n.elevationFeatureIdToIndex.get(Le):65535,mt=(Ke,Lt,Nt)=>{if(Lt.x<0||Lt.x>=pt||Lt.y<0||Lt.y>=pt)return;let zt=null;if(Ee){const{x:Et,y:ui,z:Ct}=R.projectTilePoint(Lt.x,Lt.y,Nt);zt={anchor:new vd(Et,ui,Ct,0,void 0),up:R.upVector(Nt,Lt.x,Lt.y)}}(function(Et,ui,Ct,Yt,pi,Ii,tn,vi,cn,un,dr,re,ee,He,bt,qe,At,Zt,Ht,bi,ni,Vt,sn,In,ai,Wi,Cn,bn,xr,tr,Nn){const Sn=Et.addToLineVertexArray(ui,Yt);let hn,wi,dn,Un,ri,nn,ir,Cr=0,Dr=0,Qr=0,nr=0,qr=-1,is=-1;const Zr={};let bs=yc("");const Za=Ct?Ct.anchor:ui,Pl=bn!=="none";let ns=0,ws=0;if(cn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const za=cn.layout.get("text-offset").evaluate(ni,{},ai);ns=za[0]*Ca,ws=za[1]*Ca}else ns=cn.layout.get("text-radial-offset").evaluate(ni,{},ai)*Ca,ws=j_;if(Et.allowVerticalPlacement&&pi.vertical){const za=pi.vertical;if(bt)nn=q_(za),vi&&(ir=q_(vi));else{const bo=cn.layout.get("text-rotate").evaluate(ni,{},ai)+90;dn=j0(un,Za,ui,dr,re,ee,za,He,bo,qe),vi&&(Un=j0(un,Za,ui,dr,re,ee,vi,Zt,bo,null,Nn))}}if(Ii){const za=Et.iconSizeData,bo=cn.layout.get("icon-rotate").evaluate(ni,{},ai),ph=V_(Ii,bo,sn,Pl,Vt.iconScaleFactor),Pf=vi?V_(vi,bo,sn,Pl,Vt.iconScaleFactor):void 0;wi=j0(un,Za,ui,dr,re,ee,Ii,Zt,bo,null,tr);const kp=(function(mh,a_,Np,d6,Z3,X3,f6,p6){const $3=mh.layers[0],W3=$3.appearances;let Up=a_.length;if(Np&&(Up=Math.max(Up,Np.length)),W3.length===0)return Up;const[m6,_6]=d6.get("icon-size-scale-range"),g6=G(1,m6,_6);for(const Y3 of W3){const K3=Y3.getUnevaluatedProperties();if(K3._values["icon-image"].value!==void 0){const J3=$3.getAppearanceValueAndResolveTokens(Y3,"icon-image",Z3,X3,[]);if(J3){const Q3=mh.getResolvedImageFromTokens(J3);if(Q3){const e4=K3._values["icon-size"],y6=Cm(Q3,Ip(mh.zoom,e4,mh.worldview),e4,X3,mh.zoom,Z3,mh.pixelRatio,g6,mh.worldview),v6=f6.get(y6.iconPrimary.toString());Up=Math.max(Up,Gy(v6,p6))}}}}return Up})(Et,ph,Pf,cn.layout,ni,ai,Et.iconAtlasPositions,Pl);Cr=4*kp;let Lf=null;za.kind==="source"?(Lf=[fu*cn.layout.get("icon-size").evaluate(ni,{},ai)*Vt.iconScaleFactor],Lf[0]>xd&&Gt(`${Et.layerIds[0]}: Value for "icon-size" is >= ${zm}. Reduce your "icon-size".`)):za.kind==="composite"&&(Lf=[fu*Vt.compositeIconSizes[0].evaluate(ni,{},ai)*Vt.iconScaleFactor,fu*Vt.compositeIconSizes[1].evaluate(ni,{},ai)*Vt.iconScaleFactor],(Lf[0]>xd||Lf[1]>xd)&&Gt(`${Et.layerIds[0]}: Value for "icon-size" is >= ${zm}. Reduce your "icon-size".`)),Et.addSymbols(Et.icon,ph,Lf,bi,Ht,ni,void 0,Ct,ui,Sn.lineStartIndex,Sn.lineLength,-1,In,ai,Wi,Cn,Et.symbolInstances.length,kp),qr=Et.icon.placedSymbolArray.length-1,Pf&&(Dr=4*kp,Et.addSymbols(Et.icon,Pf,Lf,bi,Ht,ni,xs.vertical,Ct,ui,Sn.lineStartIndex,Sn.lineLength,-1,In,ai,Wi,Cn,Et.symbolInstances.length,kp),is=Et.icon.placedSymbolArray.length-1)}for(const za in pi.horizontal){const bo=za,ph=pi.horizontal[bo];hn||(bs=yc(ph.text),bt?ri=q_(ph):hn=j0(un,Za,ui,dr,re,ee,ph,He,cn.layout.get("text-rotate").evaluate(ni,{},ai),qe));const Pf=ph.positionedLines.length===1;if(Qr+=Ig(Et,Ct,ui,ph,tn,cn,bt,ni,qe,Sn,pi.vertical?xs.horizontal:xs.horizontalOnly,Pf?Xy(pi.horizontal):[bo],Zr,qr,Vt,In,ai,Et.symbolInstances.length,Wi),Pf)break}pi.vertical&&(nr+=Ig(Et,Ct,ui,pi.vertical,tn,cn,bt,ni,qe,Sn,xs.vertical,["vertical"],Zr,is,Vt,In,ai,Et.symbolInstances.length,Wi));let Xa=-1;const Ts=(za,bo)=>za?Math.max(za,bo):bo;Xa=Ts(ri,Xa),Xa=Ts(nn,Xa),Xa=Ts(ir,Xa);const Ll=Xa>-1?1:0;Et.glyphOffsetArray.length>=65535&&Gt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ni.sortKey!==void 0&&Et.addToSortKeyRanges(Et.symbolInstances.length,ni.sortKey),Et.symbolInstances.emplaceBack(ui.x,ui.y,Za.x,Za.y,Za.z,Zr.right>=0?Zr.right:-1,Zr.center>=0?Zr.center:-1,Zr.left>=0?Zr.left:-1,Zr.vertical>=0?Zr.vertical:-1,qr,is,bs,hn!==void 0?hn:Et.collisionBoxArray.length,hn!==void 0?hn+1:Et.collisionBoxArray.length,dn!==void 0?dn:Et.collisionBoxArray.length,dn!==void 0?dn+1:Et.collisionBoxArray.length,wi!==void 0?wi:Et.collisionBoxArray.length,wi!==void 0?wi+1:Et.collisionBoxArray.length,Un||Et.collisionBoxArray.length,Un?Un+1:Et.collisionBoxArray.length,dr,Qr,nr,Cr,Dr,Ll,0,ns,ws,Xa,0,Pl?1:0,xr)})(n,Lt,zt,Ke,i,a,h,l,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,tt,q,x,0,gt,Ye,U,e,f,S,E,A,D,F,k,rt,Y,le)};if($==="line")for(const Ke of hu(e.geometry,0,0,pt,pt)){const Lt=jy(Ke,Xe,ot,i.vertical||Be,a,_e,Ve,n.overscaling,pt);for(const Nt of Lt)Be&&e5(n,Be.text,at,Nt)||mt(Ke,Nt,A)}else if($==="line-center"){for(const Ke of e.geometry)if(Ke.length>1){const Lt=Vy(Ke,ot,i.vertical||Be,a,_e,Ve);Lt&&mt(Ke,Lt,A)}}else if(e.type==="Polygon")for(const Ke of pd(e.geometry,0)){const Lt=qy(Ke,16);mt(Ke[0],new vd(Lt.x,Lt.y,0,0,void 0),A)}else if(e.type==="LineString")for(const Ke of e.geometry)mt(Ke,new vd(Ke[0].x,Ke[0].y,0,0,void 0),A);else if(e.type==="Point")for(const Ke of e.geometry)for(const Lt of Ke)mt([Lt],new vd(Lt.x,Lt.y,0,0,void 0),A)}const zm=255,xd=zm*fu;function Ig(n,e,i,a,l,h,f,m,v,x,S,E,A,R,D,F,k,U,q){const $=(function(ne,de,_e,ye,Be,Ee,Ve,Xe){const tt=[];if(de.positionedLines.length===0)return tt;const gt=ye.layout.get("text-rotate").evaluate(Ee,{})*Math.PI/180,ot=(function(rt){const mt=rt[0],Ke=rt[1],Lt=mt*Ke;return Lt>0?[mt,-Ke]:Lt<0?[-mt,Ke]:mt===0?[Ke,mt]:[Ke,-mt]})(_e);let Ye=Math.abs(de.top-de.bottom);for(const rt of de.positionedLines)Ye-=rt.lineOffset;const at=de.positionedLines.length,Fe=Ye/at;let Le=de.top-_e[1];for(let rt=0;rt<at;++rt){const mt=de.positionedLines[rt];Le=Hy(de,Fe,Le,rt);for(const Ke of mt.positionedGlyphs){if(!Ke.rect)continue;const Lt=Ke.rect||{};let Nt=ig+1,zt=!0,Et=1,ui=0;if(Ke.image){const Ht=Ve.get(Ke.image.toString());if(!Ht)continue;if(Ht.sdf){Gt("SDF images are not supported in formatted text and will be ignored.");continue}zt=!1,Et=Ht.pixelRatio,Nt=B1/Et}const Ct=(Be||Xe)&&Ke.vertical,Yt=Ke.metrics.advance*Ke.scale/2,pi=Ke.metrics,Ii=Ke.rect;if(Ii===null)continue;Xe&&de.verticalizable&&(ui=Ke.image?Yt-Ke.metrics.width*Ke.scale/2:0);const tn=Be?[Ke.x+Yt,Ke.y]:[0,0];let vi=[0,0],cn=[0,0],un=!1;Be||(Ct?(cn=[Ke.x+Yt+ot[0],Ke.y+ot[1]-ui],un=!0):vi=[Ke.x+Yt+_e[0],Ke.y+_e[1]-ui]);const dr=Ii.w*Ke.scale/(Et*(Ke.localGlyph?pu:1)),re=Ii.h*Ke.scale/(Et*(Ke.localGlyph?pu:1));let ee,He,bt,qe;if(Ct){const Ht=Ke.y-Le,bi=new nt(-Yt,Yt-Ht),ni=-Math.PI/2,Vt=new nt(...cn);ee=new nt(-Yt+vi[0],vi[1]),ee._rotateAround(ni,bi)._add(Vt),ee.x+=-Ht+Yt,ee.y-=(pi.left-Nt)*Ke.scale;const sn=Ke.image?pi.advance*Ke.scale:Ca*Ke.scale,In=String.fromCodePoint(Ke.glyph);Ey(In)?ee.x+=(1-Nt)*Ke.scale:Ay(In)?ee.x+=sn-pi.height*Ke.scale+(-Nt-1)*Ke.scale:ee.x+=Ke.image||pi.width+2*Nt===Ii.w&&pi.height+2*Nt===Ii.h?(sn-re)/2:(sn-(pi.height+2*Nt)*Ke.scale)/2,He=new nt(ee.x,ee.y-dr),bt=new nt(ee.x+re,ee.y),qe=new nt(ee.x+re,ee.y-dr)}else{const Ht=(pi.left-Nt)*Ke.scale-Yt+vi[0],bi=(-pi.top-Nt)*Ke.scale+vi[1],ni=Ht+dr,Vt=bi+re;ee=new nt(Ht,bi),He=new nt(ni,bi),bt=new nt(Ht,Vt),qe=new nt(ni,Vt)}if(gt){let Ht;Ht=Be?new nt(0,0):un?new nt(ot[0],ot[1]):new nt(_e[0],_e[1]),ee._rotateAround(gt,Ht),He._rotateAround(gt,Ht),bt._rotateAround(gt,Ht),qe._rotateAround(gt,Ht)}const At=new nt(0,0),Zt=new nt(0,0);tt.push({tl:ee,tr:He,bl:bt,br:qe,texPrimary:Lt,texSecondary:void 0,writingMode:de.writingMode,glyphOffset:tn,sectionIndex:Ke.sectionIndex,isSDF:zt,pixelOffsetTL:At,pixelOffsetBR:Zt,minFontScaleX:0,minFontScaleY:0})}}return tt})(0,a,v,h,f,m,l,n.allowVerticalPlacement),Y=n.textSizeData;let le=null;Y.kind==="source"?(le=[fu*h.layout.get("text-size").evaluate(m,{},k)*D.textScaleFactor],le[0]>xd&&Gt(`${n.layerIds[0]}: Value for "text-size" is >= ${zm}. Reduce your "text-size".`)):Y.kind==="composite"&&(le=[fu*D.compositeTextSizes[0].evaluate(m,{},k)*D.textScaleFactor,fu*D.compositeTextSizes[1].evaluate(m,{},k)*D.textScaleFactor],(le[0]>xd||le[1]>xd)&&Gt(`${n.layerIds[0]}: Value for "text-size" is >= ${zm}. Reduce your "text-size".`)),n.addSymbols(n.text,$,le,v,f,m,S,e,i,x.lineStartIndex,x.lineLength,R,F,k,q,!1,U,$.length);for(const ne of E)A[ne]=n.text.placedSymbolArray.length-1;return 4*$.length}function H_(n){for(const e in n)return n[e];return null}function j0(n,e,i,a,l,h,f,m,v,x,S){let E,A,R,D;if(E=S?S.top:f.top,A=S?S.bottom:f.bottom,R=S?S.left:f.left,D=S?S.right:f.right,lg(f)&&f.collisionPadding){const F=f.collisionPadding;R-=F[0],E-=F[1],D+=F[2],A+=F[3]}if(v){const F=new nt(R,E),k=new nt(D,E),U=new nt(R,A),q=new nt(D,A),$=Ui(v);let Y=new nt(0,0);x&&(Y=new nt(x[0],x[1])),F._rotateAround($,Y),k._rotateAround($,Y),U._rotateAround($,Y),q._rotateAround($,Y),R=Math.min(F.x,k.x,U.x,q.x),D=Math.max(F.x,k.x,U.x,q.x),E=Math.min(F.y,k.y,U.y,q.y),A=Math.max(F.y,k.y,U.y,q.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,R,E,D,A,m,a,l,h),n.length-1}function q_(n){lg(n)&&n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function e5(n,e,i,a){const l=n.compareText;if(e in l){const h=l[e];for(let f=h.length-1;f>=0;f--)if(a.dist(h[f])<i)return!0}else l[e]=[];return l[e].push(a),!1}function Cg(n,e){const i=n.fovAboveCenter,a=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,l=(n._camera.position[2]*n.worldSize-a)/Math.cos(n._pitch),h=Math.sin(i)*l/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01));let f=Math.sin(n._pitch)*h+l;const m=l*(1/n._horizonShift);if(!n.elevation||n.elevation.exaggeration()===0){let v=Math.max(n.zoom-17,0);n.isOrthographic&&(v/=10),f*=1+v}return Math.min(1.01*f,m)}function Rm(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),a=n.x*i,l=(n.x+1)*i,h=n.y*i,f=(n.y+1)*i,m=K(a),v=K(l),x=W(h),S=W(f),E=e.project(m,x),A=e.project(v,x),R=e.project(v,S),D=e.project(m,S);let F=Math.min(E.x,A.x,R.x,D.x),k=Math.min(E.y,A.y,R.y,D.y),U=Math.max(E.x,A.x,R.x,D.x),q=Math.max(E.y,A.y,R.y,D.y);const $=i/16;function Y(ne,de,_e,ye,Be,Ee){const Ve=(_e+Be)/2,Xe=(ye+Ee)/2,tt=e.project(K(Ve),W(Xe)),gt=Math.max(0,F-tt.x,k-tt.y,tt.x-U,tt.y-q);F=Math.min(F,tt.x),U=Math.max(U,tt.x),k=Math.min(k,tt.y),q=Math.max(q,tt.y),gt>$&&(Y(ne,tt,_e,ye,Ve,Xe),Y(tt,de,Ve,Xe,Be,Ee))}Y(E,A,a,h,l,h),Y(A,R,l,h,l,f),Y(R,D,l,f,a,f),Y(D,E,a,f,a,h),F-=$,k-=$,U+=$,q+=$;const le=1/Math.max(U-F,q-k);return{scale:le,x:F*le,y:k*le,x2:U*le,y2:q*le,projection:e}}function zg(n,{x:e,y:i},a=0){return new nt(((e-a)*n.scale-n.x)*pt,(i*n.scale-n.y)*pt)}const t5=$i(new Float32Array(16));class Rf{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new P(0,0)}projectTilePoint(e,i,a){return{x:e,y:i,z:0}}locationPoint(e,i,a,l=!0){return e._coordinatePoint(e.locationCoordinate(i,a),l)}pixelsPerMeter(e,i){return Z(1,e)*i}pixelSpaceConversion(e,i,a){return 1}farthestPixelDistance(e){return Cg(e,e.pixelsPerMeter)}pointCoordinate(e,i,a,l){const h=e.horizonLineFromTop(!1),f=new nt(i,Math.max(h,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,l))}pointCoordinate3D(e,i,a){const l=new nt(i,a);if(e.elevation)return e.elevation.pointCoordinate(l);{const h=this.pointCoordinate(e,l.x,l.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const a=e.horizonLineFromTop();return i.y<a}createInversionMatrix(e,i){return t5}createTileMatrix(e,i,a){let l,h,f;const m=a.canonical,v=$i(new Float64Array(16));if(this.isReprojectedInTileSpace){const x=Rm(m,this);l=1,h=x.x+a.wrap*x.scale,f=x.y,si(v,v,[l/x.scale,l/x.scale,e.pixelsPerMeter/i])}else l=i/e.zoomScale(m.z),h=(m.x+Math.pow(2,m.z)*a.wrap)*l,f=m.y*l;return ki(v,v,[h,f,0]),si(v,v,[l/pt,l/pt,1]),v}upVector(e,i,a){return[0,0,1]}upVectorScale(e,i,a){return{metersToTile:1}}}class i5 extends Rf{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,a]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(Ui(i));this.n=(l+Math.sin(Ui(a)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:a,c:l,r0:h}=this,f=Ui(e-this.center[0]),m=Ui(i),v=Math.sqrt(l-2*a*Math.sin(m))/a;return{x:v*Math.sin(f*a),y:v*Math.cos(f*a)-h,z:0}}unproject(e,i){const{n:a,c:l,r0:h}=this,f=h+i;let m=Math.atan2(e,Math.abs(f))*Math.sign(f);f*a<0&&(m-=Math.PI*Math.sign(e)*Math.sign(f));const v=Ui(this.center[0])*a;m=pe(m,-Math.PI-v,Math.PI-v);const x=G(pa(m/a)+this.center[0],-180,180),S=Math.asin(G((l-(e*e+f*f)*a*a)/(2*a),-1,1)),E=G(pa(S),-Q,Q);return new P(x,E)}}const Dm=1.340264,Pm=-.081106,Lm=893e-6,Om=.003796,G0=Math.sqrt(3)/2;class n5 extends Rf{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(G0*Math.sin(i)),l=a*a,h=l*l*l;return{x:.5*(e*Math.cos(a)/(G0*(Dm+3*Pm*l+h*(7*Lm+9*Om*l)))/Math.PI+.5),y:1-.5*(a*(Dm+Pm*l+h*(Lm+Om*l))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,l=a*a,h=l*l*l;for(let S,E,A,R=0;R<12&&(E=a*(Dm+Pm*l+h*(Lm+Om*l))-i,A=Dm+3*Pm*l+h*(7*Lm+9*Om*l),S=E/A,a=G(a-S,-Math.PI/3,Math.PI/3),l=a*a,h=l*l*l,!(Math.abs(S)<1e-12));++R);const f=G0*e*(Dm+3*Pm*l+h*(7*Lm+9*Om*l))/Math.cos(a),m=Math.asin(Math.sin(a)/G0),v=G(180*f/Math.PI,-180,180),x=G(180*m/Math.PI,-Q,Q);return new P(v,x)}}class r5 extends Rf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const a=360*(e-.5),l=G(360*(.5-i),-Q,Q);return new P(a,l)}}const Dp=Math.PI/2;function H0(n){return Math.tan((Dp+n)/2)}class a5 extends Rf{constructor(e){super(e),this.center=e.center||[0,30];const[i,a]=this.parallels=e.parallels||[30,30];let l=Ui(i),h=Ui(a);this.southernCenter=l+h<0,this.southernCenter&&(l=-l,h=-h);const f=Math.cos(l),m=H0(l);this.n=l===h?Math.sin(l):Math.log(f/Math.cos(h))/Math.log(H0(h)/m),this.f=f*Math.pow(H0(l),this.n)/this.n}project(e,i){i=Ui(i),this.southernCenter&&(i=-i),e=Ui(e-this.center[0]);const a=1e-6,{n:l,f:h}=this;h>0?i<-Dp+a&&(i=-Dp+a):i>Dp-a&&(i=Dp-a);const f=h/Math.pow(H0(i),l);let m=f*Math.sin(l*e),v=h-f*Math.cos(l*e);return m=.5*(m/Math.PI+.5),v=.5*(v/Math.PI+.5),{x:m,y:this.southernCenter?v:1-v,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:a,f:l}=this,h=l-i,f=Math.sign(h),m=Math.sign(a)*Math.sqrt(e*e+h*h);let v=Math.atan2(e,Math.abs(h))*f;h*a<0&&(v-=Math.PI*Math.sign(e)*f);const x=G(pa(v/a)+this.center[0],-180,180),S=G(pa(2*Math.atan(Math.pow(l/m,1/a))-Dp),-Q,Q);return new P(x,this.southernCenter?-S:S)}}class Rg extends Rf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:H(e),y:j(i),z:0}}unproject(e,i){const a=K(e),l=W(i);return new P(a,l)}}const Dg=Ui(Q);class o5 extends Rf{project(e,i){const a=(i=Ui(i))*i,l=a*a;return{x:.5*((e=Ui(e))*(.8707-.131979*a+l*(l*(.003971*a-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+a*(.015085+l*(.028874*a-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,l=25,h=0,f=a*a;do{f=a*a;const x=f*f;h=(a*(1.007226+f*(.015085+x*(.028874*f-.044475-.005916*x)))-i)/(1.007226+f*(.045255+x*(.259866*f-.311325-.005916*11*x))),a=G(a-h,-Dg,Dg)}while(Math.abs(h)>1e-6&&--l>0);f=a*a;const m=G(pa(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),v=pa(a);return new P(m,v)}}const Pg=Ui(Q);class s5 extends Rf{project(e,i){i=Ui(i),e=Ui(e);const a=Math.cos(i),l=2/Math.PI,h=Math.acos(a*Math.cos(e/2)),f=Math.sin(h)/h,m=.5*(e*l+2*a*Math.sin(e/2)/f)||0,v=.5*(i+Math.sin(i)/f)||0;return{x:.5*(m/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}}unproject(e,i){let a=e=(2*e-.5)*Math.PI,l=i=(2*(1-i)-1)*Math.PI,h=25;const f=1e-6;let m=0,v=0;do{const x=Math.cos(l),S=Math.sin(l),E=2*S*x,A=S*S,R=x*x,D=Math.cos(a/2),F=Math.sin(a/2),k=2*D*F,U=F*F,q=1-R*D*D,$=q?1/q:0,Y=q?Math.acos(x*D)*Math.sqrt(1/q):0,le=.5*(2*Y*x*F+2*a/Math.PI)-e,ne=.5*(Y*S+l)-i,de=.5*$*(R*U+Y*x*D*A)+1/Math.PI,_e=$*(k*E/4-Y*S*F),ye=.125*$*(E*F-Y*S*R*k),Be=.5*$*(A*D+Y*U*x)+.5,Ee=_e*ye-Be*de;m=(ne*_e-le*Be)/Ee,v=(le*ye-ne*de)/Ee,a=G(a-m,-Math.PI,Math.PI),l=G(l-v,-Pg,Pg)}while((Math.abs(m)>f||Math.abs(v)>f)&&--h>0);return new P(pa(a),pa(l))}}class Lg extends Rf{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ui(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:a,cosPhi:l}=this;return{x:Ui(e)*l*a+.5,y:-Math.sin(Ui(i))/l*a+.5,z:0}}unproject(e,i){const{scale:a,cosPhi:l}=this,h=-(i-.5)/a,f=G(pa((e-.5)/a)/l,-180,180),m=Math.asin(G(h*l,-1,1)),v=G(pa(m),-Q,Q);return new P(f,v)}}class l5 extends Rg{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,a){const l=p1(e,i,a);return sr(l,l,nu(Cl(a))),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,i,a){const l=T(i.lat,i.lng),h=Li([],l),f=a?e._centerAltitude+a:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;gi(l,l,h,Z(1,0)*pt*f);const m=$i(new Float64Array(16));return Ci(m,e.pixelMatrix,e.globeMatrix),sr(l,l,m),new nt(l[0],l[1])}pixelsPerMeter(e,i){return Z(1,0)*i}pixelSpaceConversion(e,i,a){const l=Z(1,e)*i,h=ti(Z(1,45)*i,l,a);return this.pixelsPerMeter(e,i)/h}createTileMatrix(e,i,a){const l=_1(Cl(a.canonical));return Ci(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,i){const{center:a}=e,l=nu(Cl(i));return mr(l,l,Ui(a.lng)),_n(l,l,Ui(a.lat)),si(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,i,a,l){return Zp(e,i,a,!0)||new we(0,0)}pointCoordinate3D(e,i,a){const l=this.pointCoordinate(e,i,a,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,i){return!Zp(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=(function(l,h){const f=l.cameraToCenterDistance,m=l._centerAltitude*h,v=l._camera,x=l._camera.forward(),S=_i([],qt([],x,-f),[0,0,m]),E=l.worldSize/(2*Math.PI),A=[0,0,-E],R=l.width/l.height,D=Math.tan(l.fovAboveCenter),F=qt([],v.up(),D),k=qt([],v.right(),D*R),U=Li([],_i([],_i([],x,F),k)),q=[];let $;if(new oi(S,U).closestPointOnSphere(A,E,q)){const Y=_i([],q,A),le=Sr([],Y,S);$=Math.cos(l.fovAboveCenter)*zr(le)}else{const Y=Sr([],S,A),le=Sr([],A,S);Li(le,le);const ne=zr(Y)-E;$=Math.sqrt(ne*(ne+2*E));const de=Math.acos($/(E+ne))-Math.acos(br(x,le));$*=Math.cos(de)}return 1.01*$})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=eo(e.zoom);if(a>0){const l=Cg(e,Z(1,e.center.lat)*e.worldSize),h=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ti(i,l+h*(1-Math.cos(f)),Math.pow(a,10))}return i}upVector(e,i,a){return p1(i,a,e,1)}upVectorScale(e){return{metersToTile:d1(sp(Cl(e)))}}}function Og(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new Rg(n);case"equirectangular":return new r5(n);case"naturalEarth":return new o5(n);case"equalEarth":return new n5(n);case"winkelTripel":return new s5(n);case"albers":return i?new Lg(n):new i5(n);case"lambertConformalConic":return i?new Lg(n):new a5(n);case"globe":return new l5(n)}throw new Error(`Invalid projection name: ${n.name}`)}const c5=it.types,u5=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Fm(n,e,i,a,l,h,f,m,v,x,S,E,A){const R=m?Math.min(xd,Math.round(m[0])):0,D=m?Math.min(xd,Math.round(m[1])):0;n.emplaceBack(e,i,Math.round(32*a),Math.round(32*l),h,f,(R<<1)+(v?1:0),0+(D<<1),16*x,16*S,256*E,256*A)}function Bm(n,e,i){n.emplaceBack(e,i)}function km(n,e,i,a,l,h,f){n.emplaceBack(e,i,a,l,h,f)}const q0=(n,e,i,a)=>{for(let l=0;l<e;l++)n.emplaceBack(i[0],i[1],i[2],a[0],a[1],a[2])};function Pp(n,e,i,a,l){n.emplaceBack(e,i,a,l),n.emplaceBack(e,i,a,l),n.emplaceBack(e,i,a,l),n.emplaceBack(e,i,a,l)}function h5(n){for(const e of n.sections)if(Y1(e.text))return!0;return!1}class Z_{constructor(e){this.layoutVertexArray=new Wc,this.indexArray=new Hn,this.programConfigurations=e,this.segments=new $n,this.dynamicLayoutVertexArray=new Ml,this.opacityVertexArray=new Kc,this.placedSymbolArray=new th,this.iconTransitioningVertexArray=new Po,this.globeExtVertexArray=new Yc,this.zOffsetVertexArray=new tl,this.orientationVertexArray=new Kd,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,i){const a=[],l=this.layoutVertexArray.uint16;for(let h=0;h<i;++h){const f=12*(e+h);a.push(...l.slice(f,f+12))}return a}updateIconVertexData(e,i,a,l,h,f,m,v,x,S,E,A,R){const D=this.layoutVertexArray.uint16,F=12*e;D[F]=i,D[F+1]=a,D[F+2]=l,D[F+3]=h,D[F+4]=f,D[F+5]=m,D[F+6]=v,D[F+7]=x,D[F+8]=S,D[F+9]=E,D[F+10]=A,D[F+11]=R}upload(e,i,a,l,h,f){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,my.members,!!f),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,gy.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,u5,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,xy.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,_y.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,yy.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,vy.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}st(Z_,"SymbolBuffers");class X_{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new $n,this.collisionVertexArray=new sc,this.collisionVertexArrayExt=new Ml}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,by.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,wy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}st(X_,"CollisionBuffers");class Z0{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((f=>f.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=$i([]),this.placementViewportMatrix=$i([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=Ip(this.zoom,i["text-size"],this.worldview),this.iconSizeData=Ip(this.zoom,i["icon-size"],this.worldview);const a=this.layers[0].layout,l=a.get("symbol-sort-key"),h=a.get("symbol-z-order");this.lut=e.lut,this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map((f=>xs[f])),this.stateDependentLayerIds=this.layers.filter((f=>f.isStateDependent())).map((f=>f.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(e){const i=this.layers[0].getAppearances();return!(!i||i.length===0)&&i.some((a=>a.getProperty(e)!=null))}createArrays(){this.text=new Z_(new Qo(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("text")||e.startsWith("symbol")))),this.icon=new Z_(new Qo(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("icon")||e.startsWith("symbol")))),this.glyphOffsetArray=new ih,this.lineVertexArray=new t1,this.symbolInstances=new e1}calculateGlyphDependencies(e,i,a,l,h){for(const f of e){const m=f.codePointAt(0);if(m===void 0)break;if(i[m]=!0,l&&h&&m<=65535){const v=Em[f];v&&(i[v.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,i,a,l,h,f){let m=1;const v=e.getUnevaluatedProperties()._values["icon-size"],x=Ip(this.zoom,v,this.worldview),S=Cp(x,i);if(x.kind!=="constant"&&x.kind!=="camera"||(m=S.uSize),x.kind==="composite"){const{minZoom:E,maxZoom:A}=x,R=v.possiblyEvaluate(new mn(E,{worldview:this.worldview}),l),D=v.possiblyEvaluate(new mn(A,{worldview:this.worldview}),l),F=R.evaluate(a,{},l,h);m=F+(D.evaluate(a,{},l,h)-F)*S.uSizeT}return x.kind==="source"&&(m=v.possiblyEvaluate(new mn(this.zoom,{worldview:this.worldview}),l).evaluate(a,{},l,h)),m*f}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!E1(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?la.build(e):e}populate(e,i,a,l){const h=this.layers[0],f=h.layout,m=this.projection.name==="globe",v=f.get("text-font"),x=f.get("text-field"),S=f.get("icon-image"),[E,A]=f.get("icon-size-scale-range"),R=G(i.scaleFactor||1,E,A),D=(x.value.kind!=="constant"||x.value.value instanceof $r&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),F=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,k=this.hasAnyAppearanceProperty("icon-image"),U=f.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!D&&!F&&!k)return;const q=i.iconDependencies,$=i.glyphDependencies,Y=i.availableImages,le=new mn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),ne=de=>{const _e=de.id.toString();q.has(_e)?q.get(_e).push(de):q.set(_e,[de])};for(const de of e){const{feature:_e,id:ye,index:Be,sourceLayerIndex:Ee}=de,Ve=h._featureFilter.needGeometry,Xe=Re(_e,Ve);if(!h._featureFilter.filter(le,Xe,a))continue;if(Ve||(Xe.geometry=Ge(_e,a,l)),m&&_e.type!==1&&a.z<=5){const rt=Xe.geometry,mt=.98078528056,Ke=(Lt,Nt)=>br(p1(Lt.x,Lt.y,a,1),p1(Nt.x,Nt.y,a,1))<mt;for(let Lt=0;Lt<rt.length;Lt++)rt[Lt]=je(rt[Lt],Ke)}let tt,gt;if(D){const rt=h.getValueAndResolveTokens("text-field",Xe,a,Y),mt=$r.factory(rt);h5(mt)&&(this.hasRTLText=!0),(!this.hasRTLText||Vc()==="unavailable"||this.hasRTLText&&Ha.isParsed())&&(tt=Sy(mt,h,Xe))}if(F){const rt=h.getValueAndResolveTokens("icon-image",Xe,a,Y);gt=this.getResolvedImageFromTokens(rt)}const ot=this.layers[0];let Ye=!1;if(!gt&&k){const rt=ot.getAppearances();for(const mt of rt)if(mt.getProperty("icon-image")){const Ke=ot.getAppearanceValueAndResolveTokens(mt,"icon-image",Xe,a,Y);if(Ke){gt=this.getResolvedImageFromTokens(Ke),Ye=!0;break}}}if(!tt&&!gt)continue;const at=this.sortFeaturesByKey?U.evaluate(Xe,{},a):void 0,Fe={id:ye,text:tt,icon:gt,index:Be,sourceLayerIndex:Ee,geometry:Xe.geometry,properties:_e.properties,type:c5[_e.type],sortKey:at};if(this.features.push(Fe),this.appearanceFeatureData.push({id:ye,properties:_e.properties,usesAppearanceIconAsPlaceholder:Ye,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),gt){const rt=ot._unevaluatedLayout._values,{iconPrimary:mt,iconSecondary:Ke}=Cm(gt,this.iconSizeData,rt["icon-size"],a,this.zoom,Fe,this.pixelRatio,R,this.worldview);ne(mt),Ke&&(this.hasAnySecondaryIcon=!0,ne(Ke))}const Le=ot.getAppearances();if(Le.length!==0&&Le.forEach((rt=>{if(!rt.getProperty("icon-image"))return;const mt=this.getCombinedIconPrimary(rt,ot,Xe,a,Y,Fe,R);mt&&ne(mt)})),tt){const rt=v.evaluate(Xe,{},a).join(","),mt=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(xs.vertical)>=0;for(const Ke of tt.sections)if(Ke.image){const Lt=Ke.image.getPrimary().scaleSelf(this.pixelRatio),Nt=Lt.id.toString(),zt=q.get(Nt)||[];zt.push(Lt),q.set(Nt,zt)}else{const Lt=$u(tt.toString()),Nt=Ke.fontStack||rt,zt=$[Nt]=$[Nt]||{};this.calculateGlyphDependencies(Ke.text,zt,mt,this.allowVerticalPlacement,Lt)}}}if(f.get("symbol-placement")==="line"&&(this.features=(function(de){const _e={},ye={},Be=[];let Ee=0;function Ve(ot){Be.push(de[ot]),Ee++}function Xe(ot,Ye,at){const Fe=ye[ot];return delete ye[ot],ye[Ye]=Fe,Be[Fe].geometry[0].pop(),Be[Fe].geometry[0]=Be[Fe].geometry[0].concat(at[0]),Fe}function tt(ot,Ye,at){const Fe=_e[Ye];return delete _e[Ye],_e[ot]=Fe,Be[Fe].geometry[0].shift(),Be[Fe].geometry[0]=at[0].concat(Be[Fe].geometry[0]),Fe}function gt(ot,Ye,at){const Fe=at?Ye[0][Ye[0].length-1]:Ye[0][0];return`${ot}:${Fe.x}:${Fe.y}`}for(let ot=0;ot<de.length;ot++){const Ye=de[ot],at=Ye.geometry,Fe=Ye.text?Ye.text.toString():null;if(!Fe){Ve(ot);continue}const Le=gt(Fe,at),rt=gt(Fe,at,!0);if(Le in ye&&rt in _e&&ye[Le]!==_e[rt]){const mt=tt(Le,rt,at),Ke=Xe(Le,rt,Be[mt].geometry);delete _e[Le],delete ye[rt],ye[gt(Fe,Be[Ke].geometry,!0)]=Ke,Be[mt].geometry=null}else Le in ye?Xe(Le,rt,at):rt in _e?tt(Le,rt,at):(Ve(ot),_e[Le]=Ee-1,ye[rt]=Ee-1)}return Be.filter((ot=>ot.geometry))})(this.features)),f.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const de of i.elevationFeatures)this.elevationFeatureIdToIndex.set(de.id,this.elevationFeatures.length),this.elevationFeatures.push(de)}}else f.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((de,_e)=>de.sortKey-_e.sortKey))}getCombinedIconPrimary(e,i,a,l,h,f,m){let v,x;const S=e.getUnevaluatedProperties();if(S._values["icon-image"].value!==void 0){const E=i.getAppearanceValueAndResolveTokens(e,"icon-image",a,l,h);v=this.getResolvedImageFromTokens(E)}else{const E=i.getValueAndResolveTokens("icon-image",a,l,h);v=this.getResolvedImageFromTokens(E)}if(v){const E=S._values["icon-size"]||i._unevaluatedLayout._values["icon-size"];x=Cm(v,Ip(this.zoom,E,this.worldview),E,l,this.zoom,f,this.pixelRatio,m,this.worldview).iconPrimary}return x}updateAppearanceBasedIconTextures(e,i,a,l){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const h=this.layers[0];let f=!1,m=0;const v=h.layout,[x,S]=v.get("icon-size-scale-range"),E=G(1,x,S);for(let A=0;A<this.symbolInstances.length;A++){const R=this.symbolInstances.get(A),D=this.appearanceFeatureData[R.featureIndex];if(D&&R.placedIconSymbolIndex>=0){const F=D.id,k=i&&F!==void 0?i[String(F)]:void 0,U={type:"Point",id:D.id,properties:D.properties,geometry:[]},q=this.layers[0].appearances&&this.layers[0].appearances.find(($=>$.isActive({globals:l,feature:U,canonical:e,featureState:k})));if(D.activeAppearance===q)continue;if(q){D.activeAppearance=q;const $={sortKey:void 0,text:void 0,icon:null,index:R.featureIndex,sourceLayerIndex:R.featureIndex,geometry:[],properties:D.properties,type:"Point",id:D.id};if(!q.hasCachedIconPrimary()){const de=this.getCombinedIconPrimary(q,h,U,e,a,$,E);q.setCachedIconPrimary(de)}const Y=q.getCachedIconPrimary();if(!Y)continue;const le=Y.toString(),ne=this.iconAtlasPositions&&this.iconAtlasPositions.get(le);if(ne){const de=h.getAppearanceValueAndResolveTokens(q,"icon-offset",U,e,a),_e=de&&Array.isArray(de)?de:[0,0];let ye=F0(ne,void 0,_e,h.layout.get("icon-anchor").evaluate(U,{},e));const Be=h.getAppearanceValueAndResolveTokens(q,"icon-rotate",U,e,a),Ee=typeof Be=="number"?Be:0,Ve=ne.sdf,Xe=h.layout.get("icon-text-fit").constantOr("none");Xe!=="none"&&D.textShaping&&D.iconTextFitPadding&&D.fontScale&&(ye=B_(ye,D.textShaping,Xe,D.iconTextFitPadding,_e,D.fontScale));const tt=this.calculateEffectiveAppearanceIconSize(q,l.zoom,U,e,a,E),gt=0,ot=1+(Math.min(xd,Math.round(tt*fu))<<1),Ye=V_(ye,Ee,Ve,Xe!=="none",E);D.isUsingAppearanceVertexData||(D.isUsingAppearanceVertexData=!0,D.layoutBasedVertexData=this.icon.getIconVertexData(m,R.numIconVertices));for(let Fe=0;Fe<Ye.length;++Fe){const Le=Ye[Fe],rt=D.layoutBasedVertexData[0]||R.tileAnchorX,mt=D.layoutBasedVertexData[1]||R.tileAnchorY,Ke=16*Le.pixelOffsetTL.x,Lt=16*Le.pixelOffsetTL.y,Nt=16*Le.pixelOffsetBR.x,zt=16*Le.pixelOffsetBR.y,Et=16*Le.minFontScaleX,ui=16*Le.minFontScaleY;this.icon.updateIconVertexData(m,rt,mt,Math.round(32*Le.tl.x),Math.round(32*Le.tl.y),Le.texPrimary.x,Le.texPrimary.y,gt,ot,Ke,Lt,Et,ui),this.icon.updateIconVertexData(m+1,rt,mt,Math.round(32*Le.tr.x),Math.round(32*Le.tr.y),Le.texPrimary.x+Le.texPrimary.w,Le.texPrimary.y,gt,ot,Nt,Lt,Et,ui),this.icon.updateIconVertexData(m+2,rt,mt,Math.round(32*Le.bl.x),Math.round(32*Le.bl.y),Le.texPrimary.x,Le.texPrimary.y+Le.texPrimary.h,gt,ot,Ke,zt,Et,ui),this.icon.updateIconVertexData(m+3,rt,mt,Math.round(32*Le.br.x),Math.round(32*Le.br.y),Le.texPrimary.x+Le.texPrimary.w,Le.texPrimary.y+Le.texPrimary.h,gt,ot,Nt,zt,Et,ui),m+=4}const at=R.numIconVertices-4*Ye.length;for(let Fe=0;Fe<at;++Fe)this.icon.updateIconVertexData(m+Fe,0,0,0,0,0,0,0,0,0,0,0,0);f=!0}else m+=R.numIconVertices}else if(D.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(m,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(m+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(m+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(m+3,0,0,0,0,0,0,0,0,0,0,0,0),f=!0),m+=R.numIconVertices,D.activeAppearance=null;else if(D.isUsingAppearanceVertexData){const Y=D.layoutBasedVertexData.length/12;for(let le=0;le<Y;++le){const ne=le*12;this.icon.updateIconVertexData(m+le,D.layoutBasedVertexData[ne+0],D.layoutBasedVertexData[ne+1],D.layoutBasedVertexData[ne+2],D.layoutBasedVertexData[ne+3],D.layoutBasedVertexData[ne+4],D.layoutBasedVertexData[ne+5],D.layoutBasedVertexData[ne+6],D.layoutBasedVertexData[ne+7],D.layoutBasedVertexData[ne+8],D.layoutBasedVertexData[ne+9],D.layoutBasedVertexData[ne+10],D.layoutBasedVertexData[ne+11])}m+=Y,D.isUsingAppearanceVertexData=!1,D.activeAppearance=null,f=!0}else m+=R.numIconVertices,D.activeAppearance=null}}return f}update(e,i,a,l,h,f,m){this.text.programConfigurations.updatePaintArrays(e,i,h,a,l,f,m,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,h,a,l,f,m,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const a=ue(e),l=1/a;let h=!1,f=!1;for(let m=0;m<this.symbolInstances.length;m++){const v=this.symbolInstances.get(m),x=yt(1,0,0),S=yt(0,1,0),{numHorizontalGlyphVertices:E,numVerticalGlyphVertices:A,numIconVertices:R,numVerticalIconVertices:D}=v,F=E>0||A>0,k=R>0,U=this.elevationFeatures[v.elevationFeatureIndex];if(U){const q=new nt(v.tileAnchorX,v.tileAnchorY),$=.075+U.pointElevation(q);v.zOffset!==$&&(i=!0,v.zOffset=$),$!==0&&(this.hasAnyZOffset=!0);const Y=U.computeSlopeNormal(q,l),le=Cs(Bl(),yt(0,0,1),Y);$a(x,x,le),$a(S,S,le),x[2]*=a,S[2]*=a,x[0]===1&&x[1]===0&&x[2]===0&&S[0]===0&&S[1]===1&&S[2]===0||(h=h||F,f=f||k)}if(F&&(q0(this.text.orientationVertexArray,E,x,S),q0(this.text.orientationVertexArray,A,x,S)),k){const{placedIconSymbolIndex:q,verticalPlacedIconSymbolIndex:$}=v;q>=0&&q0(this.icon.orientationVertexArray,R,x,S),$>=0&&q0(this.icon.orientationVertexArray,D,x,S)}}h||(this.text.orientationVertexArray=void 0),f||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(h,f,m)=>{a+=f,a>h.length&&h.resize(a);for(let v=-f;v<0;v++)h.emplace(v+a,m)},i=(h,f,m)=>{l+=f,l>h.length&&h.resize(l);for(let v=-f;v<0;v++)h.emplace(v+l,m)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,l=0;for(let h=0;h<this.symbolInstances.length;h++){const f=this.symbolInstances.get(h),{numHorizontalGlyphVertices:m,numVerticalGlyphVertices:v,numIconVertices:x}=f,S=f.zOffset,E=x>0;if((m>0||v>0)&&(e(this.text.zOffsetVertexArray,m,S),e(this.text.zOffsetVertexArray,v,S)),E){const{placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:R}=f;A>=0&&i(this.icon.zOffsetVertexArray,x,S),R>=0&&i(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,S)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,i,a,l,h){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some((f=>f.appearances&&f.appearances.length>0))),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,i,a,l){return!!(e&&i&&a)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,i,a,l)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Og(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:l,y:h}of i)this.lineVertexArray.emplaceBack(l,h);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,l,h,f,m,v,x,S,E,A,R,D,F,k,U,q){const $=e.indexArray,Y=e.layoutVertexArray,le=e.globeExtVertexArray,ne=e.segments.prepareSegment(4*q,Y,$,this.canOverlap?f.sortKey:void 0),de=this.glyphOffsetArray.length,_e=ne.vertexLength,ye=this.allowVerticalPlacement&&m===xs.vertical?Math.PI/2:0,Be=f.text&&f.text.sections;for(let Xe=0;Xe<i.length;Xe++){const{tl:tt,tr:gt,bl:ot,br:Ye,texPrimary:at,texSecondary:Fe,pixelOffsetTL:Le,pixelOffsetBR:rt,minFontScaleX:mt,minFontScaleY:Ke,glyphOffset:Lt,isSDF:Nt,sectionIndex:zt}=i[Xe],Et=ne.vertexLength,ui=Lt[1];if(Fm(Y,x.x,x.y,tt.x,ui+tt.y,at.x,at.y,a,Nt,Le.x,Le.y,mt,Ke),Fm(Y,x.x,x.y,gt.x,ui+gt.y,at.x+at.w,at.y,a,Nt,rt.x,Le.y,mt,Ke),Fm(Y,x.x,x.y,ot.x,ui+ot.y,at.x,at.y+at.h,a,Nt,Le.x,rt.y,mt,Ke),Fm(Y,x.x,x.y,Ye.x,ui+Ye.y,at.x+at.w,at.y+at.h,a,Nt,rt.x,rt.y,mt,Ke),v){const{x:Ct,y:Yt,z:pi}=v.anchor,[Ii,tn,vi]=v.up;km(le,Ct,Yt,pi,Ii,tn,vi),km(le,Ct,Yt,pi,Ii,tn,vi),km(le,Ct,Yt,pi,Ii,tn,vi),km(le,Ct,Yt,pi,Ii,tn,vi),Pp(e.dynamicLayoutVertexArray,Ct,Yt,pi,ye)}else Pp(e.dynamicLayoutVertexArray,x.x,x.y,x.z,ye);if(k){const Ct=Fe||at;Bm(e.iconTransitioningVertexArray,Ct.x,Ct.y),Bm(e.iconTransitioningVertexArray,Ct.x+Ct.w,Ct.y),Bm(e.iconTransitioningVertexArray,Ct.x,Ct.y+Ct.h),Bm(e.iconTransitioningVertexArray,Ct.x+Ct.w,Ct.y+Ct.h)}$.emplaceBack(Et,Et+1,Et+2),$.emplaceBack(Et+1,Et+2,Et+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Lt[0]),Xe!==i.length-1&&zt===i[Xe+1].sectionIndex||e.programConfigurations.populatePaintArrays(Y.length,f,f.index,{},R,D,F,Be&&Be[zt],this.worldview)}const Ee=q-i.length;Ee!==0&&this._addNullVertices(Ee,Y,a,v,le,e,k,ne,$);const Ve=v?v.anchor:x;e.placedSymbolArray.emplaceBack(Ve.x,Ve.y,Ve.z,x.x,x.y,de,this.glyphOffsetArray.length-de,_e,S,E,x.segment,a?a[0]:0,a?a[1]:0,l[0],l[1],m,0,0,0,A,0),e.symbolInstanceIndices.push(U)}_addNullVertices(e,i,a,l,h,f,m,v,x){for(let S=0;S<e;S++){for(let A=0;A<4;A++)Fm(i,0,0,0,0,0,0,a,!1,0,0,0,0),l&&km(h,0,0,0,0,0,0),Pp(f.dynamicLayoutVertexArray,0,0,0,0),m&&Bm(f.iconTransitioningVertexArray,0,0);const E=v.vertexLength;x.emplaceBack(E,E+1,E+2),x.emplaceBack(E+1,E+2,E+3),v.vertexLength+=4,v.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,i,a,l,h,f,m){e.emplaceBack(i,a,l,h,f,Math.round(m.x),Math.round(m.y))}_addCollisionDebugVertices(e,i,a,l,h,f,m){const v=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),x=v.vertexLength,S=m.tileAnchorX,E=m.tileAnchorY;for(let R=0;R<4;R++)a.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,i,e.padding,m.zOffset),this._commitLayoutVertex(a.layoutVertexArray,l,h,f,S,E,new nt(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,l,h,f,S,E,new nt(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,l,h,f,S,E,new nt(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,l,h,f,S,E,new nt(e.x1,e.y2)),v.vertexLength+=4;const A=a.indexArray;A.emplaceBack(x,x+1),A.emplaceBack(x+1,x+2),A.emplaceBack(x+2,x+3),A.emplaceBack(x+3,x),v.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,a,l,h,f){for(let m=l;m<h;m++){const v=a.get(m),x=this.getSymbolInstanceTextSize(e,f,i,m);this._addCollisionDebugVertices(v,x,this.textCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,i,a,l,h,f){for(let m=l;m<h;m++){const v=a.get(m),x=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._addCollisionDebugVertices(v,x,this.iconCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,i,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new X_(od,J2.members,Po),this.iconCollisionBox=new X_(od,J2.members,Po);const l=Cp(this.iconSizeData,e),h=Cp(this.textSizeData,e,a);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(h,e,i,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(h,e,i,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(l,e,i,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(l,e,i,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,i,a,l){const h=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:l),f=k_(this.textSizeData,e,h)/Ca;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,i,a){const l=this.icon.placedSymbolArray.get(a),h=k_(this.iconSizeData,e,l);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,i,a,l){e.emplaceBack(i,-a,-a,l),e.emplaceBack(i,a,-a,l),e.emplaceBack(i,a,a,l),e.emplaceBack(i,-a,a,l)}_updateTextDebugCollisionBoxes(e,i,a,l,h,f,m){for(let v=l;v<h;v++){const x=a.get(v),S=this.getSymbolInstanceTextSize(e,f,i,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,x.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,i,a,l,h,f,m){for(let v=l;v<h;v++){const x=a.get(v),S=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,x.padding,f.zOffset)}}updateCollisionDebugBuffers(e,i,a,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=Cp(this.iconSizeData,e,l),f=Cp(this.textSizeData,e,a);for(let m=0;m<this.symbolInstances.length;m++){const v=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(f,e,i,v.textBoxStartIndex,v.textBoxEndIndex,v,a),this._updateTextDebugCollisionBoxes(f,e,i,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v,a),this._updateIconDebugCollisionBoxes(h,e,i,v.iconBoxStartIndex,v.iconBoxEndIndex,v,l),this._updateIconDebugCollisionBoxes(h,e,i,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v,l)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,a,l,h,f,m,v,x){const S={};if(i<a){const{x1:E,y1:A,x2:R,y2:D,padding:F,projectedAnchorX:k,projectedAnchorY:U,projectedAnchorZ:q,tileAnchorX:$,tileAnchorY:Y,featureIndex:le}=e.get(i);S.textBox={x1:E,y1:A,x2:R,y2:D,padding:F,projectedAnchorX:k,projectedAnchorY:U,projectedAnchorZ:q,tileAnchorX:$,tileAnchorY:Y},S.textFeatureIndex=le}if(l<h){const{x1:E,y1:A,x2:R,y2:D,padding:F,projectedAnchorX:k,projectedAnchorY:U,projectedAnchorZ:q,tileAnchorX:$,tileAnchorY:Y,featureIndex:le}=e.get(l);S.verticalTextBox={x1:E,y1:A,x2:R,y2:D,padding:F,projectedAnchorX:k,projectedAnchorY:U,projectedAnchorZ:q,tileAnchorX:$,tileAnchorY:Y},S.verticalTextFeatureIndex=le}if(f<m){const{x1:E,y1:A,x2:R,y2:D,padding:F,projectedAnchorX:k,projectedAnchorY:U,projectedAnchorZ:q,tileAnchorX:$,tileAnchorY:Y,featureIndex:le}=e.get(f);S.iconBox={x1:E,y1:A,x2:R,y2:D,padding:F,projectedAnchorX:k,projectedAnchorY:U,projectedAnchorZ:q,tileAnchorX:$,tileAnchorY:Y},S.iconFeatureIndex=le}if(v<x){const{x1:E,y1:A,x2:R,y2:D,padding:F,projectedAnchorX:k,projectedAnchorY:U,projectedAnchorZ:q,tileAnchorX:$,tileAnchorY:Y,featureIndex:le}=e.get(v);S.verticalIconBox={x1:E,y1:A,x2:R,y2:D,padding:F,projectedAnchorX:k,projectedAnchorY:U,projectedAnchorZ:q,tileAnchorX:$,tileAnchorY:Y},S.verticalIconFeatureIndex=le}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const a=e.placedSymbolArray.get(i),l=a.vertexStartIndex+4*a.numGlyphs;for(let h=a.vertexStartIndex;h<l;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),a=Math.cos(e),l=[],h=[],f=[];for(let m=0;m<this.symbolInstances.length;++m){f.push(m);const v=this.symbolInstances.get(m);l.push(0|Math.round(i*v.tileAnchorX+a*v.tileAnchorY)),h.push(v.featureIndex)}return f.sort(((m,v)=>l[m]-l[v]||h[v]-h[m])),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:m,placedIconSymbolIndex:v,verticalPlacedIconSymbolIndex:x}=a;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),h>=0&&h!==l&&this.addIndicesForPlacedSymbol(this.text,h),f>=0&&f!==h&&f!==l&&this.addIndicesForPlacedSymbol(this.text,f),m>=0&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&this.addIndicesForPlacedSymbol(this.icon,v),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const i=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let a;return this.elevationFeatures&&i<this.elevationFeatures.length&&(a=this.elevationFeatures[i]),a}}function Fg(n,e){return e.replace(/{([^{}]+)}/g,((i,a)=>a in n?String(n[a]):""))}let Bg,kg,$_;st(Z0,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),Z0.addDynamicAttributes=Pp;class Ng{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Iu,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}st(Ng,"FormatSectionOverride",{omit:["defaultValue"]});const W_=()=>$_||($_={layout:Bg||(Bg=new fr({"symbol-placement":new ut(Se.layout_symbol["symbol-placement"]),"symbol-spacing":new ut(Se.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ut(Se.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new It(Se.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ut(Se.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ut(Se.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new ut(Se.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new ut(Se.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ut(Se.layout_symbol["icon-ignore-placement"]),"icon-optional":new ut(Se.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ut(Se.layout_symbol["icon-rotation-alignment"]),"icon-size":new It(Se.layout_symbol["icon-size"]),"icon-size-scale-range":new ut(Se.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new It(Se.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new It(Se.layout_symbol["icon-text-fit-padding"]),"icon-image":new It(Se.layout_symbol["icon-image"]),"icon-image-use-theme":new ut({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new It(Se.layout_symbol["icon-rotate"]),"icon-padding":new ut(Se.layout_symbol["icon-padding"]),"icon-keep-upright":new ut(Se.layout_symbol["icon-keep-upright"]),"icon-offset":new It(Se.layout_symbol["icon-offset"]),"icon-anchor":new It(Se.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ut(Se.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ut(Se.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ut(Se.layout_symbol["text-rotation-alignment"]),"text-field":new It(Se.layout_symbol["text-field"]),"text-font":new It(Se.layout_symbol["text-font"]),"text-size":new It(Se.layout_symbol["text-size"]),"text-size-scale-range":new ut(Se.layout_symbol["text-size-scale-range"]),"text-max-width":new It(Se.layout_symbol["text-max-width"]),"text-line-height":new It(Se.layout_symbol["text-line-height"]),"text-letter-spacing":new It(Se.layout_symbol["text-letter-spacing"]),"text-justify":new It(Se.layout_symbol["text-justify"]),"text-radial-offset":new It(Se.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ut(Se.layout_symbol["text-variable-anchor"]),"text-anchor":new It(Se.layout_symbol["text-anchor"]),"text-max-angle":new ut(Se.layout_symbol["text-max-angle"]),"text-writing-mode":new ut(Se.layout_symbol["text-writing-mode"]),"text-rotate":new It(Se.layout_symbol["text-rotate"]),"text-padding":new ut(Se.layout_symbol["text-padding"]),"text-keep-upright":new ut(Se.layout_symbol["text-keep-upright"]),"text-transform":new It(Se.layout_symbol["text-transform"]),"text-offset":new It(Se.layout_symbol["text-offset"]),"text-allow-overlap":new ut(Se.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ut(Se.layout_symbol["text-ignore-placement"]),"text-optional":new ut(Se.layout_symbol["text-optional"]),visibility:new ut(Se.layout_symbol.visibility)})),paint:kg||(kg=new fr({"icon-opacity":new It(Se.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new It(Se.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new It(Se.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new It(Se.paint_symbol["text-emissive-strength"]),"icon-color":new It(Se.paint_symbol["icon-color"]),"icon-halo-color":new It(Se.paint_symbol["icon-halo-color"]),"icon-halo-width":new It(Se.paint_symbol["icon-halo-width"]),"icon-halo-blur":new It(Se.paint_symbol["icon-halo-blur"]),"icon-translate":new ut(Se.paint_symbol["icon-translate"]),"icon-translate-anchor":new ut(Se.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ut(Se.paint_symbol["icon-image-cross-fade"]),"text-opacity":new It(Se.paint_symbol["text-opacity"]),"text-occlusion-opacity":new It(Se.paint_symbol["text-occlusion-opacity"]),"text-color":new It(Se.paint_symbol["text-color"],{runtimeType:co,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new It(Se.paint_symbol["text-halo-color"]),"text-halo-width":new It(Se.paint_symbol["text-halo-width"]),"text-halo-blur":new It(Se.paint_symbol["text-halo-blur"]),"text-translate":new ut(Se.paint_symbol["text-translate"]),"text-translate-anchor":new ut(Se.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ut(Se.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new ut(Se.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new ut(Se.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new ut(Se.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new It(Se.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},$_);class X0 extends ya{constructor(e,i,a,l){super(e,W_(),i,a,l,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=$i([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.appearances&&this.appearances.forEach((l=>{l.recalculate(e,i,this.iconImageUseTheme)})),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const l=[];for(const h of a)l.indexOf(h)<0&&l.push(h);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,a,l){return this._saturation===e&&this._contrast===i&&this._brightnessMin===a&&this._brightnessMax===l||(this._colorAdjustmentMatrix=(function(h,f,m,v){h=An(h),f=Rn(f);const x=yn(),S=h/3,E=1-2*S,A=[E,S,S,0,S,E,S,0,S,S,E,0,0,0,0,1],R=.5-.5*f,D=v-m;return Ci(x,[D,0,0,0,0,D,0,0,0,0,D,0,m,m,m,1],[f,0,0,0,0,f,0,0,0,0,f,0,R,R,R,1]),Ci(x,x,A),x})(e,i,a,l),this._saturation=e,this._contrast=i,this._brightnessMin=a,this._brightnessMax=l),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,a,l){const h=this.layout.get(e).evaluate(i,{},a,l),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Zu(f.value)||!h?h:Fg(i.properties,h)}getAppearanceValueAndResolveTokens(e,i,a,l,h){const f=e.getProperty(i);if(!f)return;const m=f.evaluate(a,{},l,h),v=e.getUnevaluatedProperties()._values[i];return v.isDataDriven()||Zu(v.value)||!m||typeof m!="string"?m:Fg(a.properties,m)}createBucket(e){return new Z0(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of W_().paint.overridableProperties){if(!X0.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),a=new Ng(i),l=new Wh(a,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let h=null;h=i.value.kind==="constant"||i.value.kind==="source"?new La("source",l):new ga("composite",l,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Ro(i.property,h,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&X0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const a=e.get("text-field"),l=W_().paint.properties[i];let h=!1;const f=m=>{for(const v of m)if(l.overrides&&l.overrides.hasOverride(v))return void(h=!0)};if(a.value.kind==="constant"&&a.value.value instanceof $r)f(a.value.value.sections);else if(a.value.kind==="source"){const m=x=>{h||(x instanceof Fs&&Wr(x.value)===xc?f(x.value.sections):x instanceof Bs?f(x.sections):x.eachChild(m))},v=a.value;v._styleExpression&&m(v._styleExpression.expression)}return h}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,a){return{config:new ys(this,{zoom:i,lut:a}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Ug,Vg,jg,Gg;var Y_=zi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function $0(n,e,i,a,l,h,f,m){const v=[n,e,1,i,a,1,l,h,1],x=[f,m,1],S=Pi([],v),[E,A,R]=ro(x,x,S);return Hi(v,v,[E,0,0,0,A,0,0,0,R])}function Hg(n,e,i,a,l,h,f,m){const v=(function(x,S,E,A,R,D,F,k){const U=$0(0,0,1,0,1,1,0,1),q=$0(x,S,E,A,R,D,F,k);return Hi(q,q,Pi([],U))})(n,e,i,a,l,h,f,m);return[v[2]/v[8]/pt,v[5]/v[8]/pt]}function W0(n){return[n[0],Math.min(Math.max(n[1],-Q),Q)]}class qg extends hl{constructor(e,i,a,l){super(),this.id=e,this.dispatcher=a,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(l),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Ra("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Eu(this.map._requestManager.transformRequest(this.url,ss.Image),((a,l)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Gl(a)):l&&(this.image=l instanceof HTMLImageElement?_a.getImageData(l):l,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new wm(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ra("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof wm||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],a=e[0][1];for(const h of e)h[1]>a&&(a=h[1]),h[1]<i&&(i=h[1]);const l=(a+i)/2;if(l>Q?this.onNorthPole=!0:l<-Q&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const h=e.map(we.fromLngLat);this.tileID=(function(f){let m=1/0,v=1/0,x=-1/0,S=-1/0;for(const F of f)m=Math.min(m,F.x),v=Math.min(v,F.y),x=Math.max(x,F.x),S=Math.max(S,F.y);const E=Math.max(x-m,S-v),A=Math.max(0,Math.floor(-Math.log2(E))),R=Math.pow(2,A);let D=Math.floor((m+x)/2*R);return D>1&&(D-=1),new Fo(A,D,Math.floor((v+S)/2*R))})(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ra("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof wm||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const U in this.tiles){const q=this.tiles[U];q.state!=="loaded"&&(q.state="loaded",q.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Rm(new Fo(0,0,0),this.map.transform.projection),a=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(U){const q=U[1].x-U[0].x,$=U[1].y-U[0].y,Y=U[2].x-U[1].x,le=U[2].y-U[1].y,ne=U[3].x-U[2].x,de=U[3].y-U[2].y,_e=U[0].x-U[3].x,ye=U[0].y-U[3].y,Be=q*le-Y*$,Ee=Y*de-ne*le,Ve=ne*ye-_e*de,Xe=_e*$-q*ye;return Be>0&&Ee>0&&Ve>0&&Xe>0||Be<0&&Ee<0&&Ve<0&&Xe<0})(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const l=Rm(this.tileID,this.map.transform.projection),[h,f,m,v]=this.coordinates.map((U=>{const q=l.projection.project(U[0],U[1]);return zg(l,q)._round()}));this.perspectiveTransform=Hg(h.x,h.y,f.x,f.y,m.x,m.y,v.x,v.y);const x=this._boundsArray=new $c;x.emplaceBack(h.x,h.y,0,0),x.emplaceBack(f.x,f.y,pt,0),x.emplaceBack(v.x,v.y,0,pt),x.emplaceBack(m.x,m.y,pt,pt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(x,Y_.members),this.boundsSegments=$n.simpleSegment(0,0,4,2);const S=[],E=[W0((A=this.coordinates)[0]),W0(A[1]),W0(A[2]),W0(A[3])];var A;const[R,D,F,k]=(function(U){let q=U[0][0],$=q,Y=U[0][1],le=Y;for(let ne=1;ne<U.length;ne++)U[ne][0]<q?q=U[ne][0]:U[ne][0]>$&&($=U[ne][0]),U[ne][1]<Y?Y=U[ne][1]:U[ne][1]>le&&(le=U[ne][1]);return[q,Y,$-q,le-Y]})(E);{const U=new $c,[q,$,Y,le]=(function(Ye){let at=Ye[0].x,Fe=at,Le=Ye[0].y,rt=Le;for(let mt=1;mt<Ye.length;mt++)Ye[mt].x<at?at=Ye[mt].x:Ye[mt].x>Fe&&(Fe=Ye[mt].x),Ye[mt].y<Le?Le=Ye[mt].y:Ye[mt].y>rt&&(rt=Ye[mt].y);return[at,Le,Fe-at,rt-Le]})(a),ne=Ye=>[(Ye.x-q)/Y,(Ye.y-$)/le],[de,_e,ye,Be]=a.map(ne),Ee=(function(Ye,at,Fe,Le,rt,mt,Ke,Lt){const Nt=$0(0,0,1,0,1,1,0,1);return Hi(Nt,Nt,Pi([],$0(Ye,at,Fe,Le,rt,mt,Ke,Lt)))})(de[0],de[1],_e[0],_e[1],ye[0],ye[1],Be[0],Be[1]);this.elevatedGlobePerspectiveTransform=Hg(de[0],de[1],_e[0],_e[1],ye[0],ye[1],Be[0],Be[1]);const Ve=(Ye,at)=>{S.push(Ye.lng);const Fe=Math.round((Ye.lng-R)/F*pt),Le=Math.round((Ye.lat-D)/k*pt),rt=ne(at),mt=ro([],[rt[0],rt[1],1],Ee),Ke=Math.round(mt[0]/mt[2]*pt),Lt=Math.round(mt[1]/mt[2]*pt);U.emplaceBack(Fe,Le,Ke,Lt)},Xe=a[3].x-a[0].x,tt=a[3].y-a[0].y,gt=a[2].x-a[1].x,ot=a[2].y-a[1].y;for(let Ye=0;Ye<65;Ye++){const at=Ye/64,Fe=[a[0].x+at*Xe,a[0].y+at*tt],Le=[a[1].x+at*gt,a[1].y+at*ot],rt=Le[0]-Fe[0],mt=Le[1]-Fe[1];for(let Ke=0;Ke<65;Ke++){const Lt=Ke/64,Nt={x:Fe[0]+rt*Lt,y:Fe[1]+mt*Lt};Ve(i.projection.unproject(Nt.x,Nt.y),Nt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(U,Y_.members)}{this.maxLongitudeTriangleSize=0;let U=[],q=new Hn;const $=(Y,le,ne)=>{q.emplaceBack(Y,le,ne);const de=S[Y],_e=S[le],ye=S[ne],Be=Math.min(Math.min(de,_e),ye),Ee=Math.max(Math.max(de,_e),ye)-Be;Ee>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ee),U.push(Be+Ee/2)};for(let Y=0;Y<64;Y++)for(let le=0;le<64;le++){const ne=65*Y+le,de=ne+1,_e=ne+65,ye=_e+1;$(ne,_e,de),$(de,_e,ye)}[U,q]=(function(Y,le){const ne=Array.from({length:Y.length},((ye,Be)=>Be));ne.sort(((ye,Be)=>Y[ye]-Y[Be]));const de=[],_e=new Hn;for(let ye=0;ye<ne.length;ye++){const Be=ne[ye];de.push(Y[Be]);const Ee=3*Be,Ve=Ee+1;_e.emplaceBack(le.uint16[Ee],le.uint16[Ve],le.uint16[Ve+1])}return[de,_e]})(U,q),this.elevatedGlobeTrianglesCenterLongitudes=U,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(q)}this.elevatedGlobeSegments=$n.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,F/pt,0,k/pt,0,0,D,R,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,a=i.gl;!this._dirty||this.texture instanceof wm||(this.texture?this.texture.update(this.image):(this.texture=new w_(i,this.image,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let l=(h=e+180)+360*Math.round((a[0]-h)/360);var h;const f=new $n,m=(E,A)=>{f.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:i.segments[0].vertexLength,primitiveLength:A,sortKey:void 0,vaos:{}})},v=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-l)<=v){const E=Oi(a,0,a.length,l+v);return E===a.length||m(E,xn(a,E+1,a.length,l+360-v)-E),f}l<a[0]&&(l+=360);const x=xn(a,0,a.length,l-v);if(x===a.length)return m(0,a.length),f;m(0,x-0);const S=Oi(a,x+1,a.length,l+v);return S!==a.length&&m(S,a.length-S),f}}const d5=(Math.pow(256,2)-1)/16907520;class Zg extends ya{constructor(e,i,a,l){super(e,{layout:jg||(jg=new fr({visibility:new ut(Se.layout_raster.visibility)})),paint:Gg||(Gg=new fr({"raster-opacity":new ut(Se.paint_raster["raster-opacity"]),"raster-color":new jc(Se.paint_raster["raster-color"]),"raster-color-mix":new ut(Se.paint_raster["raster-color-mix"]),"raster-color-range":new ut(Se.paint_raster["raster-color-range"]),"raster-hue-rotate":new ut(Se.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ut(Se.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ut(Se.paint_raster["raster-brightness-max"]),"raster-saturation":new ut(Se.paint_raster["raster-saturation"]),"raster-contrast":new ut(Se.paint_raster["raster-contrast"]),"raster-resampling":new ut(Se.paint_raster["raster-resampling"]),"raster-fade-duration":new ut(Se.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ut(Se.paint_raster["raster-emissive-strength"]),"raster-array-band":new ut(Se.paint_raster["raster-array-band"]),"raster-elevation":new ut(Se.paint_raster["raster-elevation"]),"raster-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},i,a,l),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof qg&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[a,l]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(l)||a===this._curRampRange[0]&&l===this._curRampRange[1]||(this.colorRamp=fd({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:l}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,l])}}let Xg,$g,Wg,Yg,Kg;class Jg extends ya{constructor(e,i,a,l){super(e,{layout:Xg||(Xg=new fr({visibility:new ut(Se["layout_raster-particle"].visibility)})),paint:$g||($g=new fr({"raster-particle-array-band":new ut(Se["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ut(Se["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new jc(Se["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ut(Se["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ut(Se["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ut(Se["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ut(Se["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new ut(Se["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},i,a,l),this._updateColorRamp(),this.lastInvalidatedAt=_a.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=fd({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=_a.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class f5 extends ya{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function K_(n,e,i){const a=[0,0,1],l=as([]);return Ms(l,l,i?-Ui(n)+Math.PI:Ui(n)),As(l,l,-Ui(e)),$a(a,a,l),Li(a,a)}const Qg={None:0,Model:1,Symbol:2,FillExtrusion:4};class Y0{constructor(e,i,a,l){this.message=(e?`${e}: `:"")+a,l&&(this.identifier=l),i!=null&&i.__line__&&(this.line=i.__line__)}}function J_(n,e){const i=n.indexOf("://")===-1;try{return new URL(n,i&&e?"http://example.com":void 0),!0}catch{return!1}}class e3{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class t3{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new tf,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const i=16*e,a=this.instancedDataArray.float32;let l=Math.floor(a[i+2]);const h=1.05*(a[i+2]-l);return l/=100,[a[i]%1*1.05,a[i+1]%1*1.05,h,l]}tileCoordinatesForInstance(e){const i=16*e,a=this.instancedDataArray.float32;let l=a[i+0];return l=l>pt?l-pt:l,new nt(Math.trunc(l),Math.trunc(a[i+1]))}translationForInstance(e){const i=16*e,a=this.instancedDataArray.float32;return[a[i+4],a[i+5],a[i+6]]}rotationScaleForInstance(e){const i=16*e,a=this.instancedDataArray.float32;return[a[i+7],a[i+8],a[i+9],a[i+10],a[i+11],a[i+12],a[i+13],a[i+14],a[i+15]]}transformForInstance(e){const i=16*e,a=this.instancedDataArray.float32;return[a[i+7],a[i+8],a[i+9],a[i+4],a[i+10],a[i+11],a[i+12],a[i+5],a[i+13],a[i+14],a[i+15],a[i+6],0,0,0,1]}}class Q_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,l){}populate(e,i,a,l){this.tileToMeter=ue(a);const h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:m,index:v,sourceLayerIndex:x}of e){const S=m??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),E=Re(f,h);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),E,a))continue;const A={id:S,sourceLayerIndex:x,index:v,geometry:h?E.geometry:Ge(f,a,l),properties:f.properties,type:f.type,patterns:{}},R=this.addFeature(A,A.geometry,E);R&&i.featureIndex.insert(f,A.geometry,v,x,this.index,this.instancesPerModel[R].instancedDataArray.length,pt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,i=this.layers[0].scope;let a=0;for(const l of this.modelUris){const h=e.getModel(l,i);if(!h)continue;const f=this.instancesPerModel[l];if(f){const m=.5*fn(h.aabb.max,h.aabb.min)*f.maxScale+f.maxXYTranslationDistance,v=Math.min(pt,Math.max(m/this.tileToMeter,pt/32));a=Math.max(v,a)}}return a}update(e,i,a,l){for(const h in this.instancesPerModel){const f=this.instancesPerModel[h];for(const m in e)f.idToFeaturesIndex.hasOwnProperty(m)&&(this.evaluate(f.features[f.idToFeaturesIndex[m]],e[m],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];for(const l of a.features){const h=this.layers[0],f=l.feature,m=this.canonical,v=h.paint.get("model-rotation").evaluate(f,{},m),x=h.paint.get("model-scale").evaluate(f,{},m),S=h.paint.get("model-translation").evaluate(f,{},m);Es(l.rotation,v)&&Es(l.scale,x)&&Es(l.translation,S)||(this.evaluate(l,l.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,i,a,l){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(E1(this.activeReplacements,h))return!1;this.activeReplacements=h;let f=!1;for(const m in this.instancesPerModel){const v=this.instancesPerModel[m],x=v.instancedDataArray;for(const S of v.features){const E=S.instancedDataOffset,A=S.instancedDataCount;for(let R=0;R<A;R++){const D=16*(R+E);let F=x.float32[D+0];const k=F>pt;F=k?F-pt:F;const U=Math.floor(F),q=Math.floor(x.float32[D+1]);let $=!1;for(const Y of this.activeReplacements)if(!S1(Y,a,Qg.Model,l)&&!(Y.min.x>U||U>Y.max.x||Y.min.y>q||q>Y.max.y)&&($=fm(xp(U,q,e.canonical,Y.footprintTileId.canonical),Y.footprint),$))break;x.float32[D]=$?F+pt:F,f=f||$!==k}}}return f}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,U4.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,a){const l=this.layers[0],h=l.layout.get("model-id").evaluate(a,{},this.canonical);if(!h)return Gt(`modelId is not evaluated for layer ${l.id} and it is not going to get rendered.`),h;(J_(h,!1)||this.styleDefinedModelURLs[h]!==void 0)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new t3);const f=this.instancesPerModel[h],m=f.instancedDataArray,v=new e3(a,m.length);for(const x of i)for(const S of x){if(S.x<0||S.x>=pt||S.y<0||S.y>=pt)continue;if(this.lookupDim!==0){const A=(this.lookupDim-1)/pt,R=this.lookupDim*(S.y*A|0)+S.x*A|0;if(this.lookup){if(this.lookup[R]!==0)continue;this.lookup[R]=1}}this.instanceCount++;const E=m.length;m.resize(E+1),f.instancesEvaluatedElevation.push(0),m.float32[16*E]=S.x,m.float32[16*E+1]=S.y}return v.instancedDataCount=f.instancedDataArray.length-v.instancedDataOffset,v.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(v),this.evaluate(v,{},f,!1)),h}getModelUris(){return this.modelUris}evaluate(e,i,a,l){const h=this.layers[0],f=e.feature,m=this.canonical,v=e.rotation=h.paint.get("model-rotation").evaluate(f,i,m),x=e.scale=h.paint.get("model-scale").evaluate(f,i,m),S=e.translation=h.paint.get("model-translation").evaluate(f,i,m),E=Object.assign({},h.paint.get("model-color").evaluate(f,i,m));E.a=h.paint.get("model-color-mix-intensity").evaluate(f,i,m);const A=[];this.maxVerticalOffset<S[2]&&(this.maxVerticalOffset=S[2]);const R=S[0]*S[0]+S[1]*S[1],D=R>0?Math.sqrt(R):0;a.maxScale=Math.max(Math.max(a.maxScale,x[0]),Math.max(x[1],x[2])),a.maxXYTranslationDistance=Math.max(a.maxXYTranslationDistance,D),this.maxScale=Math.max(Math.max(this.maxScale,x[0]),Math.max(x[1],x[2])),z2(A,v,x);const F=Math.round(100*E.a)+E.b/1.05;for(let k=0;k<e.instancedDataCount;++k){const U=e.instancedDataOffset+k,q=16*U,$=a.instancedDataArray.float32;let Y=0;l&&(Y=$[q+6]-a.instancesEvaluatedElevation[U]);const le=0|$[q+1];$[q]=(0|$[q])+E.r/1.05,$[q+1]=le+E.g/1.05,$[q+2]=F,$[q+3]=1/(m.z>10?this.tileToMeter:ue(m,le)),$[q+4]=S[0],$[q+5]=S[1],$[q+6]=S[2]+Y,$[q+7]=A[0],$[q+8]=A[1],$[q+9]=A[2],$[q+10]=A[4],$[q+11]=A[5],$[q+12]=A[6],$[q+13]=A[8],$[q+14]=A[9],$[q+15]=A[10],a.instancesEvaluatedElevation[U]=S[2]}}}let i3,n3;st(Q_,"ModelBucket",{omit:["layers"]}),st(t3,"PerModelAttributes"),st(e3,"ModelFeature");class Lp{constructor(e,i,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(e,i,a){const l=a||e.findDEMTileFor(i);if(!l||!l.dem)return;const h=l.dem,f=l.tileID,m=1<<i.canonical.z-f.canonical.z;return new Lp(l,h.dim/pt/m,[(i.canonical.x/m-f.canonical.x)*h.dim,(i.canonical.y/m-f.canonical.y)*h.dim])}tileCoordToPixel(e,i){const a=i*this._scale+this._offset[1];return new nt(Math.floor(e*this._scale+this._offset[0]),Math.floor(a))}getElevationAt(e,i,a,l){const h=e*this._scale+this._offset[0],f=i*this._scale+this._offset[1],m=Math.floor(h),v=Math.floor(f),x=this._dem;return l=!!l,a?ti(ti(x.get(m,v,l),x.get(m,v+1,l),f-v),ti(x.get(m+1,v,l),x.get(m+1,v+1,l),f-v),h-m):x.get(m,v,l)}getElevationAtPixel(e,i,a){return this._dem.get(e,i,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Z(1,e)*this._dem.stride}}const e2=new Float32Array(262144),k1=new Uint8Array(262144);function r3(n){let e=0;if(n.meshes)for(const i of n.meshes)e=Math.max(e,i.aabb.max[2]);if(n.children)for(const i of n.children)e=Math.max(e,r3(i));return e}function a3(n,e,i){if(n.meshes)for(const a of n.meshes){if(a.aabb.min[0]===1/0)continue;const l=Si.applyTransform(a.aabb,n.globalMatrix);i.insert(e,l.min[0],l.min[1],l.max[0],l.max[1])}if(n.children)for(const a of n.children)a3(a,e,i)}const o3=["","wall","door","roof","window","lamp","logo"];class s3{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:r3(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Si([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Si([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=Si.applyTransformFast(a.aabb,this.node.globalMatrix),i.encapsulate(a.transformedAabb)),e++;this.aabb=i}return this.aabb}}class K0{constructor(e,i,a,l,h,f,m,v){this.id=a,this.layers=e,this.layerIds=this.layers.map((x=>x.fqid)),this.stateDependentLayerIds=this.layers.filter((x=>x.isStateDependent())).map((x=>x.id)),this.modelTraits|=Ep.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,l&&(this.modelTraits|=Ep.HasMapboxMeshFeatures),h&&(this.modelTraits|=Ep.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.worldview=v,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const x of i)this.nodesInfo.push(new s3(x)),a3(x,m.featureIndexArray.length,m.grid),m.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,m.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,i){for(const a of this.getNodesInfo()){const l=a.node;l.footprint&&i.push({footprint:l.footprint,id:e})}}updateAppearances(e,i,a,l){}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const a=i?this.stateDependentLayers:this.layers;if(!ll(e,this.states))for(const l of a)this.evaluate(l,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const a of i){const l=a.node;this.uploaded?this.updatePbrBuffer(l):E_(l,e,!0)}for(const a of i)D0(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),i=!0);return i}needsReEvaluation(e,i,a){const l=e.transform.projectionOptions,h=e.style.getBrightness(),f=this.brightness!==h;if(!this.uploaded||this.dirty||l.name!==this.projection.name||Nm(a.paint.get("model-color").value,f)||Nm(a.paint.get("model-color-mix-intensity").value,f)||Nm(a.paint.get("model-roughness").value,f)||Nm(a.paint.get("model-emissive-strength").value,f)||Nm(a.paint.get("model-height-based-emissive-strength-multiplier").value,f)){this.projection=l,this.brightness=h;const m=this.getNodesInfo();for(const v of m)v.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),l=this.id.canonical;for(const h of a){const f=h.feature;h.evaluatedTranslation=i.paint.get("model-translation").evaluate(f,{},l),h.evaluatedScale=i.paint.get("model-scale").evaluate(f,{},l)}}evaluate(e,i){const a=this.getNodesInfo();for(const l of a){if(!l.node.meshes)continue;const h=l.feature,f=i&&i[h.id];if(ll(f,l.state))continue;l.state=structuredClone(f);const m=l.node.meshes&&l.node.meshes[0].featureData,v=l.evaluatedColor[2],x=l.evaluatedRMEA[2],S=this.id.canonical;if(l.hasTranslucentParts=!1,m){for(let E=0;E<o3.length;E++){const A=o3[E];A.length&&(h.properties.part=A);const R=e.paint.get("model-color").evaluate(h,f,S).toPremultipliedRenderColor(null),D=e.paint.get("model-color-mix-intensity").evaluate(h,f,S);l.evaluatedColor[E]=[R.r,R.g,R.b,D],l.evaluatedRMEA[E][0]=e.paint.get("model-roughness").evaluate(h,f,S),l.evaluatedRMEA[E][2]=e.paint.get("model-emissive-strength").evaluate(h,f,S),l.evaluatedRMEA[E][3]=R.a,l.emissionHeightBasedParams[E]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,f,S),!l.hasTranslucentParts&&R.a<1&&(l.hasTranslucentParts=!0)}delete h.properties.part,m5(l,v!==l.evaluatedColor[2]||x!==l.evaluatedRMEA[2],this.modelTraits)}else l.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(h,f,S);l.evaluatedTranslation=e.paint.get("model-translation").evaluate(h,f,S),l.evaluatedScale=e.paint.get("model-scale").evaluate(h,f,S),this.updatePbrBuffer(l.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,a,l){const h=e.findDEMTileFor(a);if(h&&(h.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;const f=Lp.create(e,a,h);if(!f)return;this.modelTraits&Ep.HasMapboxMeshFeatures&&this.updateDEM(e,f,a,l);for(const m of this.getNodesInfo()){const v=m.node;if(!v.footprint||!v.footprint.vertices||!v.footprint.vertices.length)continue;const x=v.footprint.vertices;let S=f.getElevationAt(x[0].x,x[0].y,!0,!0);for(let E=1;E<x.length;E++)S=Math.min(S,f.getElevationAt(x[E].x,x[E].y,!0,!0));v.elevation=S}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,a,l){let h=i._dem._modifiedForSources[l];if(h===void 0&&(i._dem._modifiedForSources[l]=[],h=i._dem._modifiedForSources[l]),h.includes(a.canonical))return;const f=i._dem.dim;h.push(a.canonical);let m=!1;for(const v of this.getNodesInfo()){const x=v.node;if(!x.footprint||!x.footprint.grid)continue;const S=x.footprint.grid,E=i.tileCoordToPixel(S.min.x,S.min.y),A=i.tileCoordToPixel(S.max.x,S.max.y),R=Math.min(Math.min(f-A.y,E.x),Math.min(E.y,f-A.x));if(R<0)continue;const D=G(R,2,5);let F=Math.max(0,E.x-D),k=Math.max(0,E.y-D),U=Math.min(A.x+D,f-1),q=Math.min(A.y+D,f-1);for(let ne=k;ne<=q;++ne)for(let de=F;de<=U;++de)k1[ne*f+de]=255;let $=0,Y=0;for(let ne=0;ne<S.cellsY;++ne)for(let de=0;de<S.cellsX;++de){if(!S.cells[ne*S.cellsX+de])continue;const _e=i.tileCoordToPixel(S.min.x+de/S.xScale,S.min.y+ne/S.yScale),ye=i.tileCoordToPixel(S.min.x+(de+1)/S.xScale,S.min.y+(ne+1)/S.yScale);for(let Be=_e.y;Be<=Math.min(ye.y+1,f-1);++Be)for(let Ee=_e.x;Ee<=Math.min(ye.x+1,f-1);++Ee)k1[Be*f+Ee]===255&&(k1[Be*f+Ee]=0,$+=i.getElevationAtPixel(Ee,Be),Y++)}const le=$/Y;F=Math.max(1,E.x-D),k=Math.max(1,E.y-D),U=Math.min(A.x+D,f-2),q=Math.min(A.y+D,f-2),m=!0;for(let ne=k;ne<=q;++ne)for(let de=F;de<=U;++de)k1[ne*f+de]===0&&(e2[ne*f+de]=i._dem.set(de,ne,le));for(let ne=1;ne<D;++ne){F=Math.max(1,E.x-ne),k=Math.max(1,E.y-ne),U=Math.min(A.x+ne,f-2),q=Math.min(A.y+ne,f-2);for(let de=k;de<=q;++de)for(let _e=F;_e<=U;++_e){const ye=de*f+_e;if(k1[ye]===255){let Be=0,Ee=0,Ve=-1,Xe=-1;for(let tt=-1;tt<=1;++tt)for(let gt=-1;gt<=1;++gt){const ot=(de+tt)*f+_e+gt;if(k1[ot]>=ne)continue;const Ye=e2[ot],at=Math.abs(Ye);at>Ee&&(Be=Ye,Ee=at,Ve=gt,Xe=tt)}if(Ee>.1){const tt=1-(ne+.5*Math.abs(Ve*Xe))/D;let gt=i._dem.get(_e,de)+Be*tt;const ot=i._dem.get(_e+Ve,de+Xe),Ye=i._dem.get(_e-Ve,de-Xe,!0);(gt-ot)*(gt-Ye)>0&&(gt=(ot+Ye)/2),e2[ye]=i._dem.set(_e,de,gt),k1[ye]=ne}}}}}m&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=_a.now())}setFilter(e){this.filter=e?Qh(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((e=>this.filter.filter(new mn(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical))):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)D0(i.node),A_(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped());for(const l of this.getNodesInfo()){const h=l.node.footprint;l.hiddenByReplacement=!!h&&!a.find((f=>f.footprint===h))}}getHeightAtTileCoord(e,i){const a=[],l=[0,0,0],h=$i([]);for(const f of this.getNodesInfo()){const m=f.node.meshes[0],v=m.transformedAabb;if(e<v.min[0]||i<v.min[1]||e>v.max[0]||i>v.max[1])continue;if(f.node.hidden===!0)return{height:1/0,maxHeight:f.feature.properties.height,hidden:!1,verticalScale:f.evaluatedScale[2]};vn(h,f.node.globalMatrix),l[0]=e,l[1]=i,sr(l,l,h);const x=(l[0]-m.aabb.min[0])/(m.aabb.max[0]-m.aabb.min[0])*O1|0,S=Math.min(63,(l[1]-m.aabb.min[1])/(m.aabb.max[1]-m.aabb.min[1])*O1|0)*O1+Math.min(63,x),E=m.heightmap[S];if(!(E<0&&f.node.footprint))return f.hiddenByReplacement?void 0:{height:E,maxHeight:f.feature.properties.height,hidden:!1,verticalScale:f.evaluatedScale[2]};if(f.node.footprint.grid.query(new nt(e,i),new nt(e,i),a),a.length>0)return{height:void 0,maxHeight:f.feature.properties.height,hidden:f.hiddenByReplacement,verticalScale:f.evaluatedScale[2]}}}}function Nm(n,e){return n instanceof La&&!n.isLightConstant&&e}function p5(n,e,i,a,l,h,f,m){let v=(61440&e|(61440&e)>>4)>>8,x=(3840&e|(3840&e)>>4)>>4,S=240&e|(240&e)>>4;i[3]>0&&(v=ti(v,255*i[0],i[3]),x=ti(x,255*i[1],i[3]),S=ti(S,255*i[2],i[3]));const E=v<<8|x,A=S<<8|Math.floor(255*a[3]),R=(function(ne){const de=G(ne,0,2);return Math.min(Math.round(.5*de*255),255)})(a[2])<<8|15*a[0]<<4|15*a[1],D=G(l[0],0,1),F=G(l[1],0,1),k=G(l[2],0,1),U=G(l[3],0,1);let q,$,Y,le;if(D!==F&&f!==h&&F!==D){const ne=f-h;$=1/(ne*(F-D)),Y=-(h+ne*D)/(ne*(F-D));const de=G(l[4],-1,1);le=Math.pow(10,de),q=255*k<<8|255*U}else q=65535,$=0,Y=1,le=1;if(n.emplaceBack(E,A,R,q,$,Y,le),m){const ne=m.length;m.clear();for(let de=0;de<ne;de++)m.emplaceBack(E,A,R,q,$,Y,le)}}function m5(n,e,i){const a=n.node;let l=0;const h=i&Ep.HasMeshoptCompression;for(const f of a.meshes){if(a.lights&&a.lightMeshIndex===l||!f.featureData)continue;f.featureArray=new uc,f.featureArray.reserve(f.featureData.length);let m=e;for(const v of f.featureData){const x=h?65535&v:v>>16&65535,S=h?v>>16&65535:65535&v,E=(15&S)<8?15&S:0,A=n.evaluatedRMEA[E],R=n.evaluatedColor[E],D=n.emissionHeightBasedParams[E];let F;if(m&&E===2&&a.lights&&(F=new uc,F.resize(10*a.lights.length)),p5(f.featureArray,x,R,A,D,f.aabb.min[2],f.aabb.max[2],F),F&&m){m=!1;const k=a.meshes[a.lightMeshIndex];k.featureArray=F,k.featureArray._trim()}}f.featureArray._trim(),l++}}st(K0,"Tiled3dModelBucket",{omit:["layers"]}),st(s3,"Tiled3dModelFeature");const _5=["id","tile","layer","source","sourceLayer","state"];class N1{constructor(e,i,a,l,h){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=a,this._y=l,this.properties=e?e.properties:{},this.id=h}clone(){const e=new N1(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of _5)this[i]!==void 0&&(e[i]=this[i]);return e}}class U1 extends hl{constructor(e,i,a,l){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=i,this._modelsInfo=new Map}load(){const e=[];for(const i in this._options.models){const a=this._options.models[i],l=this._modelsInfo.get(i);if(l){const h=l.model;h.position=a.position!=null?new P(a.position[0],a.position[1]):new P(0,0),h.orientation=a.orientation!=null?a.orientation:[0,0,0],l.modelSpec=a,U1.applyModelSpecification(h,a),h.computeBoundsAndApplyParent(),this.models.push(h)}else{const h=A2(this.map._requestManager.transformRequest(a.uri,ss.Model).url).then((f=>{if(!f)return;const m=I_(f),v=new R2(i,a.uri,a.position,a.orientation,m);U1.applyModelSpecification(v,a),v.computeBoundsAndApplyParent(),this.models.push(v),this._modelsInfo.set(i,{modelSpec:a,model:v})})).catch((f=>{this.fire(new Gl(new Error(`Could not load model ${i} from ${a.uri}: ${f.message}`)))}));e.push(h)}}Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new Ra("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((i=>{this._loaded=!0,this.fire(new Gl(new Error(`Could not load models: ${i.message}`)))}))}static applyModelSpecification(e,i){i.nodeOverrides&&U1.convertNodeOverrides(e,i.nodeOverrides),i.materialOverrides&&U1.convertMaterialOverrides(e,i.materialOverrides),i.nodeOverrideNames&&(e.nodeOverrideNames=[...i.nodeOverrideNames]),i.materialOverrideNames&&(e.materialOverrideNames=[...i.materialOverrideNames]),i.featureProperties&&(e.featureProperties=i.featureProperties)}static convertNodeOverrides(e,i){if(Array.isArray(i)&&i.every((a=>typeof a=="string"))){e.nodeOverrideNames=[];for(const a of i)e.nodeOverrideNames.push(a)}else Object.entries(i).forEach((([a,l])=>{const h={orientation:[0,0,0]};if(l.hasOwnProperty("orientation")){const f=l.orientation;f&&(h.orientation=f)}e.nodeOverrides.set(a,h)}))}static convertMaterialOverrides(e,i){if(Array.isArray(i)&&i.every((a=>typeof a=="string"))){e.materialOverrideNames=[];for(const a of i)e.materialOverrideNames.push(a)}else Object.entries(i).forEach((([a,l])=>{const h={color:new pn(1,1,1),colorMix:0,emissionStrength:0,opacity:1},f=l["model-color"];f!==void 0&&(h.color.r=f[0],h.color.g=f[1],h.color.b=f[2]);const m=l["model-color-mix-intensity"];m!==void 0&&(h.colorMix=m);const v=l["model-emissive-strength"];v!==void 0&&(h.emissionStrength=v);const x=l["model-opacity"];x!==void 0&&(h.opacity=x),e.materialOverrides.set(a,h)}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,i){}serialize(){return this._options}setProperty(e,i){return!1}reload(){const e=Xc(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];const i=new Map;for(const a in e){const l=e[a];if(this._modelsInfo.has(a)){const h=this._modelsInfo.get(a);h&&h.modelSpec.uri===l.uri&&i.set(a,h)}}this._modelsInfo=i,this._options.models=e,this._loaded=!1,this.load()}}function t2(n,e,i,a){const l=1<<n.z;e.lat=W((a/pt+n.y)/l),e.lng=K((i/pt+n.x)/l)}function g5(n,e,i,a){const l=n.getNodesInfo()[e];if(!l||l.hiddenByReplacement||!l.node.meshes)return;let h=Number.MAX_VALUE;const f=l.node,m=i.tile,v=a.calculatePosMatrix(m.tileID.toUnwrapped(),a.worldSize),x=l.evaluatedScale;let S=0;a.elevation&&f.elevation&&(S=f.elevation*a.elevation.exaggeration()),ki(v,v,[(f.anchor?f.anchor[0]:0)*(x[0]-1),(f.anchor?f.anchor[1]:0)*(x[1]-1),S]),si(v,v,x);const E=i.queryGeometry,A=E.isPointQuery()?E.screenBounds:E.screenGeometry,R=function(F){const k=Ci([],v,F.globalMatrix);Ci(k,a.expandedFarZProjMatrix,k);for(let U=0;U<F.meshes.length;++U){const q=F.meshes[U];if(U===F.lightMeshIndex)continue;const $=S_(A,a,k,q.aabb);$!=null&&(h=Math.min($,h))}if(F.children)for(const U of F.children)R(U)};if(R(f),h===Number.MAX_VALUE)return;const D=new P(0,0);return t2(m.tileID.canonical,D,l.node.anchor[0],l.node.anchor[1]),{intersectionZ:h,position:D,feature:l.feature}}const y5={circle:class extends ya{constructor(n,e,i,a){super(n,{layout:es||(es=new fr({"circle-sort-key":new It(Se.layout_circle["circle-sort-key"]),"circle-elevation-reference":new ut(Se.layout_circle["circle-elevation-reference"]),visibility:new ut(Se.layout_circle.visibility)})),paint:dc||(dc=new fr({"circle-radius":new It(Se.paint_circle["circle-radius"]),"circle-color":new It(Se.paint_circle["circle-color"]),"circle-blur":new It(Se.paint_circle["circle-blur"]),"circle-opacity":new It(Se.paint_circle["circle-opacity"]),"circle-translate":new ut(Se.paint_circle["circle-translate"]),"circle-translate-anchor":new ut(Se.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ut(Se.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ut(Se.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new It(Se.paint_circle["circle-stroke-width"]),"circle-stroke-color":new It(Se.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new It(Se.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ut(Se.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}createBucket(n){return new Dn(n)}queryRadius(n){const e=n;return Jr("circle-radius",this,e)+Jr("circle-stroke-width",this,e)+or(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,a,l,h,f,m){const v=iu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,n.pixelToTileUnitsFactor),x=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return cp(n,a,h,f,m,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",v,x)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,i){const a=i0(this);return{config:new ys(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}is3D(n){return!n&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends ya{createBucket(n){return new up(n)}constructor(n,e,i,a){super(n,{layout:r0||(r0=new fr({visibility:new ut(Se.layout_heatmap.visibility)})),paint:a0||(a0=new fr({"heatmap-radius":new It(Se.paint_heatmap["heatmap-radius"]),"heatmap-weight":new It(Se.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ut(Se.paint_heatmap["heatmap-intensity"]),"heatmap-color":new jc(Se.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ut(Se.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=fd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(n){return Jr("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,a,l,h,f,m){const v=this.paint.get("heatmap-radius").evaluate(e,i);return cp(n,a,h,f,m,!0,!0,new nt(0,0),v)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,i){return n==="heatmap"?{config:new ys(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends ya{constructor(n,e,i,a){super(n,{layout:ff||(ff=new fr({visibility:new ut(Se.layout_hillshade.visibility)})),paint:o0||(o0=new fr({"hillshade-illumination-direction":new ut(Se.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ut(Se.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ut(Se.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ut(Se.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ut(Se.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ut(Se.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ut(Se.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}},fill:class extends ya{constructor(n,e,i,a){super(n,{layout:md||(md=new fr({"fill-sort-key":new It(Se.layout_fill["fill-sort-key"]),visibility:new ut(Se.layout_fill.visibility),"fill-elevation-reference":new ut(Se.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new It(Se.layout_fill["fill-construct-bridge-guard-rail"])})),paint:um||(um=new fr({"fill-antialias":new ut(Se.paint_fill["fill-antialias"]),"fill-opacity":new It(Se.paint_fill["fill-opacity"]),"fill-color":new It(Se.paint_fill["fill-color"]),"fill-outline-color":new It(Se.paint_fill["fill-outline-color"]),"fill-translate":new ut(Se.paint_fill["fill-translate"]),"fill-translate-anchor":new ut(Se.paint_fill["fill-translate-anchor"]),"fill-pattern":new It(Se.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new ut(Se.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new ut(Se.paint_fill["fill-emissive-strength"]),"fill-z-offset":new It(Se.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new It(Se.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new It(Se.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(n,e,i){return{config:new ys(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new cm(n)}queryRadius(){return or(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,a,l,h){return!n.queryGeometry.isAboveHorizon&&rr(vo(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,n.pixelToTileUnitsFactor),a)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(n){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return n!=null?e&&!n:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends ya{constructor(n,e,i,a){super(n,{layout:R1||(R1=new fr({visibility:new ut(Se["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ut(Se["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:ym||(ym=new fr({"fill-extrusion-opacity":new ut(Se["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new It(Se["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ut(Se["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ut(Se["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new It(Se["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new ut(Se["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new It(Se["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new It(Se["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new ut(Se["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new ut(Se["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new ut(Se["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ut(Se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ut(Se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ut(Se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ut(Se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ut(Se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ut(Se["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ut(Se["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new It(Se["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new It(Se["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ut(Se["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ut(Se["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ut(Se["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ut(Se["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new It(Se["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new It(Se["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new ut(Se["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new Rl(n)}queryRadius(){return or(this.paint.get("fill-extrusion-translate"))}is3D(n){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,i,a,l,h,f,m,v){const x=iu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,n.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(e,i),E=this.paint.get("fill-extrusion-base").evaluate(e,i),A=[0,0],R=m&&h.elevation,D=h.elevation?h.elevation.exaggeration():1,F=n.tile.getBucket(this);if(R&&F instanceof Rl){const Y=F.centroidVertexArray,le=v+1;le<Y.length&&(A[0]=Y.geta_centroid_pos0(le),A[1]=Y.geta_centroid_pos1(le))}if(A[0]===0&&A[1]===1)return!1;h.projection.name==="globe"&&(a=T0([a],[new nt(0,0),new nt(pt,pt)],n.tileID.canonical).map((Y=>Y.polygon)).flat());const k=R?m:null,[U,q]=L1(h,a,E,S,x,f,k,A,D,h.center.lat,n.tileID.canonical),$=n.queryGeometry;return A0(U,q,$.isPointQuery()?$.screenBounds:$.screenGeometry)}},building:class extends ya{constructor(n,e,i,a){super(n,{layout:N2||(N2=new fr({visibility:new ut(Se.layout_building.visibility),"building-facade":new It(Se.layout_building["building-facade"]),"building-facade-floors":new It(Se.layout_building["building-facade-floors"]),"building-facade-unit-width":new It(Se.layout_building["building-facade-unit-width"]),"building-facade-window":new It(Se.layout_building["building-facade-window"]),"building-roof-shape":new It(Se.layout_building["building-roof-shape"]),"building-height":new It(Se.layout_building["building-height"]),"building-base":new It(Se.layout_building["building-base"]),"building-flood-light-wall-radius":new It(Se.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new It(Se.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new It(Se.layout_building["building-flip-roof-orientation"])})),paint:U2||(U2=new fr({"building-opacity":new ut(Se.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new ut(Se.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new ut(Se.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new ut(Se.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new ut(Se.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new ut(Se.paint_building["building-vertical-scale"]),"building-cast-shadows":new ut(Se.paint_building["building-cast-shadows"]),"building-color":new It(Se.paint_building["building-color"]),"building-emissive-strength":new It(Se.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new ut(Se.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new ut(Se.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new ut(Se.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new ut(Se.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new ut(Se.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new k2(n)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(n){return!0}queryRadius(n){return 0}queryIntersectsFeature(n,e,i,a,l,h,f,m,v){let x=this.layout.get("building-height").evaluate(e,i);const S=this.layout.get("building-base").evaluate(e,i),E=n.tile.getBucket(this).getFootprint(e);if(E){if(E.hiddenFlags!==0)return!1;x=E.height}const[A,R]=L1(h,a,S,x,new nt(0,0),f,null,[0,0],1,h.center.lat,n.tileID.canonical),D=n.queryGeometry;return A0(A,R,D.isPointQuery()?D.screenBounds:D.screenGeometry)}},line:class extends ya{constructor(n,e,i,a){const l=Y2();super(n,l,e,i,a),l.layout&&(this.layout=new rc(l.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ps,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if(Sm)return Sm;const i=Y2();return Sm=new py(i.paint.properties["line-width"].specification),Sm.useIntegerZoom=!0,Sm})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new z_(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,i){const a=$2(this);return{config:new ys(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}queryRadius(n){const e=n,i=K2(Jr("line-width",this,e),Jr("line-gap-width",this,e)),a=Jr("line-offset",this,e);return i/2+Math.abs(a)+or(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,a,l,h){if(n.queryGeometry.isAboveHorizon)return!1;const f=vo(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,n.pixelToTileUnitsFactor),m=n.pixelToTileUnitsFactor/2*K2(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),v=this.paint.get("line-offset").evaluate(e,i);return v&&(a=(function(x,S){const E=[],A=new nt(0,0);for(let R=0;R<x.length;R++){const D=x[R],F=[];for(let k=0;k<D.length;k++){const U=D[k],q=D[k+1],$=k===0?A:U.sub(D[k-1])._unit()._perp(),Y=k===D.length-1?A:q.sub(U)._unit()._perp(),le=$._add(Y)._unit();le._mult(1/(le.x*Y.x+le.y*Y.y)),F.push(le._mult(S)._add(U))}E.push(F)}return E})(a,v*n.pixelToTileUnitsFactor)),(function(x,S,E){for(let A=0;A<S.length;A++){const R=S[A];if(x.length>=3){for(let D=0;D<R.length;D++)if(aa(x,R[D]))return!0}if(qa(x,R,E))return!0}return!1})(f,a,m)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(n){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:X0,background:class extends ya{constructor(n,e,i,a){super(n,{layout:Ug||(Ug=new fr({visibility:new ut(Se.layout_background.visibility)})),paint:Vg||(Vg=new fr({"background-pitch-alignment":new ut(Se.paint_background["background-pitch-alignment"]),"background-color":new ut(Se.paint_background["background-color"]),"background-pattern":new ut(Se.paint_background["background-pattern"]),"background-opacity":new ut(Se.paint_background["background-opacity"]),"background-emissive-strength":new ut(Se.paint_background["background-emissive-strength"]),"background-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}is3D(n){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Zg,"raster-particle":Jg,sky:class extends ya{constructor(n,e,i,a){super(n,{layout:Wg||(Wg=new fr({visibility:new ut(Se.layout_sky.visibility)})),paint:Yg||(Yg=new fr({"sky-type":new ut(Se.paint_sky["sky-type"]),"sky-atmosphere-sun":new ut(Se.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ut(Se.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ut(Se.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ut(Se.paint_sky["sky-gradient-radius"]),"sky-gradient":new jc(Se.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ut(Se.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ut(Se.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ut(Se.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=fd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),l=!a,h=n.style.light,f=h.properties.get("position");return l&&h.properties.get("anchor")==="viewport"&&Gt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?K_(f.azimuthal,90-f.polar,e):K_(a[0],90-a[1],e)}const i=this.paint.get("sky-gradient-center");return K_(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends ya{constructor(n,e,i,a){super(n,{paint:Kg||(Kg=new fr({}))},e,null)}},model:class extends ya{constructor(n,e,i,a){super(n,{layout:i3||(i3=new fr({visibility:new ut(Se.layout_model.visibility),"model-id":new It(Se.layout_model["model-id"])})),paint:n3||(n3=new fr({"model-opacity":new It(Se.paint_model["model-opacity"]),"model-rotation":new It(Se.paint_model["model-rotation"]),"model-scale":new It(Se.paint_model["model-scale"]),"model-translation":new It(Se.paint_model["model-translation"]),"model-color":new It(Se.paint_model["model-color"]),"model-color-mix-intensity":new It(Se.paint_model["model-color-mix-intensity"]),"model-type":new ut(Se.paint_model["model-type"]),"model-cast-shadows":new ut(Se.paint_model["model-cast-shadows"]),"model-receive-shadows":new ut(Se.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ut(Se.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new It(Se.paint_model["model-emissive-strength"]),"model-roughness":new It(Se.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new It(Se.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ut(Se.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new ut(Se.paint_model["model-front-cutoff"]),"model-elevation-reference":new ut(Se.paint_model["model-elevation-reference"]),"model-color-use-theme":new It({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this.layer=n,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new Q_(n)}getProgramIds(){return["model"]}is3D(n){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof K0?pt-1:0}queryRenderedFeatures(n,e,i){const a=e.getSource();if(!(a&&a instanceof U1))return{};const l=a,h={};h[this.id]=[];const f=h[this.id];let m=0;for(const v of l.models){const x=e.getFeatureState(this.sourceLayer,v.id),S={type:"Unknown",id:v.id,properties:v.featureProperties},E=this.paint.get("model-rotation").evaluate(S,x),A=this.paint.get("model-scale").evaluate(S,x),R=this.paint.get("model-translation").evaluate(S,x),D=this.paint.get("model-elevation-reference");let F=[];R0(F,v,i,v.position,E,A,R,D==="ground",D==="ground",!1),i.projection.name==="globe"&&(F=z0(F,i));const k=Ci([],i.projMatrix,F),U=S_(n.isPointQuery()?n.screenBounds:n.screenGeometry,i,k,v.aabb);if(U!=null){const q=new N1(void 0,0,0,0,v.id);q.layer=this.layer,q.properties=structuredClone(v.featureProperties),q.properties.layer=this.id,q.properties.uri=v.uri,q.properties.orientation=v.orientation,q.sourceLayer=this.sourceLayer,q.geometry={type:"Point",coordinates:[v.position.lng,v.position.lat]},q.state=x,q.source=this.source,f.push({featureIndex:m,feature:q,intersectionZ:U})}++m}return h}queryIntersectsFeature(n,e,i,a,l,h){if(!this.modelManager)return!1;const f=this.modelManager,m=n.tile.getBucket(this);if(!(m&&m instanceof Q_))return!1;for(const v in m.instancesPerModel){const x=m.instancesPerModel[v],S=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(x.idToFeaturesIndex.hasOwnProperty(S)){const E=x.features[x.idToFeaturesIndex[S]],A=f.getModel(v,this.scope);if(!A)return!1;let R=[];const D=new P(0,0),F=m.canonical;let k=Number.MAX_VALUE;for(let U=0;U<E.instancedDataCount;++U){const q=16*(E.instancedDataOffset+U),$=x.instancedDataArray.float32,Y=[$[q+4],$[q+5],$[q+6]];t2(F,D,Math.floor($[q]),Math.floor($[q+1])),R0(R,A,h,D,E.rotation,E.scale,Y,!1,!1,!1),h.projection.name==="globe"&&(R=z0(R,h));const le=Ci([],h.projMatrix,R),ne=n.queryGeometry,de=S_(ne.isPointQuery()?ne.screenBounds:ne.screenGeometry,h,le,A.aabb);de!=null&&(k=Math.min(de,k))}return k!==Number.MAX_VALUE&&k}}return!1}_handleOverridablePaintPropertyUpdate(n,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof ga}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends ya{constructor(n,e,i,a){super(n,{layout:f0||(f0=new fr({"clip-layer-types":new ut(Se.layout_clip["clip-layer-types"]),"clip-layer-scope":new ut(Se.layout_clip["clip-layer-scope"])})),paint:p0||(p0=new fr({}))},e,i,a)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new m0(n)}is3D(n){return!0}}},i2=new pn(0,0,0),n2={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},r2={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},J0={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},v5={PAINT_ORDER_FILL_AND_STROKE:1},Um={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},l3={MASK_TYPE_LUMINANCE:1};function x5(n,e,i){n===1&&e.icons.push((function(a,l){return(function(h){if(h.usvg_tree.height||(h.usvg_tree.height=h.usvg_tree.width),!h.metadata)return h;const{metadata:f}=h;if(f.content_area){const{content_area:m}=f;m.left==null&&(m.left=0),m.top==null&&(m.top=m.left),m.width==null&&(m.width=h.usvg_tree.width),m.height==null&&(m.height=m.width)}if(f.text_placeholder){const{text_placeholder:m}=f;m.top==null&&(m.top=m.left),m.height==null&&(m.height=m.width)}return f.stretch_x&&f.stretch_x.length&&c3(f,"x"),f.stretch_y&&f.stretch_y.length&&c3(f,"y"),h})(a.readFields(b5,{name:void 0},l))})(i,i.readVarint()+i.pos))}function c3(n,e){const i=[],a=n[`stretch_${e}`];let l=null;for(let h=0;h<a.length;h++)l===null?l=i.length===0?a[0]:i[i.length-1][1]+a[h]:(i.push([l,l+a[h]]),l=null);n[`stretch_${e}_areas`]=i}function b5(n,e,i){n===1?e.name=i.readString():n===2?e.metadata=(function(a,l){return a.readFields(w5,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},l)})(i,i.readVarint()+i.pos):n===3&&(e.usvg_tree=(function(a,l){return a.readFields(E5,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},l)})(i,i.readVarint()+i.pos),e.data="usvg_tree")}function w5(n,e,i){n===1?e.stretch_x=i.readPackedVarint():n===2?e.stretch_y=i.readPackedVarint():n===3?e.content_area=u3(i,i.readVarint()+i.pos):n===4?e.variables.push((function(a,l){return a.readFields(S5,{name:void 0},l)})(i,i.readVarint()+i.pos)):n===5&&(e.text_placeholder=u3(i,i.readVarint()+i.pos))}function u3(n,e){return n.readFields(T5,{},e)}function T5(n,e,i){n===1?e.left=i.readVarint():n===2?e.width=i.readVarint():n===3?e.top=i.readVarint():n===4&&(e.height=i.readVarint())}function S5(n,e,i){n===1?e.name=i.readString():n===2&&(e.rgb_color=t_(i.readVarint()),e.value="rgb_color")}function E5(n,e,i){n===1?e.width=e.height=i.readVarint():n===2?e.height=i.readVarint():n===3?e.children.push(Q0(i,i.readVarint()+i.pos)):n===4?e.linear_gradients.push((function(a,l){return a.readFields(D5,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},l)})(i,i.readVarint()+i.pos)):n===5?e.radial_gradients.push((function(a,l){return a.readFields(L5,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},l)})(i,i.readVarint()+i.pos)):n===7?e.clip_paths.push((function(a,l){return a.readFields(O5,{children:[]},l)})(i,i.readVarint()+i.pos)):n===8&&e.masks.push((function(a,l){const h=a.readFields(F5,{left:0,width:20,mask_type:l3.MASK_TYPE_LUMINANCE,children:[]},l);return h.height==null&&(h.height=h.width),h.top==null&&(h.top=h.left),h})(i,i.readVarint()+i.pos))}function Q0(n,e){return n.readFields(A5,{},e)}function A5(n,e,i){n===1?(e.group=(function(a,l){return a.readFields(M5,{opacity:255,children:[]},l)})(i,i.readVarint()+i.pos),e.node="group"):n===2&&(e.path=(function(a,l){return a.readFields(C5,{paint_order:1,commands:[],step:1,diffs:[],rule:n2.PATH_RULE_NON_ZERO},l)})(i,i.readVarint()+i.pos),e.node="path")}function M5(n,e,i){n===1?e.transform=e_(i,i.readVarint()+i.pos):n===2?e.opacity=i.readVarint():n===5?e.clip_path_idx=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(Q0(i,i.readVarint()+i.pos))}function e_(n,e){return n.readFields(I5,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function I5(n,e,i){n===1?e.sx=i.readFloat():n===2?e.ky=i.readFloat():n===3?e.kx=i.readFloat():n===4?e.sy=i.readFloat():n===5?e.tx=i.readFloat():n===6&&(e.ty=i.readFloat())}function C5(n,e,i){n===1?e.fill=(function(a,l){return a.readFields(z5,{rgb_color:i2,paint:"rgb_color",opacity:255},l)})(i,i.readVarint()+i.pos):n===2?e.stroke=(function(a,l){return a.readFields(R5,{rgb_color:i2,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},l)})(i,i.readVarint()+i.pos):n===3?e.paint_order=i.readVarint():n===5?i.readPackedVarint(e.commands):n===6?e.step=i.readFloat():n===7?i.readPackedSVarint(e.diffs):n===8&&(e.rule=i.readVarint())}function z5(n,e,i){n===1?(e.rgb_color=t_(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5&&(e.opacity=i.readVarint())}function t_(n){return new pn((n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1)}function R5(n,e,i){n===1?(e.rgb_color=t_(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5?i.readPackedFloat(e.dasharray):n===6?e.dashoffset=i.readFloat():n===7?e.miterlimit=i.readFloat():n===8?e.opacity=i.readVarint():n===9?e.width=i.readFloat():n===10?e.linecap=i.readVarint():n===11&&(e.linejoin=i.readVarint())}function D5(n,e,i){n===1?e.transform=e_(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(h3(i,i.readVarint()+i.pos)):n===4?e.x1=i.readFloat():n===5?e.y1=i.readFloat():n===6?e.x2=i.readFloat():n===7&&(e.y2=i.readFloat())}function h3(n,e){return n.readFields(P5,{offset:0,opacity:255,rgb_color:i2},e)}function P5(n,e,i){n===1?e.offset=i.readFloat():n===2?e.opacity=i.readVarint():n===3&&(e.rgb_color=t_(i.readVarint()))}function L5(n,e,i){n===1?e.transform=e_(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(h3(i,i.readVarint()+i.pos)):n===4?e.cx=i.readFloat():n===5?e.cy=i.readFloat():n===6?e.r=i.readFloat():n===7?e.fx=i.readFloat():n===8?e.fy=i.readFloat():n===9&&(e.fr=i.readFloat())}function O5(n,e,i){n===1?e.transform=e_(i,i.readVarint()+i.pos):n===2?e.clip_path_idx=i.readVarint():n===3&&e.children.push(Q0(i,i.readVarint()+i.pos))}function F5(n,e,i){n===1?e.left=e.top=i.readFloat():n===2?e.width=e.height=i.readFloat():n===3?e.top=i.readFloat():n===4?e.height=i.readFloat():n===5?e.mask_type=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(Q0(i,i.readVarint()+i.pos))}class B5{static calculate(e={},i=[]){const a=new Map,l=new Map;if(Object.keys(e).length===0)return a;i.forEach((h=>{l.set(h.name,h.rgb_color||new pn(0,0,0))}));for(const[h,f]of Object.entries(e))l.has(h)?a.set(l.get(h).toString(),f):console.warn(`Ignoring unknown image variable "${h}"`);return a}}function Op(n,e=255,i){const a=e/255,l=n.toString(),h=i.has(l)?i.get(l).clone():n.clone();return h.a*=a,h.toString()}function Vm(n,e){if(!ka()){const i=document.createElement("canvas");return i.width=n,i.height=e,i}return new OffscreenCanvas(n,e)}function k5(n,e){const i=B5.calculate(e.params,n.metadata?n.metadata.variables:[]),a=n.usvg_tree,l=a.width,h=a.height,f=e.transform?e.transform:new DOMMatrix,m=Math.max(1,Math.round(l*f.a)),v=Math.max(1,Math.round(h*f.d)),x=new DOMMatrix([m/l,0,0,v/h,0,0]),S=Vm(m,v).getContext("2d");return a2(S,x,a,a,i),S.getImageData(0,0,m,v)}function a2(n,e,i,a,l){for(const h of a.children)d3(n,e,i,h,l)}function d3(n,e,i,a,l){a.group?(n.save(),(function(h,f,m,v,x){const S=v.mask_idx!=null?m.masks[v.mask_idx]:null,E=v.clip_path_idx!=null?m.clip_paths[v.clip_path_idx]:null;if(v.transform&&(f=Fp(v.transform).preMultiplySelf(f)),!(function(D,F,k){return D.opacity!==255||F||k})(v,E!=null,S!=null))return void a2(h,f,m,v,x);const A=Vm(h.canvas.width,h.canvas.height),R=A.getContext("2d");a2(R,f,m,v,x),E&&v3(R,f,m,E),S&&x3(R,f,m,S,x),h.globalAlpha=v.opacity/255,h.drawImage(A,0,0)})(n,e,i,a.group,l),n.restore()):a.path&&(n.save(),(function(h,f,m,v,x){h.setTransform(f),v.paint_order===v5.PAINT_ORDER_FILL_AND_STROKE?(f3(h,m,v,x),m3(h,m,v,x)):(m3(h,m,v,x),f3(h,m,v,x))})(n,e,i,a.path,l),n.restore())}function f3(n,e,i,a){const l=i.fill;if(!l)return;const h=l.opacity/255;switch(n.save(),n.beginPath(),b3(i,n),l.paint){case"rgb_color":n.fillStyle=Op(l.rgb_color,l.opacity,a);break;case"linear_gradient_idx":{const f=e.linear_gradients[l.linear_gradient_idx];f.transform&&n.setTransform(Fp(f.transform).preMultiplySelf(n.getTransform())),n.fillStyle=_3(n,f,h,a);break}case"radial_gradient_idx":{const f=e.radial_gradients[l.radial_gradient_idx];f.transform&&n.setTransform(Fp(f.transform).preMultiplySelf(n.getTransform())),n.fillStyle=g3(n,f,h,a)}}n.fill(p3(i)),n.restore()}function p3(n){return n.rule===n2.PATH_RULE_NON_ZERO?"nonzero":n.rule===n2.PATH_RULE_EVEN_ODD?"evenodd":void 0}function m3(n,e,i,a){const l=i.stroke;if(!l)return;const h=w3(i);n.lineWidth=l.width,n.miterLimit=l.miterlimit,n.setLineDash(l.dasharray),n.lineDashOffset=l.dashoffset;const f=l.opacity/255;switch(l.paint){case"rgb_color":n.strokeStyle=Op(l.rgb_color,l.opacity,a);break;case"linear_gradient_idx":n.strokeStyle=_3(n,e.linear_gradients[l.linear_gradient_idx],f,a,!0);break;case"radial_gradient_idx":n.strokeStyle=g3(n,e.radial_gradients[l.radial_gradient_idx],f,a,!0)}switch(l.linejoin){case J0.LINE_JOIN_MITER_CLIP:case J0.LINE_JOIN_MITER:n.lineJoin="miter";break;case J0.LINE_JOIN_ROUND:n.lineJoin="round";break;case J0.LINE_JOIN_BEVEL:n.lineJoin="bevel"}switch(l.linecap){case r2.LINE_CAP_BUTT:n.lineCap="butt";break;case r2.LINE_CAP_ROUND:n.lineCap="round";break;case r2.LINE_CAP_SQUARE:n.lineCap="square"}n.stroke(h)}function _3(n,e,i,a,l=!1){if(e.stops.length===1){const A=e.stops[0];return Op(A.rgb_color,A.opacity*i,a)}const{x1:h,y1:f,x2:m,y2:v}=e;let x=new DOMPoint(h,f),S=new DOMPoint(m,v);if(l){const A=Fp(e.transform);x=A.transformPoint(x),S=A.transformPoint(S)}const E=n.createLinearGradient(x.x,x.y,S.x,S.y);for(const A of e.stops)E.addColorStop(A.offset,Op(A.rgb_color,A.opacity*i,a));return E}function g3(n,e,i,a,l=!1){if(e.stops.length===1){const U=e.stops[0];return Op(U.rgb_color,U.opacity*i,a)}const h=Fp(e.transform),{fx:f,fy:m,fr:v,cx:x,cy:S,r:E}=e;let A=new DOMPoint(f,m),R=new DOMPoint(x,S),D=v,F=E;if(l){A=h.transformPoint(A),R=h.transformPoint(R);const U=(h.a+h.d)/2;D=v*U,F=e.r*U}const k=n.createRadialGradient(A.x,A.y,D,R.x,R.y,F);for(const U of e.stops)k.addColorStop(U.offset,Op(U.rgb_color,U.opacity*i,a));return k}function y3(n,e,i,a){const l=a.transform?Fp(a.transform).preMultiplySelf(e):e,h=Vm(n.canvas.width,n.canvas.height),f=h.getContext("2d");for(const v of a.children)if(v.group)y3(f,l,i,v.group);else if(v.path){const x=v.path,S=new Path2D;S.addPath(w3(x),l),f.fill(S,p3(x))}const m=a.clip_path_idx!=null?i.clip_paths[a.clip_path_idx]:null;m&&v3(f,l,i,m),n.globalCompositeOperation="source-over",n.drawImage(h,0,0)}function v3(n,e,i,a){const l=Vm(n.canvas.width,n.canvas.height);y3(l.getContext("2d"),e,i,a),n.globalCompositeOperation="destination-in",n.drawImage(l,0,0)}function x3(n,e,i,a,l){if(a.children.length===0)return;const h=a.mask_idx!=null?i.masks[a.mask_idx]:null;h&&x3(n,e,i,h,l);const f=n.canvas.width,m=n.canvas.height,v=Vm(f,m),x=v.getContext("2d"),S=a.width,E=a.height,A=a.left,R=a.top,D=new Path2D,F=new Path2D;F.rect(A,R,S,E),D.addPath(F,e),x.clip(D);for(const q of a.children)d3(x,e,i,q,l);const k=x.getImageData(0,0,f,m),U=k.data;if(a.mask_type===l3.MASK_TYPE_LUMINANCE)for(let q=0;q<U.length;q+=4)U[q+3]=U[q+3]/255*(.2126*U[q]+.7152*U[q+1]+.0722*U[q+2]);x.putImageData(k,0,0),n.globalCompositeOperation="destination-in",n.drawImage(v,0,0)}function Fp(n){return n?new DOMMatrix([n.sx,n.ky,n.kx,n.sy,n.tx,n.ty]):new DOMMatrix}function b3(n,e){const i=n.step;let a=n.diffs[0]*i,l=n.diffs[1]*i;e.moveTo(a,l);for(let h=0,f=2;h<n.commands.length;h++)switch(n.commands[h]){case Um.PATH_COMMAND_MOVE:a+=n.diffs[f++]*i,l+=n.diffs[f++]*i,e.moveTo(a,l);break;case Um.PATH_COMMAND_LINE:a+=n.diffs[f++]*i,l+=n.diffs[f++]*i,e.lineTo(a,l);break;case Um.PATH_COMMAND_QUAD:{const m=a+n.diffs[f++]*i,v=l+n.diffs[f++]*i;a=m+n.diffs[f++]*i,l=v+n.diffs[f++]*i,e.quadraticCurveTo(m,v,a,l);break}case Um.PATH_COMMAND_CUBIC:{const m=a+n.diffs[f++]*i,v=l+n.diffs[f++]*i,x=m+n.diffs[f++]*i,S=v+n.diffs[f++]*i;a=x+n.diffs[f++]*i,l=S+n.diffs[f++]*i,e.bezierCurveTo(m,v,x,S,a,l);break}case Um.PATH_COMMAND_CLOSE:e.closePath()}return e}function w3(n){return b3(n,new Path2D)}class i_{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}st(i_,"LRUCache");class o2{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new fa(e,e.data)}getFromCache(e,i,a){return this.cacheMap.has(a)||this.cacheMap.set(a,new i_(150)),this.cacheMap.get(a).get(Xc(e.toString(),i))}setInCache(e,i,a,l){this.cacheDependenciesMap.has(l)||this.cacheDependenciesMap.set(l,new Map),this.cacheMap.has(l)||this.cacheMap.set(l,new i_(150));const h=this.cacheDependenciesMap.get(l),f=Xc(e.id.toString(),a);h.get(f)||h.set(f,new Set);const m=this.cacheMap.get(l),v=e.toString();h.get(f).add(v),m.put(Xc(e.toString(),a),i)}removeImagesFromCacheByIds(e,i,a=0){if(!this.cacheMap.has(a)||!this.cacheDependenciesMap.has(a))return;const l=this.cacheMap.get(a),h=this.cacheDependenciesMap.get(a);for(const f of e){const m=Xc(f.toString(),i);if(h.has(m)){for(const v of h.get(m))l.delete(v);h.delete(m)}}}rasterize(e,i,a,l,h=k5){const f=this.getFromCache(e,a,l);if(f)return f.clone();const m=h(i.icon,e.options),v=o2._getImage(m);return this.setInCache(e,v,a,l),v.clone()}}class T3{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const a=this.toIdx(e,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function S3(n,e,i,a){let l=0,h=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(a[f])<1e-15){if(i[f]<n[f]||i[f]>e[f])return null}else{const m=1/a[f];let v=(n[f]-i[f])*m,x=(e[f]-i[f])*m;if(v>x){const S=v;v=x,x=S}if(v>l&&(l=v),x<h&&(h=x),l>h)return null}return l}function E3(n,e,i,a,l,h,f,m,v,x,S){const E=a-n,A=l-e,R=h-i,D=f-n,F=m-e,k=v-i,U=S[1]*k-S[2]*F,q=S[2]*D-S[0]*k,$=S[0]*F-S[1]*D,Y=E*U+A*q+R*$;if(Math.abs(Y)<1e-15)return null;const le=1/Y,ne=x[0]-n,de=x[1]-e,_e=x[2]-i,ye=(ne*U+de*q+_e*$)*le;if(ye<0||ye>1)return null;const Be=de*R-_e*A,Ee=_e*E-ne*R,Ve=ne*A-de*E,Xe=(S[0]*Be+S[1]*Ee+S[2]*Ve)*le;return Xe<0||ye+Xe>1?null:(D*Be+F*Ee+k*Ve)*le}function A3(n,e,i){return(n-e)/(i-e)}function M3(n,e,i,a,l,h,f,m,v){const x=1<<i,S=h-a,E=f-l,A=(n+1)/x*S+a,R=(e+0)/x*E+l,D=(e+1)/x*E+l;m[0]=(n+0)/x*S+a,m[1]=R,v[0]=A,v[1]=D}class I3{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=(function(h){const f=Math.ceil(Math.log2(h.dim/8)),m=[];let v=Math.ceil(Math.pow(2,f));const x=1/v,S=(R,D,F,k,U)=>{const q=k?1:0,$=(R+1)*F-q,Y=D*F,le=(D+1)*F-q;U[0]=R*F,U[1]=Y,U[2]=$,U[3]=le};let E=new T3(v);const A=[];for(let R=0;R<v*v;R++){S(R%v,Math.floor(R/v),x,!1,A);const D=Df(A[0],A[1],h),F=Df(A[2],A[1],h),k=Df(A[2],A[3],h),U=Df(A[0],A[3],h);E.minimums.push(Math.min(D,F,k,U)),E.maximums.push(Math.max(D,F,k,U)),E.leaves.push(1)}for(m.push(E),v/=2;v>=1;v/=2){const R=m[m.length-1];E=new T3(v);for(let D=0;D<v*v;D++){S(D%v,Math.floor(D/v),2,!0,A);const F=R.getElevation(A[0],A[1]),k=R.getElevation(A[2],A[1]),U=R.getElevation(A[2],A[3]),q=R.getElevation(A[0],A[3]),$=R.isLeaf(A[0],A[1]),Y=R.isLeaf(A[2],A[1]),le=R.isLeaf(A[2],A[3]),ne=R.isLeaf(A[0],A[3]),de=Math.min(F.min,k.min,U.min,q.min),_e=Math.max(F.max,k.max,U.max,q.max),ye=$&&Y&&le&&ne;E.maximums.push(_e),E.minimums.push(de),E.leaves.push(_e-de<=5&&ye?1:0)}m.push(E)}return m})(this.dem),a=i.length-1,l=i[a];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(e,i,a,l,h,f,m=1){return S3([e,i,-100],[a,l,this.maximums[0]*m],h,f)}raycast(e,i,a,l,h,f,m=1){if(!this.nodeCount)return null;const v=this.raycastRoot(e,i,a,l,h,f,m);if(v==null)return null;const x=[],S=[],E=[],A=[],R=[{idx:0,t:v,nodex:0,nodey:0,depth:0}];for(;R.length>0;){const{idx:D,t:F,nodex:k,nodey:U,depth:q}=R.pop();if(this.leaves[D]){M3(k,U,q,e,i,a,l,E,A);const Y=1<<q,le=(k+0)/Y,ne=(k+1)/Y,de=(U+0)/Y,_e=(U+1)/Y,ye=Df(le,de,this.dem)*m,Be=Df(ne,de,this.dem)*m,Ee=Df(ne,_e,this.dem)*m,Ve=Df(le,_e,this.dem)*m,Xe=E3(E[0],E[1],ye,A[0],E[1],Be,A[0],A[1],Ee,h,f),tt=E3(A[0],A[1],Ee,E[0],A[1],Ve,E[0],E[1],ye,h,f),gt=Math.min(Xe!==null?Xe:Number.MAX_VALUE,tt!==null?tt:Number.MAX_VALUE);if(gt!==Number.MAX_VALUE)return gt;{const ot=gi([],h,f,F);if(C3(ye,Be,Ve,Ee,A3(ot[0],E[0],A[0]),A3(ot[1],E[1],A[1]))>=ot[2])return F}continue}let $=0;for(let Y=0;Y<this._siblingOffset.length;Y++){M3((k<<1)+this._siblingOffset[Y][0],(U<<1)+this._siblingOffset[Y][1],q+1,e,i,a,l,E,A),E[2]=-100,A[2]=this.maximums[this.childOffsets[D]+Y]*m;const le=S3(E,A,h,f);if(le!=null){const ne=le;x[Y]=ne;let de=!1;for(let _e=0;_e<$&&!de;_e++)ne>=x[S[_e]]&&(S.splice(_e,0,Y),de=!0);de||(S[$]=Y),$++}}for(let Y=0;Y<$;Y++){const le=S[Y];R.push({idx:this.childOffsets[D]+le,t:x[le],nodex:(k<<1)+this._siblingOffset[le][0],nodey:(U<<1)+this._siblingOffset[le][1],depth:q+1})}}return null}_addNode(e,i,a){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,a,l,h){if(e[l].isLeaf(i,a)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const f=l-1,m=e[f];let v=0,x=0;for(let S=0;S<this._siblingOffset.length;S++){const E=2*i+this._siblingOffset[S][0],A=2*a+this._siblingOffset[S][1],R=m.getElevation(E,A),D=m.isLeaf(E,A),F=this._addNode(R.min,R.max,D);D&&(v|=1<<S),x||(x=F)}for(let S=0;S<this._siblingOffset.length;S++)v&1<<S||this._construct(e,2*i+this._siblingOffset[S][0],2*a+this._siblingOffset[S][1],f,x+S)}}function C3(n,e,i,a,l,h){return ti(ti(n,i,h),ti(e,a,h),l)}function Df(n,e,i){const a=i.dim,l=G(n*a-.5,0,a-1),h=G(e*a-.5,0,a-1),f=Math.floor(l),m=Math.floor(h),v=Math.min(f+1,a-1),x=Math.min(m+1,a-1);return C3(i.get(f,m),i.get(v,m),i.get(f,x),i.get(v,x),l-f,h-m)}const N5={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function U5(n,e,i){return(256*n*256+256*e+i)/10-1e4}function V5(n,e,i){return 256*n+e+i/256-32768}class n_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,a,l=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void Gt(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const h=this.dim=i.height-2,f=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=l,this._modifiedForSources={},!l){for(let v=0;v<h;v++)f[this._idx(-1,v)]=f[this._idx(0,v)],f[this._idx(h,v)]=f[this._idx(h-1,v)],f[this._idx(v,-1)]=f[this._idx(v,0)],f[this._idx(v,h)]=f[this._idx(v,h-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(h,-1)]=f[this._idx(h-1,0)],f[this._idx(-1,h)]=f[this._idx(0,h-1)],f[this._idx(h,h)]=f[this._idx(h-1,h-1)]}const m=a==="terrarium"?V5:U5;for(let v=0;v<f.length;++v){const x=4*v;this.floatView[v]=m(this.pixels[x],this.pixels[x+1],this.pixels[x+2])}this._timestamp=_a.now()}_buildQuadTree(){this._tree=new I3(this)}get(e,i,a=!1){a&&(e=G(e,-1,this.dim),i=G(i,-1,this.dim));const l=this._idx(e,i);return this.floatView[l]}set(e,i,a){const l=this._idx(e,i),h=this.floatView[l];return this.floatView[l]=a,a-h}static getUnpackVector(e){return N5[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const a=[0,0,0,0],l=n_.getUnpackVector(i);let h=Math.floor((e+l[3])/l[2]);return a[2]=h%256,h=Math.floor(h/256),a[1]=h%256,h=Math.floor(h/256),a[0]=h,a}getPixels(){return new Qp({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=i*this.dim,h=i*this.dim+this.dim,f=a*this.dim,m=a*this.dim+this.dim;switch(i){case-1:l=h-1;break;case 1:h=l+1}switch(a){case-1:f=m-1;break;case 1:m=f+1}const v=-i*this.dim,x=-a*this.dim;for(let S=f;S<m;S++)for(let E=l;E<h;E++){const A=4*this._idx(E,S),R=4*this._idx(E+v,S+x);this.pixels[A+0]=e.pixels[R+0],this.pixels[A+1]=e.pixels[R+1],this.pixels[A+2]=e.pixels[R+2],this.pixels[A+3]=e.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function j5(n,e,i){n===1?e.headerLength=i.readFixed32():n===2?e.x=i.readVarint():n===3?e.y=i.readVarint():n===4?e.z=i.readVarint():n===5&&e.layers.push((function(a,l){return a.readFields(X5,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},l)})(i,i.readVarint()+i.pos))}function G5(n,e,i){n===1?(e.delta_filter=(function(a,l){return a.readFields(H5,{blockSize:0},l)})(i,i.readVarint()+i.pos),e.filter="delta_filter"):n===2?(i.readVarint(),e.filter="zigzag_filter"):n===3?(i.readVarint(),e.filter="bitshuffle_filter"):n===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function H5(n,e,i){n===1&&(e.blockSize=i.readVarint())}function q5(n,e,i){n===1?(i.readVarint(),e.codec="gzip_data"):n===2?(i.readVarint(),e.codec="jpeg_image"):n===3?(i.readVarint(),e.codec="webp_image"):n===4&&(i.readVarint(),e.codec="png_image")}function Z5(n,e,i){let a=0,l=0;n===1?e.firstByte=i.readFixed64():n===2?e.lastByte=i.readFixed64():n===3?e.filters.push((function(h,f){return h.readFields(G5,{},f)})(i,i.readVarint()+i.pos)):n===4?e.codec=(function(h,f){return h.readFields(q5,{},f)})(i,i.readVarint()+i.pos):n===5?l=i.readFloat():n===6?a=i.readFloat():n===7?e.bands.push(i.readString()):n===8?e.offset=i.readDouble():n===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=l),e.scale===0&&(e.scale=a)}function X5(n,e,i){n===1?e.version=i.readVarint():n===2?e.name=i.readString():n===3?e.units=i.readString():n===4?e.tileSize=i.readVarint():n===5?e.buffer=i.readVarint():n===6?e.pixelFormat=i.readVarint():n===7&&e.dataIndex.push((function(a,l){return a.readFields(Z5,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},l)})(i,i.readVarint()+i.pos))}function $5(n,e,i){if(n===2)(function(a,l,h){a.readFields(W5,h,l)})(i,i.readVarint()+i.pos,e);else if(n===3)throw new Error("Not implemented")}function W5(n,e,i){if(n===1){let a=0;const l=i.readVarint()+i.pos;for(;i.pos<l;)e[a++]=i.readVarint()}}function Y5(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let a=2;a>=1;a--){const l=a===1?1:0,h=a===2?1:0;for(let f=0;f<e[0];f++){const m=e[1]*f;for(let v=l;v<e[1];v++){const x=e[2]*(v+m);for(let S=h;S<e[2];S++){const E=e[3]*(S+x);for(let A=0;A<e[3];A++){const R=E+A;n[R]+=n[R-i]}}}}i*=e[a]}return n}function K5(n){for(let e=0,i=n.length;e<i;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function J5(n,e){switch(e){case"uint32":return n;case"uint16":for(let i=0;i<n.length;i+=2){const a=n[i],l=n[i+1];n[i]=(240&a)>>4|(61440&a)>>8|(240&l)<<4|61440&l,n[i+1]=15&a|(3840&a)>>4|(15&l)<<8|(3840&l)<<4}return n;case"uint8":for(let i=0;i<n.length;i+=4){const a=n[i],l=n[i+1],h=n[i+2],f=n[i+3];n[i+0]=(192&a)>>6|(192&l)>>4|(192&h)>>2|192&f,n[i+1]=(48&a)>>4|(48&l)>>2|48&h|(48&f)<<2,n[i+2]=(12&a)>>2|12&l|(12&h)<<2|(12&f)<<4,n[i+3]=3&a|(3&l)<<2|(3&h)<<4|(3&f)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}st(n_,"DEMData"),st(I3,"DemMinMaxQuadTree",{omit:["dem"]});var Dl=Uint8Array,jm=Uint16Array,Q5=Int32Array,z3=new Dl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),R3=new Dl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),e6=new Dl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),D3=function(n,e){for(var i=new jm(31),a=0;a<31;++a)i[a]=e+=1<<n[a-1];var l=new Q5(i[30]);for(a=1;a<30;++a)for(var h=i[a];h<i[a+1];++h)l[h]=h-i[a]<<5|a;return{b:i,r:l}},P3=D3(z3,2),L3=P3.b,t6=P3.r;L3[28]=258,t6[258]=28;for(var i6=D3(R3,0).b,O3=new jm(32768),oa=0;oa<32768;++oa){var Bp=(43690&oa)>>1|(21845&oa)<<1;O3[oa]=((65280&(Bp=(61680&(Bp=(52428&Bp)>>2|(13107&Bp)<<2))>>4|(3855&Bp)<<4))>>8|(255&Bp)<<8)>>1}var Gm=function(n,e,i){for(var a=n.length,l=0,h=new jm(e);l<a;++l)n[l]&&++h[n[l]-1];var f,m=new jm(e);for(l=1;l<e;++l)m[l]=m[l-1]+h[l-1]<<1;f=new jm(1<<e);var v=15-e;for(l=0;l<a;++l)if(n[l])for(var x=l<<4|n[l],S=e-n[l],E=m[n[l]-1]++<<S,A=E|(1<<S)-1;E<=A;++E)f[O3[E]>>v]=x;return f},Hm=new Dl(288);for(oa=0;oa<144;++oa)Hm[oa]=8;for(oa=144;oa<256;++oa)Hm[oa]=9;for(oa=256;oa<280;++oa)Hm[oa]=7;for(oa=280;oa<288;++oa)Hm[oa]=8;var F3=new Dl(32);for(oa=0;oa<32;++oa)F3[oa]=5;var n6=Gm(Hm,9),r6=Gm(F3,5),s2=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},mu=function(n,e,i){var a=e/8|0;return(n[a]|n[a+1]<<8)>>(7&e)&i},l2=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(7&e)},a6=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],_u=function(n,e,i){var a=new Error(e||a6[n]);if(a.code=n,Error.captureStackTrace&&Error.captureStackTrace(a,_u),!i)throw a;return a},o6=new Dl(0),s6=typeof TextDecoder<"u"&&new TextDecoder;try{s6.decode(o6,{stream:!0})}catch{}const l6={gzip_data:"gzip"};class mc extends Error{constructor(e){super(e),this.name="MRTError"}}const c6={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},B3={uint32:1,uint16:2,uint8:4},u6={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let c2;class r_{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new mc(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),a=new DataView(e);if(i[0]!==13)throw new mc("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),a=this.getHeaderLength(e);if(i.length<a)throw new mc(`Expected header with length >= ${a} but got buffer of length ${i.length}`);const l=new c2(i.subarray(0,a)).readFields(j5,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==l.x||this.y!==l.y||this.z!==l.z))throw new mc(`Invalid attempt to parse header ${l.z}/${l.x}/${l.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=l.x,this.y=l.y,this.z=l.z;for(const h of l.layers)this.layers[h.name]=new k3(h,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],a=this.getLayer(e.layerName);for(let l of e.blockIndices){const h=a.dataIndex[l],f=h.firstByte-e.firstByte,m=h.lastByte-e.firstByte;if(a._blocksInProgress.has(l))continue;const v={layerName:a.name,firstByte:f,lastByte:m,pixelFormat:a.pixelFormat,blockIndex:l,blockShape:[h.bands.length].concat(a.bandShape),buffer:a.buffer,codec:h.codec.codec,filters:h.filters.map((x=>x.filter))};a._blocksInProgress.add(l),i.push(v)}return new N3(i,(()=>{i.forEach((l=>a._blocksInProgress.delete(l.blockIndex)))}),((l,h)=>{if(i.forEach((f=>a._blocksInProgress.delete(f.blockIndex))),l)throw l;h.forEach((f=>{this.getLayer(f.layerName).processDecodedData(f)}))}))}}class k3{constructor({version:e,name:i,units:a,tileSize:l,pixelFormat:h,buffer:f,dataIndex:m},v){if(this.version=e,this.version!==1)throw new mc(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=a,this.tileSize=l,this.buffer=f,this.pixelFormat=c6[h],this.dataIndex=m,this.bandShape=[l+2*f,l+2*f,B3[this.pixelFormat]],this._decodedBlocks=new i_(v?v.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return B3[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:e})=>e)).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[a,l]of this.dataIndex.entries()){for(const[h,f]of l.bands.entries())if(f===e)return{bandIndex:i+h,blockIndex:a,blockBandIndex:h};i+=l.bands.length}break;case"number":for(const[a,l]of this.dataIndex.entries()){if(e>=i&&e<i+l.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-i};i+=l.bands.length}break;default:throw new mc(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,a=-1/0;const l=[],h=new Set;for(const f of e){const{blockIndex:m}=this.getBlockForBand(f);if(m<0)throw new mc(`Invalid band: ${JSON.stringify(f)}`);const v=this.dataIndex[m];l.includes(m)||l.push(m),h.add(m),i=Math.min(i,v.firstByte),a=Math.max(a,v.lastByte)}if(h.size>this.cacheSize)throw new mc(`Number of blocks to decode (${h.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:a,blockIndices:l}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:a}=this.getBlockForBand(e);if(i<0)throw new mc(`Band not found: ${JSON.stringify(e)}`);const l=this._decodedBlocks.get(i.toString());if(!l)throw new mc(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const h=this.dataIndex[i],f=this.bandShape.reduce(((x,S)=>x*S),1),m=a*f,v=l.subarray(m,m+f);return{data:v,bytes:new Uint8Array(v.buffer).subarray(v.byteOffset,v.byteOffset+v.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:h.offset,scale:h.scale}}}r_.setPbf=function(n){c2=n};class N3{constructor(e,i,a){this.tasks=e,this._onCancel=i,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}r_.performDecoding=function(n,e){const i=new Uint8Array(n);return Promise.all(e.tasks.map((a=>{const{layerName:l,firstByte:h,lastByte:f,pixelFormat:m,blockShape:v,blockIndex:x,filters:S,codec:E}=a,A=i.subarray(h,f+1),R=new Uint32Array(v[0]*v[1]*v[2]);let D;if(E!=="gzip_data")throw new mc(`Unhandled codec: ${E}`);return D=(function(F,k){if(!globalThis.DecompressionStream&&k==="gzip_data")return Promise.resolve(((Y=(function(de){de[0]==31&&de[1]==139&&de[2]==8||_u(6,"invalid gzip data");var _e=de[3],ye=10;4&_e&&(ye+=2+(de[10]|de[11]<<8));for(var Be=(_e>>3&1)+(_e>>4&1);Be>0;Be-=!de[ye++]);return ye+(2&_e)})($=F))+8>$.length&&_u(6,"invalid gzip data"),(function(de,_e,ye,Be){var Ee=de.length;if(!Ee||_e.f&&!_e.l)return ye||new Dl(0);var Ve=!ye,Xe=Ve||_e.i!=2,tt=_e.i;Ve&&(ye=new Dl(3*Ee));var gt,ot,Ye=function(xr){var tr=ye.length;if(xr>tr){var Nn=new Dl(Math.max(2*tr,xr));Nn.set(ye),ye=Nn}},at=_e.f||0,Fe=_e.p||0,Le=_e.b||0,rt=_e.l,mt=_e.d,Ke=_e.m,Lt=_e.n,Nt=8*Ee;do{if(!rt){at=mu(de,Fe,1);var zt=mu(de,Fe+1,3);if(Fe+=3,!zt){var Et=de[(re=4+((Fe+7)/8|0))-4]|de[re-3]<<8,ui=re+Et;if(ui>Ee){tt&&_u(0);break}Xe&&Ye(Le+Et),ye.set(de.subarray(re,ui),Le),_e.b=Le+=Et,_e.p=Fe=8*ui,_e.f=at;continue}if(zt==1)rt=n6,mt=r6,Ke=9,Lt=5;else if(zt==2){var Ct=mu(de,Fe,31)+257,Yt=mu(de,Fe+10,15)+4,pi=Ct+mu(de,Fe+5,31)+1;Fe+=14;for(var Ii=new Dl(pi),tn=new Dl(19),vi=0;vi<Yt;++vi)tn[e6[vi]]=mu(de,Fe+3*vi,7);Fe+=3*Yt;var cn=s2(tn),un=(1<<cn)-1,dr=Gm(tn,cn);for(vi=0;vi<pi;){var re,ee=dr[mu(de,Fe,un)];if(Fe+=15&ee,(re=ee>>4)<16)Ii[vi++]=re;else{var He=0,bt=0;for(re==16?(bt=3+mu(de,Fe,3),Fe+=2,He=Ii[vi-1]):re==17?(bt=3+mu(de,Fe,7),Fe+=3):re==18&&(bt=11+mu(de,Fe,127),Fe+=7);bt--;)Ii[vi++]=He}}var qe=Ii.subarray(0,Ct),At=Ii.subarray(Ct);Ke=s2(qe),Lt=s2(At),rt=Gm(qe,Ke),mt=Gm(At,Lt)}else _u(1);if(Fe>Nt){tt&&_u(0);break}}Xe&&Ye(Le+131072);for(var Zt=(1<<Ke)-1,Ht=(1<<Lt)-1,bi=Fe;;bi=Fe){var ni=(He=rt[l2(de,Fe)&Zt])>>4;if((Fe+=15&He)>Nt){tt&&_u(0);break}if(He||_u(2),ni<256)ye[Le++]=ni;else{if(ni==256){bi=Fe,rt=null;break}var Vt=ni-254;ni>264&&(Vt=mu(de,Fe,(1<<(ai=z3[vi=ni-257]))-1)+L3[vi],Fe+=ai);var sn=mt[l2(de,Fe)&Ht],In=sn>>4;if(sn||_u(3),Fe+=15&sn,At=i6[In],In>3){var ai=R3[In];At+=l2(de,Fe)&(1<<ai)-1,Fe+=ai}if(Fe>Nt){tt&&_u(0);break}Xe&&Ye(Le+131072);var Wi=Le+Vt;if(Le<At){var Cn=0-At,bn=Math.min(At,Wi);for(Cn+Le<0&&_u(3);Le<bn;++Le)ye[Le]=(void 0)[Cn+Le]}for(;Le<Wi;++Le)ye[Le]=ye[Le-At]}}_e.l=rt,_e.p=bi,_e.b=Le,_e.f=at,rt&&(at=1,_e.m=Ke,_e.d=mt,_e.n=Lt)}while(!at);return Le!=ye.length&&Ve?(gt=ye,((ot=Le)==null||ot>gt.length)&&(ot=gt.length),new Dl(gt.subarray(0,ot))):ye.subarray(0,Le)})($.subarray(Y,-8),{i:2},new Dl(((U=$)[(q=U.length)-4]|U[q-3]<<8|U[q-2]<<16|U[q-1]<<24)>>>0))));var U,q,$,Y;const le=l6[k];if(!le)throw new Error(`Unhandled codec: ${k}`);const ne=new globalThis.DecompressionStream(le);return new Response(new Blob([F]).stream().pipeThrough(ne)).arrayBuffer().then((de=>new Uint8Array(de)))})(A,E).then((F=>((function(k,U){k.readFields($5,U)})(new c2(F),R),new u6[m](R.buffer)))),D.then((F=>{for(let k=S.length-1;k>=0;k--)switch(S[k]){case"delta_filter":Y5(F,v);break;case"zigzag_filter":K5(F);break;case"bitshuffle_filter":J5(F,m);break;default:throw new mc(`Unhandled filter "${S[k]}"`)}return{layerName:l,blockIndex:x,data:F}})).catch((F=>{throw F}))})))},st(N3,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),st(r_,"MapboxRasterTile"),st(k3,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class U3{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class V3{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Js(pt,16,0),this.featureIndexArray=new cd,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,a,l,h,f=0,m=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,l,h,f);const x=this.grid;for(let S=0;S<i.length;S++){const E=i[S],A=[1/0,1/0,-1/0,-1/0];for(let R=0;R<E.length;R++){const D=E[R];A[0]=Math.min(A[0],D.x),A[1]=Math.min(A[1],D.y),A[2]=Math.max(A[2],D.x),A[3]=Math.max(A[3],D.y)}m!==0&&(A[0]-=m,A[1]-=m,A[2]+=m,A[3]+=m),A[0]<pt&&A[1]<pt&&A[2]>=0&&A[3]>=0&&x.insert(v,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new xt(new L0(this.rawTileData)).layers,this.sourceLayerCoder=new U3(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:a,transform:l,tileTransform:h,pixelPosMatrix:f,availableImages:m,worldview:v}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const x=i.queryRadius?i.queryRadius:0,S=a.bufferedTilespaceBounds,E=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,((F,k,U,q)=>Pn(a.bufferedTilespaceGeometry,F-x,k-x,U+x,q+x)));E.sort(h6);let A=null;l.elevation&&E.length>0&&(A=Lp.create(l.elevation,this.tileID));const R={};let D;for(let F=0;F<E.length;F++){const k=E[F];if(k===D)continue;D=k;const U=this.featureIndexArray.get(k);let q=null;this.is3DTile?this.loadMatchingModelFeature(R,U,e,a,l,v):this.loadMatchingFeature(R,U,e,m,v,(($,Y,le,ne=0)=>(q||(q=Ge($,this.tileID.canonical,h)),Y.queryIntersectsFeature(a,$,le,q,this.z,l,f,A,ne))))}return R}loadMatchingFeature(e,i,a,l,h,f){const{featureIndex:m,bucketIndex:v,sourceLayerIndex:x,layoutVertexArrayOffset:S}=i,E=this.bucketLayerIDs[v],A=a.layers,R=Object.keys(A);if(R.length&&!ei(R,E))return;const D=a.sourceCache,F=this.sourceLayerCoder.decode(x),k=this.vtLayers[F].feature(m),U=this.getId(k,F);for(let q=0;q<E.length;q++){const $=E[q];if(!A[$])continue;const{styleLayer:Y,targets:le}=A[$];let ne={};U!==void 0&&(ne=D.getFeatureState(Y.sourceLayer,U));const de=!f||f(k,Y,ne,S);if(!de)continue;const _e=new N1(k,this.z,this.x,this.y,U);_e.tile=this.tileID.canonical,_e.state=ne;let ye=this.serializedLayersCache.get($);ye||(ye=Y.serialize(),ye.id=$,this.serializedLayersCache.set($,ye)),_e.source=ye.source,_e.sourceLayer=ye["source-layer"],_e.layer=Object.assign({},ye),_e.layer.paint=j3(ye.paint,Y.paint,k,ne,l),_e.layer.layout=j3(ye.layout,Y.layout,k,ne,l);let Be=!1;for(const Ee of le){this.updateFeatureProperties(_e,Ee);const{filter:Ve}=Ee;if(Ve){if(k.properties=_e.properties,Ve.needGeometry){const Xe=Re(k,!0);if(!Ve.filter(new mn(this.tileID.overscaledZ,{worldview:h}),Xe,this.tileID.canonical))continue}else if(!Ve.filter(new mn(this.tileID.overscaledZ,{worldview:h}),k))continue}Be=!0,Ee.targetId&&this.addFeatureVariant(_e,Ee)}Be&&this.appendToResult(e,$,m,_e,de)}}loadMatchingModelFeature(e,i,a,l,h,f){const{featureIndex:m,bucketIndex:v}=i,x=this.bucketLayerIDs[v],S=a.layers,E=Object.keys(S);if(!E.length||ei(E,x))for(let A=0;A<x.length;A++){const R=x[A],{styleLayer:D,targets:F}=S[R];if(D.type!=="model")continue;const k=l.tile,U=k.getBucket(D);if(!(U&&U instanceof K0))continue;const q=g5(U,m,l,h);if(!q)continue;const{z:$,x:Y,y:le}=k.tileID.canonical,{feature:ne,intersectionZ:de,position:_e}=q;let ye={};ne.id!==void 0&&(ye=a.sourceCache.getFeatureState(D.sourceLayer,ne.id));const Be=new N1({},$,Y,le,ne.id);Be.tile=this.tileID.canonical,Be.state=ye,Be.properties=ne.properties,Be.geometry={type:"Point",coordinates:[_e.lng,_e.lat]};let Ee=this.serializedLayersCache.get(R);Ee||(Ee=D.serialize(),Ee.id=R,this.serializedLayersCache.set(R,Ee)),Be.source=Ee.source,Be.sourceLayer=Ee["source-layer"],Be.layer=Object.assign({},Ee);let Ve=!1;for(const Xe of F){this.updateFeatureProperties(Be,Xe);const{filter:tt}=Xe;if(tt){if(ne.properties=Be.properties,tt.needGeometry){if(!tt.filter(new mn(this.tileID.overscaledZ,{worldview:f}),ne,this.tileID.canonical))continue}else if(!tt.filter(new mn(this.tileID.overscaledZ,{worldview:f}),ne))continue}Ve=!0,Xe.targetId&&this.addFeatureVariant(Be,Xe)}Ve&&this.appendToResult(e,R,m,Be,de)}}updateFeatureProperties(e,i,a){if(i.properties){const l={};for(const h in i.properties){const f=i.properties[h].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,a);f!=null&&(l[h]=f)}e.properties=l}}addFeatureVariant(e,i,a){const l={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(l.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(l)}appendToResult(e,i,a,l,h){let f=e[i];f===void 0&&(f=e[i]=[]),f.push({featureIndex:a,feature:l,intersectionZ:h})}lookupSymbolFeatures(e,i,a,l,h,f){const m={};this.loadVTLayers();for(const v of e)this.loadMatchingFeature(m,{bucketIndex:i,sourceLayerIndex:a,featureIndex:v,layoutVertexArrayOffset:0},l,h,f);return m}loadFeature(e){const{featureIndex:i,sourceLayerIndex:a}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(a),h=this.vtFeatures[l];if(h[i])return h[i];const f=this.vtLayers[l].feature(i);return h[i]=f,f}hasLayer(e){for(const i of this.bucketLayerIDs)for(const a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;if(this.promoteId){const l=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(l!=null)if(Array.isArray(l)){if(!this.promoteIdExpression){const h=Yo(l);if(h.result!=="success"){const f=h.value.map((m=>`${m.key}: ${m.message}`)).join(", ");return void Gt(`Failed to create expression for promoteId: ${f}`)}this.promoteIdExpression=h.value}a=this.promoteIdExpression.evaluate({zoom:0},e)}else a=e.properties[l];typeof a=="boolean"&&(a=Number(a))}return a}}function j3(n,e,i,a,l){return ct(n,((h,f)=>{const m=e instanceof rc?e.get(f):null;return m&&m.evaluate?m.evaluate(i,a,void 0,l):m}))}function h6(n,e){return e-n}st(V3,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const G3=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class u2{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,a]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=a>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const h=G3[15&a];if(!h)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[m]=new Uint32Array(e,4,1);return new u2(m,f,h,e)}constructor(e,i=64,a=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const h=G3.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,m=e*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-m%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${a}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+v,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+m+v),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+v,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=i,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return h2(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,a,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:f,nodeSize:m}=this,v=[0,h.length-1,0],x=[];for(;v.length;){const S=v.pop()||0,E=v.pop()||0,A=v.pop()||0;if(E-A<=m){for(let k=A;k<=E;k++){const U=f[2*k],q=f[2*k+1];U>=e&&U<=a&&q>=i&&q<=l&&x.push(h[k])}continue}const R=A+E>>1,D=f[2*R],F=f[2*R+1];D>=e&&D<=a&&F>=i&&F<=l&&x.push(h[R]),(S===0?e<=D:i<=F)&&(v.push(A),v.push(R-1),v.push(1-S)),(S===0?a>=D:l>=F)&&(v.push(R+1),v.push(E),v.push(1-S))}return x}within(e,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:h,nodeSize:f}=this,m=[0,l.length-1,0],v=[],x=a*a;for(;m.length;){const S=m.pop()||0,E=m.pop()||0,A=m.pop()||0;if(E-A<=f){for(let k=A;k<=E;k++)q3(h[2*k],h[2*k+1],e,i)<=x&&v.push(l[k]);continue}const R=A+E>>1,D=h[2*R],F=h[2*R+1];q3(D,F,e,i)<=x&&v.push(l[R]),(S===0?e-a<=D:i-a<=F)&&(m.push(A),m.push(R-1),m.push(1-S)),(S===0?e+a>=D:i+a>=F)&&(m.push(R+1),m.push(E),m.push(1-S))}return v}}function h2(n,e,i,a,l,h){if(l-a<=i)return;const f=a+l>>1;H3(n,e,f,a,l,h),h2(n,e,i,a,f-1,1-h),h2(n,e,i,f+1,l,1-h)}function H3(n,e,i,a,l,h){for(;l>a;){if(l-a>600){const x=l-a+1,S=i-a+1,E=Math.log(x),A=.5*Math.exp(2*E/3),R=.5*Math.sqrt(E*A*(x-A)/x)*(S-x/2<0?-1:1);H3(n,e,i,Math.max(a,Math.floor(i-S*A/x+R)),Math.min(l,Math.floor(i+(x-S)*A/x+R)),h)}const f=e[2*i+h];let m=a,v=l;for(qm(n,e,a,i),e[2*l+h]>f&&qm(n,e,a,l);m<v;){for(qm(n,e,m,v),m++,v--;e[2*m+h]<f;)m++;for(;e[2*v+h]>f;)v--}e[2*a+h]===f?qm(n,e,a,v):(v++,qm(n,e,v,l)),v<=i&&(a=v+1),i<=v&&(l=v-1)}}function qm(n,e,i,a){d2(n,i,a),d2(e,2*i,2*a),d2(e,2*i+1,2*a+1)}function d2(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}function q3(n,e,i,a){const l=n-i,h=e-a;return l*l+h*h}o.$=Ch,o.A=Os,o.B=Xc,o.C=2,o.D=he,o.E=hl,o.F=Mm,o.G=gg,o.H=Du,o.I=Ur,o.J=Zd,o.K=Tc,o.L=Pu,o.M=ec,o.N=Hu,o.O=Ws,o.P=nt,o.Q=Zu,o.R=ss,o.S=Gc,o.T=w_,o.U=Yo,o.V=Y0,o.W=Ks,o.X=gr,o.Y=Lc,o.Z=na,o._=Da,o.a=function(n){return Bn.API_CDN_URL_REGEX.test(n)},o.a$=$c,o.a0=ii,o.a1=kf,o.a2=ac,o.a3=class extends Y0{},o.a4=qu,o.a5=$s,o.a6=Se,o.a7=function(n){const e=n.value;return e?ii(e)?J_(e,!0)?[]:[new Y0(n.key,e,`invalid url "${e}"`)]:[new Y0(n.key,e,`string expected, "${Tc(e)}" found`)]:[]},o.a8=Hd,o.a9=fr,o.aA=G,o.aB=Ci,o.aC=Er,o.aD=Jn,o.aE=aa,o.aF=H,o.aG=Oe,o.aH=function(n,e){const i={};for(let a=0;a<e.length;a++){const l=e[a];l in n&&(i[l]=n[l])}return i},o.aI=z,o.aJ=j,o.aK=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,i,a){const l=this.entries[n]=this.entries[n]||{callbacks:[]};if(l.result){const[h,f]=l.result;return this.scheduler?this.scheduler.add((()=>{a(h,f)}),e):a(h,f),()=>{}}return l.callbacks.push(a),l.cancel||(l.cancel=i(((h,f)=>{l.result=[h,f];for(const m of l.callbacks)this.scheduler?this.scheduler.add((()=>{m(h,f)}),e):m(h,f);setTimeout((()=>delete this.entries[n]),3e3)}))),()=>{l.result||(l.callbacks=l.callbacks.filter((h=>h!==a)),l.callbacks.length||(l.cancel(),delete this.entries[n]))}}},o.aL=function(n,e,i){const a=JSON.stringify(n.request);return n.data&&(this.deduped.entries[a]={result:[null,n.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},(l=>{const h=Ao(n.request,((f,m,v)=>{f?l(f):m&&l(null,{vectorTile:i?void 0:new xt(new L0(m)),rawData:m,responseHeaders:new Map(v.entries())})}));return()=>{h.cancel(),l()}}),e)},o.aM=function(n){return n?{cacheControl:n.get("Cache-Control"),expires:n.get("Expires")}:{cacheControl:void 0,expires:void 0}},o.aN=function(n){Vo++,Vo>Na&&(n.getActor().send("enforceCacheSizeLimit",xh),Vo=0)},o.aO=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log2(n)))},o.aP=Gr,o.aQ=Zg,o.aR=Jg,o.aS=P,o.aT=qg,o.aU=function(n,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<n.length;a++){const l=document.createElement("source");Ki(n[a])||(i.crossOrigin="Anonymous"),l.src=n[a],i.appendChild(l)}return{cancel:()=>{}}},o.aV=wm,o.aW=U1,o.aX=Ce,o.aY=Rm,o.aZ=K,o.a_=W,o.aa=ut,o.ab=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return rn(n.expression.evaluate(e))}interpolate(n,e,i){return{x:ti(n.x,e.x,i),y:ti(n.y,e.y,i),z:ti(n.z,e.z,i),azimuthal:ti(n.azimuthal,e.azimuthal,i),polar:ti(n.polar,e.polar,i)}}},o.ac=mn,o.ad=ga,o.ae=we,o.af=sr,o.ag=zr,o.ah=J,o.ai=rc,o.aj=eo,o.ak=ti,o.al=pt,o.am=Sh,o.an=Ui,o.ao=pn,o.ap=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return(function([i,a]){const l=rn([1,i,a]);return{x:l.x,y:l.y,z:l.z}})(n.expression.evaluate(e))}interpolate(n,e,i){return{x:ti(n.x,e.x,i),y:ti(n.y,e.y,i),z:ti(n.z,e.z,i)}}},o.aq=function(n,e,i=0,a=!0){const l=new nt(i,i),h=n.sub(l),f=e.add(l),m=[h,new nt(f.x,h.y),f,new nt(h.x,f.y)];return a&&m.push(h.clone()),m},o.ar=function(n,e){const i=[];for(let a=0;a<n.length;a++){const l=pe(a-1,-1,n.length-1),h=pe(a+1,-1,n.length-1),f=n[a],m=n[h],v=n[l].sub(f).unit(),x=m.sub(f).unit(),S=x.angleWithSep(v.x,v.y),E=v.add(x).unit().mult(-1*e/Math.sin(S/2));i.push(f.add(E))}return i},o.as=zg,o.at=Pn,o.au=function(n,e,i=0){return yt(((e.x-i)*n.scale-n.x)*pt,(e.y*n.scale-n.y)*pt,se(e.z,e.y))},o.av=Sr,o.aw=Li,o.ax=oi,o.ay=H2,o.az=function(n){let e=1/0,i=1/0,a=-1/0,l=-1/0;for(const h of n)e=Math.min(e,h.x),i=Math.min(i,h.y),a=Math.max(a,h.x),l=Math.max(l,h.y);return{min:new nt(e,i),max:new nt(a,l)}},o.b=function(n){return Bn.API_FONTS_REGEX.test(n)},o.b$=fm,o.b0=Hn,o.b1=Pe,o.b2=Qf,o.b3=Z0,o.b4=function(){Ha.isLoading()||Ha.isLoaded()||Vc()!=="deferred"||Ku()},o.b5=Qh,o.b6=Re,o.b7=N1,o.b8=Pr,o.b9=z_,o.bA=ln,o.bB=yn,o.bC=function(n,e){const{x:i,y:a}=n.point,l=ru(i,a,n.worldSize/n._pixelsPerMercatorPixel,0,0);return Ci(l,l,_1(Cl(e)))},o.bD=ci,o.bE=wo,o.bF=fn,o.bG=gi,o.bH=Br,o.bI=br,o.bJ=Cp,o.bK=xs,o.bL=k_,o.bM=function(n,e,i,a,l){const h=5*e+2;n.float32[h+0]=i,n.float32[h+1]=a,n.float32[h+2]=l},o.bN=Pp,o.bO=ao,o.bP=ko,o.bQ=sl,o.bR=Nl,o.bS=pe,o.bT=function(n,e,i,a){var l=new We(4);return l[0]=n,l[1]=e,l[2]=i,l[3]=a,l},o.bU=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,a=1<<i,l=Math.floor(n.x),h=Math.floor((n.x-l)*a),f=Math.floor(n.y*a),m=this.findDEMTileFor(new Gr(i,l,i,h,f));return!(!m||!m.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||n.y<0||n.y>1)return e;const l=a.getSource().maxzoom,h=1<<l,f=Math.floor(n.x),m=n.x-f,v=new Gr(l,f,l,Math.floor(m*h),Math.floor(n.y*h)),x=this.findDEMTileFor(v);if(!x||!x.dem)return e;const S=x.dem,E=1<<x.tileID.canonical.z,A=(m*E-x.tileID.canonical.x)*S.dim,R=(n.y*E-x.tileID.canonical.y)*S.dim,D=Math.floor(A),F=Math.floor(R);return(i?this.exaggeration():1)*ti(ti(S.get(D,F),S.get(D,F+1),R-F),ti(S.get(D+1,F),S.get(D+1,F+1),R-F),A-D)}static getAtTileOffset(n,e,i,a){const l=1<<n.canonical.z;return a?a.pointElevation(e):i?i.getAtPointOrZero(new we(n.wrap+(n.canonical.x+e.x/pt)/l,(n.canonical.y+e.y/pt)/l)):0}static getAtTileOffsetFunc(n,e,i,a){return(l,h,f)=>{const m=this.getAtTileOffset(n,l,h,f),v=a.upVector(n.canonical,l.x,l.y);return qt(v,v,m*a.upVectorScale(n.canonical,e,i).metersToTile),v}}getForTilePoints(n,e,i,a){if(this.isUsingMockSource())return!1;const l=Lp.create(this,n,a);return!!l&&(e.forEach((h=>{h[2]=this.exaggeration()*l.getElevationAt(h[0],h[1],i)})),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,a=e.tileID,l=1<<n.canonical.z-a.canonical.z;let h=n.canonical.x/l-a.canonical.x,f=n.canonical.y/l-a.canonical.y,m=0;for(let v=0;v<n.canonical.z-a.canonical.z&&!i.leaves[m];v++){h*=2,f*=2;const x=2*Math.floor(f)+Math.floor(h);m=i.childOffsets[m]+x,h%=1,f%=1}return{min:this.exaggeration()*i.minimums[m],max:this.exaggeration()*i.maximums[m]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,i=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const l of n){const h=this.getMinMaxForTile(l.tileID);h&&(i=Math.min(i,h.min),a=Math.max(a,h.max),e=!0)}return e?{min:i,max:a}:null}},o.bV=hu,o.bW=kn,o.bX=Ca,o.bY=S1,o.bZ=Qg,o.b_=xp,o.ba=cm,o.bb=Ge,o.bc=Qa,o.bd=sd,o.be=qp,o.bf=$n,o.bg=pf,o.bh=Y_,o.bi=function(n,e){const i=eo(e.zoom);if(i===0)return Cl(n);const a=f1(n),l=Xp(a),h=H(a.getWest())*e.worldSize,f=H(a.getEast())*e.worldSize,m=j(a.getNorth())*e.worldSize,v=j(a.getSouth())*e.worldSize,x=[h,m,0],S=[f,m,0],E=[h,v,0],A=[f,v,0],R=vn([],e.globeMatrix);return sr(x,x,R),sr(S,S,R),sr(E,E,R),sr(A,A,R),l[0]=Yn(l[0],E,i),l[1]=Yn(l[1],A,i),l[2]=Yn(l[2],S,i),l[3]=Yn(l[3],x,i),Si.fromPoints(l)},o.bj=nu,o.bk=vn,o.bl=p1,o.bm=Yn,o.bn=El,o.bo=Ym,o.bp=ea,o.bq=ki,o.br=r_,o.bs=L0,o.bt=Ao,o.bu=function(n,e){const i=[];for(const a in n)a in e||i.push(a);return i},o.bv=fe,o.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bx=ll,o.by=hi,o.bz=$i,o.c=ma,o.c$=function(n){return n*n*n*n*n},o.c0=F_,o.c1=Sg,o.c2=G_,o.c3=u2,o.c4=qt,o.c5=ol,o.c6=as,o.c7=function(n,e,i){i*=.5;var a=e[0],l=e[1],h=e[2],f=e[3],m=Math.sin(i),v=Math.cos(i);return n[0]=a*v+l*m,n[1]=l*v-a*m,n[2]=h*v+f*m,n[3]=f*v-h*m,n},o.c8=As,o.c9=_r,o.cA=an,o.cB=I2,o.cC=Fo,o.cD=Jm,o.cE=function(n,e,i,a,l,h,f,m,v){if(v.name==="globe")return Jm(n,e,new Fo(i,a,l),!1);const x=Rm({z:i,x:a,y:l},v);return new Si([(h+x.x/x.scale)*e,e*(x.y/x.scale),f],[(h+x.x2/x.scale)*e,e*(x.y2/x.scale),m])},o.cF=function(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n[3]=Math.min(e[3],i[3]),n},o.cG=function(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n[3]=Math.max(e[3],i[3]),n},o.cH=function(n){const e=Math.round((n+45+360)%360/90)%4;return yh[e]},o.cI=Q,o.cJ=Fl,o.cK=t,o.cL=function(n){const e=$i(new Float64Array(16));Ci(e,n.pixelMatrix,n.globeMatrix);const i=[0,_,0],a=[0,y,0];return sr(i,i,e),sr(a,a,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!$p(n,new P(n.center.lat,90)),a[0]>0&&a[0]<=n.width&&a[1]>0&&a[1]<=n.height&&!$p(n,new P(n.center.lat,-90))]},o.cM=function(n,e){const{scale:i}=n.tileTransform,a=i*pt/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return(function(l,h,f){var m=h[1],v=h[2],x=h[3],S=f[0],E=f[1];return l[0]=h[0]*S,l[1]=m*S,l[2]=v*E,l[3]=x*E,l})(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},o.cN=I0,o.cO=xa,o.cP=M2,o.cQ=function(n){const e=M2(n,!0);return ci([],[e[0],e[1],e[4],e[5]])},o.cR=si,o.cS=en,o.cT=_n,o.cU=function(n){const{x:e,y:i}=n.point,{lng:a,lat:l}=n._center;return ru(e,i,n.worldSize,a,l)},o.cV=Fn,o.cW=pa,o.cX=xo,o.cY=hr,o.cZ=c,o.c_=function(n,e,i){let a=0;for(let l=0;l<2;++l)n[l]>0&&(a+=(n[l]-0)*(n[l]-0)),e[l]<0&&(a+=(0-e[l])*(0-e[l]));return a},o.ca=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},o.cb=no,o.cc=function(n,e,i,a,l){var h=1/Math.tan(e/2);if(n[0]=h/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=h,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,l!=null&&l!==1/0){var f=1/(a-l);n[10]=(l+a)*f,n[14]=2*l*a*f}else n[10]=-1,n[14]=-2*a;return n},o.cd=function(n,e,i,a,l,h,f){var m=1/(e-i),v=1/(a-l),x=1/(h-f);return n[0]=-2*m,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*v,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*x,n[11]=0,n[12]=(e+i)*m,n[13]=(l+a)*v,n[14]=(f+h)*x,n[15]=1,n},o.ce=Z,o.cf=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},o.cg=lf,o.ch=hc,o.ci=Mr,o.cj=Ia,o.ck=Tr,o.cl=Og,o.cm=function(){var n=new We(4);return We!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},o.cn=function(n,e,i){var a=e[0],l=e[1],h=e[2],f=e[3],m=Math.sin(i),v=Math.cos(i);return n[0]=a*v+h*m,n[1]=l*v+f*m,n[2]=a*-m+h*v,n[3]=l*-m+f*v,n},o.co=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},o.cp=Es,o.cq=function(n){var e=n[0],i=n[1],a=n[2],l=n[3];return Math.sqrt(e*e+i*i+a*a+l*l)},o.cr=gu,o.cs=$a,o.ct=nl,o.cu=3,o.cv=2,o.cw=7,o.cx=6,o.cy=Ol,o.cz=Yi,o.d=function(n){return Bn.API_TILEJSON_REGEX.test(n)},o.d$=i0,o.d0=N,o.d1=45,o.d2=rh,o.d3=function(n,e,i){const a=Math.sqrt(n*n+e*e+i*i),l=a>0?Math.acos(i/a)*vu:0;let h=n!==0||e!==0?Math.atan2(-e,-n)*vu+90:0;return h<0&&(h+=360),[a,h,l]},o.d4=yt,o.d5=rn,o.d6=ue,o.d7=_i,o.d8=Si,o.d9=On,o.dA=ah,o.dB=class extends _o{constructor(n){super(n),this.current=Hp}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.dC=xu,o.dD=function(n,e,i){const a=eo(i.zoom),l=n.style.map._antialias,h=n.terrain&&n.terrain.exaggeration()>0;return a===0&&!l&&!h},o.dE=function(n){const e=n.pixelsPerMeter,i=e/Z(1,n.center.lat),a=$i(new Float64Array(16));return ki(a,a,[n.point.x,n.point.y,0]),si(a,a,[i,i,e]),Float32Array.from(a)},o.dF=f1,o.dG=function(n){const e=Q-5;n=G(n,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Ui(n))),3);return Math.round(i*(p.length-1))},o.dH=function(n,e,i,a){const l=e.getNorth(),h=e.getSouth(),f=e.getWest(),m=e.getEast(),v=1<<n.z,x=m-f,S=l-h,E=x/u,A=-S/p[i],R=[0,E,0,A,0,0,l,f,0];if(n.z>0){const D=180/a;Hi(R,R,[D/x+1,0,0,0,D/S+1,0,-.5*D/E,.5*D/A,1])}return R[2]=v,R[5]=n.x,R[8]=n.y,R},o.dI=Cl,o.dJ=function(n,e,i){const a=$i(new Float64Array(16)),l=(e/(1<<n)-.5)*Math.PI*2;return mr(a,i.globeMatrix,l),Float32Array.from(a)},o.dK=Qp,o.dL=d1,o.dM=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},o.dN=Ft,o.dO=function(n,e){var i=Math.sin(e),a=Math.cos(e);return n[0]=a,n[1]=i,n[2]=0,n[3]=-i,n[4]=a,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},o.dP=ro,o.dQ=lp,o.dR=Rn,o.dS=An,o.dT=256,o.dU=function(n,e){const i=[0,0,0];return sr(i,i,nu(Cl(e.canonical))),sr(i,i,n),i},o.dV=n=>({u_matrix:new Tr(n),u_texsize:new Ia(n),u_pixels_to_tile_units:new cf(n),u_device_pixel_ratio:new Mr(n),u_width_scale:new Mr(n),u_floor_width_scale:new Mr(n),u_image:new lf(n),u_units_to_pixels:new Ia(n),u_tile_units_to_pixels:new Mr(n),u_alpha_discard_threshold:new Mr(n),u_trim_offset:new Ia(n),u_trim_fade_range:new Ia(n),u_trim_color:new rh(n),u_emissive_strength:new Mr(n),u_zbias_factor:new Mr(n),u_tile_to_meter:new Mr(n),u_ground_shadow_factor:new hc(n),u_pattern_transition:new Mr(n)}),o.dW=n=>({u_matrix:new Tr(n),u_pixels_to_tile_units:new cf(n),u_device_pixel_ratio:new Mr(n),u_width_scale:new Mr(n),u_floor_width_scale:new Mr(n),u_units_to_pixels:new Ia(n),u_dash_image:new lf(n),u_gradient_image:new lf(n),u_image_height:new Mr(n),u_texsize:new Ia(n),u_tile_units_to_pixels:new Mr(n),u_alpha_discard_threshold:new Mr(n),u_trim_offset:new Ia(n),u_trim_fade_range:new Ia(n),u_trim_color:new rh(n),u_emissive_strength:new Mr(n),u_zbias_factor:new Mr(n),u_tile_to_meter:new Mr(n),u_ground_shadow_factor:new hc(n)}),o.dX=n=>({u_camera_to_center_distance:new Mr(n),u_extrude_scale:new cf(n),u_device_pixel_ratio:new Mr(n),u_matrix:new Tr(n),u_inv_rot_matrix:new Tr(n),u_merc_center:new Ia(n),u_tile_id:new hc(n),u_zoom_transition:new Mr(n),u_up_dir:new hc(n),u_emissive_strength:new Mr(n)}),o.dY=oc,o.dZ=Ty,o.d_=class{constructor(n,e,i,a){this.context=n,this.format=a,this.size=i,this.texture=n.gl.createTexture();const[l,h,f]=this.size,{gl:m}=n;m.bindTexture(m.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&m.texImage3D(m.TEXTURE_3D,0,this.format,l,h,f,0,x_(this.format),b_(this.format),e.data)}bind(n,e){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_3D,this.texture),n!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,n),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},o.da=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},o.db=A2,o.dc=I_,o.dd=R2,o.de=J_,o.df=function(n,e){return n.readFields(x5,{icons:[]},e)},o.dg=Dt,o.dh=zp,o.di=U_,o.dj=bh,o.dk=Ga,o.dl=bu,o.dm=yc,o.dn=kt,o.dp=function(n){const e=n.indexOf(Zc);return e>=0?n.slice(0,e):n},o.dq=function(n){return n.indexOf(Zc)>=0},o.dr=function(n){const e=n.lastIndexOf(Zc);return e>=0?n.slice(e+1):""},o.ds=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.dt=function(n,e,i,a){return n.type==="custom"?new f5(n,e):new y5[n.type](n,e,i,a)},o.du=et,o.dv=function(n){const e=n.indexOf(Zc);return e>=0?n.slice(e+1):""},o.dw=class extends N1{constructor(n,e){super(n._vectorTileFeature,n._z,n._x,n._y,n.id),n.state&&(this.state=Object.assign({},n.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=n.source,this.sourceLayer=n.sourceLayer,this.layer=n.layer)}toJSON(){const n=super.toJSON();return n.target=this.target,n.namespace=this.namespace,n}},o.dx=Yu,o.dy=ul,o.dz=function(n){return n({pluginStatus:Aa,pluginURL:Qs}),Yu.on("pluginStateChange",n),n},o.e=Bn,o.e$=function([n,e,i]){const a=Math.hypot(n,e,i),l=Math.atan2(n,i),h=.5*Math.PI-Math.acos(-e/a);return new P(pa(l),pa(h))},o.e0=(n,e,i,a,l,h)=>{const f=n.transform,m=f.projection.name==="globe";let v;if(h.paint.get("circle-pitch-alignment")==="map")if(m){const S=lp(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;v=Float32Array.from([S,0,0,S])}else v=f.calculatePixelsToTileUnitsMatrix(i);else v=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const x={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(f.projection),u_matrix:n.translatePosMatrix(e.projMatrix,i,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:_a.devicePixelRatio,u_extrude_scale:v,u_inv_rot_matrix:t0,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(m){x.u_inv_rot_matrix=a,x.u_merc_center=l,x.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],x.u_zoom_transition=eo(f.zoom);const S=l[0]*pt,E=l[1]*pt;x.u_up_dir=f.projection.upVector(new Fo(0,0,0),S,E)}return x},o.e1=$2,o.e2=la,o.e3=(n,e,i,a,l,h,f,m,v,x)=>{const S=n.transform,E=S.pitch<15?q2(.07,.7,G((14-S.zoom)/5,0,1)):.07,A=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:X2(n,e,i,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:l,u_width_scale:h,u_floor_width_scale:f,u_image:0,u_tile_units_to_pixels:Z2(e,S),u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:m,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(A?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:E,u_tile_to_meter:ue(e.tileID.canonical,0),u_ground_shadow_factor:v,u_pattern_transition:x}},o.e4=(n,e,i,a,l,h,f,m,v,x)=>{const S=n.transform,E=S.calculatePixelsToTileUnitsMatrix(e),A=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",R=S.pitch<15?q2(.07,.7,G((14-S.zoom)/5,0,1)):.07;return{u_matrix:X2(n,e,i,a),u_pixels_to_tile_units:E,u_device_pixel_ratio:h,u_width_scale:f,u_floor_width_scale:m,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:l,u_texsize:W2(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Z2(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(A?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:R,u_tile_to_meter:ue(e.tileID.canonical,0),u_ground_shadow_factor:x}},o.e5=be,o.e6=fd,o.e7=se,o.e8=ts,o.e9=Rl,o.eA=t2,o.eB=R0,o.eC=z0,o.eD=[1,1,1],o.eE=Lp,o.eF=Fa,o.eG=function(n,e,i,a){var l=e[0],h=e[1],f=e[2],m=e[3];return n[0]=l+a*(i[0]-l),n[1]=h+a*(i[1]-h),n[2]=f+a*(i[2]-f),n[3]=m+a*(i[3]-m),n},o.eH=Ep,o.eI=Po,o.eJ=il,o.eK=function(n,e,i,a,l,h,f,m,v,x,S,E,A,R,D,F){var k=new We(16);return k[0]=n,k[1]=e,k[2]=i,k[3]=a,k[4]=l,k[5]=h,k[6]=f,k[7]=m,k[8]=v,k[9]=x,k[10]=S,k[11]=E,k[12]=A,k[13]=R,k[14]=D,k[15]=F,k},o.eL=M,o.eM=Qd,o.eN=cc,o.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new nt(1/0,1/0),max:new nt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const i=dm(new nt(0,0),new nt(pt,pt),n),a=[];if(e&&!Tf(i,this._globalClipBounds))return a;for(const l of this._activeRegions){if(l.hiddenByOverlap||!Tf(i,l))continue;const h=g_(l.min,l.max,n);a.push({min:h.min,max:h.max,sourceId:this._sourceIds[l.priority],footprint:l.footprint,footprintTileId:l.tileId,order:l.order,clipMask:l.clipMask,clipScope:l.clipScope})}return a}setSources(n){this._setSources(n.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const a of e.cache.getVisibleCoordinates()){const l=e.cache.getTile(a).buckets[e.layer];l&&l.updateFootprints(a.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const i=n.getOrder(),a=n.getClipMask(),l=n.getClipScope();for(const h of e){if(!h.footprint)continue;const f=dm(h.footprint.min,h.footprint.max,h.id);this._activeRegions.push({min:f.min,max:f.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:h.id,footprint:h.footprint,order:i,clipMask:a,clipScope:l})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,i)=>e.priority-i.priority||wf(e.min,i.min)||wf(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||(function(a,l){const h=(f,m)=>f+m;return a.length-l.length||a.reduce(h,"").localeCompare(l.reduce(h,""))})(e.clipScope,i.clipScope)));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const i=this._activeRegions[e],a=this._prevRegions[e];n=i.priority!==a.priority||!yp(i,a)||i.order!==a.order||i.clipMask!==a.clipMask||!ll(i.clipScope,a.clipScope),this._activeRegions[e].hiddenByOverlap=a.hiddenByOverlap,++e}}if(n){++this._updateTime;for(const i of this._activeRegions)i.order!==su&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const a=this._activeRegions;if(i>=a.length)return i;const l=a[i].priority;for(;i<a.length&&a[i].priority===l;)++i;return i};if(this._sourceIds.length>1){let i=0,a=e(i);for(;i!==a;){let l=i;const h=i;for(;l!==a;){const f=this._activeRegions[l];f.hiddenByOverlap=!1;for(let m=0;m<h;m++){const v=this._activeRegions[m];if(!v.hiddenByOverlap&&f.order===su&&Tf(f,v)&&(f.hiddenByOverlap=y0(f.footprint,f.tileId,v.footprint,v.tileId),f.hiddenByOverlap))break}++l}i=a,a=e(i)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},o.eP=su,o.eQ=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const i=new Qa,a=new Hn,l=[],h=n+1+2,f=e[0]+1,m=e[0]+1+(1+e.length),v=(x,S,E)=>{let A=x===h-1?x-2:x===0?x:x-1;return A+=E?24575:0,[A,S]};for(let x=0;x<h;++x)i.emplaceBack(...v(x,0,!0));for(let x=0;x<f;++x)for(let S=0;S<h;++S)i.emplaceBack(...v(S,x,(S===0||S===h-1)&&!0));for(let x=0;x<e.length;++x){const S=e[x];for(let E=0;E<h;++E)i.emplaceBack(...v(E,S,!0))}for(let x=0;x<e.length;++x){const S=a.length,E=e[x]+1+2,A=new Hn;for(let F=0;F<E-1;F++){const k=F===E-2,U=k?h*(m-e.length+x-F):h;for(let q=0;q<h-1;q++){const $=F*h+q;F===0||k||q===0||q===h-2?(A.emplaceBack($+1,$,$+U),A.emplaceBack($+U,$+U+1,$+1)):(a.emplaceBack($+1,$,$+U),a.emplaceBack($+U,$+U+1,$+1))}}const R=$n.simpleSegment(0,S,i.length,a.length-S);for(let F=0;F<A.uint16.length;F+=3)a.emplaceBack(A.uint16[F],A.uint16[F+1],A.uint16[F+2]);const D=$n.simpleSegment(0,S,i.length,a.length-S);l.push({withoutSkirts:R,withSkirts:D})}return{vertices:i,indices:a,segments:l}}_createGrid(n){const e=this._fillGridMeshWithLods(u,p);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,qp.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new Hn;for(let f=0;f<=u;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new lc,a=new lc,l=new lc,h=new lc;this._poleSegments=[];for(let f=0,m=0;f<c;f++){const v=360/(1<<f);i.emplaceBack(0,-Jn,0,.5,0),a.emplaceBack(0,-Jn,0,.5,1),l.emplaceBack(0,-Jn,0,.5,.5),h.emplaceBack(0,-Jn,0,.5,.5);for(let x=0;x<=u;x++){let S=x/u,E=0;const A=ti(0,v,S),[R,D,F]=b(Qm,e0,A,Jn);i.emplaceBack(R,D,F,S,E),a.emplaceBack(R,D,F,S,1-E);const k=Ui(A);S=.5+.5*Math.sin(k),E=.5+.5*Math.cos(k),l.emplaceBack(R,D,F,S,E),h.emplaceBack(R,D,F,S,1-E)}this._poleSegments.push($n.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,dd,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(a,dd,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(l,dd,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(h,dd,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},o.eR=hm,o.eS=Te,o.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.eU=V,o.eV=te,o.eW=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},o.eX=gc,o.eY=T,o.eZ=Kn,o.e_=jt,o.ea=Cf,o.eb=lu,o.ec=bp,o.ed=mm,o.ee=ie,o.ef=function(n,e){if(n===e){var i=e[1],a=e[2],l=e[3],h=e[6],f=e[7],m=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=i,n[6]=e[9],n[7]=e[13],n[8]=a,n[9]=h,n[11]=e[14],n[12]=l,n[13]=f,n[14]=m}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},o.eg=d5,o.eh=zi,o.ei=Kr,o.ej=256,o.ek=_1,o.el=Do,o.em=mr,o.en=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},o.eo=lc,o.ep=Jd,o.eq=Xf,o.er=function(n,e,i,a,l){return G((n-e)/(i-e)*(l-a)+a,a,l)},o.es=Ms,o.et=function(n,e){var i=e[0],a=e[1],l=e[2],h=e[3],f=e[4],m=e[5],v=e[6],x=e[7],S=e[8],E=S*f-m*x,A=-S*h+m*v,R=x*h-f*v,D=i*E+a*A+l*R;return D?(n[0]=E*(D=1/D),n[1]=(-S*a+l*x)*D,n[2]=(m*a-l*f)*D,n[3]=A*D,n[4]=(S*i-l*v)*D,n[5]=(-m*i+l*h)*D,n[6]=R*D,n[7]=(-x*i+a*v)*D,n[8]=(f*i-a*h)*D,n):null},o.eu=2,o.ev=Lr,o.ew=Bl,o.ex=Ss,o.ey=function(n,e){var i=new We(3);Ss(i,e);var a=1/i[0],l=1/i[1],h=1/i[2],f=e[0]*a,m=e[1]*l,v=e[2]*h,x=e[4]*a,S=e[5]*l,E=e[6]*h,A=e[8]*a,R=e[9]*l,D=e[10]*h,F=f+S+D,k=0;return F>0?(k=2*Math.sqrt(F+1),n[3]=.25*k,n[0]=(E-R)/k,n[1]=(A-v)/k,n[2]=(m-x)/k):f>S&&f>D?(k=2*Math.sqrt(1+f-S-D),n[3]=(E-R)/k,n[0]=.25*k,n[1]=(m+x)/k,n[2]=(A+v)/k):S>D?(k=2*Math.sqrt(1+S-f-D),n[3]=(A-v)/k,n[0]=(m+x)/k,n[1]=.25*k,n[2]=(E+R)/k):(k=2*Math.sqrt(1+D-f-S),n[3]=(m-x)/k,n[0]=(A+v)/k,n[1]=(E+R)/k,n[2]=.25*k),n},o.ez=function(n,e){var i=2*Math.acos(e[3]),a=Math.sin(i/2);return a>Tt?(n[0]=e[0]/a,n[1]=e[1]/a,n[2]=e[2]/a):(n[0]=1,n[1]=0,n[2]=0),i},o.f=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,((e,i)=>String.fromCharCode(+("0x"+i)))))},o.f0=_h,o.f1=T_,o.f2=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!(function(i){if(wr==null){const a=i.navigator?i.navigator.userAgent:null;wr=!!i.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return wr})(n)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.f3=function(n,e){xh=n,Na=e},o.f4=$p,o.f5=df,o.f6=function(n){const e=[0,0,0],i=$i(new Float64Array(16));return Ci(i,n.pixelMatrix,n.globeMatrix),sr(e,e,i),new nt(e[0],e[1])},o.f7=function(){const n=De;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(L),De=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.f8=function(){Dt().acquire(L)},o.f9=Vc,o.fA=it,o.fB=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==b2){const i=new Uint32Array(n,0,7),[,,a,l,h,f]=i;e=i.byteLength+l+h+f+h,(a!==n.byteLength||e>=n.byteLength)&&Gt("Invalid b3dm header information.")}return E2(n,e)},o.fC=function(n,e){const i=I_(n);for(const a of i){for(const l of a.meshes)X4(l);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push($4(a.lights,e)))}return i},o.fD=K0,o.fE=jn,o.fF=w,o.fG=Ha,o.fH=mo,o.fI=function(n){Ps(),Ta?.then((e=>{e.keys().then((i=>{for(let a=0;a<i.length-n;a++)e.delete(i[a]).catch((l=>Gt(l.message)))})).catch((i=>Gt(i.message)))})).catch((e=>Gt(e.message)))},o.fa=function(n,e,i=!1){if(Aa===mo.deferred||Aa===mo.loading||Aa===mo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Qs=_a.resolveURL(n),Aa=mo.deferred,Jh=e,jr(),i||Ku()},o.fb=function(n){ji=_a.resolveURL(n),Qe||(Qe=new he(Dt(),new hl)),Qe.broadcast("setMeshoptUrl",ji)},o.fc=pr,o.fd=function(n){wt=_a.resolveURL(n),Qe||(Qe=new he(Dt(),new hl)),Qe.broadcast("setDracoUrl",wt)},o.fe=Gi,o.ff=C,o.fg=function(n){const e=cl();if(!e)return;const i=e.delete(Ds);n&&i.then((()=>n())).catch(n)},o.fh=X,o.fi=st,o.fj=zl,o.fk=pu,o.fl=U3,o.fm=V3,o.fn=V2,o.fo=St,o.fp="hd_road_elevation",o.fq=$t,o.fr=ct,o.fs=ou,o.ft=N_,o.fu=B1,o.fv=function(n,e,i,a,l,h,f,m=1,v,x,S){n.createArrays(),n.tilePixelRatio=pt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const E=n.layers[0].layout,A=n.layers[0]._unevaluatedLayout._values,R={};R.scaleFactor=m,R.textSizeScaleRange=E.get("text-size-scale-range"),R.iconSizeScaleRange=E.get("icon-size-scale-range");const[D,F]=R.textSizeScaleRange,[k,U]=R.iconSizeScaleRange;R.textScaleFactor=G(R.scaleFactor,D,F),R.iconScaleFactor=G(R.scaleFactor,k,U);const q=A["text-size"],$=A["icon-size"];if(n.textSizeData.kind==="composite"){const{minZoom:ye,maxZoom:Be}=n.textSizeData;R.compositeTextSizes=[q.possiblyEvaluate(new mn(ye,{worldview:S}),h),q.possiblyEvaluate(new mn(Be,{worldview:S}),h)]}if(n.iconSizeData.kind==="composite"){const{minZoom:ye,maxZoom:Be}=n.iconSizeData;R.compositeIconSizes=[$.possiblyEvaluate(new mn(ye,{worldview:S}),h),$.possiblyEvaluate(new mn(Be,{worldview:S}),h)]}R.layoutTextSize=q.possiblyEvaluate(new mn(f+1,{worldview:S}),h),R.layoutIconSize=$.possiblyEvaluate(new mn(f+1,{worldview:S}),h),R.textMaxSize=q.possiblyEvaluate(new mn(18,{worldview:S}),h);const Y=E.get("symbol-placement"),le=E.get("text-rotation-alignment")==="map"&&Y!=="point",ne=E.get("text-size");let de=!1;const _e=[];for(const ye of n.features){const Be=E.get("text-font").evaluate(ye,{},h).join(","),Ee=ne.evaluate(ye,{},h)*R.textScaleFactor,Ve=R.layoutTextSize.evaluate(ye,{},h)*R.textScaleFactor,Xe=R.layoutIconSize.evaluate(ye,{},h)*R.iconScaleFactor,tt={horizontal:{},vertical:void 0},gt=ye.text;let ot,Ye=[0,0];if(gt){const Ii=gt.toString(),tn=E.get("text-letter-spacing").evaluate(ye,{},h)*Ca,vi=E.get("text-line-height").evaluate(ye,{},h)*Ca,cn=Wu(Ii)?tn:0,un=E.get("text-anchor").evaluate(ye,{},h),dr=E.get("text-variable-anchor");if(!dr){const qe=E.get("text-radial-offset").evaluate(ye,{},h);if(qe)Ye=Sg(un,[qe*Ca,j_]);else{const At=E.get("text-offset").evaluate(ye,{},h);Ye=[At[0]*Ca,At[1]*Ca]}}let re=le?"center":E.get("text-justify").evaluate(ye,{},h);const ee=Y==="point",He=ee?E.get("text-max-width").evaluate(ye,{},h)*Ca:1/0,bt=qe=>{n.allowVerticalPlacement&&$u(Ii)&&(tt.vertical=O_(gt,e,i,l,Be,He,vi,un,qe,cn,Ye,xs.vertical,!0,Ve,Ee,v))};if(!le&&dr){const qe=re==="auto"?dr.map((Zt=>G_(Zt))):[re];let At=!1;for(let Zt=0;Zt<qe.length;Zt++){const Ht=qe[Zt];if(!tt.horizontal[Ht])if(At)tt.horizontal[Ht]=tt.horizontal[0];else{const bi=O_(gt,e,i,l,Be,He,vi,"center",Ht,cn,Ye,xs.horizontal,!1,Ve,Ee,v);bi&&(tt.horizontal[Ht]=bi,At=bi.positionedLines.length===1)}}bt("left")}else{if(re==="auto"&&(re=G_(un)),ee||E.get("text-writing-mode").indexOf("horizontal")>=0||!$u(Ii)){const qe=O_(gt,e,i,l,Be,He,vi,un,re,cn,Ye,xs.horizontal,!1,Ve,Ee,v);qe&&(tt.horizontal[re]=qe)}bt(ee?"left":re)}}let at,Fe,Le,rt,mt,Ke,Lt=!1;const Nt=E.get("icon-text-fit").evaluate(ye,{},h);if(ye.icon&&ye.icon.hasPrimary()){const Ii=Cm(ye.icon,n.iconSizeData,A["icon-size"],h,n.zoom,ye,v,R.iconScaleFactor,S);at=Ii.iconPrimary,Le=Ii.iconSecondary;const tn=at.toString();if(Fe=a.get(tn),Fe&&(mt=E.get("icon-offset").evaluate(ye,{},h),Ke=E.get("icon-anchor").evaluate(ye,{},h),ot=F0(l.get(tn),Le?l.get(Le.toString()):void 0,mt,Ke),Lt=Fe.sdf,n.sdfIcons===void 0?n.sdfIcons=Fe.sdf:n.sdfIcons!==Fe.sdf&&Gt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Fe.pixelRatio!==n.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0)),Le){const vi=Le.toString();rt=a.get(vi)}}de=de||!(!ye.icon||!ye.icon.hasSecondary());const zt=H_(tt.horizontal)||tt.vertical;n.iconsInText||(n.iconsInText=!!zt&&zt.iconsInText);const Et=Ve*R.textScaleFactor/Ca,{defaultShapedIcon:ui,verticallyShapedIcon:Ct}=Jy(n,ot,E,ye,h,tt,Et,mt,Nt);Nt!=="none"&&ot&&(cg(ot)||ug(ot))&&(V0(0,Fe,at,ot,ui,Nt,x,a,l),V0(0,rt,Le,ot,ui,Nt,x,a,l),Ct&&(V0(0,Fe,at,ot,Ct,Nt,x,a,l),V0(0,rt,Le,ot,Ct,Nt,x,a,l))),ot=ui;const{iconBBox:Yt,iconVerticalBBox:pi}=Wy(n,ot,Ct,E,ye,h,Xe,mt,R,l,Ke);_e.push({feature:ye,shapedTextOrientations:tt,shapedText:zt,shapedIcon:ot,iconPrimary:at,iconSecondary:Le,iconOffset:mt,iconAnchor:Ke,verticallyShapedIcon:Ct,layoutTextSize:Ve,layoutIconSize:Xe,textOffset:Ye,isSDFIcon:Lt,iconTextFit:Nt,iconCollisionBounds:Yt,iconVerticalCollisionBounds:pi})}return{featureData:_e,sizes:R,hasAnySecondaryIcon:de,textAlongLine:le,symbolPlacement:Y}},o.fw=yg,o.fx=function(n,e,i,a,l,h,f,m,v,x){n.iconAtlasPositions=x.iconPositions;const{featureData:S,hasAnySecondaryIcon:E,sizes:A,textAlongLine:R,symbolPlacement:D}=e;for(const F of S){const{shapedIcon:k,verticallyShapedIcon:U,feature:q,shapedTextOrientations:$,shapedText:Y,layoutTextSize:le,textOffset:ne,isSDFIcon:de,iconPrimary:_e,iconSecondary:ye,iconTextFit:Be,iconOffset:Ee,iconCollisionBounds:Ve,iconVerticalCollisionBounds:Xe}=F;Ag(k,x.iconPositions,_e,ye),Ag(U,x.iconPositions,_e,ye),Ky($,x.iconPositions),Yy(_e,ye,x.iconPositions),(Y||k)&&Qy(n,q,$,k,U,v,A,le,0,ne,de,a,l,f,m,E,Be,Ee,R,D,Ve,Xe)}i&&n.generateCollisionDebugBuffers(h,n.collisionBoxArray,A.textScaleFactor)},o.fy=xt,o.fz=n_,o.g=function(n,e){return ul(Object.assign(n,{method:"GET"}),e)},o.h=function(n){return n.indexOf("mapbox:")===0},o.i=function(n){return Bn.API_STYLE_REGEX.test(n)&&!ma(n)},o.j=kr,o.k=wu,o.l=function(n){return decodeURIComponent(atob(n).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))},o.m=function(n,e){return ul(Object.assign(n,{type:"json"}),e)},o.n=Eu,o.o=_a,o.p=function(n,e){return ul(Object.assign(n,{method:"POST"}),e)},o.q=fa,o.r=ka,o.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=function(){return ht||(ht=new X),ht},o.u=function(){return(function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)})()},o.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},o.w=Gt,o.x=o2,o.y=Gl,o.z=Ra})),ke(["./shared"],(function(o){function Tt(Te){const V=Te?Te.url.toString():void 0;return V?performance.getEntriesByName(V):[]}function We(Te){if(typeof Te=="number"||typeof Te=="boolean"||typeof Te=="string"||Te==null)return JSON.stringify(Te);if(Array.isArray(Te)){let G="[";for(const J of Te)G+=`${We(J)},`;return`${G}]`}let V="{";for(const G of Object.keys(Te).sort())V+=`${G}:${We(Te[G])},`;return`${V}}`}function ci(Te){let V="";for(const G of o.bw)V+=`/${We(Te[G])}`;return V}class Ft{constructor(V){this.keyCache={},this._layers={},this._layerConfigs={},V&&this.replace(V)}replace(V,G){this._layerConfigs={},this._layers={},this.update(V,[],G)}update(V,G,J){this._options=J;for(const fe of V)this._layerConfigs[fe.id]=fe,(this._layers[fe.id]=o.dt(fe,this.scope,null,this._options)).compileFilter(J),this.keyCache[fe.id]&&delete this.keyCache[fe.id];for(const fe of G)delete this.keyCache[fe],delete this._layerConfigs[fe],delete this._layers[fe];this.familiesBySource={};const pe=(function(fe,xe){const Pe={};for(let Ce=0;Ce<fe.length;Ce++){const ct=fe[Ce];let et=xe&&xe[ct.id];et||(ct.type==="symbol"?et=ct.id:(et=ci(ct),ct.type==="line"&&ct.paint&&(function ei(Jt){return typeof Jt=="string"&&Jt==="line-progress"||(Array.isArray(Jt)?Jt.some(ei):!(!Jt||typeof Jt!="object")&&Object.values(Jt).some(ei))})(ct.paint["line-width"])&&(et+=`/${We(ct.paint["line-width"])}`))),xe&&(xe[ct.id]=et);let kt=Pe[et];kt||(kt=Pe[et]=[]),kt.push(ct)}const be=[];for(const Ce in Pe)be.push(Pe[Ce]);return be})(Object.values(this._layerConfigs),this.keyCache);for(const fe of pe){const xe=fe.map((kt=>this._layers[kt.id])),Pe=xe[0];if(Pe.visibility==="none")continue;const be=Pe.source||"";let Ce=this.familiesBySource[be];Ce||(Ce=this.familiesBySource[be]={});const ct=Pe.sourceLayer||"_geojsonTileLayer";let et=Ce[ct];et||(et=Ce[ct]=[]),et.push(xe)}}}const Pi=1*o.fk;class Hi{constructor(V){const G={},J=[];for(const Pe in V){const be=V[Pe],Ce=G[Pe]={};for(const ct in be.glyphs){const et=be.glyphs[+ct];if(!et||et.bitmap.width===0||et.bitmap.height===0)continue;const kt=et.metrics.localGlyph?Pi:1,ei={x:0,y:0,w:et.bitmap.width+2*kt,h:et.bitmap.height+2*kt};J.push(ei),Ce[ct]=ei}}const{w:pe,h:fe}=o.G(J),xe=new o.fj({width:pe||1,height:fe||1});for(const Pe in V){const be=V[Pe];for(const Ce in be.glyphs){const ct=be.glyphs[+Ce];if(!ct||ct.bitmap.width===0||ct.bitmap.height===0)continue;const et=G[Pe][Ce],kt=ct.metrics.localGlyph?Pi:1;o.fj.copy(ct.bitmap,xe,{x:0,y:0},{x:et.x+kt,y:et.y+kt},ct.bitmap)}}this.image=xe,this.positions=G}}function yn(Te,V,G){Te[V]?G&&(Te[V].center=G):Te[V]={floorIds:new Set,center:G||[0,0],floors:{}}}function hi(Te,V,G,J){for(const pe of V)yn(Te,pe),Te[pe].floors[G]=J,Te[pe].floorIds.add(G)}function $i(Te){return{id:Te.properties.id.toString(),center:Te.properties.center.toString().split(";").map(Number)}}function vn(Te){return{id:Te.properties.id.toString(),isDefault:!!Te.properties.is_default&&Te.properties.is_default,connections:Te.properties.connected_floor_ids?new Set(Te.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Te.properties.conflicted_floor_ids?new Set(Te.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Te.properties.building_ids?new Set(Te.properties.building_ids.toString().split(";")):new Set,name:Te.properties.name.toString(),zIndex:Te.properties.z_index}}function Ci(Te,V){return V.every((G=>Te.properties&&Te.properties[G]!=null))}function ki(Te){return Ci(Te,["type","id","name"])&&Te.properties.type==="building"}function si(Te){return Ci(Te,["type","id","name","z_index"])&&Te.properties.type==="floor"}o.fi(Hi,"GlyphAtlas");class _n{constructor(V){this.tileID=new o.aP(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.tileZoom=V.tileZoom,this.uid=V.uid,this.zoom=V.zoom,this.lut=V.lut,this.canonical=V.tileID.canonical,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.scope=V.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.request&&V.request.collectResourceTiming,this.promoteId=V.promoteId,this.isSymbolTile=V.isSymbolTile,this.tileTransform=o.aY(V.tileID.canonical,V.projection),this.projection=V.projection,this.worldview=V.worldview,this.localizableLayerIds=V.localizableLayerIds,this.brightness=V.brightness,this.extraShadowCaster=!!V.extraShadowCaster,this.tessellationStep=V.tessellationStep,this.scaleFactor=V.scaleFactor,this.worldview=V.worldview,this.indoor=V.indoor}parse(V,G,J,pe,fe,xe){this.status="parsing",this.data=V,this.collisionBoxArray=new o.b2;const Pe=new o.fl(Object.keys(V.layers).sort()),be=new o.fm(this.tileID,this.promoteId);be.bucketLayerIDs=[];const Ce={},ct=new o.fn(256,256),et={featureIndex:be,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:ct,availableImages:J,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Gt=this.indoor.indoorState.activeFloorsVisible,Ei=(function(Mi,rn,jn){const Pr=(function(xn,Oi){if(!xn)return o.w("No source layers defined in indoor specification"),Oi;if(xn.size===0)return Oi;const Rn=xn.difference(Oi);for(const An of Rn)o.w(`Missing source layer required in indoor specification: ${An}`);return Oi.intersection(Oi)})(rn.sourceLayers,new Set(Object.keys(Mi.layers))),wr=rn.indoorState,_r=(function(xn,Oi,Rn,An){const qi=new Set,Bn=new Set,kr=new Set,ma=new Map,To={},Rs=Xr=>{const Nr=ma.get(Xr)||new Set;for(const wa of qi)if((ma.get(wa)||new Set).has(Xr)||Nr.has(wa))return!0;return!1};for(const Xr of Oi){const Nr=xn.layers[Xr];if(Nr)for(let wa=0;wa<Nr.length;wa++){const No=Nr.feature(wa);if(ki(No)){const{id:ka,center:_a}=$i(No);yn(To,ka,_a),qi.add(ka)}else if(si(No)){const{id:ka,isDefault:_a,connections:vh,conflicts:bu,buildings:Ds,name:xh,zIndex:Na}=vn(No);hi(To,Ds,ka,{name:xh,zIndex:Na}),ma.set(ka,bu),(ka===An||vh.has(An))&&qi.add(ka),Bn.add(ka),_a&&kr.add(ka)}}else o.w(`indoor source layer not found: ${Xr}`)}if(Rn)for(const Xr of Rn)Bn.has(Xr)&&(Rs(Xr)||qi.add(Xr));for(const Xr of kr)qi.has(Xr)||Rs(Xr)||qi.add(Xr);return{buildings:To,activeFloors:qi}})(Mi,Pr,wr.lastActiveFloors,wr.selectedFloorId);return jn.send("setIndoorData",_r),_r})(V,this.indoor,fe);et.activeFloors=Gt?Ei.activeFloors:void 0}const kt=[],ei=G.familiesBySource[this.source];for(const Gt in ei){const Ei=V.layers[Gt];if(!Ei)continue;let Mi=!1,rn=!1,jn=!1;for(const xn of ei[Gt])xn[0].type==="symbol"?Mi=!0:rn=!0,xn[0].is3D()&&xn[0].type!=="model"&&(jn=!0);if(this.extraShadowCaster&&!jn||this.isSymbolTile===!0&&!Mi||this.isSymbolTile===!1&&!rn)continue;Ei.version===1&&o.w(`Vector tile source "${this.source}" layer "${Gt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Pr=Pe.encode(Gt),wr=[];let _r=!1;for(let xn=0,Oi=0;xn<Ei.length;xn++){const Rn=Ei.feature(xn),An=be.getId(Rn,Gt);if(this.localizableLayerIds&&this.localizableLayerIds.has(Gt)){const qi=Rn.properties?Rn.properties.worldview:null;if(this.worldview&&typeof qi=="string")if(qi==="all")Rn.properties.$localized=!0;else{if(!qi.split(",").includes(this.worldview))continue;Rn.properties.$localized=!0,Rn.properties.worldview=this.worldview}}!_r&&Rn.properties&&Rn.properties.hasOwnProperty(o.fo)&&(_r=!0),wr.push({feature:Rn,id:An,index:Oi,sourceLayerIndex:Pr}),Oi++}_r&&!et.elevationFeatures&&V.layers.hasOwnProperty(o.fp)&&(et.elevationFeatures=o.fq.parseFrom(V.layers[o.fp],this.canonical));for(const xn of ei[Gt]){const Oi=xn[0];if(this.extraShadowCaster&&(!Oi.is3D()||Oi.type==="model")||this.isSymbolTile!==void 0&&Oi.type==="symbol"!==this.isSymbolTile||Oi.minzoom&&this.zoom<Math.floor(Oi.minzoom)||Oi.maxzoom&&this.zoom>=Oi.maxzoom||Oi.visibility==="none")continue;mr(xn,this.zoom,et.brightness,J,this.worldview);const Rn=Ce[Oi.id]=Oi.createBucket({index:be.bucketLayerIDs.length,layers:xn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Pr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:pe,worldview:this.worldview});be.bucketLayerIDs.push(xn.map((qi=>o.B(qi.id,qi.scope))));let An=Rn.prepare?Rn.prepare():null;An!=null?(An=An.then((()=>Rn.populate(wr,et,this.tileID.canonical,this.tileTransform))),kt.push(An)):Rn.populate(wr,et,this.tileID.canonical,this.tileTransform)}}const Jt=()=>{let Gt,Ei,Mi,rn,jn,Pr;ct.trim();const wr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},_r=()=>{if(Gt)return this.status="done",xe(Gt);if(this.extraShadowCaster)this.status="done",xe(null,{buckets:Object.values(Ce).filter((Oi=>!Oi.isEmpty())),featureIndex:be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:et.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Ei&&Mi&&rn){const Oi=new Hi(Ei),Rn=new Map;for(const[Bn,kr]of Mi.entries()){const{imagePosition:ma}=o.ft(Bn,kr,o.fu);Rn.set(Bn,ma)}const An={};for(const Bn in Ce){const kr=Ce[Bn];kr instanceof o.b3&&(mr(kr.layers,this.zoom,et.brightness,J,this.worldview),An[Bn]=o.fv(kr,Ei,Oi.positions,Mi,Rn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,jn,this.worldview))}const qi={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(fe,Mi,jn,(()=>{qi.iconsPending=!1,xn(An,Oi,qi)})),this.rasterizeIfNeeded(fe,rn,Pr,(()=>{qi.patternsPending=!1,xn(An,Oi,qi)}))}},xn=(Oi,Rn,An,qi)=>{if(An.iconsPending||An.patternsPending)return;const Bn=new o.fw(Mi,rn,this.lut);for(const kr in Ce){const ma=Ce[kr];if(kr in Oi)o.fx(ma,Oi[kr],this.showCollisionBoxes,J,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Mi,Bn);else if(ma.hasPattern&&(ma instanceof o.b9||ma instanceof o.ba||ma instanceof o.e9)){mr(ma.layers,this.zoom,et.brightness,J,this.worldview);const To=Object.fromEntries(Bn.patternPositions);ma.addFeatures(et,this.tileID.canonical,To,J,this.tileTransform,this.brightness)}}this.status="done",xe(null,{buckets:Object.values(Ce).filter((kr=>!kr.isEmpty())),featureIndex:be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Rn.image,lineAtlas:ct,imageAtlas:Bn,brightness:et.brightness})};if(!this.extraShadowCaster){const Oi=o.fr(et.glyphDependencies,(qi=>Object.keys(qi).map(Number)));Object.keys(Oi).length?fe.send("getGlyphs",{uid:this.uid,stacks:Oi},((qi,Bn)=>{Gt||(Gt=qi,Ei=Bn,_r())}),void 0,!1,wr):Ei={};const Rn=Array.from(et.iconDependencies.keys()).map((qi=>o.I.parse(qi)));Rn.length?fe.send("getImages",{images:Rn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((qi,Bn)=>{Gt||(Gt=qi,Mi=new Map,jn=this.updateImageMapAndGetImageTaskQueue(Mi,Bn,et.iconDependencies),_r())}),void 0,!1,wr):(Mi=new Map,jn=new Map);const An=Array.from(et.patternDependencies.keys()).map((qi=>o.I.parse(qi)));An.length?fe.send("getImages",{images:An,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((qi,Bn)=>{Gt||(Gt=qi,rn=new Map,Pr=this.updateImageMapAndGetImageTaskQueue(rn,Bn,et.patternDependencies),_r())}),void 0,!1,wr):(rn=new Map,Pr=new Map)}if(et.elevationFeatures&&et.elevationFeatures.length>0){const Oi=[];for(const An of Object.values(Ce))if(An instanceof o.ba){const qi=An.getUnevaluatedPortalGraph();qi&&Oi.push(qi)}const Rn=o.fs.evaluate(Oi);for(const An of Object.values(Ce))if(An instanceof o.ba){const qi=V.layers[Pe.decode(An.sourceLayerIndex)];An.setEvaluatedPortalGraph(Rn,qi,this.tileID.canonical,et.availableImages,et.brightness)}}_r()};kt.length>0?Promise.allSettled(kt).then(Jt).catch(xe):Jt()}updateParameters(V){this.scaleFactor=V.scaleFactor,this.showCollisionBoxes=V.showCollisionBoxes,this.projection=V.projection,this.brightness=V.brightness,this.tileTransform=o.aY(V.tileID.canonical,V.projection),this.extraShadowCaster=V.extraShadowCaster,this.lut=V.lut,this.worldview=V.worldview,this.indoor=V.indoor}rasterizeIfNeeded(V,G,J,pe){Array.from(G.values()).some((fe=>fe.usvg))?this.rasterize(V,G,J,pe):pe()}updateImageMapAndGetImageTaskQueue(V,G,J){const pe=new Map;for(const fe of G.keys()){const xe=J.get(fe)||[];for(const Pe of xe){const be=Pe.toString(),Ce=G.get(Pe.id.toString());Ce.usvg?pe.has(be)||(pe.set(be,Pe),V.set(be,Object.assign({},Ce))):V.set(be,Ce)}}return pe}rasterize(V,G,J,pe){this.rasterizeTask=V.send("rasterizeImages",{scope:this.scope,tasks:J},((fe,xe)=>{if(!fe)for(const[Pe,be]of xe.entries()){const Ce=Object.assign(G.get(Pe),{data:be});G.set(Pe,Ce)}pe()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function mr(Te,V,G,J,pe){const fe=new o.ac(V,{brightness:G,worldview:pe});for(const xe of Te)xe.recalculate(fe,J)}class ln extends o.E{constructor(V,G,J,pe,fe,xe,Pe){super(),this.actor=V,this.layerIndex=G,this.availableImages=J,this.availableModels=pe,this.loadVectorData=xe||o.aL,this.loading={},this.loaded={},this.deduped=new o.aK(V.scheduler),this.isSpriteLoaded=fe,this.scheduler=V.scheduler,this.brightness=Pe}loadTile(V,G){const J=V.uid,pe=V&&V.request,fe=pe&&pe.collectResourceTiming,xe=this.loading[J]=new _n(V);xe.abort=this.loadVectorData(V,((Pe,be)=>{const Ce=!this.loading[J];if(delete this.loading[J],xe.cancelRasterize(),Ce||Pe||!be)return xe.status="done",Ce||(this.loaded[J]=xe),G(Pe);const ct=be.rawData,et={},kt=o.aM(be.responseHeaders);kt&&kt.expires&&(et.expires=kt.expires),kt&&kt.cacheControl&&(et.cacheControl=kt.cacheControl),xe.vectorTile=be.vectorTile||new o.fy(new o.bs(ct));const ei=()=>{xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((Jt,Gt)=>{if(Jt||!Gt)return G(Jt);const Ei={};if(fe){const Mi=Tt(pe);Mi.length>0&&(Ei.resourceTiming=JSON.parse(JSON.stringify(Mi)))}G(null,Object.assign({rawTileData:ct.slice(0),responseHeaders:be.responseHeaders},Gt,et,Ei))}))};this.isSpriteLoaded?ei():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(ei,{type:"parseTile",isSymbolTile:V.isSymbolTile,zoom:V.tileZoom}):ei()})),this.loaded=this.loaded||{},this.loaded[J]=xe}))}reloadTile(V,G){const J=this.loaded,pe=V.uid;if(J&&J[pe]){const fe=J[pe];fe.updateParameters(V);const xe=(Pe,be)=>{const Ce=fe.reloadCallback;Ce&&(delete fe.reloadCallback,fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ce)),G(Pe,be)};fe.status==="parsing"?fe.reloadCallback=xe:fe.status==="done"&&(fe.vectorTile?fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,xe):xe())}else G(null,void 0)}abortTile(V,G){const J=V.uid,pe=this.loading[J];pe&&(pe.abort&&pe.abort(),delete this.loading[J]),G()}removeTile(V,G){const J=this.loaded,pe=V.uid;J&&J[pe]&&delete J[pe],G()}}class ea{loadTile(V,G){const{uid:J,encoding:pe,rawImageData:fe,padding:xe}=V,Pe=ImageBitmap&&fe instanceof ImageBitmap?this.getImageData(fe,xe):fe;G(null,new o.fz(J,Pe,pe,xe<1))}reloadTile(V,G){G(null,null)}abortTile(V,G){G()}removeTile(V,G){G()}getImageData(V,G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const J=this.offscreenCanvasContext.getImageData(-G,-G,V.width+2*G,V.height+2*G);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),J}}o.br.setPbf(o.bs);class Oa{constructor(V){this._mrt=new o.br(V.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=V.uid,this.tileID=V.tileID,this.source=V.source}parse(V,G){const J=this._mrt;this.status="parsing",this._entireBuffer=V;try{J.parseHeader(V),this._isHeaderLoaded=!0;const pe=[];for(const fe in J.layers){const xe=J.getLayer(fe),Pe=xe.getDataRange(xe.getBandList()),be=J.createDecodingTask(Pe),Ce=V.slice(Pe.firstByte,Pe.lastByte+1),ct=o.br.performDecoding(Ce,be).then((et=>be.complete(null,et))).catch((et=>be.complete(et,null)));pe.push(ct)}Promise.allSettled(pe).then((()=>G(null,J))).catch((fe=>G(fe)))}catch(pe){G(pe)}}}class Ss{constructor(V){this.actor=V,this.loading={},this.loaded={}}loadTile(V,G){const J=V.uid,pe=V.request,fe=this.loading[J]=new Oa(V),{cancel:xe}=o.bt(pe,((Pe,be,Ce)=>{const ct=!this.loading[J];if(delete this.loading[J],ct||Pe||!be)return fe.status="done",ct||(this.loaded[J]=fe),G(Pe);fe.parse(be,((et,kt)=>{if(et||!kt)return G(et);G(null,kt,Ce)})),this.loaded[J]=fe}));fe.abort=xe}reloadTile(V,G){G(null,void 0)}abortTile(V,G){const J=V.uid,pe=this.loading[J];pe&&(pe.abort&&pe.abort(),delete this.loading[J]),G()}removeTile(V,G){const J=V.uid;this.loaded[J]&&delete this.loaded[J],G()}decodeRasterArray(V,G){o.br.performDecoding(V.buffer,V.task).then((J=>G(null,J))).catch((J=>G(J)))}}const no=o.fA.prototype.toGeoJSON;class xa{constructor(V){this._feature=V,this.extent=o.al,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))}loadGeometry(){if(this._feature.type===1){const V=[];for(const G of this._feature.geometry)V.push([new o.P(G[0],G[1])]);return V}{const V=[];for(const G of this._feature.geometry){const J=[];for(const pe of G)J.push(new o.P(pe[0],pe[1]));V.push(J)}return V}}toGeoJSON(V,G,J){return no.call(this,V,G,J)}}class Yi{constructor(V,G){this.name=V,this.extent=o.al,this.length=G.length,this._jsonFeatures=G}feature(V){return new xa(this._jsonFeatures[V])}}class Bo{constructor(V){this.layers={},this.extent=o.al;for(const G of Object.keys(V))this.layers[G]=new Yi(G,V[G])}}const zr=64/4096,yt=128;class jt{constructor(){this.features=new Map}clear(){this.features.clear()}load(V=[],G){for(const J of V){const pe=J.id;if(pe==null)continue;let fe=this.features.get(pe);fe&&this.updateCache(fe,G),J.geometry?(fe=On(J),this.updateCache(fe,G),this.features.set(pe,fe)):this.features.delete(pe),this.updateCache(fe,G)}}updateCache(V,G){for(const{canonical:J,uid:pe}of Object.values(G)){const{z:fe,x:xe,y:Pe}=J;_i(V,Math.pow(2,fe),xe,Pe)&&delete G[pe]}}getTile(V,G,J){const pe=Math.pow(2,V),fe=[];for(const xe of this.features.values())_i(xe,pe,G,J)&&fe.push(qt(xe,pe,G,J));return{features:fe}}getFeatures(){return[...this.features.values()]}}function _i({minX:Te,minY:V,maxX:G,maxY:J},pe,fe,xe){return Te<(fe+1+zr)/pe&&V<(xe+1+zr)/pe&&G>(fe-zr)/pe&&J>(xe-zr)/pe}function On(Te){const{id:V,geometry:G,properties:J}=Te;if(!G)return;if(G.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:pe,coordinates:fe}=G,xe={id:V,type:1,geometry:[],tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Pe=xe.geometry;if(pe==="Point")Fn(fe,Pe,xe);else if(pe==="MultiPoint")for(const be of fe)Fn(be,Pe,xe);else if(pe==="LineString")xe.type=2,Ue(fe,Pe,xe);else if(pe==="MultiLineString")xe.type=2,Pt(fe,Pe,xe);else if(pe==="Polygon")xe.type=3,Pt(fe,Pe,xe,!0);else{if(pe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");xe.type=3;for(const be of fe)Pt(be,Pe,xe,!0)}return xe}function Fn([Te,V],G,J){const pe=o.aF(Te);let fe=o.aJ(V);fe=fe<0?0:fe>1?1:fe,G.push(pe,fe),J.minX=Math.min(J.minX,pe),J.minY=Math.min(J.minY,fe),J.maxX=Math.max(J.maxX,pe),J.maxY=Math.max(J.maxY,fe)}function Ue(Te,V,G,J=!1,pe=!1){const fe=[];for(const xe of Te)Fn(xe,fe,G);V.push(fe),J&&(function(xe,Pe){let be=0;for(let Ce=0,ct=xe.length,et=ct-2;Ce<ct;et=Ce,Ce+=2)be+=(xe[Ce]-xe[et])*(xe[Ce+1]+xe[et+1]);if(be>0===Pe)for(let Ce=0,ct=xe.length;Ce<ct/2;Ce+=2){const et=xe[Ce],kt=xe[Ce+1];xe[Ce]=xe[ct-2-Ce],xe[Ce+1]=xe[ct-1-Ce],xe[ct-2-Ce]=et,xe[ct-1-Ce]=kt}})(fe,pe)}function Pt(Te,V,G,J=!1){for(let pe=0;pe<Te.length;pe++)Ue(Te[pe],V,G,J,pe===0)}function qt(Te,V,G,J){const{id:pe,type:fe,geometry:xe,tags:Pe}=Te,be=[];if(fe===1)(function(Ce,ct,et,kt,ei){for(let Jt=0;Jt<Ce.length;Jt+=2){const Gt=Math.round(o.al*(Ce[Jt+0]*ct-et)),Ei=Math.round(o.al*(Ce[Jt+1]*ct-kt));ei.push([Gt,Ei])}})(xe,V,G,J,be);else for(const Ce of xe)gi(Ce,V,G,J,be);return{id:pe,type:fe,geometry:be,tags:Pe}}function gi(Te,V,G,J,pe){const fe=-yt,xe=o.al+yt;let Pe;for(let be=0;be<Te.length-2;be+=2){let Ce=Math.round(o.al*(Te[be+0]*V-G)),ct=Math.round(o.al*(Te[be+1]*V-J)),et=Math.round(o.al*(Te[be+2]*V-G)),kt=Math.round(o.al*(Te[be+3]*V-J));const ei=et-Ce,Jt=kt-ct;Ce<fe&&et<fe||(Ce<fe?(ct+=Math.round(Jt*((fe-Ce)/ei)),Ce=fe):et<fe&&(kt=ct+Math.round(Jt*((fe-Ce)/ei)),et=fe),ct<fe&&kt<fe||(ct<fe?(Ce+=Math.round(ei*((fe-ct)/Jt)),ct=fe):kt<fe&&(et=Ce+Math.round(ei*((fe-ct)/Jt)),kt=fe),Ce>=xe&&et>=xe||(Ce>=xe?(ct+=Math.round(Jt*((xe-Ce)/ei)),Ce=xe):et>=xe&&(kt=ct+Math.round(Jt*((xe-Ce)/ei)),et=xe),ct>=xe&&kt>=xe||(ct>=xe?(Ce+=Math.round(ei*((xe-ct)/Jt)),ct=xe):kt>=xe&&(et=Ce+Math.round(ei*((xe-ct)/Jt)),kt=xe),Pe&&Ce===Pe[Pe.length-1][0]&&ct===Pe[Pe.length-1][1]||(Pe=[[Ce,ct]],pe.push(Pe)),Pe.push([et,kt])))))}}function fn({name:Te,features:V},G){G.writeStringField(1,Te),G.writeVarintField(5,o.al);const J=new Map,pe=new Map,fe={keys:J,values:pe,feature:null};for(const xe of V)fe.feature=xe,G.writeMessage(2,En,fe);for(const xe of J.keys())G.writeStringField(3,xe);for(const xe of pe.keys())G.writeMessage(4,Br,xe)}function En(Te,V){const G=Te.feature;G.id!==void 0&&Number.isSafeInteger(+G.id)&&V.writeVarintField(1,+G.id),G.tags&&V.writeMessage(2,Kn,Te),V.writeVarintField(3,G.type),V.writeMessage(4,br,G)}function Kn({keys:Te,values:V,feature:G},J){for(const pe of Object.keys(G.tags)){let fe=G.tags[pe];if(fe===null)continue;let xe=Te.get(pe);xe===void 0&&(xe=Te.size,Te.set(pe,xe)),J.writeVarint(xe);const Pe=typeof fe;Pe!=="string"&&Pe!=="boolean"&&Pe!=="number"&&(fe=JSON.stringify(fe));let be=V.get(fe);be===void 0&&(be=V.size,V.set(fe,be)),J.writeVarint(be)}}function Lr(Te,V){return(V<<3)+(7&Te)}function Li(Te){return Te<<1^Te>>31}function br(Te,V){const{geometry:G,type:J}=Te;let pe=0,fe=0;if(J===1){V.writeVarint(Lr(1,G.length));for(const xe of G){const Pe=xe[0]-pe,be=xe[1]-fe;V.writeVarint(Li(Pe)),V.writeVarint(Li(be)),pe+=Pe,fe+=be}}else for(const xe of G){V.writeVarint(Lr(1,1));const Pe=xe.length-(J===3?1:0);for(let be=0;be<Pe;be++){be===1&&V.writeVarint(Lr(2,Pe-1));const Ce=xe[be][0]-pe,ct=xe[be][1]-fe;V.writeVarint(Li(Ce)),V.writeVarint(Li(ct)),pe+=Ce,fe+=ct}J===3&&V.writeVarint(Lr(7,1))}}function Br(Te,V){const G=typeof Te;G==="string"?V.writeStringField(1,Te):G==="boolean"?V.writeBooleanField(7,Te):G==="number"&&(Te%1!=0?V.writeDoubleField(3,Te):Te<0?V.writeSVarintField(6,Te):V.writeVarintField(5,Te))}const Ol={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Te=>Te},sr=Math.fround||(ro=new Float32Array(1),Te=>(ro[0]=+Te,ro[0]));var ro;const $a=3,wo=5,Es=6;class Sr{constructor(V){this.options=Object.assign(Object.create(Ol),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:G,minZoom:J,maxZoom:pe}=this.options;G&&console.time("total time");const fe=`prepare ${V.length} points`;G&&console.time(fe),this.points=V;const xe=[];for(let be=0;be<V.length;be++){const Ce=V[be];if(!Ce.geometry)continue;const[ct,et]=Ce.geometry.coordinates,kt=sr(Fa(ct)),ei=sr(Fl(et));xe.push(kt,ei,1/0,be,-1,1),this.options.reduce&&xe.push(0)}let Pe=this.trees[pe+1]=this._createTree(xe);G&&console.timeEnd(fe);for(let be=pe;be>=J;be--){const Ce=+Date.now();Pe=this.trees[be]=this._createTree(this._cluster(Pe,be)),G&&console.log("z%d: %d clusters in %dms",be,Pe.numItems,+Date.now()-Ce)}return G&&console.timeEnd("total time"),this}getClusters(V,G){let J=((V[0]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,V[1]));let fe=V[2]===180?180:((V[2]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)J=-180,fe=180;else if(J>fe){const et=this.getClusters([J,pe,180,xe],G),kt=this.getClusters([-180,pe,fe,xe],G);return et.concat(kt)}const Pe=this.trees[this._limitZoom(G)],be=Pe.range(Fa(J),Fl(xe),Fa(fe),Fl(pe)),Ce=Pe.data,ct=[];for(const et of be){const kt=this.stride*et;ct.push(Ce[kt+wo]>1?gc(Ce,kt,this.clusterProps):this.points[Ce[kt+$a]])}return ct}getChildren(V){const G=this._getOriginId(V),J=this._getOriginZoom(V),pe="No cluster with the specified id.",fe=this.trees[J];if(!fe)throw new Error(pe);const xe=fe.data;if(G*this.stride>=xe.length)throw new Error(pe);const Pe=this.options.radius/(this.options.extent*Math.pow(2,J-1)),be=fe.within(xe[G*this.stride],xe[G*this.stride+1],Pe),Ce=[];for(const ct of be){const et=ct*this.stride;xe[et+4]===V&&Ce.push(xe[et+wo]>1?gc(xe,et,this.clusterProps):this.points[xe[et+$a]])}if(Ce.length===0)throw new Error(pe);return Ce}getLeaves(V,G,J){const pe=[];return this._appendLeaves(pe,V,G=G||10,J=J||0,0),pe}getTile(V,G,J){const pe=this.trees[this._limitZoom(V)],fe=Math.pow(2,V),{extent:xe,radius:Pe}=this.options,be=Pe/xe,Ce=(J-be)/fe,ct=(J+1+be)/fe,et={features:[]};return this._addTileFeatures(pe.range((G-be)/fe,Ce,(G+1+be)/fe,ct),pe.data,G,J,fe,et),G===0&&this._addTileFeatures(pe.range(1-be/fe,Ce,1,ct),pe.data,fe,J,fe,et),G===fe-1&&this._addTileFeatures(pe.range(0,Ce,be/fe,ct),pe.data,-1,J,fe,et),et.features.length?et:null}getClusterExpansionZoom(V){let G=this._getOriginZoom(V)-1;for(;G<=this.options.maxZoom;){const J=this.getChildren(V);if(G++,J.length!==1)break;V=J[0].properties.cluster_id}return G}_appendLeaves(V,G,J,pe,fe){const xe=this.getChildren(G);for(const Pe of xe){const be=Pe.properties;if(be&&be.cluster?fe+be.point_count<=pe?fe+=be.point_count:fe=this._appendLeaves(V,be.cluster_id,J,pe,fe):fe<pe?fe++:V.push(Pe),V.length===J)break}return fe}_createTree(V){const G=new o.c3(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let J=0;J<V.length;J+=this.stride)G.add(V[J],V[J+1]);return G.finish(),G.data=V,G}_addTileFeatures(V,G,J,pe,fe,xe){for(const Pe of V){const be=Pe*this.stride,Ce=G[be+wo]>1;let ct,et,kt;if(Ce)ct=ol(G,be,this.clusterProps),et=G[be],kt=G[be+1];else{const Gt=this.points[G[be+$a]];ct=Gt.properties;const[Ei,Mi]=Gt.geometry.coordinates;et=Fa(Ei),kt=Fl(Mi)}const ei={type:1,geometry:[[Math.round(this.options.extent*(et*fe-J)),Math.round(this.options.extent*(kt*fe-pe))]],tags:ct};let Jt;Jt=Ce||this.options.generateId?G[be+$a]:this.points[G[be+$a]].id,Jt!==void 0&&(ei.id=Jt),xe.features.push(ei)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,G){const{radius:J,extent:pe,reduce:fe,minPoints:xe}=this.options,Pe=J/(pe*Math.pow(2,G)),be=V.data,Ce=[],ct=this.stride;for(let et=0;et<be.length;et+=ct){if(be[et+2]<=G)continue;be[et+2]=G;const kt=be[et],ei=be[et+1],Jt=V.within(be[et],be[et+1],Pe),Gt=be[et+wo];let Ei=Gt;for(const Mi of Jt){const rn=Mi*ct;be[rn+2]>G&&(Ei+=be[rn+wo])}if(Ei>Gt&&Ei>=xe){let Mi,rn=kt*Gt,jn=ei*Gt,Pr=-1;const wr=(et/ct<<5)+(G+1)+this.points.length;for(const _r of Jt){const xn=_r*ct;if(be[xn+2]<=G)continue;be[xn+2]=G;const Oi=be[xn+wo];rn+=be[xn]*Oi,jn+=be[xn+1]*Oi,be[xn+4]=wr,fe&&(Mi||(Mi=this._map(be,et,!0),Pr=this.clusterProps.length,this.clusterProps.push(Mi)),fe(Mi,this._map(be,xn)))}be[et+4]=wr,Ce.push(rn/Ei,jn/Ei,1/0,wr,-1,Ei),fe&&Ce.push(Pr)}else{for(let Mi=0;Mi<ct;Mi++)Ce.push(be[et+Mi]);if(Ei>1)for(const Mi of Jt){const rn=Mi*ct;if(!(be[rn+2]<=G)){be[rn+2]=G;for(let jn=0;jn<ct;jn++)Ce.push(be[rn+jn])}}}}return Ce}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,G,J){if(V[G+wo]>1){const xe=this.clusterProps[V[G+Es]];return J?Object.assign({},xe):xe}const pe=this.points[V[G+$a]].properties,fe=this.options.map(pe);return J&&fe===pe?Object.assign({},fe):fe}}function gc(Te,V,G){return{type:"Feature",id:Te[V+$a],properties:ol(Te,V,G),geometry:{type:"Point",coordinates:[(J=Te[V],360*(J-.5)),_h(Te[V+1])]}};var J}function ol(Te,V,G){const J=Te[V+wo],pe=J>=1e4?`${Math.round(J/1e3)}k`:J>=1e3?Math.round(J/100)/10+"k":J,fe=Te[V+Es],xe=fe===-1?{}:Object.assign({},G[fe]);return Object.assign(xe,{cluster:!0,cluster_id:Te[V+$a],point_count:J,point_count_abbreviated:pe})}function Fa(Te){return Te/360+.5}function Fl(Te){const V=Math.sin(Te*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function _h(Te){const V=(180-360*Te)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function Er(Te,V,G,J){let pe=J;const fe=V+(G-V>>1);let xe,Pe=G-V;const be=Te[V],Ce=Te[V+1],ct=Te[G],et=Te[G+1];for(let kt=V+3;kt<G;kt+=3){const ei=Bl(Te[kt],Te[kt+1],be,Ce,ct,et);if(ei>pe)xe=kt,pe=ei;else if(ei===pe){const Jt=Math.abs(kt-fe);Jt<Pe&&(xe=kt,Pe=Jt)}}pe>J&&(xe-V>3&&Er(Te,V,xe,J),Te[xe+2]=pe,G-xe>3&&Er(Te,xe,G,J))}function Bl(Te,V,G,J,pe,fe){let xe=pe-G,Pe=fe-J;if(xe!==0||Pe!==0){const be=((Te-G)*xe+(V-J)*Pe)/(xe*xe+Pe*Pe);be>1?(G=pe,J=fe):be>0&&(G+=xe*be,J+=Pe*be)}return xe=Te-G,Pe=V-J,xe*xe+Pe*Pe}function as(Te,V,G,J){const pe={id:Te??null,type:V,geometry:G,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(V==="Point"||V==="MultiPoint"||V==="LineString")As(pe,G);else if(V==="Polygon")As(pe,G[0]);else if(V==="MultiLineString")for(const fe of G)As(pe,fe);else if(V==="MultiPolygon")for(const fe of G)As(pe,fe[0]);return pe}function As(Te,V){for(let G=0;G<V.length;G+=3)Te.minX=Math.min(Te.minX,V[G]),Te.minY=Math.min(Te.minY,V[G+1]),Te.maxX=Math.max(Te.maxX,V[G]),Te.maxY=Math.max(Te.maxY,V[G+1])}function Ms(Te,V,G,J){if(!V.geometry)return;const pe=V.geometry.coordinates;if(pe&&pe.length===0)return;const fe=V.geometry.type,xe=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2);let Pe=[],be=V.id;if(G.promoteId?be=V.properties[G.promoteId]:G.generateId&&(be=J||0),fe==="Point")Wa(pe,Pe);else if(fe==="MultiPoint")for(const Ce of pe)Wa(Ce,Pe);else if(fe==="LineString")kl(pe,Pe,xe,!1);else if(fe==="MultiLineString"){if(G.lineMetrics){for(const Ce of pe)Pe=[],kl(Ce,Pe,xe,!1),Te.push(as(be,"LineString",Pe,V.properties));return}Is(pe,Pe,xe,!1)}else if(fe==="Polygon")Is(pe,Pe,xe,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(const Ce of V.geometry.geometries)Ms(Te,{id:be,geometry:Ce,properties:V.properties},G,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ce of pe){const ct=[];Is(Ce,ct,xe,!0),Pe.push(ct)}}Te.push(as(be,fe,Pe,V.properties))}function Wa(Te,V){V.push(gu(Te[0]),Cs(Te[1]),0)}function kl(Te,V,G,J){let pe,fe,xe=0;for(let be=0;be<Te.length;be++){const Ce=gu(Te[be][0]),ct=Cs(Te[be][1]);V.push(Ce,ct,0),be>0&&(xe+=J?(pe*ct-Ce*fe)/2:Math.sqrt(Math.pow(Ce-pe,2)+Math.pow(ct-fe,2))),pe=Ce,fe=ct}const Pe=V.length-3;V[2]=1,Er(V,0,Pe,G),V[Pe+2]=1,V.size=Math.abs(xe),V.start=0,V.end=V.size}function Is(Te,V,G,J){for(let pe=0;pe<Te.length;pe++){const fe=[];kl(Te[pe],fe,G,J),V.push(fe)}}function gu(Te){return Te/360+.5}function Cs(Te){const V=Math.sin(Te*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function Vn(Te,V,G,J,pe,fe,xe,Pe){if(J/=V,fe>=(G/=V)&&xe<J)return Te;if(xe<G||fe>=J)return null;const be=[];for(const Ce of Te){const ct=Ce.geometry;let et=Ce.type;const kt=pe===0?Ce.minX:Ce.minY,ei=pe===0?Ce.maxX:Ce.maxY;if(kt>=G&&ei<J){be.push(Ce);continue}if(ei<G||kt>=J)continue;let Jt=[];if(et==="Point"||et==="MultiPoint")ao(ct,Jt,G,J,pe);else if(et==="LineString")ba(ct,Jt,G,J,pe,!1,Pe.lineMetrics);else if(et==="MultiLineString")os(ct,Jt,G,J,pe,!1);else if(et==="Polygon")os(ct,Jt,G,J,pe,!0);else if(et==="MultiPolygon")for(const Gt of ct){const Ei=[];os(Gt,Ei,G,J,pe,!0),Ei.length&&Jt.push(Ei)}if(Jt.length){if(Pe.lineMetrics&&et==="LineString"){for(const Gt of Jt)be.push(as(Ce.id,et,Gt,Ce.tags));continue}et!=="LineString"&&et!=="MultiLineString"||(Jt.length===1?(et="LineString",Jt=Jt[0]):et="MultiLineString"),et!=="Point"&&et!=="MultiPoint"||(et=Jt.length===3?"Point":"MultiPoint"),be.push(as(Ce.id,et,Jt,Ce.tags))}}return be.length?be:null}function ao(Te,V,G,J,pe){for(let fe=0;fe<Te.length;fe+=3){const xe=Te[fe+pe];xe>=G&&xe<=J&&ko(V,Te[fe],Te[fe+1],Te[fe+2])}}function ba(Te,V,G,J,pe,fe,xe){let Pe=sl(Te);const be=pe===0?Zn:ta;let Ce,ct,et=Te.start;for(let Ei=0;Ei<Te.length-3;Ei+=3){const Mi=Te[Ei],rn=Te[Ei+1],jn=Te[Ei+2],Pr=Te[Ei+3],wr=Te[Ei+4],_r=pe===0?Mi:rn,xn=pe===0?Pr:wr;let Oi=!1;xe&&(Ce=Math.sqrt(Math.pow(Mi-Pr,2)+Math.pow(rn-wr,2))),_r<G?xn>G&&(ct=be(Pe,Mi,rn,Pr,wr,G),xe&&(Pe.start=et+Ce*ct)):_r>J?xn<J&&(ct=be(Pe,Mi,rn,Pr,wr,J),xe&&(Pe.start=et+Ce*ct)):ko(Pe,Mi,rn,jn),xn<G&&_r>=G&&(ct=be(Pe,Mi,rn,Pr,wr,G),Oi=!0),xn>J&&_r<=J&&(ct=be(Pe,Mi,rn,Pr,wr,J),Oi=!0),!fe&&Oi&&(xe&&(Pe.end=et+Ce*ct),V.push(Pe),Pe=sl(Te)),xe&&(et+=Ce)}let kt=Te.length-3;const ei=Te[kt],Jt=Te[kt+1],Gt=pe===0?ei:Jt;Gt>=G&&Gt<=J&&ko(Pe,ei,Jt,Te[kt+2]),kt=Pe.length-3,fe&&kt>=3&&(Pe[kt]!==Pe[0]||Pe[kt+1]!==Pe[1])&&ko(Pe,Pe[0],Pe[1],Pe[2]),Pe.length&&V.push(Pe)}function sl(Te){const V=[];return V.size=Te.size,V.start=Te.start,V.end=Te.end,V}function os(Te,V,G,J,pe,fe){for(const xe of Te)ba(xe,V,G,J,pe,fe,!1)}function ko(Te,V,G,J){Te.push(V,G,J)}function Zn(Te,V,G,J,pe,fe){const xe=(fe-V)/(J-V);return ko(Te,fe,G+(pe-G)*xe,1),xe}function ta(Te,V,G,J,pe,fe){const xe=(fe-G)/(pe-G);return ko(Te,V+(J-V)*xe,fe,1),xe}function zs(Te,V){const G=[];for(let J=0;J<Te.length;J++){const pe=Te[J],fe=pe.type;let xe;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")xe=oo(pe.geometry,V);else if(fe==="MultiLineString"||fe==="Polygon"){xe=[];for(const Pe of pe.geometry)xe.push(oo(Pe,V))}else if(fe==="MultiPolygon"){xe=[];for(const Pe of pe.geometry){const be=[];for(const Ce of Pe)be.push(oo(Ce,V));xe.push(be)}}G.push(as(pe.id,fe,xe,pe.tags))}return G}function oo(Te,V){const G=[];G.size=Te.size,Te.start!==void 0&&(G.start=Te.start,G.end=Te.end);for(let J=0;J<Te.length;J+=3)G.push(Te[J]+V,Te[J+1],Te[J+2]);return G}function Ba(Te,V){if(Te.transformed)return Te;const G=1<<Te.z,J=Te.x,pe=Te.y;for(const fe of Te.features){const xe=fe.geometry,Pe=fe.type;if(fe.geometry=[],Pe===1)for(let be=0;be<xe.length;be+=2)fe.geometry.push(Nl(xe[be],xe[be+1],V,G,J,pe));else for(let be=0;be<xe.length;be++){const Ce=[];for(let ct=0;ct<xe[be].length;ct+=2)Ce.push(Nl(xe[be][ct],xe[be][ct+1],V,G,J,pe));fe.geometry.push(Ce)}}return Te.transformed=!0,Te}function Nl(Te,V,G,J,pe,fe){return[Math.round(G*(Te*J-pe)),Math.round(G*(V*J-fe))]}function gh(Te,V,G,J,pe){const fe=V===pe.maxZoom?0:pe.tolerance/((1<<V)*pe.extent),xe={features:[],numPoints:0,numSimplified:0,numFeatures:Te.length,source:null,x:G,y:J,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Pe of Te)bd(xe,Pe,fe,pe);return xe}function bd(Te,V,G,J){const pe=V.geometry,fe=V.type,xe=[];if(Te.minX=Math.min(Te.minX,V.minX),Te.minY=Math.min(Te.minY,V.minY),Te.maxX=Math.max(Te.maxX,V.maxX),Te.maxY=Math.max(Te.maxY,V.maxY),fe==="Point"||fe==="MultiPoint")for(let Pe=0;Pe<pe.length;Pe+=3)xe.push(pe[Pe],pe[Pe+1]),Te.numPoints++,Te.numSimplified++;else if(fe==="LineString")Ul(xe,pe,Te,G,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(let Pe=0;Pe<pe.length;Pe++)Ul(xe,pe[Pe],Te,G,fe==="Polygon",Pe===0);else if(fe==="MultiPolygon")for(let Pe=0;Pe<pe.length;Pe++){const be=pe[Pe];for(let Ce=0;Ce<be.length;Ce++)Ul(xe,be[Ce],Te,G,!0,Ce===0)}if(xe.length){let Pe=V.tags||null;if(fe==="LineString"&&J.lineMetrics){Pe={};for(const Ce in V.tags)Pe[Ce]=V.tags[Ce];Pe.mapbox_clip_start=pe.start/pe.size,Pe.mapbox_clip_end=pe.end/pe.size}const be={geometry:xe,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:Pe};V.id!==null&&(be.id=V.id),Te.features.push(be)}}function Ul(Te,V,G,J,pe,fe){const xe=J*J;if(J>0&&V.size<(pe?xe:J))return void(G.numPoints+=V.length/3);const Pe=[];for(let be=0;be<V.length;be+=3)(J===0||V[be+2]>xe)&&(G.numSimplified++,Pe.push(V[be],V[be+1])),G.numPoints++;pe&&(function(be,Ce){let ct=0;for(let et=0,kt=be.length,ei=kt-2;et<kt;ei=et,et+=2)ct+=(be[et]-be[ei])*(be[et+1]+be[ei+1]);if(ct>0===Ce)for(let et=0,kt=be.length;et<kt/2;et+=2){const ei=be[et],Jt=be[et+1];be[et]=be[kt-2-et],be[et+1]=be[kt-1-et],be[kt-2-et]=ei,be[kt-1-et]=Jt}})(Pe,fe),Te.push(Pe)}const nt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ll{constructor(V,G){const J=(G=this.options=(function(fe,xe){for(const Pe in xe)fe[Pe]=xe[Pe];return fe})(Object.create(nt),G)).debug;if(J&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");let pe=(function(fe,xe){const Pe=[];if(fe.type==="FeatureCollection")for(let be=0;be<fe.features.length;be++)Ms(Pe,fe.features[be],xe,be);else Ms(Pe,fe.type==="Feature"?fe:{geometry:fe},xe);return Pe})(V,G);this.tiles={},this.tileCoords=[],J&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),pe=(function(fe,xe){const Pe=xe.buffer/xe.extent;let be=fe;const Ce=Vn(fe,1,-1-Pe,Pe,0,-1,2,xe),ct=Vn(fe,1,1-Pe,2+Pe,0,-1,2,xe);return(Ce||ct)&&(be=Vn(fe,1,-Pe,1+Pe,0,-1,2,xe)||[],Ce&&(be=zs(Ce,1).concat(be)),ct&&(be=be.concat(zs(ct,-1)))),be})(pe,G),pe.length&&this.splitTile(pe,0,0,0),J&&(pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(V,G,J,pe,fe,xe,Pe){const be=[V,G,J,pe],Ce=this.options,ct=Ce.debug;for(;be.length;){pe=be.pop(),J=be.pop(),G=be.pop(),V=be.pop();const et=1<<G,kt=yu(G,J,pe);let ei=this.tiles[kt];if(!ei&&(ct>1&&console.time("creation"),ei=this.tiles[kt]=gh(V,G,J,pe,Ce),this.tileCoords.push({z:G,x:J,y:pe}),ct)){ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,J,pe,ei.numFeatures,ei.numPoints,ei.numSimplified),console.timeEnd("creation"));const Oi=`z${G}`;this.stats[Oi]=(this.stats[Oi]||0)+1,this.total++}if(ei.source=V,fe==null){if(G===Ce.indexMaxZoom||ei.numPoints<=Ce.indexMaxPoints)continue}else{if(G===Ce.maxZoom||G===fe)continue;if(fe!=null){const Oi=fe-G;if(J!==xe>>Oi||pe!==Pe>>Oi)continue}}if(ei.source=null,V.length===0)continue;ct>1&&console.time("clipping");const Jt=.5*Ce.buffer/Ce.extent,Gt=.5-Jt,Ei=.5+Jt,Mi=1+Jt;let rn=null,jn=null,Pr=null,wr=null,_r=Vn(V,et,J-Jt,J+Ei,0,ei.minX,ei.maxX,Ce),xn=Vn(V,et,J+Gt,J+Mi,0,ei.minX,ei.maxX,Ce);V=null,_r&&(rn=Vn(_r,et,pe-Jt,pe+Ei,1,ei.minY,ei.maxY,Ce),jn=Vn(_r,et,pe+Gt,pe+Mi,1,ei.minY,ei.maxY,Ce),_r=null),xn&&(Pr=Vn(xn,et,pe-Jt,pe+Ei,1,ei.minY,ei.maxY,Ce),wr=Vn(xn,et,pe+Gt,pe+Mi,1,ei.minY,ei.maxY,Ce),xn=null),ct>1&&console.timeEnd("clipping"),be.push(rn||[],G+1,2*J,2*pe),be.push(jn||[],G+1,2*J,2*pe+1),be.push(Pr||[],G+1,2*J+1,2*pe),be.push(wr||[],G+1,2*J+1,2*pe+1)}}getTile(V,G,J){V=+V,G=+G,J=+J;const pe=this.options,{extent:fe,debug:xe}=pe;if(V<0||V>24)return null;const Pe=1<<V,be=yu(V,G=G+Pe&Pe-1,J);if(this.tiles[be])return Ba(this.tiles[be],fe);xe>1&&console.log("drilling down to z%d-%d-%d",V,G,J);let Ce,ct=V,et=G,kt=J;for(;!Ce&&ct>0;)ct--,et>>=1,kt>>=1,Ce=this.tiles[yu(ct,et,kt)];return Ce&&Ce.source?(xe>1&&(console.log("found parent tile z%d-%d-%d",ct,et,kt),console.time("drilling down")),this.splitTile(Ce.source,ct,et,kt,V,G,J),xe>1&&console.timeEnd("drilling down"),this.tiles[be]?Ba(this.tiles[be],fe):null):null}}function yu(Te,V,G){return 32*((1<<Te)*G+V)+Te}function vu(Te,V){const G=Te.tileID.canonical;if(!this._geoJSONIndex)return void V(null,null);const J=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!J)return void V(null,null);const pe=Ce=>Ce.tags&&"3d_elevation_id"in Ce.tags&&"source"in Ce.tags&&Ce.tags.source==="elevation",fe=J.features.filter((Ce=>pe(Ce)));let xe={_geojsonTileLayer:J.features};fe.length>0&&(xe={_geojsonTileLayer:J.features.filter((Ce=>!pe(Ce))),hd_road_elevation:fe});const Pe=new Bo(xe),be=(function(Ce){const ct=new o.bs;for(const et of Object.keys(Ce))ct.writeMessage(3,fn,{name:et,features:Ce[et]});return ct.finish()})(xe).buffer;V(null,{vectorTile:Pe,rawData:be})}class Ui extends ln{constructor(V,G,J,pe,fe,xe,Pe){super(V,G,J,pe,fe,vu,Pe),xe&&(this.loadGeoJSON=xe),this._dynamicIndex=new jt}loadData(V,G){const J=V&&V.request,pe=J&&J.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(V,((fe,xe)=>{if(fe||!xe)return G(fe);if(typeof xe!="object")return G(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{try{if(V.filter){const be=o.U(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(be.result==="error")throw new Error(be.value.map((Ce=>`${Ce.key}: ${Ce.message}`)).join(", "));xe.features=xe.features.filter((Ce=>be.value.evaluate({zoom:0},Ce)))}V.dynamic?(xe.type==="Feature"&&(xe={type:"FeatureCollection",features:[xe]}),V.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(xe.features,this.loaded),V.cluster&&(xe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=V.cluster?new Sr((function({superclusterOptions:be,clusterProperties:Ce}){if(!Ce||!be)return be;const ct={},et={},kt={accumulated:null,zoom:0},ei={properties:null},Jt=Object.keys(Ce);for(const Gt of Jt){const[Ei,Mi]=Ce[Gt],rn=o.U(Mi),jn=o.U(typeof Ei=="string"?[Ei,["accumulated"],["get",Gt]]:Ei);ct[Gt]=rn.value,et[Gt]=jn.value}return be.map=Gt=>{ei.properties=Gt;const Ei={};for(const Mi of Jt)Ei[Mi]=ct[Mi].evaluate(kt,ei);return Ei},be.reduce=(Gt,Ei)=>{ei.properties=Ei;for(const Mi of Jt)kt.accumulated=Gt[Mi],Gt[Mi]=et[Mi].evaluate(kt,ei)},be})(V)).load(xe.features):V.dynamic?this._dynamicIndex:(function(be,Ce){return new ll(be,Ce)})(xe,V.geojsonVtOptions)}catch(be){return G(be)}const Pe={};if(pe){const be=Tt(J);be&&(Pe.resourceTiming={},Pe.resourceTiming[V.source]=JSON.parse(JSON.stringify(be)))}G(null,Pe)}}))}reloadTile(V,G){const J=this.loaded;return J&&J[V.uid]?V.partial?G(null,void 0):super.reloadTile(V,G):this.loadTile(V,G)}loadGeoJSON(V,G){if(V.request)o.m(V.request,G);else{if(typeof V.data!="string")return G(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return G(null,JSON.parse(V.data))}catch{return G(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(V,G){try{G(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(J){G(J)}}getClusterChildren(V,G){try{G(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(J){G(J)}}getClusterLeaves(V,G){try{G(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(J){G(J)}}}class pa{constructor(V,G,J){this.tileID=new o.aP(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.tileZoom=V.tileZoom,this.uid=V.uid,this.zoom=V.zoom,this.canonical=V.tileID.canonical,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=V.projection,this.brightness=G,this.worldview=J}parse(V,G,J,pe){this.status="parsing";const fe=new o.aP(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),xe=[],Pe=G.familiesBySource[J.source],be=new o.fm(fe,J.promoteId);be.bucketLayerIDs=[],be.is3DTile=!0,o.fB(V).then((Ce=>{if(!Ce)return pe(new Error("Could not parse tile"));const ct=Ce.json.extensionsUsed&&Ce.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ce.json.asset.extras&&Ce.json.asset.extras.MAPBOX_mesh_features,et=Ce.json.extensionsUsed&&Ce.json.extensionsUsed.includes("EXT_meshopt_compression"),kt=new o.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const ei in Pe)for(const Jt of Pe[ei]){const Gt=Jt[0];be.bucketLayerIDs.push(Jt.map((rn=>o.B(rn.id,rn.scope)))),Gt.recalculate(kt,[]);const Ei=o.fC(Ce,1/o.d6(J.tileID.canonical)),Mi=new o.fD(Jt,Ei,fe,ct,et,this.brightness,be,this.worldview);ct||(Mi.needsUpload=!0),xe.push(Mi),Mi.evaluate(Gt)}this.status="done",pe(null,{buckets:xe,featureIndex:be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((Ce=>pe(new Error(Ce.message))))}}class yh{constructor(V,G,J,pe,fe,xe,Pe,be){this.actor=V,this.layerIndex=G,this.availableImages=J,this.availableModels=pe,this.brightness=Pe,this.loading={},this.loaded={},this.worldview=be}loadTile(V,G){const J=V.uid,pe=this.loading[J]=new pa(V,this.brightness,this.worldview);o.bt(V.request,((fe,xe)=>{const Pe=!this.loading[J];return delete this.loading[J],Pe||fe?(pe.status="done",Pe||(this.loaded[J]=pe),G(fe)):xe&&xe.byteLength!==0?void pe.parse(xe,this.layerIndex,V,((be,Ce)=>{pe.status="done",this.loaded=this.loaded||{},this.loaded[J]=pe,be||!Ce?G(be):G(null,Ce)})):(pe.status="done",this.loaded[J]=pe,G())}))}reloadTile(V,G){const J=this.loaded,pe=V.uid;if(J&&J[pe]){const fe=J[pe];fe.projection=V.projection,fe.brightness=V.brightness;const xe=(Pe,be)=>{fe.reloadCallback&&(delete fe.reloadCallback,this.loadTile(V,G)),G(Pe,be)};fe.status==="parsing"?fe.reloadCallback=xe:fe.status==="done"&&this.loadTile(V,G)}}abortTile(V,G){const J=V.uid;this.loading[J]&&delete this.loading[J],G()}removeTile(V,G){const J=this.loaded,pe=V.uid;J&&J[pe]&&delete J[pe],G()}}class xu{constructor(V){this.self=V,this.actor=new o.fF(V,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.cl({name:"mercator"}),this.workerSourceTypes={vector:ln,geojson:Ui,"raster-dem":ea,"raster-array":Ss,"batched-model":yh},this.workerSources={},this.self.registerWorkerSource=(G,J)=>{if(this.workerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.workerSourceTypes[G]=J},this.self.registerRTLTextPlugin=G=>{if(o.fG.isParsed())throw new Error("RTL text plugin already registered.");o.fG.setState({pluginStatus:o.fH.parsed,pluginURL:o.fG.getPluginURL()}),o.fG.applyArabicShaping=G.applyArabicShaping,o.fG.processBidirectionalText=G.processBidirectionalText,o.fG.processStyledBidirectionalText=G.processStyledBidirectionalText;for(const J of this.rtlPluginParsingListeners)J(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(V,G,J){delete this.layerIndexes[V],delete this.availableImages[V],delete this.availableModels[V],delete this.workerSources[V],J()}checkIfReady(V,G,J){J()}setReferrer(V,G){this.referrer=G}spriteLoaded(V,G){this.isSpriteLoaded[V]||(this.isSpriteLoaded[V]={});const{scope:J,isLoaded:pe}=G;if(this.isSpriteLoaded[V][J]=pe,this.workerSources[V]&&this.workerSources[V][J])for(const fe in this.workerSources[V][J]){const xe=this.workerSources[V][J][fe];for(const Pe in xe){const be=xe[Pe];be instanceof ln&&(be.isSpriteLoaded=pe,be.fire(new o.z("isSpriteLoaded")))}}}setImages(V,G,J){this.availableImages[V]||(this.availableImages[V]={});const{scope:pe,images:fe}=G;if(this.availableImages[V][pe]=fe,this.workerSources[V]&&this.workerSources[V][pe]){for(const xe in this.workerSources[V][pe]){const Pe=this.workerSources[V][pe][xe];for(const be in Pe)Pe[be].availableImages=fe}J()}else J()}setModels(V,{scope:G,models:J},pe){if(this.availableModels[V]||(this.availableModels[V]={}),this.availableModels[V][G]=J,this.workerSources[V]&&this.workerSources[V][G]){for(const fe in this.workerSources[V][G]){const xe=this.workerSources[V][G][fe];for(const Pe in xe)xe[Pe].availableModels=J}pe()}else pe()}setProjection(V,G){this.projections[V]=o.cl(G)}setBrightness(V,G,J){this.brightness=G,J()}setWorldview(V,G,J){this.worldview=G,J()}setLayers(V,G,J){this.getLayerIndex(V,G.scope).replace(G.layers,G.options),J()}updateLayers(V,G,J){this.getLayerIndex(V,G.scope).update(G.layers,G.removedIds,G.options),J()}loadTile(V,G,J){G.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,G.type,G.source,G.scope).loadTile(G,J)}decodeRasterArray(V,G,J){this.getWorkerSource(V,G.type,G.source,G.scope).decodeRasterArray(G,J)}reloadTile(V,G,J){G.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,G.type,G.source,G.scope).reloadTile(G,J)}abortTile(V,G,J){this.getWorkerSource(V,G.type,G.source,G.scope).abortTile(G,J)}removeTile(V,G,J){this.getWorkerSource(V,G.type,G.source,G.scope).removeTile(G,J)}removeSource(V,G,J){if(!(this.workerSources[V]&&this.workerSources[V][G.scope]&&this.workerSources[V][G.scope][G.type]&&this.workerSources[V][G.scope][G.type][G.source]))return;const pe=this.workerSources[V][G.scope][G.type][G.source];delete this.workerSources[V][G.scope][G.type][G.source],pe.removeSource!==void 0?pe.removeSource(G,J):J()}loadWorkerSource(V,G,J){try{this.self.importScripts(G.url),J()}catch(pe){J(pe.toString())}}syncRTLPluginState(V,G,J){if(o.fG.isParsed())J(null,!0);else if(o.fG.isParsing())this.rtlPluginParsingListeners.push(J);else try{o.fG.setState(G);const pe=o.fG.getPluginURL();!o.fG.isLoaded()||o.fG.isParsed()||o.fG.isParsing()||pe==null||(o.fG.setState({pluginStatus:o.fH.parsing,pluginURL:o.fG.getPluginURL()}),this.self.importScripts(pe),o.fG.isParsed()?J(null,!0):this.rtlPluginParsingListeners.push(J))}catch(pe){J(pe.toString())}}setDracoUrl(V,G){this.dracoUrl=G}getAvailableImages(V,G){this.availableImages[V]||(this.availableImages[V]={});let J=this.availableImages[V][G];return J||(J=[]),J}getAvailableModels(V,G){this.availableModels[V]||(this.availableModels[V]={});let J=this.availableModels[V][G];return J||(J={}),J}getLayerIndex(V,G){this.layerIndexes[V]||(this.layerIndexes[V]={});let J=this.layerIndexes[V][G];return J||(J=this.layerIndexes[V][G]=new Ft,J.scope=G),J}getWorkerSource(V,G,J,pe){const fe=this.workerSources;return fe[V]||(fe[V]={}),fe[V][pe]||(fe[V][pe]={}),fe[V][pe][G]||(fe[V][pe][G]={}),this.isSpriteLoaded[V]||(this.isSpriteLoaded[V]={}),fe[V][pe][G][J]||(fe[V][pe][G][J]=new this.workerSourceTypes[G]({send:(xe,Pe,be,Ce,ct,et)=>this.actor.send(xe,Pe,be,V,ct,et),scheduler:this.actor.scheduler},this.getLayerIndex(V,pe),this.getAvailableImages(V,pe),this.getAvailableModels(V,pe),this.isSpriteLoaded[V][pe],void 0,this.brightness,this.worldview)),fe[V][pe][G][J]}rasterizeImagesWorker(V,G,J){const pe=new Map;for(const[fe,{image:xe,imageVariant:Pe}]of G.tasks.entries()){const be=this.imageRasterizer.rasterize(Pe,xe,G.scope,V);pe.set(fe,be)}J(void 0,pe)}removeRasterizedImages(V,G,J){this.imageRasterizer.removeImagesFromCacheByIds(G.imageIds,G.scope,V),J()}enforceCacheSizeLimit(V,G){o.fI(G)}getWorkerPerformanceMetrics(V,G,J){J(void 0,void 0)}}return o.fE(self)&&(self.worker=new xu(self)),xu})),ke(["./shared"],(function(o){var Tt="3.16.0";const We={create:"create",load:"load",fullLoad:"fullLoad"},ci={mark(c){performance.mark(c)},measure(c,t,r){performance.measure(c,t,r)}};function Ft(c){const t=c.name.split("?")[0];return o.a(t)&&t.includes("mapbox-gl.js")?"javascript":o.a(t)&&t.includes("mapbox-gl.css")?"css":o.b(t)?"fontRange":o.c(t)?"sprite":o.i(t)?"style":o.d(t)?"tilejson":"other"}var Pi,Hi={},yn=(function(){if(Pi)return Hi;function c(u){return!t(u)}function t(u){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,y,b=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(b);try{y=new Worker(T),_=!0}catch{_=!1}return y&&y.terminate(),URL.revokeObjectURL(T),_})()?(function(){var _=document.createElement("canvas");_.width=_.height=1;var y=_.getContext("2d");if(!y)return!1;var b=y.getImageData(0,0,1,1);return b&&b.width===_.width})()?(r[p=u&&u.failIfMajorPerformanceCaveat]===void 0&&(r[p]=(function(_){var y,b=(function(T){var M=document.createElement("canvas"),I=Object.create(c.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=T,M.getContext("webgl2",I)})(_);if(!b)return!1;try{y=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!y||b.isContextLost())&&(b.shaderSource(y,"void main() {}"),b.compileShader(y),b.getShaderParameter(y,b.COMPILE_STATUS)===!0)})(p)),r[p]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var p}Pi=1,Hi.supported=c,Hi.notSupportedReason=t;var r={};return c.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Hi})();function hi(c,t,r){const u=document.createElement(c);return t!=null&&(u.className=t),r&&r.appendChild(u),u}function $i(c,t,r){const u=document.createElementNS("http://www.w3.org/2000/svg",c);for(const p of Object.keys(t))u.setAttributeNS(null,p,String(t[p]));return r&&r.appendChild(u),u}const vn=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ci=vn&&vn.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ki;function si(){vn&&Ci&&(ki=vn[Ci],vn[Ci]="none")}function _n(){vn&&Ci&&(vn[Ci]=ki)}function mr(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",mr,!0)}function ln(){window.addEventListener("click",mr,!0),window.setTimeout((()=>{window.removeEventListener("click",mr,!0)}),0)}function ea(c,t){const r=c.getBoundingClientRect();return no(c,r,t)}function Oa(c,t){const r=c.getBoundingClientRect(),u=[];for(let p=0;p<t.length;p++)u.push(no(c,r,t[p]));return u}function Ss(c){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&c.button===2&&c.ctrlKey?0:c.button}function no(c,t,r){const u=c.offsetWidth===t.width?1:c.offsetWidth/t.width;return new o.P((r.clientX-t.left)*u,(r.clientY-t.top)*u)}const xa="01",Yi="NO_ACCESS_TOKEN";class Bo{constructor(t,r,u){this._transformRequestFn=t,this._customAccessToken=r,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const t=(function(){let r="";for(let u=0;u<10;u++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",xa,r].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeStyleURL(t,r){if(!o.h(t))return t;const u=yt(t);return u.params.push(`sdk=js-${Tt}`),u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||r)}normalizeGlyphsURL(t,r){if(!o.h(t))return t;const u=yt(t);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||r)}normalizeModelURL(t,r){if(!o.h(t))return t;const u=yt(t);return u.path=`/models/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||r)}normalizeSourceURL(t,r,u,p){if(!o.h(t))return t;const _=yt(t);return _.path=`/v4/${_.authority}.json`,_.params.push("secure"),u&&_.params.push(`language=${u}`),p&&_.params.push(`worldview=${p}`),this._makeAPIURL(_,this._customAccessToken||r)}normalizeIconsetURL(t,r){const u=yt(t);return o.h(t)?(u.path=`/styles/v1${u.path}/iconset.pbf`,this._makeAPIURL(u,this._customAccessToken||r)):jt(u)}normalizeSpriteURL(t,r,u,p){const _=yt(t);return o.h(t)?(_.path=`/styles/v1${_.path}/sprite${r}${u}`,this._makeAPIURL(_,this._customAccessToken||p)):(_.path+=`${r}${u}`,jt(_))}normalizeTileURL(t,r,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!o.h(t))return t;const p=yt(t);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||u&&p.authority!=="raster"&&u===512?"@2x":""}${o.k.supported?".webp":"$1"}`),p.authority==="raster"?p.path=`/${o.e.RASTER_URL_PREFIX}${p.path}`:p.authority==="rasterarrays"?p.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${p.path}`:p.authority==="3dtiles"?p.path=`/${o.e.TILES3D_URL_PREFIX}${p.path}`:(p.path=p.path.replace(/^.+\/v4\//,"/"),p.path=`/${o.e.TILE_URL_VERSION}${p.path}`);const _=this._customAccessToken||(function(y){for(const b of y){const T=b.match(/^access_token=(.*)$/);if(T)return T[1]}return null})(p.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&_&&this._skuToken&&p.params.push(`sku=${this._skuToken}`),this._makeAPIURL(p,_)}canonicalizeTileURL(t,r){const u=yt(t);if(!u.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!u.path.match(/\.[\w]+$/))return t;let p="mapbox://";u.path.match(/^\/raster\/v1\//)?p+=`raster/${u.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:u.path.match(/^\/rasterarrays\/v1\//)?p+=`rasterarrays/${u.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:p+=`tiles/${u.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let _=u.params;return r&&(_=_.filter((y=>!y.match(/^access_token=/)))),_.length&&(p+=`?${_.join("&")}`),p}canonicalizeTileset(t,r){const u=!!r&&o.h(r),p=[];for(const _ of t.tiles||[])o.j(_)?p.push(this.canonicalizeTileURL(_,u)):p.push(_);return p}_makeAPIURL(t,r){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",p=yt(o.e.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){const _=t.params.indexOf("secure");_>=0&&t.params.splice(_,1)}if(p.path!=="/"&&(t.path=`${p.path}${t.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return jt(t);if(r=r||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return t.params=t.params.filter((_=>_.indexOf("access_token")===-1)),t.params.push(`access_token=${r||""}`),jt(t)}}const zr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function yt(c){const t=c.match(zr);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function jt(c){const t=c.params.length?`?${c.params.join("&")}`:"";return`${c.protocol}://${c.authority}${c.path}${t}`}const _i="mapbox.eventData";function On(c){if(!c)return null;const t=c.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(o.l(t[1]))}catch{return null}}class Fn{constructor(t){this.type=t,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const r=On(o.e.ACCESS_TOKEN);let u="";return u=r&&r.u?o.f(r.u):o.e.ACCESS_TOKEN||"",t?`${_i}.${t}:${u}`:`${_i}:${u}`}fetchEventData(){const t=o.s("localStorage"),r=this.getStorageKey(),u=this.getStorageKey("uuid"),p=this.getStorageKey("uuidTimestamp");if(t)try{const _=localStorage.getItem(r);_&&(this.eventData=JSON.parse(_));const y=localStorage.getItem(u);y&&(this.anonId=y);const b=localStorage.getItem(p);b&&(this.anonIdTimestamp=Number(b));const T=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<T)&&this.refreshUUID()}catch{o.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=o.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=o.s("localStorage"),r=this.getStorageKey(),u=this.getStorageKey("uuid"),p=this.getStorageKey("uuidTimestamp"),_=this.anonId,y=this.anonIdTimestamp;if(t&&_)try{localStorage.setItem(u,_),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData)),y&&localStorage.setItem(p,y.toString())}catch{o.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,r,u,p){if(!o.e.EVENTS_URL)return;const _=yt(o.e.EVENTS_URL);_.params.push(`access_token=${p||o.e.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(t).toISOString()},b=r?Object.assign(y,r):y,T={url:jt(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=o.p(T,(M=>{this.pendingRequest=null,u(M),this.saveEventData(),this.processRequests(p)}))}queueRequest(t,r){this.queue.push(t),this.processRequests(r)}}const Ue=new class extends Fn{constructor(c){super("appUserTurnstile"),this._customAccessToken=c}postTurnstileEvent(c,t){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(c)&&c.some((r=>o.h(r)||o.j(r)))&&this.queueRequest(Date.now(),t)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=On(o.e.ACCESS_TOKEN),r=t?t.u:o.e.ACCESS_TOKEN;let u=r!==this.eventData.tokenU;o.v(this.anonId)||(this.refreshUUID(),u=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),y=new Date(p),b=(p-this.eventData.lastSuccess)/864e5;u=u||b>=1||b<-1||_.getDate()!==y.getDate()}else u=!0;u?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Tt,skuId:xa,"enabled.telemetry":!1,userId:this.anonId},(_=>{_||(this.eventData.lastSuccess=p,this.eventData.tokenU=r)}),c):this.processRequests()}},Pt=Ue.postTurnstileEvent.bind(Ue),qt=new class extends Fn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(c,t,r,u){this.skuToken=t,this.errorCb=u,o.e.EVENTS_URL&&(r||o.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},r):this.errorCb(new Error(Yi)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID(),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Tt,skuId:xa,skuToken:this.skuToken,userId:this.anonId},(u=>{u?this.errorCb(u):t&&(this.success[t]=!0)}),c))}remove(){this.errorCb=null}},gi=qt.postMapLoadEvent.bind(qt),fn=new class extends Fn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(c){let t=this.mapInstanceIdMap.get(c);return t||(t=o.u(),this.mapInstanceIdMap.set(c,t)),t}getEventId(c){const t=this.eventIdPerMapInstanceMap.get(c)||0;return this.eventIdPerMapInstanceMap.set(c,t+1),t}postStyleLoadEvent(c,t){const{map:r,style:u,importedStyles:p}=t;if(!o.e.EVENTS_URL||!c&&!o.e.ACCESS_TOKEN)return;const _=this.getMapInstanceId(r),y={mapInstanceId:_,eventId:this.getEventId(_),style:u};p.length&&(y.importedStyles=p),this.queueRequest({timestamp:Date.now(),payload:y},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:r}=this.queue.shift();this.postEvent(t,r,(()=>{}),c)}},En=fn.postStyleLoadEvent.bind(fn),Kn=new class extends Fn{constructor(c){super("metrics"),c&&(this.data=c)}postMetricsEvent(c){if(!o.e.EVENTS_URL||!c&&!o.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID();const t=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:t},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:r}=this.queue.shift();this.postEvent(t,r,(()=>{}),c)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Lr=Kn.postMetricsEvent.bind(Kn),Li=new class extends Fn{constructor(){super("gljs.performance")}postPerformanceEvent(c,t){o.e.EVENTS_URL&&(c||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:r}=this.queue.shift(),u=(function(p){const _=performance.getEntriesByType("resource"),y=performance.getEntriesByType("mark"),b=(function(O){const B={};if(O){for(const N in O)if(N!=="other")for(const H of O[N]){const j=`${N}ResolveRangeMin`,Z=`${N}ResolveRangeMax`,K=`${N}RequestCount`,W=`${N}RequestCachedCount`;B[j]=Math.min(B[j]||1/0,H.startTime),B[Z]=Math.max(B[Z]||-1/0,H.responseEnd);const se=Q=>{B[Q]===void 0&&(B[Q]=0),++B[Q]};H.transferSize!==void 0&&H.transferSize===0&&se(W),se(K)}}return B})((function(O,B){const N={};if(O)for(const H of O){const j=B(H);N[j]===void 0&&(N[j]=[]),N[j].push(H)}return N})(_,Ft)),T=window.devicePixelRatio,M=navigator.connection||navigator.mozConnection||navigator.webkitConnection,I=M?M.effectiveType:void 0,P={counters:[],metadata:[],attributes:[]},z=(O,B,N)=>{N!=null&&O.push({name:B,value:N.toString()})};for(const O in b)z(P.counters,O,b[O]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(z(P.counters,"interactionRangeMin",p.interactionRange[0]),z(P.counters,"interactionRangeMax",p.interactionRange[1])),y)for(const O of Object.values(We)){const B=y.find((N=>N.name===O));B&&z(P.counters,O,B.startTime)}return z(P.counters,"visibilityHidden",p.visibilityHidden),z(P.attributes,"style",(function(O){if(O)for(const B of O){const N=B.name.split("?")[0];if(o.i(N)){const H=N.split("/").slice(-2);if(H.length===2)return`mapbox://styles/${H[0]}/${H[1]}`}}})(_)),z(P.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),z(P.attributes,"fogEnabled",p.fogEnabled?"true":"false"),z(P.attributes,"projection",p.projection),z(P.attributes,"zoom",p.zoom),z(P.metadata,"devicePixelRatio",T),z(P.metadata,"connectionEffectiveType",I),z(P.metadata,"navigatorUserAgent",navigator.userAgent),z(P.metadata,"screenWidth",window.screen.width),z(P.metadata,"screenHeight",window.screen.height),z(P.metadata,"windowWidth",window.innerWidth),z(P.metadata,"windowHeight",window.innerHeight),z(P.metadata,"mapWidth",p.width/T),z(P.metadata,"mapHeight",p.height/T),z(P.metadata,"webglRenderer",p.renderer),z(P.metadata,"webglVendor",p.vendor),z(P.metadata,"sdkVersion",Tt),z(P.metadata,"sdkIdentifier","mapbox-gl-js"),P})(r);for(const p of u.metadata);for(const p of u.counters);for(const p of u.attributes);this.postEvent(t,u,(()=>{}),c)}},br=Li.postPerformanceEvent.bind(Li),Br=new class extends Fn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(c,t,r,u){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const p=yt(o.e.API_URL+o.e.SESSION_PATH);p.params.push(`sku=${t||""}`),p.params.push(`access_token=${u||o.e.ACCESS_TOKEN||""}`);const _={url:jt(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(_,(y=>{this.pendingRequest=null,r(y),this.saveEventData(),this.processRequests(u)}))}getSessionAPI(c,t,r,u){this.skuToken=t,this.errorCb=u,o.e.SESSION_PATH&&o.e.API_URL&&(r||o.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},r):this.errorCb(new Error(Yi)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,(u=>{u?this.errorCb(u):t&&(this.success[t]=!0)}),c)}remove(){this.errorCb=null}},Ol=Br.getSessionAPI.bind(Br),sr=new Set;function ro(c,t){t?sr.add(c):sr.delete(c)}class $a{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,r){this._updatedSourceCaches[t]=r,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const r=t.scope;this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._updatedLayers[r].add(t.id),this.setDirty()}removeLayer(t){const r=t.scope;this._removedLayers[r]=this._removedLayers[r]||{},this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._removedLayers[r][t.id]=t,this._updatedLayers[r].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const r in this._updatedLayers)t[r]=t[r]||{},t[r].updatedIds=Array.from(this._updatedLayers[r].values());for(const r in this._removedLayers)t[r]=t[r]||{},t[r].removedIds=Object.keys(this._removedLayers[r]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,r){this._updatedImages[r]=this._updatedImages[r]||new Set,this._updatedImages[r].add(o.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function wo(c){const{userImage:t}=c;return!!(t&&t.render&&t.render())&&(c.data.replace(new Uint8Array(t.data.buffer)),!0)}class Es extends o.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&o.r()&&(this.imageRasterizerDispatcher=new o.D(o.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new o.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const r=this.atlasTexture.get(t);r&&(r.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,r){this.imageProviders.has(r)||this.imageProviders.set(r,new Map),this.imageProviders.get(r).set(t.id,t)}removeImageProvider(t,r){this.imageProviders.has(r)&&this.imageProviders.get(r).delete(t)}getPendingImageProviders(){const t=[];for(const r of this.imageProviders.values())for(const u of r.values())u.hasPendingRequests()&&t.push(u);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,r){if(this.loaded.get(r)!==t&&(this.loaded.set(r,t),t)){for(const{ids:u,callback:p}of this.requestors)this._notify(u,r,p);this.requestors=[]}}hasImage(t,r){return!!this.getImage(t,r)}getImage(t,r){return this.images.get(r).get(t.toString())}addImage(t,r,u){this._validate(t,u)&&this.images.get(r).set(t.toString(),u)}_validate(t,r){let u=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new o.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),u=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new o.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),u=!1),this._validateContent(r.content,r)||(this.fire(new o.y(new Error(`Image "${t.name}" has invalid "content" value`))),u=!1),u}_validateStretch(t,r){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||r<p[1])return!1;u=p[1]}return!0}_validateContent(t,r){return t?t.length!==4||!r.usvg&&(t[0]<0||r.data.width<t[0]||t[1]<0||r.data.height<t[1]||t[2]<0||r.data.width<t[2]||t[3]<0||r.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,r,u){const p=this.images.get(r).get(t.toString());u.version=p.version+1,this.images.get(r).set(t.toString(),u),this.updatedImages.get(r).add(t),this.removeFromImageRasterizerCache(t,r)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,r){this.spriteFormat!=="raster"&&(o.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:r}):this.imageRasterizer.removeImagesFromCacheByIds([t],r))}removeImage(t,r){const u=this.images.get(r),p=u.get(t.toString());u.delete(t.toString()),this.patterns.get(r).delete(t.toString()),this.removeFromImageRasterizerCache(t,r),p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map((r=>o.I.from(r)))}getImages(t,r,u){const p=[],_=[],y=this.imageProviders.get(r);for(const I of t){if(!I.iconsetId){p.push(I);continue}const P=y.get(I.iconsetId);P&&(this.getImage(I,r)?_.push(I):P.addPendingRequest(I))}if(p.length===0)return void this._notify(_,r,u);let b=!0;const T=!!this.loaded.get(r),M=this.images.get(r);if(!T)for(const I of p)M.has(I.toString())||(b=!1);T||b?this._notify(p,r,u):this.requestors.push({ids:p,scope:r,callback:u})}rasterizeImages(t,r){const u=new Map,{tasks:p,scope:_}=t;for(const[y,b]of p.entries()){const T=this.getImage(b.id,_);T&&u.set(y,{image:T,imageVariant:b})}this._rasterizeImages(_,u,r)}_rasterizeImages(t,r,u){if(o.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:r,scope:t},u);else{const p=new Map;for(const[_,{image:y,imageVariant:b}]of r.entries())p.set(_,this.imageRasterizer.rasterize(b,y,t,0));u(void 0,p)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,r,u){const p=this.images.get(r),_=new Map;for(const y of t){if(!p.get(y.toString())){if(y.iconsetId)continue;this.fire(new o.z("styleimagemissing",{id:y.name}))}const b=p.get(y.toString());if(!b){o.w(`Image "${y.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const T={data:b.usvg?null:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,usvg:b.usvg,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)};b.usvg&&Object.assign(T,{width:b.icon.usvg_tree.width,height:b.icon.usvg_tree.height}),_.set(o.I.toString(y),T)}u(null,_)}getPixelSize(t){const{width:r,height:u}=this.atlasImage.get(t);return{width:r,height:u}}getPattern(t,r,u){const p=t.toString(),_=this.patterns.get(r),y=_.get(p),b=this.getImage(t,r);if(!b)return null;if(y){if(y.position.version===b.version)return y.position;y.position.version=b.version}else{if(b.usvg&&!b.data){const T=this.getPatternInFlightId(p,r);if(this.patternsInFlight.has(T))return null;this.patternsInFlight.add(T);const M=new o.A(t).scaleSelf(o.o.devicePixelRatio),I=new Map([[M.toString(),{image:b,imageVariant:M}]]);return this._rasterizeImages(r,I,((P,z)=>this.storePatternImage(M,r,b,u,z))),null}this.storePattern(t,r,b)}return this._updatePatternAtlas(r,u),_.get(p).position}getPatternInFlightId(t,r){return o.B(t,r)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,r,u,p,_){const y=t.toString(),b=_?_.get(y):void 0;b&&(u.data=b,this.storePattern(t.id,r,u),this._updatePatternAtlas(r,p),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),r)))}storePattern(t,r,u){const p={w:u.data.width+2*o.C,h:u.data.height+2*o.C,x:0,y:0},_=new o.F(p,u,o.C);this.patterns.get(r).set(t.toString(),{bin:p,position:_})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,r){const u=t.gl;let p=this.atlasTexture.get(r);p?this.dirty&&(p.update(this.atlasImage.get(r)),this.dirty=!1):(p=new o.T(t,this.atlasImage.get(r),u.RGBA8),this.atlasTexture.set(r,p)),p.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(t,r){const u=this.patterns.get(t),p=Array.from(u.values()).map((({bin:M})=>M)),{w:_,h:y}=o.G(p),b=this.atlasImage.get(t);b.resize({width:_||1,height:y||1});const T=this.images.get(t);for(const[M,{bin:I,position:P}]of u.entries()){let z=P.padding;const O=I.x+z,B=I.y+z,N=T.get(M).data,H=N.width,j=N.height;z=z>1?z-1:z,o.q.copy(N,b,{x:0,y:0},{x:O,y:B},{width:H,height:j},r),o.q.copy(N,b,{x:0,y:j-z},{x:O,y:B-z},{width:H,height:z},r),o.q.copy(N,b,{x:0,y:0},{x:O,y:B+j},{width:H,height:z},r),o.q.copy(N,b,{x:H-z,y:0},{x:O-z,y:B},{width:z,height:j},r),o.q.copy(N,b,{x:0,y:0},{x:O+H,y:B},{width:z,height:j},r),o.q.copy(N,b,{x:H-z,y:j-z},{x:O-z,y:B-z},{width:z,height:z},r),o.q.copy(N,b,{x:0,y:j-z},{x:O+H,y:B-z},{width:z,height:z},r),o.q.copy(N,b,{x:0,y:0},{x:O+H,y:B+j},{width:z,height:z},r),o.q.copy(N,b,{x:H-z,y:0},{x:O-z,y:B+j},{width:z,height:z},r)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,r){const u=this.images.get(r);for(const p of t){if(this.callbackDispatchedThisFrame.get(r).has(p.toString()))continue;this.callbackDispatchedThisFrame.get(r).add(p.toString());const _=u.get(p.toString());wo(_)&&this.updateImage(p,r,_)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Sr(c){const t=c.value,r=c.valueSpec,u=c.style,p=c.styleSpec,_=c.key,y=c.arrayElementValidator||Zn;if(!Array.isArray(t))return[new o.V(_,t,`array expected, ${o.K(t)} found`)];if(r.length&&t.length!==r.length)return[new o.V(_,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new o.V(_,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let b={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};p.$version<7&&(b.function=r.function),o.H(r.value)&&(b=r.value);let T=[];for(let M=0;M<t.length;M++)T=T.concat(y({array:t,arrayIndex:M,value:t[M],valueSpec:b,style:u,styleSpec:p,key:`${_}[${M}]`},!0));return T}function gc(c){const t=c.key,r=c.value,u=c.valueSpec;if(!o.L(r))return[new o.V(t,r,`number expected, ${o.K(r)} found`)];if(r!=r)return[new o.V(t,r,"number expected, NaN found")];if("minimum"in u){let p=u.minimum;if(Array.isArray(u.minimum)&&(p=u.minimum[c.arrayIndex]),r<p)return[new o.V(t,r,`${r} is less than the minimum value ${p}`)]}if("maximum"in u){let p=u.maximum;if(Array.isArray(u.maximum)&&(p=u.maximum[c.arrayIndex]),r>p)return[new o.V(t,r,`${r} is greater than the maximum value ${p}`)]}return[]}function ol(c){const t=c.key,r=c.value;if(!o.H(r))return[new o.V(t,r,`object expected, ${o.K(r)} found`)];const u=c.valueSpec,p=o.J(r.type);let _,y,b,T={};const M=p!=="categorical"&&r.property===void 0,I=!M,P=(function(N){const H=N.stops;return Array.isArray(H)&&Array.isArray(H[0])&&o.H(H[0][0])})(r),z=ta({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(N){if(p==="identity")return[new o.V(N.key,N.value,'identity function may not have a "stops" property')];let H=[];const j=N.value;return H=H.concat(Sr({key:N.key,value:j,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:O})),Array.isArray(j)&&j.length===0&&H.push(new o.V(N.key,j,"array must have at least one stop")),H},default:function(N){return Zn({key:N.key,value:N.value,valueSpec:u,style:N.style,styleSpec:N.styleSpec})}}});return p==="identity"&&M&&z.push(new o.V(c.key,c.value,'missing required property "property"')),p==="identity"||r.stops||z.push(new o.V(c.key,c.value,'missing required property "stops"')),p==="exponential"&&u.expression&&!o.M(u)&&z.push(new o.V(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(I&&!o.N(u)?z.push(new o.V(c.key,c.value,"property functions not supported")):M&&!o.O(u)&&z.push(new o.V(c.key,c.value,"zoom functions not supported"))),p!=="categorical"&&!P||r.property!==void 0||z.push(new o.V(c.key,c.value,'"property" property is required')),z;function O(N){let H=[];const j=N.value,Z=N.key;if(!Array.isArray(j))return[new o.V(Z,j,`array expected, ${o.K(j)} found`)];if(j.length!==2)return[new o.V(Z,j,`array length 2 expected, length ${j.length} found`)];if(P){if(!o.H(j[0]))return[new o.V(Z,j,`object expected, ${o.K(j[0])} found`)];const K=j[0];if(K.zoom===void 0)return[new o.V(Z,j,"object stop key must have zoom")];if(K.value===void 0)return[new o.V(Z,j,"object stop key must have value")];const W=o.J(K.zoom);if(typeof W!="number")return[new o.V(Z,K.zoom,"stop zoom values must be numbers")];if(b&&b>W)return[new o.V(Z,K.zoom,"stop zoom values must appear in ascending order")];W!==b&&(b=W,y=void 0,T={}),H=H.concat(ta({key:`${Z}[0]`,value:j[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:gc,value:B}}))}else H=H.concat(B({key:`${Z}[0]`,value:j[0],style:N.style,styleSpec:N.styleSpec},j));return o.Q(o.S(j[1]))?H.concat([new o.V(`${Z}[1]`,j[1],"expressions are not allowed in function stops.")]):H.concat(Zn({key:`${Z}[1]`,value:j[1],valueSpec:u,style:N.style,styleSpec:N.styleSpec}))}function B(N,H){const j=o.K(N.value),Z=o.J(N.value),K=N.value!==null?N.value:H;if(_){if(j!==_)return[new o.V(N.key,K,`${j} stop domain type must match previous stop domain type ${_}`)]}else _=j;if(j!=="number"&&j!=="string"&&j!=="boolean"&&typeof Z!="number"&&typeof Z!="string"&&typeof Z!="boolean")return[new o.V(N.key,K,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&p!=="categorical"){let W=`number expected, ${j} found`;return o.N(u)&&p===void 0&&(W+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(N.key,K,W)]}return p!=="categorical"||j!=="number"||typeof Z=="number"&&isFinite(Z)&&Math.floor(Z)===Z?p!=="categorical"&&j==="number"&&typeof Z=="number"&&typeof y=="number"&&y!==void 0&&Z<y?[new o.V(N.key,K,"stop domain values must appear in ascending order")]:(y=Z,p==="categorical"&&Z in T?[new o.V(N.key,K,"stop domain values must be unique")]:(T[Z]=!0,[])):[new o.V(N.key,K,`integer expected, found ${String(Z)}`)]}}function Fa(c){const t=(c.expressionContext==="property"?o.W:o.U)(o.S(c.value),c.valueSpec);if(t.result==="error")return t.value.map((u=>new o.V(`${c.key}${u.key}`,c.value,u.message)));const r=t.value.expression||t.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!r.outputDefined())return[new o.V(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!o.Z(r))return[new o.V(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return Fl(r,c);if(c.expressionContext==="appearance")return _h(r,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!o.X(r,["zoom","feature-state"]))return[new o.V(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!o.Y(r))return[new o.V(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fl(c,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const p of t.valueSpec.expression.parameters)r.delete(p);if(r.size===0)return[];const u=[];return c instanceof o._&&r.has(c.name)?[new o.V(t.key,t.value,`["${c.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(c.eachChild((p=>{u.push(...Fl(p,t))})),u)}function _h(c,t){const r=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const p of t.valueSpec.expression.parameters)r.add(p);if(r.size===0)return[];const u=[];return c instanceof o._&&!r.has(c.name)?[new o.V(t.key,t.value,`["${c.name}"] is not an allowed parameter`)]:(c.eachChild((p=>{u.push(..._h(p,t))})),u)}function Er(c){const t=c.key,r=c.value,u=c.valueSpec,p=[];return Array.isArray(u.values)?u.values.indexOf(o.J(r))===-1&&p.push(new o.V(t,r,`expected one of [${u.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(u.values).indexOf(o.J(r))===-1&&p.push(new o.V(t,r,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(r)} found`)),p}function Bl(c){return o.a2(o.S(c.value))?Fa(Object.assign({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):as(c)}function as(c){const t=c.value,r=c.key;if(!Array.isArray(t))return[new o.V(r,t,`array expected, ${o.K(t)} found`)];if(t.length<1)return[new o.V(r,t,"filter array must have at least 1 element")];const u=c.styleSpec;let p=Er({key:`${r}[0]`,value:t[0],valueSpec:u.filter_operator});switch(o.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&o.J(t[1])==="$type"&&p.push(new o.V(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&p.push(new o.V(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(o.a0(t[1])||p.push(new o.V(`${r}[1]`,t[1],`string expected, ${o.K(t[1])} found`)));for(let _=2;_<t.length;_++)o.J(t[1])==="$type"?p=p.concat(Er({key:`${r}[${_}]`,value:t[_],valueSpec:u.geometry_type})):o.a0(t[_])||o.L(t[_])||o.$(t[_])||p.push(new o.V(`${r}[${_}]`,t[_],`string, number, or boolean expected, ${o.K(t[_])} found.`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)p=p.concat(as({key:`${r}[${_}]`,value:t[_],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":t.length!==2?p.push(new o.V(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):o.a0(t[1])||p.push(new o.V(`${r}[1]`,t[1],`string expected, ${o.K(t[1])} found`))}return p}function As(c,t){const r=c.key,u=c.style,p=c.layer,_=c.styleSpec,y=c.value,b=c.objectKey,T=_[`${t}_${c.layerType}`];if(!T)return[];const M=b.match(/^(.*)-use-theme$/);if(M&&T[M[1]])return o.Q(o.S(y))?[].concat(Zn({key:r,value:y,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:u,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:b})):Zn({key:r,value:y,valueSpec:{type:"string"},style:u,styleSpec:_});const I=b.match(/^(.*)-transition$/);if(t==="paint"&&I&&T[I[1]]&&T[I[1]].transition)return Zn({key:r,value:y,valueSpec:_.transition,style:u,styleSpec:_});const P=c.valueSpec||T[b];if(!P)return[new o.a3(r,y,`unknown property "${b}"`)];let z;if(o.a0(y)&&o.N(P)&&!P.tokens&&(z=/^{([^}]+)}$/.exec(y))){const B=`\`{ "type": "identity", "property": ${z?JSON.stringify(z[1]):'"_"'} }\``;return[new o.V(r,y,`"${b}" does not support interpolation syntax
Use an identity property function instead: ${B}.`)]}const O=[];if(c.layerType==="symbol")b!=="text-field"||!u||u.glyphs||u.imports||O.push(new o.V(r,y,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&o.a4(o.S(y))&&o.J(y.type)==="identity"&&O.push(new o.V(r,y,'"text-font" does not support identity functions'));else if(c.layerType==="model"&&t==="paint"&&p&&p.layout&&p.layout.hasOwnProperty("model-id")&&o.N(P)&&(o.a5(P)||o.O(P))){const B=o.W(o.S(y),P).value,N="expression"in B&&B.expression||"_styleExpression"in B&&B._styleExpression&&B._styleExpression.expression;N&&!o.X(N,["measure-light"])&&(b==="model-emissive-strength"&&o.Y(N)&&o.Z(N)||O.push(new o.V(r,y,`${b} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return O.concat(Zn({key:c.key,value:y,valueSpec:P,style:u,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:b}))}function Ms(c){return As(c,"paint")}function Wa(c){return As(c,"layout")}function kl(c){let t=[];const r=c.value,u=c.key,p=c.style,_=c.styleSpec;if(!o.H(r))return[new o.V(u,r,"object expected")];r.type||r.ref||t.push(new o.V(u,r,'either "type" or "ref" is required'));let y=o.J(r.type);const b=o.J(r.ref);if(r.id){const T=o.J(r.id);for(let M=0;M<c.arrayIndex;M++){const I=p.layers[M];o.J(I.id)===T&&t.push(new o.V(u,r.id,`duplicate layer id "${T}", previously used at line ${I.id.__line__}`))}}if("ref"in r){let T;["type","source","source-layer","filter","layout"].forEach((M=>{M in r&&t.push(new o.V(u,r[M],`"${M}" is prohibited for ref layers`))})),p.layers.forEach((M=>{o.J(M.id)===b&&(T=M)})),T?T.ref?t.push(new o.V(u,r.ref,"ref cannot reference another ref layer")):y=o.J(T.type):typeof b=="string"&&t.push(new o.V(u,r.ref,`ref layer "${b}" not found`))}else if(y!=="background"&&y!=="sky"&&y!=="slot")if(r.source)if(o.a0(r.source)){const T=p.sources&&p.sources[r.source],M=T&&o.J(T.type);T?M==="vector"&&y==="raster"?t.push(new o.V(u,r.source,`layer "${r.id}" requires a raster source`)):M==="raster"&&y!=="raster"?t.push(new o.V(u,r.source,`layer "${r.id}" requires a vector source`)):M!=="vector"||r["source-layer"]?M==="raster-dem"&&y!=="hillshade"?t.push(new o.V(u,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="raster-array"||["raster","raster-particle"].includes(y)?y==="line"&&r.paint&&(r.paint["line-gradient"]||r.paint["line-trim-offset"])&&M==="geojson"&&!T.lineMetrics?t.push(new o.V(u,r,`layer "${r.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):y==="raster-particle"&&M!=="raster-array"&&t.push(new o.V(u,r.source,`layer "${r.id}" requires a 'raster-array' source.`)):t.push(new o.V(u,r.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new o.V(u,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new o.V(u,r.source,`source "${r.source}" not found`))}else t.push(new o.V(`${u}.source`,r.source,'"source" must be a string'));else t.push(new o.V(u,r,'missing required property "source"'));return t=t.concat(ta({key:u,value:r,valueSpec:_.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Zn({key:`${u}.type`,value:r.type,valueSpec:_.layer.type,style:c.style,styleSpec:c.styleSpec,object:r,objectKey:"type"}),filter:T=>Bl(Object.assign({layerType:y},T)),layout:T=>ta({layer:r,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":M=>Wa(Object.assign({layerType:y},M))}}),paint:T=>ta({layer:r,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":M=>Ms(Object.assign({layerType:y,layer:r},M))}}),appearances(T){const M=Sr({key:T.key,value:T.value,valueSpec:T.valueSpec,style:T.style,styleSpec:T.styleSpec,arrayElementValidator:z=>(function(O){const{key:B,layer:N,layerType:H}=O,j=o.J(O.value),Z=o.J(j.name),K=o.J(j.condition),W=ta({key:B,value:j,valueSpec:O.styleSpec.appearance,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{condition:se=>(function(Q){const ce=[];return ce.push(...Fa({key:Q.key,value:Q.object.condition,valueSpec:o.a6.appearance.condition,expressionContext:"appearance"})),ce})(Object.assign({layer:N,layerType:H},se)),properties:se=>(function(Q){const ce=[],{styleSpec:ie,layer:te,layerType:ue}=Q,we=ie[`paint_${ue}`],ve=ie[`layout_${ue}`],Oe=Q.object[Q.objectKey];for(const ze in Oe){const je=ze in we?"paint":ze in ve?"layout":void 0;if(!je){ce.push(new o.V(Q.key,ze,`unknown property "${ze}" for layer type "${ue}"`));continue}const lt=Object.assign({},Q,{key:`${Q.key}.${ze}`,object:Oe,objectKey:ze,layer:te,layerType:ue,value:Oe[ze],valueSpec:je==="paint"?we[ze]:ve[ze]});ce.push(...As(lt,je))}return ce})(Object.assign({layer:N,layerType:H},se))}});return Z!=="hidden"&&K===void 0&&W.push(new o.V(O.key,"name",'Appearance with name different than "hidden" must have a condition')),W})(Object.assign({layerType:y,layer:r},z))}),I=Array.isArray(T.value)?T.value:[],P=new Set;return I.forEach(((z,O)=>{const B=o.J(z.name);if(B)if(P.has(B)){const N=o.J(r.id);M.push(new o.V(T.key,B,`Duplicated appearance name "${B}" for layer "${N}"`))}else P.add(B)})),M}}})),t}function Is({key:c,value:t}){return o.a0(t)?[]:[new o.V(c,t,`string expected, ${o.K(t)} found`)]}const gu={promoteId:function c({key:t,value:r}){if(o.a0(r))return Is({key:t,value:r});if(Array.isArray(r)){const p=[],_=o.S(r),y=o.U(_);return y.result==="error"&&y.value.forEach((b=>{p.push(new o.V(`${t}${b.key}`,null,`${b.message}`))})),o.X(y.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||p.push(new o.V(`${t}`,null,"promoteId expression should be only feature dependent")),p}if(!o.H(r))return[new o.V(t,r,`string, expression or object expected, "${o.K(r)}" found`)];const u=[];for(const p in r)u.push(...c({key:`${t}.${p}`,value:r[p]}));return u}};function Cs(c){const t=c.value,r=c.key,u=c.styleSpec,p=c.style;if(!o.H(t))return[new o.V(r,t,`object expected, ${o.K(t)} found`)];if(!("type"in t))return[new o.V(r,t,'"type" is required')];const _=o.J(t.type);let y=[];switch(["vector","raster","raster-dem","raster-array"].includes(_)&&("url"in t||"tiles"in t||y.push(new o.a3(r,t,'Either "url" or "tiles" is required.'))),_){case"vector":case"raster":case"raster-dem":case"raster-array":return y=y.concat(ta({key:r,value:t,valueSpec:u[`source_${_.replace("-","_")}`],style:c.style,styleSpec:u,objectElementValidators:gu})),y;case"geojson":if(y=ta({key:r,value:t,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:gu}),"cluster"in t&&"clusterProperties"in t){if(!o.H(t.clusterProperties))return[new o.V(`${r}.clusterProperties`,t,`object expected, ${o.K(t)} found`)];for(const b in t.clusterProperties){const T=t.clusterProperties[b];if(!Array.isArray(T))return[new o.V(`${r}.clusterProperties.${b}`,T,"array expected")];const[M,I]=T,P=typeof M=="string"?[M,["accumulated"],["get",b]]:M;y.push(...Fa({key:`${r}.${b}.map`,value:I,expressionContext:"cluster-map"})),y.push(...Fa({key:`${r}.${b}.reduce`,value:P,expressionContext:"cluster-reduce"}))}}return y;case"video":return ta({key:r,value:t,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return ta({key:r,value:t,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new o.V(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Er({key:`${r}.type`,value:t.type,valueSpec:{values:Vn(u)}})}}function Vn(c){return c.source.reduce(((t,r)=>{const u=c[r];return u.type.type==="enum"&&(t=t.concat(Object.keys(u.type.values||{}))),t}),[])}function ao(c){const t=c.value,r=c.styleSpec,u=r.light,p=c.style;if(t===void 0)return[];if(!o.H(t))return[new o.V("light",t,`object expected, ${o.K(t)} found`)];let _=[];for(const y in t){const b=y.match(/^(.*)-transition$/),T=y.match(/^(.*)-use-theme$/);_=_.concat(T&&u[T[1]]?Zn({key:y,value:t[y],valueSpec:{type:"string"},style:p,styleSpec:r}):b&&u[b[1]]&&u[b[1]].transition?Zn({key:y,value:t[y],valueSpec:r.transition,style:p,styleSpec:r}):u[y]?Zn({key:y,value:t[y],valueSpec:u[y],style:p,styleSpec:r}):[new o.V(y,t[y],`unknown property "${y}"`)])}return _}function ba(c){const t=c.value;if(!t)return[];const r=c.key;if(!o.H(t))return[new o.V(r,t,`object expected, ${o.K(t)} found`)];let u=[];const p=c.styleSpec,_=p["light-3d"],y=c.style,b=c.style.lights;for(const I of["type","id"])if(!(I in t))return u=u.concat([new o.V(r,t,`missing property "${I}"`)]),u;if(!o.a0(t.type))return u=u.concat([new o.V(`${r}.type`,t.type,"string expected")]),u;if(b)for(let I=0;I<c.arrayIndex;I++){const P=o.J(t.type),z=b[I];o.J(z.type)===P&&u.push(new o.V(r,t.id,`duplicate light type "${t.type}", previously defined at line ${z.id.__line__}`))}const T=`properties_light_${t.type}`;if(!(T in p))return u=u.concat([new o.V(`${r}.type`,t,`Invalid light type ${t.type}`)]),u;const M=p[T];for(const I in t)if(I==="properties"){const P=t[I];if(!o.H(P))return u=u.concat([new o.V("properties",P,`object expected, ${o.K(P)} found`)]),u;for(const z in P){const O=z.match(/^(.*)-transition$/),B=z.match(/^(.*)-use-theme$/);u=u.concat(B&&M[B[1]]?Zn({key:I,value:P[z],valueSpec:{type:"string"},style:y,styleSpec:p}):O&&M[O[1]]&&M[O[1]].transition?Zn({key:I,value:t[I],valueSpec:p.transition,style:y,styleSpec:p}):M[z]?Zn({key:z,value:P[z],valueSpec:M[z],style:y,styleSpec:p}):[new o.a3(c.key,P[z],`unknown property "${z}"`)])}}else u=u.concat(_[I]?Zn({key:I,value:t[I],valueSpec:_[I],style:y,styleSpec:p}):[new o.a3(I,t[I],`unknown property "${I}"`)]);return u}function sl(c){const t=c.value,r=c.key,u=c.style,p=c.styleSpec,_=p.terrain;if(t==null)return[];if(!o.H(t))return[new o.V("terrain",t,`object expected, ${o.K(t)} found`)];let y=[];for(const b in t){const T=b.match(/^(.*)-transition$/),M=b.match(/^(.*)-use-theme$/);y=y.concat(M&&_[M[1]]?Zn({key:b,value:t[b],valueSpec:{type:"string"},style:u,styleSpec:p}):T&&_[T[1]]&&_[T[1]].transition?Zn({key:b,value:t[b],valueSpec:p.transition,style:u,styleSpec:p}):_[b]?Zn({key:b,value:t[b],valueSpec:_[b],style:u,styleSpec:p}):[new o.a3(b,t[b],`unknown property "${b}"`)])}if(t.source)if(o.a0(t.source)){const b=u.sources&&u.sources[t.source],T=b&&o.J(b.type);b?T!=="raster-dem"&&y.push(new o.V(`${r}.source`,t.source,`terrain cannot be used with a source of type ${T}, it only be used with a "raster-dem" source type`)):y.push(new o.V(`${r}.source`,t.source,`source "${t.source}" not found`))}else y.push(new o.V(`${r}.source`,t.source,"source must be a string"));else y.push(new o.V(r,t,'terrain is missing required property "source"'));return y}function os(c){const t=c.value,r=c.style,u=c.styleSpec,p=u.fog;if(t===void 0)return[];if(!o.H(t))return[new o.V("fog",t,`object expected, ${o.K(t)} found`)];let _=[];for(const y in t){const b=y.match(/^(.*)-transition$/),T=y.match(/^(.*)-use-theme$/);_=_.concat(T&&p[T[1]]?Zn({key:y,value:t[y],valueSpec:{type:"string"},style:r,styleSpec:u}):b&&p[b[1]]&&p[b[1]].transition?Zn({key:y,value:t[y],valueSpec:u.transition,style:r,styleSpec:u}):p[y]?Zn({key:y,value:t[y],valueSpec:p[y],style:r,styleSpec:u}):[new o.a3(y,t[y],`unknown property "${y}"`)])}return _}const ko={"*":()=>[],array:Sr,boolean:function(c){const t=c.value,r=c.key;return o.$(t)?[]:[new o.V(r,t,`boolean expected, ${o.K(t)} found`)]},number:gc,color:function({key:c,value:t}){return o.a0(t)?o.a1.parseCSSColor(t)===null?[new o.V(c,t,`color expected, "${t}" found`)]:[]:[new o.V(c,t,`color expected, ${o.K(t)} found`)]},enum:Er,filter:Bl,function:ol,layer:kl,object:ta,source:Cs,model:o.a7,light:ao,"light-3d":ba,terrain:sl,fog:os,string:Is,formatted:function(c){return Is(c).length===0?[]:Fa(c)},resolvedImage:function(c){return Is(c).length===0?[]:Fa(c)},projection:function(c){const t=c.value,r=c.styleSpec,u=r.projection,p=c.style;if(o.H(t)){let _=[];for(const y in t)_=_.concat(Zn({key:y,value:t[y],valueSpec:u[y],style:p,styleSpec:r}));return _}return o.a0(t)?[]:[new o.V("projection",t,`object or string expected, ${o.K(t)} found`)]},import:function(c){const t=c.key,{value:r,styleSpec:u}=c;if(!o.H(r))return[new o.V(t,r,"import must be an object")];const{data:p,..._}=r;Object.defineProperty(_,"__line__",{value:r.__line__,enumerable:!1});let y=ta(Object.assign({},c,{value:_,valueSpec:u.import}));return o.J(_.id)===""&&y.push(new o.V(`${c.key}.id`,_,"import id can't be an empty string")),p&&(y=y.concat(oo(p,u,{key:`${c.key}.data`}))),y},iconset:function(c){const t=c.value,r=c.key,u=c.styleSpec,p=c.style;if(!o.H(t))return[new o.V(r,t,"object expected")];if(!t.type)return[new o.V(r,t,'"type" is required')];const _=o.J(t.type);let y=[];if(y=y.concat(ta({key:r,value:t,valueSpec:u[`iconset_${_}`],style:p,styleSpec:u})),(function(b,T){return!(b!=="source"||!T.source)})(_,t)){const b=p.sources&&p.sources[t.source],T=b&&o.J(b.type);b?T!=="raster-array"&&y.push(new o.V(r,t.source,`iconset cannot be used with a source of type ${String(T)}, it only be used with a "raster-array" source type`)):y.push(new o.V(r,t.source,`source "${t.source}" not found`))}return y}};function Zn(c,t=!1){const r=c.value,u=c.valueSpec,p=c.styleSpec;if(u.expression){if(o.a4(o.J(r)))return ol(c);if(o.Q(o.S(r)))return Fa(c)}if(u.type&&ko[u.type]){const _=ko[u.type](c);return t===!0&&_.length>0&&Array.isArray(c.value)?Fa(c):_}return ta(Object.assign({},c,{valueSpec:u.type?p[u.type]:u}))}function ta(c){const t=c.key,r=c.value,u=c.valueSpec||{},p=c.objectElementValidators||{},_=c.style,y=c.styleSpec;if(!o.H(r))return[new o.V(t,r,`object expected, ${o.K(r)} found`)];let b=[];for(const T in r){const M=T.split(".")[0];let I;p[M]?I=p[M]:u[M]?I=Zn:p["*"]?I=p["*"]:u["*"]&&(I=Zn),I?b=b.concat(I({key:(t&&`${t}.`)+T,value:r[T],valueSpec:u[M]||u["*"],style:_,styleSpec:y,object:r,objectKey:T},r)):b.push(new o.a3(t,r[T],`unknown property "${T}"`))}for(const T in u){if(p[T])continue;const M=u[T];M.required&&M.default===void 0&&r[T]===void 0&&b.push(new o.V(t,r,`missing required property "${T}"`))}return b}function zs({key:c,value:t}){const r=Is({key:c,value:t});if(r.length)return r;const u=t;return u.indexOf("{fontstack}")===-1&&r.push(new o.V(c,t,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&r.push(new o.V(c,t,'"glyphs" url must include a "{range}" token')),r}function oo(c,t=o.a6,r={}){return ta({key:r.key||"",value:c,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:c,objectElementValidators:{glyphs:zs}})}function Ba(c,t=o.a6){return Te(oo(c,t))}const Nl=c=>Te(Cs(c)),gh=c=>Te(ao(c)),bd=c=>Te(ba(c)),Ul=c=>Te(sl(c)),nt=c=>Te(os(c)),ll=c=>Te((function(t){const r=t.value,u=t.style,p=t.styleSpec,_=p.snow;if(r===void 0)return[];if(!o.H(r))return[new o.V("snow",r,`object expected, ${o.K(r)} found`)];let y=[];for(const b in r){const T=b.match(/^(.*)-transition$/);y=y.concat(T&&_[T[1]]&&_[T[1]].transition?Zn({key:b,value:r[b],valueSpec:p.transition,style:u,styleSpec:p}):_[b]?Zn({key:b,value:r[b],valueSpec:_[b],style:u,styleSpec:p}):[new o.a3(b,r[b],`unknown property "${b}"`)])}return y})(c)),yu=c=>Te((function(t){const r=t.value,u=t.style,p=t.styleSpec,_=p.rain;if(r===void 0)return[];if(!o.H(r))return[new o.V("rain",r,`object expected, ${o.K(r)} found`)];let y=[];for(const b in r){const T=b.match(/^(.*)-transition$/);y=y.concat(T&&_[T[1]]&&_[T[1]].transition?Zn({key:b,value:r[b],valueSpec:p.transition,style:u,styleSpec:p}):_[b]?Zn({key:b,value:r[b],valueSpec:_[b],style:u,styleSpec:p}):[new o.a3(b,r[b],`unknown property "${b}"`)])}return y})(c)),vu=c=>Te(kl(c)),Ui=c=>Te(Bl(c)),pa=c=>Te(Ms(c)),yh=c=>Te(Wa(c)),xu=c=>Te(o.a7(c));function Te(c){return c.slice().sort(((t,r)=>t.line&&r.line?t.line-r.line:0))}function V(c,t){let r=!1;if(t&&t.length)for(const u of t)u instanceof o.a3?o.w(u.message):(c.fire(new o.y(new Error(u.message))),r=!0);return r}const G=o.a6.light;let J;class pe extends o.E{constructor(t,r="flat"){super(),this._transitionable=new o.a8(J||(J=new o.a9({anchor:new o.aa(G.anchor),position:new o.ab(G.position),color:new o.aa(G.color),intensity:new o.aa(G.intensity)}))),this.setLight(t,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r,u={}){this._validate(gh,t,u)||(this._transitionable.setTransitionOrValue(t),this.id=r)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,u){return(!u||u.validate!==!1)&&V(this,t.call(Ba,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}const fe=o.a6.terrain;let xe=class extends o.E{constructor(c,t,r,u,p){super(),this.scope=r,this._transitionable=new o.a8(new o.a9({source:new o.aa(fe.source),exaggeration:new o.aa(fe.exaggeration)}),r,u),this._transitionable.setTransitionOrValue(c,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=p}get(){return this._transitionable.serialize()}set(c,t){this._transitionable.setTransitionOrValue(c,t)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}getExaggeration(c){return this._transitioning.possiblyEvaluate(new o.ac(c,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const c=this._transitionable._values.exaggeration;if(!c)return null;const t=c.value.expression;if(!t)return null;let r=-1,u=-1,p=1;for(const _ of t.zoomStops)p=t.evaluate(new o.ac(_,{worldview:this.worldview})),p>.01?(r=_,u=-1):u=_;return p<.01&&r>0&&u>r?[r,u]:null}isZoomDependent(){const c=this._transitionable._values.exaggeration;return c!=null&&c.value!=null&&c.value.expression!=null&&c.value.expression instanceof o.ad}};const Pe=45,be=65,Ce=.05;function ct(c,t,r,u){const p=o.ah(Pe,be,r),[_,y]=et(c,u);let b=1-Math.min(1,Math.exp((t-_)/(y-_)*-6));return b*=b*b,b=Math.min(1,1.00747*b),b*p*c.alpha}function et(c,t){const r=.5/Math.tan(.5*t);return[c.range[0]+r,c.range[1]+r]}function kt(c,t,r,u,p){const _=o.af([],[t,r,u],p.mercatorFogMatrix);return ct(c,o.ag(_),p.pitch,p._fov)}function ei(c,t,r,u,p,_,y){const b=[[r,u,0],[p,u,0],[p,_,0],[r,_,0]];let T=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(const I of b){const P=o.af([],I,t),z=o.ag(P);T=Math.min(T,z),M=Math.max(M,z)}return[ct(c,T,y.pitch,y._fov),ct(c,M,y.pitch,y._fov)]}const Jt=o.a6.fog;class Gt extends o.E{constructor(t,r,u,p){super();const _=new o.a9({range:new o.aa(Jt.range),color:new o.aa(Jt.color),"color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.aa(Jt["high-color"]),"high-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.aa(Jt["space-color"]),"space-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.aa(Jt["horizon-blend"]),"star-intensity":new o.aa(Jt["star-intensity"]),"vertical-range":new o.aa(Jt["vertical-range"])});this._transitionable=new o.a8(_,u,new Map(p)),this.set(t,p),this._transitioning=this._transitionable.untransitioned(),this._transform=r,this.properties=new o.ai(_),this.scope=u}get state(){const t=this._transform,r=t.projection.name==="globe",u=o.aj(t.zoom),p=this.properties.get("range"),_=[.5,3];return{range:r?[o.ak(_[0],p[0],u),o.ak(_[1],p[1],u)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,r,u={}){if(this._validate(nt,t,u))return;const p=Object.assign({},t);for(const _ of Object.keys(Jt))p[_]===void 0&&(p[_]=Jt[_].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.ah(Pe,be,t))*r.a}getOpacityAtLatLng(t,r){return this._transform.projection.supportsFog?(function(u,p,_){const y=o.ae.fromLngLat(p),b=_.elevation?_.elevation.getAtPointOrZero(y):0;return kt(u,y.x,y.y,b,_)})(this.state,t,r):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(t.toUnwrapped());return ei(this.state,r,0,0,o.al,o.al,this._transform)}getOpacityForBounds(t,r,u,p,_){return this._transform.projection.supportsFog?ei(this.state,t,r,u,p,_,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?et(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const u of r){const p=t.points[u];let _;if(p[2]>=0)_=p;else{const y=t.points[u-4];_=o.am(y,p,y[2]/(y[2]-p[2]))}if(kt(this.state,_[0],_[1],0,this._transform)>=Ce)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,u){return(!u||u.validate!==!1)&&V(this,t.call(Ba,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}let Ei,Mi,rn,jn,Pr=class extends o.E{constructor(c,t,r,u){super();const p=Ei||(Ei=new o.a9({density:new o.aa(o.a6.snow.density),intensity:new o.aa(o.a6.snow.intensity),color:new o.aa(o.a6.snow.color),opacity:new o.aa(o.a6.snow.opacity),vignette:new o.aa(o.a6.snow.vignette),"vignette-color":new o.aa(o.a6.snow["vignette-color"]),"center-thinning":new o.aa(o.a6.snow["center-thinning"]),direction:new o.aa(o.a6.snow.direction),"flake-size":new o.aa(o.a6.snow["flake-size"])}));this._transitionable=new o.a8(p,r,new Map(u)),this.set(c,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(p),this.scope=r}get state(){const c=this.properties.get("opacity"),t=this.properties.get("color"),r=this.properties.get("direction"),u=o.an(r[0]),p=-Math.max(o.an(r[1]),.01),_=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],y=this.properties.get("vignette"),b=this.properties.get("vignette-color");return b.a=y,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(t.r,t.g,t.b,t.a*c),direction:_,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:b}}get(){return this._transitionable.serialize()}set(c,t,r={}){if(this._validate(ll,c,r))return;const u=Object.assign({},c),p=o.a6.snow;for(const _ of Object.keys(p))u[_]===void 0&&(u[_]=p[_].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,t,r){return(!r||r.validate!==!1)&&V(this,c.call(Ba,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}},wr=class extends o.E{constructor(c,t,r,u){super();const p=Mi||(Mi=new o.a9({density:new o.aa(o.a6.rain.density),intensity:new o.aa(o.a6.rain.intensity),color:new o.aa(o.a6.rain.color),opacity:new o.aa(o.a6.rain.opacity),vignette:new o.aa(o.a6.rain.vignette),"vignette-color":new o.aa(o.a6.rain["vignette-color"]),"center-thinning":new o.aa(o.a6.rain["center-thinning"]),direction:new o.aa(o.a6.rain.direction),"droplet-size":new o.aa(o.a6.rain["droplet-size"]),"distortion-strength":new o.aa(o.a6.rain["distortion-strength"])}));this._transitionable=new o.a8(p,r,new Map(u)),this.set(c,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(p),this.scope=r}get state(){const c=this.properties.get("opacity"),t=this.properties.get("color"),r=this.properties.get("direction"),u=o.an(r[0]),p=-Math.max(o.an(r[1]),.01),_=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],y=this.properties.get("vignette-color");return y.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(t.r,t.g,t.b,t.a*c),direction:_,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:y}}get(){return this._transitionable.serialize()}set(c,t,r={}){if(this._validate(yu,c,r))return;const u=Object.assign({},c),p=o.a6.rain;for(const _ of Object.keys(p))u[_]===void 0&&(u[_]=p[_].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,t,r){return(!r||r.validate!==!1)&&V(this,c.call(Ba,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}};class _r extends o.E{constructor(t,r,u,p){super(),this.scope=u,this._options=t,this.properties=new o.ai(r),this._transitionable=new o.a8(r,u,new Map(p)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,r){this._options=t,this._transitionable.setTransitionOrValue(t.properties,r)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class xn{constructor(t,r,u){this.screenBounds=t,this.cameraPoint=u.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=r,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,u)}static createFromScreenPoints(t,r){let u,p;if(t instanceof o.P||typeof t[0]=="number"){const _=o.P.convert(t);u=[_],p=r.isPointAboveHorizon(_)}else{const _=o.P.convert(t[0]),y=o.P.convert(t[1]),b=_.add(y)._div(2);u=[_,y],p=o.aq(_,y).every((T=>r.isPointAboveHorizon(T)))&&r.isPointAboveHorizon(b)}return new xn(u,p,r)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return o.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const r=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],p=o.aq(r,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<u.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?p[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(p[3]=this.cameraPoint)),o.ar(p,t)}bufferedCameraGeometryGlobe(t){const r=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],p=o.aq(r,u,t),_=this.cameraPoint.clone();switch(3*((_.y>r.y)+(_.y>u.y))+((_.x>r.x)+(_.x>u.x))){case 0:p[0]=_,p[4]=_.clone();break;case 1:p.splice(1,0,_);break;case 2:p[1]=_;break;case 3:p.splice(4,0,_);break;case 5:p.splice(2,0,_);break;case 6:p[3]=_;break;case 7:p.splice(3,0,_);break;case 8:p[2]=_}return p}containsTile(t,r,u,p=0){const _=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/r._pixelsPerMercatorPixel+1,y=u?this._bufferedCameraMercator(_,r):this._bufferedScreenMercator(_,r);let b=t.tileID.wrap+(y.unwrapped?p:0);const T=y.polygon.map((H=>o.as(t.tileTransform,H,b)));if(!o.at(T,0,0,o.al,o.al))return;b=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);const M=this.screenGeometryMercator.polygon.map((H=>o.au(t.tileTransform,H,b))),I=M.map((H=>new o.P(H[0],H[1]))),P=r.getFreeCameraOptions().position||new o.ae(0,0,0),z=o.au(t.tileTransform,P,b),O=M.map((H=>{const j=o.av(H,H,z);return o.aw(j,j),new o.ax(z,j)})),B=o.ay(t,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:I,tilespaceRays:O,bufferedTilespaceGeometry:T,bufferedTilespaceBounds:(N=o.az(T),N.min.x=o.aA(N.min.x,0,o.al),N.min.y=o.aA(N.min.y,0,o.al),N.max.x=o.aA(N.max.x,0,o.al),N.max.y=o.aA(N.max.y,0,o.al),N),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:B};var N}_bufferedScreenMercator(t,r){const u=An(t);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let p;return p=r.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),r):{polygon:this.bufferedScreenGeometry(t).map((_=>r.pointCoordinate3D(_))),unwrapped:!0},this._screenRaycastCache[u]=p,p}}_bufferedCameraMercator(t,r){const u=An(t);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let p;return p=r.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),r):{polygon:this.bufferedCameraGeometry(t).map((_=>r.pointCoordinate3D(_))),unwrapped:!0},this._cameraRaycastCache[u]=p,p}}_projectAndResample(t,r){const u=(function(_,y){const b=o.aB([],y.pixelMatrix,y.globeMatrix),T=[0,-o.aD,0,1],M=[0,o.aD,0,1],I=[0,0,0,1];o.aC(T,T,b),o.aC(M,M,b),o.aC(I,I,b);const P=new o.P(T[0]/T[3],T[1]/T[3]),z=new o.P(M[0]/M[3],M[1]/M[3]),O=o.aE(_,P)&&T[3]<I[3],B=o.aE(_,z)&&M[3]<I[3];if(!O&&!B)return null;const N=(function(ce,ie,te){for(let ue=1;ue<ce.length;ue++){const we=Rn(ie.pointCoordinate3D(ce[ue-1]).x),ve=Rn(ie.pointCoordinate3D(ce[ue]).x);if(te<0){if(we<ve)return{idx:ue,t:-we/(ve-1-we)}}else if(ve<we)return{idx:ue,t:(1-we)/(ve+1-we)}}return null})(_,y,O?-1:1);if(!N)return null;const{idx:H,t:j}=N;let Z=H>1?Oi(_.slice(0,H),y):[],K=H<_.length?Oi(_.slice(H),y):[];Z=Z.map((ce=>new o.P(Rn(ce.x),ce.y))),K=K.map((ce=>new o.P(Rn(ce.x),ce.y)));const W=[...Z];W.length===0&&W.push(K[K.length-1]);const se=o.ak(W[W.length-1].y,(K.length===0?Z[0]:K[0]).y,j);let Q;return Q=O?[new o.P(0,se),new o.P(0,0),new o.P(1,0),new o.P(1,se)]:[new o.P(1,se),new o.P(1,1),new o.P(0,1),new o.P(0,se)],W.push(...Q),K.length===0?W.push(Z[0]):W.push(...K),{polygon:W.map((ce=>new o.ae(ce.x,ce.y))),unwrapped:!1}})(t,r);if(u)return u;const p=(function(_,y){let b=!1,T=-1/0,M=0;for(let P=0;P<_.length-1;P++)_[P].x>T&&(T=_[P].x,M=P);for(let P=0;P<_.length-1;P++){const z=(M+P)%(_.length-1),O=_[z],B=_[z+1];Math.abs(O.x-B.x)>.5&&(O.x<B.x?(O.x+=1,z===0&&(_[_.length-1].x+=1)):(B.x+=1,z+1===_.length-1&&(_[0].x+=1)),b=!0)}const I=o.aF(y.center.lng);return b&&I<Math.abs(I-1)&&_.forEach((P=>{P.x-=1})),{polygon:_,unwrapped:b}})(Oi(t,r).map((_=>new o.P(Rn(_.x),_.y))),r);return{polygon:p.polygon.map((_=>new o.ae(_.x,_.y))),unwrapped:p.unwrapped}}}function Oi(c,t){return o.aG(c,(r=>{const u=t.pointCoordinate3D(r);r.x=u.x,r.y=u.y}),1/256)}function Rn(c){return c<0?1+c%1:c%1}function An(c){return 100*c|0}function qi(c,t,r,u,p){const _=function(b,T){if(b)return p(b);if(T){if(c.url&&T.tiles&&c.tiles&&delete c.tiles,T.variants){if(!Array.isArray(T.variants))return p(new Error("variants must be an array"));for(const I of T.variants){if(I==null||typeof I!="object"||I.constructor!==Object)return p(new Error("variant must be an object"));if(!Array.isArray(I.capabilities))return p(new Error("capabilities must be an array"));if(I.capabilities.length===1&&I.capabilities[0]==="meshopt"){T=Object.assign(T,I);break}}}const M=o.aH(Object.assign({},T,c),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);M.tiles=t.canonicalizeTileset(M,c.url),p(null,M)}},y=(function(b,T,M){if(!b)return null;if(!T&&!M)return b;M=M||b.worldview_default;const I=Object.values(b.language||{});if(I.length===0)return null;const P=Object.values(b.worldview||{});if(P.length===0)return null;const z=I.every((B=>B===T)),O=P.every((B=>B===M));return z&&O?b:T in(b.language_options||{})||M in(b.worldview_options||{})?null:b.language_options&&b.worldview_options?b:null})(c.data,r,u);return y?o.o.frame((()=>_(null,y))):c.url?o.m(t.transformRequest(t.normalizeSourceURL(c.url,null,r,u),o.R.Source),_):o.o.frame((()=>{const{data:b,...T}=c;_(null,T)}))}function Bn(c,t){const r=Math.pow(2,t.z),u=Math.floor(o.aF(c.getWest())*r),p=Math.floor(o.aJ(c.getNorth())*r),_=Math.ceil(o.aF(c.getEast())*r),y=Math.ceil(o.aJ(c.getSouth())*r);return t.x>=u&&t.x<_&&t.y>=p&&t.y<y}class kr{constructor(t,r,u){this.bounds=t?o.aI.convert(this.validateBounds(t)):null,this.minzoom=r||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const r of t)this.extraBounds.push(o.aI.convert(this.validateBounds(r)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!Bn(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const r of this.extraBounds)if(Bn(r,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const r=new kr(t.bounds,t.minzoom,t.maxzoom);return r.addExtraBounds(t.extra_bounds),r}}class ma extends o.E{constructor(t,r,u,p){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,o.aH(r,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new o.aK}load(t){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=qi(this._options,this.map._requestManager,r,u,((p,_)=>{if(this._tileJSONRequest=null,this._loaded=!0,p)r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),u&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new o.y(p));else if(_){if(Object.assign(this,_),this.hasWorldviews=!!_.worldview_options,_.worldview_default&&(this.worldviewDefault=_.worldview_default),_.vector_layers){this.vectorLayers=_.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const y of _.vector_layers)this.vectorLayerIds.push(y.id),_.worldview&&_.worldview[y.source]&&this.localizableLayerIds.add(y.id)}this.tileBounds=kr.fromTileJSON(_),Pt(_.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(p)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,r){const u=t.tileID.canonical.url(this.tiles,this.scheme),p=this.map._requestManager.normalizeTileURL(u),_=this.map._requestManager.transformRequest(p,o.R.Tile),y=this.map.style?this.map.style.getLut(this.scope):null,b=y?{image:y.image.clone()}:null,T={request:_,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:b,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&o.h(u)&&(T.localizableLayerIds=this.localizableLayerIds),T.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=r:t.request=t.actor.send("reloadTile",T,M.bind(this));else if(t.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",T,M.bind(this),void 0,!0);else{const I=o.aL.call({deduped:this._deduped},T,((P,z)=>{if(P||!z)M.call(this,P);else{const O=o.aM(z.responseHeaders);T.data={cacheControl:O.cacheControl,expires:O.expires,rawData:z.rawData.slice(0)},t.actor&&t.actor.send("loadTile",T,M.bind(this),void 0,!0)}}),!0);t.request={cancel:I}}function M(I,P){return delete t.request,t.aborted?r(null):I&&I.status!==404?r(I):(P&&P.resourceTiming&&(t.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&t.setExpiryData(P),t.loadVectorData(P,this.map.painter),o.aN(this.dispatcher),r(null,P),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,r){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class To extends o.E{constructor(t,r,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},r),Object.assign(this,o.aH(r,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const r=this.map.getWorldview();this._tileJSONRequest=qi(this._options,this.map._requestManager,null,r,((u,p)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new o.y(u)):p&&(Object.assign(this,p),p.raster_layers&&(this.rasterLayers=p.raster_layers,this.rasterLayerIds=this.rasterLayers.map((_=>_.id))),this.tileBounds=kr.fromTileJSON(p),Pt(p.tiles),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(u)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const u=o.o.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);t.request=o.n(this.map._requestManager.transformRequest(p,o.R.Tile),((_,y,b)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(_)return t.state="errored",r(_);if(!y)return r(null);const T=o.aM(b);this.map._refreshExpiredTiles&&t.setExpiryData(T),t.setTexture(y,this.map.painter),t.state="loaded",o.aN(this.dispatcher),r(null)}))}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r&&r()}unloadTile(t,r){t.texture&&t.texture instanceof o.T?(t.destroy(!0),t.texture&&t.texture instanceof o.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),r&&r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Rs([c,t],r,u,{scaled:p=!0}={}){const{tileSize:_,buffer:y}=u,{x:b,y:T,z:M}=r;if(!isFinite(b)||!isFinite(T)||!isFinite(M))throw new Error("Invalid MRT header");const I=2**M,P=I*o.aF(c),z=I*o.aJ(t);return(function([O,B],N,{scaled:H=!0}={}){if(!N)throw new Error("bandView is undefined");const{data:j,tileSize:Z,buffer:K,offset:W,scale:se,dimension:Q}=N;if(O<-K||O>Z+K||B<-K||B>Z+K)throw new Error(`Point (${O}, ${B}) out of bounds for tileSize=${Z}, buffer=${K}`);const ce=(B+K)*(Z+2*K)+(O+K);if(new Uint32Array(j.buffer)[ce]===4294967295)return null;let ie=[];ie=H?[]:new N.data.constructor(Q);for(let te=0;te<Q;te++)ie[te]=Math.round(1e12*(j[Q*ce+te]*se+W))/1e12;return ie})([Math.min(Math.max(-y,Math.floor((P-b)*_)),_-1+y),Math.min(Math.max(-y,Math.floor((z-T)*_)),_-1+y)],u,{scaled:p})}class Xr extends To{constructor(t,r,u,p){super(t,r,u,p),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},r)}triggerRepaint(t){const r=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);r&&r.enabled&&u&&r._clearRenderCacheForTile(u.id,t.tileID),this.map.triggerRepaint()}loadTile(t,r){const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),p=this.map._requestManager.transformRequest(u,o.R.Tile),_={request:p,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=p,t.actor||(t.actor=this.dispatcher.getActor());const y=(b,T,M)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(b)return b.name==="AbortError"?void 0:(t.state="errored",r(b));if(this.map._refreshExpiredTiles&&T){const I=o.aM(M);t.setExpiryData(I)}if(this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!T)return r(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=T}r(null)};t.request=this.partial?t.fetchHeader(void 0,y.bind(this)):t.actor.send("loadTile",_,y.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,r){const u=t.texturePerLayer;if(t.flushAllQueues(),u.size){t.destroy(!0);for(const p of u.values())this.map.painter.saveTileTexture(p)}else t.destroy()}prepareTile(t,r,u,p){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(r,u,p,((_,y)=>{if(_)return t.state="errored",this.fire(new o.y(_)),void this.triggerRepaint(t);y&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(u,y,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(t){if(!this.rasterLayers)return 0;const r=this.rasterLayers.find((({id:_})=>_===t)),u=r&&r.fields,p=u&&u.bands&&u.bands;return p?p[0]:0}getTextureDescriptor(t,r,u){if(!t)return;const p=r.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!p)return;let _=null;r instanceof o.aQ?_=r.paint.get("raster-array-band"):r instanceof o.aR&&(_=r.paint.get("raster-particle-array-band"));const y=_||this.getInitialBand(p);if(y==null)return;if(!t.textureDescriptorPerLayer.get(r.id))return void this.prepareTile(t,p,r.id,y);if(t.updateNeeded(r.id,y)&&!u)return;const b=t.textureDescriptorPerLayer.get(r.id);return Object.assign({},b,{texture:t.texturePerLayer.get(r.id)})}getImages(t,r){const u=new Map;for(const p of t)for(const _ of r){const[y,b]=_.split("/"),T=p.getLayer(y);if(!T||!T.hasBand(b)||!T.hasDataForBand(b))continue;const{bytes:M,tileSize:I,buffer:P}=T.getBandView(b),z=I+2*P,O={data:new o.q({width:z,height:z},M),pixelRatio:2,sdf:!1,usvg:!1,version:0};u.set(_,O)}return u}queryRasterArrayValueByBandId(t,r,u){const p=r._mrt;return new Promise((_=>{const y={},b=new Set;for(const[T,M]of Object.entries(p.layers)){if(u.layerName&&T!==u.layerName)continue;const I={};y[T]=I;for(const{bands:P}of M.dataIndex)for(const z of P)u.bands&&!u.bands.includes(z)||(b.add(o.B(T,z)),r.fetchBand(T,null,z,(O=>{o.o.frame((()=>{I[z]=O?null:Rs([t.lng,t.lat],p,M.getBandView(z)),b.delete(o.B(T,z)),b.size===0&&_(y)}))}),!1))}b.size===0&&_(y)}))}_loadTileForQuery(t,r){if(this._loadTileLoaded[t.uid])return void r(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(r);this._loadTilePending[t.uid]=[r];const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),p=this.map._requestManager.transformRequest(u,o.R.Tile);t.actor.send("loadTile",{request:p,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((_,y,b)=>{if(_)return this._loadTilePending[t.uid].forEach((T=>T(_,null))),void delete this._loadTilePending[t.uid];if(!y)return this._loadTilePending[t.uid].forEach((T=>T(null,null))),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&y){const T=o.aM(b);t.setExpiryData(T)}t._mrt=y,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach((T=>T(null,y))),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]}),void 0,!0)}queryRasterArrayValueByAllBands(t,r,u){return new Promise(((p,_)=>{this._loadTileForQuery(r,((y,b)=>{y?_(y):p(b?this.queryRasterArrayValueByBandId(t,r,u):null)}))}))}queryRasterArrayValue(t,r){const u=o.aS.convert(t),p=this.findLoadedParent(u);return p&&p._mrt?r.bands||!this.partial?this.queryRasterArrayValueByBandId(u,p,r):this.queryRasterArrayValueByAllBands(u,p,r):Promise.resolve(null)}findLoadedParent(t){const r=o.ae.fromLngLat(t,this.map.transform.tileSize),u=this.maxzoom+1,p=1<<u,_=Math.floor(r.x),y=Math.floor((r.x-_)*p),b=Math.floor(r.y*p),T=this.map.style.getSourceCache(this.id),M=new o.aP(u,_,u,y,b);return T.findLoadedParent(M,this.minzoom)}}const Nr={vector:ma,raster:To,"raster-dem":class extends To{constructor(c,t,r,u){super(c,t,r,u),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(c,t){const r=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(p,_){p&&(c.state="errored",t(p)),_&&(c.dem=_,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",t(null))}c.request=o.n(this.map._requestManager.transformRequest(r,o.R.Tile),(function(p,_,y){if(delete c.request,c.aborted)c.state="unloaded",t(null);else if(p)c.state="errored",t(p);else if(_){const b=o.aM(y);this.map._refreshExpiredTiles&&c.setExpiryData(b);const T=ImageBitmap&&_ instanceof ImageBitmap&&o.r(),M=1-(_.width-o.aO(_.width))/2;M<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const I=T?_:o.o.getImageData(_,M),P={uid:c.uid,tileID:c.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:I,encoding:this.encoding,padding:M};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadTile",P,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(c){const t=c.canonical,r=Math.pow(2,t.z),u=(t.x-1+r)%r,p=t.x===0?c.wrap-1:c.wrap,_=(t.x+1+r)%r,y=t.x+1===r?c.wrap+1:c.wrap,b={};return b[new o.aP(c.overscaledZ,p,t.z,u,t.y).key]={backfilled:!1},b[new o.aP(c.overscaledZ,y,t.z,_,t.y).key]={backfilled:!1},t.y>0&&(b[new o.aP(c.overscaledZ,p,t.z,u,t.y-1).key]={backfilled:!1},b[new o.aP(c.overscaledZ,c.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},b[new o.aP(c.overscaledZ,y,t.z,_,t.y-1).key]={backfilled:!1}),t.y+1<r&&(b[new o.aP(c.overscaledZ,p,t.z,u,t.y+1).key]={backfilled:!1},b[new o.aP(c.overscaledZ,c.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},b[new o.aP(c.overscaledZ,y,t.z,_,t.y+1).key]={backfilled:!1}),b}},"raster-array":Xr,geojson:class extends o.E{constructor(c,t,r,u){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(u),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const p=o.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*p,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*p,extent:o.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:o.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*p,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}updateData(c){if(!this._options.dynamic)return this.fire(new o.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof c!="string"&&(c.type==="Feature"&&(c={type:"FeatureCollection",features:[c]}),c.type!=="FeatureCollection"))return this.fire(new o.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof c!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const r of this._data.features)t.set(r.id,r);for(const r of c.features)t.set(r.id,r);this._data.features=[...t.values()]}else this._data=c;return this._updateWorkerData(!0),this}getClusterExpansionZoom(c,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterChildren(c,t){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterLeaves(c,t,r,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:c,limit:t,offset:r},u),this}_updateWorkerData(c=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:c},this.workerOptions);t.scope=this.scope;const r=this._data;typeof r=="string"?(t.request=this.map._requestManager.transformRequest(o.o.resolveURL(r),o.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((u,p)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new o.y(u));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),c&&(this._partialReload=!0),this.fire(new o.z("data",_)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(c),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const c=o.B(this.id,this.scope);this.map.style.clearSource(c),this._updateWorkerData()}loadTile(c,t){const r=c.actor?"reloadTile":"loadTile";c.actor=this.actor;const u=this.map.style?this.map.style.getLut(this.scope):null,p=u?{image:u.image.clone()}:null,_=this._partialReload,y={type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:p,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:c.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:_,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};c.request=this.actor.send(r,y,((b,T)=>_&&!T?(c.state="loaded",t(null)):(delete c.request,c.destroy(),c.aborted?t(null):b?t(b):(c.loadVectorData(T,this.map.painter,r==="reloadTile"),t(null)))),void 0,r==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c,t){this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}onRemove(c){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aT{constructor(c,t,r,u){super(c,t,r,u),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const t of c.urls)this.urls.push(this.map._requestManager.transformRequest(t,o.R.Source).url);o.aU(this.urls,((t,r)=>{this._loaded=!0,t?this.fire(new o.y(t)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const t=this.video.seekable;c<t.start(0)||c>t.end(0)?this.fire(new o.y(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,t=c.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(c,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aT,model:o.aW,"batched-model":class extends o.E{constructor(c,t,r,u){super(),this.type="batched-model",this.id=c,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=o.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(c)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(c){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map.getWorldview();this._tileJSONRequest=qi(this._options,this.map._requestManager,t,r,((u,p)=>{this._tileJSONRequest=null,this._loaded=!0,u?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),r&&r.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new o.y(u))):p&&(Object.assign(this,p),p.bounds&&(this.tileBounds=new kr(p.bounds,this.minzoom,this.maxzoom)),Pt(p.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),c&&c(u)}))}hasTransition(){return!1}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loaded(){return this._loaded}loadTile(c,t){const r=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(r,o.R.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.o.devicePixelRatio,promoteId:this.promoteId};if(c.actor&&c.state!=="expired")if(c.state==="loading")c.reloadCallback=t;else{if(c.buckets){const _=Object.values(c.buckets);for(const y of _)y.dirty=!0;return void(c.state="loaded")}c.request=c.actor.send("reloadTile",u,p.bind(this))}else c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",u,p.bind(this),void 0,!0);function p(_,y){return c.aborted?t(null):_&&_.status!==404?t(_):(this.map._refreshExpiredTiles&&y&&c.setExpiryData(y),c.loadModelData(y,this.map.painter),c.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends o.aT{constructor(c,t,r,u){super(c,t,r,u),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some((p=>!Array.isArray(p)||p.length!==2||p.some((_=>typeof _!="number"))))||this.fire(new o.y(new o.V(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.y(new o.V(`sources.${c}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new o.y(new o.V(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new o.y(new o.V(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.y(new o.V(`sources.${c}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(c){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!c&&!this._playing||this.texture instanceof o.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends o.E{constructor(c,t,r,u){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=t,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new kr(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,o.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this.map=c,this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:t,y:r,z:u}=c.canonical;return this._implementation.hasTile({x:t,y:r,z:u})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,t){const{x:r,y:u,z:p}=c.tileID.canonical,_=new AbortController;c.request=Promise.resolve(this._implementation.loadTile({x:r,y:u,z:p},{signal:_.signal})).then((function(y){return delete c.request,c.aborted?(c.state="unloaded",t(null)):y===void 0?(c.state="errored",t(null)):y===null?(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",t(null)):(function(b){return b instanceof ImageData||b instanceof HTMLCanvasElement||b instanceof ImageBitmap||b instanceof HTMLImageElement})(y)?(this.loadTileData(c,y),c.state="loaded",void t(null)):(c.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((y=>{y.name!=="AbortError"&&(c.state="errored",t(y))})),c.request.cancel=()=>_.abort()}loadTileData(c,t){c.setTexture(t,this.map.painter)}unloadTile(c,t){if(c.texture&&c.texture instanceof o.T?(c.destroy(!0),c.texture&&c.texture instanceof o.T&&this.map.painter.saveTileTexture(c.texture)):c.destroy(),this._implementation.unloadTile){const{x:r,y:u,z:p}=c.tileID.canonical;this._implementation.unloadTile({x:r,y:u,z:p})}t&&t()}abortTile(c,t){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z})))}_clearTiles(){const c=o.B(this.id,this.scope);this.map.style.clearSource(c)}_update(){this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}}},wa=function(c,t,r,u){const p=new Nr[t.type](c,t,r,u);if(p.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${p.id}`);return o.aX(["load","abort","unload","serialize","prepare"],p),p};function No(c,t,r=""){return`${r}:${t.id||""}:${t.layer.id}:${(function(u){if("layerId"in u)return`layer:${u.layerId}`;{const{featuresetId:p,importId:_}=u;return`featureset:${p}${_?`:import:${_}`:""}`}})(c.target)}`}function ka(c,t,r,u=""){if(c.uniqueFeatureID){const p=No(c,t,u);if(r.has(p))return!0;r.add(p)}return!1}function _a(c,t,r,u,p=!1){const _=t.sourceCache.transform,y=t.sourceCache.tilesIn(c,t.has3DLayers,p);y.sort(Ds);const b=[];for(const T of y){const M=T.tile.queryRenderedFeatures(t,T,r,u,_,p);Object.keys(M).length&&b.push({wrappedTileID:T.tile.tileID.wrapped().key,queryResults:M})}for(const T in t.layers){const M=t.layers[T];if(M.styleLayer){const I=M.styleLayer.queryRenderedFeatures(c,t.sourceCache,u);Object.keys(I).length&&b.push({wrappedTileID:0,queryResults:I})}}return b.length===0?{}:(function(T){const M={},I={};for(const P of T){const z=P.queryResults,O=P.wrappedTileID,B=I[O]=I[O]||{};for(const N in z){const H=z[N],j=B[N]=B[N]||{},Z=M[N]=M[N]||[];for(const K of H)j[K.featureIndex]||(j[K.featureIndex]=!0,Z.push(K))}}return M})(b)}function vh(c,t,r,u,p,_){const y={},b=u.queryRenderedSymbols(c),T=[];for(const M of Object.keys(b).map(Number))T.push(p[M]);T.sort(Ds);for(const M of T){const I=M.featureIndex.lookupSymbolFeatures(b[M.bucketInstanceId],M.bucketIndex,M.sourceLayerIndex,t,r,_);for(const P in I){const z=y[P]=y[P]||[],O=I[P];O.sort(((B,N)=>{const H=M.featureSortOrder;if(H){const j=H.indexOf(B.featureIndex);return H.indexOf(N.featureIndex)-j}return N.featureIndex-B.featureIndex}));for(const B of O)z.push(B)}}return y}function bu(c,t){const r=c.getRenderableIds().map((_=>c.getTileByID(_))),u=[],p={};for(let _=0;_<r.length;_++){const y=r[_],b=y.tileID.canonical.key;p[b]||(p[b]=!0,y.querySourceFeatures(u,t))}return u}function Ds(c,t){const r=c.tileID,u=t.tileID;return r.overscaledZ-u.overscaledZ||r.canonical.y-u.canonical.y||r.wrap-u.wrap||r.canonical.x-u.canonical.x}function xh(c,t){const r={};if(!t)return r;for(const u of c){const p=u.layerIds.map((_=>t.getLayer(_))).filter(Boolean);if(p.length!==0){u.layers=p,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map((_=>p.filter((y=>y.id===_))[0])));for(const _ of p)r[_.fqid]=u}}return r}const Na=32,Uo=33,Ta=new Uint16Array(8184);for(let c=0;c<2046;c++){let t=c+2,r=0,u=0,p=0,_=0,y=0,b=0;for(1&t?p=_=y=Na:r=u=b=Na;(t>>=1)>1;){const M=r+p>>1,I=u+_>>1;1&t?(p=r,_=u,r=y,u=b):(r=p,u=_,p=y,_=b),y=M,b=I}const T=4*c;Ta[T+0]=r,Ta[T+1]=u,Ta[T+2]=p,Ta[T+3]=_}const So=new Uint16Array(2178),cl=new Uint8Array(1089),Ps=new Uint16Array(1089);function Vo(c){return c===0?-.03125:c===32?.03125:0}const wu={type:2,extent:o.al,loadGeometry:()=>[[new o.P(0,0),new o.P(o.al+1,0),new o.P(o.al+1,o.al+1),new o.P(0,o.al+1),new o.P(0,0)]]};class jo{constructor(t,r,u,p,_,y){this.tileID=t,this.uid=o.b1(),this.uses=0,this.tileSize=r,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,p&&p.style&&(this._lastUpdatedBrightness=p.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection),this.worldview=y,this._hasAppearances=null}registerFadeDuration(t){const r=t+this.timeAdded;r<o.o.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,u){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=xh(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof o.b3){if(this.hasSymbolBuckets=!0,!u)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof o.b3&&_.hasRTLText){this.hasRTLText=!0,o.b4();break}}this.queryPadding=0;for(const p in this.buckets){const _=this.buckets[p],y=r.style.getOwnLayer(p);if(!y)continue;const b=y.queryRadius(_);this.queryPadding=Math.max(this.queryPadding,b)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new o.b2}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,r,u){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,xh(t.buckets,r.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t,r){for(const _ in this.buckets){const y=this.buckets[_];if(y.uploadPending()){let b={},T=[],M={zoom:0,pitch:0,brightness:0,worldview:""};if(r){if(r.style){T=r.style.listImages();const I=y.layers[0],P=I.sourceLayer||"_geojsonTileLayer",z=r.style.getLayerSourceCache(I);z&&(b=z._state.getState(P,void 0))}M={zoom:r.transform.zoom||0,pitch:r.transform.pitch||0,brightness:r.style.getBrightness()||0,worldview:r.worldview||""}}y.upload(t,this.tileID.canonical,b,T,M)}}const u=t.gl,p=this.imageAtlas;p&&!p.uploaded&&(this.imageAtlasTexture=new o.T(t,p.image,u.RGBA8,{useMipmap:!!p.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(t,this.glyphAtlasImage,u.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(t,this.lineAtlas.image,u.R8),this.lineAtlas.uploaded=!0)}prepare(t,r,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,u),!r||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const p=r.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(r)),(this._lastUpdatedBrightness||p||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&p&&Math.abs(this._lastUpdatedBrightness-p)<.001||(this.updateBuckets(r,this._lastUpdatedBrightness!==p),this._lastUpdatedBrightness=p))}evaluateQueryRenderedFeaturePadding(){let t=0;for(const r in this.buckets){const u=this.buckets[r];u.evaluateQueryRenderedFeaturePadding&&(t=Math.max(t,u.evaluateQueryRenderedFeaturePadding()))}return t}queryRenderedFeatures(t,r,u,p,_,y){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const b=this.evaluateQueryRenderedFeaturePadding(),T=(function(M,I){const P=o.bp([],[.5*M.width,.5*-M.height,1]);return o.bq(P,P,[1,-1,0]),o.aB(P,P,M.calculateProjMatrix(I.toUnwrapped())),Float32Array.from(P)})(_,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:r,pixelPosMatrix:T,transform:p,availableImages:u,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:b})}querySourceFeatures(t,r){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),_=r?r.sourceLayer:"",y=p._geojsonTileLayer||p[_];if(!y)return;const b=o.b5(r&&r.filter),{z:T,x:M,y:I}=this.tileID.canonical,P={z:T,x:M,y:I};for(let z=0;z<y.length;z++){const O=y.feature(z);if(b.needGeometry){const H=o.b6(O,!0);if(!b.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),H,this.tileID.canonical))continue}else if(!b.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),O))continue;const B=u.getId(O,_),N=new o.b7(O,T,M,I,B);N.tile=P,t.push(N)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const u=o.b8(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(r)if(this.expirationTime<r)p=!0;else{const _=this.expirationTime-r;_?this.expirationTime=u+Math.max(_,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}hasAppearances(t){for(const r in this.buckets)if(t.style.hasLayer(r)&&this.buckets[r].layers.some((u=>u.appearances&&u.appearances.length>0)))return!0;return!1}updateBuckets(t,r){if(!this.latestFeatureIndex||!t.style)return;const u=this.latestFeatureIndex.loadVTLayers(),p=t.style.listImages(),_=t.style.getBrightness();for(const y in this.buckets){if(!t.style.hasLayer(y))continue;const b=this.buckets[y],T=b.layers[0],M=T.sourceLayer||"_geojsonTileLayer",I=u[M],P=t.style.getLayerSourceCache(T);let z={};P&&(z=P._state.getState(M,void 0));const O=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},B=Object.keys(z).length>0&&!r;if(b.hasAppearances=b.layers.some((H=>H.appearances&&H.appearances.length>0)),(B&&b.stateDependentLayers.length!==0||r)&&b.update(z,I,p,O,B?b.stateDependentLayers:b.layers,r,_),B&&b.stateDependentLayers.length!==0||r||b.hasAppearances){const H={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};b.updateAppearances(this.tileID.canonical,z,p,H)}(b instanceof o.b9||b instanceof o.ba)&&t._terrain&&t._terrain.enabled&&P&&b.uploadPending()&&t._terrain._clearRenderCacheForTile(P.id,this.tileID);const N=t&&t.style&&t.style.getOwnLayer(y);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.o.now()+t}setTexture(t,r){const u=r.context,p=u.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof o.T?this.texture.update(t):(this.texture=new o.T(u,t,p.RGBA8,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(t,r){const u={};for(const p of r)u[p]=!0;this.dependencies[t]=u}hasDependency(t,r){for(const u of t){const p=this.dependencies[u];if(p){for(const _ of r)if(p[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const u=o.bb(wu,this.tileID.canonical,this.tileTransform)[0],p=new o.bc,_=new o.bd;for(let y=0;y<u.length;y++){const{x:b,y:T}=u[y];p.emplaceBack(b,T),_.emplaceBack(y)}_.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(_),this._tileDebugBuffer=t.createVertexBuffer(p,o.be.members),this._tileDebugSegments=o.bf.simpleSegment(0,0,p.length,_.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const u=o.bb(wu,this.tileID.canonical,this.tileTransform)[0];let p,_;if(this.isRaster){const y=(function(b,T){const M=o.aY(b,T),I=Math.pow(2,b.z);for(let H=0;H<Uo;H++)for(let j=0;j<Uo;j++){const Z=o.aZ((b.x+(j+Vo(j))/Na)/I),K=o.a_((b.y+(H+Vo(H))/Na)/I),W=T.project(Z,K),se=H*Uo+j;So[2*se+0]=Math.round((W.x*M.scale-M.x)*o.al),So[2*se+1]=Math.round((W.y*M.scale-M.y)*o.al)}cl.fill(0),Ps.fill(0);for(let H=2045;H>=0;H--){const j=4*H,Z=Ta[j+0],K=Ta[j+1],W=Ta[j+2],se=Ta[j+3],Q=Z+W>>1,ce=K+se>>1,ie=Q+ce-K,te=ce+Z-Q,ue=K*Uo+Z,we=se*Uo+W,ve=ce*Uo+Q,Oe=Math.hypot((So[2*ue+0]+So[2*we+0])/2-So[2*ve+0],(So[2*ue+1]+So[2*we+1])/2-So[2*ve+1])>=16;cl[ve]=cl[ve]||(Oe?1:0),H<1022&&(cl[ve]=cl[ve]||cl[(K+te>>1)*Uo+(Z+ie>>1)]||cl[(se+te>>1)*Uo+(W+ie>>1)])}const P=new o.a$,z=new o.b0;let O=0;function B(H,j){const Z=j*Uo+H;return Ps[Z]===0&&(P.emplaceBack(So[2*Z+0],So[2*Z+1],H*o.al/Na,j*o.al/Na),Ps[Z]=++O),Ps[Z]-1}function N(H,j,Z,K,W,se){const Q=H+Z>>1,ce=j+K>>1;if(Math.abs(H-W)+Math.abs(j-se)>1&&cl[ce*Uo+Q])N(W,se,H,j,Q,ce),N(Z,K,W,se,Q,ce);else{const ie=B(H,j),te=B(Z,K),ue=B(W,se);z.emplaceBack(ie,te,ue)}}return N(0,0,Na,Na,Na,0),N(Na,Na,0,0,0,Na),{vertices:P,indices:z}})(this.tileID.canonical,r);p=y.vertices,_=y.indices}else{p=new o.a$,_=new o.b0;for(const{x:b,y:T}of u)p.emplaceBack(b,T,0,0);const y=o.bg(p.int16.subarray(0,4*p.length),void 0,4);for(let b=0;b<y.length;b+=3)_.emplaceBack(y[b],y[b+1],y[b+2])}this._tileBoundsBuffer=t.createVertexBuffer(p,o.bh.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(_),this._tileBoundsSegments=o.bf.simpleSegment(0,0,p.length,_.length)}_makeGlobeTileDebugBuffers(t,r){const u=r.projection;if(!u||u.name!=="globe"||r.freezeTileCoverage)return;const p=this.tileID.canonical,_=o.bi(p,r),y=o.bj(_),b=o.aj(r.zoom);let T;b>0&&(T=o.bk(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,p,r,y,T,b),this._makeGlobeTileDebugTextBuffer(t,p,r,y,T,b)}_globePoint(t,r,u,p,_,y,b){let T=o.bl(t,r,u);if(y){const M=1<<u.z,I=o.aF(p.center.lng),P=o.aJ(p.center.lat),z=(u.x+.5)/M-I;let O=0;z>.5?O=-1:z<-.5&&(O=1);let B=(t/o.al+u.x)/M+O,N=(r/o.al+u.y)/M;B=(B-I)*p._pixelsPerMercatorPixel+I,N=(N-P)*p._pixelsPerMercatorPixel+P;const H=[B*p.worldSize,N*p.worldSize,0];o.af(H,H,y),T=o.bm(T,H,b)}return o.af(T,T,_)}_makeGlobeTileDebugBorderBuffer(t,r,u,p,_,y){const b=new o.bc,T=new o.bd,M=new o.bn,I=(z,O,B,N,H)=>{const j=(B-z)/(H-1),Z=(N-O)/(H-1),K=b.length;for(let W=0;W<H;W++){const se=z+W*j,Q=O+W*Z;b.emplaceBack(se,Q);const ce=this._globePoint(se,Q,r,u,p,_,y);M.emplaceBack(ce[0],ce[1],ce[2]),T.emplaceBack(K+W)}},P=o.al;I(0,0,P,0,16),I(P,0,P,P,16),I(P,P,0,P,16),I(0,P,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(T),this._tileDebugBuffer=t.createVertexBuffer(b,o.be.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(M,o.bo.members),this._tileDebugSegments=o.bf.simpleSegment(0,0,b.length,T.length)}_makeGlobeTileDebugTextBuffer(t,r,u,p,_,y){const b=o.al/4,T=new o.bc,M=new o.b0,I=new o.bn,P=25;M.reserve(32),T.reserve(P),I.reserve(P);const z=(O,B)=>P*O+B;for(let O=0;O<P;O++){const B=O*b;for(let N=0;N<P;N++){const H=N*b;T.emplaceBack(H,B);const j=this._globePoint(H,B,r,u,p,_,y);I.emplaceBack(j[0],j[1],j[2])}}for(let O=0;O<4;O++)for(let B=0;B<4;B++){const N=z(O,B),H=z(O,B+1),j=z(O+1,B),Z=z(O+1,B+1);M.emplaceBack(N,H,j),M.emplaceBack(j,H,Z)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(M),this._tileDebugTextBuffer=t.createVertexBuffer(T,o.be.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(I,o.bo.members),this._tileDebugTextSegments=o.bf.simpleSegment(0,0,P,32)}destroy(t=!1){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.br.setPbf(o.bs);class Eo extends jo{constructor(t,r,u,p,_){super(t,r,u,p,_),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,r,u){const p=u.context,_=p.gl;let y=this.texturePerLayer.get(t)||u.getTileTexture(r.width);y&&y instanceof o.T?y.update(r,{premultiply:!1}):y=new o.T(p,r,_.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,y)}flushQueues(t){const r=this._workQueuePerLayer.get(t)||[],u=this._fetchQueuePerLayer.get(t)||[];for(;r.length;)r.pop()();for(;u.length;)u.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const r=this._workQueuePerLayer.get(t)||[];for(;r.length;)r.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const r=this._fetchQueuePerLayer.get(t)||[];for(;r.length;)r.pop()()}}fetchHeader(t=16384,r){const u=this._mrt=new o.br(30),p=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=o.bt(p,((_,y,b)=>{if(_)r(_);else try{const T=u.getHeaderLength(y);if(T>t)return void(this.request=this.fetchHeader(T,r));u.parseHeader(y),this._isHeaderLoaded=!0;let M=0;for(const I of Object.values(u.layers))M=Math.max(M,I.dataIndex[I.dataIndex.length-1].lastByte);y.byteLength>=M&&(this.entireBuffer=y),r(null,this.entireBuffer||y,b)}catch(T){r(T)}})),this.request}fetchBandForRender(t,r,u,p){this.fetchBand(t,r,u,(_=>{if(_)return void p(_);this.updateTextureDescriptor(t,r,u);const y=this.textureDescriptorPerLayer.get(r);p(null,y?y.img:null)}))}fetchBand(t,r,u,p,_=!0){const y=this._mrt;if(!this._isHeaderLoaded||!y)return void p(new Error("Tile header is not ready"));const b=this.actor;if(!b)return void p(new Error("Can't fetch tile band without an actor"));let T;const M=o.B(String(u),o.B(this.tileID.key,t));let I=this._taskQueue.get(M);I?I.add(p):(I=new Set,I.add(p),this._taskQueue.set(M,I));const P=(N,H)=>{T.complete(N,H),N?p(N):(I.values().forEach((j=>j(null,H))),this._taskQueue.delete(M))},z=(N,H)=>{if(N)return p(N);const j=b.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:H,task:T},P,void 0,!0);if(r!==null){const Z=this._workQueuePerLayer.get(r)||[];Z.push((()=>{j&&j.cancel(),T.cancel()})),this._workQueuePerLayer.has(r)||this._workQueuePerLayer.set(r,Z)}};let O;try{O=y.getLayer(t)}catch(N){if(this.state==="reloading")return;throw N}if(!O)return void p(new Error(`Unknown sourceLayer "${t}"`));if(O.hasDataForBand(u))return I.values().forEach((N=>N(null,null))),void this._taskQueue.delete(M);const B=O.getDataRange([u]);if(T=y.createDecodingTask(B),!T||T.tasks.length)if(r!==null&&this.flushQueues(r),this.entireBuffer)z(null,this.entireBuffer.slice(B.firstByte,B.lastByte+1));else{const N=Object.assign({},this.requestParams,{headers:{Range:`bytes=${B.firstByte}-${B.lastByte}`}}),H=o.bt(N,z);if(r!==null){const j=this._fetchQueuePerLayer.get(r)||[];j.push((()=>{H.cancel(),T.cancel()})),this._fetchQueuePerLayer.has(r)||this._fetchQueuePerLayer.set(r,j)}}}updateNeeded(t,r){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==r||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,r,u){if(!this._mrt)return;const p=this._mrt.getLayer(t);if(!p||!p.hasBand(u)||!p.hasDataForBand(u))return;const{bytes:_,tileSize:y,buffer:b,offset:T,scale:M}=p.getBandView(u),I=y+2*b,P=new o.q({width:I,height:I},_),z=this.texturePerLayer.get(r);z&&z instanceof o.T&&z.update(P,{premultiply:!1}),this.textureDescriptorPerLayer.set(r,{layer:t,band:u,img:P,buffer:b,offset:T,tileSize:y,format:p.pixelFormat,mix:[M,256*M,65536*M,16777216*M]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const r of this.texturePerLayer.values())r&&r instanceof o.T&&r.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Vl{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,u){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const _={value:r,timeout:void 0};if(u!==void 0&&(_.timeout=setTimeout((()=>{this.remove(t,_)}),u)),this.data[p].push(_),this.order.push(p),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const u=t.wrapped().key,p=r===void 0?0:this.data[u].indexOf(r),_=this.data[u][p];return this.data[u].splice(p,1),_.timeout&&clearTimeout(_.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(_.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const u in this.data)for(const p of this.data[u])t(p.value)||r.push(p);for(const u of r)this.remove(u.value.tileID,u)}}class Of{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,u){const p=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},Object.assign(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==p&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const _ in this.state[t][p])u[_]||(this.deletedStates[t][p][_]=null)}else for(const _ in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][_]===null&&delete this.deletedStates[t][p][_]}removeFeatureState(t,r,u){if(this.deletedStates[t]===null)return;const p=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&r!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,r){const u=this.state[t]||{},p=this.stateChanges[t]||{},_=this.deletedStates[t];if(_===null)return{};if(r!==void 0){const b=String(r),T=Object.assign({},u[b],p[b]);if(_){const M=_[r];if(M===null)return{};for(const I in M)delete T[I]}return T}const y=Object.assign({},u,p);if(_)for(const b in _)delete y[b];return y}initializeTileState(t,r){t.refreshFeatureState(r)}coalesceChanges(t,r){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const _={};for(const y in this.stateChanges[p])this.state[p][y]||(this.state[p][y]={}),Object.assign(this.state[p][y],this.stateChanges[p][y]),_[y]=this.state[p][y];u[p]=_}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const _={};if(this.deletedStates[p]===null)for(const y in this.state[p])_[y]={},this.state[p][y]={};else for(const y in this.deletedStates[p]){if(this.deletedStates[p][y]===null)this.state[p][y]={};else if(this.state[p][y])for(const b of Object.keys(this.deletedStates[p][y]))delete this.state[p][y][b];_[y]=this.state[p][y]}u[p]=u[p]||{},Object.assign(u[p],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const p in t)t[p].refreshFeatureState(r)}}class so extends o.E{constructor(t,r,u){super(),this.id=t,this._onlySymbols=u,r.on("data",(p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),r.on("error",(()=>{this._sourceErrored=!0})),this._source=r,this._tiles={},this._cache=new Vl(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Of,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,r){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const u=this._tiles[r];u.upload(t,this.map?this.map.painter:void 0),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(wd).map((t=>t.key))}getRenderableIds(t,r){const u=[];for(const p in this._tiles)this._isIdRenderable(+p,t,r)&&u.push(this._tiles[p]);return t?u.sort(((p,_)=>{const y=p.tileID,b=_.tileID,T=new o.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),M=new o.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-b.overscaledZ||M.y-T.y||M.x-T.x})).map((p=>p.tileID.key)):u.map((p=>p.tileID)).sort(wd).map((p=>p.key))}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r,u){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())&&(u||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,r){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=r),this._loadTile(u,this._tileLoaded.bind(this,u,t,r)))}_tileLoaded(t,r,u,p,_){if(p){if(t.state="errored",p.status!==404)this._source.fire(new o.y(p,{tile:t}));else{if(this._source.fire(new o.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=o.o.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let y=new Map;_&&_.responseHeaders&&(y=_.responseHeaders),this._source.fire(new o.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:y}))}_backfillDEM(t){const r=this.getRenderableIds();for(let p=0;p<r.length;p++){const _=r[p];if(t.neighboringTiles&&t.neighboringTiles[_]){const y=this.getTileByID(_);u(t,y),u(y,t)}}function u(p,_){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let y=_.tileID.canonical.x-p.tileID.canonical.x;const b=_.tileID.canonical.y-p.tileID.canonical.y,T=Math.pow(2,p.tileID.canonical.z),M=_.tileID.key;y===0&&b===0||Math.abs(b)>1||(Math.abs(y)>1&&(Math.abs(y+T)===1?y+=T:Math.abs(y-T)===1&&(y-=T)),_.dem&&p.dem&&(p.dem.backfillBorder(_.dem,y,b),p.neighboringTiles&&p.neighboringTiles[M]&&(p.neighboringTiles[M].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,u,p){for(const _ in this._tiles){let y=this._tiles[_];if(p[_]||!y.hasData()||y.tileID.overscaledZ<=r||y.tileID.overscaledZ>u)continue;let b=y.tileID;for(;y&&y.tileID.overscaledZ>r+1;){const M=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[M.key],y&&y.hasData()&&(b=M)}let T=b;for(;T.overscaledZ>r;)if(T=T.scaledTo(T.overscaledZ-1),t[T.key]){p[b.key]=b;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=r?u:null}for(let u=t.overscaledZ-1;u>=r;u--){const p=t.scaledTo(u),_=this._getLoadedTile(p);if(_)return _}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,r){r=r||this._source.tileSize;const u=Math.ceil(t.width/r)+1,p=Math.ceil(t.height/r)+1,_=Math.floor(u*p*5),y=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(b)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const u={};for(const p in this._tiles){const _=this._tiles[p];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+r),u[_.tileID.key]=_}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(t,r,u,p,_){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(t,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const y=this._source.type==="batched-model";let b,T=this._source.maxzoom;const M=this.map&&this.map.painter?this.map.painter._terrain:null;if(M&&M.sourceCache===this&&M.attenuationRange()){const z=M.attenuationRange()[0],O=Math.floor(z)-Math.log2(M.getDemUpscale());T>O&&(T=O)}if(this.used||this.usedForTerrain){if(this._source.tileID)b=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((z=>new o.aP(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y)));else if(this.tileCoverLift!==0){const z=t.clone();z.tileCoverLift=this.tileCoverLift,b=z.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:T,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:y}),this._source.minzoom<=1&&t.projection.name==="globe"&&(b.push(new o.aP(1,0,1,0,0)),b.push(new o.aP(1,0,1,1,0)),b.push(new o.aP(1,0,1,0,1)),b.push(new o.aP(1,0,1,1,1)))}else if(b=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:T,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:y}),this._source.hasTile){const z=this._source.hasTile.bind(this._source);b=b.filter((O=>z(O)))}}else b=[];if(b.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ss(this._source.type)){const z=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),O=Math.min(z,this._source.maxzoom);if(y){const B=t.extendTileCover(b,O);for(const N of B)b.push(N)}else if(_){const B=t.extendTileCoverToNearPlane(b,this.transform.getFrustum(O),O);for(const N of B)b.push(N)}else if(this.castsShadows&&p){const B=t.extendTileCover(b,O,p);for(const N of B)this._shadowCasterTiles[N.key]=!0,b.push(N)}}const I=this._updateRetainedTiles(b);if(ss(this._source.type)&&b.length!==0){const z={},O={},B=Object.keys(I);for(const H of B){const j=I[H],Z=this._tiles[H];if(!Z||Z.fadeEndTime&&Z.fadeEndTime<=o.o.now())continue;const K=this.findLoadedParent(j,Math.max(j.overscaledZ-so.maxOverzooming,this._source.minzoom));K&&(this._addTile(K.tileID),z[K.tileID.key]=K.tileID),O[H]=j}const N=b[b.length-1].overscaledZ;for(const H in this._tiles){const j=this._tiles[H];if(I[H]||!j.hasData())continue;let Z=j.tileID;for(;Z.overscaledZ>N;){Z=Z.scaledTo(Z.overscaledZ-1);const K=this._tiles[Z.key];if(K&&K.hasData()&&O[Z.key]){I[H]=j.tileID;break}}}for(const H in z)I[H]||(this._coveredTiles[H]=!0,I[H]=z[H])}for(const z in I)this._tiles[z].clearFadeHold();const P=o.bu(this._tiles,I);for(const z of P){const O=this._tiles[z];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(+z)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const r={};if(t.length===0)return r;const u={},p=t.reduce(((M,I)=>Math.min(M,I.overscaledZ)),1/0),_=t[0].overscaledZ,y=Math.max(_-so.maxOverzooming,this._source.minzoom),b=Math.max(_+so.maxUnderzooming,this._source.minzoom),T={};for(const M of t){const I=this._addTile(M);r[M.key]=M,I.hasData()||p<this._source.maxzoom&&(T[M.key]=M)}this._retainLoadedChildren(T,p,b,r);for(const M of t){let I=this._tiles[M.key];if(I.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const z=M.children(this._source.maxzoom)[0],O=this.getTile(z);if(O&&O.hasData()){r[z.key]=z;continue}}else{const z=M.children(this._source.maxzoom);if(r[z[0].key]&&r[z[1].key]&&r[z[2].key]&&r[z[3].key])continue}let P=I.wasRequested();for(let z=M.overscaledZ-1;z>=y;--z){const O=M.scaledTo(z);if(u[O.key]||(u[O.key]=!0,I=this.getTile(O),!I&&P&&(I=this._addTile(O)),I&&(r[O.key]=O,P=I.wasRequested(),I.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let u,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}r.push(p.key);const _=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(_),u)break;p=_}for(const _ of r)this._loadedParentTiles[_]=u}}_addTile(t){let r=this._tiles[t.key];if(r)return r.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const u=!!r;if(!u){const p=this.map?this.map.painter:null,_=this._source.tileSize*t.overscaleFactor();r=this._source.type==="raster-array"?new Eo(t,_,this.transform.tileZoom,p,this._isRaster):new jo(t,_,this.transform.tileZoom,p,this._isRaster,this._source.worldview),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r.uses++,this._tiles[t.key]=r,u||this._source.fire(new o.z("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=r.getExpiryTimeout();u&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),u))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"||r.state==="empty"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,u){const p=[],_=this.transform;if(!_)return p;const y=_.projection.name==="globe",b=o.aF(_.center.lng);for(const T in this._tiles){const M=this._tiles[T];if(u&&M.clearQueryDebugViz(),M.holdingForFade())continue;let I;if(y){const P=M.tileID.canonical;if(P.z===0){const z=[Math.abs(o.aA(b,...Ya(P,-1))-b),Math.abs(o.aA(b,...Ya(P,1))-b)];I=[0,2*z.indexOf(Math.min(...z))-1]}else{const z=[Math.abs(o.aA(b,...Ya(P,-1))-b),Math.abs(o.aA(b,...Ya(P,0))-b),Math.abs(o.aA(b,...Ya(P,1))-b)];I=[z.indexOf(Math.min(...z))-1]}}else I=[0];for(const P of I){const z=t.containsTile(M,_,r,P);z&&p.push(z)}}return p}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,r){const u=this.getRenderableIds(t,r).map((_=>this._tiles[_].tileID)),p=this.transform.projection.name==="globe";for(const _ of u)_.projMatrix=this.transform.calculateProjMatrix(_.toUnwrapped()),_.expandedProjMatrix=p?this.transform.calculateProjMatrix(_.toUnwrapped(),!1,!0):_.projMatrix;return u}sortCoordinatesByDistance(t){const r=t.slice(),u=this.transform._camera.position,p=this.transform._camera.forward(),_={};for(const y of r){const b=1/(1<<y.canonical.z);_[y.key]=((y.canonical.x+.5)*b+y.wrap-u[0])*p[0]+((y.canonical.y+.5)*b-u[1])*p[1]-u[2]*p[2]}return r.sort(((y,b)=>_[y.key]-_[b.key])),r}hasTransition(){if(this._source.hasTransition())return!0;if(ss(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=o.o.now())return!0}return!1}setFeatureState(t,r,u){this._state.updateState(t=t||"_geojsonTileLayer",r,u)}removeFeatureState(t,r,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,u)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,u){const p=this._tiles[t];p&&p.setDependencies(r,u)}reloadTilesForDependencies(t,r){for(const u in this._tiles)this._tiles[u].hasDependency(t,r)&&this._reloadTile(+u,"reloading");this._cache.filter((u=>!u.hasDependency(t,r)))}_preloadTiles(t,r){if(!this._sourceLoaded){const T=()=>{this._sourceLoaded&&(this._source.off("data",T),this._preloadTiles(t,r))};return void this._source.on("data",T)}const u=new Map,p=Array.isArray(t)?t:[t],_=this.map.painter.terrain,y=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const T of p){const M=T.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const I of M)u.set(I.key,I);this.usedForTerrain&&T.updateElevation(!1)}const b=Array.from(u.values());o.bv(b,((T,M)=>{const I=new jo(T,this._source.tileSize*T.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(I,(P=>{this._source.type==="raster-dem"&&I.dem&&this._backfillDEM(I),M(P,I)}))}),r)}}function wd(c,t){const r=Math.abs(2*c.wrap)-+(c.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return c.overscaledZ-t.overscaledZ||u-r||t.canonical.y-c.canonical.y||t.canonical.x-c.canonical.x}function ss(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function Ya(c,t){const r=1<<c.z;return[c.x/r+t,(c.x+1)/r+t]}so.maxOverzooming=10,so.maxUnderzooming=3;class bh{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,r=!1;for(const u in this.style._mergedLayers){const p=this.style._mergedLayers[u];if(p.type==="fill-extrusion"||p.type==="building")this.layers.push({layer:p,visible:t,visibilityChanged:r});else if(p.type==="model"){const _=this.style.getLayerSource(p);_&&_.type==="batched-model"&&this.layers.push({layer:p,visible:t,visibilityChanged:r})}}}onNewFrame(t){this.layersGotHidden=!1;for(const r of this.layers){const u=r.layer;let p=!1;u.type==="fill-extrusion"?p=!u.isHidden(t)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="building"?p=!u.isHidden(t)&&u.paint.get("building-opacity")>0:u.type==="model"&&(p=!u.isHidden(t)&&u.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!p&&r.visible,r.visible=p}}updateZOffset(t,r){this.currentBuildingBuckets=[];for(const p of this.layers){const _=p.layer,y=this.style.getLayerSourceCache(_);let b=1;_.type==="fill-extrusion"?b=p.visible?_.paint.get("fill-extrusion-vertical-scale"):0:_.type==="building"&&(b=p.visible?_.paint.get("building-vertical-scale"):0);let T=y?y.getTile(r):null;if(!T&&y)for(const M in y._tiles){const I=y._tiles[M];if(r.canonical.isChildOf(I.tileID.canonical)){T=I;break}}this.currentBuildingBuckets.push({bucket:T?T.getBucket(_):null,tileID:T?T.tileID:r,verticalScale:b})}t.hasAnyZOffset=!1;let u=!1;for(let p=0;p<t.symbolInstances.length;p++){const _=t.symbolInstances.get(p),y=_.zOffset,b=this._getHeightAtTileOffset(r,_.tileAnchorX,_.tileAnchorY);_.zOffset=b!==Number.NEGATIVE_INFINITY?b:y,u||y===_.zOffset||(u=!0),t.hasAnyZOffset||_.zOffset===0||(t.hasAnyZOffset=!0)}u&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,r,u,p){let _=r,y=u;if(t.canonical.z!==p.canonical.z){const b=p.canonical,T=1/(1<<t.canonical.z-b.z);_=(r+t.canonical.x*o.al)*T-b.x*o.al|0,y=(u+t.canonical.y*o.al)*T-b.y*o.al|0}return{tileX:_,tileY:y}}_getHeightAtTileOffset(t,r,u){let p,_;for(let y=0;y<this.layers.length;++y){const b=this.layers[y].layer;if(b.type!=="fill-extrusion"&&b.type!=="building")continue;const{bucket:T,tileID:M,verticalScale:I}=this.currentBuildingBuckets[y];if(!T)continue;const{tileX:P,tileY:z}=this._mapCoordToOverlappingTile(t,r,u,M),O=T.getHeightAtTileCoord(P,z);O&&O.height!==void 0&&(O.hidden?p=O.height:_=Math.max(O.height*I,_||0))}if(_!==void 0)return _;for(let y=0;y<this.layers.length;++y){const b=this.layers[y];if(b.layer.type!=="model"||!b.visible)continue;const{bucket:T,tileID:M}=this.currentBuildingBuckets[y];if(!T)continue;const{tileX:I,tileY:P}=this._mapCoordToOverlappingTile(t,r,u,M),z=T.getHeightAtTileCoord(I,P);if(z&&!z.hidden)return z.height===void 0&&p!==void 0?Math.min(z.maxHeight,p)*z.verticalScale:z.height?z.height*z.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ul(c,t){const r={};for(const u in c)u!=="ref"&&(r[u]=c[u]);return o.bw.forEach((u=>{u in t&&(r[u]=t[u])})),r}function Ao(c){c=c.slice();const t=Object.create(null);for(let r=0;r<c.length;r++)t[c[r].id]=c[r];for(let r=0;r<c.length;r++)"ref"in c[r]&&(c[r]=ul(c[r],t[c[r].ref]));return c}const Ki={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Tu(c,t,r){r.push({command:Ki.addSource,args:[c,t[c]]})}function Su(c,t,r){t.push({command:Ki.removeSource,args:[c]}),r[c]=!0}function jl(c,t,r,u){Su(c,r,u),Tu(c,t,r)}function Eu(c,t,r){let u;for(u in c[r])if(c[r].hasOwnProperty(u)&&u!=="data"&&!o.bx(c[r][u],t[r][u]))return!1;for(u in t[r])if(t[r].hasOwnProperty(u)&&u!=="data"&&!o.bx(c[r][u],t[r][u]))return!1;return!0}function Au(c,t,r,u,p,_){let y;for(y in t=t||{},c=c||{})c.hasOwnProperty(y)&&(o.bx(c[y],t[y])||r.push({command:_,args:[u,y,t[y],p]}));for(y in t)t.hasOwnProperty(y)&&!c.hasOwnProperty(y)&&(o.bx(c[y],t[y])||r.push({command:_,args:[u,y,t[y],p]}))}function Sa(c){return c.id}function ls(c,t){return c[t.id]=t,c}function Ls(c,t,r){const u=t.createTileMatrix(c,c.worldSize,r.toUnwrapped());return o.aB(new Float32Array(16),c.projMatrix,u)}function Mu(c,t,r){if(t.projection.name===r.projection.name)return c.projMatrix;const u=r.clone();return u.setProjection(t.projection),Ls(u,t.getProjection(),c)}function Td(c,t,r){return t.name===r.projection.name?c.projMatrix:Ls(r,t,c)}class Ff{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.aA(t,0,1);let r=1,u=this._distances[r];const p=t*this.paddedLength+this.padding;for(;u<p&&r<this._distances.length;)u=this._distances[++r];const _=r-1,y=this._distances[_],b=u-y,T=b>0?(p-y)/b:0;return this.points[_].mult(1-T).add(this.points[r].mult(T))}}class yc{constructor(t,r,u){const p=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(r/u);for(let y=0;y<this.xCellCount*this.yCellCount;y++)p.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,u,p,_){this._forEachCell(r,u,p,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(_)}insertCircle(t,r,u,p){this._forEachCell(r-p,u-p,r+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,r,u,p,_,y){this.boxCells[_].push(y)}_insertCircleCell(t,r,u,p,_,y){this.circleCells[_].push(y)}_query(t,r,u,p,_,y){if(u<0||t>this.width||p<0||r>this.height)return!_&&[];const b=[];if(t<=0&&r<=0&&this.width<=u&&this.height<=p){if(_)return!0;for(let T=0;T<this.boxKeys.length;T++)b.push({key:this.boxKeys[T],x1:this.bboxes[4*T],y1:this.bboxes[4*T+1],x2:this.bboxes[4*T+2],y2:this.bboxes[4*T+3]});for(let T=0;T<this.circleKeys.length;T++){const M=this.circles[3*T],I=this.circles[3*T+1],P=this.circles[3*T+2];b.push({key:this.circleKeys[T],x1:M-P,y1:I-P,x2:M+P,y2:I+P})}return y?b.filter(y):b}return this._forEachCell(t,r,u,p,this._queryCell,b,{hitTest:_,seenUids:{box:{},circle:{}}},y),_?b.length>0:b}_queryCircle(t,r,u,p,_){const y=t-u,b=t+u,T=r-u,M=r+u;if(b<0||y>this.width||M<0||T>this.height)return!p&&[];const I=[];return this._forEachCell(y,T,b,M,this._queryCellCircle,I,{hitTest:p,circle:{x:t,y:r,radius:u},seenUids:{box:{},circle:{}}},_),p?I.length>0:I}query(t,r,u,p,_){return this._query(t,r,u,p,!1,_)}hitTest(t,r,u,p,_){return this._query(t,r,u,p,!0,_)}hitTestCircle(t,r,u,p){return this._queryCircle(t,r,u,!0,p)}_queryCell(t,r,u,p,_,y,b,T){const M=b.seenUids,I=this.boxCells[_];if(I!==null){const z=this.bboxes;for(const O of I)if(!M.box[O]){M.box[O]=!0;const B=4*O;if(t<=z[B+2]&&r<=z[B+3]&&u>=z[B+0]&&p>=z[B+1]&&(!T||T(this.boxKeys[O]))){if(b.hitTest)return y.push(!0),!0;y.push({key:this.boxKeys[O],x1:z[B],y1:z[B+1],x2:z[B+2],y2:z[B+3]})}}}const P=this.circleCells[_];if(P!==null){const z=this.circles;for(const O of P)if(!M.circle[O]){M.circle[O]=!0;const B=3*O;if(this._circleAndRectCollide(z[B],z[B+1],z[B+2],t,r,u,p)&&(!T||T(this.circleKeys[O]))){if(b.hitTest)return y.push(!0),!0;{const N=z[B],H=z[B+1],j=z[B+2];y.push({key:this.circleKeys[O],x1:N-j,y1:H-j,x2:N+j,y2:H+j})}}}}}_queryCellCircle(t,r,u,p,_,y,b,T){const M=b.circle,I=b.seenUids,P=this.boxCells[_];if(P!==null){const O=this.bboxes;for(const B of P)if(!I.box[B]){I.box[B]=!0;const N=4*B;if(this._circleAndRectCollide(M.x,M.y,M.radius,O[N+0],O[N+1],O[N+2],O[N+3])&&(!T||T(this.boxKeys[B])))return y.push(!0),!0}}const z=this.circleCells[_];if(z!==null){const O=this.circles;for(const B of z)if(!I.circle[B]){I.circle[B]=!0;const N=3*B;if(this._circlesCollide(O[N],O[N+1],O[N+2],M.x,M.y,M.radius)&&(!T||T(this.circleKeys[B])))return y.push(!0),!0}}}_forEachCell(t,r,u,p,_,y,b,T){const M=this._convertToXCellCoord(t),I=this._convertToYCellCoord(r),P=this._convertToXCellCoord(u),z=this._convertToYCellCoord(p);for(let O=M;O<=P;O++)for(let B=I;B<=z;B++)if(_.call(this,t,r,u,p,this.xCellCount*B+O,y,b,T))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,u,p,_,y){const b=p-t,T=_-r,M=u+y;return M*M>b*b+T*T}_circleAndRectCollide(t,r,u,p,_,y,b){const T=(y-p)/2,M=Math.abs(t-(p+T));if(M>T+u)return!1;const I=(b-_)/2,P=Math.abs(r-(_+I));if(P>I+u)return!1;if(M<=T||P<=I)return!0;const z=M-T,O=P-I;return z*z+O*O<=u*u}}const Ra={unknown:0,flipRequired:1,flipNotRequired:2},Gl=Math.tan(85*Math.PI/180);function vc(c,t,r,u,p,_,y){const b=o.bB();if(r)if(_.name==="globe"){const T=o.bC(p,t);o.aB(b,b,T)}else{const T=o.bD([],y);b[0]=T[0],b[1]=T[1],b[4]=T[2],b[5]=T[3],u||o.bA(b,b,p.angle)}else o.aB(b,p.labelPlaneMatrix,c);return b}function wh(c,t,r,u,p,_,y){const b=vc(c,t,r,u,p,_,y);return _.name==="globe"&&r||(b[2]=b[6]=b[10]=b[14]=0),b}function hl(c,t,r,u,p,_,y){if(r){if(_.name==="globe"){const b=vc(c,t,r,u,p,_,y);return o.bk(b,b),o.aB(b,c,b),b}{const b=o.by(c),T=o.bz([]);return T[0]=y[0],T[1]=y[1],T[4]=y[2],T[5]=y[3],o.aB(b,b,T),u||o.bA(b,b,-p.angle),b}}return p.glCoordMatrix}function Ur(c,t,r,u){const p=[c,t,r,1];r?o.aC(p,p,u):Go(p,p,u);const _=p[3];return p[0]/=_,p[1]/=_,p[2]/=_,p}function Th(c,t){return Math.min(.5+c/t*.5,1.5)}function Bf(c,t){const r=c[0]/c[3],u=c[1]/c[3];return r>=-t[0]&&r<=t[0]&&u>=-t[1]&&u<=t[1]}function kf(c,t,r,u,p,_,y,b,T,M,I=1){const P=r.transform,z=u?c.textSizeData:c.iconSizeData,O=o.bJ(z,r.transform.zoom,I),B=P.projection.name==="globe",N=[256/r.width*2+1,256/r.height*2+1],H=u?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;H.clear();let j=null;B&&(j=u?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const Z=c.lineVertexArray,K=u?c.text.placedSymbolArray:c.icon.placedSymbolArray,W=r.transform.width/r.transform.height;let se,Q=!1;for(let ce=0;ce<K.length;ce++){const ie=K.get(ce),{numGlyphs:te,writingMode:ue}=ie;if(ue!==o.bK.vertical||Q||se===o.bK.horizontal||(Q=!0),se=ue,(ie.hidden||ue===o.bK.vertical)&&!Q){dl(te,H);continue}Q=!1;const we=new o.P(ie.tileAnchorX,ie.tileAnchorY),ve=c.elevationType==="road",Oe=!!P.elevation||ve;let{x:ze,y:je,z:lt}=P.projection.projectTilePoint(we.x,we.y,M.canonical),Me=null;if(Oe){const Rt=ve?c.getElevationFeatureForText(ce):null;Me={getElevation:T,elevation:P.elevation,elevationFeature:Rt};const[Kt,Ti,fi]=T(we,P.elevation,Rt);ze+=Kt,je+=Ti,lt+=fi}const ge=[ze,je,lt,1];if(o.aC(ge,ge,t),!Bf(ge,N)){dl(te,H);continue}const Ge=ge[3],Re=Th(r.transform.getCameraToCenterDistance(P.projection),Ge),it=o.bL(z,O,ie),Je=y?it/Re:it*Re,vt=Ur(ze,je,lt,p);if(vt[3]<=0){dl(te,H);continue}let Ze={};const $e=o.an(c.layers[0].layout.get("text-max-angle")),xt=Math.cos($e),Mt=y?null:Me,St=j1(ie,Je,!1,b,t,p,_,c.glyphOffsetArray,Z,H,j,vt,we,Ze,W,Mt,P.projection,M,y,xt);Q=St.useVertical,Mt&&St.needsFlipping&&(Ze={}),(St.notEnoughRoom||Q||St.needsFlipping&&j1(ie,Je,!0,b,t,p,_,c.glyphOffsetArray,Z,H,j,vt,we,Ze,W,Mt,P.projection,M,y,xt).notEnoughRoom)&&dl(te,H)}u?(c.text.dynamicLayoutVertexBuffer.updateData(H),j&&c.text.globeExtVertexBuffer&&c.text.globeExtVertexBuffer.updateData(j)):(c.icon.dynamicLayoutVertexBuffer.updateData(H),j&&c.icon.globeExtVertexBuffer&&c.icon.globeExtVertexBuffer.updateData(j))}function pn(c,t,r,u,p,_,y,b,T,M,I,P,z,O,B,N,H){const{lineStartIndex:j,glyphStartIndex:Z,segment:K}=b,W=Z+b.numGlyphs,se=j+b.lineLength,Q=t.getoffsetX(Z),ce=t.getoffsetX(W-1),ie=Sh(c*Q,r,u,p,_,y,K,j,se,T,M,I,P,z,!0,O,B,N,H);if(!ie)return null;const te=Sh(c*ce,r,u,p,_,y,K,j,se,T,M,I,P,z,!0,O,B,N,H);return te?{first:ie,last:te}:null}function Nf(c,t,r,u){return c===o.bK.horizontal&&Math.abs(u)>Math.abs(r)?{useVertical:!0}:c===o.bK.vertical?u>0?{needsFlipping:!0}:null:t!==Ra.unknown&&(function(p,_){return p===0||Math.abs(_/p)>Gl})(r,u)?t===Ra.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function j1(c,t,r,u,p,_,y,b,T,M,I,P,z,O,B,N,H,j,Z,K){const W=t/24,se=c.lineOffsetX*W,Q=c.lineOffsetY*W,{lineStartIndex:ce,glyphStartIndex:ie,numGlyphs:te,segment:ue,writingMode:we,flipState:ve}=c,Oe=ce+c.lineLength,ze=je=>{if(I){const[Ge,Re,it]=je.up,Je=M.length;o.bM(I,Je+0,Ge,Re,it),o.bM(I,Je+1,Ge,Re,it),o.bM(I,Je+2,Ge,Re,it),o.bM(I,Je+3,Ge,Re,it)}const[lt,Me,ge]=je.point;o.bN(M,lt,Me,ge,je.angle)};if(te>1){const je=pn(W,b,se,Q,r,P,z,c,T,_,O,N,!1,H,j,Z,K);if(!je)return{notEnoughRoom:!0};if(u&&!r){let[lt,Me,ge]=je.first.point,[Ge,Re,it]=je.last.point;[lt,Me]=Ur(lt,Me,ge,y),[Ge,Re]=Ur(Ge,Re,it,y);const Je=Nf(we,ve,(Ge-lt)*B,Re-Me);if(c.flipState=Je&&Je.needsFlipping?Ra.flipRequired:Ra.flipNotRequired,Je)return Je}ze(je.first);for(let lt=ie+1;lt<ie+te-1;lt++){const Me=Sh(W*b.getoffsetX(lt),se,Q,r,P,z,ue,ce,Oe,T,_,O,N,!1,!1,H,j,Z,K);if(!Me)return M.length-=4*(lt-ie),{notEnoughRoom:!0};ze(Me)}ze(je.last)}else{if(u&&!r){const lt=Ur(z.x,z.y,0,p),Me=ce+ue+1,ge=new o.P(T.getx(Me),T.gety(Me)),Ge=Ur(ge.x,ge.y,0,p),Re=Ge[3]>0?Ge:ti(z,ge,lt,1,p,void 0,H,j.canonical),it=Nf(we,ve,(Re[0]-lt[0])*B,Re[1]-lt[1]);if(c.flipState=it&&it.needsFlipping?Ra.flipRequired:Ra.flipNotRequired,it)return it}const je=Sh(W*b.getoffsetX(ie),se,Q,r,P,z,ue,ce,Oe,T,_,O,N,!1,!1,H,j,Z,K);if(!je)return{notEnoughRoom:!0};ze(je)}return{}}function Uf(c,t,r,u,p){const{x:_,y,z:b}=u.projectTilePoint(c.x,c.y,t);if(!p)return Ur(_,y,b,r);const[T,M,I]=p.getElevation(c,p.elevation,p.elevationFeature);return Ur(_+T,y+M,b+I,r)}function ti(c,t,r,u,p,_,y,b){const T=Uf(c.sub(t)._unit()._add(c),b,p,y,_);return o.av(T,r,T),o.aw(T,T),o.bG(T,r,T,u)}function Sh(c,t,r,u,p,_,y,b,T,M,I,P,z,O,B,N,H,j,Z){const K=u?c-t:c+t;let W=K>0?1:-1,se=0;u&&(W*=-1,se=Math.PI),W<0&&(se+=Math.PI);let Q=b+y+(W>0?0:1)|0,ce=p,ie=p,te=0,ue=0;const we=Math.abs(K),ve=[],Oe=[];let ze=_,je=ze,lt=o.bE([]);const Me=()=>ti(je,ze,ie,we-te+1,I,z,N,H.canonical);for(;te+ue<=we;){if(Q+=W,Q<b||Q>=T)return null;if(ie=ce,je=ze,ve.push(ie),O&&Oe.push(je),ze=new o.P(M.getx(Q),M.gety(Q)),ce=P[Q],!ce){const Mt=Uf(ze,H.canonical,I,N,z);ce=Mt[3]>0?P[Q]=Mt:Me()}te+=ue;const $e=o.av([],ce,ie),xt=o.bF(ie,ce);if(r&&xt>0&&ue>0&&o.bI(lt,$e)/(ue*xt)<Z)return null;ue=xt,lt=$e}B&&z&&(P[Q]&&(ce=Me(),ue=o.bF(ie,ce),lt=o.av([],ce,ie)),P[Q]=ce);const ge=(we-te)/ue,Ge=ze.sub(je)._mult(ge)._add(je),Re=o.bG([],ie,lt,ge);let it=[0,0,1],Je=lt[0],vt=lt[1];if(j&&(it=N.upVector(H.canonical,Ge.x,Ge.y),it[0]!==0||it[1]!==0||it[2]!==1)){const $e=[it[2],0,-it[0]],xt=o.bH([],it,$e);o.aw($e,$e),o.aw(xt,xt),Je=o.bI(lt,$e),vt=o.bI(lt,xt)}if(r){const $e=o.bH([],it,lt);o.aw($e,$e),o.bG(Re,Re,$e,r*W)}const Ze=se+Math.atan2(vt,Je);return ve.push(Re),O&&Oe.push(Ge),{point:Re,angle:Ze,path:ve,tilePath:Oe,up:it}}function dl(c,t){const r=t.length,u=r+4*c;t.resize(u),t.float32.fill(-1/0,4*r,4*u)}function Go(c,t,r){const u=t[0],p=t[1];return c[0]=r[0]*u+r[4]*p+r[12],c[1]=r[1]*u+r[5]*p+r[13],c[3]=r[3]*u+r[7]*p+r[15],c}const lo=100;class Iu{constructor(t,r,u=new yc(t.width+200,t.height+200,25),p=new yc(t.width+200,t.height+200,25)){this.transform=t,this.grid=u,this.ignoredGrid=p,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+lo,this.screenBottomBoundary=t.height+lo,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=r}placeCollisionBox(t,r,u,p,_,y,b,T,M,I,P){let z=u.projectedAnchorX,O=u.projectedAnchorY,B=u.projectedAnchorZ;const N=u.tileAnchorX,H=u.tileAnchorY,j=u.elevation,Z=u.tileID,K=t.getProjection();if(j&&Z){const[Oe,ze,je]=K.upVector(Z.canonical,u.tileAnchorX,u.tileAnchorY),lt=K.upVectorScale(Z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=Oe*j*lt,O+=ze*j*lt,B+=je*j*lt}const W=t.projection.name==="globe",se=t.projection.name==="globe"?o.aj(this.transform.zoom):0;if(Z&&W&&se<1&&!y){const Oe=1<<Z.canonical.z,ze=o.bO(N,H);o.bP(ze,ze,1/o.al),o.bQ(ze,ze,o.bO(Z.canonical.x,Z.canonical.y)),o.bP(ze,ze,1/Oe),o.bR(ze,ze,o.bO(p[0],p[1])),ze[0]=o.bS(ze[0],-.5,.5),o.bP(ze,ze,o.al);const je=o.bT(ze[0],ze[1],o.al/(2*Math.PI),1);o.aC(je,je,_),z=o.ak(z,je[0],se),O=o.ak(O,je[1],se),B=o.ak(B,je[2],se)}const Q=this.projectAndGetPerspectiveRatio(I,z,O,B,u.tileID,K.name==="globe"||!!j||this.transform.pitch>0,K),ce=M*Q.perspectiveRatio,ie=(u.x1*r+b.x-u.padding)*ce+Q.point.x,te=(u.y1*r+b.y-u.padding)*ce+Q.point.y,ue=(u.x2*r+b.x+u.padding)*ce+Q.point.x,we=(u.y2*r+b.y+u.padding)*ce+Q.point.y,ve=Q.perspectiveRatio<=.55||Q.occluded;return!this.isInsideGrid(ie,te,ue,we)||!T&&this.grid.hitTest(ie,te,ue,we,P)||ve?{box:[],offscreen:!1,occluded:Q.occluded}:{box:[ie,te,ue,we],offscreen:this.isOffscreen(ie,te,ue,we),occluded:!1}}placeCollisionCircles(t,r,u,p,_,y,b,T,M,I,P,z,O,B,N,H){const j=[],Z=this.transform.elevation,K=t.getProjection(),W=t.elevationType==="road",se=!!Z||W,Q=o.bU.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,K),ce=new o.P(u.tileAnchorX,u.tileAnchorY),ie=new o.P(u.tileAnchorX,u.tileAnchorY);let{x:te,y:ue,z:we}=K.projectTilePoint(ie.x,ie.y,H.canonical),ve=null;if(se){const xt=W?t.getElevationFeatureForText(p):null;ve={getElevation:Q,elevation:Z,elevationFeature:xt};const[Mt,St,Rt]=Q(ce,Z,xt);te+=Mt,ue+=St,we+=Rt}const Oe=K.name==="globe",ze=this.projectAndGetPerspectiveRatio(T,te,ue,we,H,Oe||!!Z||this.transform.pitch>0,K),{perspectiveRatio:je}=ze,lt=(z?b/je:b*je)/o.bX,Me=Ur(te,ue,we,M),ge=u.lineOffsetX*lt,Ge=u.lineOffsetY*lt,Re=o.an(t.layers[0].layout.get("text-max-angle")),it=Math.cos(Re),Je=ze.signedDistanceFromCamera>0?pn(lt,y,ge,Ge,W&&u.flipState===1,Me,ie,u,_,M,{},se&&!z?ve:null,z&&se,K,H,z,it):null;let vt=!1,Ze=!1,$e=!0;if(Je&&!ze.occluded){const xt=.5*B*je+N,Mt=new o.P(-100,-100),St=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Rt=new Ff,{first:Kt,last:Ti}=Je,fi=Kt.path.length;let Qi=[];for(let oi=fi-1;oi>=1;oi--)Qi.push(Kt.path[oi]);for(let oi=1;oi<Ti.path.length;oi++)Qi.push(Ti.path[oi]);const Qt=2.5*xt;I&&(Qi=Qi.map((([oi,en,Fi],Zi)=>(se&&!Oe&&(Fi=Q(Zi<fi-1?Kt.tilePath[fi-1-Zi]:Ti.tilePath[Zi-fi+2],Z,ve.elevationFeature)[2]),Ur(oi,en,Fi,I)))),Qi.some((oi=>oi[3]<=0))&&(Qi=[]));let Ni=[];if(Qi.length>0){let oi=1/0,en=-1/0,Fi=1/0,Zi=-1/0;for(const Xi of Qi)oi=Math.min(oi,Xi[0]),Fi=Math.min(Fi,Xi[1]),en=Math.max(en,Xi[0]),Zi=Math.max(Zi,Xi[1]);en>=Mt.x&&oi<=St.x&&Zi>=Mt.y&&Fi<=St.y&&(Ni=[Qi.map((Xi=>new o.P(Xi[0],Xi[1])))],(oi<Mt.x||en>St.x||Fi<Mt.y||Zi>St.y)&&(Ni=o.bV(Ni,Mt.x,Mt.y,St.x,St.y)))}for(const oi of Ni){Rt.reset(oi,.25*xt);let en=0;en=Rt.length<=.5*xt?1:Math.ceil(Rt.paddedLength/Qt)+1;for(let Fi=0;Fi<en;Fi++){const Zi=Fi/Math.max(en-1,1),Xi=Rt.lerp(Zi),yi=Xi.x+lo,an=Xi.y+lo;j.push(yi,an,xt,0);const Si=yi-xt,Mn=an-xt,Vi=yi+xt,$t=an+xt;if($e=$e&&this.isOffscreen(Si,Mn,Vi,$t),Ze=Ze||this.isInsideGrid(Si,Mn,Vi,$t),!r&&this.grid.hitTestCircle(yi,an,xt,O)&&(vt=!0,!P))return{circles:[],offscreen:!1,collisionDetected:vt,occluded:!1}}}}return{circles:!P&&vt||!Ze?[]:j,offscreen:$e,collisionDetected:vt,occluded:ze.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let u=1/0,p=1/0,_=-1/0,y=-1/0;for(const I of t){const P=new o.P(I.x+lo,I.y+lo);u=Math.min(u,P.x),p=Math.min(p,P.y),_=Math.max(_,P.x),y=Math.max(y,P.y),r.push(P)}const b=this.grid.query(u,p,_,y).concat(this.ignoredGrid.query(u,p,_,y)),T={},M={};for(const I of b){const P=I.key;if(T[P.bucketInstanceId]===void 0&&(T[P.bucketInstanceId]={}),T[P.bucketInstanceId][P.featureIndex])continue;const z=[new o.P(I.x1,I.y1),new o.P(I.x2,I.y1),new o.P(I.x2,I.y2),new o.P(I.x1,I.y2)];o.bW(r,z)&&(T[P.bucketInstanceId][P.featureIndex]=!0,M[P.bucketInstanceId]===void 0&&(M[P.bucketInstanceId]=[]),M[P.bucketInstanceId].push(P.featureIndex))}return M}insertCollisionBox(t,r,u,p,_){(r?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:_},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,u,p,_){const y=r?this.ignoredGrid:this.grid,b={bucketInstanceId:u,featureIndex:p,collisionGroupID:_};for(let T=0;T<t.length;T+=4)y.insertCircle(b,t[T],t[T+1],t[T+2])}projectAndGetPerspectiveRatio(t,r,u,p,_,y,b){const T=[r,u,p,1];let M=!1;p||this.transform.pitch>0?(o.aC(T,T,t),this.fogState&&_&&b.name!=="globe"&&(M=(function(z,O,B,N,H,j){const Z=j.calculateFogTileMatrix(H),K=[O,B,N];return o.af(K,K,Z),ct(z,o.ag(K),j.pitch,j._fov)})(this.fogState,r,u,p,_.toUnwrapped(),this.transform)>.9)):Go(T,T,t);const I=T[3];return{point:new o.P((T[0]/I+1)/2*this.transform.width+lo,(-T[1]/I+1)/2*this.transform.height+lo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(b)/I*.5,1.5),signedDistanceFromCamera:I,occluded:y&&T[2]>I||M}}isOffscreen(t,r,u,p){return u<lo||t>=this.screenRightBoundary||p<lo||r>this.screenBottomBoundary}isInsideGrid(t,r,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=o.bz([]);return o.bq(t,t,[-100,-100,0]),t}}class Xt{constructor(t,r,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Ji{constructor(t,r,u,p,_,y=!1){this.text=new Xt(t?t.text:null,r,u,_),this.icon=new Xt(t?t.icon:null,r,p,_),this.clipped=y}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class on{constructor(t,r,u,p=!1){this.text=t,this.icon=r,this.skipFade=u,this.clipped=p}}class co{constructor(){this.invProjMatrix=o.bB(),this.viewportMatrix=o.bB(),this.circles=[]}}class Cu{constructor(t,r,u,p,_){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=_}}class gn{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:u=>u.collisionGroupID===r}}return this.collisionGroups[t]}}function Eh(c,t,r,u,p){const{horizontalAlign:_,verticalAlign:y}=o.c0(c),b=-(_-.5)*t,T=-(y-.5)*r,M=o.c1(c,u);return new o.P(b+M[0]*p,T+M[1]*p)}function xc(c,t,r,u,p){const _=new o.P(c,t);return r&&_._rotate(u?p:-p),_}class Ah{constructor(t,r,u,p,_,y){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Iu(this.transform,_),this.buildingIndex=y,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new gn(u),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,u,p,_=1){const y=u.getBucket(r),b=u.latestFeatureIndex;if(!y||!b||r.fqid!==y.layerIds[0])return;const T=y.layers[0].layout,M=y.layers[0].paint,I=u.collisionBoxArray,P=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),z=u.tileSize/o.al,O=u.tileID.toUnwrapped();this.transform.setProjection(y.projection);const B=(N=u.tileID,H=y.getProjection(),j=this.transform,H.name===this.projection?j.calculateProjMatrix(N.toUnwrapped()):Ls(j,H,N));var N,H,j;const Z=T.get("text-pitch-alignment")==="map",K=T.get("text-rotation-alignment")==="map";r.compileFilter(r.options);const W=r.dynamicFilter(),se=r.dynamicFilterNeedsFeature(),Q=this.transform.calculatePixelsToTileUnitsMatrix(u),ce=wh(B,u.tileID.canonical,Z,K,this.transform,y.getProjection(),Q);let ie=null;const te=y.getProjection().createInversionMatrix(this.transform,u.tileID.canonical);if(Z){const ge=hl(B,u.tileID.canonical,Z,K,this.transform,y.getProjection(),Q);ie=o.aB([],this.transform.labelPlaneMatrix,ge)}let ue=null;W&&u.latestFeatureIndex&&(ue={unwrappedTileID:O,dynamicFilter:W,dynamicFilterNeedsFeature:se}),this.retainedQueryData[y.bucketInstanceId]=new Cu(y.bucketInstanceId,b,y.sourceLayerIndex,y.index,u.tileID);const[we,ve]=y.layers[0].layout.get("text-size-scale-range"),Oe=o.aA(_,we,ve),[ze,je]=T.get("icon-size-scale-range"),lt=o.aA(_,ze,je),Me={bucket:y,layout:T,paint:M,posMatrix:B,invMatrix:te,mercatorCenter:[o.aF(this.transform.center.lng),o.aJ(this.transform.center.lat)],textLabelPlaneMatrix:ce,labelToScreenMatrix:ie,clippingData:ue,scale:P,textPixelRatio:z,holdingForFade:u.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:o.bJ(y.textSizeData,this.transform.zoom,Oe),partiallyEvaluatedIconSize:o.bJ(y.iconSizeData,this.transform.zoom,lt),collisionGroup:this.collisionGroups.get(y.sourceID),latestFeatureIndex:u.latestFeatureIndex};if(p)for(const ge of y.sortKeyRanges){const{sortKey:Ge,symbolInstanceStart:Re,symbolInstanceEnd:it}=ge;t.push({sortKey:Ge,symbolInstanceStart:Re,symbolInstanceEnd:it,parameters:Me})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:Me})}attemptAnchorPlacement(t,r,u,p,_,y,b,T,M,I,P,z,O,B,N,H,j,Z,K,W,se){const{textOffset0:Q,textOffset1:ce,crossTileID:ie}=N,te=[Q,ce],ue=Eh(t,y,b,te,T),we=this.collisionIndex.placeCollisionBox(j,T,r,u,p,_,xc(ue.x,ue.y,M,I,this.transform.angle),B,P,z,O.predicate);if(K){const ve=j.getSymbolInstanceIconSize(se,this.transform.zoom,N.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(j,ve,K,u,p,_,xc(ue.x,ue.y,M,I,this.transform.angle),B,P,z,O.predicate).box.length===0)return}if(we.box.length>0){let ve;return this.prevPlacement&&this.prevPlacement.variableOffsets[ie]&&this.prevPlacement.placements[ie]&&this.prevPlacement.placements[ie].text&&(ve=this.prevPlacement.variableOffsets[ie].anchor),this.variableOffsets[ie]={textOffset:te,width:y,height:b,anchor:t,textScale:T,prevAnchor:ve},this.markUsedJustification(j,t,N,Z),j.allowVerticalPlacement&&(this.markUsedOrientation(j,Z,N),this.placedOrientations[ie]=Z),{shift:ue,placedGlyphBoxes:we}}}placeLayerBucketPart(t,r,u,p,_=1){const{bucket:y,layout:b,paint:T,posMatrix:M,textLabelPlaneMatrix:I,labelToScreenMatrix:P,clippingData:z,textPixelRatio:O,mercatorCenter:B,invMatrix:N,holdingForFade:H,collisionBoxArray:j,partiallyEvaluatedTextSize:Z,partiallyEvaluatedIconSize:K,collisionGroup:W,latestFeatureIndex:se}=t.parameters,Q=b.get("text-optional"),ce=b.get("icon-optional"),ie=b.get("text-allow-overlap"),te=b.get("icon-allow-overlap"),ue=b.get("text-rotation-alignment")==="map",we=b.get("icon-rotation-alignment")==="map",ve=b.get("text-pitch-alignment")==="map",Oe=T.get("symbol-z-offset"),ze=b.get("symbol-elevation-reference")==="sea",je=b.get("symbol-placement"),[lt,Me]=b.get("text-size-scale-range"),[ge,Ge]=b.get("icon-size-scale-range"),Re=o.aA(_,lt,Me),it=o.aA(_,ge,Ge),Je=b.get("text-variable-anchor"),vt=ue&&je!=="point",Ze=we&&je!=="point",$e=Je&&y.hasTextData(),xt=y.hasIconTextFit()&&$e&&y.hasIconData();this.transform.setProjection(y.projection);const Mt=$e||vt,St=Ze||xt;let Rt=ie&&(te||!y.hasIconData()||ce),Kt=te&&(ie||!y.hasTextData()||Q);const Ti=!Oe.isConstant();!y.collisionArrays&&j&&y.deserializeCollisionBoxes(j),u&&p&&y.updateCollisionDebugBuffers(this.transform.zoom,j,Re,it);const fi=(Qt,Ni,oi)=>{const{crossTileID:en,numVerticalGlyphVertices:Fi}=Qt;let Zi=null;if(z&&z.dynamicFilterNeedsFeature||Ti){const Pn=this.retainedQueryData[y.bucketInstanceId];Zi=se.loadFeature({featureIndex:Qt.featureIndex,bucketIndex:Pn.bucketIndex,sourceLayerIndex:Pn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(z&&!(0,z.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:y.worldview},Zi,this.retainedQueryData[y.bucketInstanceId].tileID.canonical,new o.P(Qt.tileAnchorX,Qt.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[en]=new on(!1,!1,!1,!0),void r.add(en);const Xi=Oe.evaluate(Zi,{});if(r.has(en))return;if(H)return void(this.placements[en]=new on(!1,!1,!1));let yi=!1,an=!1,Si=!0,Mn=!1,Vi=!1,$t=null,Ri={box:null,offscreen:null,occluded:null},Dn={box:null},kn=null,Wn=null,rr=null,qa=0,da=0,ra=0;oi.textFeatureIndex?qa=oi.textFeatureIndex:Qt.useRuntimeCollisionCircles&&(qa=Qt.featureIndex),oi.verticalTextFeatureIndex&&(da=oi.verticalTextFeatureIndex);const vr=y.elevationFeatures?y.elevationFeatures[Qt.elevationFeatureIndex]:void 0,go=Pn=>{Pn.tileID=this.retainedQueryData[y.bucketInstanceId].tileID;const hr=this.transform.elevation;Pn.elevation=ze?Xi:Xi+o.bU.getAtTileOffset(Pn.tileID,new o.P(Pn.tileAnchorX,Pn.tileAnchorY),hr,vr),Pn.elevation+=Qt.zOffset},ur=oi.textBox;if(ur){go(ur);const Pn=wn=>{let ar=o.bK.horizontal;if(y.allowVerticalPlacement&&!wn&&this.prevPlacement){const Jr=this.prevPlacement.placedOrientations[en];Jr&&(this.placedOrientations[en]=Jr,ar=Jr,this.markUsedOrientation(y,ar,Qt))}return ar},hr=(wn,ar)=>{if(y.allowVerticalPlacement&&Fi>0&&oi.verticalTextBox){for(const Jr of y.writingModes)if(Jr===o.bK.vertical?(Ri=ar(),Dn=Ri):Ri=wn(),Ri&&Ri.box&&Ri.box.length)break}else Ri=wn()};if(Je){let wn=Je;if(this.prevPlacement&&this.prevPlacement.variableOffsets[en]){const or=this.prevPlacement.variableOffsets[en];wn.indexOf(or.anchor)>0&&(wn=wn.filter((vo=>vo!==or.anchor)),wn.unshift(or.anchor))}const ar=(or,vo,iu)=>{const es=y.getSymbolInstanceTextSize(Z,Qt,this.transform.zoom,Ni),dc=(or.x2-or.x1)*es+2*or.padding,lh=(or.y2-or.y1)*es+2*or.padding,Fo=Qt.hasIconTextFit&&!te?vo:null;Fo&&go(Fo);let nl={box:[],offscreen:!1,occluded:!1};const Gr=ie?2*wn.length:wn.length;for(let xo=0;xo<Gr;++xo){const ts=this.attemptAnchorPlacement(wn[xo%wn.length],or,B,N,Mt,dc,lh,es,ue,ve,O,M,W,xo>=wn.length,Qt,Ni,y,iu,Fo,Z,K);if(ts&&(nl=ts.placedGlyphBoxes,nl&&nl.box&&nl.box.length)){yi=!0,$t=ts.shift;break}}return nl};hr((()=>ar(ur,oi.iconBox,o.bK.horizontal)),(()=>{const or=oi.verticalTextBox;return or&&go(or),y.allowVerticalPlacement&&!(Ri&&Ri.box&&Ri.box.length)&&Fi>0&&or?ar(or,oi.verticalIconBox,o.bK.vertical):{box:null,offscreen:null,occluded:null}})),Ri&&(yi=Ri.box,Si=Ri.offscreen,Mn=Ri.occluded);const Jr=Pn(!(!Ri||!Ri.box));if(!yi&&this.prevPlacement){const or=this.prevPlacement.variableOffsets[en];or&&(this.variableOffsets[en]=or,this.markUsedJustification(y,or.anchor,Qt,Jr))}}else{const wn=(ar,Jr)=>{const or=y.getSymbolInstanceTextSize(Z,Qt,this.transform.zoom,Ni),vo=this.collisionIndex.placeCollisionBox(y,or,ar,B,N,Mt,new o.P(0,0),ie,O,M,W.predicate);return vo&&vo.box&&vo.box.length&&(this.markUsedOrientation(y,Jr,Qt),this.placedOrientations[en]=Jr),vo};hr((()=>wn(ur,o.bK.horizontal)),(()=>{const ar=oi.verticalTextBox;return y.allowVerticalPlacement&&Fi>0&&ar?(go(ar),wn(ar,o.bK.vertical)):{box:null,offscreen:null,occluded:null}})),Pn(!!(Ri&&Ri.box&&Ri.box.length))}}if(kn=Ri,yi=kn&&kn.box&&kn.box.length>0,Si=kn&&kn.offscreen,Mn=kn&&kn.occluded,Qt.useRuntimeCollisionCircles){const Pn=Qt.centerJustifiedTextSymbolIndex>=0?Qt.centerJustifiedTextSymbolIndex:Qt.verticalPlacedTextSymbolIndex,hr=y.text.placedSymbolArray.get(Pn),wn=o.bL(y.textSizeData,Z,hr),ar=b.get("text-padding");Wn=this.collisionIndex.placeCollisionCircles(y,ie,hr,Pn,y.lineVertexArray,y.glyphOffsetArray,wn,M,I,P,u,ve,W.predicate,Qt.collisionCircleDiameter*wn/o.bX,ar,this.retainedQueryData[y.bucketInstanceId].tileID),yi=ie||Wn.circles.length>0&&!Wn.collisionDetected,Si=Si&&Wn.offscreen,Mn=Wn.occluded}if(oi.iconFeatureIndex&&(ra=oi.iconFeatureIndex),oi.iconBox){const Pn=hr=>{go(hr);const wn=Qt.hasIconTextFit&&$t?xc($t.x,$t.y,ue,ve,this.transform.angle):new o.P(0,0),ar=y.getSymbolInstanceIconSize(K,this.transform.zoom,Qt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(y,ar,hr,B,N,St,wn,te,O,M,W.predicate)};Dn&&Dn.box&&Dn.box.length&&oi.verticalIconBox?(rr=Pn(oi.verticalIconBox),an=rr.box.length>0):(rr=Pn(oi.iconBox),an=rr.box.length>0),Si=Si&&rr.offscreen,Vi=rr.occluded}const yo=Q||Qt.numHorizontalGlyphVertices===0&&Fi===0,Oo=ce||Qt.numIconVertices===0;if(yo||Oo?Oo?yo||(an=an&&yi):yi=an&&yi:an=yi=an&&yi,yi&&kn&&kn.box&&this.collisionIndex.insertCollisionBox(kn.box,b.get("text-ignore-placement"),y.bucketInstanceId,Dn&&Dn.box&&da?da:qa,W.ID),an&&rr&&this.collisionIndex.insertCollisionBox(rr.box,b.get("icon-ignore-placement"),y.bucketInstanceId,ra,W.ID),Wn&&(yi&&this.collisionIndex.insertCollisionCircles(Wn.circles,b.get("text-ignore-placement"),y.bucketInstanceId,qa,W.ID),u)){const Pn=y.bucketInstanceId;let hr=this.collisionCircleArrays[Pn];hr===void 0&&(hr=this.collisionCircleArrays[Pn]=new co);for(let wn=0;wn<Wn.circles.length;wn+=4)hr.circles.push(Wn.circles[wn+0]),hr.circles.push(Wn.circles[wn+1]),hr.circles.push(Wn.circles[wn+2]),hr.circles.push(Wn.collisionDetected?1:0)}const aa=y.projection.name!=="globe";Rt=Rt&&(aa||!Mn),Kt=Kt&&(aa||!Vi),this.placements[en]=new on(yi||Rt,an||Kt,Si||y.justReloaded),r.add(en)},Qi=this.retainedQueryData[y.bucketInstanceId].tileID;if(y.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(y,Qi),y.elevationType==="road"&&y.updateRoadElevation(Qi.canonical),y.updateZOffset(),y.sortFeaturesByY){const Qt=y.getSortedSymbolIndexes(this.transform.angle);for(let Ni=Qt.length-1;Ni>=0;--Ni){const oi=Qt[Ni];fi(y.symbolInstances.get(oi),oi,y.collisionArrays[oi])}y.hasAnyZOffset&&o.w(`${y.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(y.hasAnyZOffset){const Qt=y.getSortedIndexesByZOffset();for(let Ni=0;Ni<Qt.length;++Ni){const oi=Qt[Ni];fi(y.symbolInstances.get(oi),oi,y.collisionArrays[oi])}}else for(let Qt=t.symbolInstanceStart;Qt<t.symbolInstanceEnd;Qt++)fi(y.symbolInstances.get(Qt),Qt,y.collisionArrays[Qt]);if(u&&y.bucketInstanceId in this.collisionCircleArrays){const Qt=this.collisionCircleArrays[y.bucketInstanceId];o.bk(Qt.invProjMatrix,M),Qt.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(t,r,u,p){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:y,rightJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:T,crossTileID:M}=u,I=o.c2(r),P=p===o.bK.vertical?T:I==="left"?_:I==="center"?y:I==="right"?b:-1;_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=P>=0&&_!==P?0:M),y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=P>=0&&y!==P?0:M),b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=P>=0&&b!==P?0:M),T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=P>=0&&T!==P?0:M)}markUsedOrientation(t,r,u){const p=r===o.bK.horizontal||r===o.bK.horizontalOnly?r:0,_=r===o.bK.vertical?r:0,{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:M}=u,I=t.text.placedSymbolArray;y>=0&&(I.get(y).placedOrientation=p),b>=0&&(I.get(b).placedOrientation=p),T>=0&&(I.get(T).placedOrientation=p),M>=0&&(I.get(M).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let u=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const p=r?r.symbolFadeChange(t):1,_=r?r.opacities:{},y=r?r.variableOffsets:{},b=r?r.placedOrientations:{};for(const T in this.placements){const M=this.placements[T],I=_[T];I?(this.opacities[T]=new Ji(I,p,M.text,M.icon,null,M.clipped),u=u||M.text!==I.text.placed||M.icon!==I.icon.placed):(this.opacities[T]=new Ji(null,p,M.text,M.icon,M.skipFade,M.clipped),u=u||M.text||M.icon)}for(const T in _){const M=_[T];if(!this.opacities[T]){const I=new Ji(M,p,!1,!1);I.isHidden()||(this.opacities[T]=I,u=u||M.text.placed||M.icon.placed)}}for(const T in y)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=y[T]);for(const T in b)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=b[T]);u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r,u,p){const _=new Set;for(const y of r){const b=y.getBucket(t);b&&y.latestFeatureIndex&&t.fqid===b.layerIds[0]&&(this.updateBucketOpacities(b,_,y,y.collisionBoxArray,u,p,y.tileID,t.scope),b.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(b,y.tileID),b.elevationType==="road"&&b.updateRoadElevation(y.tileID.canonical),b.updateZOffset())}}updateBucketOpacities(t,r,u,p,_,y,b,T){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const M=t.layers[0].layout,I=t.layers[0].paint,P=!!t.layers[0].dynamicFilter(),z=new Ji(null,0,!1,!1,!0),O=M.get("text-allow-overlap"),B=M.get("icon-allow-overlap"),N=M.get("text-variable-anchor"),H=M.get("text-rotation-alignment")==="map",j=M.get("text-pitch-alignment")==="map",Z=I.get("symbol-z-offset"),K=M.get("symbol-elevation-reference")==="sea",W=!Z.isConstant(),se=new Ji(null,0,O&&(B||!t.hasIconData()||M.get("icon-optional")),B&&(O||!t.hasTextData()||M.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const Q=(ie,te,ue)=>{for(let we=0;we<te/4;we++)ie.opacityVertexArray.emplaceBack(ue)};let ce=0;y&&t.updateReplacement(b,y);for(let ie=0;ie<t.symbolInstances.length;ie++){const te=t.symbolInstances.get(ie),{numHorizontalGlyphVertices:ue,numVerticalGlyphVertices:we,crossTileID:ve,numIconVertices:Oe,tileAnchorX:ze,tileAnchorY:je}=te;let lt=null;const Me=this.retainedQueryData[t.bucketInstanceId];W&&te&&Me&&(lt=u.latestFeatureIndex.loadFeature({featureIndex:te.featureIndex,bucketIndex:Me.bucketIndex,sourceLayerIndex:Me.sourceLayerIndex,layoutVertexArrayOffset:0}));const ge=Z.evaluate(lt,{}),Ge=r.has(ve);let Re=this.opacities[ve];Ge?Re=z:Re||(Re=se,this.opacities[ve]=Re),r.add(ve);const it=ue>0||we>0,Je=Oe>0,vt=this.placedOrientations[ve],Ze=vt===o.bK.vertical,$e=vt===o.bK.horizontal||vt===o.bK.horizontalOnly;!it&&!Je||Re.isHidden()||ce++;let xt=!1;if((it||Je)&&y)for(const Mt of t.activeReplacements){if(o.bY(Mt,_,o.bZ.Symbol,T)||Mt.min.x>ze||ze>Mt.max.x||Mt.min.y>je||je>Mt.max.y)continue;const St=o.b_(ze,je,b.canonical,Mt.footprintTileId.canonical);if(xt=o.b$(St,Mt.footprint),xt)break}if(it){const Mt=xt?$r:zu(Re.text);Q(t.text,ue,Ze?$r:Mt),Q(t.text,we,$e?$r:Mt);const St=Re.text.isHidden(),{leftJustifiedTextSymbolIndex:Rt,centerJustifiedTextSymbolIndex:Kt,rightJustifiedTextSymbolIndex:Ti,verticalPlacedTextSymbolIndex:fi}=te,Qi=t.text.placedSymbolArray,Qt=St||Ze?1:0;Rt>=0&&(Qi.get(Rt).hidden=Qt),Kt>=0&&(Qi.get(Kt).hidden=Qt),Ti>=0&&(Qi.get(Ti).hidden=Qt),fi>=0&&(Qi.get(fi).hidden=St||$e?1:0);const Ni=this.variableOffsets[ve];Ni&&this.markUsedJustification(t,Ni.anchor,te,vt);const oi=this.placedOrientations[ve];oi&&(this.markUsedJustification(t,"left",te,oi),this.markUsedOrientation(t,oi,te))}if(Je){const Mt=xt?$r:zu(Re.icon),{placedIconSymbolIndex:St,verticalPlacedIconSymbolIndex:Rt}=te,Kt=t.icon.placedSymbolArray,Ti=Re.icon.isHidden()?1:0;St>=0&&(Q(t.icon,Oe,Ze?$r:Mt),Kt.get(St).hidden=Ti),Rt>=0&&(Q(t.icon,te.numVerticalIconVertices,$e?$r:Mt),Kt.get(Rt).hidden=Ti)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Mt=t.collisionArrays[ie];if(Mt){let St=new o.P(0,0),Rt=!0;if(Mt.textBox||Mt.verticalTextBox){if(N){const Ti=this.variableOffsets[ve];Ti?(St=Eh(Ti.anchor,Ti.width,Ti.height,Ti.textOffset,Ti.textScale),H&&St._rotate(j?this.transform.angle:-this.transform.angle)):Rt=!1}P&&(Rt=!Re.clipped),Mt.textBox&&sa(t.textCollisionBox.collisionVertexArray,Re.text.placed,!Rt||Ze,ge,K,St.x,St.y),Mt.verticalTextBox&&sa(t.textCollisionBox.collisionVertexArray,Re.text.placed,!Rt||$e,ge,K,St.x,St.y)}const Kt=Rt&&!!(!$e&&Mt.verticalIconBox);Mt.iconBox&&sa(t.iconCollisionBox.collisionVertexArray,Re.icon.placed,Kt,ge,K,te.hasIconTextFit?St.x:0,te.hasIconTextFit?St.y:0),Mt.verticalIconBox&&sa(t.iconCollisionBox.collisionVertexArray,Re.icon.placed,!Kt,ge,K,te.hasIconTextFit?St.x:0,te.hasIconTextFit?St.y:0)}}}if(t.fullyClipped=ce===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ie=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ie.invProjMatrix,t.placementViewportMatrix=ie.viewportMatrix,t.collisionCircleArray=ie.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const u=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function sa(c,t,r,u,p,_,y){c.emplaceBack(t?1:0,r?1:0,_||0,y||0,u,p?1:0),c.emplaceBack(t?1:0,r?1:0,_||0,y||0,u,p?1:0),c.emplaceBack(t?1:0,r?1:0,_||0,y||0,u,p?1:0),c.emplaceBack(t?1:0,r?1:0,_||0,y||0,u,p?1:0)}const Or=Math.pow(2,25),Gp=Math.pow(2,24),bc=Math.pow(2,17),wc=Math.pow(2,16),Mh=Math.pow(2,9),Ih=Math.pow(2,8),Sd=Math.pow(2,1);function zu(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const t=c.placed?1:0,r=Math.floor(127*c.opacity);return r*Or+t*Gp+r*bc+t*wc+r*Mh+t*Ih+r*Sd+t}const $r=0;class Os{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,r,u,p,_,y){const b=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(b,p,t[this._currentTileIndex],this._sortAcrossTiles,y),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort(((T,M)=>T.sortKey-M.sortKey)));this._currentPartIndex<b.length;){const T=b[this._currentPartIndex];if(r.placeLayerBucketPart(T,this._seenCrossTileIDs,u,T.symbolInstanceStart===0,y),this._currentPartIndex++,_())return!0}return!1}}class la{constructor(t,r,u,p,_,y,b,T,M){this.placement=new Ah(t,_,y,b,T,M),this._currentPlacementIndex=r.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,r,u,p,_){const y=o.o.now(),b=()=>{const T=o.o.now()-y;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=r[t[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=M)&&(!T.maxzoom||T.maxzoom>M)){const I=T,P=I.layout.get("symbol-z-elevate"),z=I.layout.get("symbol-sort-key").constantOr(1)!==void 0,O=I.layout.get("symbol-z-order"),B=O==="viewport-y"||O==="auto"&&!(O!=="viewport-y"&&z),N=I.layout.get("text-allow-overlap")||I.layout.get("icon-allow-overlap")||I.layout.get("text-ignore-placement")||I.layout.get("icon-ignore-placement"),H=B&&N,j=this._inProgressLayer=this._inProgressLayer||new Os(I),Z=o.B(T.source,T.scope);if(j.continuePlacement(P||H?p[Z]:u[Z],this.placement,this._showCollisionBoxes,T,b,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ed=512/o.al/2;class Ru{constructor(t,r,u){this.tileID=t,this.bucketInstanceId=u,this.index=new o.c3(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const p=t.canonical.x*o.al,_=t.canonical.y*o.al;for(let y=0;y<r.length;y++){const{key:b,crossTileID:T,tileAnchorX:M,tileAnchorY:I}=r.get(y),P=Math.floor((p+M)*Ed),z=Math.floor((_+I)*Ed);this.index.add(P,z),this.keys.push(b),this.crossTileIDs.push(T)}this.index.finish()}findMatches(t,r,u){const p=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),_=Ed/Math.pow(2,r.canonical.z-this.tileID.canonical.z),y=r.canonical.x*o.al,b=r.canonical.y*o.al;for(let T=0;T<t.length;T++){const M=t.get(T);if(M.crossTileID)continue;const{key:I,tileAnchorX:P,tileAnchorY:z}=M,O=Math.floor((y+P)*_),B=Math.floor((b+z)*_),N=this.index.range(O-p,B-p,O+p,B+p).sort(((H,j)=>H-j));for(const H of N){const j=this.crossTileIDs[H];if(this.keys[H]===I&&!u.has(j)){u.add(j),M.crossTileID=j;break}}}}}class Wr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class cs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const u in this.indexes){const p=this.indexes[u],_={};for(const y in p){const b=p[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+r),_[b.tileID.key]=b}this.indexes[u]=_}this.lng=t}addBucket(t,r,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<r.symbolInstances.length;_++)r.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const p=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const y=this.indexes[_];if(Number(_)>t.overscaledZ)for(const b in y){const T=y[b];T.tileID.isChildOf(t)&&T.findMatches(r.symbolInstances,t,p)}else{const b=y[t.scaledTo(Number(_)).key];b&&b.findMatches(r.symbolInstances,t,p)}}for(let _=0;_<r.symbolInstances.length;_++){const y=r.symbolInstances.get(_);y.crossTileID||(y.crossTileID=u.generate(),p.add(y.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ru(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const u of r.crossTileIDs)this.usedCrossTileIDs[t].delete(u)}removeStaleBuckets(t){let r=!1;for(const u in this.indexes){const p=this.indexes[u];for(const _ in p)t[p[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[_]),delete p[_],r=!0)}return r}}class Fs{constructor(){this.layerIndexes={},this.crossTileIDs=new Wr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,u,p){let _=this.layerIndexes[t.fqid];_===void 0&&(_=this.layerIndexes[t.fqid]=new cs);let y=!1;const b={};p.name!=="globe"&&_.handleWrapJump(u);for(const T of r){const M=T.getBucket(t);M&&t.fqid===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(T.tileID,M,this.crossTileIDs)&&(y=!0),b[M.bucketInstanceId]=!0)}return _.removeStaleBuckets(b)&&(y=!0),y}pruneUnusedLayers(t){const r={};t.forEach((u=>{r[u]=!0}));for(const u in this.layerIndexes)r[u]||delete this.layerIndexes[u]}}const lr=771;class xi{constructor(t,r,u,p){this.blendFunction=t,this.blendColor=r.toNonPremultipliedRenderColor(null),this.mask=u,this.blendEquation=p}}xi.Replace=[1,0,1,0],xi.disabled=new xi(xi.Replace,o.ao.transparent,[!1,!1,!1,!1]),xi.unblended=new xi(xi.Replace,o.ao.transparent,[!0,!0,!0,!0]),xi.alphaBlended=new xi([1,lr,1,lr],o.ao.transparent,[!0,!0,!0,!0]),xi.alphaBlendedNonPremultiplied=new xi([770,lr,770,lr],o.ao.transparent,[!0,!0,!0,!0]),xi.multiply=new xi([774,0,774,0],o.ao.transparent,[!0,!0,!0,!0]),xi.additive=new xi([1,1,1,1],o.ao.transparent,[!0,!0,!0,!0]);class Ut{constructor(t,r,u){this.func=t,this.mask=r,this.range=u}}Ut.ReadOnly=!1,Ut.ReadWrite=!0,Ut.disabled=new Ut(519,Ut.ReadOnly,[0,1]);const Bs=7680;class li{constructor(t,r,u,p,_,y){this.test=t,this.ref=r,this.mask=u,this.fail=p,this.depthFail=_,this.pass=y}}li.disabled=new li({func:519,mask:0},0,0,Bs,Bs,Bs);const Tc=1029,Du=2305;class ii{constructor(t,r,u){this.enable=t,this.mode=r,this.frontFace=u}}function Pu(c,t){const r=o.c9(c,3);o.cb(c,t),o.cf(c,3,r)}function Ch(c,t){const r=o.c6([]);return o.c7(r,r,-t),o.c8(r,r,-c),r}function Vf(c,t){const r=[c[0],c[1],0],u=[t[0],t[1],0];if(o.ag(r)>=1e-15){const y=o.aw([],r);o.c4(u,y,o.bI(u,y)),t[0]=u[0],t[1]=u[1]}const p=o.bH([],t,c);if(o.c5(p)<1e-15)return null;const _=Math.atan2(-p[1],p[0]);return Ch(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),_)}ii.disabled=new ii(!1,Tc,Du),ii.backCCW=new ii(!0,Tc,Du),ii.backCW=new ii(!0,Tc,2304),ii.frontCW=new ii(!0,1028,2304),ii.frontCCW=new ii(!0,1028,Du);class ks{constructor(t,r){this.position=t,this.orientation=r}get position(){return this._position}set position(t){if(t){const r=t instanceof o.ae?t:new o.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(r.x=o.bS(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(t,r,u){if(this.orientation=null,!this.position)return;const p=this.position,_=u||(this._elevation?this._elevation.getAtPointOrZero(o.ae.fromLngLat(t)):0),y=o.ae.fromLngLat(t,_),b=[y.x-p.x,y.y-p.y,y.z-p.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=Vf(b,r)}setPitchBearing(t,r){this.orientation=Ch(o.an(t),o.an(-r))}}class Ad{constructor(t,r){this._transform=o.bz([]),this.orientation=r,this.position=t}get mercatorPosition(){const t=this.position;return new o.ae(t[0],t[1],t[2])}get position(){const t=o.c9(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var r;t&&o.cf(this._transform,3,[(r=t)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||o.c6([]),t&&Pu(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),r=this.right();return{bearing:Math.atan2(-r[1],r[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,r){this._orientation=Ch(t,r),Pu(this._transform,this._orientation)}forward(){const t=o.c9(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=o.c9(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=o.c9(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,r){const u=new Float64Array(16);return o.bk(u,this.getWorldToCamera(t,r)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,r,u){const p=this.position;o.c4(p,p,-t);const _=new Float64Array(16);return o.bp(_,[u,u,u]),o.bq(_,_,p),_[10]*=r,_}getWorldToCamera(t,r){const u=new Float64Array(16),p=new Float64Array(4),_=this.position;return o.ca(p,this._orientation),o.c4(_,_,-t),o.cb(u,p),o.bq(u,u,_),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=r,u[9]*=r,u[10]*=r,u[11]*=r,u}getCameraToClipPerspective(t,r,u,p){const _=new Float64Array(16);return o.cc(_,t,r,u,p),_}getCameraToClipOrthographic(t,r,u,p,_,y){const b=new Float64Array(16);return o.cd(b,t,r,u,p,_,y),b}getDistanceToElevation(t,r=!1){const u=t===0?0:o.ce(t,r?o.a_(this.position[1]):this.position[1]),p=this.forward();return(u-this.position[2])/p[2]}clone(){return new Ad([...this.position],[...this.orientation])}}const ca={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Da{constructor(t=0,r=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=u,this.right=p}interpolate(t,r,u){return r.top!=null&&t.top!=null&&(this.top=o.ak(t.top,r.top,u)),r.bottom!=null&&t.bottom!=null&&(this.bottom=o.ak(t.bottom,r.bottom,u)),r.left!=null&&t.left!=null&&(this.left=o.ak(t.left,r.left,u)),r.right!=null&&t.right!=null&&(this.right=o.ak(t.right,r.right,u)),this}getCenter(t,r){const u=o.aA((this.left+t-this.right)/2,0,t),p=o.aA((this.top+r-this.bottom)/2,0,r);return new o.P(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Da(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Sc=15;class Ea{constructor(t,r,u,p,_,y,b){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=u??0,this._maxPitch=p??60,this.setProjection(y),this.setMaxBounds(b),this.width=0,this.height=0,this._center=new o.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Da,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ad,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Ea(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Sc}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,r=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(t||u)&&this._constrainCamera(r),this._calcMatrices()}getProjection(){return o.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=o.cl(this.projectionOptions);const u=this.getProjection(),p=!o.bx(r,u);return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.cl({name:"mercator"});const r=t!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bS(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const r=-t*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=o.cm(),o.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=o.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=o.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._setZoom(r),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,r=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!r||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;r||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let p=0,_=0;for(let y=0;y<r.length;y++){const b=new o.P(r[y][0]*this.width,u+r[y][1]*(this.height-u)),T=t.pointCoordinate(b);if(!T)continue;const M=1/Math.hypot(T[0]-this._camera.position[0],T[1]-this._camera.position[1]);p+=T[3]*M,_+=M}return _===0?NaN:p/_}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,r=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*r,p=this._mercatorZfromZoom(t),_=this._mercatorZfromZoom(this._maxZoom),y=Math.max(p-u,_);this._setZoom(this._zoomFromMercatorZ(y))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let u;u=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];const p=o.ag(o.av([],this._camera.position,u));return o.aA(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let r=!1;if(t.orientation&&!o.co(t.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(t.orientation)),t.position){const u=[t.position.x,t.position.y,t.position.z];o.cp(u,this._camera.position)||(this._setCameraPosition(u),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,r=new ks;return r.position=new o.ae(t[0],t[1],t[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(t){if(!o.cq(t))return!1;o.cr(t,t);const r=o.cs([],[0,0,-1],t),u=o.cs([],[0,-1,0],t);if(u[2]<0)return!1;const p=Vf(r,u);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(t){const r=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;t[2]=o.aA(t[2],p/u,p/r),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,u){this._unmodified=!1,this._edgeInsets.interpolate(t,r,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new o.ct(0,t)];if(this.renderWorldCopies){const u=this.pointCoordinate(new o.P(0,0)),p=this.pointCoordinate(new o.P(this.width,0)),_=this.pointCoordinate(new o.P(this.width,this.height)),y=this.pointCoordinate(new o.P(0,this.height)),b=Math.floor(Math.min(u.x,p.x,_.x,y.x)),T=Math.floor(Math.max(u.x,p.x,_.x,y.x)),M=1;for(let I=b-M;I<=T+M;I++)I!==0&&r.push(new o.ct(I,t))}return r}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,r,u){let p=[];const _=u!=null,y=!_;if(y&&this.zoom<r||_&&u[0]===0&&u[1]===0)return p;const b=new Set,T=(I,P,z,O,B)=>{const N=o.cX(P,I,z,O,B);b.has(N)||(p.push(new o.aP(I,P,z,O,B)),b.add(N))};for(let I=0;I<t.length;I++){const P=t[I];if(y&&P.canonical.z!==r)continue;const z=P.canonical,O=P.overscaledZ,B=P.wrap,N=1<<z.z,H=z.x+1<N,j=z.x>0,Z=z.y+1<N,K=z.y>0,W=P.wrap-(j?0:1),se=P.wrap+(H?0:1),Q=j?z.x-1:N-1,ce=H?z.x+1:0;if(_)u[0]<0?(T(O,se,z.z,ce,z.y),u[1]<0&&Z&&(T(O,B,z.z,z.x,z.y+1),T(O,se,z.z,ce,z.y+1)),u[1]>0&&K&&(T(O,B,z.z,z.x,z.y-1),T(O,se,z.z,ce,z.y-1))):u[0]>0?(T(O,W,z.z,Q,z.y),u[1]<0&&Z&&(T(O,B,z.z,z.x,z.y+1),T(O,W,z.z,Q,z.y+1)),u[1]>0&&K&&(T(O,B,z.z,z.x,z.y-1),T(O,W,z.z,Q,z.y-1))):u[1]<0&&Z?T(O,B,z.z,z.x,z.y+1):K&&T(O,B,z.z,z.x,z.y-1);else{const ie=P.visibleQuadrants;1&ie&&(T(O,W,z.z,Q,z.y),K&&(T(O,B,z.z,z.x,z.y-1),T(O,W,z.z,Q,z.y-1))),2&ie&&(T(O,se,z.z,ce,z.y),K&&(T(O,B,z.z,z.x,z.y-1),T(O,se,z.z,ce,z.y-1))),4&ie&&(T(O,W,z.z,Q,z.y),Z&&(T(O,B,z.z,z.x,z.y+1),T(O,W,z.z,Q,z.y+1))),8&ie&&(T(O,se,z.z,ce,z.y),Z&&(T(O,B,z.z,z.x,z.y+1),T(O,se,z.z,ce,z.y+1)))}}const M=[];for(const I of p)p.some((P=>I.isChildOf(P)))||M.push(I);if(p=M.filter((I=>!t.some((P=>!!(I.overscaledZ<r&&P.isChildOf(I))||I.equals(P)||I.isChildOf(P))))),y){const I=1<<r,P=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),z=[I*P.x,I*P.y],O=4,B=O*O;p=p.filter((N=>{const H=N.canonical.x+.5-z[0],j=N.canonical.y+.5-z[1];return H*H+j*j<B}))}return p}extendTileCoverToNearPlane(t,r,u){const p=[],_=new Set;for(const Z of t)_.add(Z.key);const y=(Z,K,W,se,Q)=>{const ce=o.cX(K,Z,W,se,Q);_.has(ce)||(p.push(new o.aP(Z,K,W,se,Q)),_.add(ce))},b=t.reduce(((Z,K)=>Math.max(Z,K.overscaledZ)),u),T=1<<u,M=[new o.P(0,0),new o.P(o.al,0),new o.P(o.al,o.al),new o.P(0,o.al)],I=new o.P(0,0),P=new o.P(0,0),z=(Z,K)=>{const W=Math.floor(Z[0]),se=Math.floor(Z[1]),Q=(Z[0]-W)*o.al,ce=(Z[1]-se)*o.al,ie=Math.floor(K[0]),te=Math.floor(K[1]),ue=(K[0]-ie)*o.al,we=(K[1]-te)*o.al;for(let ve=-1;ve<=1;ve++){const Oe=W+ve;if(!(Oe<0||Oe>=T)){I.x=Q-ve*o.al,P.x=ue-(Oe-ie)*o.al;for(let ze=-1;ze<=1;ze++){const je=se+ze;I.y=ce-ze*o.al,P.y=we-(je-te)*o.al,o.cY(I,P,M)&&y(b,0,u,Oe,je)}}}},O=r.points,B=O[o.cu],N=O[o.cv],H=this._projectToGround(B,O[o.cw]),j=this._projectToGround(N,O[o.cx]);return z(B,H),z(N,j),p}_projectToGround(t,r){return o.cy(o.cz(),t,r,t[2]/(t[2]-r[2]))}coveringTiles(t){let r=this.coveringZoomLevel(t);const u=r,p=this.elevation&&this.elevation.exaggeration(),_=p&&!t.isTerrainDEM,y=this.projection.name==="mercator";if(t.minzoom!==void 0&&r<t.minzoom)return[];t.maxzoom!==void 0&&r>t.maxzoom&&(r=t.maxzoom);const b=this.locationCoordinate(this.center),T=this.center.lat,M=1<<r,I=[M*b.x,M*b.y,0],P=this.projection.name==="globe",z=!P,O=o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,z),B=P?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),N=M*o.ce(1,this.center.lat),H=this._camera.position[2]/o.ce(1,this.center.lat),j=[M*B.x,M*B.y,H*(z?1:N)],Z=P||p,K=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),W=this.isLODDisabled(!0)?r:0;let se;if(this._elevation&&t.isTerrainDEM)se=1e4*this._elevation.exaggeration();else if(this._elevation){const ge=this._elevation.getMinMaxForVisibleTiles();se=ge?ge.max:this._centerAltitude}else se=this._centerAltitude;const Q=t.isTerrainDEM?-se:this._elevation?this._elevation.getMinElevationBelowMSL():0,ce=this.projection.isReprojectedInTileSpace?o.cB(this):1,ie=ge=>{const Re=new o.ae(ge.x+25e-6,ge.y,ge.z),it=new o.ae(ge.x,ge.y+25e-6,ge.z),Je=ge.toLngLat(),vt=Re.toLngLat(),Ze=it.toLngLat(),$e=this.locationCoordinate(Je),xt=this.locationCoordinate(vt),Mt=this.locationCoordinate(Ze),St=Math.hypot(xt.x-$e.x,xt.y-$e.y),Rt=Math.hypot(Mt.x-$e.x,Mt.y-$e.y);return Math.sqrt(St*Rt)*ce/25e-6},te=ge=>{const Ge=se,Re=Q;return{aabb:o.cE(this,M,0,0,0,ge,Re,Ge,this.projection),zoom:0,x:0,y:0,minZ:Re,maxZ:Ge,wrap:ge,fullyVisible:!1}},ue=[];let we=[];const ve=r,Oe=t.reparseOverscaled?u:r,ze=(H-this._centerAltitude)*N,je=ge=>{if(!this._elevation||!ge.tileID||!y)return;const Ge=this._elevation.getMinMaxForTile(ge.tileID),Re=ge.aabb;Ge?(Re.min[2]=Ge.min,Re.max[2]=Ge.max,Re.center[2]=(Re.min[2]+Re.max[2])/2):(ge.shouldSplit=Me(ge),ge.shouldSplit||(Re.min[2]=Re.max[2]=Re.center[2]=this._centerAltitude))},lt=(ge,Ge)=>{if(.707*Ge<ge)return 1;const Re=Ge/ge;return Re/(1.4144271570014144+(Math.pow(1.1,Re-1.4144271570014144+1)-1)/(1.1-1)-1)},Me=ge=>{if(ge.zoom<W)return!0;if(ge.zoom===ve)return!1;if(ge.shouldSplit!=null)return ge.shouldSplit;const Ge=ge.aabb.distanceX(j),Re=ge.aabb.distanceY(j);let it=ze,Je=1;if(P){it=ge.aabb.distanceZ(j);const Rt=Math.pow(2,ge.zoom),Kt=o.a_((ge.y+1)/Rt),Ti=o.a_(ge.y/Rt),fi=Math.min(Math.max(T,Kt),Ti),Qi=o.d0(fi)/o.d0(T);if(Je=fi===T?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Qi/this._mercatorScaleRatio),this.zoom<=o.cZ&&ge.zoom===ve-1&&Qi>=.9)return!0}else if(_&&(it=ge.aabb.distanceZ(j)*N),this.projection.isReprojectedInTileSpace&&u<=5){const Rt=Math.pow(2,ge.zoom),Kt=ie(new o.ae((ge.x+.5)/Rt,(ge.y+.5)/Rt));Je=Kt>.85?1:Kt}if(!y&&!P){const Rt=Math.sqrt(Ge*Ge+Re*Re+it*it);let Kt=(1<<ve-ge.zoom)*K*Je;return Kt*=lt(Math.max(it,ze),Rt),Rt<Kt}let vt=Number.MAX_VALUE,Ze=0;const $e=ge.aabb.getCorners(),xt=[];for(const Rt of $e){o.av(xt,Rt,j),P||(_?xt[2]*=N:xt[2]=ze);const Kt=o.bI(xt,this._camera.forward());Kt<vt&&(vt=Kt,Ze=Math.abs(xt[2]))}let Mt=(1<<ve-ge.zoom)*K*Je;if(Mt*=lt(Math.max(Ze,ze),vt),vt<Mt)return!0;const St=ge.aabb.closestPoint(I);return St[0]===I[0]&&St[1]===I[1]};if(this.renderWorldCopies)for(let ge=1;ge<=3;ge++)ue.push(te(-ge)),ue.push(te(ge));for(ue.push(te(0));ue.length>0;){const ge=ue.pop(),Ge=ge.x,Re=ge.y;let it=ge.fullyVisible;const Je=()=>this.projection.name==="globe"&&(ge.y===0||ge.y===(1<<ge.zoom)-1);if(!it){let vt=Z?ge.aabb.intersects(O):ge.aabb.intersectsFlat(O);if(vt===0&&Je()){const Ze=new o.cC(ge.zoom,Ge,Re);vt=o.cD(this,M,Ze,!0).intersects(O)}if(vt===0)continue;it=vt===2}if(ge.zoom!==ve&&Me(ge))for(let vt=0;vt<4;vt++){const Ze=(Ge<<1)+vt%2,$e=(Re<<1)+(vt>>1),xt={aabb:y?ge.aabb.quadrant(vt):o.cE(this,M,ge.zoom+1,Ze,$e,ge.wrap,ge.minZ,ge.maxZ,this.projection),zoom:ge.zoom+1,x:Ze,y:$e,wrap:ge.wrap,fullyVisible:it,tileID:void 0,shouldSplit:void 0,minZ:ge.minZ,maxZ:ge.maxZ};_&&!P&&(xt.tileID=new o.aP(ge.zoom+1===ve?Oe:ge.zoom+1,ge.wrap,ge.zoom+1,Ze,$e),je(xt)),ue.push(xt)}else{const vt=ge.zoom===ve?Oe:ge.zoom;if(t.minzoom&&t.minzoom>vt)continue;let Ze=0;if(!it){let St=Z?ge.aabb.intersectsPrecise(O):ge.aabb.intersectsPreciseFlat(O);if(St===0&&Je()){const Rt=new o.cC(ge.zoom,Ge,Re);St=o.cD(this,M,Rt,!0).intersectsPrecise(O)}if(St===0)continue;if(t.calculateQuadrantVisibility)if(O.containsPoint(ge.aabb.center))Ze=15;else for(let Rt=0;Rt<4;Rt++)ge.aabb.quadrant(Rt).intersects(O)!==0&&(Ze|=1<<Rt)}const $e=I[0]-(.5+Ge+(ge.wrap<<ge.zoom))*(1<<r-ge.zoom),xt=I[1]-.5-Re,Mt=ge.tileID?ge.tileID:new o.aP(vt,ge.wrap,ge.zoom,Ge,Re);t.calculateQuadrantVisibility&&(Mt.visibleQuadrants=Ze),we.push({tileID:Mt,distanceSq:$e*$e+xt*xt})}}if(this.fogCullDistSq){const ge=this.fogCullDistSq,Ge=this.horizonLineFromTop();we=we.filter((Re=>{const it=[0,0,0,1],Je=[o.al,o.al,0,1],vt=this.calculateFogTileMatrix(Re.tileID.toUnwrapped());o.aC(it,it,vt),o.aC(Je,Je,vt);const Ze=o.cF([],it,Je),$e=o.cG([],it,Je),xt=o.c_(Ze,$e);if(xt===0)return!0;let Mt=!1;const St=this._elevation;if(St&&xt>ge&&Ge!==0){const Rt=this.calculateProjMatrix(Re.tileID.toUnwrapped());let Kt;t.isTerrainDEM||(Kt=St.getMinMaxForTile(Re.tileID)),Kt||(Kt={min:Q,max:se});const Ti=o.cH(this.rotation),fi=[Ti[0]*o.al,Ti[1]*o.al,Kt.max];o.af(fi,fi,Rt),Mt=(1-fi[1])*this.height*.5<Ge}return xt<ge||Mt}))}return we.sort(((ge,Ge)=>ge.distanceSq-Ge.distanceSq)).map((ge=>ge.tileID))}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const r=o.aA(t.lat,-o.cI,o.cI),u=this.projection.project(t.lng,r);return new o.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,r){let u,p;const _=this.centerPoint;if(this.projection.name==="globe"){const b=this.worldSize;u=(r.x-_.x)/b,p=(r.y-_.y)/b}else{const b=this.pointCoordinate(r),T=this.pointCoordinate(_);u=b.x-T.x,p=b.y-T.y}const y=this.locationCoordinate(t);this.setLocation(new o.ae(y.x-u,y.y-p))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,r){return this.projection.locationPoint(this,t,r)}locationPoint3D(t,r){return this.projection.locationPoint(this,t,r,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,r){return this.coordinateLocation(this.pointCoordinate3D(t,r))}locationCoordinate(t,r){const u=r?o.ce(r,t.lat):void 0,p=this.projection.project(t.lng,t.lat);return new o.ae(p.x,p.y,u)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,r){const u=r??this._centerAltitude,p=[t.x,t.y,0,1],_=[t.x,t.y,1,1];o.aC(p,p,this.pixelMatrixInverse),o.aC(_,_,this.pixelMatrixInverse);const y=_[3];o.cJ(p,p,1/p[3]),o.cJ(_,_,1/y);const b=p[2],T=_[2];return{p0:p,p1:_,t:b===T?0:(u-b)/(T-b)}}screenPointToMercatorRay(t){const r=[t.x,t.y,0,1],u=[t.x,t.y,1,1];return o.aC(r,r,this.pixelMatrixInverse),o.aC(u,u,this.pixelMatrixInverse),o.cJ(r,r,1/r[3]),o.cJ(u,u,1/u[3]),r[2]=o.ce(r[2],this._center.lat)*this.worldSize,u[2]=o.ce(u[2],this._center.lat)*this.worldSize,o.cJ(r,r,1/this.worldSize),o.cJ(u,u,1/this.worldSize),new o.ax([r[0],r[1],r[2]],o.aw([],o.av([],u,r)))}rayIntersectionCoordinate(t){const{p0:r,p1:u,t:p}=t,_=o.ce(r[2],this._center.lat),y=o.ce(u[2],this._center.lat);return new o.ae(o.ak(r[0],u[0],p)/this.worldSize,o.ak(r[1],u[1],p)/this.worldSize,o.ak(_,y,p))}pointCoordinate(t,r=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,r)}pointCoordinate3D(t,r){if(!this.elevation)return this.pointCoordinate(t,r);let u=this.projection.pointCoordinate3D(this,t.x,t.y);if(u)return new o.ae(u[0],u[1],u[2]);let p=0,_=this.horizonLineFromTop();if(t.y>_)return this.pointCoordinate(t,r);const y=.02*_,b=t.clone();for(let T=0;T<10&&_-p>y;T++){b.y=o.ak(p,_,.66);const M=this.projection.pointCoordinate3D(this,b.x,b.y);M?(_=b.y,u=M):p=b.y}return u?new o.ae(u[0],u[1],u[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=o.cK)return!this.isPointAboveHorizon(t);const r=this.pointCoordinate(t);return r.y>=0&&r.y<=1}_coordinatePoint(t,r){const u=r&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,p=[t.x*this.worldSize,t.y*this.worldSize,u+t.toAltitude(),1];return o.aC(p,p,this.pixelMatrix),p[3]>0?new o.P(p[0]/p[3],p[1]/p[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:r}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,_=this.pointLocation3D(new o.P(r,t)),y=this.pointLocation3D(new o.P(p,t)),b=this.pointLocation3D(new o.P(p,u)),T=this.pointLocation3D(new o.P(r,u));let M=Math.min(_.lng,y.lng,b.lng,T.lng),I=Math.max(_.lng,y.lng,b.lng,T.lng),P=Math.min(_.lat,y.lat,b.lat,T.lat),z=Math.max(_.lat,y.lat,b.lat,T.lat);const O=Math.pow(2,-this.zoom)/16*270,B=this.projection.name==="globe"?1:4,N=(H,j,Z,K,W)=>{const se=(H+Z)/2,Q=(j+K)/2,ce=new o.P(se,Q),{lng:ie,lat:te}=this.pointLocation3D(ce),ue=Math.max(0,M-ie,P-te,ie-I,te-z);M=Math.min(M,ie),I=Math.max(I,ie),P=Math.min(P,te),z=Math.max(z,te),(W<B||ue>O)&&(N(H,j,se,Q,W+1),N(se,Q,Z,K,W+1))};if(N(r,t,p,t,1),N(p,t,p,u,1),N(p,u,r,u,1),N(r,u,r,t,1),this.projection.name==="globe"){const[H,j]=o.cL(this);H?(z=90,I=180,M=-180):j&&(P=-90,I=180,M=-180)}return new o.aI(new o.aS(M,P),new o.aS(I,z))}_getBoundsRectangular(t,r){const{top:u,left:p}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,b=new o.P(p,u),T=new o.P(y,u),M=new o.P(y,_),I=new o.P(p,_);let P=this.pointCoordinate(b,t),z=this.pointCoordinate(T,t);const O=this.pointCoordinate(M,r),B=this.pointCoordinate(I,r),N=(H,j)=>(j.y-H.y)/(j.x-H.x);return P.y>1&&z.y>=0?P=new o.ae((1-B.y)/N(B,P)+B.x,1):P.y<0&&z.y<=1&&(P=new o.ae(-B.y/N(B,P)+B.x,0)),z.y>1&&P.y>=0?z=new o.ae((1-O.y)/N(O,z)+O.x,1):z.y<0&&P.y<=1&&(z=new o.ae(-O.y/N(O,z)+O.x,0)),new o.aI().extend(this.coordinateLocation(P)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(O))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const r=t.visibleDemTiles.reduce(((u,p)=>{if(p.dem){const _=p.dem.tree;u.min=Math.min(u.min,_.minimums[0]),u.max=Math.max(u.max,_.maximums[0])}return u}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(r.min*t.exaggeration(),r.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const r=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-r*(1-this._horizonShift);return t?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-o.cI,this.maxLat=o.cI,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aF(this.minLng)*this.tileSize,this.worldMaxX=o.aF(this.maxLng)*this.tileSize,this.worldMinY=o.aJ(this.maxLat)*this.tileSize,this.worldMaxY=o.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,r){return this.projection.createTileMatrix(this,r,t)}calculateDistanceTileData(t){const r=t.key,u=this._distanceTileDataCache;if(u[r])return u[r];const p=t.canonical,_=1/this.height,y=this.cameraWorldSize,b=y/this.zoomScale(p.z),T=(p.x+Math.pow(2,p.z)*t.wrap)*b,M=p.y*b,I=this.point;I.x*=y/this.worldSize,I.y*=y/this.worldSize;const P=this.angle,z=Math.sin(-P),O=-Math.cos(-P);return u[r]={bearing:[z,O],center:[(I.x-T)*_,(I.y-M)*_],scale:b/o.al*_},u[r]}calculateFogTileMatrix(t){const r=t.key,u=this._fogTileMatrixCache;if(u[r])return u[r];const p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return o.aB(p,this.worldToFogMatrix,p),u[r]=new Float32Array(p),u[r]}calculateProjMatrix(t,r=!1,u=!1){const p=t.key;let _;if(_=u?this._expandedProjMatrixCache:r?this._alignedProjMatrixCache:this._projMatrixCache,_[p])return _[p];const y=this.calculatePosMatrix(t,this.worldSize);let b;return b=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:r?this.alignedProjMatrix:this.projMatrix,o.aB(y,b,y),_[p]=new Float32Array(y),_[p]}calculatePixelsToTileUnitsMatrix(t){const r=t.tileID.key,u=this._pixelsToTileUnitsCache;if(u[r])return u[r];const p=o.cM(t,this);return u[r]=p,u[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,r=o.bp([],[t,t,t]);return o.aB(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const r=o.ce(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(r),p=this._camera.forward(),_=o.ce(1,this._center.lat);u[2]/=_,p[2]/=_,o.aw(p,p);const y=t.raycast(u,p,t.exaggeration());if(y){const b=o.bG([],u,p,y),T=new o.ae(b[0],b[1],o.ce(b[2],o.a_(b[1]))),M=(T.z+o.ag([T.x-u[0],T.y-u[1],T.z-u[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(M),this._centerAltitude=T.toAltitude(),this._center=this.coordinateLocation(T),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const r=this._elevation,u=o.ce(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(u),_=r.getAtPointOrZero(new o.ae(...p)),y=this.pixelsPerMeter/this.worldSize*_,b=this._minimumHeightOverTerrain(),T=p[2]-y;if(T<=b)if(T<0||t){const M=this.locationCoordinate(this._center,this._centerAltitude),I=[p[0],p[1],M.z-p[2]],P=o.ag(I);I[2]-=(b-T)/this._pixelsPerMercatorPixel;const z=o.ag(I);if(z===0)return;o.c4(I,I,P/z*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],M.z*this._pixelsPerMercatorPixel-I[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const z=this.center;return z.lat=o.aA(z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(z.lng=o.aA(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}const r=this._unmodified,{x:u,y:p}=this.point;let _=0,y=u,b=p;const T=this.width/2,M=this.height/2,I=this.worldMinY*this.scale,P=this.worldMaxY*this.scale;if(p-M<I&&(b=I+M),p+M>P&&(b=P-M),P-I<this.height&&(_=Math.max(_,this.height/(P-I)),b=(P+I)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const z=this.worldMinX*this.scale,O=this.worldMaxX*this.scale,B=this.worldSize/2-(z+O)/2;y=(u+B+this.worldSize)%this.worldSize-B,y-T<z&&(y=z+T),y+T>O&&(y=O-T),O-z<this.width&&(_=Math.max(_,this.width/(O-z)),y=(O+z)/2)}y===u&&b===p||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(y,b))),_&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.ce(1,this.center.lat)/o.ce(1,o.d1));const p=o.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this.projection.zAxisUnit==="meters"?u:1,y=this._camera.getWorldToCamera(this.worldSize,_);let b;const T=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(T[8]=2*-t.x/this.width,T[9]=2*t.y/this.height,this.isOrthographic){let te=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ue=te*this.aspect,we=-ue,ve=-te;ue-=t.x,we-=t.x,te+=t.y,ve+=t.y,b=this._camera.getCameraToClipOrthographic(we,ue,ve,te,this._nearZ,this._farZ),((Oe,ze,je,lt)=>{for(let Me=0;Me<16;Me++)Oe[Me]=o.ak(ze[Me],je[Me],lt)})(b,b,T,o.c$(this.pitch>=Sc?1:this.pitch/Sc))}else b=T;const M=o.cO([],T,y);let I=o.cO([],b,y);if(this.projection.isReprojectedInTileSpace){const te=this.locationCoordinate(this.center),ue=o.bz([]);o.bq(ue,ue,[te.x*this.worldSize,te.y*this.worldSize,0]),o.aB(ue,ue,o.cP(this)),o.bq(ue,ue,[-te.x*this.worldSize,-te.y*this.worldSize,0]),o.aB(I,I,ue),o.aB(M,M,ue),this.inverseAdjustmentMatrix=o.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cR([],I,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=I,this.invProjMatrix=o.bk(new Float64Array(16),this.projMatrix),r){const te=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);te[8]=2*-t.x/this.width,te[9]=2*t.y/this.height,this.expandedFarZProjMatrix=o.cO([],te,y)}else this.expandedFarZProjMatrix=this.projMatrix;const P=o.bk([],b);this.frustumCorners=o.cS.fromInvProjectionMatrix(P,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const z=new Float32Array(16);o.bz(z),o.cR(z,z,[1,-1,1]),o.cT(z,z,this._pitch),o.bA(z,z,this.angle);const O=o.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.by(O);const B=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;O[8]=2*-t.x/this.width,O[9]=2*(t.y+B)/this.height,this.skyboxMatrix=o.aB(z,O,z);const N=this.point,H=N.x,j=N.y,Z=this.width%2/2,K=this.height%2/2,W=Math.cos(this.angle),se=Math.sin(this.angle),Q=H-Math.round(H)+W*Z+se*K,ce=j-Math.round(j)+W*K+se*Z,ie=new Float64Array(I);if(o.bq(ie,ie,[Q>.5?Q-1:Q,ce>.5?ce-1:ce,0]),this.alignedProjMatrix=ie,I=o.bB(),o.cR(I,I,[this.width/2,-this.height/2,1]),o.bq(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=o.bB(),o.cR(I,I,[1,-1,1]),o.bq(I,I,[-1,-1,0]),o.cR(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=o.aB(new Float64Array(16),this.labelPlaneMatrix,M),this._calcFogMatrices(),this._distanceTileDataCache={},I=o.bk(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=I,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cU(this);const te=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.af(te,te,y),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=I;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,u=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,_=[t,t,r];o.c4(_,_,p),o.c4(u,u,-1),o.cV(u,u,_);const y=o.bB();o.bq(y,y,u),o.cR(y,y,_),this.mercatorFogMatrix=y,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,r,p)}_computeCameraPosition(t){const r=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),p=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*r-t/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-u[0]*_,p.y/this.worldSize-u[1]*_,t/this.worldSize*this._centerAltitude-u[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],p=t[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(_=Math.min((r-u)/p,1)),this._camera.position=o.bG([],this._camera.position,t,_),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,r=this._camera.forward(),{pitch:u,bearing:p}=this._camera.getPitchBearing(),_=o.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,y=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.an(this._maxPitch)),b=Math.max((t[2]-_)/Math.cos(u),y),T=this._zoomFromMercatorZ(b);o.bG(t,t,r,b),this._pitch=o.aA(u,o.an(this.minPitch),o.an(this.maxPitch)),this.angle=o.bS(p,-Math.PI,Math.PI),this._setZoom(o.aA(T,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let r=0,u=o.cK,p=0,_=1/0;for(;u-r>1e-6&&u>r;){const y=r+.5*(u-r),b=this.tileSize*Math.pow(2,y),T=this.getCameraToCenterDistance(this.projection,y,b),M=this.scaleZoom(T/(Math.max(0,t)*this.tileSize)),I=Math.abs(y-M);I<_&&(_=I,p=y),y<M?r=y:u=y}return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,r){const u=Math.min(t.x,r.x),p=Math.max(t.x,r.x),_=Math.min(t.y,r.y),y=Math.max(t.y,r.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const b=[new o.P(u,_),new o.P(p,y),new o.P(u,y),new o.P(p,_)],T=this.renderWorldCopies?-3:0,M=this.renderWorldCopies?4:1;for(const I of b){const P=this.pointRayIntersection(I);if(P.t<0)return!0;const z=this.rayIntersectionCoordinate(P);if(z.x<T||z.y<0||z.x>M||z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(t,r){const u=o.ag(o.av([],this._camera.position,t)),p=this._zoomFromMercatorZ(u)+r;return u-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){const t=(function([r,u,p],_){const y=[r,u,p,1];o.aC(y,y,_);const b=y[3]=Math.max(y[3],1e-6);return y[0]/=b,y[1]/=b,y[2]/=b,y})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,t))}}getCameraToCenterDistance(t,r=this.zoom,u=this.worldSize){const p=o.cN(t,r,this.width,this.height,1024),_=t.pixelSpaceConversion(this.center.lat,u,p);let y=.5/Math.tan(.5*this._fov)*this.height*_;return this.isOrthographic&&(y=o.ak(1,y,o.c$(this.pitch>=Sc?1:this.pitch/Sc))),y}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.aB(t,t,this.globeMatrix),t}getFrustum(t){return o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Mo=(c,t)=>{if(t>0&&c.terrain&&o.w("Cutoff is currently disabled on terrain"),t<=0||c.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const r=c.transform,u=Math.max(Math.abs(r._zoom-(c.minCutoffZoom-1)),1),p=r.isLODDisabled(!1)?o.ah(60,45,r.pitch):o.ah(30,15,r.pitch),_=r._farZ-r._nearZ,y=t*r.height,b=((1-(T=p))*r.cameraToCenterDistance+T*(r._farZ+y))*u;var T;return{shouldRenderCutoff:p<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(b-r._nearZ)/_,(b-y-r._nearZ)/_]}}},ia={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class G1{constructor(t,r){this.aabb=t,this.lastCascade=r}}class H1{add(t,r){const u=this.receivers[t.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],r.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],r.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],r.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],r.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],r.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],r.max[2])):this.receivers[t.key]=new G1(r,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,r,u){const p=o.d8.fromPoints(t.points);let _=0;for(const y in this.receivers){const b=this.receivers[y];if(!b||!p.intersectsAabb(b.aabb))continue;b.aabb.min=p.closestPoint(b.aabb.min),b.aabb.max=p.closestPoint(b.aabb.max);const T=b.aabb.getCorners();for(let M=0;M<u.length;M++){let I=!0;for(const P of T){const z=[P[0]*r,P[1]*r,P[2]];if(o.af(z,z,u[M].matrix),z[0]<-1||z[0]>1||z[1]<-1||z[1]>1){I=!1;break}}if(b.lastCascade=M,_=Math.max(_,M),I)break}}return _+1}}class Lu{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new H1,this._depthMode=new Ut(t.context.gl.LEQUAL,Ut.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),t.tp.registerParameter(ia,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(ia,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(ia,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,r){const u=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const p=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||p<=0||(this._shadowLayerCount=u.style.order.reduce(((B,N)=>{const H=u.style._mergedLayers[N];return B+(H.hasShadowPass()&&!H.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const _=u.context,y=ia.shadowMapResolution,b=ia.shadowMapResolution;if(this._cascades.length===0||ia.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let B=0;B<ia.cascadeCount;++B){const N=u._shadowMapDebug,H=_.gl,j=_.createFramebuffer(y,b,N,"texture"),Z=new o.T(_,{width:y,height:b,data:null},H.DEPTH_COMPONENT16);if(j.depthAttachment.set(Z.texture),N){const K=new o.T(_,{width:y,height:b,data:null},H.RGBA8);j.colorAttachment.set(K.texture)}this._cascades.push({framebuffer:j,texture:Z,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cA,scale:0})}}this.shadowDirection=q1(r);let T=0;if(t.elevation){const B=t.elevation,N=[1e4,-1e4];B.visibleDemTiles.filter((H=>H.dem)).forEach((H=>{const j=H.dem.tree;N[0]=Math.min(N[0],j.minimums[0]),N[1]=Math.max(N[1],j.maximums[0])})),N[0]!==1e4&&(T=(N[1]-N[0])*B.exaggeration())}const M=1.5*t.cameraToCenterDistance,I=3*M,P=new Float64Array(16);for(let B=0;B<this._cascades.length;++B){const N=this._cascades[B];let H=t.height/50,j=1;ia.cascadeCount===1?j=I:B===0?j=M:(H=M,j=I);const[Z,K]=Md(t,this.shadowDirection,H,j,ia.shadowMapResolution,T);N.scale=t.scale,N.matrix=Z,N.boundingSphereRadius=K,o.bk(P,N.matrix),N.frustum=o.cA.fromInvProjectionMatrix(P,1,0,!0),N.far=j}const z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[z].far,this._cascades[z].far],this._uniformValues.u_shadow_intensity=p,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ia.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ia.shadowMapResolution,this._uniformValues.u_shadowmap_0=ca.ShadowMap0,this._uniformValues.u_shadowmap_1=ca.ShadowMap0+1,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const O=u.transform.elevation;for(const B of this._groundShadowTiles){let N={min:0,max:0};if(O){const H=O.getMinMaxForTile(B);H&&(N=H)}this.addShadowReceiver(B.toUnwrapped(),N.min,N.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,r){if(!this.enabled)return;const u=this.painter,p=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),p.viewport.set([0,0,ia.shadowMapResolution,ia.shadowMapResolution]);for(let _=0;_<this._numCascadesToRender;++_){u.currentShadowCascade=_,p.bindFramebuffer.set(this._cascades[_].framebuffer.framebuffer),p.clear({color:o.ao.white,depth:1});for(const y of t.order){const b=t._mergedLayers[y];if(!b.hasShadowPass()||b.isHidden(u.transform.zoom))continue;const T=t.getLayerSourceCache(b),M=T?r[T.id]:void 0;(b.type==="model"||M&&M.length)&&u.renderLayer(u,T,b,M)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,r=t.style,u=t.context,p=u.gl,_=r.directionalLight,y=r.ambientLight;if(!_||!y)return;const b=[],T=Mo(t,t.longestCutoffRange);T.shouldRenderCutoff&&b.push("RENDER_CUTOFF"),b.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&b.push("NORMAL_OFFSET");const M=Pa(r,_,y),I=new Ut(p.LEQUAL,Ut.ReadOnly,t.depthRangeFor3D),P=new li({func:p.EQUAL,mask:255},0,255,p.KEEP,p.KEEP,p.KEEP);for(const z of this._groundShadowTiles){const O=z.toUnwrapped(),B=t.isTileAffectedByFog(z),N=t.getOrCreateProgram("groundShadow",{defines:b,overrideFog:B});this.setupShadows(O,N),t.uploadCommonUniforms(u,N,O,null,T);const H={u_matrix:t.transform.calculateProjMatrix(O),u_ground_shadow_factor:M};N.draw(t,p.TRIANGLES,I,P,xi.multiply,ii.disabled,H,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?xi.unblended:xi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const r=this.painter.transform,u=r.calculatePosMatrix(t,r.worldSize);return o.aB(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(t){const r=o.by(t);return o.aB(r,this._cascades[this.painter.currentShadowCascade].matrix,t),r}setupShadows(t,r,u){if(!this.enabled)return;const p=this.painter.transform,_=this.painter.context,y=_.gl,b=this._uniformValues,T=new Float64Array(16),M=p.calculatePosMatrix(t,p.worldSize);for(let I=0;I<this._cascades.length;I++)o.aB(T,this._cascades[I].matrix,M),b[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(T),_.activeTexture.set(y.TEXTURE0+ca.ShadowMap0+I),this._cascades[I].texture.bindExtraParam(y.LINEAR,y.LINEAR,y.CLAMP_TO_EDGE,y.CLAMP_TO_EDGE,y.GREATER);if(this.useNormalOffset=!!u,this.useNormalOffset){const I=o.d6(t.canonical),P=2/p.tileSize*o.al/ia.shadowMapResolution,z=P*this._cascades[0].boundingSphereRadius,O=P*this._cascades[this._cascades.length-1].boundingSphereRadius,B=(u==="vector-tile"?1:3)*(function(N,H,j,Z,K){const W=o.aA((N-22)/-22,0,1);return .125*(1-W)+4*W})(p.zoom);b.u_shadow_normal_offset=[I,z*B,O*B],b.u_shadow_bias=[1e-4,.0012,.012]}else b.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(_,b)}setupShadowsFromMatrix(t,r,u=!1){if(!this.enabled)return;const p=this.painter.context,_=p.gl,y=this._uniformValues,b=new Float64Array(16);for(let T=0;T<ia.cascadeCount;T++)o.aB(b,this._cascades[T].matrix,t),y[T===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(b),p.activeTexture.set(_.TEXTURE0+ca.ShadowMap0+T),this._cascades[T].texture.bindExtraParam(_.LINEAR,_.LINEAR,_.CLAMP_TO_EDGE,_.CLAMP_TO_EDGE,_.GREATER);if(this.useNormalOffset=u,u){const T=ia.normalOffset;y.u_shadow_normal_offset=[1,T,T],y.u_shadow_bias=[6e-5,.0012,.012]}else y.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(p,y)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,r,u,p){if(p[2]>=0)return{};const _=(function(T,M,I){const P=I/(1<<T.canonical.z);return new o.d8([T.canonical.x*P+T.wrap*I,T.canonical.y*P+T.wrap*I,0],[(T.canonical.x+1)*P+T.wrap*I,(T.canonical.y+1)*P+T.wrap*I,M])})(t,r,u).getCorners(),y=r/-p[2];p[0]<0?(o.d7(_[0],_[0],[p[0]*y,0,0]),o.d7(_[3],_[3],[p[0]*y,0,0])):p[0]>0&&(o.d7(_[1],_[1],[p[0]*y,0,0]),o.d7(_[2],_[2],[p[0]*y,0,0])),p[1]<0?(o.d7(_[0],_[0],[0,p[1]*y,0]),o.d7(_[1],_[1],[0,p[1]*y,0])):p[1]>0&&(o.d7(_[2],_[2],[0,p[1]*y,0]),o.d7(_[3],_[3],[0,p[1]*y,0]));const b={};return b.vertices=_,b.planes=[Ns(_[1],_[0],_[4]),Ns(_[2],_[1],_[5]),Ns(_[3],_[2],_[6]),Ns(_[0],_[3],_[7])],b}addShadowReceiver(t,r,u){this._receivers.add(t,o.d8.fromTileIdAndHeight(t,r,u))}getMaxCascadeForTile(t){const r=this._receivers.get(t);return r&&r.lastCascade?r.lastCascade:0}}function Ns(c,t,r){const u=o.av([],r,t),p=o.av([],c,t),_=o.bH([],u,p),y=o.ag(_);return y===0?[0,0,1,0]:(o.c4(_,_,1/y),[_[0],_[1],_[2],-o.bI(_,t)])}function q1(c){const t=c.properties.get("direction"),r=o.d3(t.x,t.y,t.z);r[2]=o.aA(r[2],0,75);const u=o.d5([r[0],r[1],r[2]]);return o.d4(u.x,u.y,u.z)}function Pa(c,t,r){const u=t.properties.get("color-use-theme")==="none",p=t.properties.get("color"),_=t.properties.get("intensity"),y=t.properties.get("direction"),b=[y.x,y.y,y.z],T=r.properties.get("color-use-theme")==="none",M=r.properties.get("color"),I=r.properties.get("intensity"),P=Math.max(o.bI([0,0,1],b),0),z=[0,0,0];o.c4(z,M.toPremultipliedRenderColor(T?null:c.getLut(t.scope)).toArray01Linear().slice(0,3),I);const O=[0,0,0];return o.c4(O,p.toPremultipliedRenderColor(u?null:c.getLut(r.scope)).toArray01Linear().slice(0,3),P*_),o.da([z[0]>0?z[0]/(z[0]+O[0]):0,z[1]>0?z[1]/(z[1]+O[1]):0,z[2]>0?z[2]/(z[2]+O[2]):0])}function Md(c,t,r,u,p,_){const y=c.zoom,b=c.scale,T=c.worldSize,M=1/T,I=c.aspect,P=Math.sqrt(1+I*I)*Math.tan(.5*c.fovX),z=P*P,O=u-r,B=u+r;let N,H;z>O/B?(N=u,H=u*P):(N=.5*B*(1+z),H=.5*Math.sqrt(O*O+2*(u*u+r*r)*z+B*B*z*z));const j=c.projection.pixelsPerMeter(c.center.lat,T),Z=c._camera.getCameraToWorldMercator(),K=[0,0,-N*M];o.af(K,K,Z);let W=H*M;const se=c._edgeInsets;if(!(se.left===0&&se.top===0&&se.right===0&&se.bottom===0||se.left===se.right&&se.top===se.bottom)){const it=c._camera.getWorldToCamera(c.worldSize,c.projection.zAxisUnit==="meters"?j:1),Je=c._camera.getCameraToClipPerspective(c._fov,c.width/c.height,r,u);Je[8]=2*-c.centerOffset.x/c.width,Je[9]=2*c.centerOffset.y/c.height;const vt=new Float64Array(16);o.cO(vt,Je,it);const Ze=new Float64Array(16);o.bk(Ze,vt);const $e=o.cA.fromInvProjectionMatrix(Ze,T,y,!0);for(const xt of $e.points){const Mt=((Q=xt)[0]/=b,Q[1]/=b,Q[2]=o.ce(Q[2],c._center.lat),Q);W=Math.max(W,o.c5(o.d9([],K,Mt)))}}var Q;W*=p/(p-1);const ce=Math.acos(t[2]),ie=Math.atan2(-t[0],-t[1]),te=new Ad;te.position=K,te.setPitchBearing(ce,ie);const ue=te.getWorldToCamera(T,j),we=W*T,ve=Math.min(c._mercatorZfromZoom(17)*T*-2,-2*we),Oe=te.getCameraToClipOrthographic(-we,we,-we,we,ve,(we+_*j)/t[2]),ze=new Float64Array(16);o.aB(ze,Oe,ue);const je=o.d4(Math.floor(1e6*K[0])/1e6*T,Math.floor(1e6*K[1])/1e6*T,0),lt=.5*p,Me=[0,0,0];o.af(Me,je,ze),o.c4(Me,Me,lt);const ge=[Math.floor(Me[0]),Math.floor(Me[1]),Math.floor(Me[2])],Ge=[0,0,0];o.av(Ge,Me,ge),o.c4(Ge,Ge,-1/lt);const Re=new Float64Array(16);return o.bz(Re),o.bq(Re,Re,Ge),o.aB(ze,Re,ze),[ze,we]}class Hl extends o.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,r){return o.db(this.requestManager.transformRequest(r,o.R.Model).url).then((u=>{if(!u)return;const p=o.dc(u),_=new o.dd(t,r,void 0,void 0,p);return _.computeBoundsAndApplyParent(),_})).catch((u=>{if(u&&u.status===404)return null;this.fire(new o.y(new Error(`Could not load model ${t} from ${r}: ${u.message}`)))}))}load(t,r,u={forceReload:!1}){this.models[r]||(this.models[r]={});const p=Object.keys(t),_=[],y=[];for(const b of p){const T=t[b];this.hasURLBeenRequested(T)&&!u.forceReload||(this.modelByURL[T]={modelId:b,scope:r},_.push(this.loadModel(b,T)),y.push(b)),this.models[r][b]||(this.models[r][b]={model:null,numReferences:1})}this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+y.length,Promise.allSettled(_).then((b=>{for(let T=0;T<b.length;T++){const{status:M}=b[T];if(M==="rejected")continue;const{value:I}=b[T];this.models[r][y[T]]||(this.models[r][y[T]]={model:null,numReferences:1}),this.models[r][y[T]].model=I}this.numModelsLoading[r]-=y.length,this.fire(new o.z("data",{dataType:"style"}))})).catch((b=>{this.fire(new o.y(new Error(`Could not load models: ${b.message}`)))}))}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,r,u={exactIdMatch:!1}){return!!(u.exactIdMatch?this.getModel(t,r):this.getModelByURL(this.modelUris[r][t]))}getModel(t,r){return this.models[r]||(this.models[r]={}),this.models[r][t]?this.models[r][t].model:void 0}getModelByURL(t){if(!t)return null;const r=this.modelByURL[t];return r?this.models[r.scope][r.modelId].model:null}hasModelBeenAdded(t,r){return this.models[r]&&this.models[r][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,r,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const p=this.requestManager.normalizeModelURL(r);if((this.hasModel(t,u,{exactIdMatch:!0})||this.hasModelBeenAdded(t,u))&&this.modelUris[u][t]===p)this.models[u][t].numReferences++;else if(this.hasURLBeenRequested(p)){const{scope:_,modelId:y}=this.modelByURL[p];this.models[_][y].numReferences++}else this.modelUris[u][t]=p,this.load({[t]:this.modelUris[u][t]},u)}addModelURLs(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const u=this.modelUris[r];for(const p in t)u[p]=this.requestManager.normalizeModelURL(t[p])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const u={};for(const p of t)this.hasModel(p,r,{exactIdMatch:!0})||this.hasURLBeenRequested(p)?this.models[r][p].numReferences++:this.modelUris[r][p]&&!this.hasURLBeenRequested(p)?u[p]=this.modelUris[r][p]:!this.hasURLBeenRequested(p)&&o.de(p,!1)&&(this.modelUris[r][p]=this.requestManager.normalizeModelURL(p),u[p]=this.modelUris[r][p]);this.load(u,r)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,r,u=!1,p=!1){if(this.models[r]&&this.models[r][t]&&(this.models[r][t].numReferences--,this.models[r][t].numReferences===0||p)){const _=this.modelUris[r][t];u||delete this.modelUris[r][t],delete this.modelByURL[_];const y=this.models[r][t].model;if(!y)return;delete this.models[r][t],y.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const r of Object.keys(this.models[t])){const u=this.models[t][r].model;delete this.models[t][r],u&&u.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,r){this.models[r]||(this.models[r]={});for(const u in this.models[r])this.models[r][u].model&&this.models[r][u].model.upload(t.context)}}const Ec=o.a6.colorTheme,fl=new o.a9({data:new o.aa(Ec.data)});function Ac(c){if(!c.metadata||!c.metadata.content_area)return;const t=o.o.devicePixelRatio,{left:r,top:u,width:p,height:_}=c.metadata.content_area,y=r*t,b=u*t;return[y,b,y+p*t,b+_*t]}function Mc(c){if(c)return c.map((([t,r])=>[t*o.o.devicePixelRatio,r*o.o.devicePixelRatio]))}class jf{constructor(t,r,u){this.id=t,this.scope=r,this.sourceCache=u,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const r=this.sourceCache.getVisibleCoordinates();if(r.length===0)return t;const u=this.sourceCache.getSource();if(!(u instanceof Xr))return t;const p=r.map((y=>this.sourceCache.getTile(y))),_=u.getImages(p,Array.from(this.pendingRequests));for(const[y,b]of _)t.set(o.I.from({name:y,iconsetId:this.id}),b),this.pendingRequests.delete(y);for(const y of this.pendingRequests)this.missingRequests.add(y);return this.pendingRequests.clear(),t}}const pl=(c,t)=>V(c,t&&t.filter((r=>r.identifier!=="source.canvas"))),Ic=o.aH(Ki,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Id=o.aH(Ki,["setCenter","setZoom","setBearing","setPitch"]),zh=new Set(["background","sky","slot","custom"]),Cd={version:8,layers:[],sources:{}},Gf={duration:300,delay:0};class Ho extends o.E{constructor(t,r={}){super(),this.map=t,this.scope=r.scope||"",this.globalId=null,this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=Object.assign({},Gf),this._buildingIndex=new bh(this),this.crossTileSymbolIndex=new Fs,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=r.styleChanges||new $a,this.dispatcher=r.dispatcher?r.dispatcher:new o.D(o.dg(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new Es(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new o.dh(t._requestManager,r.localFontFamily?o.di.all:r.localIdeographFontFamily?o.di.ideographs:o.di.none,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new Hl(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=r.configOptions?r.configOptions:new Map,this._configDependentLayers=r.configDependentLayers?r.configDependentLayers:new Set,this._indoorDependentLayers=r.indoorDependentLayers?r.indoorDependentLayers:new Set,this._config=r.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:r.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=r.initialConfig,this.dispatcher.broadcast("setReferrer",o.dj());const u=this;this._rtlTextPluginCallback=Ho.registerForPluginStateChange((p=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},((_,y)=>{if(o.dk(_),y&&y.every((b=>b)))for(const b in u._sourceCaches){const T=u._sourceCaches[b],M=T.getSource().type;M!=="vector"&&M!=="geojson"||T.reload()}}))})),this.on("data",(p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const _=this.getOwnSource(p.sourceId);if(_&&_.vectorLayerIds)for(const y in this._layers){const b=this._layers[y];b.source===_.id&&this._validateLayer(b)}}))}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(o.h(t))return t;const r=o.dl(t);if(!r.startsWith("http"))try{return new URL(r,location.href).toString()}catch{return r}return r}return`json://${o.dm(JSON.stringify(t))}`}_diffStyle(t,r,u){this.globalId=this._getGlobalId(t);const p=(_,y)=>{try{y(null,this.setState(_,u))}catch(b){y(b,!1)}};if(typeof t=="string"){const _=this.map._requestManager.normalizeStyleURL(t),y=this.map._requestManager.transformRequest(_,o.R.Style);o.m(y,((b,T)=>{b?this.fire(new o.y(b)):T&&p(T,r)}))}else typeof t=="object"&&p(t,r)}loadURL(t,r={}){this.fire(new o.z("dataloading",{dataType:"style"}));const u=typeof r.validate=="boolean"?r.validate:!o.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,r.accessToken),this.resolvedImports.add(t);const p=this.importsCache.get(t);if(p)return this._load(p,u);const _=this.map._requestManager.transformRequest(t,o.R.Style);this._request=o.m(_,((y,b)=>{if(this._request=null,y)this.fire(new o.y(y));else if(b)return this.importsCache.set(t,b),this._load(b,u)}))}loadJSON(t,r={}){this.fire(new o.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=o.o.frame((()=>{this._request=null,this._load(t,r.validate!==!1)}))}loadEmpty(){this.fire(new o.z("dataloading",{dataType:"style"})),this._load(Cd,!1)}_loadImports(t,r,u){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const p=[];for(const _ of t){const y=this._createFragmentStyle(_),b=new Promise((I=>{y.once("style.import.load",I),y.once("error",I)})).then((()=>this.mergeAll()));if(p.push(b),this.resolvedImports.has(_.url)){y.loadEmpty();continue}const T=_.data||this.importsCache.get(_.url);T?(y.loadJSON(T,{validate:r}),this._isInternalStyle(T)&&(y.globalId=null)):_.url?y.loadURL(_.url,{validate:r}):y.loadEmpty();const M={style:y,id:_.id,config:_.config};if(u){const I=this.fragments.findIndex((({id:P})=>P===u));this.fragments=this.fragments.slice(0,I).concat(M).concat(this.fragments.slice(I))}else this.fragments.push(M)}return Promise.allSettled(p)}getImportGlobalIds(t=this,r=new Set){for(const u of t.fragments)u.style.globalId&&r.add(u.style.globalId),this.getImportGlobalIds(u.style,r);return[...r.values()]}_createFragmentStyle(t){const r=this.scope?o.B(t.id,this.scope):t.id;let u;const p=this._initialConfig&&this._initialConfig[r];(t.config||p)&&(u=Object.assign({},t.config,p));const _=new Ho(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:u,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return _.setEventedParent(this.map,{style:_}),_}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,r){if(this._isInternalStyle(t)){const _=Object.assign({},Cd,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(_,r)}if(this.updateConfig(this._config,t.schema),r&&pl(this,Ba(t)))return;this._loaded=!0,this.stylesheet=o.dn(t);const u=()=>{for(const T in t.sources)this.addSource(T,t.sources[T],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const T in t.iconsets)this.addIconset(T,t.iconsets[T]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const _=Ao(this.stylesheet.layers);if(this._order=_.map((T=>T.id)),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const T=this.stylesheet.lights[0];this.light=new pe(T.properties,T.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new pe(this.stylesheet.light)),this._layers={};for(const T of _){const M=o.dt(T,this.scope,this._styleColorTheme.lut,this.options);M.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),M.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(M.fqid),this._hasAppearances=this._hasAppearances||M.getAppearances().length!==0,M.setEventedParent(this,{layer:{id:M.id}}),this._layers[M.id]=M;const I=this.getOwnLayerSourceCache(M),P=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&M.canCastShadows()&&P&&(I.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const y=this.stylesheet.terrain;y&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(y,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.z("data",{dataType:"style"}));const b=this.isRootStyle();t.imports?this._loadImports(t.imports,r).then((()=>{this._reloadImports(),this.fire(new o.z(b?"style.load":"style.import.load"))})).catch((T=>{this.fire(new o.y(new Error("Failed to load imports",T))),this.fire(new o.z(b?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new o.z(b?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const p=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(p){const _=this._evaluateColorThemeData(p);this._loadColorTheme(_).then((()=>{u()})).catch((y=>{o.w(`Couldn't load color theme from the stylesheet: ${y}`),u()}))}else this._styleColorTheme.lut=null,u()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let t,r,u,p,_,y,b,T,M,I;const P={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((z=>{if(z.stylesheet){if(z.light!=null&&(t=z.light),z.stylesheet.lights)for(const O of z.stylesheet.lights)O.type==="ambient"&&z.ambientLight!=null&&(r=z.ambientLight),O.type==="directional"&&z.directionalLight!=null&&(u=z.directionalLight);p=this._prioritizeTerrain(p,z.terrain,z.stylesheet.terrain),z.stylesheet.fog&&z.fog!=null&&(_=z.fog),z.stylesheet.snow&&z.snow!=null&&(y=z.snow),z.stylesheet.rain&&z.rain!=null&&(b=z.rain),z.stylesheet.camera!=null&&(I=z.stylesheet.camera),z.stylesheet.projection!=null&&(T=z.stylesheet.projection),z.stylesheet.transition!=null&&(M=z.stylesheet.transition),P[z.scope]=z._styleColorTheme}})),this.light=t,this.ambientLight=r,this.directionalLight=u,this.fog=_,this.snow=y,this.rain=b,this._styleColorThemeForScope=P,p===null?delete this.terrain:this.terrain=p,this.camera=I||{"camera-projection":"perspective"},this.projection=T||{name:"mercator"},this.transition=Object.assign({},Gf,M),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(t){const r=u=>{for(const p of u.fragments)r(p.style);t(u)};r(this)}_prioritizeTerrain(t,r,u){const p=t&&t.drapeRenderMode===0;return u===null?r&&r.drapeRenderMode===0?r:p?t:null:r!=null&&(!t||p||r&&r.drapeRenderMode===1)?r:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((r=>{t=this._prioritizeTerrain(t,r.terrain,r.stylesheet.terrain)})),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((r=>{r.stylesheet.projection!=null&&(t=r.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){const t={},r={},u={};this.forEachFragmentStyle((p=>{for(const _ in p._sourceCaches){const y=o.B(_,p.scope);t[y]=p._sourceCaches[_]}for(const _ in p._otherSourceCaches){const y=o.B(_,p.scope);r[y]=p._otherSourceCaches[_]}for(const _ in p._symbolSourceCaches){const y=o.B(_,p.scope);u[y]=p._symbolSourceCaches[_]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=u}mergeIndoor(){this.forEachFragmentStyle((t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const r of Object.values(t.stylesheet.indoor)){const u=r,p=o.B(u.sourceId,t.scope);this._mergedIndoor[p]=new Set(u.sourceLayers||[])}}))}mergeLayers(){const t={},r=[],u={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((y=>{for(const b of y._order){const T=y._layers[b];if(T.type==="slot"){const M=o.dp(b);if(t[M])continue;t[M]=[]}T.slot&&t[T.slot]?t[T.slot].push(T):r.push(T)}})),this._mergedOrder=[];let p=-1;const _=(y=[])=>{for(const b of y)if(b.type==="slot"){const T=o.dp(b.id);t[T]&&_(t[T]),this._mergedSlots.push(T)}else{const T=o.B(b.id,b.scope);this._mergedOrder.push(T),u[T]=b,b.is3D(!!this.terrain)&&(this._has3DLayers=!0,p=this._mergedOrder.length-1),b.type==="circle"&&(this._hasCircleLayers=!0),b.type==="symbol"&&(this._hasSymbolLayers=!0),b.type==="clip"&&(this._clipLayerPresent=!0)}};if(_(r),this._has3DLayers){const y={};for(let b=0;b<this._mergedOrder.length;++b){const T=this._mergedOrder[b];y[T]=b===p?1:b<p?u[T].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((b,T)=>y[b]-y[T]))}this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?(function(r,u,p,_){const y=Object.assign({},u);for(const T of Object.keys(Ec))y[T]===void 0&&(y[T]=Ec[T].default);const b=new o.a8(fl,r,new Map(p));return b.setTransitionOrValue(y,p),b.untransitioned().possiblyEvaluate(new o.ac(0,{worldview:void 0}))})(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const r=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((u,p)=>{const _="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();let y=t;y.startsWith(_)||(y=_+y);const b=o.I.from("mapbox-reserved-lut"),T=new Image;T.src=y,T.onerror=()=>{this._styleColorTheme.lutLoading=!1,p(new Error("Failed to load image data"))},T.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==r)return void u();this._styleColorTheme.lutLoading=!1;const{width:M,height:I,data:P}=o.o.getImageData(T);if(I>32)return void p(new Error("The height of the image must be less than or equal to 32 pixels."));if(M!==I*I)return void p(new Error("The width of the image must be equal to the height squared."));this.getImage(b)&&this.removeImage(b),this.addImage(b,{data:new o.q({width:M,height:I},P),pixelRatio:1,sdf:!1,usvg:!1,version:0});const z=this.imageManager.getImage(b,this.scope);z?(this._styleColorTheme.lut={image:z.data,data:t},u()):p(new Error("Missing LUT image."))}}))}getLut(t){const r=this._styleColorThemeForScope[t];return r?r.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=(function(r,u,p){let _,y,b;const T=o.o.devicePixelRatio>1?"@2x":"";let M=o.m(u.transformRequest(u.normalizeSpriteURL(r,T,".json"),o.R.SpriteJSON),((z,O)=>{M=null,b||(b=z,_=O,P())})),I=o.n(u.transformRequest(u.normalizeSpriteURL(r,T,".png"),o.R.SpriteImage),((z,O)=>{I=null,b||(b=z,y=O,P())}));function P(){if(b)p(b);else if(_&&y){const z=o.o.getImageData(y),O={};for(const B in _){const{width:N,height:H,x:j,y:Z,sdf:K,pixelRatio:W,stretchX:se,stretchY:Q,content:ce}=_[B],ie=new o.q({width:N,height:H});o.q.copy(z,ie,{x:j,y:Z},{x:0,y:0},{width:N,height:H},null),O[B]={data:ie,pixelRatio:W!==void 0?W:1,sdf:K!==void 0&&K,stretchX:se,stretchY:Q,content:ce,usvg:!1,version:0}}p(null,O)}}return{cancel(){M&&(M.cancel(),M=null),I&&(I.cancel(),I=null)}}})(t,this.map._requestManager,((r,u)=>{if(this._spriteRequest=null,r)this.fire(new o.y(r));else if(u){const p=new Map;for(const _ in u)p.set(o.I.from(_),u[_]);this.addImages(p)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))}))}addIconset(t,r){if(r.type==="sprite")return void this._loadSprite(r.url);const u=this.getOwnSourceCache(r.source);if(!u)return void this.fire(new o.y(new Error(`Source "${r.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const p=u.getSource();if(p.type!=="raster-array")return void this.fire(new o.y(new Error(`Source "${r.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));p.partial=!1;const _=new jf(t,this.scope,u);this.imageManager.addImageProvider(_,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!o.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const r=this.map._spriteFormat==="auto";var u,p;this._spriteRequest=(p=(_,y)=>{if(this._spriteRequest=null,_)r?this._loadSprite(t):this.fire(new o.y(_));else if(y){const b=new Map;for(const T in y)b.set(o.I.from(T),y[T]);this.addImages(b)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))},o.bt((u=this.map._requestManager).transformRequest(u.normalizeIconsetURL(t),o.R.Iconset),((_,y)=>{if(_)return void p(_);const b={},T=o.df(new o.bs(y));for(const M of T.icons){const I={version:1,pixelRatio:o.o.devicePixelRatio,content:Ac(M),stretchX:M.metadata?Mc(M.metadata.stretch_x_areas):void 0,stretchY:M.metadata?Mc(M.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:M};b[M.name]=I}p(null,b)})))}_validateLayer(t){const r=this.getOwnSource(t.source);if(!r)return;const u=t.sourceLayer;u&&(r.type==="geojson"||r.vectorLayerIds&&r.vectorLayerIds.indexOf(u)===-1)&&this.fire(new o.y(new Error(`Source layer "${u}" does not exist on source "${r.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,r)=>{const u=this.fragments[r];return u&&u.style&&(t.data=u.style.serialize()),t}))}_serializeSources(){const t={};for(const r in this._sourceCaches){const u=this._sourceCaches[r].getSource();t[u.id]||(t[u.id]=u.serialize())}return t}_serializeLayers(t){const r=[];for(const u of t){const p=this._layers[u];p&&p.type!=="custom"&&r.push(p.serialize())}return r}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const r=this.getOwnLayer(t);if(r)return r;this.fire(new o.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const r=this.getOwnSource(t);if(r)return r;this.fire(new o.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,r){const u=this.map.painter;if(u)for(let p=t.minzoom||0;p<(t.maxzoom||25.5);p++){const _=t.getProgramIds();if(_)for(const y of _){const b=t.getDefaultProgramParams(y,r.zoom,this._styleColorTheme.lut);b&&(u.style=this,this.fog&&(u._fogVisible=!0,b.overrideFog=!0,u.getOrCreateProgram(y,b)),u._fogVisible=!1,b.overrideFog=!1,u.getOrCreateProgram(y,b),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(b.overrideRtt=!0,u.getOrCreateProgram(y,b)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const r=this.calculateLightsBrightness();t.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const u=this._changes.isDirty();let p=!1;if(this._changes.isDirty()){const b=this._changes.getLayerUpdatesByScope();for(const T in b){const{updatedIds:M,removedIds:I}=b[T];(M||I)&&(this._updateWorkerLayers(T,M,I),p=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const _={};for(const b in this._mergedSourceCaches){const T=this._mergedSourceCaches[b];_[b]=T.used,T.used=!1,T.tileCoverLift=0}for(const b of this._mergedOrder){const T=this._mergedLayers[b];if(T.recalculate(t,this._availableImages),!T.isHidden(t.zoom)){const M=this.getLayerSourceCache(T);M&&(M.used=!0,M.tileCoverLift=Math.max(M.tileCoverLift,T.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(T,t)})):this.precompilePrograms(T,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&p&&this.mergeLayers();const y=this.imageManager.getPendingImageProviders();for(const b of y)b.sourceCache.used=!0;for(const b in _){const T=this._mergedSourceCaches[b];_[b]!==T.used&&T.getSource().fire(new o.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:T.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),u&&this.fire(new o.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const r of t){const u=r.resolvePendingRequests(),p=this.getFragmentStyle(r.scope);p&&p.addImages(u)}}_updateTilesForChangedImages(){const t={};for(const r in this._mergedSourceCaches){const u=this._mergedSourceCaches[r].getSource().scope;t[u]=t[u]||this._changes.getUpdatedImages(u),t[u].length!==0&&this._mergedSourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t[u])}for(const r in t)this._changes.resetUpdatedImages(r)}_updateWorkerLayers(t,r,u){const p=this.getFragmentStyle(t);p&&this.dispatcher.broadcast("updateLayers",{layers:r?p._serializeLayers(r):[],scope:t,removedIds:u||[],options:p.options})}setState(t,r){if(this._checkLoaded(),pl(this,Ba(t)))return!1;(t=o.dn(t)).layers=Ao(t.layers);const u=(function(y,b){if(!y)return[{command:Ki.setStyle,args:[b]}];let T=[];try{if(!o.bx(y.version,b.version))return[{command:Ki.setStyle,args:[b]}];if(o.bx(y.center,b.center)||T.push({command:Ki.setCenter,args:[b.center]}),o.bx(y.zoom,b.zoom)||T.push({command:Ki.setZoom,args:[b.zoom]}),o.bx(y.bearing,b.bearing)||T.push({command:Ki.setBearing,args:[b.bearing]}),o.bx(y.pitch,b.pitch)||T.push({command:Ki.setPitch,args:[b.pitch]}),o.bx(y.sprite,b.sprite)||T.push({command:Ki.setSprite,args:[b.sprite]}),o.bx(y.glyphs,b.glyphs)||T.push({command:Ki.setGlyphs,args:[b.glyphs]}),o.bx(y.imports,b.imports)||(function(O=[],B=[],N){B=B||[];const H=(O=O||[]).map(Sa),j=B.map(Sa),Z=O.reduce(ls,{}),K=B.reduce(ls,{}),W=H.slice();let se,Q,ce,ie;for(se=0,Q=0;se<H.length;se++)ce=H[se],K.hasOwnProperty(ce)?Q++:(N.push({command:Ki.removeImport,args:[ce]}),W.splice(W.indexOf(ce,Q),1));for(se=0,Q=0;se<j.length;se++)ce=j[j.length-1-se],W[W.length-1-se]!==ce&&(Z.hasOwnProperty(ce)?(N.push({command:Ki.removeImport,args:[ce]}),W.splice(W.lastIndexOf(ce,W.length-Q),1)):Q++,ie=W[W.length-se],N.push({command:Ki.addImport,args:[K[ce],ie]}),W.splice(W.length-se,0,ce));for(const te of B){const ue=Z[te.id];ue&&(delete ue.data,o.bx(ue,te)||N.push({command:Ki.updateImport,args:[te.id,te]}))}})(y.imports,b.imports,T),o.bx(y.transition,b.transition)||T.push({command:Ki.setTransition,args:[b.transition]}),o.bx(y.light,b.light)||T.push({command:Ki.setLight,args:[b.light]}),o.bx(y.fog,b.fog)||T.push({command:Ki.setFog,args:[b.fog]}),o.bx(y.snow,b.snow)||T.push({command:Ki.setSnow,args:[b.snow]}),o.bx(y.rain,b.rain)||T.push({command:Ki.setRain,args:[b.rain]}),o.bx(y.projection,b.projection)||T.push({command:Ki.setProjection,args:[b.projection]}),o.bx(y.lights,b.lights)||T.push({command:Ki.setLights,args:[b.lights]}),o.bx(y.camera,b.camera)||T.push({command:Ki.setCamera,args:[b.camera]}),o.bx(y.iconsets,b.iconsets)||(function(O,B,N){let H;for(H in B=B||{},O=O||{})O.hasOwnProperty(H)&&(B.hasOwnProperty(H)||N.push({command:Ki.removeIconset,args:[H]}));for(H in B){if(!B.hasOwnProperty(H))continue;const j=B[H];O.hasOwnProperty(H)?o.bx(O[H],j)||(N.push({command:Ki.removeIconset,args:[H]}),N.push({command:Ki.addIconset,args:[H,j]})):N.push({command:Ki.addIconset,args:[H,j]})}})(y.iconsets,b.iconsets,T),!o.bx(y["color-theme"],b["color-theme"]))return[{command:Ki.setStyle,args:[b]}];const M={},I=[];(function(O,B,N,H){let j;for(j in B=B||{},O=O||{})O.hasOwnProperty(j)&&(B.hasOwnProperty(j)||Su(j,N,H));for(j in B){if(!B.hasOwnProperty(j))continue;const Z=B[j];O.hasOwnProperty(j)?o.bx(O[j],Z)||(O[j].type==="geojson"&&Z.type==="geojson"&&Eu(O,B,j)?N.push({command:Ki.setGeoJSONSourceData,args:[j,Z.data]}):jl(j,B,N,H)):Tu(j,B,N)}})(y.sources,b.sources,I,M);const P=[];y.layers&&y.layers.forEach((O=>{O.source&&M[O.source]?T.push({command:Ki.removeLayer,args:[O.id]}):P.push(O)}));let z=y.terrain;z&&M[z.source]&&(T.push({command:Ki.setTerrain,args:[void 0]}),z=void 0),T=T.concat(I),o.bx(z,b.terrain)||T.push({command:Ki.setTerrain,args:[b.terrain]}),(function(O,B,N){B=B||[];const H=(O=O||[]).map(Sa),j=B.map(Sa),Z=O.reduce(ls,{}),K=B.reduce(ls,{}),W=H.slice(),se=Object.create(null);let Q,ce,ie,te,ue,we,ve;for(Q=0,ce=0;Q<H.length;Q++)ie=H[Q],K.hasOwnProperty(ie)?ce++:(N.push({command:Ki.removeLayer,args:[ie]}),W.splice(W.indexOf(ie,ce),1));for(Q=0,ce=0;Q<j.length;Q++)ie=j[j.length-1-Q],W[W.length-1-Q]!==ie&&(Z.hasOwnProperty(ie)?(N.push({command:Ki.removeLayer,args:[ie]}),W.splice(W.lastIndexOf(ie,W.length-ce),1)):ce++,we=W[W.length-Q],N.push({command:Ki.addLayer,args:[K[ie],we]}),W.splice(W.length-Q,0,ie),se[ie]=!0);for(Q=0;Q<j.length;Q++)if(ie=j[Q],te=Z[ie],ue=K[ie],!se[ie]&&!o.bx(te,ue))if(o.bx(te.source,ue.source)&&o.bx(te["source-layer"],ue["source-layer"])&&o.bx(te.type,ue.type)){for(ve in Au(te.layout,ue.layout,N,ie,null,Ki.setLayoutProperty),Au(te.paint,ue.paint,N,ie,null,Ki.setPaintProperty),o.bx(te.slot,ue.slot)||N.push({command:Ki.setSlot,args:[ie,ue.slot]}),o.bx(te.filter,ue.filter)||N.push({command:Ki.setFilter,args:[ie,ue.filter]}),o.bx(te.minzoom,ue.minzoom)&&o.bx(te.maxzoom,ue.maxzoom)||N.push({command:Ki.setLayerZoomRange,args:[ie,ue.minzoom,ue.maxzoom]}),te)te.hasOwnProperty(ve)&&ve!=="layout"&&ve!=="paint"&&ve!=="filter"&&ve!=="metadata"&&ve!=="minzoom"&&ve!=="maxzoom"&&ve!=="slot"&&(ve.indexOf("paint.")===0?Au(te[ve],ue[ve],N,ie,ve.slice(6),Ki.setPaintProperty):o.bx(te[ve],ue[ve])||N.push({command:Ki.setLayerProperty,args:[ie,ve,ue[ve]]}));for(ve in ue)ue.hasOwnProperty(ve)&&!te.hasOwnProperty(ve)&&ve!=="layout"&&ve!=="paint"&&ve!=="filter"&&ve!=="metadata"&&ve!=="minzoom"&&ve!=="maxzoom"&&ve!=="slot"&&(ve.indexOf("paint.")===0?Au(te[ve],ue[ve],N,ie,ve.slice(6),Ki.setPaintProperty):o.bx(te[ve],ue[ve])||N.push({command:Ki.setLayerProperty,args:[ie,ve,ue[ve]]}))}else N.push({command:Ki.removeLayer,args:[ie]}),we=W[W.lastIndexOf(ie)+1],N.push({command:Ki.addLayer,args:[ue,we]})})(P,b.layers,T)}catch(M){console.warn("Unable to compute style diff:",M),T=[{command:Ki.setStyle,args:[b]}]}return T})(this.serialize(),t).filter((y=>!(y.command in Id)));if(u.length===0)return!1;const p=u.filter((y=>!(y.command in Ic)));if(p.length>0)throw new Error(`Unimplemented: ${p.map((y=>y.command)).join(", ")}.`);const _=[];return u.forEach((y=>{_.push(this[y.command](...y.args))})),r&&Promise.all(_).then(r).catch(r),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[r,u]of t.entries()){if(this.getImage(r))return this.fire(new o.y(new Error(`An image with the name "${r.name}" already exists.`)));this.imageManager.addImage(r,this.scope,u),this._changes.updateImage(r,this.scope)}return this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this}addImage(t,r){return this.getImage(t)?this.fire(new o.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,r),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this)}updateImage(t,r,u=!1){this.imageManager.updateImage(t,this.scope,r),u&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new o.z("data",{dataType:"style"})),this}addModel(t,r,u={}){return this._checkLoaded(),this._validate(xu,`models.${t}`,r,null,u)||(this.modelManager.addModel(t,r,this.scope),this.fire(new o.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,r,u={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(Nl,`sources.${t}`,r,null,u))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const p=wa(t,r,this.dispatcher,this);p.scope=this.scope,p.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(p.id),source:p.serialize(),sourceId:p.id})));const _=y=>{const b=(y?"symbol:":"other:")+p.id,T=o.B(b,this.scope),M=this._sourceCaches[b]=new so(T,p,y);(y?this._symbolSourceCaches:this._otherSourceCaches)[p.id]=M,M.onAdd(this.map)};_(!1),r.type!=="vector"&&r.type!=="geojson"||_(!0),p.onAdd&&p.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const r=this.getOwnSource(t);if(!r)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new o.y(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new o.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const p=Object.entries(this.stylesheet.iconsets).find((([_,y])=>y.type==="source"&&y.source===t));if(p)return this.fire(new o.y(new Error(`Source "${t}" cannot be removed while iconset "${p[0]}" is using it.`)))}const u=this.getOwnSourceCaches(t);for(const p of u){const _=o.dp(p.id);delete this._sourceCaches[_],this._changes.discardSourceCacheUpdate(p.id),p.fire(new o.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,r){this._checkLoaded(),this.getOwnSource(t).setData(r),this._changes.setDirty()}getOwnSource(t){const r=this.getOwnSourceCache(t);return r&&r.getSource()}getOwnSources(){const t=[];for(const r in this._otherSourceCaches){const u=this.getOwnSourceCache(r);u&&t.push(u.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const r in t){const u=t[r]._tiles;for(const p in u){const _=u[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const _ of t){if(this._validate(bd,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){const y=this.ambientLight;y.set(_),y.updateTransitions(r)}else this.ambientLight=new _r(_,rn||(rn=new o.a9({color:new o.aa(o.a6.properties_light_ambient.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const y=this.directionalLight;y.set(_),y.updateTransitions(r)}else this.directionalLight=new _r(_,jn||(jn=new o.a9({direction:new o.ap(o.a6.properties_light_directional.direction),color:new o.aa(o.a6.properties_light_directional.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_directional.intensity),"cast-shadows":new o.aa(o.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new o.aa(o.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.aa(o.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const u=Object.assign(r,{worldview:this.map.getWorldview()}),p=new o.ac(this.z||0,u);this.ambientLight&&this.ambientLight.recalculate(p),this.directionalLight&&this.directionalLight.recalculate(p),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,r=this.ambientLight;if(!t||!r)return;const u=z=>.2126*(z[0]<=.03928?z[0]/12.92:Math.pow((z[0]+.055)/1.055,2.4))+.7152*(z[1]<=.03928?z[1]/12.92:Math.pow((z[1]+.055)/1.055,2.4))+.0722*(z[2]<=.03928?z[2]/12.92:Math.pow((z[2]+.055)/1.055,2.4)),p=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),_=t.properties.get("intensity"),y=t.properties.get("direction"),b=1-o.d3(y.x,y.y,y.z)[2]/90,T=u(p)*_*b,M=r.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),I=r.properties.get("intensity"),P=u(M)*I;return Number(((T+P)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(o.dq(t)){const r=o.dr(t),u=this.fragments.find((({id:_})=>_===r));if(!u)return;const p=o.dp(t);return u.style.getFragmentStyle(p)}{const r=this.fragments.find((({id:u})=>u===t));return r?r.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const r={},u=(p,_="")=>`${p}::${_}`;this._featuresetSelectors={};for(const p in t){const _=this._featuresetSelectors[p]=[];for(const y of t[p].selectors){if(y.featureNamespace){const T=this.getOwnLayer(y.layer);if(!T){o.w(`Layer is undefined for selector: ${y.layer}`);continue}const M=u(T.source,T.sourceLayer);if(M in r&&r[M]!==y.featureNamespace){o.w(`"featureNamespace ${y.featureNamespace} of featureset ${p}'s selector is not associated to the same source, skip this selector`);continue}r[M]=y.featureNamespace}let b;if(y.properties)for(const T in y.properties){const M=o.U(y.properties[T]);M.result==="success"&&(b=b||{},b[T]=M.value)}_.push({layerId:y.layer,namespace:y.featureNamespace,properties:b,uniqueFeatureID:y._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const r=this.getFragmentStyle(t);if(!r||!r.stylesheet.featuresets)return[];const u=[];for(const p in r.stylesheet.featuresets)u.push({featuresetId:p,importId:r.scope?r.scope:void 0});return u}getFeaturesetLayers(t,r){const u=this.getFragmentStyle(r),p=u.stylesheet.featuresets;if(!p||!p[t])return this.fire(new o.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const _=[];for(const y of p[t].selectors){const b=u.getOwnLayer(y.layer);b&&_.push(b)}return _}getConfigProperty(t,r){const u=this.getFragmentStyle(t);if(!u)return null;const p=o.B(r,u.scope),_=u.options.get(p),y=_?_.value||_.default:null;return y?y.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,r){const u=o.B(t,r);return this._mergedIndoor[u]}setIndoorData(t,r){this.map.indoor.setIndoorData(r)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,r,u){const p=this.getFragmentStyle(t);if(!p)return;const _=p.stylesheet.schema;if(!_||!_[r])return;const y=o.U(u);if(y.result!=="success")return void pl(this,y.value);const b=y.value.expression,T=o.B(r,p.scope),M=p.options.get(T);if(!M)return;let I;const{minValue:P,maxValue:z,stepValue:O,type:B,values:N}=_[r],H=o.U(_[r].default);H.result==="success"&&(I=H.value.expression),I?(this.options.set(T,Object.assign({},M,{value:b,default:I,minValue:P,maxValue:z,stepValue:O,type:B,values:N})),this.updateConfigDependencies(r)):this.fire(new o.y(new Error(`No schema defined for the config option "${r}" in the "${t}" fragment.`)))}getConfig(t){const r=this.getFragmentStyle(t);if(!r)return null;const u=r.stylesheet.schema;if(!u)return null;const p={};for(const _ in u){const y=o.B(_,r.scope),b=r.options.get(y),T=b?b.value||b.default:null;p[_]=T?T.serialize():null}return p}setConfig(t,r){const u=this.getFragmentStyle(t);u&&(u.updateConfig(r,u.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const r=this.getFragmentStyle(t);return r?r.stylesheet.schema:null}setSchema(t,r){const u=this.getFragmentStyle(t);u&&(u.stylesheet.schema=r,u.updateConfig(u._config,r),this.updateConfigDependencies())}updateConfig(t,r){if(this._config=t,t||r)if(r)for(const u in r){let p,_;const y=o.U(r[u].default);if(y.result==="success"&&(p=y.value.expression),t&&t[u]!==void 0){const z=o.U(t[u]);z.result==="success"&&(_=z.value.expression)}const{minValue:b,maxValue:T,stepValue:M,type:I,values:P}=r[u];if(p){const z=o.B(u,this.scope);this.options.set(z,{default:p,value:_,minValue:b,maxValue:T,stepValue:M,type:I,values:P})}else this.fire(new o.y(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new o.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(t,r=(()=>!0)){for(const u of t){const p=this.getLayer(u);p&&r(p)&&(p.possiblyEvaluateVisibility(),this._updateLayer(p),this._changes.setDirty())}}updateConfigDependencies(t){this._updateLayers(this._configDependentLayers,(r=>!t||r.expressionDependencies.configDependencies.has(t))),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((r=>{const u=r._styleColorTheme.colorThemeOverride?r._styleColorTheme.colorThemeOverride:r._styleColorTheme.colorTheme;if(u){const p=r._evaluateColorThemeData(u);(!r._styleColorTheme.lut&&p!==""||r._styleColorTheme.lut&&p!==r._styleColorTheme.lut.data)&&r.setColorTheme(u)}})),this._changes.setDirty()}addLayer(t,r,u={}){this._checkLoaded();const p=t.id;if(this._layers[p])return void this.fire(new o.y(new Error(`Layer with id "${p}" already exists on this map`)));let _;if(t.type==="custom"){if(pl(this,o.ds(t)))return;_=o.dt(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=o.dn(t),t=Object.assign(t,{source:p})),this._validate(vu,`layers.${p}`,t,{arrayIndex:-1},u))return;_=o.dt(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(_),_.setEventedParent(this,{layer:{id:p}})}const y=o.B(_.source,_.scope);_.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(y),_.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(y);let b=this._order.length;if(r){const P=this._order.indexOf(r);if(P===-1)return void this.fire(new o.y(new Error(`Layer with id "${r}" does not exist on this map.`)));_.slot===this._layers[r].slot?b=P:o.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,p),this._layerOrderChanged=!0,this._layers[p]=_;const T=this.getOwnLayerSourceCache(_),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();T&&_.canCastShadows()&&M&&(T.castsShadows=!0);const I=this._changes.getRemovedLayer(_);if(I&&_.source&&T&&_.type!=="custom"){this._changes.discardLayerRemoval(_);const P=o.B(_.source,_.scope);I.type!==_.type?this._changes.updateSourceCache(P,"clear"):(this._changes.updateSourceCache(P,"reload"),T.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),_.scope=this.scope,this.mergeLayers()}moveLayer(t,r){this._checkLoaded();const u=this._checkLayer(t);if(!u||t===r)return;const p=this._order.indexOf(t);this._order.splice(p,1);let _=this._order.length;if(r){const y=this._order.indexOf(r);if(y===-1)return void this.fire(new o.y(new Error(`Layer with id "${r}" does not exist on this map.`)));u.slot===this._layers[r].slot?_=y:o.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(_,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const r=this._checkLayer(t);if(!r)return;r.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(r.fqid),this._indoorDependentLayers.delete(r.fqid),this._changes.removeLayer(r);const p=this.getOwnLayerSourceCache(r);if(p&&p.castsShadows){let _=!1;for(const y in this._layers)if(this._layers[y].source===r.source&&this._layers[y].canCastShadows()){_=!0;break}p.castsShadows=_}r.onRemove&&r.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const r in this._layers)if(this._layers[r].type===t)return!0;return!1}setLayerZoomRange(t,r,u){this._checkLoaded();const p=this._checkLayer(t);p&&(p.minzoom===r&&p.maxzoom===u||(r!=null&&(p.minzoom=r),u!=null&&(p.maxzoom=u),this._updateLayer(p)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,r){this._checkLoaded();const u=this._checkLayer(t);u&&u.slot!==r&&(u.slot=r,this._updateLayer(u))}setFilter(t,r,u={}){this._checkLoaded();const p=this._checkLayer(t);if(p&&!o.bx(p.filter,r))return r==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(Ui,`layers.${p.id}.filter`,r,{layerType:p.type},u)||(p.filter=o.dn(r),this._updateLayer(p)))}getFilter(t){const r=this._checkLayer(t);if(r)return o.dn(r.filter)}setLayoutProperty(t,r,u,p={}){this._checkLoaded();const _=this._checkLayer(t);if(_&&!o.bx(_.getLayoutProperty(r),u)){if(u!=null&&(!p||p.validate!==!1)&&pl(_,yh.call(Ba,{key:`layers.${t}.layout.${r}`,layerType:_.type,objectKey:r,value:u,styleSpec:o.a6,style:{glyphs:!0,sprite:!0}})))return;_.setLayoutProperty(r,u),_.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),_.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(_.fqid),this._updateLayer(_)}}setLayerProperty(t,r,u,p={}){this._checkLoaded();const _=this._checkLayer(t);_&&(r==="appearances"?(_.setAppearances(u),this._changes.setDirty()):_.isPaintProperty(r)?this.setPaintProperty(t,r,u,p):this.setLayoutProperty(t,r,u,p))}getLayoutProperty(t,r){const u=this._checkLayer(t);if(u)return u.getLayoutProperty(r)}setPaintProperty(t,r,u,p={}){this._checkLoaded();const _=this._checkLayer(t);if(!_||o.bx(_.getPaintProperty(r),u)||u!=null&&(!p||p.validate!==!1)&&pl(_,pa.call(Ba,{key:`layers.${t}.paint.${r}`,layerType:_.type,objectKey:r,value:u,styleSpec:o.a6})))return;const y=_.setPaintProperty(r,u);_.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),_.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(_.fqid),y&&this._updateLayer(_),this._changes.updatePaintProperties(_)}getPaintProperty(t,r){const u=this._checkLayer(t);if(u)return u.getPaintProperty(r)}setFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:T,importId:M}=t.target,I=this.getFragmentStyle(M),P=I.getFeaturesetLayers(T);for(const{source:z,sourceLayer:O}of P)I.setFeatureState({id:t.id,source:z,sourceLayer:O},r)}else if("layerId"in t.target){const{layerId:T}=t.target,M=this.getLayer(T);this.setFeatureState({id:t.id,source:M.source,sourceLayer:M.sourceLayer},r)}return}const u=t.source,p=t.sourceLayer,_=this._checkSource(u);if(!_)return;const y=_.type;if(y==="geojson"&&p)return void this.fire(new o.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(y==="vector"&&!p)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided.")));const b=this.getOwnSourceCaches(u);for(const T of b)T.setFeatureState(p,t.id,r)}removeFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:T,importId:M}=t.target,I=this.getFragmentStyle(M),P=I.getFeaturesetLayers(T);for(const{source:z,sourceLayer:O}of P)I.removeFeatureState({id:t.id,source:z,sourceLayer:O},r)}else if("layerId"in t.target){const{layerId:T}=t.target,M=this.getLayer(T);this.removeFeatureState({id:t.id,source:M.source,sourceLayer:M.sourceLayer},r)}return}const u=t.source,p=this._checkSource(u);if(!p)return;const _=p.type,y=_==="vector"?t.sourceLayer:void 0;if(_==="vector"&&!y)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new o.y(new Error("A feature id is required to remove its specific state property.")));const b=this.getOwnSourceCaches(u);for(const T of b)T.removeFeatureState(y,t.id,r)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let _;if("featuresetId"in t.target){const{featuresetId:y,importId:b}=t.target,T=this.getFragmentStyle(b),M=T.getFeaturesetLayers(y);for(const{source:I,sourceLayer:P}of M){const z=T.getFeatureState({id:t.id,source:I,sourceLayer:P});if(z&&!_)_=z;else if(!o.bx(_,z))return void this.fire(new o.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:y}=t.target,b=this.getLayer(y);_=this.getFeatureState({id:t.id,source:b.source,sourceLayer:b.sourceLayer})}return _}const r=t.source,u=t.sourceLayer,p=this._checkSource(r);if(p){if(p.type!=="vector"||u)return t.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(u,t.id);this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),r=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return o.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(u=>u!==void 0))}_updateFilteredLayers(t){for(const r of Object.values(this._mergedLayers))t(r)&&this._updateLayer(r)}_updateLayer(t){this._changes.updateLayer(t);const r=this.getLayerSourceCache(t),u=o.B(t.source,t.scope),p=this._changes.getUpdatedSourceCaches();t.source&&!p[u]&&r&&r.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),r.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const r=b=>this._mergedLayers[b].is3D(!!this.terrain),u=this.order,p={},_=[];for(let b=u.length-1;b>=0;b--){const T=u[b];if(r(T)){p[T]=b;for(const M of t){const I=M[T];if(I)for(const P of I)_.push(P)}}}_.sort(((b,T)=>T.intersectionZ-b.intersectionZ));const y=[];for(let b=u.length-1;b>=0;b--){const T=u[b];if(r(T))for(let M=_.length-1;M>=0;M--){const I=_[M].feature;if(I.layer&&p[I.layer.id]<b)break;y.push(I),_.pop()}else for(const M of t){const I=M[T];if(I)for(const P of I)y.push(P.feature)}}return y}queryRasterValue(t,r,u){const p=this.getOwnSource(t);return p?p.type!=="raster-array"?(this.fire(new o.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):p.queryRasterArrayValue(r,u):(this.fire(new o.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,r,u){let p;r&&!Array.isArray(r)&&r.filter&&(this._validate(Ui,"queryRenderedFeatures.filter",r.filter,null,r),p=o.b5(r.filter));const _={},y=I=>{if(zh.has(I.type))return;const P=this.getOwnLayerSourceCache(I),z=_[P.id]=_[P.id]||{sourceCache:P,layers:{},has3DLayers:!1};I.is3D(!!this.terrain)&&(z.has3DLayers=!0),z.layers[I.fqid]=z.layers[I.fqid]||{styleLayer:I,targets:[]},z.layers[I.fqid].targets.push({filter:p})};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new o.y(new Error("parameters.layers must be an Array."))),[];for(const I of r.layers){const P=this._layers[I];if(!P)return this.fire(new o.y(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];y(P)}}else for(const I in this._layers)y(this._layers[I]);const b=this._queryRenderedFeatures(t,_,u),T=this._flattenAndSortRenderedFeatures(b),M=[];for(const I of T)o.dv(I.layer.id)===this.scope&&M.push(I);return M}queryRenderedFeatureset(t,r,u){let p;r&&!Array.isArray(r)&&r.filter&&(this._validate(Ui,"queryRenderedFeatures.filter",r.filter,null,r),p=o.b5(r.filter));const _="mock",y=[];if(r&&r.target)y.push(Object.assign({},r,{targetId:_,filter:p}));else{const I=this.getFeaturesetDescriptors();for(const P of I)y.push({targetId:_,filter:p,target:P});for(const{style:P}of this.fragments){const z=P.getFeaturesetDescriptors();for(const O of z)y.push({targetId:_,filter:p,target:O})}}const b=this.queryRenderedTargets(t,y,u),T=[],M=new Set;for(const I of b)for(const P of I.variants[_])ka(P,I,M)||T.push(new o.dw(I,P));return T}queryRenderedTargets(t,r,u){const p={},_=(b,T,M,I)=>{const P=p[T.id]=p[T.id]||{sourceCache:T,layers:{},has3DLayers:!1};if(P.layers[b.fqid]=P.layers[b.fqid]||{styleLayer:b,targets:[]},b.is3D(!!this.terrain)&&(P.has3DLayers=!0),!I)return M.uniqueFeatureID=!1,void P.layers[b.fqid].targets.push(M);P.layers[b.fqid].targets.push(Object.assign({},M,{namespace:I.namespace,properties:I.properties,uniqueFeatureID:I.uniqueFeatureID}))};for(const b of r)if("featuresetId"in b.target){const{featuresetId:T,importId:M}=b.target,I=this.getFragmentStyle(M);if(!I||!I._featuresetSelectors)continue;const P=I._featuresetSelectors[T];if(!P){this.fire(new o.y(new Error(`The featureset '${T}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const z of P){const O=I.getOwnLayer(z.layerId);O&&!zh.has(O.type)&&_(O,I.getOwnLayerSourceCache(O),b,z)}}else if("layerId"in b.target){const{layerId:T}=b.target,M=this.getLayer(T);if(!M||zh.has(M.type))continue;_(M,this.getLayerSourceCache(M),b)}const y=this._queryRenderedFeatures(t,p,u);return this._flattenAndSortRenderedFeatures(y)}_queryRenderedFeatures(t,r,u){const p=[],_=!!this.map._showQueryGeometry,y=xn.createFromScreenPoints(t,u);for(const b in r){const T=_a(y,r[b],this._availableImages,u,_);Object.keys(T).length&&p.push(T)}if(this.placement)for(const b in r){if(!r[b].sourceCache._onlySymbols)continue;const T=vh(y.screenGeometry,r[b],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(T).length&&p.push(T)}return p}querySourceFeatures(t,r){const u=r&&r.filter;u&&this._validate(Ui,"querySourceFeatures.filter",u,null,r);let p=[];const _=this.getOwnSourceCaches(t);for(const y of _)p=p.concat(bu(y,r));return p}addSourceType(t,r,u){return Ho.getSourceType(t)?u(new Error(`A source type called "${t}" already exists.`)):(Ho.setSourceType(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,r,u={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const b in t)if(!o.bx(t[b],p[b])){_=!0;break}if(!_)return;const y=this._getTransitionParameters();this.light.setLight(t,r,u),this.light.updateTransitions(y)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,r=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),r===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let u=t;const p=t.source==null;if(r===1){if(this.disableElevatedTerrain)return;if(typeof u.source=="object"){const b="terrain-dem-src";this.addSource(b,u.source),u=o.dn(u),u=Object.assign(u,{source:b})}const _=Object.assign({},u),y={};if(this.terrain&&p){_.source=this.terrain.get().source;const b=this.terrain?this.getFragmentStyle(this.terrain.scope):null;b&&(y.style=b.serialize())}if(this._validate(Ul,"terrain",_,y))return}if(!this.terrain||this.terrain.scope!==this.scope&&!p||this.terrain&&r!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,r),this.fire(new o.z("data",{dataType:"style"}))}else{const _=this.terrain,y=_.get();for(const b of Object.keys(o.a6.terrain))!u.hasOwnProperty(b)&&o.a6.terrain[b].default&&(u[b]=o.a6.terrain[b].default);for(const b in t)if(!o.bx(t[b],y[b])){_.set(t,this.options),this.stylesheet.terrain=t;const T=this._getTransitionParameters({duration:0});_.updateTransitions(T),this.fire(new o.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const r=this.fog=new Gt(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}_createSnow(t){const r=this.snow=new Pr(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}_createRain(t){const r=this.rain=new wr(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!o.bx(r.get(),t)){r.set(t,this.options),this.stylesheet.fog=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const r=this.snow;if(!o.bx(r.get(),t)){r.set(t,this.options),this.stylesheet.snow=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const r=this.rain;if(!o.bx(r.get(),t)){r.set(t,this.options),this.stylesheet.rain=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const p in this._layers)this._layers[p].lut=this._styleColorTheme.lut;for(const p in this._sourceCaches)this._sourceCaches[p].clearTiles()},r=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!r)return this._styleColorTheme.lut=null,void t();const u=this._evaluateColorThemeData(r);this._loadColorTheme(u).then((()=>{this.fire(new o.z("colorthemeset")),t()})).catch((p=>{o.w(`Couldn't set color theme: ${p}`)}))}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,r){const u=this.getFragmentStyle(t);u&&(u._styleColorTheme.colorThemeOverride=r,u._reloadColorTheme())}_getTransitionParameters(t){return{now:o.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],r=[];for(const u of this._mergedOrder)this.isLayerDraped(this._mergedLayers[u])?t.push(u):r.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...r)}_createTerrain(t,r){const u=this.terrain=new xe(t,r,this.scope,this.options,this.map.getWorldview());r===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_force3DLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="fill-extrusion"&&this._updateLayer(r)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="symbol"&&this._updateLayer(r)}}_validate(t,r,u,p,_={}){if(_&&_.validate===!1)return!1;const y=Object.assign({},this.serialize());return pl(this,t.call(Ba,Object.assign({key:r,style:y,value:u,styleSpec:o.a6},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const r=this.getSourceCaches(t);for(const u of r)u.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const r=this._mergedLayers[t];r._clear&&r._clear()}}reloadSource(t){const r=this.getSourceCaches(t);for(const u of r)u.resume(),u.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((t=>{t.modelManager.reloadModels(t.scope)}))}updateSources(t){let r;this.directionalLight&&(r=q1(this.directionalLight));const u=new Set;for(const p in this._mergedLayers){const _=this._mergedLayers[p];_.hasElevation()&&!u.has(_.source)&&u.add(_.source)}for(const p in this._mergedSourceCaches){const _=this._mergedSourceCaches[p],y=u.has(_._source.id);_.update(t,void 0,void 0,r,y)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const r=this._sourceCaches[t];r.resume(),r.reload()}}_updatePlacement(t,r,u,p,_,y,b=!1){let T=!1,M=!1;const I={},P={};for(const z of this._mergedOrder){const O=this._mergedLayers[z];if(O.type!=="symbol")continue;const B=o.B(O.source,O.scope);let N=I[B];if(!N){const j=this.getLayerSourceCache(O);if(!j)continue;const Z=j.getRenderableIds(!0).map((K=>j.getTileByID(K)));P[B]=Z.slice(),N=I[B]=Z.sort(((K,W)=>W.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(W.tileID)?-1:1)))}const H=this.crossTileSymbolIndex.addLayer(O,N,r.center.lng,r.projection);T=T||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),b=b||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new o.z("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.o.now(),r.zoom))&&(this.pauseablePlacement=new la(r,this._mergedOrder,b,u,p,_,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,I,P,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.o.now()),M=!0),T&&this.pauseablePlacement.placement.setStale()),M||T){this._buildingIndex.onNewFrame(r.zoom);for(let z=0;z<this._mergedOrder.length;z++){const O=this._mergedLayers[this._mergedOrder[z]];if(O.type!=="symbol")continue;const B=this.isLayerClipped(O);this.placement.updateLayerOpacities(O,I[o.B(O.source,O.scope)],z,B?y:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,r){this._checkLoaded();const u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex((({id:_})=>_===t.id))!==-1)return void this.fire(new o.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!r)return u.push(t),this._loadImports([t],!0);const p=u.findIndex((({id:_})=>_===r));return p===-1&&this.fire(new o.y(new Error(`Import with id "${r}" does not exist on this map.`))),this.stylesheet.imports=u.slice(0,p).concat(t).concat(u.slice(p)),this._loadImports([t],!0,r)}updateImport(t,r){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);return p===-1?this:typeof r=="string"?(this.setImportUrl(t,r),this):(r.url&&r.url!==u[p].url&&this.setImportUrl(t,r.url),o.bx(r.config,u[p].config)||this.setImportConfig(t,r.config,r.data.schema),o.bx(r.data,u[p].data)||this.setImportData(t,r.data),this)}moveImport(t,r){this._checkLoaded();let u=this.stylesheet.imports||[];const p=this.getImportIndex(t);if(p===-1)return this;const _=this.getImportIndex(r);if(_===-1)return this;const y=u[p],b=this.fragments[p];return u=u.filter((({id:T})=>T!==t)),this.fragments=this.fragments.filter((({id:T})=>T!==t)),this.stylesheet.imports=u.slice(0,_).concat(y).concat(u.slice(_)),this.fragments=this.fragments.slice(0,_).concat(b).concat(this.fragments.slice(_)),this.mergeLayers(),this}setImportUrl(t,r){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);if(p===-1)return this;u[p].url=r;const _=this.fragments[p];return _.style=this._createFragmentStyle(u[p]),_.style.on("style.import.load",(()=>this.mergeAll())),_.style.loadURL(r),this}setImportData(t,r){this._checkLoaded();const u=this.getImportIndex(t),p=this.stylesheet.imports||[];return u===-1?this:r?(this.fragments[u].style.setState(r),this._reloadImports(),this):(delete p[u].data,this.setImportUrl(t,p[u].url))}setImportConfig(t,r,u){this._checkLoaded();const p=this.getImportIndex(t),_=this.stylesheet.imports||[];if(p===-1)return this;r?_[p].config=r:delete _[p].config;const y=this.fragments[p];u&&y.style.stylesheet&&(y.style.stylesheet.schema=u);const b=y.style.stylesheet&&y.style.stylesheet.schema;return y.config=r,y.style.updateConfig(r,b),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const r=this.stylesheet.imports||[],u=this.getImportIndex(t);u!==-1&&(r.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports())}getImportIndex(t){const r=(this.stylesheet.imports||[]).findIndex((u=>u.id===t));return r===-1&&this.fire(new o.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),r}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const r in this._mergedOtherSourceCaches){const u=this._mergedOtherSourceCaches[r];u&&t.push(u.getSource())}return t}getSource(t,r){const u=this.getSourceCache(t,r);return u&&u.getSource()}getLayerSource(t){const r=this.getLayerSourceCache(t);return r&&r.getSource()}getSourceCache(t,r){const u=o.B(t,r);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(t){const r=o.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const r=[];return this._mergedOtherSourceCaches[t]&&r.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&r.push(this._mergedSymbolSourceCaches[t]),r}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const r in t){const u=t[r];u==="reload"?this.reloadSource(r):u==="clear"&&this.clearSource(r)}}updateLayers(t){const r=this._changes.getUpdatedPaintProperties();for(const u of r){const p=this.getLayer(u);p&&p.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,r,u){this.imageManager.getImages(r.images,r.scope,u),this._updateTilesForChangedImages();const p=y=>{if(y){const b=r.images.map((T=>o.I.toString(T)));y.setDependencies(r.tileID.key,r.type,b)}},_=o.B(r.source,r.scope);p(this._mergedOtherSourceCaches[_]),p(this._mergedSymbolSourceCaches[_]),r.images.some((y=>y.iconsetId))&&this.fire(new o.z("data",{dataType:"style"}))}rasterizeImages(t,r,u){this.imageManager.rasterizeImages(r,u)}getGlyphs(t,r,u){this.glyphManager.getGlyphs(r.stacks,u)}getResource(t,r,u){return o.dy(r,u)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const r=[];return this._otherSourceCaches[t]&&r.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&r.push(this._symbolSourceCaches[t]),r}_isSourceCacheLoaded(t){const r=this.getOwnSourceCaches(t);return r.length===0?(this.fire(new o.y(new Error(`There is no source with ID '${t}'`))),!1):r.every((u=>u.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,r){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const u=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),p=t.type==="building";if(t.is3D(!!this.terrain)){if(u||p||r&&r.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ho.getSourceType=function(c){return Nr[c]},Ho.setSourceType=function(c,t){Nr[c]=t},Ho.registerForPluginStateChange=o.dz;class Cc extends o.E{constructor(t){super(),this._style=t,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},o.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(t){t===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=t,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(t){this._activeFloorsVisible=t,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(t){for(const[r,u]of Object.entries(t.buildings))if(this._buildings[r])for(const p of u.floorIds)this._buildings[r].floors[p]||(this._buildings[r].floors[p]=u.floors[p]);else this._buildings[r]=u;for(const r of t.activeFloors)this._activeFloors.add(r);this._updateIndoorSelector()}getIndoorTileOptions(t,r){const u=this._style.getIndoorSourceLayers(t,r);return u&&this._indoorState?{sourceLayers:u,indoorState:this._indoorState}:null}_updateUI(t,r,u){const p=(function(_,y,b,T){let M=null,I=Number.MAX_SAFE_INTEGER;if(T<16)return null;for(const[P,z]of Object.entries(_)){const O=z.center;if(O){const B=y.distanceTo(o.aS.convert(O));B<I&&b.contains(O)&&(I=B,M=P)}}return M})(this._buildings,r,u,t);p!==this._closestBuildingId&&(this._closestBuildingId=p,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,r=this._closestBuildingId,u=r&&t?t[r]:void 0;if(!u)return void this.fire(new o.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let p=null;for(const y of u.floorIds)if(this._activeFloors&&this._activeFloors.has(y)){p=y;break}const _=Array.from(u.floorIds).map((y=>({id:y,name:u.floors[y].name,zIndex:u.floors[y].zIndex}))).sort(((y,b)=>b.zIndex-y.zIndex));this.fire(new o.z("selector-update",{selectedFloorId:p,activeFloorsVisible:this._activeFloorsVisible,floors:_}))}_updateActiveFloors(){const t=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:t,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Ou=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,zd=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Rh=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Ua="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ml=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,uo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,_l=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ka=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,zc=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,pt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Dh=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const qo=[];ho(Ou,qo),ho(Rh,qo),ho(zd,qo);const Rc={"_prelude_fog.vertex.glsl":uo,"_prelude_terrain.vertex.glsl":ml,"_prelude_shadow.vertex.glsl":pt,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":_l,"_prelude_shadow.fragment.glsl":Dh,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Ka,"_prelude_raster_particle.glsl":zc},ql={};Ai("",ml),Ai(_l,uo),Ai(Dh,pt),Ai(Ka,""),Ai(zc,"");const Us=Ai(zd,Rh),Vs=Ou;var Va={background:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Ai(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Ai(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ai("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ai(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ai(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ai("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ai("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ai("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Ai(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Ai(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ai(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ai(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ai(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ai(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ai("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ai("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ai(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ai(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ai("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ai(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ua),skyboxGradient:Ai(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ua),skyboxCapture:Ai(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ai(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ai(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ai(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Ai("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Ai("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Ai("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Ai("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function ho(c,t){const r=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of r)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const p=u.split(" ");for(const _ of p)t.includes(_)||t.push(_)}}function Ai(c,t){const r=/#include\s+"([^"]+)"/g,u=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,p={},_=[],y=[];if(c=c.replace(r,((T,M)=>(y.push(M),""))),(t=t.replace(r,((T,M)=>(_.push(M),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let b=[...qo];ho(c,b),ho(t,b);for(const T of[..._,...y])Rc[T]||console.error(`Undefined include: ${T}`),ql[T]||(ql[T]=[],ho(Rc[T],ql[T])),b=[...b,...ql[T]];return{fragmentSource:c=c.replace(u,((T,M,I,P,z)=>(p[z]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${z}
in ${I} ${P} ${z};
#else
uniform ${I} ${P} u_${z};
#endif
`:M==="initialize"?`
#ifdef HAS_UNIFORM_u_${z}
    ${I} ${P} ${z} = u_${z};
#endif
`:M==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    in ${I} ${P} ${z};
#endif
`:M==="initialize-attribute"?"":void 0))),vertexSource:t=t.replace(u,((T,M,I,P,z)=>{const O=`MATERIAL_ATTRIBUTE_OFFSET_${z}`,B=P==="float"?"vec2":P,N=`GET_ATTRIBUTE_${B}(a_${z}, materialInfo, ${O})`,H=z.match(/color/)?"color":B;return M==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${z}
in ${I} ${P} a_${z};
#endif
`:p[z]?M==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
    #if !defined(${O})
        in ${I} ${B} a_${z};
    #endif
out ${I} ${P} ${z};
#else
uniform ${I} ${P} u_${z};
#endif
`:M==="initialize"?H==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${I} ${P} ${z} = u_${z};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${z}) 
    #ifdef ${O}
        ${z} = unpack_mix_${H}(${N}, u_${z}_t);
    #else
        ${z} = unpack_mix_${H}(a_${z}, u_${z}_t);
    #endif
#else
    ${I} ${P} ${z} = u_${z};
#endif
`:M==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    in ${I} ${P} a_${z};
    out ${I} ${P} ${z};
#endif
`:M==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    ${z} = a_${z};
#endif
`:void 0:M==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
    #if !defined(${O})
        in ${I} ${B} a_${z};
    #endif  
#else
uniform ${I} ${P} u_${z};
#endif
`:M==="define-instanced"?H==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${z}0;
in vec4 a_${z}1;
in vec4 a_${z}2;
in vec4 a_${z}3;
#else
uniform ${I} ${P} u_${z};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${I} ${B} a_${z};
#else
uniform ${I} ${P} u_${z};
#endif
`:M==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    ${I} ${P} ${z} = a_${z};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    #ifdef ${O}
        ${I} ${P} ${z} = ${N};
    #else
        ${I} ${P} ${z} = a_${z};
    #endif
#else
    ${I} ${P} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    #ifdef ${O}
        ${I} ${P} ${z} = unpack_mix_${H}(${N}, u_${z}_t);
    #else
        ${I} ${P} ${z} = unpack_mix_${H}(a_${z}, u_${z}_t);
    #endif
#else
    ${I} ${P} ${z} = u_${z};
#endif
`})),usedDefines:b,vertexIncludes:_,fragmentIncludes:y}}class Dc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,r,u,p,_,y,b,T){this.context=t;let M=this.boundPaintVertexBuffers.length!==p.length;for(let P=0;!M&&P<p.length;P++)this.boundPaintVertexBuffers[P]!==p[P]&&(M=!0);let I=this.boundDynamicVertexBuffers.length!==b.length;for(let P=0;!I&&P<b.length;P++)this.boundDynamicVertexBuffers[P]!==b[P]&&(I=!0);if(!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==u||M||I||this.boundIndexBuffer!==_||this.boundVertexOffset!==y)this.freshBind(r,u,p,_,y,b,T);else{t.bindVertexArrayOES.set(this.vao);for(const P of b)P&&(P.bind(),T&&P.instanceCount&&P.setVertexAttribDivisor(t.gl,r,T));_&&_.dynamicDraw&&_.bind()}}freshBind(t,r,u,p,_,y,b){const T=this.context,M=T.gl;this.vao&&this.destroy(),this.vao=T.gl.createVertexArray(),T.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=y,r.enableAttributes(M,t),r.bind(),r.setVertexAttribPointers(M,t,_);for(const I of u)I.enableAttributes(M,t),I.bind(),I.setVertexAttribPointers(M,t,_);for(const I of y)I&&(I.enableAttributes(M,t),I.bind(),I.setVertexAttribPointers(M,t,_),b&&I.instanceCount&&I.setVertexAttribDivisor(M,t,b));p&&p.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Rd(c,t){const r=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new o.ae(0,u/r).toLngLat().lat,new o.ae(0,(u+1)/r).toLngLat().lat]}function Pc(c,t,r,u,p,_,y){const b=c.context,T=b.gl,M=r.hillshadeFBO;if(!M)return;c.prepareDrawTile();const I=c.isTileAffectedByFog(t),P=c.getOrCreateProgram("hillshade",{overrideFog:I});b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,M.colorAttachment.get());const z=((H,j,Z,K)=>{const W=Z.paint.get("hillshade-shadow-color"),se=Z.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Q=Z.paint.get("hillshade-highlight-color"),ce=Z.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ie=Z.paint.get("hillshade-accent-color"),te=Z.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",ue=Z.paint.get("hillshade-emissive-strength");let we=o.an(Z.paint.get("hillshade-illumination-direction"));if(Z.paint.get("hillshade-illumination-anchor")==="viewport")we-=H.transform.angle;else if(H.style&&H.style.enable3dLights()&&H.style.directionalLight){const Oe=H.style.directionalLight.properties.get("direction"),ze=o.d3(Oe.x,Oe.y,Oe.z);we=o.an(ze[1])}const ve=!H.options.moving;return{u_matrix:K||H.transform.calculateProjMatrix(j.tileID.toUnwrapped(),ve),u_image:0,u_latrange:Rd(0,j.tileID),u_light:[Z.paint.get("hillshade-exaggeration"),we],u_shadow:W.toPremultipliedRenderColor(se?null:Z.lut),u_highlight:Q.toPremultipliedRenderColor(ce?null:Z.lut),u_emissive_strength:ue,u_accent:ie.toPremultipliedRenderColor(te?null:Z.lut)}})(c,r,u,c.terrain?t.projMatrix:null);c.uploadCommonUniforms(b,P,t.toUnwrapped());const{tileBoundsBuffer:O,tileBoundsIndexBuffer:B,tileBoundsSegments:N}=c.getTileBoundsBuffers(r);P.draw(c,T.TRIANGLES,p,_,y,ii.disabled,z,u.id,O,B,N)}function Fu(c,t,r){if(!t.needsDEMTextureUpload)return;const u=c.context,p=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||c.getTileTexture(r.stride);const _=r.getPixels();t.demTexture?t.demTexture.update(_,{premultiply:!1}):t.demTexture=new o.T(u,_,p.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Z1(c,t,r){const u=c.context,p=u.gl;if(!t.dem)return;const _=t.dem;if(u.activeTexture.set(p.TEXTURE1),Fu(c,t,_),!t.demTexture)return;t.demTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE);const y=_.dim;u.activeTexture.set(p.TEXTURE0);let b=t.hillshadeFBO;if(!b){const z=new o.T(u,{width:y,height:y,data:null},p.RGBA8);z.bind(p.LINEAR,p.CLAMP_TO_EDGE),b=t.hillshadeFBO=u.createFramebuffer(y,y,!0,"renderbuffer"),b.colorAttachment.set(z.texture)}u.bindFramebuffer.set(b.framebuffer),u.viewport.set([0,0,y,y]);const{tileBoundsBuffer:T,tileBoundsIndexBuffer:M,tileBoundsSegments:I}=c.getMercatorTileBoundsBuffers(),P=[];c.linearFloatFilteringSupported()&&P.push("TERRAIN_DEM_FLOAT_FORMAT"),c.getOrCreateProgram("hillshadePrepare",{defines:P}).draw(c,p.TRIANGLES,Ut.disabled,li.disabled,xi.unblended,ii.disabled,((z,O)=>{const B=O.stride,N=o.bB();return o.cd(N,0,o.al,-o.al,0,0,1),o.bq(N,N,[0,-o.al,0]),{u_matrix:N,u_image:1,u_dimension:[B,B],u_zoom:z.overscaledZ}})(t.tileID,_),r.id,T,M,I),t.needsHillshadePrepare=!1}class Xn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Hf extends Xn{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class fo extends Xn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Bu extends Xn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ku extends Xn{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Dd extends Xn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ph extends Xn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Io extends Xn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Zo extends Xn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class us extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class js extends Xn{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class hs extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class ds extends Xn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Lh extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class Oh extends Xn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class gl extends Xn{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Lc extends Xn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class na extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class gr extends Xn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Gn extends Xn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Gs=class extends Xn{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}};class Co extends Xn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Zl extends Xn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class fs extends Xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Fh extends Xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Pd extends Xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class yl extends Xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ps extends Xn{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ld extends Xn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Nu extends Xn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Od extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Xo extends Xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class $o extends Xn{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class Xl extends $o{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Hs extends $o{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,this.attachment(),r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class qf extends $o{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,this.attachment(),r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Bh extends Hs{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const $l=(c,t,r)=>({u_matrix:c,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:r}),Oc=(c,t,r,u,p,_,y,b,T,M,I,P,z,O,B,N)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:r,u_zoom_transition:p,u_merc_center:_,u_image0:0,u_frustum_tl:y,u_frustum_tr:b,u_frustum_br:T,u_frustum_bl:M,u_globe_pos:I,u_globe_radius:P,u_viewport:z,u_grid_matrix:N?Float32Array.from(N):new Float32Array(9),u_skirt_height:O,u_far_z_cutoff:B});function qs(c,t){return c!=null&&t!=null&&!(!c.hasData()||!t.hasData())&&c.demTexture!=null&&t.demTexture!=null&&c.tileID.key!==t.tileID.key}const Vr=new class{constructor(){this.operations={}}newMorphing(c,t,r,u,p){if(c in this.operations){const _=this.operations[c];_.to.tileID.key!==r.tileID.key&&(_.queued=r)}else this.operations[c]={startTime:u,phase:0,duration:p,from:t,to:r,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const t=this.operations[c];return{from:t.from,to:t.to,phase:t.phase}}update(c){for(const t in this.operations){const r=this.operations[t];for(r.phase=(c-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,c)){delete this.operations[t];break}}}_nextOp(c,t){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=t,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},Uu={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Zf(c,t,r){if(t===0)return 0;const u=t<1&&r===514?.25/t:1;return 6*Math.pow(1.5,22-c)*Math.max(t,1)*u}function kh(c,t){const r=1<<c.z;return!t&&(c.x===0||c.x===r-1)||c.y===0||c.y===r-1}const Fc=c=>({u_matrix:c});function Fd(c,t,r,u,p){if(p>0){const _=o.o.now(),y=(_-c.timeAdded)/p,b=t?(_-t.timeAdded)/p:-1,T=r.getSource(),M=u.coveringZoomLevel({tileSize:T.tileSize,roundZoom:T.roundZoom}),I=!t||Math.abs(t.tileID.overscaledZ-M)>Math.abs(c.tileID.overscaledZ-M),P=I&&c.refreshedUponExpiration?1:o.aA(I?y:1-b,0,1);return t?{opacity:1,mix:1-P,isFading:y<1}:{opacity:P,mix:0,isFading:y<1}}return{opacity:1,mix:0,isFading:!1}}class cr extends so{constructor(t){const r=wa("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",r,!1),r.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,r){t.state="loaded",r(null)}}class Nh extends so{constructor(t){const r=wa("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,r,u){if(t.freezeTileCoverage)return;this.transform=t;const p=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((_,y)=>{if(_[y.key]="",!this._tiles[y.key]){const b=new jo(y,this._source.tileSize*y.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);b.state="loaded",this._tiles[y.key]=b}return _}),{});for(const _ in this._tiles)_ in p||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(t){const r=this.proxyCachedFBO[t];if(r!==void 0){const u=Object.values(r);this.renderCachePool.push(...u),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class vl extends o.aP{constructor(t,r,u){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=r,this.projMatrix=u}}class xl extends o.bU{constructor(t,r){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,p,_]=(function(T){const M=new o.bc,I=new o.b0,P=131;M.reserve(17161),I.reserve(33800);const z=o.al/128,O=o.al+z/2,B=O+z;for(let H=-z;H<B;H+=z)for(let j=-z;j<B;j+=z){const Z=j<0||j>O||H<0||H>O?24575:0,K=o.aA(Math.round(j),0,o.al),W=o.aA(Math.round(H),0,o.al);M.emplaceBack(K+Z,W)}const N=(H,j)=>{const Z=j*P+H;I.emplaceBack(Z+1,Z,Z+P),I.emplaceBack(Z+P,Z+P+1,Z+1)};for(let H=1;H<129;H++)for(let j=1;j<129;j++)N(j,H);return[0,129].forEach((H=>{for(let j=0;j<130;j++)N(j,H),N(H,j)})),[M,I,32768]})(),y=t.context;this.gridBuffer=y.createVertexBuffer(u,o.be.members),this.gridIndexBuffer=y.createIndexBuffer(p),this.gridSegments=o.bf.simpleSegment(0,0,u.length,p.length),this.gridNoSkirtSegments=o.bf.simpleSegment(0,0,u.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Nh(r.map),this.orthoMatrix=o.bB(),o.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.al,0,o.al,0,1);const b=y.gl;this._overlapStencilMode=new li({func:b.GEQUAL,mask:255},0,255,b.KEEP,b.KEEP,b.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new cr(r.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,r,u){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const p=t.terrain.properties,_=t.terrain.drapeRenderMode===0,y=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.o.now();const b=t.terrain&&t.terrain.scope,T=p.get("source"),M=_?this._mockSourceCache:t.getSourceCache(T,b);if(!M)return void o.w(`Couldn't find terrain source "${T}".`);if(this.sourceCache=M,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=y?this.calculateExaggeration(r):p.get("exaggeration"),!r.projection.requiresDraping&&y&&this._exaggeration===0)return void this._disable();this.enabled=!0;const I=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const P=this.getScaledDemTileSize();this.sourceCache.update(r,P,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,I(),this._initializing=!0),I(),r.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const r=this._previousCameraAltitude,u=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=u;const p=r!=null?u-r:Number.MAX_VALUE;if(Math.abs(p)<2)return this._exaggeration;const _=t.zoom,y=this._style.terrain;if(!this._previousUpdateTimestamp)return y.getExaggeration(_);let b=_-this._previousZoom;const T=this._previousUpdateTimestamp;let M=_;this._evaluationZoom!=null&&(M=this._evaluationZoom,Math.abs(_-M)>.5&&(b=.5*(_-M+b)),b*p<0&&(M+=b)),this._evaluationZoom=M;const I=y.getExaggeration(M),P=I===y.getExaggeration(Math.max(0,M-.1));if(P&&Math.abs(I-this._exaggeration)<.01)return I;let z=Math.min(.1,.00375*(this._updateTimestamp-T));return(P||I<.1||Math.abs(b)<1e-4)&&(z=Math.min(.2,4*z)),o.ak(this._exaggeration,I,z)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(o.ae.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=r.getIds().map((T=>{const M=r.getTileByID(T).tileID;return M.projMatrix=u.calculateProjMatrix(M.toUnwrapped()),M}));(function(T,M){const I=M.transform.pointCoordinate(M.transform.getCameraPoint()),P=new o.P(I.x,I.y);T.sort(((z,O)=>{if(O.overscaledZ-z.overscaledZ)return O.overscaledZ-z.overscaledZ;const B=new o.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),N=new o.P(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),H=P.mult(1<<z.canonical.z);return H.x-=.5,H.y-=.5,H.distSqr(B)-H.distSqr(N)}))})(p,this.painter);const _=this.proxyToSource||{};this.proxyToSource={},p.forEach((T=>{this.proxyToSource[T.key]={}})),this.terrainTileForTile={};const y=this._style._mergedSourceCaches;for(const T in y){const M=y[T];if(!M.used||(M!==this.sourceCache&&this.resetTileLookupCache(M.id),this._setupProxiedCoordsForOrtho(M,t[T],_),M.usedForTerrain))continue;const I=t[T];M.getSource().reparseOverscaled&&this._assignTerrainTiles(I)}this.proxiedCoords[r.id]=p.map((T=>new vl(T,T.key,this.orthoMatrix))),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1;const b={};this._visibleDemTiles=[];for(const T of this.proxyCoords){const M=this.terrainTileForTile[T.key];if(!M)continue;const I=M.tileID.key;I in b||(this._visibleDemTiles.push(M),b[I]=I)}}_assignTerrainTiles(t){this._initializing||t.forEach((r=>{if(this.terrainTileForTile[r.key])return;const u=this._findTileCoveringTileID(r,this.sourceCache);u&&(this.terrainTileForTile[r.key]=u)}))}_prepareDEMTextures(){const t=this.painter.context,r=t.gl;for(const u in this.terrainTileForTile){const p=this.terrainTileForTile[u],_=p.dem;!_||p.demTexture&&!p.needsDEMTextureUpload||(t.activeTexture.set(r.TEXTURE1),Fu(this.painter,p,_))}}_prepareDemTileUniforms(t,r,u,p){if(!r||r.demTexture==null)return!1;const _=t.tileID.canonical,y=Math.pow(2,r.tileID.canonical.z-_.z),b=p||"";return u[`u_dem_tl${b}`]=[_.x*y%1,_.y*y%1],u[`u_dem_scale${b}`]=y,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const r=this._visibleDemTiles.reduce(((u,p)=>{if(!p.dem)return u;const _=p.dem.tree.minimums[0];return _>0&&t++,u+_}),0);return t?r/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,r=t.gl;t.activeTexture.set(r.TEXTURE2);const u=this._getLoadedAreaMinimum(),p=new o.dK({width:1,height:1},new Float32Array([u]));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(p,{premultiply:!1}):_=this._emptyDEMTexture=new o.T(t,p,r.R32F,{premultiply:!1}),_}setupElevationDraw(t,r,u){const p=this.painter.context,_=p.gl,y={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};y.u_exaggeration=this.exaggeration();let b=null,T=null,M=1;if(u&&u.morphing&&this._useVertexMorphing){const O=u.morphing.srcDemTile,B=u.morphing.dstDemTile;M=u.morphing.phase,O&&B&&(this._prepareDemTileUniforms(t,O,y,"_prev")&&(T=O),this._prepareDemTileUniforms(t,B,y)&&(b=B))}const I=O=>O&&O.demTexture&&this.painter.linearFloatFilteringSupported()?_.LINEAR:_.NEAREST;let P=null;var z;if(this.enabled?T&&b?(P=b.demTexture,p.activeTexture.set(_.TEXTURE4),T.demTexture.bind(I(T),_.CLAMP_TO_EDGE),y.u_dem_lerp=M):(b=this.terrainTileForTile[t.tileID.key],P=this._prepareDemTileUniforms(t,b,y)?b.demTexture:this.emptyDEMTexture):P=this.emptyDEMTexture,p.activeTexture.set(_.TEXTURE2),P&&(y.u_dem_size=(z=P).size[0]===1?1:z.size[0]-2,P.bind(I(b),_.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(u&&u.useDepthForOcclusion,r,y),u&&u.useMeterToDem&&b){const O=(1<<b.tileID.canonical.z)*o.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;y.u_meter_to_dem=O}if(u&&u.labelPlaneMatrixInv&&(y.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),r.setTerrainUniformValues(p,y),this.painter.transform.projection.name==="globe"){const O=this.globeUniformValues(this.painter.transform,t.tileID.canonical,u&&u.useDenormalizedUpVectorScale);r.setGlobeUniformValues(p,O)}}globeUniformValues(t,r,u){const p=t.projection;return{u_tile_tl_up:p.upVector(r,0,0),u_tile_tr_up:p.upVector(r,o.al,0),u_tile_br_up:p.upVector(r,o.al,o.al),u_tile_bl_up:p.upVector(r,0,o.al),u_tile_up_scale:u?o.dL(1):p.upVectorScale(r,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const r=this.painter,u=this.painter.context;t.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(p,_,y,b,T){if(p.transform.projection.name==="globe")(function(M,I,P,z,O){const B=M.context,N=B.gl;let H,j;const Z=M.transform,K=o.dD(M,B,Z),W=(Oe,ze)=>{if(j===ze)return;const je=[Uu[ze],"PROJECTION_GLOBE_VIEW"];K&&je.push("CUSTOM_ANTIALIASING");const lt=M.isTileAffectedByFog(Oe);H=M.getOrCreateProgram("globeRaster",{defines:je,overrideFog:lt}),j=ze},se=M.colorModeForRenderPass(),Q=new Ut(N.LEQUAL,Ut.ReadWrite,M.depthRangeFor3D);Vr.update(O);const ce=o.dE(Z),ie=[o.aF(Z.center.lng),o.aJ(Z.center.lat)],te=M.globeSharedBuffers,ue=[Z.width*o.o.devicePixelRatio,Z.height*o.o.devicePixelRatio],we=Float32Array.from(Z.globeMatrix),ve={useDenormalizedUpVectorScale:!0};{const Oe=M.transform,ze=Zf(Oe.zoom,I.exaggeration(),I.sourceCache._source.tileSize);j=-1;const je=N.TRIANGLES;for(const lt of z){const Me=P.getTile(lt),ge=li.disabled,Ge=I.prevTerrainTileForTile[lt.key],Re=I.terrainTileForTile[lt.key];qs(Ge,Re)&&Vr.newMorphing(lt.key,Ge,Re,O,250),B.activeTexture.set(N.TEXTURE0),Me.texture&&Me.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const it=Vr.getMorphValuesForProxy(lt.key),Je=it?1:0;it&&Object.assign(ve,{morphing:{srcDemTile:it.from,dstDemTile:it.to,phase:o.dC(it.phase)}});const vt=o.dF(lt.canonical),Ze=o.dG(vt.getCenter().lat),$e=o.dH(lt.canonical,vt,Ze,Oe.worldSize/Oe._pixelsPerMercatorPixel),xt=o.bj(o.dI(lt.canonical)),Mt=Oc(Oe.expandedFarZProjMatrix,we,ce,xt,o.aj(Oe.zoom),ie,Oe.frustumCorners.TL,Oe.frustumCorners.TR,Oe.frustumCorners.BR,Oe.frustumCorners.BL,Oe.globeCenterInViewSpace,Oe.globeRadius,ue,ze,Oe._farZ,$e);if(W(lt,Je),H&&(I.setupElevationDraw(Me,H,ve),M.uploadCommonUniforms(B,H,lt.toUnwrapped()),te)){const[St,Rt,Kt]=te.getGridBuffers(Ze,ze!==0);H.draw(M,je,Q,ge,se,ii.backCCW,Mt,"globe_raster",St,Rt,Kt)}}}if(te&&(M.renderDefaultNorthPole||M.renderDefaultSouthPole)){const Oe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];K&&Oe.push("CUSTOM_ANTIALIASING"),H=M.getOrCreateProgram("globeRaster",{defines:Oe});for(const ze of z){const{x:je,y:lt,z:Me}=ze.canonical,ge=lt===0,Ge=lt===(1<<Me)-1,[Re,it,Je,vt]=te.getPoleBuffers(Me,!1);if(vt&&(ge||Ge)){const Ze=P.getTile(ze);B.activeTexture.set(N.TEXTURE0),Ze.texture&&Ze.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);let $e=o.dJ(Me,je,Z);const xt=o.bj(o.dI(ze.canonical)),Mt=(St,Rt)=>St.draw(M,N.TRIANGLES,Q,li.disabled,se,ii.disabled,Oc(Z.expandedFarZProjMatrix,$e,$e,xt,0,ie,Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.globeCenterInViewSpace,Z.globeRadius,ue,0,Z._farZ),"globe_pole_raster",Rt,Je,vt);I.setupElevationDraw(Ze,H,ve),M.uploadCommonUniforms(B,H,ze.toUnwrapped()),ge&&M.renderDefaultNorthPole&&Mt(H,Re),Ge&&M.renderDefaultSouthPole&&($e=o.cR(o.bB(),$e,[1,-1,1]),Mt(H,it))}}}})(p,_,y,b,T);else{const M=p.context,I=M.gl;let P,z;const O=p.shadowRenderer,B=Mo(p,p.longestCutoffRange),N=se=>{if(z===se)return;const Q=[];Q.push(Uu[se]),B.shouldRenderCutoff&&Q.push("RENDER_CUTOFF"),O&&(Q.push("RENDER_SHADOWS","DEPTH_TEXTURE"),O.useNormalOffset&&Q.push("NORMAL_OFFSET")),P=p.getOrCreateProgram("terrainRaster",{defines:Q}),z=se},H=p.colorModeForRenderPass(),j=new Ut(I.LEQUAL,Ut.ReadWrite,p.depthRangeFor3D);Vr.update(T);const Z=p.transform,K=Zf(Z.zoom,_.exaggeration(),_.sourceCache._source.tileSize);let W=[0,0,0];if(O){const se=p.style.directionalLight,Q=p.style.ambientLight;se&&Q&&(W=Pa(p.style,se,Q))}{z=-1;const se=I.TRIANGLES,[Q,ce]=[_.gridIndexBuffer,_.gridSegments];for(const ie of b){const te=y.getTile(ie),ue=li.disabled,we=_.prevTerrainTileForTile[ie.key],ve=_.terrainTileForTile[ie.key];qs(we,ve)&&Vr.newMorphing(ie.key,we,ve,T,250),M.activeTexture.set(I.TEXTURE0),te.texture&&te.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE);const Oe=Vr.getMorphValuesForProxy(ie.key),ze=Oe?1:0;let je;Oe&&(je={morphing:{srcDemTile:Oe.from,dstDemTile:Oe.to,phase:o.dC(Oe.phase)}});const lt=$l(ie.projMatrix,kh(ie.canonical,Z.renderWorldCopies)?K/10:K,W);if(N(ze),!P)continue;_.setupElevationDraw(te,P,je);const Me=ie.toUnwrapped();O&&O.setupShadows(Me,P),p.uploadCommonUniforms(M,P,Me,null,B),P.draw(p,se,j,ue,H,ii.backCCW,lt,"terrain_raster",_.gridBuffer,Q,ce)}}}})(r,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const r=this.painter,u=this.painter.context,p=this.proxySourceCache,_=this.proxiedCoords[p.id],y=this._drapedRenderBatches.shift(),b=r.style.order,T=[];let M=0;for(const I of _){const P=p.getTileByID(I.proxyTileKey),z=p.proxyCachedFBO[I.key]?p.proxyCachedFBO[I.key][t]:void 0,O=z!==void 0?p.renderCache[z]:this.pool[M++],B=z!==void 0;if(P.texture=O.tex,B&&!O.dirty){T.push(P.tileID);continue}let N;u.bindFramebuffer.set(O.fb.framebuffer),this.renderedToTile=!1,O.dirty&&(u.clear({color:o.ao.transparent,stencil:0}),O.dirty=!1);for(let H=y.start;H<=y.end;++H){const j=r.style._mergedLayers[b[H]];if(j.isHidden(r.transform.zoom))continue;const Z=r.style.getLayerSourceCache(j),K=Z?this.proxyToSource[I.key][Z.id]:[I];if(!K)continue;const W=K;u.viewport.set([0,0,O.fb.width,O.fb.height]),N!==(Z?Z.id:null)&&(this._setupStencil(O,K,j,Z),N=Z?Z.id:null),r.renderLayer(r,Z,j,W)}if(this._drapedRenderBatches.length===0)for(const H of this._pendingGroundEffectLayers){const j=r.style._mergedLayers[b[H]];if(j.isHidden(r.transform.zoom))continue;const Z=r.style.getLayerSourceCache(j),K=Z?this.proxyToSource[I.key][Z.id]:[I];if(!K)continue;const W=K;u.viewport.set([0,0,O.fb.width,O.fb.height]),N!==(Z?Z.id:null)&&(this._setupStencil(O,K,j,Z),N=Z?Z.id:null),r.renderLayer(r,Z,j,W)}this.renderedToTile?(O.dirty=!0,T.push(P.tileID)):B||--M,M===5&&(M=0,this.renderToBackBuffer(T))}return this.renderToBackBuffer(T),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,r.width,r.height]),y.end+1}postRender(){}isLayerOrderingCorrect(t){const r=t.order.length;let u=-1,p=r;for(let _=0;_<r;++_)this._style.isLayerDraped(t._mergedLayers[t.order[_]])?u=Math.max(u,_):p=Math.min(p,_);return p>u}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((r=>r.dem)).forEach((r=>{t=Math.min(t,r.dem.tree.minimums[0])})),t===0?t:(t-30)*this._exaggeration}raycast(t,r,u){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter((_=>_.dem)).map((_=>{const y=_.tileID,b=1<<y.overscaledZ,{x:T,y:M}=y.canonical,I=T/b,P=(T+1)/b,z=M/b,O=(M+1)/b;return{minx:I,miny:z,maxx:P,maxy:O,t:_.dem.tree.raycastRoot(I,z,P,O,t,r,u),tile:_}}));p.sort(((_,y)=>(_.t!==null?_.t:Number.MAX_VALUE)-(y.t!==null?y.t:Number.MAX_VALUE)));for(const _ of p){if(_.t==null)return null;const y=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,t,r,u);if(y!=null)return y}return null}_createFBO(){const t=this.painter.context,r=t.gl,u=this.drapeBufferSize;t.activeTexture.set(r.TEXTURE0);const p=new o.T(t,{width:u[0],height:u[1],data:null},r.RGBA8);p.bind(r.LINEAR,r.CLAMP_TO_EDGE);const _=t.createFramebuffer(u[0],u[1],!0,null);return _.colorAttachment.set(p.texture),_.depthAttachment=new Bh(t,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:_,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const r=this._style._mergedLayers[t],u=r.isHidden(this.painter.transform.zoom);return r.type==="hillshade"||r.type==="custom"?!u&&r.shouldRedrape():!u&&r.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const u of this._style.getSources())if(u instanceof ma){t=!0;break}if(!t)return;const r={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],_=this._style.getLayerSourceCache(p);if(_&&!r[_.id]&&!p.isHidden(this.painter.transform.zoom)&&p.type==="line"&&p.widthExpression()instanceof o.ad){r[_.id]=!0;for(const y of this.proxyCoords){const b=this.proxyToSource[y.key][_.id];if(b)for(const T of b)this._clearRenderCacheForTile(_.id,T)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof To){t=!0;break}if(!t)return;const r={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],_=this._style.getLayerSourceCache(p);if(!_||r[_.id]||p.isHidden(this.painter.transform.zoom)||p.type!=="raster")continue;const y=p.paint.get("raster-fade-duration");for(const b of this.proxyCoords){const T=this.proxyToSource[b.key][_.id];if(T)for(const M of T){const I=Fd(_.getTile(M),_.findLoadedParent(M,0),_,this.painter.transform,y);(I.opacity!==1||I.mix!==0)&&this._clearRenderCacheForTile(_.id,M)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,r=t.length;if(r===0)return;const u=[];this._pendingGroundEffectLayers=[];let p,_=0,y=this._style._mergedLayers[t[_]];for(;!this._style.isLayerDraped(y)&&y.isHidden(this.painter.transform.zoom)&&++_<r;)y=this._style._mergedLayers[t[_]];for(;_<r;++_){const b=this._style._mergedLayers[t[_]];b.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(b)?p===void 0&&(p=_):(b.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(_),p!==void 0&&(u.push({start:p,end:_-1}),p=void 0)))}if(p!==void 0&&u.push({start:p,end:_-1}),u.length!==0){const b=u[u.length-1];this._pendingGroundEffectLayers.every((T=>T>b.end))||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(t){const r=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,r.renderCache.length>r.renderCachePool.length){const y=Object.values(r.proxyCachedFBO);r.proxyCachedFBO={};for(let b=0;b<y.length;++b){const T=Object.values(y[b]);r.renderCachePool.push(...T)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,p=this._tilesDirty;for(let y=u.length-1;y>=0;y--){const b=u[y];if(r.getTileByID(b.key),r.proxyCachedFBO[b.key]!==void 0){const T=t[b.key],M=this.proxyToSource[b.key];let I=0;for(const P in M){const z=M[P],O=T[P];if(!O||O.length!==z.length||z.some(((B,N)=>B!==O[N]||p[P]&&p[P].hasOwnProperty(B.key)))){I=-1;break}++I}for(const P in r.proxyCachedFBO[b.key])r.renderCache[r.proxyCachedFBO[b.key][P]].dirty=I<0||I!==Object.values(T).length}}const _=[...this._drapedRenderBatches];_.sort(((y,b)=>b.end-b.start-(y.end-y.start)));for(const y of _)for(const b of u){if(r.proxyCachedFBO[b.key])continue;let T=r.renderCachePool.pop();T===void 0&&r.renderCache.length<50&&(T=r.renderCache.length,r.renderCache.push(this._createFBO())),T!==void 0&&(r.proxyCachedFBO[b.key]={},r.proxyCachedFBO[b.key][y.start]=T,r.renderCache[T].dirty=!0)}this._tilesDirty={}}_setupStencil(t,r,u,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,y=_.gl;if(r.length<=1)return void(this._overlapStencilType=!1);let b;if(u.isTileClipped())b=r.length,this._overlapStencilMode.test={func:y.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(r[0].overscaledZ>r[r.length-1].overscaledZ))return void(this._overlapStencilType=!1);b=1,this._overlapStencilMode.test={func:y.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+b>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=b,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(r,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):li.disabled}_renderTileClippingMasks(t,r){const u=this.painter,p=this.painter.context,_=p.gl;u._tileClippingMaskIDs={},p.setColorMode(xi.disabled),p.setDepthMode(Ut.disabled);const y=u.getOrCreateProgram("clippingMask");for(const b of t){const T=u._tileClippingMaskIDs[b.key]=--r;y.draw(u,_.TRIANGLES,Ut.disabled,new li({func:_.ALWAYS,mask:0},T,255,_.KEEP,_.KEEP,_.REPLACE),xi.disabled,ii.disabled,Fc(b.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(t){const r=this.painter.transform;if(t.x<0||t.x>r.width||t.y<0||t.y>r.height)return null;const u=[t.x,t.y,1,1];o.aC(u,u,r.pixelMatrixInverse),o.cJ(u,u,1/u[3]),u[0]/=r.worldSize,u[1]/=r.worldSize;const p=r._camera.position,_=o.ce(1,r.center.lat),y=[p[0],p[1],p[2]/_,0],b=o.d9([],u.slice(0,3),y);o.aw(b,b);const T=this.raycast(y,b,this._exaggeration);return T!==null&&T?(o.bG(y,y,b,T),y[3]=y[2],y[2]*=_,y):null}_setupProxiedCoordsForOrtho(t,r,u){if(t.getSource()instanceof o.aT)return this._setupProxiedCoordsForImageSource(t,r,u);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const p=this.proxiedCoords[t.id]=[],_=this.proxyCoords;for(let T=0;T<_.length;T++){const M=_[T],I=this._findTileCoveringTileID(M,t);if(I){const P=this._createProxiedId(M,I,u[M.key]&&u[M.key][t.id]);p.push(P),this.proxyToSource[M.key][t.id]=[P]}}let y=!1;const b=new Set;for(let T=0;T<r.length;T++){const M=t.getTile(r[T]);if(!M||!M.hasData())continue;const I=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(I&&I.tileID.canonical.z!==M.tileID.canonical.z){const P=this.proxyToSource[I.tileID.key][t.id],z=this._createProxiedId(I.tileID,M,u[I.tileID.key]&&u[I.tileID.key][t.id]);P?P.splice(P.length-1,0,z):this.proxyToSource[I.tileID.key][t.id]=[z];const O=this.proxyToSource[I.tileID.key][t.id];b.has(O)||b.add(O),p.push(z),y=!0}}if(this._sourceTilesOverlap[t.id]=y,y&&this._debugParams.sortTilesHiZFirst)for(const T of b)T.sort(((M,I)=>I.overscaledZ-M.overscaledZ))}_setupProxiedCoordsForImageSource(t,r,u){if(!t.getSource().loaded())return;const p=this.proxiedCoords[t.id]=[],_=this.proxyCoords,y=t.getSource(),b=y.tileID;if(!b)return;const T=new o.P(b.x,b.y)._div(1<<b.z),M=y.coordinates.map(o.ae.fromLngLat).reduce(((P,z)=>(P.min.x=Math.min(P.min.x,z.x-T.x),P.min.y=Math.min(P.min.y,z.y-T.y),P.max.x=Math.max(P.max.x,z.x-T.x),P.max.y=Math.max(P.max.y,z.y-T.y),P)),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),I=(P,z)=>{const O=P.wrap+P.canonical.x/(1<<P.canonical.z),B=P.canonical.y/(1<<P.canonical.z),N=o.al/(1<<P.canonical.z),H=z.wrap+z.canonical.x/(1<<z.canonical.z),j=z.canonical.y/(1<<z.canonical.z);return O+N<H+M.min.x||O>H+M.max.x||B+N<j+M.min.y||B>j+M.max.y};for(let P=0;P<_.length;P++){const z=_[P];for(let O=0;O<r.length;O++){const B=t.getTile(r[O]);if(!B||!B.hasData()||I(z,B.tileID))continue;const N=this._createProxiedId(z,B,u[z.key]&&u[z.key][t.id]),H=this.proxyToSource[z.key][t.id];H?H.push(N):this.proxyToSource[z.key][t.id]=[N],p.push(N)}}}_createProxiedId(t,r,u){let p=this.orthoMatrix;if(u){const _=u.find((y=>y.key===r.tileID.key));if(_)return _}if(r.tileID.key!==t.key){const _=t.canonical.z-r.tileID.canonical.z;let y,b,T;p=o.bB();const M=r.tileID.wrap-t.wrap<<t.overscaledZ;_>0?(y=o.al>>_,b=y*((r.tileID.canonical.x<<_)-t.canonical.x+M),T=y*((r.tileID.canonical.y<<_)-t.canonical.y)):(y=o.al<<-_,b=o.al*(r.tileID.canonical.x-(t.canonical.x+M<<-_)),T=o.al*(r.tileID.canonical.y-(t.canonical.y<<-_))),o.cd(p,0,y,0,y,0,1),o.bq(p,p,[b,T,0])}return new vl(r.tileID,t.key,p)}_findTileCoveringTileID(t,r){let u=r.getTile(t);if(u&&u.hasData())return u;const p=this._findCoveringTileCache[r.id],_=p[t.key];if(u=_?r.getTileByID(_):null,u&&u.hasData()||_===null)return u;let y=u?u.tileID:t,b=y.overscaledZ;const T=r.getSource().minzoom,M=[];if(!_){const P=r.getSource().maxzoom;if(t.canonical.z>=P){const z=t.canonical.z-P;r.getSource().reparseOverscaled?(b=Math.max(t.canonical.z+2,r.transform.tileZoom),y=new o.aP(b,t.wrap,P,t.canonical.x>>z,t.canonical.y>>z)):z!==0&&(b=P,y=new o.aP(b,t.wrap,P,t.canonical.x>>z,t.canonical.y>>z))}y.key!==t.key&&(M.push(y.key),u=r.getTile(y))}const I=P=>{M.forEach((z=>{p[z]=P})),M.length=0};for(b-=1;b>=T&&(!u||!u.hasData());b--){u&&I(u.tileID.key);const P=y.calculateScaledKey(b);if(u=r.getTileByID(P),u&&u.hasData())break;const z=p[P];if(z===null)break;z===void 0?M.push(P):u=r.getTileByID(z)}return I(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,r){let u=this._tilesDirty[t];u||(u=this._tilesDirty[t]={}),u[r.key]=!0}}function Uh(c,t,r){const u=(function(b,T,M){const I=o.bI(T,b),P=o.bI(M,[.2126,.7152,.0722]),z=(B,N,H)=>(1-H)*B+H*N,O=z(1-.3*Math.min(P,1),1,Math.min(I+1,1));return z(.92,1,Math.asin(o.aA(T[2],-1,1))/Math.PI+.5)*O})(c,[0,0,1],t),p=[0,0,0];o.c4(p,r.slice(0,3),u);const _=[0,0,0];o.c4(_,t.slice(0,3),c[2]);const y=[0,0,0];return o.d7(y,p,_),o.da(y)}const Wl=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Yl=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Vh{static cacheKey(t,r,u,p){let _=`${r}${p?p.cacheKey:""}`;for(const y of u)t.usedDefines.includes(y)&&(_+=`/${y}`);return _}constructor(t,r,u,p,_,y){const b=t.gl;this.program=b.createProgram(),this.configuration=p,this.name=r,this.fixedDefines=[...y];let T=p?p.defines():[];T=T.concat(y.map((B=>`#define ${B}`)));const M=`#version 300 es
`;let I=M+T.concat("precision mediump float;",Vs,Us.fragmentSource).join(`
`);for(const B of u.fragmentIncludes)I+=`
${Rc[B]}`;I+=`
${u.fragmentSource}`;let P=M+T.concat("precision highp float;",Vs,Us.vertexSource).join(`
`);for(const B of u.vertexIncludes)P+=`
${Rc[B]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&u.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(P+=`
uniform int u_instanceID;
`),P+=`
${u.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(P=P.replaceAll("gl_InstanceID","u_instanceID"));const z=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);b.shaderSource(z,I),b.compileShader(z),b.attachShader(this.program,z);const O=b.createShader(b.VERTEX_SHADER);b.isContextLost()?this.failedToCreate=!0:(b.shaderSource(O,P),b.compileShader(O),b.attachShader(this.program,O),this.attributes={},b.linkProgram(this.program),b.deleteShader(O),b.deleteShader(z),this.fixedUniforms=_(t),this.binderUniforms=p?p.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(B=>({u_instanceID:new o.cg(B)}))(t)),(y.includes("TERRAIN")||r.indexOf("symbol")!==-1||r.indexOf("circle")!==-1)&&(this.terrainUniforms=(B=>({u_dem:new o.cg(B),u_dem_prev:new o.cg(B),u_dem_tl:new o.cj(B),u_dem_scale:new o.ci(B),u_dem_tl_prev:new o.cj(B),u_dem_scale_prev:new o.ci(B),u_dem_size:new o.ci(B),u_dem_lerp:new o.ci(B),u_exaggeration:new o.ci(B),u_depth:new o.cg(B),u_depth_size_inv:new o.cj(B),u_depth_range_unpack:new o.cj(B),u_occluder_half_size:new o.ci(B),u_occlusion_depth_offset:new o.ci(B),u_meter_to_dem:new o.ci(B),u_label_plane_matrix_inv:new o.ck(B)}))(t)),y.includes("GLOBE")&&(this.globeUniforms=(B=>({u_tile_tl_up:new o.ch(B),u_tile_tr_up:new o.ch(B),u_tile_br_up:new o.ch(B),u_tile_bl_up:new o.ch(B),u_tile_up_scale:new o.ci(B)}))(t)),y.includes("FOG")&&(this.fogUniforms=(B=>({u_fog_matrix:new o.ck(B),u_fog_range:new o.cj(B),u_fog_color:new o.d2(B),u_fog_horizon_blend:new o.ci(B),u_fog_vertical_limit:new o.cj(B),u_fog_temporal_offset:new o.ci(B),u_frustum_tl:new o.ch(B),u_frustum_tr:new o.ch(B),u_frustum_br:new o.ch(B),u_frustum_bl:new o.ch(B),u_globe_pos:new o.ch(B),u_globe_radius:new o.ci(B),u_globe_transition:new o.ci(B),u_is_globe:new o.cg(B),u_viewport:new o.cj(B)}))(t)),y.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(B=>({u_cutoff_params:new o.d2(B)}))(t)),y.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(B=>({u_lighting_ambient_color:new o.ch(B),u_lighting_directional_dir:new o.ch(B),u_lighting_directional_color:new o.ch(B),u_ground_radiance:new o.ch(B)}))(t)),y.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(B=>({u_light_matrix_0:new o.ck(B),u_light_matrix_1:new o.ck(B),u_fade_range:new o.cj(B),u_shadow_normal_offset:new o.ch(B),u_shadow_intensity:new o.ci(B),u_shadow_texel_size:new o.ci(B),u_shadow_map_resolution:new o.ci(B),u_shadow_direction:new o.ch(B),u_shadow_bias:new o.ch(B),u_shadowmap_0:new o.cg(B),u_shadowmap_1:new o.cg(B)}))(t)))}getAttributeLocation(t,r){let u=this.attributes[r];return u===void 0&&(u=this.attributes[r]=t.getAttribLocation(this.program,r)),u}setTerrainUniformValues(t,r){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p]&&u[p].set(this.program,p,r[p])}}setGlobeUniformValues(t,r){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p]&&u[p].set(this.program,p,r[p])}}setFogUniformValues(t,r){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}}setCutoffUniformValues(t,r){if(!this.cutoffUniforms)return;const u=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}}setLightsUniformValues(t,r){if(!this.lightsUniforms)return;const u=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}}setShadowUniformValues(t,r){if(this.failedToCreate||!this.shadowUniforms)return;const u=this.shadowUniforms;t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}_drawDebugWireframe(t,r,u,p,_,y,b,T,M,I){const P=t.options.wireframe;if(P.terrain===!1&&P.layers2D===!1&&P.layers3D===!1)return;const z=t.context;if(!(!(!P.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!P.layers2D||t._terrain&&t._terrain.renderingToTexture||!Wl.includes(this.name))||!(!P.layers3D||!Yl.includes(this.name))))return;const O=z.gl,B=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,_,z);if(!B)return;const N=[...this.fixedDefines];N.push("DEBUG_WIREFRAME");const H=t.getOrCreateProgram(this.name,{config:this.configuration,defines:N});z.program.set(H.program);const j=(W,se,Q)=>{if(se[W]&&Q[W])for(const ce in se[W])Q[W][ce]&&Q[W][ce].set(Q.program,ce,se[W][ce].current)};M&&M.setUniforms(H.program,z,H.binderUniforms,b,{zoom:T}),j("fixedUniforms",this,H),j("terrainUniforms",this,H),j("globeUniforms",this,H),j("fogUniforms",this,H),j("lightsUniforms",this,H),j("shadowUniforms",this,H),B.bind(),z.setColorMode(new xi([O.ONE,O.ONE_MINUS_SRC_ALPHA,O.ZERO,O.ONE],o.ao.transparent,[!0,!0,!0,!1])),z.setDepthMode(new Ut(r.func===O.LESS?O.LEQUAL:r.func,Ut.ReadOnly,r.range)),z.setStencilMode(li.disabled);const Z=3*y.primitiveLength*2,K=3*y.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const W=I||1;for(let se=0;se<W;++se)H.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",se),O.drawElements(O.LINES,Z,O.UNSIGNED_SHORT,K)}else I&&I>1?O.drawElementsInstanced(O.LINES,Z,O.UNSIGNED_SHORT,K,I):O.drawElements(O.LINES,Z,O.UNSIGNED_SHORT,K);_.bind(),z.program.set(this.program),z.setDepthMode(r),z.setStencilMode(u),z.setColorMode(p)}checkUniforms(t,r,u){if(this.fixedDefines.includes(r)){for(const p of Object.keys(u))if(!u[p].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${p} not set but required by ${r} being defined`)}}draw(t,r,u,p,_,y,b,T,M,I,P,z,O,B,N,H){const j=t.context,Z=j.gl;if(this.failedToCreate)return;j.program.set(this.program),j.setDepthMode(u),j.setStencilMode(p),j.setColorMode(_),j.setCullFace(y);for(const se of Object.keys(this.fixedUniforms))this.fixedUniforms[se].set(this.program,se,b[se]);B&&B.setUniforms(this.program,j,this.binderUniforms,z,{zoom:O});const K={[Z.POINTS]:1,[Z.LINES]:2,[Z.TRIANGLES]:3,[Z.LINE_STRIP]:1}[r];this.checkUniforms(T,"RENDER_SHADOWS",this.shadowUniforms);const W=H&&H>0?1:void 0;for(const se of P.get()){const Q=se.vaos||(se.vaos={});if((Q[T]||(Q[T]=new Dc)).bind(j,this,M,B?B.getPaintVertexBuffers():[],I,se.vertexOffset,N||[],W),this.forceManualRenderingForInstanceIDShaders){const ce=H||1;for(let ie=0;ie<ce;++ie)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ie),I?Z.drawElements(r,se.primitiveLength*K,Z.UNSIGNED_SHORT,se.primitiveOffset*K*2):Z.drawArrays(r,se.vertexOffset,se.vertexLength)}else H&&H>1?Z.drawElementsInstanced(r,se.primitiveLength*K,Z.UNSIGNED_SHORT,se.primitiveOffset*K*2,H):I?Z.drawElements(r,se.primitiveLength*K,Z.UNSIGNED_SHORT,se.primitiveOffset*K*2):Z.drawArrays(r,se.vertexOffset,se.vertexLength);r===Z.TRIANGLES&&I&&this._drawDebugWireframe(t,u,p,_,I,se,z,O,B,H)}}}function jh(c,t,r=0){const u=Math.pow(2,t.tileID.overscaledZ),p=t.tileSize*Math.pow(2,c.transform.tileZoom)/u,_=p*(t.tileID.canonical.x+t.tileID.wrap*u),y=p*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.ay(t,1,c.transform.tileZoom),u_pixel_coord_upper:[_>>16,y>>16],u_pixel_coord_lower:[65535&_,65535&y],u_pattern_transition:r}}const Vu={terrain:0,flat:1},Gh=o.bB(),Zs=(c,t,r,u,p,_,y,b,T,M,I,P,z,O,B,N,H,j)=>{const Z=t.style.light,K=Z.properties.get("position"),W=[K.x,K.y,K.z],se=o.dN();Z.properties.get("anchor")==="viewport"&&(o.dO(se,-t.transform.angle),o.dP(W,W,se));const Q=Z.properties.get("color").toPremultipliedRenderColor(null),ce=t.transform,ie={u_matrix:c,u_lightpos:W,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[Q.r,Q.g,Q.b],u_vertical_gradient:+r,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Gh,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Vu[M],u_base_type:Vu[I],u_ao:p,u_edge_radius:_,u_width_scale:y,u_flood_light_color:B,u_vertical_scale:N,u_flood_light_intensity:H,u_ground_shadow_factor:j};return ce.projection.name==="globe"&&(ie.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],ie.u_zoom_transition=P,ie.u_inv_rot_matrix=O,ie.u_merc_center=z,ie.u_up_dir=ce.projection.upVector(new o.cC(0,0,0),z[0]*o.al,z[1]*o.al),ie.u_height_lift=T),ie},Bd=(c,t,r,u,p,_)=>({u_matrix:c,u_edge_radius:t,u_width_scale:r,u_vertical_scale:u,u_height_type:Vu[p],u_base_type:Vu[_]}),Hh=(c,t,r,u,p,_,y,b,T,M,I,P,z,O,B,N,H,j)=>{const Z=Zs(c,t,r,u,p,_,y,b,M,I,P,z,O,B,N,H,1,[0,0,0]),K={u_height_factor:-Math.pow(2,b.overscaledZ)/T.tileSize/8};return Object.assign(Z,jh(t,T,j),K)},Bc=(c,t,r,u,p,_,y,b,T,M,I)=>({u_matrix:t,u_opacity:r,u_ao_pass:u?1:0,u_meter_to_tile:p,u_ao:_,u_flood_light_intensity:y,u_flood_light_color:b,u_attenuation:T,u_edge_radius:M,u_fb:0,u_fb_size:I,u_dynamic_offset:1}),kc=(c,t,r)=>({u_matrix:c,u_emissive_strength:t,u_ground_shadow_factor:r}),kd=(c,t,r,u,p,_=0)=>Object.assign(kc(c,t,p),jh(r,u,_)),Nd=(c,t,r,u)=>({u_matrix:c,u_world:r,u_emissive_strength:t,u_ground_shadow_factor:u}),Ud=(c,t,r,u,p,_,y=0)=>Object.assign(kd(c,t,r,u,_,y),{u_world:p}),X1=(c,t)=>({u_matrix:c,u_ground_shadow_factor:t}),qh=(c,t,r,u,p)=>({u_matrix:c,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:r,u_height_scale:u,u_reset_depth:p}),bl=(c,t,r,u,p,_,y,b,T)=>({u_matrix:c,u_normal_matrix:t,u_opacity:r,u_faux_facade_ao_intensity:u,u_camera_pos:p,u_tile_to_meter:_,u_facade_emissive_chance:y,u_flood_light_color:b,u_flood_light_intensity:T}),wl=c=>({u_matrix:c}),Xf=c=>({u_matrix:c}),Nc=(c,t,r,u,p,_,y,b)=>{const T=o.al/_.tileSize;return{u_matrix:c,u_inv_rot_matrix:t,u_camera_to_center_distance:r.getCameraToCenterDistance(b),u_extrude_scale:[r.pixelsToGLUnits[0]/T,r.pixelsToGLUnits[1]/T],u_zoom_transition:u,u_tile_id:y,u_merc_center:p}},Kl=(c,t,r=1)=>({u_matrix:c,u_color:t,u_overlay:0,u_overlay_scale:r}),ju=o.bB(),Zh=(c,t,r,u,p,_,y)=>{const b=c.transform,T=b.projection.name==="globe",M=T?o.dQ(b.zoom,t.canonical)*b._pixelsPerMercatorPixel:o.ay(r,1,_),I={u_matrix:t.projMatrix,u_extrude_scale:M,u_intensity:y,u_inv_rot_matrix:ju,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(T){I.u_inv_rot_matrix=u,I.u_merc_center=p,I.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],I.u_zoom_transition=o.aj(b.zoom);const P=p[0]*o.al,z=p[1]*o.al;I.u_up_dir=b.projection.upVector(new o.cC(0,0,0),P,z)}return I};function Jl(c,[t,r,u,p],[_,y]){if(_===y)return[0,0,0,0];const b=255*(c-1)/(c*(y-_));return[t*b,r*b,u*b,p*b]}function Wo(c,t,[r,u]){return r===u?0:.5/c+(t-r)*(c-1)/(c*(u-r))}const Gu=(c,t,r,u,p,_,y,b,T,M,I,P,z,O,B,N,H,j,Z,K,W)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:_,u_scale_parent:M,u_fade_t:I.mix,u_opacity:I.opacity*P.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:P.paint.get("raster-brightness-min"),u_brightness_high:P.paint.get("raster-brightness-max"),u_saturation_factor:o.dS(P.paint.get("raster-saturation")),u_contrast_factor:o.dR(P.paint.get("raster-contrast")),u_spin_weights:Xs(P.paint.get("raster-hue-rotate")),u_perspective_transform:z,u_raster_elevation:O,u_zoom_transition:y,u_merc_center:b,u_cutoff_params:T,u_colorization_mix:Jl(o.dT,N,j),u_colorization_offset:Wo(o.dT,H,j),u_color_ramp:B,u_texture_offset:[K/(Z+2*K),Z/(Z+2*K)],u_texture_res:[Z+2*K,Z+2*K],u_emissive_strength:W});function Xs(c){c*=Math.PI/180;const t=Math.sin(c),r=Math.cos(c);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const Ql=.05,Ja=(c,t,r,u,p,_,y,b,T,M,I,P)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:_,u_scale_parent:M,u_fade_t:I.mix,u_opacity:I.opacity,u_image0:0,u_image1:1,u_raster_elevation:P,u_zoom_transition:y,u_merc_center:b,u_cutoff_params:T}),Xh=(c,t,r,u,p,_,y,b,T,M)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_tile_offset:r,u_velocity:u,u_color_ramp:_,u_velocity_res:p,u_max_speed:y,u_uv_offset:b,u_data_scale:[255*T[0],255*T[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ql,Ql]}),Hu=(c,t,r,u,p,_,y,b,T,M)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_velocity:r,u_velocity_res:u,u_max_speed:p,u_speed_factor:_,u_reset_rate:y,u_rand_seed:Math.random(),u_uv_offset:b,u_data_scale:[255*T[0],255*T[1]],u_data_offset:M,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ql,Ql]}),$s=o.bB(),Ws=(c,t,r,u,p,_,y,b,T,M,I,P,z,O,B,N,H,j,Z,K,W,se,Q,ce)=>{const ie=p.transform,te={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ie.getCameraToCenterDistance(Z),u_rotate_symbol:+r,u_aspect_ratio:ie.width/ie.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:y,u_coord_matrix:b,u_is_text:+M,u_elevation_from_sea:T?1:0,u_pitch_with_map:+u,u_texsize:I,u_texsize_icon:P,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$s,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:$s,u_up_vector:[0,-1,0],u_color_adj_mat:se,u_icon_transition:Q||0,u_gamma_scale:u?p.transform.getCameraToCenterDistance(Z)*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:o.o.devicePixelRatio,u_is_halo:1,u_scale_factor:ce||1,u_ground_shadow_factor:K,u_inv_matrix:o.bk(o.bB(),y),u_normal_scale:W,u_lutTexture:ca.LUT};return Z.name==="globe"&&(te.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],te.u_zoom_transition=B,te.u_inv_rot_matrix=H,te.u_merc_center=N,te.u_camera_forward=ie._camera.forward(),te.u_ecef_origin=o.dU(ie.globeMatrix,O.toUnwrapped()),te.u_tile_matrix=Float32Array.from(ie.globeMatrix),te.u_up_vector=j),te},ec=(c,t,r,u)=>({u_matrix:c,u_emissive_strength:t,u_opacity:r,u_color:u}),qu=(c,t,r,u,p,_,y,b,T)=>Object.assign((function(M,I,P,z,O,B){const{width:N,height:H}=z.imageManager.getPixelSize(I),j=Math.pow(2,B.tileID.overscaledZ),Z=B.tileSize*Math.pow(2,z.transform.tileZoom)/j,K=Z*(B.tileID.canonical.x+B.tileID.wrap*j),W=Z*B.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[N,H],u_pattern_size:P.displaySize,u_pattern_units_to_pixels:O?[z.transform.width,-1*z.transform.height]:[1/o.ay(B,1,z.transform.tileZoom),1/o.ay(B,1,z.transform.tileZoom)],u_pixel_coord_upper:[K>>16,W>>16],u_pixel_coord_lower:[65535&K,65535&W]}})(0,_,y,u,b,T),{u_matrix:c,u_emissive_strength:t,u_opacity:r}),$h=new Float32Array(o.bz([])),tc=(c,t,r,u,p,_,y,b,T,M,I,P,z,O=[0,0,0],B,N,H)=>{const j=p.style.light,Z=j.properties.get("position"),K=[-Z.x,-Z.y,Z.z],W=o.dN();j.properties.get("anchor")==="viewport"&&(o.dO(W,-p.transform.angle),o.dP(K,K,W));const se=I.alphaMode==="MASK",Q=j.properties.get("color").toNonPremultipliedRenderColor(null),ce=z.paint.get("model-ambient-occlusion-intensity"),ie=z.paint.get("model-color").constantOr(o.ao.white).toNonPremultipliedRenderColor(null);return ie.a=z.paint.get("model-color-mix-intensity").constantOr(0),H&&(ie.r=H[0],ie.g=H[1],ie.b=H[2],ie.a=H[3]),N&&(ie.r=N.color.r,ie.g=N.color.g,ie.b=N.color.b,ie.a=N.colorMix,P=N.emissionStrength,_=N.opacity),{u_matrix:c,u_lighting_matrix:t,u_normal_matrix:r,u_node_matrix:u||$h,u_lightpos:K,u_lightintensity:j.properties.get("intensity"),u_lightcolor:[Q.r,Q.g,Q.b],u_camera_pos:O,u_opacity:_,u_baseTextureIsAlpha:0,u_alphaMask:+se,u_alphaCutoff:I.alphaCutoff,u_baseColorFactor:y.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:b.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:T,u_roughnessFactor:M,u_baseColorTexture:ca.BaseColor,u_metallicRoughnessTexture:ca.MetallicRoughness,u_normalTexture:ca.Normal,u_occlusionTexture:ca.Occlusion,u_emissionTexture:ca.Emission,u_lutTexture:ca.LUT,u_color_mix:ie.toArray01(),u_aoIntensity:ce,u_emissive_strength:P,u_occlusionTextureTransform:B||[0,0,0,0]}},Ys=(c,t=$h,r=$h)=>({u_matrix:c,u_instance:t,u_node_matrix:r}),$1={fillExtrusion:c=>({u_matrix:new o.ck(c),u_lightpos:new o.ch(c),u_lightintensity:new o.ci(c),u_lightcolor:new o.ch(c),u_vertical_gradient:new o.ci(c),u_opacity:new o.ci(c),u_edge_radius:new o.ci(c),u_width_scale:new o.ci(c),u_ao:new o.cj(c),u_height_type:new o.cg(c),u_base_type:new o.cg(c),u_tile_id:new o.ch(c),u_zoom_transition:new o.ci(c),u_inv_rot_matrix:new o.ck(c),u_merc_center:new o.cj(c),u_up_dir:new o.ch(c),u_height_lift:new o.ci(c),u_flood_light_color:new o.ch(c),u_vertical_scale:new o.ci(c),u_flood_light_intensity:new o.ci(c),u_ground_shadow_factor:new o.ch(c)}),fillExtrusionDepth:c=>({u_matrix:new o.ck(c),u_edge_radius:new o.ci(c),u_width_scale:new o.ci(c),u_vertical_scale:new o.ci(c),u_height_type:new o.cg(c),u_base_type:new o.cg(c)}),fillExtrusionPattern:c=>({u_matrix:new o.ck(c),u_lightpos:new o.ch(c),u_lightintensity:new o.ci(c),u_lightcolor:new o.ch(c),u_vertical_gradient:new o.ci(c),u_height_factor:new o.ci(c),u_edge_radius:new o.ci(c),u_width_scale:new o.ci(c),u_ao:new o.cj(c),u_height_type:new o.cg(c),u_base_type:new o.cg(c),u_tile_id:new o.ch(c),u_zoom_transition:new o.ci(c),u_inv_rot_matrix:new o.ck(c),u_merc_center:new o.cj(c),u_up_dir:new o.ch(c),u_height_lift:new o.ci(c),u_image:new o.cg(c),u_texsize:new o.cj(c),u_pixel_coord_upper:new o.cj(c),u_pixel_coord_lower:new o.cj(c),u_tile_units_to_pixels:new o.ci(c),u_opacity:new o.ci(c),u_pattern_transition:new o.ci(c)}),fillExtrusionGroundEffect:c=>({u_matrix:new o.ck(c),u_opacity:new o.ci(c),u_ao_pass:new o.ci(c),u_meter_to_tile:new o.ci(c),u_ao:new o.cj(c),u_flood_light_intensity:new o.ci(c),u_flood_light_color:new o.ch(c),u_attenuation:new o.ci(c),u_edge_radius:new o.ci(c),u_fb:new o.cg(c),u_fb_size:new o.ci(c),u_dynamic_offset:new o.ci(c)}),fill:c=>({u_matrix:new o.ck(c),u_emissive_strength:new o.ci(c),u_ground_shadow_factor:new o.ch(c)}),fillPattern:c=>({u_matrix:new o.ck(c),u_emissive_strength:new o.ci(c),u_image:new o.cg(c),u_texsize:new o.cj(c),u_pixel_coord_upper:new o.cj(c),u_pixel_coord_lower:new o.cj(c),u_tile_units_to_pixels:new o.ci(c),u_ground_shadow_factor:new o.ch(c),u_pattern_transition:new o.ci(c)}),fillOutline:c=>({u_matrix:new o.ck(c),u_emissive_strength:new o.ci(c),u_world:new o.cj(c),u_ground_shadow_factor:new o.ch(c)}),fillOutlinePattern:c=>({u_matrix:new o.ck(c),u_emissive_strength:new o.ci(c),u_world:new o.cj(c),u_image:new o.cg(c),u_texsize:new o.cj(c),u_pixel_coord_upper:new o.cj(c),u_pixel_coord_lower:new o.cj(c),u_tile_units_to_pixels:new o.ci(c),u_ground_shadow_factor:new o.ch(c),u_pattern_transition:new o.ci(c)}),building:c=>({u_matrix:new o.ck(c),u_normal_matrix:new o.ck(c),u_opacity:new o.ci(c),u_faux_facade_ao_intensity:new o.ci(c),u_camera_pos:new o.ch(c),u_tile_to_meter:new o.ci(c),u_facade_emissive_chance:new o.ci(c),u_flood_light_color:new o.ch(c),u_flood_light_intensity:new o.ci(c)}),buildingBloom:c=>({u_matrix:new o.ck(c)}),buildingDepth:c=>({u_matrix:new o.ck(c)}),elevatedStructuresDepth:c=>({u_matrix:new o.ck(c),u_depth_bias:new o.ci(c)}),elevatedStructures:c=>({u_matrix:new o.ck(c),u_ground_shadow_factor:new o.ch(c)}),elevatedStructuresDepthReconstruct:c=>({u_matrix:new o.ck(c),u_camera_pos:new o.ch(c),u_depth_bias:new o.ci(c),u_height_scale:new o.ci(c),u_reset_depth:new o.ci(c)}),circle:o.dX,collisionBox:c=>({u_matrix:new o.ck(c),u_inv_rot_matrix:new o.ck(c),u_camera_to_center_distance:new o.ci(c),u_extrude_scale:new o.cj(c),u_zoom_transition:new o.ci(c),u_merc_center:new o.cj(c),u_tile_id:new o.ch(c)}),collisionCircle:c=>({u_matrix:new o.ck(c),u_inv_matrix:new o.ck(c),u_camera_to_center_distance:new o.ci(c),u_viewport_size:new o.cj(c)}),debug:c=>({u_color:new o.dA(c),u_matrix:new o.ck(c),u_overlay:new o.cg(c),u_overlay_scale:new o.ci(c)}),clippingMask:c=>({u_matrix:new o.ck(c)}),heatmap:c=>({u_extrude_scale:new o.ci(c),u_intensity:new o.ci(c),u_matrix:new o.ck(c),u_inv_rot_matrix:new o.ck(c),u_merc_center:new o.cj(c),u_tile_id:new o.ch(c),u_zoom_transition:new o.ci(c),u_up_dir:new o.ch(c)}),heatmapTexture:c=>({u_image:new o.cg(c),u_color_ramp:new o.cg(c),u_opacity:new o.ci(c)}),hillshade:c=>({u_matrix:new o.ck(c),u_image:new o.cg(c),u_latrange:new o.cj(c),u_light:new o.cj(c),u_shadow:new o.dA(c),u_highlight:new o.dA(c),u_emissive_strength:new o.ci(c),u_accent:new o.dA(c)}),hillshadePrepare:c=>({u_matrix:new o.ck(c),u_image:new o.cg(c),u_dimension:new o.cj(c),u_zoom:new o.ci(c)}),line:o.dW,linePattern:o.dV,raster:c=>({u_matrix:new o.ck(c),u_normalize_matrix:new o.ck(c),u_globe_matrix:new o.ck(c),u_merc_matrix:new o.ck(c),u_grid_matrix:new o.dB(c),u_tl_parent:new o.cj(c),u_scale_parent:new o.ci(c),u_fade_t:new o.ci(c),u_opacity:new o.ci(c),u_image0:new o.cg(c),u_image1:new o.cg(c),u_brightness_low:new o.ci(c),u_brightness_high:new o.ci(c),u_saturation_factor:new o.ci(c),u_contrast_factor:new o.ci(c),u_spin_weights:new o.ch(c),u_perspective_transform:new o.cj(c),u_raster_elevation:new o.ci(c),u_zoom_transition:new o.ci(c),u_merc_center:new o.cj(c),u_cutoff_params:new o.d2(c),u_colorization_mix:new o.d2(c),u_colorization_offset:new o.ci(c),u_color_ramp:new o.cg(c),u_texture_offset:new o.cj(c),u_texture_res:new o.cj(c),u_emissive_strength:new o.ci(c)}),rasterParticle:c=>({u_matrix:new o.ck(c),u_normalize_matrix:new o.ck(c),u_globe_matrix:new o.ck(c),u_merc_matrix:new o.ck(c),u_grid_matrix:new o.dB(c),u_tl_parent:new o.cj(c),u_scale_parent:new o.ci(c),u_fade_t:new o.ci(c),u_opacity:new o.ci(c),u_image0:new o.cg(c),u_image1:new o.cg(c),u_raster_elevation:new o.ci(c),u_zoom_transition:new o.ci(c),u_merc_center:new o.cj(c),u_cutoff_params:new o.d2(c)}),rasterParticleTexture:c=>({u_texture:new o.cg(c),u_opacity:new o.ci(c)}),rasterParticleDraw:c=>({u_particle_texture:new o.cg(c),u_particle_texture_side_len:new o.ci(c),u_tile_offset:new o.cj(c),u_velocity:new o.cg(c),u_color_ramp:new o.cg(c),u_velocity_res:new o.cj(c),u_max_speed:new o.ci(c),u_uv_offset:new o.cj(c),u_data_scale:new o.cj(c),u_data_offset:new o.ci(c),u_particle_pos_scale:new o.ci(c),u_particle_pos_offset:new o.cj(c)}),rasterParticleUpdate:c=>({u_particle_texture:new o.cg(c),u_particle_texture_side_len:new o.ci(c),u_velocity:new o.cg(c),u_velocity_res:new o.cj(c),u_max_speed:new o.ci(c),u_speed_factor:new o.ci(c),u_reset_rate:new o.ci(c),u_rand_seed:new o.ci(c),u_uv_offset:new o.cj(c),u_data_scale:new o.cj(c),u_data_offset:new o.ci(c),u_particle_pos_scale:new o.ci(c),u_particle_pos_offset:new o.cj(c)}),symbol:c=>({u_is_size_zoom_constant:new o.cg(c),u_is_size_feature_constant:new o.cg(c),u_size_t:new o.ci(c),u_size:new o.ci(c),u_camera_to_center_distance:new o.ci(c),u_rotate_symbol:new o.cg(c),u_aspect_ratio:new o.ci(c),u_fade_change:new o.ci(c),u_matrix:new o.ck(c),u_label_plane_matrix:new o.ck(c),u_coord_matrix:new o.ck(c),u_is_text:new o.cg(c),u_elevation_from_sea:new o.cg(c),u_pitch_with_map:new o.cg(c),u_texsize:new o.cj(c),u_texsize_icon:new o.cj(c),u_texture:new o.cg(c),u_texture_icon:new o.cg(c),u_gamma_scale:new o.ci(c),u_device_pixel_ratio:new o.ci(c),u_tile_id:new o.ch(c),u_zoom_transition:new o.ci(c),u_inv_rot_matrix:new o.ck(c),u_merc_center:new o.cj(c),u_camera_forward:new o.ch(c),u_tile_matrix:new o.ck(c),u_up_vector:new o.ch(c),u_ecef_origin:new o.ch(c),u_is_halo:new o.cg(c),u_icon_transition:new o.ci(c),u_color_adj_mat:new o.ck(c),u_scale_factor:new o.ci(c),u_ground_shadow_factor:new o.ch(c),u_inv_matrix:new o.ck(c),u_normal_scale:new o.ci(c),u_lutTexture:new o.cg(c)}),background:c=>({u_matrix:new o.ck(c),u_emissive_strength:new o.ci(c),u_opacity:new o.ci(c),u_color:new o.dA(c)}),backgroundPattern:c=>({u_matrix:new o.ck(c),u_emissive_strength:new o.ci(c),u_opacity:new o.ci(c),u_image:new o.cg(c),u_pattern_tl:new o.cj(c),u_pattern_br:new o.cj(c),u_texsize:new o.cj(c),u_pattern_size:new o.cj(c),u_pixel_coord_upper:new o.cj(c),u_pixel_coord_lower:new o.cj(c),u_pattern_units_to_pixels:new o.cj(c)}),terrainRaster:c=>({u_matrix:new o.ck(c),u_image0:new o.cg(c),u_skirt_height:new o.ci(c),u_ground_shadow_factor:new o.ch(c)}),skybox:c=>({u_matrix:new o.ck(c),u_sun_direction:new o.ch(c),u_cubemap:new o.cg(c),u_opacity:new o.ci(c),u_temporal_offset:new o.ci(c)}),skyboxGradient:c=>({u_matrix:new o.ck(c),u_color_ramp:new o.cg(c),u_center_direction:new o.ch(c),u_radius:new o.ci(c),u_opacity:new o.ci(c),u_temporal_offset:new o.ci(c)}),skyboxCapture:c=>({u_matrix_3f:new o.dB(c),u_sun_direction:new o.ch(c),u_sun_intensity:new o.ci(c),u_color_tint_r:new o.d2(c),u_color_tint_m:new o.d2(c),u_luminance:new o.ci(c)}),globeRaster:c=>({u_proj_matrix:new o.ck(c),u_globe_matrix:new o.ck(c),u_normalize_matrix:new o.ck(c),u_merc_matrix:new o.ck(c),u_zoom_transition:new o.ci(c),u_merc_center:new o.cj(c),u_image0:new o.cg(c),u_grid_matrix:new o.dB(c),u_skirt_height:new o.ci(c),u_far_z_cutoff:new o.ci(c),u_frustum_tl:new o.ch(c),u_frustum_tr:new o.ch(c),u_frustum_br:new o.ch(c),u_frustum_bl:new o.ch(c),u_globe_pos:new o.ch(c),u_globe_radius:new o.ci(c),u_viewport:new o.cj(c)}),globeAtmosphere:c=>({u_frustum_tl:new o.ch(c),u_frustum_tr:new o.ch(c),u_frustum_br:new o.ch(c),u_frustum_bl:new o.ch(c),u_horizon:new o.ci(c),u_transition:new o.ci(c),u_fadeout_range:new o.ci(c),u_atmosphere_fog_color:new o.d2(c),u_high_color:new o.d2(c),u_space_color:new o.d2(c),u_temporal_offset:new o.ci(c),u_horizon_angle:new o.ci(c)}),model:c=>({u_matrix:new o.ck(c),u_lighting_matrix:new o.ck(c),u_normal_matrix:new o.ck(c),u_node_matrix:new o.ck(c),u_lightpos:new o.ch(c),u_lightintensity:new o.ci(c),u_lightcolor:new o.ch(c),u_camera_pos:new o.ch(c),u_opacity:new o.ci(c),u_baseColorFactor:new o.d2(c),u_emissiveFactor:new o.d2(c),u_metallicFactor:new o.ci(c),u_roughnessFactor:new o.ci(c),u_baseTextureIsAlpha:new o.cg(c),u_alphaMask:new o.cg(c),u_alphaCutoff:new o.ci(c),u_baseColorTexture:new o.cg(c),u_metallicRoughnessTexture:new o.cg(c),u_normalTexture:new o.cg(c),u_occlusionTexture:new o.cg(c),u_emissionTexture:new o.cg(c),u_lutTexture:new o.cg(c),u_color_mix:new o.d2(c),u_aoIntensity:new o.ci(c),u_emissive_strength:new o.ci(c),u_occlusionTextureTransform:new o.d2(c)}),modelDepth:c=>({u_matrix:new o.ck(c),u_instance:new o.ck(c),u_node_matrix:new o.ck(c)}),groundShadow:c=>({u_matrix:new o.ck(c),u_ground_shadow_factor:new o.ch(c)}),stars:c=>({u_matrix:new o.ck(c),u_up:new o.ch(c),u_right:new o.ch(c),u_intensity_multiplier:new o.ci(c)}),snowParticle:c=>({u_modelview:new o.ck(c),u_projection:new o.ck(c),u_time:new o.ci(c),u_cam_pos:new o.ch(c),u_velocityConeAperture:new o.ci(c),u_velocity:new o.ci(c),u_horizontalOscillationRadius:new o.ci(c),u_horizontalOscillationRate:new o.ci(c),u_boxSize:new o.ci(c),u_billboardSize:new o.ci(c),u_simpleShapeParameters:new o.cj(c),u_screenSize:new o.cj(c),u_thinningCenterPos:new o.cj(c),u_thinningShape:new o.ch(c),u_thinningAffectedRatio:new o.ci(c),u_thinningParticleOffset:new o.ci(c),u_particleColor:new o.d2(c),u_direction:new o.ch(c)}),rainParticle:c=>({u_modelview:new o.ck(c),u_projection:new o.ck(c),u_time:new o.ci(c),u_cam_pos:new o.ch(c),u_texScreen:new o.cg(c),u_velocityConeAperture:new o.ci(c),u_velocity:new o.ci(c),u_boxSize:new o.ci(c),u_rainDropletSize:new o.cj(c),u_distortionStrength:new o.ci(c),u_rainDirection:new o.ch(c),u_color:new o.d2(c),u_screenSize:new o.cj(c),u_thinningCenterPos:new o.cj(c),u_thinningShape:new o.ch(c),u_thinningAffectedRatio:new o.ci(c),u_thinningParticleOffset:new o.ci(c),u_shapeDirectionalPower:new o.ci(c),u_shapeNormalPower:new o.ci(c),u_mode:new o.ci(c)}),vignette:c=>({u_vignetteShape:new o.ch(c),u_vignetteColor:new o.d2(c)}),occlusion:c=>({u_matrix:new o.ck(c),u_anchorPos:new o.ch(c),u_screenSizePx:new o.cj(c),u_occluderSizePx:new o.cj(c),u_color:new o.d2(c)})};class Tl{constructor(t,r,u,p){this.id=Tl.uniqueIdxCounter,Tl.uniqueIdxCounter++,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||p||r.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Tl.uniqueIdxCounter,Tl.uniqueIdxCounter++;const r=this.context.gl;this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Tl.uniqueIdxCounter=0;const Uc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Vd{constructor(t,r,u,p,_,y){this.length=r.length,this.attributes=u,this.itemSize=r.bytesPerElement,this.dynamicDraw=p,this.instanceCount=y,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),t.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||_||r.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let u=0;u<this.attributes.length;u++){const p=r.getAttributeLocation(t,this.attributes[u].name);p!==-1&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,r,u){for(let p=0;p<this.attributes.length;p++){const _=this.attributes[p],y=r.getAttributeLocation(t,_.name);y!==-1&&t.vertexAttribPointer(y,_.components,t[Uc[_.type]],!1,this.itemSize,_.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(t,r,u){for(let p=0;p<this.attributes.length;p++){const _=r.getAttributeLocation(t,this.attributes[p].name);_!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(_,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Wh{constructor(t,r,u,p,_){this.context=t,this.width=r,this.height=u;const y=this.framebuffer=t.gl.createFramebuffer();p&&(this.colorAttachment=new Xl(t,y)),_&&(this.depthAttachmentType=_,this.depthAttachment=_==="renderbuffer"?new Hs(t,y):new qf(t,y))}destroy(){const t=this.context.gl;if(this.colorAttachment){const r=this.colorAttachment.get();r&&t.deleteTexture(r)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r)}else{const r=this.depthAttachment.get();r&&t.deleteTexture(r)}t.deleteFramebuffer(this.framebuffer)}}class Zu{constructor(t,r){this.gl=t,this.clearColor=new Hf(this),this.clearDepth=new fo(this),this.clearStencil=new Bu(this),this.colorMask=new ku(this),this.depthMask=new Dd(this),this.stencilMask=new Ph(this),this.stencilFunc=new Io(this),this.stencilOp=new Zo(this),this.stencilTest=new us(this),this.depthRange=new js(this),this.depthTest=new hs(this),this.depthFunc=new ds(this),this.blend=new Lh(this),this.blendFunc=new Oh(this),this.blendColor=new gl(this),this.blendEquation=new Lc(this),this.cullFace=new na(this),this.cullFaceSide=new gr(this),this.frontFace=new Gn(this),this.program=new Gs(this),this.activeTexture=new Co(this),this.viewport=new Zl(this),this.bindFramebuffer=new fs(this),this.bindRenderbuffer=new Fh(this),this.bindTexture=new Pd(this),this.bindVertexBuffer=new yl(this),this.bindElementBuffer=new ps(this),this.bindVertexArrayOES=new Ld(this),this.pixelStoreUnpack=new Nu(this),this.pixelStoreUnpackPremultiplyAlpha=new Od(this),this.pixelStoreUnpackFlipY=new Xo(this),this.options=r?Object.assign({},r):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=r&&!!r.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r,u){return new Tl(this,t,r,u)}createVertexBuffer(t,r,u,p,_){return new Vd(this,t,r,u,p,_)}createRenderbuffer(t,r,u){const p=this.gl,_=p.createRenderbuffer();return this.bindRenderbuffer.set(_),p.renderbufferStorage(p.RENDERBUFFER,t,r,u),this.bindRenderbuffer.set(null),_}createFramebuffer(t,r,u,p){return new Wh(this,t,r,u,p)}clear({color:t,depth:r,stencil:u,colorMask:p}){const _=this.gl;let y=0;t&&(y|=_.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(p||[!0,!0,!0,!0])),r!==void 0&&(y|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),u!==void 0&&(y|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),_.clear(y)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.bx(t.blendFunction,xi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Yo;function La(c,t,r,u,p,_,y){const b=c.context,T=b.gl,M=c.transform,I=[o.aF(M.center.lng),o.aJ(M.center.lat)],P=r.layout.get("symbol-placement"),z=r.layout.get("text-variable-anchor"),O=r.layout.get("icon-rotation-alignment")==="map",B=r.layout.get("text-rotation-alignment")==="map",N=P!=="point",H=[];let j=0,Z=0;for(let te=0;te<u.length;te++){const ue=u[te],we=t.getTile(ue),ve=we.getBucket(r);if(!ve)continue;const Oe=ve.getProjection().createInversionMatrix(M,ue.canonical),ze=[],je=Mu(ue,ve,M),lt=!y&&O&&N,Me=y&&B&&N,ge=z&&ve.hasTextData(),Ge=ve.hasIconTextFit()&&ge&&ve.hasIconData(),Re=lt||Me||y&&ge||Ge,it=ve.projection.name==="globe",Je=it?o.aj(M.zoom):0;it&&(ze.push("PROJECTION_GLOBE_VIEW"),Re&&ze.push("PROJECTED_POS_ON_VIEWPORT"));const vt=c.getOrCreateProgram("collisionBox",{defines:ze});let Ze=je;p[0]===0&&p[1]===0||(Ze=c.translatePosMatrix(je,we,p,_));const $e=y?ve.textCollisionBox:ve.iconCollisionBox,xt=ve.collisionCircleArray;if(xt.length>0){const St=o.bB(),Rt=Ze;o.cO(St,ve.placementInvProjMatrix,M.glCoordMatrix),o.cO(St,St,ve.placementViewportMatrix),H.push({circleArray:xt,circleOffset:Z,transform:Rt,invTransform:St,projection:ve.getProjection()}),j+=xt.length/4,Z=j}if(!$e)continue;c.terrain&&c.terrain.setupElevationDraw(we,vt);const Mt=it?[ue.canonical.x,ue.canonical.y,1<<ue.canonical.z]:[0,0,0];vt.draw(c,T.LINES,Ut.disabled,li.disabled,c.colorModeForRenderPass(),ii.disabled,Nc(Ze,Oe,M,Je,I,we,Mt,ve.getProjection()),r.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,null,M.zoom,null,[$e.collisionVertexBuffer,$e.collisionVertexBufferExt])}if(!y||!H.length)return;const K=c.getOrCreateProgram("collisionCircle"),W=new o.dY;W.resize(4*j),W._trim();let se=0;for(const te of H)for(let ue=0;ue<te.circleArray.length/4;ue++){const we=4*ue,ve=te.circleArray[we+0],Oe=te.circleArray[we+1],ze=te.circleArray[we+2],je=te.circleArray[we+3];W.emplace(se++,ve,Oe,ze,je,0),W.emplace(se++,ve,Oe,ze,je,1),W.emplace(se++,ve,Oe,ze,je,2),W.emplace(se++,ve,Oe,ze,je,3)}(!Yo||Yo.length<2*j)&&(Yo=(function(te){const ue=2*te,we=new o.b0;we.resize(ue),we._trim();for(let ve=0;ve<ue;ve++){const Oe=6*ve;we.uint16[Oe+0]=4*ve+0,we.uint16[Oe+1]=4*ve+1,we.uint16[Oe+2]=4*ve+2,we.uint16[Oe+3]=4*ve+2,we.uint16[Oe+4]=4*ve+3,we.uint16[Oe+5]=4*ve+0}return we})(j));const Q=b.createIndexBuffer(Yo,!0),ce=b.createVertexBuffer(W,o.dZ.members,!0);for(const te of H){const ue={u_matrix:te.transform,u_inv_matrix:te.invTransform,u_camera_to_center_distance:(ie=M).getCameraToCenterDistance(te.projection),u_viewport_size:[ie.width,ie.height]};K.draw(c,T.TRIANGLES,Ut.disabled,li.disabled,c.colorModeForRenderPass(),ii.disabled,ue,r.id,ce,Q,o.bf.simpleSegment(0,2*te.circleOffset,te.circleArray.length,te.circleArray.length/2),null,M.zoom)}var ie;ce.destroy(),Q.destroy()}const ga=o.bB();function Ks(c){const t=c._camera.getWorldToCamera(c.worldSize,1),r=o.aB([],t,c.globeMatrix);o.bk(r,r);const u=[0,0,0],p=[0,1,0,0];return o.aC(p,p,r),u[0]=p[0],u[1]=p[1],u[2]=p[2],o.aw(u,u),u}function Xu({width:c,height:t,anchor:r,textOffset:u,textScale:p},_){const{horizontalAlign:y,verticalAlign:b}=o.c0(r),T=-(y-.5)*c,M=-(b-.5)*t,I=o.c1(r,u);return new o.P((T/p+I[0])*_,(M/p+I[1])*_)}function Yh(c,t,r,u,p,_,y,b,T,M){const I=c.text.placedSymbolArray,P=c.text.dynamicLayoutVertexArray,z=c.icon.dynamicLayoutVertexArray,O={},B=c.getProjection(),N=Td(y,B,p),H=p.elevation,j=B.upVectorScale(y.canonical,p.center.lat,p.worldSize).metersToTile;P.clear();for(let Z=0;Z<I.length;Z++){const K=I.get(Z),{tileAnchorX:W,tileAnchorY:se,numGlyphs:Q}=K,ce=K.hidden||!K.crossTileID||c.allowVerticalPlacement&&!K.placedOrientation?null:u[K.crossTileID];if(ce){let ie=0,te=0,ue=0;const we=c.elevationType==="road";if(H||we){const Re=we?c.getElevationFeatureForText(Z):null,it=o.bU.getAtTileOffset(y,new o.P(W,se),H,Re),[Je,vt,Ze]=B.upVector(y.canonical,W,se);ie=it*Je*j,te=it*vt*j,ue=it*Ze*j}let[ve,Oe,ze,je]=Ur(K.projectedAnchorX+ie,K.projectedAnchorY+te,K.projectedAnchorZ+ue,r?N:_);const lt=Th(p.getCameraToCenterDistance(B),je);let Me=o.bL(c.textSizeData,T,K)*lt/o.bX;r&&(Me*=c.tilePixelRatio/b);const ge=Xu(ce,Me);r?({x:ve,y:Oe,z:ze}=B.projectTilePoint(W+ge.x,se+ge.y,y.canonical),[ve,Oe,ze]=Ur(ve+ie,Oe+te,ze+ue,_)):(t&&ge._rotate(-p.angle),ve+=ge.x,Oe+=ge.y,ze=0);const Ge=c.allowVerticalPlacement&&K.placedOrientation===o.bK.vertical?Math.PI/2:0;for(let Re=0;Re<Q;Re++)o.bN(P,ve,Oe,ze,Ge);M&&K.associatedIconIndex>=0&&(O[K.associatedIconIndex]={x:ve,y:Oe,z:ze,angle:Ge})}else dl(Q,P)}if(M){z.clear();const Z=c.icon.placedSymbolArray;for(let K=0;K<Z.length;K++){const W=Z.get(K),{numGlyphs:se}=W,Q=O[K];if(W.hidden||!Q)dl(se,z);else{const{x:ce,y:ie,z:te,angle:ue}=Q;for(let we=0;we<se;we++)o.bN(z,ce,ie,te,ue)}}c.icon.dynamicLayoutVertexBuffer.updateData(z)}c.text.dynamicLayoutVertexBuffer.updateData(P)}function Ko(c,t,r,u,p,_,y={}){const b=r.paint.get("icon-translate"),T=r.paint.get("text-translate"),M=r.paint.get("icon-translate-anchor"),I=r.paint.get("text-translate-anchor"),P=r.layout.get("icon-rotation-alignment"),z=r.layout.get("text-rotation-alignment"),O=r.layout.get("icon-pitch-alignment"),B=r.layout.get("text-pitch-alignment"),N=r.layout.get("icon-keep-upright"),H=r.layout.get("text-keep-upright"),j=r.paint.get("icon-color-saturation"),Z=r.paint.get("icon-color-contrast"),K=r.paint.get("icon-color-brightness-min"),W=r.paint.get("icon-color-brightness-max"),se=r.layout.get("symbol-elevation-reference")==="sea",Q=r.layout.get("icon-image-use-theme")==="none",ce=c.context,ie=ce.gl,te=c.transform,ue=P==="map",we=z==="map",ve=O==="map",Oe=B==="map",ze=r.layout.get("symbol-sort-key").constantOr(1)!==void 0;let je=!1;const lt=c.depthModeForSublayer(0,Ut.ReadOnly),Me=new Ut(c.context.gl.LEQUAL,Ut.ReadOnly,c.depthRangeFor3D),ge=[o.aF(te.center.lng),o.aJ(te.center.lat)],Ge=r.layout.get("text-variable-anchor"),Re=te.projection.name==="globe",it=[],Je=[0,-1,0];for(const vt of u){const Ze=t.getTile(vt),$e=Ze.getBucket(r);if(!$e||$e.projection.name==="mercator"&&Re||$e.fullyClipped)continue;const xt=$e.projection.name==="globe",Mt=xt?o.aj(te.zoom):0,St=Td(vt,$e.getProjection(),te),Rt=te.calculatePixelsToTileUnitsMatrix(Ze),Kt=Ge&&$e.hasTextData(),Ti=$e.hasIconTextFit()&&Kt&&$e.hasIconData(),fi=$e.getProjection().createInversionMatrix(te,vt.canonical),Qi=(1<<Ze.tileID.canonical.z)*o.al/c.transform.worldSize,Qt=Vi=>{let $t=[0,0,0];if(Vi){const Ri=c.style.directionalLight,Dn=c.style.ambientLight;Ri&&Dn&&($t=Pa(c.style,Ri,Dn))}return $t},Ni=Vi=>{te.depthOcclusionForSymbolsAndCircles&&(r.hasOcclusionOpacityProperties||c.terrain)&&(Vi.push("DEPTH_D24"),Vi.push("DEPTH_OCCLUSION"))},oi=Vi=>{r.lut&&!Q&&(r.lut.texture||(r.lut.texture=new o.d_(c.context,r.lut.image,[r.lut.image.height,r.lut.image.height,r.lut.image.height],ce.gl.RGBA8)),ce.activeTexture.set(ce.gl.TEXTURE0+ca.LUT),r.lut.texture&&r.lut.texture.bind(ce.gl.LINEAR,ce.gl.CLAMP_TO_EDGE),Vi.push("APPLY_LUT_ON_GPU"))},en=()=>{const Vi=ue&&r.layout.get("symbol-placement")!=="point",$t=[];Ni($t),oi($t);const Ri=Vi||Ti,Dn=$e.elevationType==="road",kn=c.shadowRenderer,Wn=Dn&&ve&&!!kn&&kn.enabled,rr=Qt(Wn),qa=Dn&&ve&&!c.terrain?Me:lt,da=r.paint.get("icon-image-cross-fade");c.terrainRenderModeElevated()&&ve&&$t.push("PITCH_WITH_MAP_TERRAIN"),xt&&($t.push("PROJECTION_GLOBE_VIEW"),Ri&&$t.push("PROJECTED_POS_ON_VIEWPORT")),da>0&&$e.hasAnySecondaryIcon&&$t.push("ICON_TRANSITION"),!$e.icon.zOffsetVertexBuffer||Dn&&c.terrain||$t.push("Z_OFFSET"),j===0&&Z===0&&K===0&&W===1||$t.push("COLOR_ADJUSTMENT"),$e.sdfIcons&&$t.push("RENDER_SDF"),Wn&&$t.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Dn&&ve&&!c.terrain&&$e.icon.orientationVertexBuffer&&$t.push("ELEVATED_ROADS");const ra=$e.icon.programConfigurations.get(r.id),vr=c.getOrCreateProgram("symbol",{config:ra,defines:$t}),go=Ze.imageAtlasTexture?Ze.imageAtlasTexture.size:[0,0],ur=$e.iconSizeData,yo=o.bJ(ur,te.zoom),Oo=ve||!te.isOrthographic,aa=vc(St,Ze.tileID.canonical,ve,ue,te,$e.getProjection(),Rt),Pn=hl(St,Ze.tileID.canonical,ve,ue,te,$e.getProjection(),Rt),hr=c.translatePosMatrix(Pn,Ze,b,M,!0),wn=c.translatePosMatrix(St,Ze,b,M),ar=Ri?ga:aa,Jr=ue&&!ve&&!Vi;let or=Je;!Re&&!te.mercatorFromTransition||ue||(or=Ks(te));const vo=xt?or:Je,iu=r.getColorAdjustmentMatrix(j,Z,K,W),es=Ws(ur.kind,yo,Jr,ve,c,wn,ar,hr,se,!1,go,[0,0],0,vt,Mt,ge,fi,vo,$e.getProjection(),rr,Qi,iu,da,null),dc=Ze.imageAtlasTexture?Ze.imageAtlasTexture:null,lh=r.layout.get("icon-size").constantOr(0)!==1||$e.iconsNeedLinear,Fo=$e.sdfIcons||c.options.rotating||c.options.zooming||lh||Oo?ie.LINEAR:ie.NEAREST,nl=$e.sdfIcons&&r.paint.get("icon-halo-width").constantOr(1)!==0,Gr=c.terrain&&ve&&Vi?o.bk(o.bB(),aa):ga;if(Vi&&$e.icon){const xo=o.bU.getAtTileOffsetFunc(vt,te.center.lat,te.worldSize,$e.getProjection()),ts=wh(St,Ze.tileID.canonical,ve,ue,te,$e.getProjection(),Rt),hd=r.layout.get("icon-size-scale-range"),dd=o.aA(c.scaleFactor,hd[0],hd[1]);kf($e,St,c,!1,ts,Pn,ve,N,xo,vt,dd)}return{program:vr,buffers:$e.icon,uniformValues:es,atlasTexture:dc,atlasTextureIcon:null,atlasInterpolation:Fo,atlasInterpolationIcon:null,isSDF:$e.sdfIcons,hasHalo:nl,depthMode:qa,tile:Ze,renderWithShadows:Wn,labelPlaneMatrixInv:Gr}},Fi=()=>{const Vi=we&&r.layout.get("symbol-placement")!=="point",$t=[],Ri=Vi||Ge||Ti,Dn=$e.elevationType==="road",kn=c.shadowRenderer,Wn=Dn&&Oe&&!!kn&&kn.enabled,rr=Qt(Wn),qa=Dn&&Oe&&!c.terrain?Me:lt;c.terrainRenderModeElevated()&&Oe&&$t.push("PITCH_WITH_MAP_TERRAIN"),xt&&($t.push("PROJECTION_GLOBE_VIEW"),Ri&&$t.push("PROJECTED_POS_ON_VIEWPORT")),!$e.text.zOffsetVertexBuffer||Dn&&c.terrain||$t.push("Z_OFFSET"),$e.iconsInText&&$t.push("RENDER_TEXT_AND_SYMBOL"),$t.push("RENDER_SDF"),Wn&&$t.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Dn&&Oe&&!c.terrain&&$e.text.orientationVertexBuffer&&$t.push("ELEVATED_ROADS"),Ni($t);const da=$e.text.programConfigurations.get(r.id),ra=c.getOrCreateProgram("symbol",{config:da,defines:$t});let vr,go=[0,0],ur=null;const yo=$e.textSizeData;$e.iconsInText&&(go=Ze.imageAtlasTexture?Ze.imageAtlasTexture.size:[0,0],ur=Ze.imageAtlasTexture?Ze.imageAtlasTexture:null,vr=Oe||!te.isOrthographic||c.options.rotating||c.options.zooming||yo.kind==="composite"||yo.kind==="camera"?ie.LINEAR:ie.NEAREST);const Oo=Ze.glyphAtlasTexture?Ze.glyphAtlasTexture.size:[0,0],aa=r.layout.get("text-size-scale-range"),Pn=o.aA(c.scaleFactor,aa[0],aa[1]),hr=o.bJ(yo,te.zoom,Pn),wn=vc(St,Ze.tileID.canonical,Oe,we,te,$e.getProjection(),Rt),ar=hl(St,Ze.tileID.canonical,Oe,we,te,$e.getProjection(),Rt),Jr=c.translatePosMatrix(ar,Ze,T,I,!0),or=c.translatePosMatrix(St,Ze,T,I),vo=Ri?ga:wn,iu=we&&!Oe&&!Vi;let es=Je;!Re&&!te.mercatorFromTransition||we||(es=Ks(te));const dc=Ws(yo.kind,hr,iu,Oe,c,or,vo,Jr,se,!0,Oo,go,0,vt,Mt,ge,fi,xt?es:Je,$e.getProjection(),rr,Qi,null,null,Pn),lh=Ze.glyphAtlasTexture?Ze.glyphAtlasTexture:null,Fo=ie.LINEAR,nl=r.paint.get("text-halo-width").constantOr(1)!==0,Gr=c.terrain&&Oe&&Vi?o.bk(o.bB(),wn):ga;if(Vi&&$e.text){const xo=o.bU.getAtTileOffsetFunc(vt,te.center.lat,te.worldSize,$e.getProjection()),ts=wh(St,Ze.tileID.canonical,Oe,we,te,$e.getProjection(),Rt);kf($e,St,c,!0,ts,ar,Oe,H,xo,vt,Pn)}return{program:ra,buffers:$e.text,uniformValues:dc,atlasTexture:lh,atlasTextureIcon:ur,atlasInterpolation:Fo,atlasInterpolationIcon:vr,isSDF:!0,hasHalo:nl,depthMode:qa,tile:Ze,renderWithShadows:Wn,labelPlaneMatrixInv:Gr}},Zi=$e.icon.segments.get().length,Xi=$e.text.segments.get().length,yi=Zi&&!y.onlyText?en():null,an=Xi&&!y.onlyIcons?Fi():null,Si=r.paint.get("icon-opacity").constantOr(1),Mn=r.paint.get("text-opacity").constantOr(1);if(ze&&$e.canOverlap){je=!0;const Vi=Si&&!y.onlyText?$e.icon.segments.get():[],$t=Mn&&!y.onlyIcons?$e.text.segments.get():[];for(const Ri of Vi)it.push({segments:new o.bf([Ri]),sortKey:Ri.sortKey,state:yi});for(const Ri of $t)it.push({segments:new o.bf([Ri]),sortKey:Ri.sortKey,state:an})}else y.onlyText||it.push({segments:Si?$e.icon.segments:new o.bf([]),sortKey:0,state:yi}),y.onlyIcons||it.push({segments:Mn?$e.text.segments:new o.bf([]),sortKey:0,state:an})}je&&it.sort(((vt,Ze)=>vt.sortKey-Ze.sortKey));for(const vt of it){const Ze=vt.state;if(Ze)if(c.terrain?c.terrain.setupElevationDraw(Ze.tile,Ze.program,{useDepthForOcclusion:te.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ze.labelPlaneMatrixInv}):c.setupDepthForOcclusion(te.depthOcclusionForSymbolsAndCircles,Ze.program),ce.activeTexture.set(ie.TEXTURE0),Ze.atlasTexture&&Ze.atlasTexture.bind(Ze.atlasInterpolation,ie.CLAMP_TO_EDGE,!0),Ze.atlasTextureIcon&&(ce.activeTexture.set(ie.TEXTURE1),Ze.atlasTextureIcon&&Ze.atlasTextureIcon.bind(Ze.atlasInterpolationIcon,ie.CLAMP_TO_EDGE,!0)),Ze.renderWithShadows&&c.shadowRenderer.setupShadows(Ze.tile.tileID.toUnwrapped(),Ze.program,"vector-tile"),c.uploadCommonLightUniforms(c.context,Ze.program),Ze.hasHalo){const $e=Ze.uniformValues;$e.u_is_halo=1,ja(Ze.buffers,vt.segments,r,c,Ze.program,Ze.depthMode,p,_,$e,2),$e.u_is_halo=0}else{if(Ze.isSDF){const $e=Ze.uniformValues;Ze.hasHalo&&($e.u_is_halo=1,ja(Ze.buffers,vt.segments,r,c,Ze.program,Ze.depthMode,p,_,$e,1)),$e.u_is_halo=0}ja(Ze.buffers,vt.segments,r,c,Ze.program,Ze.depthMode,p,_,Ze.uniformValues,1)}}}function ja(c,t,r,u,p,_,y,b,T,M){const I=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.iconTransitioningVertexBuffer,c.globeExtVertexBuffer,c.zOffsetVertexBuffer,c.orientationVertexBuffer];p.draw(u,u.context.gl.TRIANGLES,_,y,b,ii.disabled,T,r.id,c.layoutVertexBuffer,c.indexBuffer,t,r.paint,u.transform.zoom,c.programConfigurations.get(r.id),I,M)}function Yr(c,t){const r=1<<c.canonical.z,u=(t.x*r-c.canonical.x-c.wrap*r)*o.al,p=(t.y*r-c.canonical.y)*o.al,_=o.e7(t.z,t.y);return o.d4(u,p,_)}function Js(c,t,r,u,p){if(!r.layout||r.layout.get("fill-elevation-reference")==="none"||r.paint.get("fill-opacity").constantOr(1)===0)return;const _=c.context.gl,y=new Ut(c.context.gl.LEQUAL,Ut.ReadWrite,c.depthRangeFor3D),b=new Ut(c.context.gl.GREATER,Ut.ReadWrite,c.depthRangeFor3D),T=(function(O){let B=.01;return O.isOrthographic&&(B=o.ak(1e-4,B,o.c$(O.pitch>=Sc?1:O.pitch/Sc))),2*B})(c.transform),M=c.transform.getFreeCameraOptions().position,I="elevatedStructuresDepthReconstruct",P=c.getOrCreateProgram(I,{defines:["DEPTH_RECONSTRUCTION"]}),z=c.getOrCreateProgram(I);for(const O of u){const B=t.getTile(O),N=B.getBucket(r);if(!N)continue;const H=N.elevatedStructures;if(!H)continue;const j=N.elevationBufferData.heightRange,Z=Yr(O.toUnwrapped(),M),K=c.translatePosMatrix(O.projMatrix,B,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));let W,se,Q,ce;if(p==="initialize"){if(!j||j.min>=1||H.depthSegments.segments[0].primitiveLength===0)continue;W=qh(K,Z,T,1,0),se=y,Q=H.depthSegments,ce=P}else if(p==="reset"){if(!j||j.min>=0||H.maskSegments.segments[0].primitiveLength===0)continue;W=qh(K,Z,0,0,1),se=b,Q=H.maskSegments,ce=P}else if(p==="geometry"){if(H.depthSegments.segments[0].primitiveLength===0)continue;W=qh(K,Z,T,1,0),se=y,Q=H.depthSegments,ce=z}ce.draw(c,_.TRIANGLES,se,li.disabled,xi.disabled,ii.disabled,W,r.id,H.vertexBuffer,H.indexBuffer,Q,r.paint,c.transform.zoom)}}function po(c,t,r){const{painter:u,sourceCache:p,layer:_,coords:y,colorMode:b,elevationType:T,terrainEnabled:M,pass:I}=c,P=u.context.gl,z=_.paint.get("fill-pattern"),O=_.paint.get("fill-pattern-cross-fade"),B=z.constantOr(null);let N=T;T!=="road"||t&&!M||(N="none");const H=N==="road",j=c.painter.shadowRenderer,Z=H&&!!j&&j.enabled,K=new Ut(u.context.gl.LEQUAL,Ut.ReadOnly,u.depthRangeFor3D);let W=[0,0,0];if(Z){const ce=u.style.directionalLight,ie=u.style.ambientLight;ce&&ie&&(W=Pa(u.style,ce,ie))}const se=z&&z.constantOr(1),Q=(ce,ie)=>{let te,ue,we,ve,Oe;ie?(te=se&&!_.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",we=P.LINES):(te=se?"fillPattern":"fill",we=P.TRIANGLES);for(const ze of y){const je=p.getTile(ze);if(se&&!je.patternsLoaded())continue;const lt=je.getBucket(_);if(!lt)continue;const Me=t?lt.elevationBufferData:lt.bufferData;if(Me.isEmpty())continue;u.prepareDrawTile();const ge=Me.programConfigurations.get(_.id),Ge=u.isTileAffectedByFog(ze),Re=[],it=[];H&&(Re.push("ELEVATED_ROADS"),it.push(Me.elevatedLayoutVertexBuffer)),Z&&Re.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),se&&(u.context.activeTexture.set(P.TEXTURE0),je.imageAtlasTexture&&je.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),ge.updatePaintBuffers());let Je=!1;if(B&&je.imageAtlas){const Mt=je.imageAtlas,St=o.e2.from(B),Rt=St.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),Kt=St.getSecondary(),Ti=Mt.patternPositions.get(Rt),fi=Kt?Mt.patternPositions.get(Kt.scaleSelf(o.o.devicePixelRatio).toString()):null;Je=!!Ti&&!!fi,Ti&&ge.setConstantPatternPositions(Ti,fi)}O>0&&(Je||ge.getPatternTransitionVertexBuffer("fill-pattern"))&&Re.push("FILL_PATTERN_TRANSITION");const vt=u.getOrCreateProgram(te,{config:ge,overrideFog:Ge,defines:Re}),Ze=u.translatePosMatrix(ze.projMatrix,je,_.paint.get("fill-translate"),_.paint.get("fill-translate-anchor"));Z&&j.setupShadows(je.tileID.toUnwrapped(),vt,"vector-tile");const $e=_.paint.get("fill-emissive-strength");if(ie){ve=Me.lineIndexBuffer,Oe=Me.lineSegments;const Mt=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[P.drawingBufferWidth,P.drawingBufferHeight];ue=te==="fillOutlinePattern"&&se?Ud(Ze,$e,u,je,Mt,W,O):Nd(Ze,$e,Mt,W)}else ve=Me.indexBuffer,Oe=Me.triangleSegments,ue=se?kd(Ze,$e,u,je,W,O):kc(Ze,$e,W);u.uploadCommonUniforms(u.context,vt,ze.toUnwrapped());let xt=ce;(T==="road"&&!M||T==="offset")&&(xt=K),vt.draw(u,we,xt,r||u.stencilModeForClipping(ze),b,ii.disabled,ue,_.id,Me.layoutVertexBuffer,ve,Oe,_.paint,u.transform.zoom,ge,it)}};u.renderPass===I&&Q(u.depthModeForSublayer(1,u.renderPass==="opaque"?Ut.ReadWrite:Ut.ReadOnly),!1),N==="none"&&u.renderPass==="translucent"&&_.paint.get("fill-antialias")&&Q(u.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,Ut.ReadOnly),!0)}function st(c,t,r,u,p,_,y,b){r.resetLayerRenderingStats(c);const T=c.context,M=T.gl,I=c.transform,P=r.paint.get("fill-extrusion-pattern"),z=r.paint.get("fill-extrusion-pattern-cross-fade"),O=P.constantOr(null),B=P.constantOr(1),N=r.paint.get("fill-extrusion-opacity"),H=c.style.enable3dLights(),j=r.paint.get(H&&!B?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Z=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),j],K=r.layout.get("fill-extrusion-edge-radius"),W=K>0&&!r.paint.get("fill-extrusion-rounded-roof"),se=W?0:K,Q=I.projection.name==="globe"?o.ea():0,ce=I.projection.name==="globe",ie=ce?o.aj(I.zoom):0,te=[o.aF(I.center.lng),o.aJ(I.center.lat)],ue=r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",we=r.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ue?null:r.lut).toArray01().slice(0,3),ve=r.paint.get("fill-extrusion-flood-light-intensity"),Oe=r.paint.get("fill-extrusion-vertical-scale"),ze=r.paint.get("fill-extrusion-line-width").constantOr(1)!==0,je=r.paint.get("fill-extrusion-height-alignment"),lt=r.paint.get("fill-extrusion-base-alignment"),Me=Mo(c,r.paint.get("fill-extrusion-cutoff-fade-range")),ge=[];let Ge;ce&&ge.push("PROJECTION_GLOBE_VIEW"),Z[0]>0&&ge.push("FAUX_AO"),W&&ge.push("ZERO_ROOF_RADIUS"),b&&ge.push("HAS_CENTROID"),ve>0&&ge.push("FLOOD_LIGHT"),Me.shouldRenderCutoff&&ge.push("RENDER_CUTOFF"),ze&&ge.push("RENDER_WALL_MODE");const Re=c.renderPass==="shadow",it=c.shadowRenderer,Je=Re&&!!it,vt=Re?ii.disabled:ii.backCCW;c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!0);let Ze=[0,0,0];if(it){const Mt=c.style.directionalLight,St=c.style.ambientLight;Mt&&St&&(Ze=Pa(c.style,Mt,St)),Re||(ge.push("RENDER_SHADOWS","DEPTH_TEXTURE"),it.useNormalOffset&&ge.push("NORMAL_OFFSET")),Ge=ge.concat(["SHADOWS_SINGLE_CASCADE"])}const $e=Je?"fillExtrusionDepth":B?"fillExtrusionPattern":"fillExtrusion",xt=r.getLayerRenderingStats();for(const Mt of u){const St=t.getTile(Mt),Rt=St.getBucket(r);if(!Rt||Rt.projection.name!==I.projection.name)continue;let Kt=!1;it&&(Kt=it.getMaxCascadeForTile(Mt.toUnwrapped())===0);const Ti=c.isTileAffectedByFog(Mt),fi=Rt.programConfigurations.get(r.id);let Qi=!1;if(O&&St.imageAtlas){const Xi=St.imageAtlas,yi=o.e2.from(O),an=yi.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),Si=yi.getSecondary(),Mn=Xi.patternPositions.get(an),Vi=Si?Xi.patternPositions.get(Si.scaleSelf(o.o.devicePixelRatio).toString()):null;Qi=!!Mn&&!!Vi,Mn&&fi.setConstantPatternPositions(Mn,Vi)}z>0&&(Qi||fi.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&ge.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Qt=c.getOrCreateProgram($e,{config:fi,defines:Kt?Ge:ge,overrideFog:Ti});if(c.terrain&&c.terrain.setupElevationDraw(St,Qt,{useMeterToDem:!0}),!Rt.centroidVertexBuffer){const Xi=Qt.getAttributeLocation(M,"a_centroid_pos");Xi!==-1&&M.vertexAttrib2f(Xi,0,0)}!Re&&it&&it.setupShadows(St.tileID.toUnwrapped(),Qt,"vector-tile"),B&&(c.context.activeTexture.set(M.TEXTURE0),St.imageAtlasTexture&&St.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),fi.updatePaintBuffers());const Ni=r.paint.get("fill-extrusion-vertical-gradient"),oi=1/Rt.tileToMeter;let en;if(Re&&it){if(Wu(St.tileID,Rt.maxHeight,c))continue;const Xi=it.calculateShadowPassMatrixFromTile(St.tileID.toUnwrapped());en=Bd(Xi,se,oi,Oe,je,lt)}else{const Xi=c.translatePosMatrix(Mt.expandedProjMatrix,St,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),yi=I.projection.createInversionMatrix(I,Mt.canonical);en=B?Hh(Xi,c,Ni,N,Z,se,oi,Mt,St,Q,je,lt,ie,te,yi,we,Oe,z):Zs(Xi,c,Ni,N,Z,se,oi,Mt,Q,je,lt,ie,te,yi,we,Oe,ve,Ze)}c.uploadCommonUniforms(T,Qt,Mt.toUnwrapped(),null,Me);let Fi=Rt.segments;if(I.projection.name==="mercator"&&!Re&&(Fi=Rt.getVisibleSegments(St.tileID,c.terrain,c.transform.getFrustum(0)),!Fi.get().length))continue;if(xt)if(Re)for(const Xi of Fi.get())xt.numRenderedVerticesInShadowPass+=Xi.primitiveLength;else for(const Xi of Fi.get())xt.numRenderedVerticesInTransparentPass+=Xi.primitiveLength;const Zi=[];(c.terrain||b)&&Zi.push(Rt.centroidVertexBuffer),ce&&Zi.push(Rt.layoutVertexExtBuffer),ze&&Zi.push(Rt.wallVertexBuffer),Qt.draw(c,T.gl.TRIANGLES,p,_,y,vt,en,r.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Fi,r.paint,c.transform.zoom,fi,Zi)}c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!1)}class yr{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Ar(c,t,r,u,p,_,y,b,T,M,I,P,z,O,B,N,H,j,Z,K){const W=t.context,se=W.gl,Q=t.transform,ce=t.transform.zoom,ie=[],te=c.translate,ue=c.translateAnchor,we=c.edgeRadius,ve=Mo(t,c.cutoffFadeRange);I==="clear"?(ie.push("CLEAR_SUBPASS"),K&&(ie.push("CLEAR_FROM_TEXTURE"),W.activeTexture.set(se.TEXTURE0),K.bind(se.LINEAR,se.CLAMP_TO_EDGE))):I==="sdf"&&ie.push("SDF_SUBPASS"),j&&ie.push("HAS_CENTROID"),ve.shouldRenderCutoff&&ie.push("RENDER_CUTOFF");const Oe=(ze,je,lt,Me,ge)=>{let Ge=ie;je.groundRadiusBuffer!=null&&(Ge=ie.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const Re=je.programConfigurations.get(u.id),it=t.isTileAffectedByFog(ze),Je=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:Re,defines:Ge,overrideFog:it}),vt=Bc(t,Me,P,M,ge,[z,O*ge],B,N,H,ce>=17?0:we*ge,K?K.size[0]:0),Ze=[];j&&Ze.push(je.hiddenByLandmarkVertexBuffer),je.groundRadiusBuffer!=null&&Ze.push(je.groundRadiusBuffer),t.uploadCommonUniforms(W,Je,ze.toUnwrapped(),null,ve),Je.draw(t,W.gl.TRIANGLES,_,y,b,T,vt,u.id,je.vertexBuffer,je.indexBuffer,lt,u.paint,ce,Re,Ze)};for(const ze of p){const je=r.getTile(ze),lt=je.getBucket(u);if(!lt||lt.projection.name!==Q.projection.name||!lt.groundEffect||lt.groundEffect&&!lt.groundEffect.hasData())continue;const Me=lt.groundEffect,ge=1/lt.tileToMeter;{const Ge=t.translatePosMatrix(ze.projMatrix,je,te,ue),Re=Me.getDefaultSegment();Oe(ze,Me,Re,Ge,ge)}if(Z)for(let Ge=0;Ge<4;Ge++){const Re=o.e8[Ge](ze),it=r.getTile(Re);if(!it)continue;const Je=it.getBucket(u);if(!Je||Je.projection.name!==Q.projection.name||!Je.groundEffect||Je.groundEffect&&!Je.groundEffect.hasData())continue;const vt=Je.groundEffect;let Ze,$e;Ge===0?(Ze=[-o.al,0,0],$e=1):Ge===1?(Ze=[o.al,0,0],$e=0):Ge===2?(Ze=[0,-o.al,0],$e=3):(Ze=[0,o.al,0],$e=2);const xt=vt.regionSegments[$e];if(!xt)continue;const Mt=new Float32Array(16);o.bq(Mt,ze.projMatrix,Ze),Oe(ze,vt,xt,t.translatePosMatrix(Mt,je,te,ue),ge)}}}function ms(c,t,r,u,p,_,y){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();const b=_?_.findDEMTileFor(r):null;if(!(b&&b.dem||y))return;_&&b&&b.dem&&u.selfDEMTileTimestamp!==b.dem._timestamp&&(u.borderDoneWithNeighborZ=[-1,-1,-1,-1],u.selfDEMTileTimestamp=b.dem._timestamp);const T=j=>new o.P(Math.ceil((j+o.ec)*o.ed),0),M=j=>{const Z=t.getSource().minzoom,K=se=>{const Q=t.getTileByID(se);if(Q&&Q.hasData())return Q.getBucket(p)},W=[0,-1,1];for(const se of W){if(j.overscaledZ+se<Z)continue;const Q=K(j.calculateScaledKey(j.overscaledZ+se));if(Q)return Q}},I=[0,0,0],P=(j,Z)=>(I[0]=Math.min(j.min.y,Z.min.y),I[1]=Math.max(j.max.y,Z.max.y),I[2]=o.al-Z.min.x>j.max.x?Z.min.x-o.al:j.max.x,I),z=(j,Z)=>(I[0]=Math.min(j.min.x,Z.min.x),I[1]=Math.max(j.max.x,Z.max.x),I[2]=o.al-Z.min.y>j.max.y?Z.min.y-o.al:j.max.y,I),O=[(j,Z)=>P(j,Z),(j,Z)=>P(Z,j),(j,Z)=>z(j,Z),(j,Z)=>z(Z,j)],B=(j,Z,K,W,se,Q,ce)=>{if(!_)return 0;const ie=[[Q?K:j,Q?j:K,0],[Q?K:Z,Q?Z:K,0]],te=ce<0?o.al+ce:ce,ue=[Q?te:(j+Z)/2,Q?(j+Z)/2:te,0];return K===0&&ce<0||K!==0&&ce>0?_.getForTilePoints(se,[ue],!0,W):ie.push(ue),_.getForTilePoints(r,ie,!0,b),Math.max(ie[0][2],ie[1][2],ue[2])/_.exaggeration()};for(let j=0;j<4;j++){const Z=u.borderFeatureIndices[j];if(Z.length===0)continue;const K=o.e8[j](r),W=M(K);if(!(W&&W instanceof o.e9))continue;const se=_?_.findDEMTileFor(K):null;if(!(se&&se.dem||y)||(_&&se&&se.dem&&u.borderDEMTileTimestamp[j]!==se.dem._timestamp&&(u.borderDoneWithNeighborZ[j]=-1,u.borderDEMTileTimestamp[j]=se.dem._timestamp),u.borderDoneWithNeighborZ[j]===W.canonical.z))continue;W.centroidVertexArray.length===0&&W.createCentroidsBuffer();const Q=(j<2?1:5)-j,ce=W.borderDoneWithNeighborZ[Q]!==u.canonical.z,ie=W.borderFeatureIndices[Q];let te=0;if(u.canonical.z!==W.canonical.z){for(const ue of Z)u.showCentroid(u.featuresOnBorder[ue]);if(ce)for(const ue of ie)W.showCentroid(W.featuresOnBorder[ue]);u.borderDoneWithNeighborZ[j]=W.canonical.z,W.borderDoneWithNeighborZ[Q]=u.canonical.z}for(const ue of Z){const we=u.featuresOnBorder[ue],ve=u.centroidData[we.centroidDataIndex],Oe=we.borders[j];let ze;for(;te<ie.length;){ze=W.featuresOnBorder[ie[te]];const je=ze.borders[Q];if(je[1]>Oe[0]+3||je[0]>Oe[0]-3)break;W.showCentroid(ze),te++}if(ze&&te<ie.length){const je=te;let lt=0;for(;!(ze.borders[Q][0]>Oe[1]-3)&&(lt++,++te!==ie.length);)ze=W.featuresOnBorder[ie[te]];ze=W.featuresOnBorder[ie[je]];let Me=!1;if(lt>=1){const Re=ze.borders[Q];Math.abs(Oe[0]-Re[0])<3&&Math.abs(Oe[1]-Re[1])<3&&(lt=1,Me=!0,te=je+1)}else if(lt===0){u.showCentroid(we);continue}const ge=W.centroidData[ze.centroidDataIndex];y&&Me&&(((N=ve).flags|(H=ge).flags)&o.eb?(N.flags|=o.eb,H.flags|=o.eb):(N.flags&=~o.eb,H.flags&=~o.eb));const Ge=we.intersectsCount()>1||ze.intersectsCount()>1;if(lt>1)te=je,ve.centroidXY=ge.centroidXY=new o.P(0,0);else if(se&&se.dem&&!Ge){const Re=O[j](ve,ge),it=j%2?o.al-1:0,Je=B(Re[0],Math.min(o.al-1,Re[1]),it,se,K,j<2,Re[2]);ve.centroidXY=ge.centroidXY=T(Je)}else Ge?ve.centroidXY=ge.centroidXY=new o.P(0,0):(ve.centroidXY=u.encodeBorderCentroid(we),ge.centroidXY=W.encodeBorderCentroid(ze));u.writeCentroidToBuffer(ve),W.writeCentroidToBuffer(ge)}else u.showCentroid(we)}u.borderDoneWithNeighborZ[j]=W.canonical.z,W.borderDoneWithNeighborZ[Q]=u.canonical.z}var N,H;(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(c)}const zo=[1,0,0],Wt=[0,1,0],$u=[0,0,1];function Wu(c,t,r){const u=r.transform,p=r.shadowRenderer;if(!p)return!0;const _=c.toUnwrapped(),y=u.tileSize*p._cascades[r.currentShadowCascade].scale;let b=t;if(u.elevation){const N=u.elevation.getMinMaxForTile(c);N&&(b+=N.max)}const T=[...p.shadowDirection];T[2]=-T[2];const M=p.computeSimplifiedTileShadowVolume(_,b,y,T);if(!M)return!1;const I=[zo,Wt,$u,T,[T[0],0,T[2]],[0,T[1],T[2]]],P=u.projection.name==="globe",z=u.scaleZoom(y),O=o.cA.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,z,!P),B=p.getCurrentCascadeFrustum();return O.intersectsPrecise(M.vertices,M.planes,I)===0||B.intersectsPrecise(M.vertices,M.planes,I)===0}function Sl(c){const{painter:t,source:r,layer:u,coords:p}=c;let _=c.defines;const y=t.context,b=t.renderPass==="shadow",T=t.renderPass==="light-beam",M=t.shadowRenderer,I=o.ee(t.transform.center.lat,t.transform.zoom),P=Mo(t,u.paint.get("building-cutoff-fade-range"));P.shouldRenderCutoff&&(_=_.concat("RENDER_CUTOFF")),c.floodLightIntensity>0&&(_=_.concat("FLOOD_LIGHT"));for(const z of p){const O=r.getTile(z),B=O.getBucket(u);if(!B)continue;M&&M.getMaxCascadeForTile(z.toUnwrapped())===0&&(_=_.concat("SHADOWS_SINGLE_CASCADE"));const N=B.programConfigurations.get(u.id);let H,j,Z,K=t.translatePosMatrix(z.expandedProjMatrix,O,[0,0],"map");if(K=o.cR(o.bB(),K,[1,1,c.verticalScale]),b&&M){if(Wu(O.tileID,B.maxHeight*I,t))continue;let se=M.calculateShadowPassMatrixFromTile(O.tileID.toUnwrapped());se=o.cR(o.bB(),se,[1,1,c.verticalScale]),Z=Xf(se),H=j=t.getOrCreateProgram("buildingDepth",{config:N,defines:_,overrideFog:!1})}else if(T)H=j=t.getOrCreateProgram("buildingBloom",{config:N,defines:_,overrideFog:!1}),Z=wl(K);else{const se=t.transform.calculatePosMatrix(z.toUnwrapped(),t.transform.worldSize);o.cR(se,se,[1,1,c.verticalScale]);const Q=o.bB();o.cR(Q,se,[1,-1,1/I]),o.bk(Q,Q),o.ef(Q,Q);const ce=t.transform.getFreeCameraOptions().position,ie=1<<z.canonical.z;if(Z=bl(K,Q,c.opacity,c.facadeAOIntensity,[((ce.x-z.wrap)*ie-z.canonical.x)*o.al,(ce.y*ie-z.canonical.y)*o.al,ce.z*ie*o.al],B.tileToMeter,c.facadeEmissiveChance,c.floodLightColor,c.floodLightIntensity),j=t.getOrCreateProgram("building",{config:N,defines:_,overrideFog:!1}),c.depthOnly===!0)H=j;else{const te=_.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);H=t.getOrCreateProgram("building",{config:N,defines:te,overrideFog:!1})}M&&(M.setupShadowsFromMatrix(se,j,!0),H!==j&&M.setupShadowsFromMatrix(se,H,!0))}const W=(se,Q)=>{if(T){const ce=se.entranceBloom;Q.draw(t,y.gl.TRIANGLES,c.depthMode,li.disabled,c.blendMode,ii.disabled,Z,u.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segmentsBucket,u.paint,t.transform.zoom,N,[ce.layoutAttenuationBuffer,ce.layoutColorBuffer])}else{const ce=se.segmentsBucket;let ie=[se.layoutNormalBuffer,se.layoutCentroidBuffer,se.layoutColorBuffer,se.layoutFloodLightDataBuffer];se.layoutFacadePaintBuffer&&(ie=ie.concat([se.layoutFacadeDataBuffer,se.layoutFacadeVerticalRangeBuffer,se.layoutFacadePaintBuffer])),Q.draw(t,y.gl.TRIANGLES,c.depthMode,li.disabled,c.blendMode,b?ii.disabled:ii.backCW,Z,u.id,se.layoutVertexBuffer,se.indexBuffer,ce,u.paint,t.transform.zoom,N,ie)}};t.uploadCommonUniforms(y,j,z.toUnwrapped(),null,P),B.buildingWithoutFacade&&W(B.buildingWithoutFacade,j),B.buildingWithFacade&&(H!==j&&t.uploadCommonUniforms(y,H,z.toUnwrapped(),null,P),W(B.buildingWithFacade,H))}}function jd(c,t,r,u,p,_,y,b,T,M,I,P,z){const O=c.context.gl,B=c.depthModeForSublayer(1,Ut.ReadOnly,O.LEQUAL,!0),N=.1*(1-(H=I))+3*H;var H;const j=c._showOverdrawInspector,Z=P,K=new yr;j||Ar(K,c,t,r,u,B,new li({func:O.ALWAYS,mask:255},255,255,O.KEEP,O.KEEP,O.REPLACE),new xi([O.ONE,O.ONE,O.ONE,O.ONE],o.ao.transparent,[!1,!1,!1,!0],O.MIN),ii.disabled,p,"sdf",_,y,b,T,M,N,Z,!1);{const W=j?li.disabled:new li({func:O.EQUAL,mask:255},255,255,O.KEEP,O.DECR,O.DECR),se=j?c.colorModeForRenderPass():new xi([O.ONE_MINUS_DST_ALPHA,O.DST_ALPHA,O.ONE,O.ONE],o.ao.transparent,[!0,!0,!0,!0]);Ar(K,c,t,r,u,B,W,se,ii.disabled,p,"color",_,y,b,T,M,N,Z,!1)}}function Fr(c){return[c[0]*o.eg,c[1]*o.eg,c[2]*o.eg,0]}function Kh(c,t,r,u,p,_,y,b,T){const M=u.getSource(),I=r.globeSharedBuffers;if(!I)return;let P,z,O;if(t&&(P=u.getTile(t)),M instanceof o.aT?(z=M.texture,O=o.dJ(0,0,r.transform)):P&&t&&(z=P.texture,O=o.dJ(t.canonical.z,t.canonical.x,r.transform)),!z||!O)return;c||(O=o.cR(o.bB(),O,[1,-1,1]));const B=r.context,N=B.gl,H=p.paint.get("raster-resampling")==="nearest"?N.NEAREST:N.LINEAR,j=r.colorModeForDrapableLayerRenderPass(_),Z=y.defines;Z.push("GLOBE_POLES");const K=new Ut(N.LEQUAL,Ut.ReadWrite,r.depthRangeFor3D),W=Float32Array.from(r.transform.expandedFarZProjMatrix),se=Float32Array.from(o.bj(o.dI(new o.cC(0,0,0))));r.terrain&&r.terrain.prepareDrawTile(),B.activeTexture.set(N.TEXTURE0),z.bind(H,N.CLAMP_TO_EDGE),B.activeTexture.set(N.TEXTURE1),z.bind(H,N.CLAMP_TO_EDGE),"useMipmap"in z&&B.extTextureFilterAnisotropic&&r.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax);const[Q,ce,ie,te]=t?I.getPoleBuffers(t.canonical.z,!1):I.getPoleBuffers(0,!0),ue=p.paint.get("raster-elevation");let we;c?(we=Q,r.renderDefaultNorthPole=ue!==0):(we=ce,r.renderDefaultSouthPole=ue!==0);const ve=Fr(y.mix),Oe=((je,lt,Me,ge,Ge,Re,it,Je,vt,Ze,$e,xt,Mt)=>Gu(je,lt,Me,new Float32Array(16),new Float32Array(9),[0,0],ge,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Re,[0,0],Je,2,Ze,$e,xt,1,0,Mt))(W,se,O,o.aj(r.transform.zoom),0,p,0,ue,0,ve,y.offset,y.range,_),ze=r.getOrCreateProgram("raster",{defines:Z});r.uploadCommonUniforms(B,ze,null),ze.draw(r,N.TRIANGLES,K,T,j,b,Oe,p.id,we,ie,te)}function Gd(c){const t=c._nearZ,r=c.projection.farthestPixelDistance(c),u=r-t,p=.2*c.height,_=t+p;return[t,r,(_-p-t)/u,(_-t)/u]}function W1(c,t,r,u){if(c)return t instanceof Xr&&c instanceof Eo?t.getTextureDescriptor(c,r,!0):{texture:c.texture,mix:Fr(u.mix),offset:u.offset,buffer:0,tileSize:1}}var Y1=o.eh([{name:"a_index",type:"Int16",components:1}]);class mo{constructor(t,r,u,p){const _={width:u[0],height:u[1],data:null},y=t.gl;this.targetColorTexture=new o.T(t,_,y.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(t,_,y.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(r,p),this.lastInvalidatedAt=0}updateParticleTexture(t,r){if(this.particleTextureDimension===r.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const u=this.context.gl,p=r.width*r.height;this.particleTexture0=new o.T(this.context,r,u.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,r,u.RGBA8,{premultiply:!1,useMipmap:!1});const _=new o.ei;_.reserve(p);for(let y=0;y<p;y++)_.emplaceBack(y);this.particleIndexBuffer=this.context.createVertexBuffer(_,Y1.members,!0),this.particleSegment=o.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=r.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=o.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Jh(c,t,r){if(!c)return null;const u=t.getTextureDescriptor(c,r,!0);if(!u)return null;let{texture:p,mix:_,offset:y,tileSize:b,buffer:T,format:M}=u;if(!p||!M)return null;let I=!1;return M==="uint32"&&(I=!0,_[3]=0,_=Jl(o.ej,_,[0,r.paint.get("raster-particle-max-speed")]),y=Wo(o.ej,y,[0,r.paint.get("raster-particle-max-speed")])),{texture:p,textureOffset:[T/(b+2*T),b/(b+2*T)],tileSize:b,scalarData:I,scale:_,offset:y,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[M]]}}function Aa(c){const t=c._nearZ,r=c.projection.farthestPixelDistance(c),u=r-t,p=.2*c.height,_=t+p;return[t,r,(_-p-t)/u,(_-t)/u]}const Qs=new o.ao(1,0,0,1),Ga=new o.ao(0,1,0,1),jr=new o.ao(0,0,1,1),Yu=new o.ao(1,0,1,1),Vc=new o.ao(0,1,1,1);function Ku(c,t,r,u,p,_){for(let y=0;y<r.length;y++)if(p){const M=new o.ao(u.r*.8,u.g*.8,u.b*.8,1);Ha(c,t,r[y],u,-1,-1,_),Ha(c,t,r[y],u,-1,1,_),Ha(c,t,r[y],u,1,1,_),Ha(c,t,r[y],u,1,-1,_),Ha(c,t,r[y],M,0,0,_)}else Ha(c,t,r[y],u,0,0,_)}function Ha(c,t,r,u,p,_,y){const b=c.context,T=c.transform,M=b.gl,I=T.projection.name==="globe",P=I?["PROJECTION_GLOBE_VIEW"]:[];let z=o.by(r.projMatrix);if(I&&o.aj(T.zoom)>0){const ve=o.bi(r.canonical,T),Oe=o.ek(ve);z=o.aB(new Float32Array(16),T.globeMatrix,Oe),o.aB(z,T.projMatrix,z)}const O=o.bB();O[12]+=2*p/(o.o.devicePixelRatio*T.width),O[13]+=2*_/(o.o.devicePixelRatio*T.height),o.aB(z,O,z);const B=c.getOrCreateProgram("debug",{defines:P}),N=t.getTileByID(r.key);c.terrain&&c.terrain.setupElevationDraw(N,B);const H=Ut.disabled,j=li.disabled,Z=c.colorModeForRenderPass(),K="$debug";b.activeTexture.set(M.TEXTURE0),c.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),I?N._makeGlobeTileDebugBuffers(c.context,T):N._makeDebugTileBoundsBuffers(c.context,T.projection);const W=N._tileDebugBuffer||c.debugBuffer,se=N._tileDebugIndexBuffer||c.debugIndexBuffer,Q=N._tileDebugSegments||c.debugSegments;if(B.draw(c,M.LINE_STRIP,H,j,Z,ii.disabled,Kl(z,u.toPremultipliedRenderColor(null)),K,W,se,Q,null,null,null,[N._globeTileDebugBorderBuffer]),y){const ve=N.latestRawTileData,Oe=Math.floor((ve&&ve.byteLength||0)/1024);let ze=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(ze+=` => ${r.overscaledZ}`),ze+=` ${N.state}`,ze+=` ${Oe}kb`,(function(je,lt){je.initDebugOverlayCanvas();const Me=je.debugOverlayCanvas,ge=je.context.gl,Ge=je.debugOverlayCanvas.getContext("2d");Ge.clearRect(0,0,Me.width,Me.height),Ge.shadowColor="white",Ge.shadowBlur=2,Ge.lineWidth=1.5,Ge.strokeStyle="white",Ge.textBaseline="top",Ge.font="bold 36px Open Sans, sans-serif",Ge.fillText(lt,5,5),Ge.strokeText(lt,5,5),je.debugOverlayTexture.update(Me),je.debugOverlayTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)})(c,ze)}const ce=t.getTile(r).tileSize,ie=512/Math.min(ce,512)*(r.overscaledZ/T.zoom)*.5,te=N._tileDebugTextBuffer||c.debugBuffer,ue=N._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,we=N._tileDebugTextSegments||c.debugSegments;B.draw(c,M.TRIANGLES,H,j,xi.alphaBlended,ii.disabled,Kl(z,o.ao.transparent.toPremultipliedRenderColor(null),ie),K,te,ue,we,null,null,null,[N._globeTileDebugTextBuffer])}function mn(c,t,r,u){nc(c,0,t+r/2,c.transform.width,r,u)}function ic(c,t,r,u){nc(c,t-r/2,0,r,c.transform.height,u)}function nc(c,t,r,u,p,_){const y=c.context,b=y.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*o.o.devicePixelRatio,r*o.o.devicePixelRatio,u*o.o.devicePixelRatio,p*o.o.devicePixelRatio),y.clear({color:_}),b.disable(b.SCISSOR_TEST)}const Hd=o.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:$f}=Hd;function el(c,t,r,u){c.emplaceBack(t,r,u)}class qd{constructor(t){this.vertexArray=new o.el,this.indices=new o.b0,el(this.vertexArray,-1,-1,1),el(this.vertexArray,1,-1,1),el(this.vertexArray,-1,1,1),el(this.vertexArray,1,1,1),el(this.vertexArray,-1,-1,-1),el(this.vertexArray,1,-1,-1),el(this.vertexArray,-1,1,-1),el(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,$f),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=o.bf.simpleSegment(0,0,36,12)}}function Ro(c,t,r,u,p,_){const y=c.context.gl,b=t.paint.get("sky-atmosphere-color"),T=t.paint.get("sky-atmosphere-halo-color"),M=t.paint.get("sky-atmosphere-sun-intensity"),I=((P,z,O,B,N)=>({u_matrix_3f:P,u_sun_direction:z,u_sun_intensity:O,u_color_tint_r:[B.r,B.g,B.b,B.a],u_color_tint_m:[N.r,N.g,N.b,N.a],u_luminance:5e-5}))(o.en(o.dN(),u),p,M,b.toPremultipliedRenderColor(null),T.toPremultipliedRenderColor(null));y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+_,t.skyboxTexture,0),r.draw(c,y.TRIANGLES,Ut.disabled,li.disabled,xi.unblended,ii.frontCW,I,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const rc=o.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ut{constructor(t){const r=new o.eo;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const u=new o.b0;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(r,rc.members),this.indexBuffer=t.createIndexBuffer(u),this.segments=o.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const It=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class jc{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class fr{constructor(t){this.colorModeAlphaBlendedWriteRGB=new xi([1,lr,1,lr],o.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new xi([1,0,1,0],o.ao.transparent,[!1,!1,!1,!0]),this.params=new jc,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(t){const r=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ut(r);const u=this.params.sizeRange,p=this.params.intensityRange,_=(function(I){const P=o.eq(30),z=[];for(let O=0;O<I;++O){const B=2*Math.PI*P(),N=Math.acos(1-2*P())-.5*Math.PI;z.push(o.d4(Math.cos(N)*Math.cos(B),Math.cos(N)*Math.sin(B),Math.sin(N)))}return z})(this.params.starsCount),y=o.eq(300),b=new o.ep,T=new o.b0;let M=0;for(let I=0;I<_.length;++I){const P=o.c4([],_[I],200),z=Math.max(0,1+.01*u*(1*y()-.5)),O=Math.max(0,1+.01*p*(1*y()-.5));b.emplaceBack(P[0],P[1],P[2],-1,-1,z,O),b.emplaceBack(P[0],P[1],P[2],1,-1,z,O),b.emplaceBack(P[0],P[1],P[2],1,1,z,O),b.emplaceBack(P[0],P[1],P[2],-1,1,z,O),T.emplaceBack(M+0,M+1,M+2),T.emplaceBack(M+0,M+2,M+3),M+=4}this.starsVx=r.createVertexBuffer(b,It.members),this.starsIdx=r.createIndexBuffer(T),this.starsSegments=o.bf.simpleSegment(0,0,b.length,T.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,r){const u=t.context,p=u.gl,_=t.transform,y=new Ut(p.LEQUAL,Ut.ReadOnly,[0,1]),b=o.aj(_.zoom),T=t.style.getLut(r.scope),M=r.properties.get("color-use-theme")==="none",I=r.properties.get("color").toNonPremultipliedRenderColor(M?null:T),P=r.properties.get("high-color-use-theme")==="none",z=r.properties.get("high-color").toNonPremultipliedRenderColor(P?null:T),O=r.properties.get("space-color-use-theme")==="none",B=r.properties.get("space-color").toNonPremultipliedRenderColor(O?null:T),N=5e-4,H=o.er(r.properties.get("horizon-blend"),0,1,N,.25),j=o.dD(t,u,_)&&H===N?_.worldSize/(2*Math.PI*1.025)-1:_.globeRadius,Z=t.frameCounter/1e3%1,K=o.ag(_.globeCenterInViewSpace),W=Math.sqrt(Math.pow(K,2)-Math.pow(j,2)),se=Math.acos(W/K),Q=ce=>{const ie=_.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ce&&ie.push("ALPHA_PASS");const te=t.getOrCreateProgram("globeAtmosphere",{defines:ie}),ue=((ve,Oe,ze,je,lt,Me,ge,Ge,Re,it,Je,vt)=>({u_frustum_tl:ve,u_frustum_tr:Oe,u_frustum_br:ze,u_frustum_bl:je,u_horizon:lt,u_transition:Me,u_fadeout_range:ge,u_atmosphere_fog_color:Ge.toArray01(),u_high_color:Re.toArray01(),u_space_color:it.toArray01(),u_temporal_offset:Je,u_horizon_angle:vt}))(_.frustumCorners.TL,_.frustumCorners.TR,_.frustumCorners.BR,_.frustumCorners.BL,_.frustumCorners.horizon,b,H,I,z,B,Z,se);t.uploadCommonUniforms(u,te);const we=this.atmosphereBuffer;we&&te.draw(t,p.TRIANGLES,y,li.disabled,ce?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ii.backCW,ue,ce?"atmosphere_glow_alpha":"atmosphere_glow",we.vertexBuffer,we.indexBuffer,we.segments)};Q(!1),Q(!0)}drawStars(t,r){const u=o.aA(r.properties.get("star-intensity"),0,1);if(u===0)return;const p=t.context,_=p.gl,y=t.transform,b=t.getOrCreateProgram("stars"),T=o.c6([]);o.c8(T,T,-y._pitch),o.c7(T,T,-y.angle),o.c8(T,T,o.an(y._center.lat)),o.es(T,T,-o.an(y._center.lng));const M=o.cb(new Float32Array(16),T),I=o.aB([],y.starsProjMatrix,M),P=o.en([],M),z=o.et([],P),O=[0,1,0];o.dP(O,O,z),o.c4(O,O,this.params.sizeMultiplier);const B=[1,0,0];o.dP(B,B,z),o.c4(B,B,this.params.sizeMultiplier);const N=(H=O,j=B,Z=u,{u_matrix:Float32Array.from(I),u_up:H,u_right:j,u_intensity_multiplier:Z});var H,j,Z;t.uploadCommonUniforms(p,b),this.starsVx&&this.starsIdx&&b.draw(t,_.TRIANGLES,Ut.disabled,li.disabled,this.colorModeAlphaBlendedWriteRGB,ii.disabled,N,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Se{constructor(){this.visibleTiles=[]}updateBorders(t,r){const u=[],p=[],_=t._getRenderableCoordinates(!1,!0);for(const T of _){const M=t.getTile(T);if(!M.hasData())continue;const I=M.getBucket(r);I&&(I.isEmpty()||(u.push(T.key),p.push({bucket:I,tileID:T.canonical})))}let y=u.length!==this.visibleTiles.length;if(!y){u.sort();for(let T=0;T<u.length;T++)if(u[T]!==this.visibleTiles[T]){y=!0;break}}if(!y)return;const b=new Set;this.visibleTiles=u,p.sort(((T,M)=>T.tileID.z-M.tileID.z||T.tileID.x-M.tileID.x||T.tileID.y-M.tileID.y));for(const T of p){const M=new Array,I=new Array,P=T.bucket;for(const z of P.featuresOnBorder)b.has(z.featureId)?I.push(z.footprintIndex):(b.add(z.featureId),M.push(z.footprintIndex));P.updateFootprintHiddenFlags(M,o.eu,!1),P.updateFootprintHiddenFlags(I,o.eu,!0)}}}function Zd(c,t){const r=[...c],u=t.cameraWorldSizeForFog/t.worldSize,p=o.bz([]);return o.cR(p,p,[u,u,1]),o.aB(r,p,r),o.aB(r,t.worldToFogMatrix,r),r}function Gc(c,t,r,u,p){const _=r.material,y=u.context,{baseColorTexture:b,metallicRoughnessTexture:T}=_.pbrMetallicRoughness,{normalTexture:M,occlusionTexture:I,emissionTexture:P}=_;function z(B,N,H){if(B&&(c.push(N),y.activeTexture.set(y.gl.TEXTURE0+H),B.gfxTexture)){const{minFilter:j,magFilter:Z,wrapS:K,wrapT:W}=B.sampler;B.gfxTexture.bindExtraParam(j,Z,K,W)}}z(b,"HAS_TEXTURE_u_baseColorTexture",ca.BaseColor),z(T,"HAS_TEXTURE_u_metallicRoughnessTexture",ca.MetallicRoughness),z(M,"HAS_TEXTURE_u_normalTexture",ca.Normal),z(I,"HAS_TEXTURE_u_occlusionTexture",ca.Occlusion),z(P,"HAS_TEXTURE_u_emissionTexture",ca.Emission),p&&(p.texture||(p.texture=new o.d_(u.context,p.image,[p.image.height,p.image.height,p.image.height],y.gl.RGBA8)),y.activeTexture.set(y.gl.TEXTURE0+ca.LUT),p.texture&&p.texture.bind(y.gl.LINEAR,y.gl.CLAMP_TO_EDGE),c.push("APPLY_LUT_ON_GPU")),r.texcoordBuffer&&(c.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(r.texcoordBuffer)),r.colorBuffer&&(c.push(r.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(r.colorBuffer)),r.normalBuffer&&(c.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(r.normalBuffer)),r.pbrBuffer&&(c.push("HAS_ATTRIBUTE_a_pbr"),c.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(r.pbrBuffer)),_.alphaMode!=="OPAQUE"&&_.alphaMode!=="MASK"||c.push("UNPREMULT_TEXTURE_IN_SHADER"),_.defined||c.push("DIFFUSE_SHADED");const O=u.shadowRenderer;O&&(c.push("RENDER_SHADOWS","DEPTH_TEXTURE"),O.useNormalOffset&&c.push("NORMAL_OFFSET"))}function ac(c,t,r,u,p,_){const y=r.paint.get("model-opacity").constantOr(1),b=t.context,T=new Ut(t.context.gl.LEQUAL,c.isLightMesh?Ut.ReadOnly:Ut.ReadWrite,t.depthRangeFor3D),M=t.transform,I=c.mesh,P=I.material,z=P.pbrMetallicRoughness,O=t.style.fog;let B;B=t.transform.projection.zAxisUnit==="pixels"?[...c.nodeModelMatrix]:o.aB([],u.zScaleMatrix,c.nodeModelMatrix),o.aB(B,u.negCameraPosMatrix,B);const N=o.bk([],B);o.ef(N,N);const H=r.paint.get("model-color-use-theme").constantOr("default")==="none",j=r.paint.get("model-emissive-strength").constantOr(0),Z=tc(new Float32Array(c.worldViewProjection),new Float32Array(B),new Float32Array(N),null,t,y,z.baseColorFactor,P.emissiveFactor,z.metallicFactor,z.roughnessFactor,P,j,r,void 0,void 0,c.materialOverride,c.modelColor),K={defines:[]},W=[],se=t.shadowRenderer;se&&(se.useNormalOffset=!1),Gc(K.defines,W,I,t,H?null:r.lut);let Q=null;if(O){const te=Zd(c.nodeModelMatrix,t.transform);if(Q=new Float32Array(te),M.projection.name!=="globe"){const ue=I.aabb.min,we=I.aabb.max,[ve,Oe]=O.getOpacityForBounds(te,ue[0],ue[1],we[0],we[1]);K.overrideFog=ve>=Ce||Oe>=Ce}}const ce=Mo(t,r.paint.get("model-cutoff-fade-range"));ce.shouldRenderCutoff&&K.defines.push("RENDER_CUTOFF");const ie=t.getOrCreateProgram("model",K);t.uploadCommonUniforms(b,ie,null,Q,ce),t.renderPass!=="shadow"&&se&&se.setupShadowsFromMatrix(c.nodeModelMatrix,ie),ie.draw(t,b.gl.TRIANGLES,T,p,_,I.material.doubleSided?ii.disabled:ii.backCCW,Z,r.id,I.vertexBuffer,I.indexBuffer,I.segments,r.paint,t.transform.zoom,void 0,W)}function Qh(c,t,r){return c.type==="vector"?t.scope:r?"basemap":""}function ed(c,t,r,u,p,_,y,b,T){const M=c.transform,I=!!t.isGeometryBloom&&t.isGeometryBloom;if(I&&c.renderPass==="shadow")return;const P=M.projection.name==="globe"?o.eC(r,M):[...r];o.aB(P,P,t.globalMatrix);const z=o.aB([],u,P);if(t.meshes)for(const O of t.meshes){const B=b.get(O.material.name);if(B&&B.opacity<=0)continue;if(O.material.alphaMode!=="BLEND"){y.push({mesh:O,depth:0,modelIndex:p,worldViewProjection:z,nodeModelMatrix:P,isLightMesh:I,materialOverride:B,modelColor:T});continue}const N=o.af([],O.centroid,z);!M.isOrthographic&&N[2]<=0||_.push({mesh:O,depth:N[2],modelIndex:p,worldViewProjection:z,nodeModelMatrix:P,isLightMesh:I,materialOverride:B,modelColor:T})}if(t.children)for(const O of t.children)ed(c,O,r,u,p,_,y,b,T)}function Hc(c,t,r,u){const p=r.shadowRenderer;if(!p)return;const _=p.getShadowPassDepthMode(),y=p.getShadowPassColorMode(),b=p.calculateShadowPassMatrixFromMatrix(t),T=Ys(b);r.getOrCreateProgram("modelDepth",{defines:r._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,_,li.disabled,y,ii.disabled,T,u.id,c.vertexBuffer,c.indexBuffer,c.segments,u.paint,r.transform.zoom,void 0,void 0)}function qc(c,t,r,u,p,_){for(const y of p){const b=Object.assign({},u);b.part=y;const T={type:"Unknown",id:t,properties:b},M={orientation:c.paint.get("model-rotation").evaluate(T,r)};_.set(y,M)}}function K1(c,t,r,u,p,_){for(const y of p){const b=Object.assign({},u);b.part=y;const T={type:"Unknown",id:t,properties:b},M={color:c.paint.get("model-color").evaluate(T,r),colorMix:c.paint.get("model-color-mix-intensity").evaluate(T,r),opacity:c.paint.get("model-opacity").evaluate(T,r),emissionStrength:c.paint.get("model-emissive-strength").evaluate(T,r)};_.set(y,M)}}function J1(c,t,r,u,p,_){if(r===1)for(const b of p)ac(b,c,t,_[b.modelIndex],li.disabled,c.colorModeForRenderPass());else{for(const b of p)ac(b,c,t,_[b.modelIndex],li.disabled,xi.disabled);for(const b of p)ac(b,c,t,_[b.modelIndex],c.stencilModeFor3D(),c.colorModeForRenderPass());c.resetStencilClippingMasks()}const y=xi.additive;for(const b of u)ac(b,c,t,_[b.modelIndex],li.disabled,b.isLightMesh?y:c.colorModeForRenderPass())}function Wf(c,t,r){const u=t.updateZoomBasedPaintProperties(),p=(function(_,y,b){let T,M,I,P=_.terrain?_.terrain.exaggeration():0;if(_.terrain&&P>0){const z=_.terrain,O=z.findDEMTileFor(b);O&&O.dem?T=o.eE.create(z,b,O):P=0}if(P===0&&(y.terrainElevationMin=0,y.terrainElevationMax=0),P===y.validForExaggeration&&(P===0||T&&T._demTile&&T._demTile.tileID===y.validForDEMTile.id&&T._dem._timestamp===y.validForDEMTile.timestamp))return!1;for(const z in y.instancesPerModel){const O=y.instancesPerModel[z];for(let B=0;B<O.instancedDataArray.length;++B){const N=(T?P*T.getElevationAt(0|O.instancedDataArray.float32[16*B],0|O.instancedDataArray.float32[16*B+1],!0,!0):0)+O.instancesEvaluatedElevation[B];O.instancedDataArray.float32[16*B+6]=N,M=M?Math.min(y.terrainElevationMin,N):N,I=I?Math.max(y.terrainElevationMax,N):N}}return y.terrainElevationMin=M||0,y.terrainElevationMax=I||0,y.validForExaggeration=P,y.validForDEMTile=T&&T._demTile?{id:T._demTile.tileID,timestamp:T._dem._timestamp}:{id:void 0,timestamp:0},!0})(c,t,r);(u||p)&&(t.uploaded=!1,t.upload(c.context))}const Ma={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.d8([0,0,0],[o.al,o.al,0])};function Xd(c,t){const r=1<<c.canonical.z,u=t.getFreeCameraOptions().position,p=t.elevation,_=c.canonical.x/r,y=(c.canonical.x+1)/r,b=c.canonical.y/r,T=(c.canonical.y+1)/r;let M=t._centerAltitude;if(p){const O=p.getMinMaxForTile(c);O&&O.max>M&&(M=O.max)}const I=o.aA(u.x,_,y)-u.x,P=o.aA(u.y,b,T)-u.y,z=o.ce(M,t.center.lat)-u.z;return t._zoomFromMercatorZ(Math.sqrt(I*I+P*P+z*z))}function Ju(c,t,r,u,p,_,y){const b=c.context,T=c.renderPass==="shadow",M=c.shadowRenderer,I=T&&M?M.getShadowPassDepthMode():new Ut(b.gl.LEQUAL,Ut.ReadWrite,c.depthRangeFor3D),P=c.isTileAffectedByFog(_),z=c.transform.projection.name==="globe";if(r.meshes)for(const O of r.meshes){const B=z?[]:["MODEL_POSITION_ON_GPU"],N=[];let H,j,Z;const K=!z&&u.instancedDataArray.length>20;K&&B.push("INSTANCED_ARRAYS");const W=Mo(c,t.paint.get("model-cutoff-fade-range"));if(W.shouldRenderCutoff&&B.push("RENDER_CUTOFF"),T&&M)H=c.getOrCreateProgram("modelDepth",{defines:B}),j=Ys(y.shadowTileMatrix,y.shadowTileMatrix,Float32Array.from(r.globalMatrix)),Z=M.getShadowPassColorMode();else{Gc(B,N,O,c,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),H=c.getOrCreateProgram("model",{defines:B,overrideFog:P});const Q=O.material,ce=Q.pbrMetallicRoughness,ie=t.paint.get("model-opacity").constantOr(1),te=t.paint.get("model-emissive-strength").constantOr(0);j=tc(_.expandedProjMatrix,Float32Array.from(r.globalMatrix),new Float32Array(16),null,c,ie,ce.baseColorFactor,Q.emissiveFactor,ce.metallicFactor,ce.roughnessFactor,Q,te,t,p),M&&(y.shadowUniformsInitialized?H.setShadowUniformValues(b,M.getShadowUniformValues()):(M.setupShadows(_.toUnwrapped(),H,"model-tile"),y.shadowUniformsInitialized=!0)),Z=W.shouldRenderCutoff||ie<1||Q.alphaMode!=="OPAQUE"?xi.alphaBlended:xi.unblended}c.uploadCommonUniforms(b,H,_.toUnwrapped(),null,W);const se=O.material.doubleSided?ii.disabled:ii.backCCW;if(K)N.push(u.instancedDataBuffer),H.draw(c,b.gl.TRIANGLES,I,li.disabled,Z,se,j,t.id,O.vertexBuffer,O.indexBuffer,O.segments,t.paint,c.transform.zoom,void 0,N,u.instancedDataArray.length);else{const Q=T?"u_instance":"u_normal_matrix";for(let ce=0;ce<u.instancedDataArray.length;++ce)j[Q]=new Float32Array(u.instancedDataArray.arrayBuffer,64*ce,16),H.draw(c,b.gl.TRIANGLES,I,li.disabled,Z,se,j,t.id,O.vertexBuffer,O.indexBuffer,O.segments,t.paint,c.transform.zoom,void 0,N)}}if(r.children)for(const O of r.children)Ju(c,t,O,u,p,_,y)}const td=[1,-1,1];function id(c,t,r,u){if(!r.modelManager)return!0;const p=r.modelManager;if(!r.shadowRenderer)return!0;const _=r.shadowRenderer,y=t.aabb;let b=!0,T=c.maxHeight;if(T===0){let I=0;for(const P in c.instancesPerModel){const z=p.getModel(P,u);z?I=Math.max(I,Math.max(Math.max(z.aabb.max[0],z.aabb.max[1]),z.aabb.max[2])):b=!1}T=c.maxScale*I*1.41+c.maxVerticalOffset,b&&(c.maxHeight=T)}y.max[2]=T,y.min[2]+=c.terrainElevationMin,y.max[2]+=c.terrainElevationMax,o.af(y.min,y.min,t.tileMatrix),o.af(y.max,y.max,t.tileMatrix);const M=y.intersects(_.getCurrentCascadeFrustum());return r.currentShadowCascade===0&&(c.isInsideFirstShadowMapFrustum=M===2),M===0}function Zc(c,t){const r=c.uniformValues.u_cutoff_params[0],u=c.uniformValues.u_cutoff_params[1],p=c.uniformValues.u_cutoff_params[2],_=c.uniformValues.u_cutoff_params[3];return u===r||_===p?1:o.aA(((t-r)/(u-r)-p)/(_-p),0,1)}function Xc(c,t,r,u){if(t.pitch<20)return 1;const p=t.getWorldToCameraMatrix();o.aB(p,p,c);const _=o.bT(r.min[0],r.min[1],r.min[2],1);let y=o.aC(o.eF(),_,p),b=y,T=y;_[1]=r.max[1],y=o.aC(o.eF(),_,p),b=y[1]<b[1]?y:b,T=y[1]>T[1]?y:T,_[0]=r.max[0],y=o.aC(o.eF(),_,p),b=y[1]<b[1]?y:b,T=y[1]>T[1]?y:T,_[1]=r.min[1],y=o.aC(o.eF(),_,p),b=y[1]<b[1]?y:b,T=y[1]>T[1]?y:T;const M=o.aA(u[0],0,1),I=100*t.pixelsPerMeter*o.aA(u[1],0,1),P=o.aA(u[2],0,1),z=o.eG(o.eF(),b,T,M),O=Math.tan(.5*t.fovX),B=-z[2]*O;if(I===0)return z[1]<-Math.abs(B)?P:1;const N=(-Math.abs(B)-z[1])/I,H=(Z,K,W)=>(1-W)*Z+W*K,j=o.aA(H(1,P,N),P,1);return H(1,j,o.aA((t.pitch-20)/20,0,1))}class Yf{}class Kf{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,r,u){{const P=this._storage.get(r.id);if(P)return P.lastUsedFrameIdx=t,P.buf}const p=u.gl,_=p.getBufferParameter(p.ELEMENT_ARRAY_BUFFER,p.BUFFER_SIZE),y=new ArrayBuffer(_),b=new Int16Array(y);p.getBufferSubData(p.ELEMENT_ARRAY_BUFFER,0,new Int16Array(y));const T=new o.eI;for(let P=0;P<_/2;P+=3){const z=b[P],O=b[P+1],B=b[P+2];T.emplaceBack(z,O),T.emplaceBack(O,B),T.emplaceBack(B,z)}const M=u.bindVertexArrayOES.current,I=new Yf;return I.buf=new Tl(u,T),I.lastUsedFrameIdx=t,this._storage.set(r.id,I),u.bindVertexArrayOES.set(M),I.buf}update(t){for(const[r,u]of this._storage)t-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(r))}destroy(){for(const[t,r]of this._storage)r.buf.destroy(),this._storage.delete(t)}}class Q1{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Jf=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class ep{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class ya{constructor(t,r){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...r,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...r,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const tp=o.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class Qu{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,r){const u=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const y=new o.eJ,b=new o.b0;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(1,1),y.emplaceBack(-1,1),b.emplaceBack(0,1,2),b.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(y,tp.members),this.vignetteIdx=t.context.createIndexBuffer(b)}const p=o.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,u);const y={u_vignetteShape:(_={vignetteShape:[r.start,r.range,Math.pow(10,r.fadePower)],vignetteColor:[r.color.r,r.color.g,r.color.b,r.color.a*r.strength]}).vignetteShape,u_vignetteColor:_.vignetteColor};u.draw(t,t.context.gl.TRIANGLES,Ut.disabled,li.disabled,xi.alphaBlended,ii.disabled,y,"vignette",this.vignetteVx,this.vignetteIdx,p)}var _}}class Ln{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,r){const u=t.getFreeCameraOptions().position,p=u.toAltitude(),_=u.toLngLat(),y=o.an(_.lng),b=o.an(_.lat),T=t.pixelsPerMeter/r,M=y*o.eL,I=o.eL*Math.log(Math.tan(Math.PI/4+b/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const P=-this._offsetYPrev+I,z=-this._elevationPrev+p;this._accumulatedOffsetX+=(-this._offsetXPrev+M)*T,this._accumulatedOffsetY+=P*T,this._accumulatedElevation+=z*T,this._offsetXPrev=M,this._offsetYPrev=I,this._elevationPrev=p}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function zi(c,t){return[-(c[0]-Math.floor(c[0]/t)*t),-(c[1]-Math.floor(c[1]/t)*t),-(c[2]-Math.floor(c[2]/t)*t)]}function $d(c){const t=o.eq(1323123451230),r=[];for(let u=0;u<c;++u){const p=2*t()-1,_=2*t()-1,y=2*t()-1;r.push(o.d4(p,_,y))}return r}function Qa(c,t,r,u,p){const _=o.aA((p-r)/(u-r),0,1);return(1-_)*c+_*t}class El{constructor(t){this._movement=new Ln,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Qu,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,r){const u=t.transform;this._movement.update(u,this._ppmScaleFactor);const p=u.starsProjMatrix,_=o.c6([]);o.c8(_,_,o.an(90)-u._pitch),o.c7(_,_,-u.angle);const y=o.cb(new Float32Array(16),_),b=o.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),T=o.ef([],b),M=o.aB([],T,y),I=Date.now()/1e3;return this._accumulatedTimeFromStart+=(I-this._prevTime)*r,this._prevTime=I,{projectionMatrix:p,modelviewMatrix:M}}}class $c extends El{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new ya(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const u=$d(this.particlesCount),p=new o.eM,_=new o.b0;let y=0;const b=o.eq(1323123451230);for(let T=0;T<u.length;++T){const M=u[T],I=[2*b()-1,b(),b(),b()];p.emplaceBack(M[0],M[1],M[2],-1,-1,...I),p.emplaceBack(M[0],M[1],M[2],1,-1,...I),p.emplaceBack(M[0],M[1],M[2],1,1,...I),p.emplaceBack(M[0],M[1],M[2],-1,1,...I),_.emplaceBack(y+0,y+1,y+2),_.emplaceBack(y+0,y+2,y+3),y+=4}this.particlesVx=r.createVertexBuffer(p,Jf.members),this.particlesIdx=r.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const r=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},u=t.transform.zoom;if(r.revealStart>u)return;const p=Qa(0,1,r.revealStart,r.revealStart+r.revealRange,u);if(!this.particlesVx||!this.particlesIdx)return;const _=structuredClone(this._params);let y=[-_.direction.x,_.direction.y,-100];o.aw(y,y);const b=structuredClone(this._vignetteParams);b.strength*=p,_.overrideStyleParameters||(_.intensity=t.style.rain.state.density,_.timeFactor=t.style.rain.state.intensity,_.color=structuredClone(t.style.rain.state.color),y=structuredClone(t.style.rain.state.direction),_.screenThinning.intensity=t.style.rain.state.centerThinning,_.dropletSizeX=t.style.rain.state.dropletSize[0],_.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],_.distortionStrength=100*t.style.rain.state.distortionStrength,b.strength=1,b.color=structuredClone(t.style.rain.state.vignetteColor));const T=this.updateOnRender(t,_.timeFactor),M=t.context,I=M.gl,P=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new o.T(M,{width:t.width,height:t.height,data:null},I.RGBA8)),_.distortionStrength>0&&(M.activeTexture.set(I.TEXTURE0),this.screenTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),I.copyTexSubImage2D(I.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const z=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(M,z),M.activeTexture.set(I.TEXTURE0),this.screenTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE);const O=[_.color.r,_.color.g,_.color.b,_.color.a],B=(N,H)=>{const j=zi(this._movement.getPosition(),N),Z=_.dropletSizeX,K=_.dropletSizeX*_.dropletSizeYScale,W=t.width/2,se=t.height/2,Q=Qa(0,_.screenThinning.start,0,1,_.screenThinning.intensity),ce=Qa(.001,_.screenThinning.range,0,1,_.screenThinning.intensity),ie=Qa(0,_.screenThinning.particleOffset,0,1,_.screenThinning.intensity),te=(ue={modelview:T.modelviewMatrix,projection:T.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:j,velocityConeAperture:_.velocityConeAperture,velocity:_.velocity,boxSize:N,rainDropletSize:[Z,K],distortionStrength:_.distortionStrength,rainDirection:y,color:O,screenSize:[P.width,P.height],thinningCenterPos:[W,se],thinningShape:[Q,ce,Math.pow(10,_.screenThinning.fadePower)],thinningAffectedRatio:_.screenThinning.affectedRatio,thinningParticleOffset:ie,shapeDirectionalPower:_.shapeDirPower,shapeNormalPower:_.shapeNormalPower,mode:H?0:1},{u_modelview:Float32Array.from(ue.modelview),u_projection:Float32Array.from(ue.projection),u_time:ue.time,u_cam_pos:ue.camPos,u_texScreen:0,u_velocityConeAperture:ue.velocityConeAperture,u_velocity:ue.velocity,u_boxSize:ue.boxSize,u_rainDropletSize:ue.rainDropletSize,u_distortionStrength:ue.distortionStrength,u_rainDirection:ue.rainDirection,u_color:ue.color,u_screenSize:ue.screenSize,u_thinningCenterPos:ue.thinningCenterPos,u_thinningShape:ue.thinningShape,u_thinningAffectedRatio:ue.thinningAffectedRatio,u_thinningParticleOffset:ue.thinningParticleOffset,u_shapeDirectionalPower:ue.shapeDirectionalPower,u_shapeNormalPower:ue.shapeNormalPower,u_mode:ue.mode});var ue;const we=Math.round(_.intensity*this.particlesCount),ve=o.bf.simpleSegment(0,0,4*we,2*we);z.draw(t,I.TRIANGLES,Ut.disabled,li.disabled,xi.alphaBlended,ii.disabled,te,"rain_particles",this.particlesVx,this.particlesIdx,ve)};_.distortionStrength>0&&B(_.boxSize,!0),B(_.boxSize,!1),this._vignette.draw(t,b)}}const tl=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class nd extends El{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new ya(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const u=$d(this.particlesCount),p=new o.eN,_=new o.b0;let y=0;const b=o.eq(1323123451230);for(let T=0;T<u.length;++T){const M=u[T],I=b(),P=b(),z=b(),O=[T/u.length,I,P,z],B=[b(),b()];p.emplaceBack(M[0],M[1],M[2],-1,-1,...O,...B),p.emplaceBack(M[0],M[1],M[2],1,-1,...O,...B),p.emplaceBack(M[0],M[1],M[2],1,1,...O,...B),p.emplaceBack(M[0],M[1],M[2],-1,1,...O,...B),_.emplaceBack(y+0,y+1,y+2),_.emplaceBack(y+0,y+2,y+3),y+=4}this.particlesVx=r.createVertexBuffer(p,tl.members),this.particlesIdx=r.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const r=structuredClone(this._params);let u=[-r.direction.x,r.direction.y,-100];o.aw(u,u);const p=structuredClone(this._vignetteParams),_=r.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},y=t.transform.zoom;if(_.revealStart>y)return;const b=Qa(0,1,_.revealStart,_.revealStart+_.revealRange,y);p.strength*=b,r.overrideStyleParameters||(r.intensity=t.style.snow.state.density,r.timeFactor=t.style.snow.state.intensity,r.color=structuredClone(t.style.snow.state.color),u=structuredClone(t.style.snow.state.direction),r.screenThinning.intensity=t.style.snow.state.centerThinning,r.billboardSize=2.79*t.style.snow.state.flakeSize,p.strength=1,p.color=structuredClone(t.style.snow.state.vignetteColor));const T=this.updateOnRender(t,r.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const M=t.context,I=M.gl,P=t.transform,z=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(M,z),((O,B,N)=>{const H=zi(this._movement.getPosition(),O),j=P.width/2,Z=P.height/2,K=Qa(0,N.screenThinning.start,0,1,N.screenThinning.intensity),W=Qa(.001,N.screenThinning.range,0,1,N.screenThinning.intensity),se=Qa(0,N.screenThinning.particleOffset,0,1,N.screenThinning.intensity),Q=(ce={modelview:T.modelviewMatrix,projection:T.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:H,velocityConeAperture:N.velocityConeAperture,velocity:N.velocity,horizontalOscillationRadius:N.horizontalOscillationRadius,horizontalOscillationRate:N.horizontalOscillationRate,boxSize:O,billboardSize:1*N.billboardSize,simpleShapeParameters:[N.shapeFadeStart,N.shapeFadePower],screenSize:[P.width,P.height],thinningCenterPos:[j,Z],thinningShape:[K,W,Math.pow(10,N.screenThinning.fadePower)],thinningAffectedRatio:N.screenThinning.affectedRatio,thinningParticleOffset:se,color:[N.color.r,N.color.g,N.color.b,N.color.a],direction:u},{u_modelview:Float32Array.from(ce.modelview),u_projection:Float32Array.from(ce.projection),u_time:ce.time,u_cam_pos:ce.camPos,u_velocityConeAperture:ce.velocityConeAperture,u_velocity:ce.velocity,u_horizontalOscillationRadius:ce.horizontalOscillationRadius,u_horizontalOscillationRate:ce.horizontalOscillationRate,u_boxSize:ce.boxSize,u_billboardSize:ce.billboardSize,u_simpleShapeParameters:ce.simpleShapeParameters,u_screenSize:ce.screenSize,u_thinningCenterPos:ce.thinningCenterPos,u_thinningShape:ce.thinningShape,u_thinningAffectedRatio:ce.thinningAffectedRatio,u_thinningParticleOffset:ce.thinningParticleOffset,u_particleColor:ce.color,u_direction:ce.direction});var ce;const ie=Math.round(N.intensity*this.particlesCount),te=o.bf.simpleSegment(0,0,4*ie,2*ie);this.particlesVx&&this.particlesIdx&&z.draw(t,I.TRIANGLES,Ut.disabled,li.disabled,xi.alphaBlended,ii.disabled,Q,"snow_particles",this.particlesVx,this.particlesIdx,te)})(r.boxSize,0,r),this._vignette.draw(t,p)}}const Wd={symbol:function(c,t,r,u,p){if(c.renderPass!=="translucent")return;const _=li.disabled,y=c.colorModeForRenderPass(),b=r.layout.get("text-variable-anchor"),T=r.layout.get("text-size-scale-range"),M=o.aA(c.scaleFactor,T[0],T[1]);b&&(function(z,O,B,N,H,j,Z,K){const W=O.transform,se=H==="map",Q=j==="map";for(const ce of z){const ie=N.getTile(ce),te=ie.getBucket(B);if(!te||!te.text||!te.text.segments.get().length)continue;const ue=o.bJ(te.textSizeData,W.zoom,K),we=Td(ce,te.getProjection(),W),ve=W.calculatePixelsToTileUnitsMatrix(ie),Oe=vc(we,ie.tileID.canonical,Q,se,W,te.getProjection(),ve),ze=te.hasIconTextFit()&&te.hasIconData();ue&&Yh(te,se,Q,Z,W,Oe,ce,Math.pow(2,W.zoom-ie.tileID.overscaledZ),ue,ze)}})(u,c,r,t,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),p,M);const I=r.paint.get("icon-opacity").constantOr(1)!==0,P=r.paint.get("text-opacity").constantOr(1)!==0;r.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(I||P)?Ko(c,t,r,u,_,y):(I&&Ko(c,t,r,u,_,y,{onlyIcons:!0}),P&&Ko(c,t,r,u,_,y,{onlyText:!0})),t.map.showCollisionBoxes&&(La(c,t,r,u,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),La(c,t,r,u,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(c,t,r,u){if(c.renderPass!=="translucent")return;const p=r.paint.get("circle-opacity"),_=r.paint.get("circle-stroke-width"),y=r.paint.get("circle-stroke-opacity"),b=r.layout.get("circle-sort-key").constantOr(1)!==void 0,T=r.paint.get("circle-emissive-strength");if(p.constantOr(1)===0&&(_.constantOr(1)===0||y.constantOr(1)===0))return;const M=c.context,I=M.gl,P=c.transform,z=!(!c.terrain||!c.terrain.enabled),O=r.layout.get("circle-elevation-reference"),B=c.depthModeForSublayer(0,Ut.ReadOnly),N=new Ut(c.context.gl.LEQUAL,Ut.ReadOnly,c.depthRangeFor3D),H=O==="none"||z?B:N,j=li.disabled,Z=c.colorModeForDrapableLayerRenderPass(T),K=P.projection.name==="globe",W=[o.aF(P.center.lng),o.aJ(P.center.lat)],se=[];for(let ce=0;ce<u.length;ce++){const ie=u[ce],te=t.getTile(ie),ue=te.getBucket(r);if(!ue||ue.projection.name!==P.projection.name)continue;const we=ue.programConfigurations.get(r.id),ve=ue.layoutVertexBuffer,Oe=ue.globeExtVertexBuffer,ze=ue.indexBuffer,je=o.d$(r),lt=[Oe],Me=c.isTileAffectedByFog(ie);K&&je.push("PROJECTION_GLOBE_VIEW"),je.push("DEPTH_D24"),c.terrain&&P.depthOcclusionForSymbolsAndCircles&&je.push("DEPTH_OCCLUSION"),ue.hasElevation&&!c.terrain&&(je.push("ELEVATED_ROADS"),lt.push(ue.elevatedLayoutVertexBuffer));const ge=c.getOrCreateProgram("circle",{config:we,defines:je,overrideFog:Me}),Ge=P.projection.createInversionMatrix(P,ie.canonical),Re={programConfiguration:we,program:ge,layoutVertexBuffer:ve,dynamicBuffers:lt,indexBuffer:ze,uniformValues:o.e0(c,ie,te,Ge,W,r),tile:te};if(b){const it=ue.segments.get();for(const Je of it)se.push({segments:new o.bf([Je]),sortKey:Je.sortKey,state:Re})}else se.push({segments:ue.segments,sortKey:0,state:Re})}b&&se.sort(((ce,ie)=>ce.sortKey-ie.sortKey));const Q={useDepthForOcclusion:P.depthOcclusionForSymbolsAndCircles};for(const ce of se){const{programConfiguration:ie,program:te,layoutVertexBuffer:ue,dynamicBuffers:we,indexBuffer:ve,uniformValues:Oe,tile:ze}=ce.state,je=ce.segments;c.terrain&&c.terrain.setupElevationDraw(ze,te,Q),c.uploadCommonUniforms(M,te,ze.tileID.toUnwrapped()),te.draw(c,I.TRIANGLES,H,j,Z,ii.disabled,Oe,r.id,ue,ve,je,r.paint,P.zoom,ie,we)}},heatmap:function(c,t,r,u){if(r.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const p=c.context,_=p.gl,y=li.disabled,b=new xi([_.ONE,_.ONE,_.ONE,_.ONE],o.ao.transparent,[!0,!0,!0,!0]);(function(O,B,N,H){const j=O.gl,Z=B.width*H,K=B.height*H;O.activeTexture.set(j.TEXTURE1),O.viewport.set([0,0,Z,K]);let W=N.heatmapFbo;if(!W||W&&(W.width!==Z||W.height!==K)){W&&W.destroy();const se=j.createTexture();j.bindTexture(j.TEXTURE_2D,se),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),W=N.heatmapFbo=O.createFramebuffer(Z,K,!0,null),(function(Q,ce,ie,te,ue,we){const ve=Q.gl;ve.texImage2D(ve.TEXTURE_2D,0,Q.extRenderToTextureHalfFloat?ve.RGBA16F:ve.RGBA,ue,we,0,ve.RGBA,Q.extRenderToTextureHalfFloat?ve.HALF_FLOAT:ve.UNSIGNED_BYTE,null),te.colorAttachment.set(ie)})(O,0,se,W,Z,K)}else j.bindTexture(j.TEXTURE_2D,W.colorAttachment.get()),O.bindFramebuffer.set(W.framebuffer)})(p,c,r,c.transform.projection.name==="globe"?.5:.25),p.clear({color:o.ao.transparent});const T=c.transform,M=T.projection.name==="globe",I=M?["PROJECTION_GLOBE_VIEW"]:[],P=M?ii.frontCCW:ii.disabled,z=[o.aF(T.center.lng),o.aJ(T.center.lat)];for(let O=0;O<u.length;O++){const B=u[O];if(t.hasRenderableParent(B))continue;const N=t.getTile(B),H=N.getBucket(r);if(!H||H.projection.name!==T.projection.name)continue;const j=c.isTileAffectedByFog(B),Z=H.programConfigurations.get(r.id),K=c.getOrCreateProgram("heatmap",{config:Z,defines:I,overrideFog:j}),{zoom:W}=c.transform;c.terrain&&c.terrain.setupElevationDraw(N,K),c.uploadCommonUniforms(p,K,B.toUnwrapped());const se=T.projection.createInversionMatrix(T,B.canonical);K.draw(c,_.TRIANGLES,Ut.disabled,y,b,P,Zh(c,B,N,se,z,W,r.paint.get("heatmap-intensity")),r.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,r.paint,c.transform.zoom,Z,M?[H.globeExtVertexBuffer]:null)}p.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),(function(p,_){const y=p.context,b=y.gl,T=_.heatmapFbo;if(!T)return;y.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,T.colorAttachment.get()),y.activeTexture.set(b.TEXTURE1);let M=_.colorRampTexture;M||(M=_.colorRampTexture=new o.T(y,_.colorRamp,b.RGBA8)),M.bind(b.LINEAR,b.CLAMP_TO_EDGE),p.getOrCreateProgram("heatmapTexture").draw(p,b.TRIANGLES,Ut.disabled,li.disabled,p.colorModeForRenderPass(),ii.disabled,((I,P,z,O)=>({u_image:0,u_color_ramp:1,u_opacity:P.paint.get("heatmap-opacity")}))(0,_),_.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,_.paint,p.transform.zoom)})(c,r))},line:function(c,t,r,u){if(c.renderPass!=="translucent")return;const p=r.paint.get("line-opacity"),_=r.paint.get("line-width");if(p.constantOr(1)===0||_.constantOr(1)===0)return;const y=r.paint.get("line-emissive-strength"),b=r.paint.get("line-occlusion-opacity"),T=r.layout.get("line-elevation-reference"),M=r.layout.get("line-width-unit")==="meters",I=T==="sea",P=!(!c.terrain||!c.terrain.enabled),z=c.context,O=z.gl;if(r.hasElevatedBuckets&&c.transform.projection.name==="globe")return;const B=r.layout.get("line-cross-slope"),N=B!==void 0,H=B<1,j=c.colorModeForDrapableLayerRenderPass(y),Z=c.terrain&&c.terrain.renderingToTexture,K=Z?1:o.o.devicePixelRatio,W=r.paint.get("line-dasharray"),se=W.constantOr(1),Q=r.layout.get("line-cap"),ce=W.constantOr(null),ie=Q.constantOr(null),te=r.paint.get("line-pattern"),ue=te.constantOr(1),we=r.paint.get("line-pattern-cross-fade"),ve=te.constantOr(null),Oe=r.paint.get("line-opacity").constantOr(1);let ze=!ue&&Oe!==1||c.depthOcclusion&&b>0&&b<1;const je=r.paint.get("line-gradient"),lt=ue?"linePattern":"line",Me=o.e1(r);let ge;if(Z&&c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(ze=!1),b!==0&&c.depthOcclusion){const Je=r.paint._values["line-opacity"];Je&&Je.value&&Je.value.kind==="constant"?ge=Je.value:o.w(`Occlusion opacity for layer ${r.id} is supported only when line-opacity isn't data-driven.`)}_.value.kind!=="constant"&&_.value.isLineProgressConstant===!1&&Me.push("VARIABLE_LINE_WIDTH");const Ge=(Je,vt,Ze,$e,xt,Mt)=>{for(const St of Je){const Rt=t.getTile(St);if(ue&&!Rt.patternsLoaded())continue;const Kt=Rt.getBucket(r);if(!Kt||Kt.elevationType!=="none"&&!xt||Kt.elevationType==="none"&&xt)continue;c.prepareDrawTile();const Ti=[...vt],fi=c.shadowRenderer,Qi=Kt.elevationType==="road"&&!!fi&&fi.enabled;let Qt=[0,0,0];if(Qi){const $t=c.style.directionalLight,Ri=c.style.ambientLight;$t&&Ri&&(Qt=Pa(c.style,$t,Ri)),Ti.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Ni=Kt.programConfigurations.get(r.id);let oi=!1;if(ve&&Rt.imageAtlas){const $t=o.e2.from(ve),Ri=$t.getPrimary().scaleSelf(K).toString(),Dn=Rt.imageAtlas.patternPositions.get(Ri),kn=$t.getSecondary(),Wn=kn?Rt.imageAtlas.patternPositions.get(kn.scaleSelf(K).toString()):null;oi=!!Dn&&!!Wn,Dn&&Ni.setConstantPatternPositions(Dn,Wn)}we>0&&(oi||Ni.getPatternTransitionVertexBuffer("line-pattern"))&&Ti.push("LINE_PATTERN_TRANSITION");const en=c.isTileAffectedByFog(St),Fi=c.getOrCreateProgram(lt,{config:Ni,defines:Ti,overrideFog:en});if(!ue&&ce&&ie&&Rt.lineAtlas){const $t=Rt.lineAtlas.getDash(ce,ie);$t&&Ni.setConstantPatternPositions($t)}Qi&&fi.setupShadows(Rt.tileID.toUnwrapped(),Fi,"vector-tile");let[Zi,Xi]=r.paint.get("line-trim-offset");(ie==="round"||ie==="square")&&Zi!==Xi&&(Zi===0&&(Zi-=1),Xi===1&&(Xi+=1));const yi=Z?St.projMatrix:null,an=M?1/Kt.tileToMeter/o.ay(Rt,1,c.transform.zoom):1,Si=M?1/Kt.tileToMeter/o.ay(Rt,1,Math.floor(c.transform.zoom)):1,Mn=ue?o.e3(c,Rt,r,yi,K,an,Si,[Zi,Xi],Qt,we):o.e4(c,Rt,r,yi,Kt.lineClipsArray.length,K,an,Si,[Zi,Xi],Qt);if(je){const $t=Kt.gradients[r.id];let Ri=$t.texture;if(r.gradientVersion!==$t.version){let Dn=256;if(r.stepInterpolant){const kn=t.getSource().maxzoom,Wn=St.canonical.z===kn?Math.ceil(1<<c.transform.maxZoom-St.canonical.z):1;Dn=o.aA(o.e5(Kt.maxLineLength/o.al*1024*Wn),256,z.maxTextureSize)}$t.gradient=o.e6({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:Dn,image:$t.gradient||void 0,clips:Kt.lineClipsArray}),$t.texture?$t.texture.update($t.gradient):$t.texture=new o.T(z,$t.gradient,O.RGBA8),$t.version=r.gradientVersion,Ri=$t.texture}z.activeTexture.set(O.TEXTURE1),Ri.bind(r.stepInterpolant?O.NEAREST:O.LINEAR,O.CLAMP_TO_EDGE)}se&&(z.activeTexture.set(O.TEXTURE0),Rt.lineAtlasTexture&&Rt.lineAtlasTexture.bind(O.LINEAR,O.REPEAT),Ni.updatePaintBuffers()),ue&&(z.activeTexture.set(O.TEXTURE0),Rt.imageAtlasTexture&&Rt.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Ni.updatePaintBuffers()),xt&&!I&&c.terrain.setupElevationDraw(Rt,Fi),c.uploadCommonUniforms(z,Fi,St.toUnwrapped());const Vi=$t=>{ge!=null&&(ge.value=Oe*b),Fi.draw(c,O.TRIANGLES,Ze,$t,j,ii.disabled,Mn,r.id,Kt.layoutVertexBuffer,Kt.indexBuffer,Kt.segments,r.paint,c.transform.zoom,Ni,[Kt.layoutVertexBuffer2,Kt.patternVertexBuffer,Kt.zOffsetVertexBuffer]),ge!=null&&(ge.value=Oe)};if(ze&&!xt){const $t=c.stencilModeForClipping(St).ref;$t===0&&Z&&z.clear({stencil:0});const Ri={func:O.EQUAL,mask:255};Mn.u_alpha_discard_threshold=.8,Vi(new li(Ri,$t,255,O.KEEP,O.KEEP,O.INVERT)),Mn.u_alpha_discard_threshold=0,Vi(new li(Ri,$t,255,O.KEEP,O.KEEP,O.KEEP))}else Mn.u_alpha_discard_threshold=ze&&xt&&Mt?.8:0,Vi(xt?$e:c.stencilModeForClipping(St))}};let Re=c.depthModeForSublayer(0,Ut.ReadOnly);const it=new Ut(c.depthOcclusion?O.GREATER:O.LEQUAL,Ut.ReadOnly,c.depthRangeFor3D);if(r.hasNonElevatedBuckets){const Je=!Z&&c.terrain;b!==0&&Je?o.w(`Occlusion opacity for layer ${r.id} is supported on terrain only if the layer has line-z-offset enabled.`):Je?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${r.id}.`):Ge(u,Me,Re,li.disabled,!1,!0)}if(r.hasElevatedBuckets){T==="hd-road-markup"?P||(Re=it,Me.push("ELEVATED_ROADS")):(Me.push("ELEVATED"),Re=it,N&&Me.push(H?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),I&&Me.push("ELEVATION_REFERENCE_SEA"));const Je=ze?c.stencilModeFor3D():li.disabled;c.forceTerrainMode=!0,Ge(u,Me,Re,Je,!0,!0),ze&&Ge(u,Me,Re,Je,!0,!1),c.forceTerrainMode=!1}ze&&(c.resetStencilClippingMasks(),Z&&z.clear({stencil:0})),b===0||c.depthOcclusion||Z||c.layersWithOcclusionOpacity.push(c.currentLayer)},fill:function(c,t,r,u){const p=r.paint.get("fill-color"),_=r.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const y=r.paint.get("fill-emissive-strength"),b=c.colorModeForDrapableLayerRenderPass(y),T=r.paint.get("fill-pattern"),M=c.opaquePassEnabledForLayer()&&!T.constantOr(1)&&p.constantOr(o.ao.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";let I="none";r.layout.get("fill-elevation-reference")!=="none"?I="road":r.paint.get("fill-z-offset").constantOr(1)!==0&&(I="offset");const P=!(!c.terrain||!c.terrain.enabled),z={painter:c,sourceCache:t,layer:r,coords:u,colorMode:b,elevationType:I,terrainEnabled:P,pass:M};if(c.renderPass!=="shadow")if(I!=="offset"){if(po(z,!1),I==="road"){const O=!P&&c.renderPass==="translucent";O&&Js(c,t,r,u,"geometry"),po(z,!0,li.disabled),O&&(function(B){const{painter:N,sourceCache:H,layer:j,coords:Z,colorMode:K}=B,W=N.context.gl,se=B.painter.shadowRenderer,Q=!!se&&se.enabled,ce=new Ut(N.context.gl.LEQUAL,Ut.ReadOnly,N.depthRangeFor3D);let ie=[0,0,0];if(Q){const ue=N.style.directionalLight,we=N.style.ambientLight;ue&&we&&(ie=Pa(N.style,ue,we))}const te=ue=>{for(const we of Z){const ve=H.getTile(we),Oe=ve.getBucket(j);if(!Oe)continue;const ze=Oe.elevatedStructures;if(!ze)continue;let je,lt;if(ue?(je=ze.renderableBridgeSegments,lt=ze.bridgeProgramConfigurations.get(j.id)):(je=ze.renderableTunnelSegments,lt=ze.tunnelProgramConfigurations.get(j.id)),!je||je.segments[0].primitiveLength===0)continue;lt.updatePaintBuffers(),N.prepareDrawTile();const Me=N.isTileAffectedByFog(we),ge=[];Q&&ge.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Ge=N.getOrCreateProgram("elevatedStructures",{config:lt,overrideFog:Me,defines:ge}),Re=N.translatePosMatrix(we.projMatrix,ve,j.paint.get("fill-translate"),j.paint.get("fill-translate-anchor"));Q&&se.setupShadows(ve.tileID.toUnwrapped(),Ge,"vector-tile");const it=X1(Re,ie);N.uploadCommonUniforms(N.context,Ge,we.toUnwrapped()),Ge.draw(N,W.TRIANGLES,ce,li.disabled,K,ii.backCCW,it,j.id,ze.vertexBuffer,ze.indexBuffer,je,j.paint,N.transform.zoom,lt,[ze.vertexBufferNormal])}};te(!0),te(!1)})(z)}}else po(z,!1,c.stencilModeFor3D());else c.shadowRenderer&&I==="road"&&!P&&(function(O){const{painter:B,sourceCache:N,layer:H,coords:j}=O,Z=B.context.gl,K=O.painter.shadowRenderer;for(const W of j){const se=N.getTile(W),Q=se.getBucket(H);if(!Q)continue;const ce=Q.elevatedStructures;if(!ce||!ce.shadowCasterSegments||ce.shadowCasterSegments.segments[0].primitiveLength===0)continue;B.prepareDrawTile();const ie=Q.bufferData.programConfigurations.get(H.id),te=B.isTileAffectedByFog(W),ue=B.getOrCreateProgram("elevatedStructuresDepth",{config:ie,overrideFog:te}),we=K.calculateShadowPassMatrixFromTile(se.tileID.toUnwrapped());B.uploadCommonUniforms(B.context,ue,W.toUnwrapped());const ve={u_matrix:we,u_depth_bias:0};ue.draw(B,Z.TRIANGLES,K.getShadowPassDepthMode(),li.disabled,K.getShadowPassColorMode(),ii.disabled,ve,H.id,ce.vertexBuffer,ce.indexBuffer,ce.shadowCasterSegments,H.paint,B.transform.zoom,ie)}})(z)},"fill-extrusion":function(c,t,r,u){const p=r.paint.get("fill-extrusion-opacity"),_=c.context,y=_.gl,b=c.terrain,T=b&&b.renderingToTexture;if(p===0)return;const M=c.conflationActive&&c.style.isLayerClipped(r,t.getSource()),I=c.style.order.indexOf(r.fqid);if(M&&(function(P,z,O,B,N){for(const H of B){const j=z.getTile(H).getBucket(O);j&&(j.updateReplacement(H,P.replacementSource,N),j.uploadCentroid(P.context))}})(c,t,r,u,I),b||M)for(const P of u){const z=t.getTile(P).getBucket(r);z&&ms(c.context,t,P,z,r,b,M)}if(c.renderPass==="shadow"&&c.shadowRenderer){const P=c.shadowRenderer;if(b&&p<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ad)return;const z=P.getShadowPassDepthMode(),O=P.getShadowPassColorMode();st(c,t,r,u,z,li.disabled,O,M)}else if(c.renderPass==="translucent"){const P=!r.paint.get("fill-extrusion-pattern").constantOr(1),z=r.paint.get("fill-extrusion-color").constantOr(o.ao.white);if(!T&&z.a!==0){const O=new Ut(c.context.gl.LEQUAL,Ut.ReadWrite,c.depthRangeFor3D);p===1&&P?st(c,t,r,u,O,li.disabled,xi.unblended,M):(st(c,t,r,u,O,li.disabled,xi.disabled,M),st(c,t,r,u,O,c.stencilModeFor3D(),c.colorModeForRenderPass(),M),c.resetStencilClippingMasks())}if(c.style.enable3dLights()&&P&&(!b&&c.transform.projection.name!=="globe"||T)){const O=r.paint.get("fill-extrusion-opacity"),B=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),N=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),H=r.paint.get("fill-extrusion-flood-light-intensity"),j=r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Z=r.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(j?null:r.lut).toArray01().slice(0,3),K=B>0&&N>0,W=H>0,se=(ie,te,ue)=>(1-ue)*ie+ue*te,Q=new yr;Q.translate=r.paint.get("fill-extrusion-translate"),Q.translateAnchor=r.paint.get("fill-extrusion-translate-anchor"),Q.edgeRadius=r.layout.get("fill-extrusion-edge-radius"),Q.cutoffFadeRange=r.paint.get("fill-extrusion-cutoff-fade-range");const ce=ie=>{const te=c.depthModeForSublayer(1,Ut.ReadOnly,y.LEQUAL,!0),ue=r.paint.get(ie?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),we=se(.1,3,ue),ve=c._showOverdrawInspector;if(!ve){const Oe=new li({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),ze=new xi([y.ONE,y.ONE,y.ONE,y.ONE],o.ao.transparent,[!1,!1,!1,!0],y.MIN);Ar(Q,c,t,r,u,te,Oe,ze,ii.disabled,ie,"sdf",O,B,N,H,Z,we,M,!1)}{const Oe=ve?li.disabled:new li({func:y.EQUAL,mask:255},255,255,y.KEEP,y.DECR,y.DECR),ze=ve?c.colorModeForRenderPass():new xi([y.ONE_MINUS_DST_ALPHA,y.DST_ALPHA,y.ONE,y.ONE],o.ao.transparent,[!0,!0,!0,!0]);Ar(Q,c,t,r,u,te,Oe,ze,ii.disabled,ie,"color",O,B,N,H,Z,we,M,!1)}};if(T){const ie=(te,ue,we)=>{const ve=c.depthModeForSublayer(1,Ut.ReadOnly,y.LEQUAL,!1),Oe=r.paint.get(te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ze=se(.1,3,Oe);{const je=new xi([y.ONE,y.ONE,y.ONE,y.ONE],o.ao.transparent,[!1,!1,!1,!0]);Ar(Q,c,t,r,u,ve,li.disabled,je,ii.disabled,te,"clear",O,B,N,H,Z,ze,M,ue)}{const je=new li({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),lt=new xi([y.ONE,y.ONE,y.ONE,y.ONE],o.ao.transparent,[!1,!1,!1,!0],y.MIN);Ar(Q,c,t,r,u,ve,je,lt,ii.disabled,te,"sdf",O,B,N,H,Z,ze,M,ue)}{const je=te?y.ZERO:y.ONE_MINUS_DST_ALPHA,lt=new li({func:y.EQUAL,mask:255},255,255,y.KEEP,y.DECR,y.DECR),Me=new xi([je,y.DST_ALPHA,y.ONE_MINUS_DST_ALPHA,y.ZERO],o.ao.transparent,[!0,!0,!0,!0]);Ar(Q,c,t,r,u,ve,lt,Me,ii.disabled,te,"color",O,B,N,H,Z,ze,M,ue)}{const je=new xi([y.ONE,y.ONE,y.ONE,te?y.ZERO:y.ONE],o.ao.transparent,[!1,!1,!1,!0],te?y.FUNC_ADD:y.MAX);Ar(Q,c,t,r,u,ve,li.disabled,je,ii.disabled,te,"clear",O,B,N,H,Z,ze,M,ue,we)}};if(K||W){let te;if(c.prepareDrawTile(),b){const ue=b.drapeBufferSize[0],we=b.drapeBufferSize[1];te=b.framebufferCopyTexture,te&&(!te||te.size[0]===ue&&te.size[1]===we)||(te&&te.destroy(),te=b.framebufferCopyTexture=new o.T(_,new o.q({width:ue,height:we}),y.RGBA8)),te.bind(y.LINEAR,y.CLAMP_TO_EDGE),y.copyTexSubImage2D(y.TEXTURE_2D,0,0,0,0,0,ue,we)}K&&ie(!0,!1,te),W&&ie(!1,!0,te)}}else K&&ce(!0),W&&ce(!1),(K||W)&&c.resetStencilClippingMasks()}}},building:function(c,t,r,u){c.currentLayer<c.firstLightBeamLayer&&(c.firstLightBeamLayer=c.currentLayer);const p=r.paint.get("building-ambient-occlusion-ground-intensity"),_=r.paint.get("building-ambient-occlusion-ground-radius"),y=r.paint.get("building-ambient-occlusion-ground-attenuation"),b=r.paint.get("building-opacity");if(b<=0)return;let T=p>0&&_>0,M=!0;const I=r.paint.get("building-vertical-scale");if(I<=0)return;(!c.shadowRenderer||I<1)&&(M=!1);const P=c.conflationActive&&c.style.isLayerClipped(r,t.getSource()),z=c.style.order.indexOf(r.fqid);if((function(O,B,N,H,j,Z){for(const K of Z){const W=B.getTile(K).getBucket(N);W&&(j&&W.updateReplacement(K,O.replacementSource,H),W.uploadUpdatedIndexBuffer(O.context))}})(c,t,r,z,P,u),(function(O,B,N,H){for(const j of H){const Z=B.getTile(j).getBucket(N);Z&&Z.needsEvaluation()&&Z.uploadUpdatedColorBuffer(O.context)}})(c,t,r,u),r.resetLayerRenderingStats(c),c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!0),c.renderPass==="shadow"&&c.shadowRenderer){const O=c.shadowRenderer,B=[],N=O.getShadowPassDepthMode();Sl({painter:c,source:t,layer:r,coords:u,defines:B,blendMode:O.getShadowPassColorMode(),depthMode:N,opacity:b,verticalScale:I,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(c.renderPass==="translucent"){let O=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];M&&(O=O.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),c.shadowRenderer&&c.shadowRenderer.useNormalOffset&&(O=O.concat("NORMAL_OFFSET"));const B=r.paint.get("building-facade-emissive-chance"),N=r.paint.get("building-ambient-occlusion-intensity"),H=r.paint.get("building-flood-light-intensity"),j=r.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",Z=r.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(j?null:r.lut).toArray01().slice(0,3),K=r.paint.get("building-flood-light-ground-attenuation"),W=H>0,se=new Ut(c.context.gl.LEQUAL,Ut.ReadWrite,c.depthRangeFor3D);b<1&&Sl({painter:c,source:t,layer:r,coords:u,defines:O,blendMode:xi.disabled,depthMode:se,opacity:b,verticalScale:I,facadeEmissiveChance:B,facadeAOIntensity:N,floodLightIntensity:H,floodLightColor:Z,depthOnly:!0});const Q=c.colorModeForRenderPass();Sl({painter:c,source:t,layer:r,coords:u,defines:O,blendMode:Q,depthMode:se,opacity:b,verticalScale:I,facadeEmissiveChance:B,facadeAOIntensity:N,floodLightIntensity:H,floodLightColor:Z}),T&&jd(c,t,r,u,!0,b,p,_,H,Z,y,P),W&&jd(c,t,r,u,!1,b,p,_,H,Z,K,P)}else if(c.renderPass==="light-beam"){const O=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],B=new Ut(c.context.gl.LEQUAL,Ut.ReadOnly,c.depthRangeFor3D);Sl({painter:c,source:t,layer:r,coords:u,defines:O,blendMode:xi.alphaBlended,depthMode:B,opacity:b,verticalScale:I,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!1),c.resetStencilClippingMasks()},hillshade:function(c,t,r,u){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent"||c.style.disableElevatedTerrain)return;const p=c.context,_=c.terrain&&c.terrain.renderingToTexture,[y,b]=c.renderPass!=="translucent"||_?[{},u]:c.stencilConfigForOverlap(u);for(const T of b){const M=t.getTile(T);if(M.needsHillshadePrepare&&c.renderPass==="offscreen")Z1(c,M,r);else if(c.renderPass==="translucent"){const I=c.depthModeForSublayer(0,Ut.ReadOnly),P=r.paint.get("hillshade-emissive-strength"),z=c.colorModeForDrapableLayerRenderPass(P),O=_&&c.terrain?c.terrain.stencilModeForRTTOverlap(T):y[T.overscaledZ];Pc(c,T,M,r,I,O,z)}}p.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,t,r,u,p,_){if(c.renderPass!=="translucent"||r.paint.get("raster-opacity")===0)return;const y=c.transform.projection.name==="globe",b=r.paint.get("raster-elevation")!==0,T=b&&y;if(c.renderElevatedRasterBackface&&!T)return;const M=c.context,I=M.gl,P=t.getSource(),z=(function(Q,ce,ie,te){const ue=ce.paint.get("raster-color"),we=Q.type==="raster-array",ve=[],Oe=ce.paint.get("raster-resampling"),ze=ce.paint.get("raster-color-mix");let je=ce.paint.get("raster-color-range");const lt=[ze[0],ze[1],ze[2],0],Me=ze[3];let ge=Oe==="nearest"?te.NEAREST:te.LINEAR;if(we&&(ve.push("RASTER_ARRAY"),ue||ve.push("RASTER_COLOR"),Oe==="linear"&&ve.push("RASTER_ARRAY_LINEAR"),ge=te.NEAREST,!je&&Q.rasterLayers)){const Ge=Q.rasterLayers.find((({id:Re})=>Re===ce.sourceLayer));Ge&&Ge.fields&&Ge.fields.range&&(je=Ge.fields.range)}if(je=je||[0,1],ue){ve.push("RASTER_COLOR"),ie.activeTexture.set(te.TEXTURE2),ce.updateColorRamp(je);let Ge=ce.colorRampTexture;Ge||(Ge=ce.colorRampTexture=new o.T(ie,ce.colorRamp,te.RGBA8)),Ge.bind(te.LINEAR,te.CLAMP_TO_EDGE)}return{mix:lt,range:je,offset:Me,defines:ve,resampling:ge}})(P,r,M,I);if(P instanceof o.aT&&!u.length&&!y)return;const O=r.paint.get("raster-emissive-strength"),B=c.colorModeForDrapableLayerRenderPass(O),N=c.terrain&&c.terrain.renderingToTexture,H=!c.options.moving,j=r.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;if(P instanceof o.aT&&!u.length&&(P.onNorthPole||P.onSouthPole)){const Q=b?c.stencilModeFor3D():li.disabled;return void Kh(!!P.onNorthPole,null,c,t,r,O,z,ii.disabled,Q)}if(!u.length)return;const[Z,K]=P instanceof o.aT||N?[{},u]:c.stencilConfigForOverlap(u),W=K[K.length-1].overscaledZ;T&&z.defines.push("PROJECTION_GLOBE_VIEW"),b&&z.defines.push("RENDER_CUTOFF");const se=(Q,ce,ie)=>{for(const te of Q){const ue=te.toUnwrapped(),we=t.getTile(te);if(N&&(!we||!we.hasData()))continue;M.activeTexture.set(I.TEXTURE0);const ve=W1(we,P,r,z);if(!ve||!ve.texture)continue;const{texture:Oe,mix:ze,offset:je,tileSize:lt,buffer:Me}=ve;let ge,Ge;N?(ge=Ut.disabled,Ge=te.projMatrix):b?(ge=new Ut(I.LEQUAL,Ut.ReadWrite,c.depthRangeFor3D),Ge=y?Float32Array.from(c.transform.expandedFarZProjMatrix):c.transform.calculateProjMatrix(ue,H)):(ge=c.depthModeForSublayer(te.overscaledZ-W,r.paint.get("raster-opacity")===1?Ut.ReadWrite:Ut.ReadOnly,I.LESS),Ge=c.transform.calculateProjMatrix(ue,H));const Re=c.terrain&&N?c.terrain.stencilModeForRTTOverlap(te):Z[te.overscaledZ],it=_?0:r.paint.get("raster-fade-duration");we.registerFadeDuration(it);const Je=t.findLoadedParent(te,0),vt=Fd(we,Je,t,c.transform,it);let Ze,$e;!vt.isFading&&we.refreshedUponExpiration&&(we.refreshedUponExpiration=!1),c.terrain&&c.terrain.prepareDrawTile(),M.activeTexture.set(I.TEXTURE0),Oe.bind(j,I.CLAMP_TO_EDGE),M.activeTexture.set(I.TEXTURE1),Je?(Je.texture&&Je.texture.bind(j,I.CLAMP_TO_EDGE),Ze=Math.pow(2,Je.tileID.overscaledZ-we.tileID.overscaledZ),$e=[we.tileID.canonical.x*Ze%1,we.tileID.canonical.y*Ze%1]):Oe.bind(j,I.CLAMP_TO_EDGE),"useMipmap"in Oe&&M.extTextureFilterAnisotropic&&c.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const xt=c.transform;let Mt;const St=b?Gd(xt):[0,0,0,0];let Rt,Kt,Ti,fi,Qi,Qt=0;if(T&&P instanceof o.aT&&P.coordinates.length>3)Rt=Float32Array.from(o.bj(o.dI(new o.cC(0,0,0)))),Kt=Float32Array.from(xt.globeMatrix),Ti=Float32Array.from(o.dE(xt)),fi=[o.aF(xt.center.lng),o.aJ(xt.center.lat)],Mt=P.elevatedGlobePerspectiveTransform,Qi=P.elevatedGlobeGridMatrix||new Float32Array(9);else if(T){const Fi=o.dF(te.canonical);Qt=o.dG(Fi.getCenter().lat),Rt=Float32Array.from(o.bj(o.dI(te.canonical))),Kt=Float32Array.from(xt.globeMatrix),Ti=Float32Array.from(o.dE(xt)),fi=[o.aF(xt.center.lng),o.aJ(xt.center.lat)],Mt=[0,0],Qi=Float32Array.from(o.dH(te.canonical,Fi,Qt,xt.worldSize/xt._pixelsPerMercatorPixel))}else Mt=P instanceof o.aT?P.perspectiveTransform:[0,0],Rt=new Float32Array(16),Kt=new Float32Array(9),Ti=new Float32Array(16),fi=[0,0],Qi=new Float32Array(9);const Ni=Gu(Ge,Rt,Kt,Ti,Qi,$e||[0,0],o.aj(c.transform.zoom),fi,St,Ze||1,vt,r,Mt,b?r.paint.get("raster-elevation"):0,2,ze,je,z.range,lt,Me,O),oi=c.isTileAffectedByFog(te),en=c.getOrCreateProgram("raster",{defines:z.defines,overrideFog:oi});if(c.uploadCommonUniforms(M,en,ue),P instanceof o.aT){const Fi=P.elevatedGlobeVertexBuffer,Zi=P.elevatedGlobeIndexBuffer;if(N||!y)P.boundsBuffer&&P.boundsSegments&&en.draw(c,I.TRIANGLES,ge,li.disabled,B,ii.disabled,Ni,r.id,P.boundsBuffer,c.quadTriangleIndexBuffer,P.boundsSegments);else if(Fi&&Zi){const Xi=xt.zoom<=o.cZ?P.elevatedGlobeSegments:P.getSegmentsForLongitude(xt.center.lng);Xi&&en.draw(c,I.TRIANGLES,ge,li.disabled,B,ce,Ni,r.id,Fi,Zi,Xi)}}else if(T){ge=new Ut(I.LEQUAL,Ut.ReadOnly,c.depthRangeFor3D);const Fi=c.globeSharedBuffers;if(Fi){const[Zi,Xi,yi]=Fi.getGridBuffers(Qt,!1);en.draw(c,I.TRIANGLES,ge,ie||Re,c.colorModeForRenderPass(),ce,Ni,r.id,Zi,Xi,yi)}}else{const{tileBoundsBuffer:Fi,tileBoundsIndexBuffer:Zi,tileBoundsSegments:Xi}=c.getTileBoundsBuffers(we);en.draw(c,I.TRIANGLES,ge,Re,B,ii.disabled,Ni,r.id,Fi,Zi,Xi)}}if(!(P instanceof o.aT)&&T)for(const te of Q){const ue=te.canonical.y===(1<<te.canonical.z)-1;te.canonical.y===0&&Kh(!0,te,c,t,r,O,z,ce,ie||li.disabled),ue&&Kh(!1,te,c,t,r,O,z,ce===ii.frontCW?ii.backCW:ii.frontCW,ie||li.disabled)}};T?se(K,c.renderElevatedRasterBackface?ii.backCW:ii.frontCW,c.stencilModeFor3D()):se(K,ii.disabled,void 0),c.resetStencilClippingMasks()},"raster-particle":function(c,t,r,u,p,_){c.renderPass==="offscreen"&&(function(y,b,T,M){if(!M.length)return;const I=y.context,P=I.gl,z=b.getSource();if(!(z instanceof Xr))return;const O=Math.ceil(Math.sqrt(T.paint.get("raster-particle-count")));let B=T.particlePositionRGBAImage;if(!B||B.width!==O){const K=(function(W){const se=W*W,Q=new Uint8Array(4*se),ce=function(te){return te|=0,te=Math.imul(2747636419^te,2654435769),te=Math.imul(te^te>>>16,2654435769),((te=Math.imul(te^te>>>16,2654435769))>>>0)/4294967296},ie=1/1.1;for(let te=0;te<se;te++){const ue=ie*(ce(2*te+0)+Ql),we=ie*(ce(2*te+1)+Ql),ve=255*ue%1,Oe=255*we%1,ze=ve,je=we-Oe/255,lt=Oe;Q[4*te+0]=255*(ue-ve/255),Q[4*te+1]=255*ze,Q[4*te+2]=255*je,Q[4*te+3]=255*lt}return Q})(O);B=T.particlePositionRGBAImage=new o.q({width:O,height:O},K)}let N=T.particleFramebuffer;N?N.width!==O&&(N.destroy(),N=T.particleFramebuffer=I.createFramebuffer(O,O,!0,null)):N=T.particleFramebuffer=I.createFramebuffer(O,O,!0,null);const H=[];for(const K of M){const W=b.getTile(K);if(!(W instanceof Eo))continue;const se=Jh(W,z,T);if(!se)continue;const Q=[W.tileSize,W.tileSize];let ce=T.tileFramebuffer;ce||(ce=T.tileFramebuffer=I.createFramebuffer(Q[0],Q[1],!0,null));let ie=W.rasterParticleState;ie||(ie=W.rasterParticleState=new mo(I,K,Q,B));const te=ie.update(T.lastInvalidatedAt);ie.particleTextureDimension!==O&&ie.updateParticleTexture(K,B);const ue=ie.targetColorTexture;ie.targetColorTexture=ie.backgroundColorTexture,ie.backgroundColorTexture=ue;const we=ie.particleTexture0;ie.particleTexture0=ie.particleTexture1,ie.particleTexture1=we,H.push([K,se,ie,te])}if(H.length===0)return;const j=o.o.now(),Z=T.previousDrawTimestamp?.001*(j-T.previousDrawTimestamp):.0167;if(T.previousDrawTimestamp=j,T.hasColorMap()){I.activeTexture.set(P.TEXTURE0+2);let K=T.colorRampTexture;K||(K=T.colorRampTexture=new o.T(I,T.colorRamp,P.RGBA8)),K.bind(P.LINEAR,P.CLAMP_TO_EDGE)}I.bindFramebuffer.set(T.tileFramebuffer.framebuffer),(function(K,W,se){const Q=K.context,ce=Q.gl,ie=W.tileFramebuffer;Q.activeTexture.set(ce.TEXTURE0);const te={u_texture:0,u_opacity:1.05*(we=W.paint.get("raster-particle-fade-opacity-factor"))/(we+.05)},ue=K.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var we;for(const ve of se){const[,,Oe,ze]=ve;ie.colorAttachment.set(Oe.targetColorTexture.texture),Q.viewport.set([0,0,ie.width,ie.height]),Q.clear({color:o.ao.transparent}),ze&&(Oe.backgroundColorTexture.bind(ce.NEAREST,ce.CLAMP_TO_EDGE),ue.draw(K,ce.TRIANGLES,Ut.disabled,li.disabled,xi.alphaBlended,ii.disabled,te,W.id,K.viewportBuffer,K.quadTriangleIndexBuffer,K.viewportSegments))}})(y,T,H),(function(K,W,se,Q){const ce=K.context,ie=ce.gl,te=se.tileFramebuffer,ue=K.transform.projection.name==="globe",we=se.paint.get("raster-particle-max-speed");for(const ve of Q){const[Oe,ze,je]=ve;ce.activeTexture.set(ie.TEXTURE0+0),ze.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),te.colorAttachment.set(je.targetColorTexture.texture);const lt=K.getOrCreateProgram("rasterParticleDraw",{defines:ze.defines,overrideFog:!1});ce.activeTexture.set(ie.TEXTURE0+1);const Me=ze.scalarData?[]:[0,1,2,3].map((Re=>o.e8[Re](Oe)));Me.push(Oe);const ge=Oe.canonical.x,Ge=Oe.canonical.y;for(const Re of Me){const it=W.getTile(ue?Re.wrapped():Re);if(!it)continue;const Je=it.rasterParticleState;if(!Je)continue;const vt=Re.canonical.x+(1<<Re.canonical.z)*(Re.wrap-Oe.wrap),Ze=Re.canonical.y;Je.particleTexture0.bind(ie.NEAREST,ie.CLAMP_TO_EDGE);const $e=Xh(1,Je.particleTexture0.size[0],[vt-ge,Ze-Ge],0,ze.texture.size,2,we,ze.textureOffset,ze.scale,ze.offset);lt.draw(K,ie.POINTS,Ut.disabled,li.disabled,xi.alphaBlended,ii.disabled,$e,se.id,Je.particleIndexBuffer,void 0,Je.particleSegment)}}})(y,b,T,H),I.bindFramebuffer.set(T.particleFramebuffer.framebuffer),(function(K,W,se,Q){const ce=K.context,ie=ce.gl,te=W.paint.get("raster-particle-max-speed"),ue=Q*W.paint.get("raster-particle-speed-factor")*.15,we=(function(Oe){return Math.pow(Oe,6)})(.01+1*W.paint.get("raster-particle-reset-rate-factor")),ve=W.particleFramebuffer;ce.viewport.set([0,0,ve.width,ve.height]);for(const Oe of se){const[,ze,je]=Oe;ce.activeTexture.set(ie.TEXTURE0+0),ze.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),ce.activeTexture.set(ie.TEXTURE0+1);const lt=je.particleTexture0;lt.bind(ie.NEAREST,ie.CLAMP_TO_EDGE);const Me=Hu(1,lt.size[0],0,ze.texture.size,te,ue,we,ze.textureOffset,ze.scale,ze.offset);ve.colorAttachment.set(je.particleTexture1.texture),ce.clear({color:o.ao.transparent}),K.getOrCreateProgram("rasterParticleUpdate",{defines:ze.defines}).draw(K,ie.TRIANGLES,Ut.disabled,li.disabled,xi.unblended,ii.disabled,Me,W.id,K.viewportBuffer,K.quadTriangleIndexBuffer,K.viewportSegments)}})(y,T,H,Z)})(c,t,r,u),c.renderPass==="translucent"&&((function(y,b,T,M,I){const P=y.context,z=P.gl,O=b.getSource().tileSize,B=5*(1-o.ah(o.cK,o.cK+1,y.transform.zoom))*O+T.paint.get("raster-particle-elevation"),N=!y.options.moving,H=y.transform.projection.name==="globe";if(!M.length)return;const[j,Z]=y.stencilConfigForOverlap(M),K=[];H&&K.push("PROJECTION_GLOBE_VIEW");const W=y.stencilModeFor3D();for(const se of Z){const Q=se.toUnwrapped(),ce=b.getTile(se);if(!ce.rasterParticleState)continue;const ie=ce.rasterParticleState,te=100;ce.registerFadeDuration(te);const ue=b.findLoadedParent(se,0),we=Fd(ce,ue,b,y.transform,te);let ve,Oe;y.terrain&&y.terrain.prepareDrawTile(),P.activeTexture.set(z.TEXTURE0),ie.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),P.activeTexture.set(z.TEXTURE1),ue&&ue.rasterParticleState?(ue.rasterParticleState.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),ve=Math.pow(2,ue.tileID.overscaledZ-ce.tileID.overscaledZ),Oe=[ce.tileID.canonical.x*ve%1,ce.tileID.canonical.y*ve%1]):ie.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const ze=H?Float32Array.from(y.transform.expandedFarZProjMatrix):y.transform.calculateProjMatrix(Q,N),je=y.transform,lt=Aa(je),Me=o.dF(se.canonical),ge=o.dG(Me.getCenter().lat);let Ge,Re,it,Je,vt;H?(Ge=Float32Array.from(o.bj(o.dI(se.canonical))),Re=Float32Array.from(je.globeMatrix),it=Float32Array.from(o.dE(je)),Je=[o.aF(je.center.lng),o.aJ(je.center.lat)],vt=Float32Array.from(o.dH(se.canonical,Me,ge,je.worldSize/je._pixelsPerMercatorPixel))):(Ge=new Float32Array(16),Re=new Float32Array(9),it=new Float32Array(16),Je=[0,0],vt=new Float32Array(9));const Ze=Ja(ze,Ge,Re,it,vt,Oe||[0,0],o.aj(y.transform.zoom),Je,lt,ve||1,we,B),$e=y.isTileAffectedByFog(se),xt=y.getOrCreateProgram("rasterParticle",{defines:K,overrideFog:$e});if(y.uploadCommonUniforms(P,xt,Q),H){const Mt=new Ut(z.LEQUAL,Ut.ReadOnly,y.depthRangeFor3D),St=0,Rt=y.globeSharedBuffers;if(Rt){const[Kt,Ti,fi]=Rt.getGridBuffers(ge,St!==0);xt.draw(y,z.TRIANGLES,Mt,W,xi.alphaBlended,y.renderElevatedRasterBackface?ii.frontCCW:ii.backCCW,Ze,T.id,Kt,Ti,fi)}}else{const Mt=y.depthModeForSublayer(0,Ut.ReadOnly),St=j[se.overscaledZ],{tileBoundsBuffer:Rt,tileBoundsIndexBuffer:Kt,tileBoundsSegments:Ti}=y.getTileBoundsBuffers(ce);xt.draw(y,z.TRIANGLES,Mt,St,xi.alphaBlended,ii.disabled,Ze,T.id,Rt,Kt,Ti)}}y.resetStencilClippingMasks()})(c,t,r,u),c.style.map.triggerRepaint())},background:function(c,t,r,u){const p=r.paint.get("background-color"),_=r.paint.get("background-color-use-theme").constantOr("default")==="none",y=r.paint.get("background-opacity"),b=r.paint.get("background-emissive-strength"),T=r.paint.get("background-pitch-alignment")==="viewport";if(y===0)return;const M=c.context,I=M.gl,P=c.transform,z=P.tileSize,O=r.paint.get("background-pattern");let B;if(O!==void 0&&(O===null||(B=c.imageManager.getPattern(o.I.from(O.toString()),r.scope,c.style.getLut(r.scope)),!B)))return;const N=!O&&p.a===1&&y===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==N)return;const H=li.disabled,j=c.depthModeForSublayer(0,N==="opaque"?Ut.ReadWrite:Ut.ReadOnly),Z=c.colorModeForDrapableLayerRenderPass(b),K=O?"backgroundPattern":"background";let W,se=u;if(se||(W=c.getBackgroundTiles(),se=Object.values(W).map((Q=>Q.tileID))),O&&(M.activeTexture.set(I.TEXTURE0),c.imageManager.bind(c.context,r.scope)),T){const Q=c.getOrCreateProgram(K,{overrideFog:!1,overrideRtt:!0}),ce=new Float32Array(o.bz([])),ie=new o.aP(0,0,0,0,0),te=O?qu(ce,b,y,c,0,r.scope,B,T,{tileID:ie,tileSize:z}):ec(ce,b,y,p.toPremultipliedRenderColor(_?null:r.lut));Q.draw(c,I.TRIANGLES,j,H,Z,ii.disabled,te,r.id,c.viewportBuffer,c.quadTriangleIndexBuffer,c.viewportSegments)}else for(const Q of se){const ce=c.isTileAffectedByFog(Q),ie=c.getOrCreateProgram(K,{overrideFog:ce}),te=Q.toUnwrapped(),ue=u?Q.projMatrix:c.transform.calculateProjMatrix(te);c.prepareDrawTile();const we=t?t.getTile(Q):W?W[Q.key]:new jo(Q,z,P.zoom,c),ve=O?qu(ue,b,y,c,0,r.scope,B,T,{tileID:Q,tileSize:z}):ec(ue,b,y,p.toPremultipliedRenderColor(_?null:r.lut));c.uploadCommonUniforms(M,ie,te);const{tileBoundsBuffer:Oe,tileBoundsIndexBuffer:ze,tileBoundsSegments:je}=c.getTileBoundsBuffers(we);ie.draw(c,I.TRIANGLES,j,H,Z,ii.disabled,ve,r.id,Oe,ze,je)}},sky:function(c,t,r){const u=c._atmosphere?o.aj(c.transform.zoom):1,p=r.paint.get("sky-opacity")*u;if(p===0)return;const _=c.context,y=r.paint.get("sky-type"),b=new Ut(_.gl.LEQUAL,Ut.ReadOnly,[0,1]),T=c.frameCounter/1e3%1;y==="atmosphere"?c.renderPass==="offscreen"?r.needsSkyboxCapture(c)&&((function(M,I,P,z){const O=M.context,B=O.gl;let N=I.skyboxFbo;if(!N){N=I.skyboxFbo=O.createFramebuffer(32,32,!0,null),I.skyboxGeometry=new qd(O),I.skyboxTexture=O.gl.createTexture(),B.bindTexture(B.TEXTURE_CUBE_MAP,I.skyboxTexture),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MAG_FILTER,B.LINEAR);for(let K=0;K<6;++K)B.texImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+K,0,B.RGBA,32,32,0,B.RGBA,B.UNSIGNED_BYTE,null)}O.bindFramebuffer.set(N.framebuffer),O.viewport.set([0,0,32,32]);const H=I.getCenter(M,!0),j=M.getOrCreateProgram("skyboxCapture"),Z=new Float64Array(16);o.bz(Z),o.em(Z,Z,.5*-Math.PI),Ro(M,I,j,Z,H,0),o.bz(Z),o.em(Z,Z,.5*Math.PI),Ro(M,I,j,Z,H,1),o.bz(Z),o.cT(Z,Z,.5*-Math.PI),Ro(M,I,j,Z,H,2),o.bz(Z),o.cT(Z,Z,.5*Math.PI),Ro(M,I,j,Z,H,3),o.bz(Z),Ro(M,I,j,Z,H,4),o.bz(Z),o.em(Z,Z,Math.PI),Ro(M,I,j,Z,H,5),O.viewport.set([0,0,M.width,M.height])})(c,r),r.markSkyboxValid(c)):c.renderPass==="sky"&&(function(M,I,P,z,O){const B=M.context,N=B.gl,H=M.transform,j=M.getOrCreateProgram("skybox");B.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_CUBE_MAP,I.skyboxTexture);const Z=((K,W,se,Q,ce)=>({u_matrix:K,u_sun_direction:W,u_cubemap:0,u_opacity:Q,u_temporal_offset:ce}))(H.skyboxMatrix,I.getCenter(M,!1),0,z,O);M.uploadCommonUniforms(B,j),j.draw(M,N.TRIANGLES,P,li.disabled,M.colorModeForRenderPass(),ii.backCW,Z,"skybox",I.skyboxGeometry.vertexBuffer,I.skyboxGeometry.indexBuffer,I.skyboxGeometry.segment)})(c,r,b,p,T):y==="gradient"&&c.renderPass==="sky"&&(function(M,I,P,z,O){const B=M.context,N=B.gl,H=M.transform,j=M.getOrCreateProgram("skyboxGradient");I.skyboxGeometry||(I.skyboxGeometry=new qd(B)),B.activeTexture.set(N.TEXTURE0);let Z=I.colorRampTexture;Z||(Z=I.colorRampTexture=new o.T(B,I.colorRamp,N.RGBA8)),Z.bind(N.LINEAR,N.CLAMP_TO_EDGE);const K=((W,se,Q,ce,ie)=>({u_matrix:W,u_color_ramp:0,u_center_direction:se,u_radius:o.an(Q),u_opacity:ce,u_temporal_offset:ie}))(H.skyboxMatrix,I.getCenter(M,!1),I.paint.get("sky-gradient-radius"),z,O);M.uploadCommonUniforms(B,j),j.draw(M,N.TRIANGLES,P,li.disabled,M.colorModeForRenderPass(),ii.backCW,K,"skyboxGradient",I.skyboxGeometry.vertexBuffer,I.skyboxGeometry.indexBuffer,I.skyboxGeometry.segment)})(c,r,b,p,T)},custom:function(c,t,r,u){const p=c.context,_=r.implementation;if(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes("custom")||c.terrain&&(c.terrain.renderingToTexture||c.renderPass==="offscreen")&&r.isDraped(t)){if(c.renderPass==="offscreen"){const y=_.prerender;if(y){if(c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),c.transform.projection.name==="globe"){const b=c.transform.pointMerc;y.call(_,p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),o.aj(c.transform.zoom),[b.x,b.y],c.transform.pixelsPerMeterRatio)}else y.call(_,p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState()}}else if(c.renderPass==="translucent"){if(c.terrain&&c.terrain.renderingToTexture){const b=_.renderToTile;if(b){const T=u[0].canonical,M={x:T.x+u[0].wrap*(_.wrapTileId?0:1<<T.z),y:T.y,z:T.z};p.setDepthMode(Ut.disabled),p.setStencilMode(li.disabled),p.setColorMode(c.colorModeForRenderPass()),c.setCustomLayerDefaults(),b.call(_,p.gl,M),p.setDirty(),c.setBaseState()}return}c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),p.setStencilMode(li.disabled);const y=_.renderingMode==="3d"?new Ut(c.context.gl.LEQUAL,Ut.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,Ut.ReadOnly);if(p.setDepthMode(y),c.transform.projection.name==="globe"){const b=c.transform.pointMerc;_.render(p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),o.aj(c.transform.zoom),[b.x,b.y],c.transform.pixelsPerMeterRatio)}else _.render(p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState(),p.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(c,t,r,u){if(c.renderPass==="opaque")return;const p=r.paint.get("model-opacity").constantOr(1),_=r.paint.get("model-elevation-reference"),y=_==="ground",b=_==="ground";if(p===0)return;const T=r.paint.get("model-cast-shadows");if(c.renderPass==="shadow"&&(!T||c.terrain&&p<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof o.ad))return;const M=c.shadowRenderer,I=r.paint.get("model-receive-shadows");M&&(M.useNormalOffset=!0,I||(M.enabled=!1));const P=()=>{M&&(M.useNormalOffset=!0,I||(M.enabled=!0))},z=t.getSource();if(c.renderPass==="light-beam"&&z.type!=="batched-model")return;if(z.type==="vector"||z.type==="geojson")return(function(W,se,Q,ce,ie){const te=W.transform,ue=te.projection.name==="globe",we=te.getFreeCameraOptions().position;if(!W.modelManager)return;const ve=W.modelManager;Q.modelManager=ve;const Oe=W.shadowRenderer;if(!Q._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ze=Q._unevaluatedLayout._values["model-id"],je=Object.assign({},Q.layout.get("model-id").parameters),lt=W.style.order.indexOf(Q.fqid);for(const Me of ce){const ge=se.getTile(Me).getBucket(Q);if(!ge||ge.projection.name!==te.projection.name)continue;const Ge=ge.getModelUris();if(Ge&&!ge.modelsRequested&&(ve.addModelsFromBucket(Ge,ie),ge.modelsRequested=!0),ue)je.zoom=Me.overscaledZ;else{const Mt=Xd(Me,te);je.zoom=Mt}const Re=ze.possiblyEvaluate(je);if(Wf(W,ge,Me),Ma.shadowUniformsInitialized=!1,Ma.useSingleShadowCascade=!!Oe&&Oe.getMaxCascadeForTile(Me.toUnwrapped())===0,W.renderPass==="shadow"&&Oe){if(W.currentShadowCascade===1&&ge.isInsideFirstShadowMapFrustum)continue;const Mt=te.calculatePosMatrix(Me.toUnwrapped(),te.worldSize);if(Ma.tileMatrix.set(Mt),Ma.shadowTileMatrix=Float32Array.from(Oe.calculateShadowPassMatrixFromMatrix(Mt)),Ma.aabb.min=[0,0,0],Ma.aabb.max[0]=Ma.aabb.max[1]=o.al,Ma.aabb.max[2]=0,id(ge,Ma,W,Q.scope))continue}const it=1<<Me.canonical.z,Je=[((we.x-Me.wrap)*it-Me.canonical.x)*o.al,(we.y*it-Me.canonical.y)*o.al,we.z*it*o.al];W.conflationActive&&Object.keys(ge.instancesPerModel).length>0&&W.style.isLayerClipped(Q,se.getSource())&&ge.updateReplacement(Me,W.replacementSource,lt,ie)&&(ge.uploaded=!1,ge.upload(W.context));let vt=0;const Ze=new Array,$e=new Array,xt=new Array;for(let Mt in ge.instancesPerModel){const St=ge.instancesPerModel[Mt];St.features.length>0&&!ue&&(Mt=Re.evaluate(St.features[0].feature,{}));const Rt=ve.getModel(Mt,ie);if(Rt||ve.hasURLBeenRequested(Mt)||ge.modelUris.includes(Mt)||(ge.modelUris.push(Mt),ge.modelsRequested=!1),Rt&&Rt.uploaded)if(ue){const Kt=o.c4([],[we.x,we.y,we.z],W.transform.worldSize);o.ev(Kt,Kt);for(let Ti=0;Ti<St.instancedDataArray.length;++Ti){const fi=[0,0,0],Qi=[1,1,1],Qt=o.ew(),Ni=St.tileCoordinatesForInstance(Ti),oi=St.transformForInstance(Ti);o.ex(Qi,oi),o.ey(Qt,oi),o.ez(fi,Qt);const en=St.translationForInstance(Ti),Fi=new o.aS(0,0);o.eA(ge.canonical,Fi,Ni.x,Ni.y);const Zi=o.bB();o.eB(Zi,Rt,W.transform,Fi,fi,Qi,en,!0,!1,!1);const Xi=St.colorForInstance(Ti),yi=o.bz([]),an=o.ee(Fi.lat,W.transform.zoom),Si=o.bp([],[1,1,1/an]);o.bq(yi,yi,Kt),xt.push({zScaleMatrix:Si,negCameraPosMatrix:yi});for(const Mn of Rt.nodes)ed(W,Mn,Zi,W.transform.expandedFarZProjMatrix,vt,Ze,$e,Rt.materialOverrides,Xi);++vt}}else for(const Kt of Rt.nodes)Ju(W,Q,Kt,St,Je,Me,Ma)}if(ue)if(W.renderPass==="shadow"){for(const Mt of $e)Hc(Mt.mesh,Mt.nodeModelMatrix,W,Q);for(const Mt of Ze)Hc(Mt.mesh,Mt.nodeModelMatrix,W,Q)}else J1(W,Q,1,Ze,$e,xt)}})(c,t,r,u,Qh(z,r,c.style._importedAsBasemap)),void P();if(!z.loaded())return;if(z.type==="batched-model")return(function(W,se,Q,ce){Q.resetLayerRenderingStats(W);const ie=W.context,te=W.transform,ue=W.style.fog,we=W.shadowRenderer;if(te.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${te.projection.name} projection is not yet implemented`);const ve=W.transform.getFreeCameraOptions().position,Oe=o.c4([],[ve.x,ve.y,ve.z],W.transform.worldSize),ze=o.ev([],Oe),je=o.bz([]),lt=o.ee(te.center.lat,te.zoom),Me=o.bp([],[1,1,1/lt]);o.bq(je,je,ze);const ge=Q.paint.get("model-opacity").constantOr(1),Ge=new Ut(ie.gl.LEQUAL,Ut.ReadWrite,W.depthRangeFor3D),Re=new Ut(ie.gl.LEQUAL,Ut.ReadOnly,W.depthRangeFor3D),it=new o.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Je=W.renderPass==="shadow",vt=Je&&we?we.getCurrentCascadeFrustum():te.getFrustum(te.scaleZoom(te.worldSize)),Ze=Q.paint.get("model-front-cutoff"),$e=Ze[2]<1,xt=Mo(W,Q.paint.get("model-cutoff-fade-range")),Mt=Q.getLayerRenderingStats();(function(St,Rt,Kt,Ti){const fi=St.terrain?St.terrain.exaggeration():0,Qi=St.transform.zoom;for(const Qt of Ti){const Ni=Rt.getTile(Qt).getBucket(Kt);Ni&&(Ni.setFilter(Kt.filter),St.conflationActive&&Ni.updateReplacement(Qt,St.replacementSource),Ni.evaluateTransform(St,Kt),St.terrain&&fi>0&&Ni.elevationUpdate(St.terrain,fi,Qt,Kt.source),Ni.needsReEvaluation(St,Qi,Kt)&&Ni.evaluate(Kt))}})(W,se,Q,ce),(function(){let St,Rt,Kt;$e?(St=ce.length-1,Rt=-1,Kt=-1):(St=0,Rt=ce.length,Kt=1);const Ti=new Float64Array(16),fi=o.cz(),Qi=new o.P(0,0);for(let Qt=St;Qt!==Rt;Qt+=Kt){const Ni=ce[Qt],oi=se.getTile(Ni).getBucket(Q);if(!oi||!oi.uploaded)continue;let en=!1;we&&(en=we.getMaxCascadeForTile(Ni.toUnwrapped())===0);const Fi=te.calculatePosMatrix(Ni.toUnwrapped(),te.worldSize),Zi=oi.modelTraits;!Je&&$e&&(o.bk(Ti,Fi),o.af(fi,Oe,Ti),Qi.x=fi[0],Qi.y=fi[1]);const Xi=[];oi.setFilter(Q.filter);for(const yi of oi.getNodesInfo()){if(yi.hiddenByReplacement||!yi.node.meshes)continue;const an=yi.node;let Si=0;W.terrain&&an.elevation&&(Si=an.elevation*W.terrain.exaggeration());const Mn=(()=>{const vr=yi.aabb;return it.min=[...vr.min],it.max=[...vr.max],it.min[2]+=Si,it.max[2]+=Si,o.af(it.min,it.min,Fi),o.af(it.max,it.max,Fi),it})(),Vi=yi.evaluatedScale;if(Vi[0]<=1&&Vi[1]<=1&&Vi[2]<=1&&Mn.intersects(vt)===0)continue;if(!Je&&$e){const vr=.16666666666666666;yi.cameraCollisionOpacity=Oe[0]>Mn.min[0]&&Oe[0]<Mn.max[0]&&Oe[1]>Mn.min[1]&&Oe[1]<Mn.max[1]&&Oe[2]*lt<Mn.max[2]&&an.footprint&&o.b$(Qi,an.footprint)?Math.max(yi.cameraCollisionOpacity-vr,0):Math.min(1,yi.cameraCollisionOpacity+vr)}const $t=[...Fi],Ri=1/o.d6(Ni.canonical),Dn=an.anchor?an.anchor[0]:0,kn=an.anchor?an.anchor[1]:0;o.bq($t,$t,[Dn*(Vi[0]-1)+yi.evaluatedTranslation[0]*Ri,kn*(Vi[1]-1)+yi.evaluatedTranslation[1]*Ri,Si+yi.evaluatedTranslation[2]]),o.cp(Vi,o.eD)||o.cR($t,$t,Vi);const Wn=o.aB([],$t,an.globalMatrix),rr=o.aB([],te.expandedFarZProjMatrix,Wn),qa=o.aB([],te.expandedFarZProjMatrix,$t),da=o.aC([],[Dn,kn,Si,1],rr)[2];an.hidden=!1;let ra=ge;Je||($e&&(ra*=yi.cameraCollisionOpacity,ra*=Xc($t,te,yi.aabb,Ze)),ra*=Zc(xt,da)),ra!==0?Xi.push({nodeInfo:yi,depth:da,opacity:ra,wvpForNode:rr,wvpForTile:qa,nodeModelMatrix:Wn,tileModelMatrix:$t}):an.hidden=!0}Je||Xi.sort(((yi,an)=>!$e||yi.opacity===1&&an.opacity===1?yi.depth<an.depth?-1:1:yi.opacity===1?-1:an.opacity===1?1:yi.depth>an.depth?-1:1));for(const yi of Xi){const an=yi.nodeInfo,Si=an.node;let Mn=o.aB([],Me,yi.tileModelMatrix);o.aB(Mn,je,Mn);const Vi=o.bk([],Mn);o.ef(Vi,Vi),o.cR(Vi,Vi,td),Mn=o.aB(Mn,Mn,Si.globalMatrix);const $t=W.renderPass==="light-beam",Ri=Q.paint.get("model-color-use-theme").constantOr("default")==="none",Dn=Zi&o.eH.HasMapboxMeshFeatures,kn=Dn?0:an.evaluatedRMEA[0][2];for(let Wn=0;Wn<Si.meshes.length;++Wn){const rr=Si.meshes[Wn],qa=Wn===Si.lightMeshIndex;let da=yi.wvpForNode;if(qa){if(!$t&&!W.terrain&&W.shadowRenderer){W.currentLayer<W.firstLightBeamLayer&&(W.firstLightBeamLayer=W.currentLayer);continue}da=yi.wvpForTile}else if($t)continue;const ra={defines:[]},vr=[];if(!Je&&we&&(we.useNormalOffset=!!rr.normalBuffer),Gc(ra.defines,vr,rr,W,Ri?null:Q.lut),Dn||ra.defines.push("DIFFUSE_SHADED"),en&&ra.defines.push("SHADOWS_SINGLE_CASCADE"),Mt&&(Je?Mt.numRenderedVerticesInShadowPass+=rr.vertexArray.length:Mt.numRenderedVerticesInTransparentPass+=rr.vertexArray.length),Je){Hc(rr,yi.nodeModelMatrix,W,Q);continue}let go=null;if(ue){const hr=Zd(yi.nodeModelMatrix,W.transform);if(go=new Float32Array(hr),te.projection.name!=="globe"){const wn=rr.aabb.min,ar=rr.aabb.max,[Jr,or]=ue.getOpacityForBounds(hr,wn[0],wn[1],ar[0],ar[1]);ra.overrideFog=Jr>=Ce||or>=Ce}}const ur=rr.material;let yo;ur.occlusionTexture&&ur.occlusionTexture.offsetScale&&(yo=ur.occlusionTexture.offsetScale,ra.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Oo=W.getOrCreateProgram("model",ra);!Je&&we&&we.setupShadowsFromMatrix(yi.tileModelMatrix,Oo,we.useNormalOffset),W.uploadCommonUniforms(ie,Oo,null,go);const aa=ur.pbrMetallicRoughness;aa.metallicFactor=.9,aa.roughnessFactor=.5;const Pn=tc(new Float32Array(da),new Float32Array(Mn),new Float32Array(Vi),new Float32Array(Si.globalMatrix),W,yi.opacity,aa.baseColorFactor,ur.emissiveFactor,aa.metallicFactor,aa.roughnessFactor,ur,kn,Q,[0,0,0],yo);!qa&&(an.hasTranslucentParts||yi.opacity<1)&&Oo.draw(W,ie.gl.TRIANGLES,Ge,li.disabled,xi.disabled,ii.backCCW,Pn,Q.id,rr.vertexBuffer,rr.indexBuffer,rr.segments,Q.paint,W.transform.zoom,void 0,vr),Oo.draw(W,ie.gl.TRIANGLES,qa?Re:Ge,li.disabled,qa||yi.opacity<1||an.hasTranslucentParts?xi.alphaBlended:xi.unblended,ii.backCCW,Pn,Q.id,rr.vertexBuffer,rr.indexBuffer,rr.segments,Q.paint,W.transform.zoom,void 0,vr)}}}})()})(c,t,r,u),void P();if(z.type!=="model")return;const O=z.getModels(),B=[],N=c.transform.getFreeCameraOptions().position,H=o.c4([],[N.x,N.y,N.z],c.transform.worldSize);o.ev(H,H);const j=[],Z=[];let K=0;for(const W of O){const se=t.getFeatureState("",W.id),Q={type:"Unknown",id:W.id,properties:W.featureProperties},ce=r.paint.get("model-rotation").evaluate(Q,se),ie=r.paint.get("model-scale").evaluate(Q,se),te=r.paint.get("model-translation").evaluate(Q,se);qc(r,W.id,se,W.featureProperties,W.nodeOverrideNames,W.nodeOverrides),K1(r,W.id,se,W.featureProperties,W.materialOverrideNames,W.materialOverrides),W.nodeOverrides.size>0&&W.computeBoundsAndApplyParent(),W.computeModelMatrix(c,ce,ie,te,b,y,!1);const ue=o.bz([]),we=o.ee(W.position.lat,c.transform.zoom),ve=o.bp([],[1,1,1/we]);o.bq(ue,ue,H),B.push({zScaleMatrix:ve,negCameraPosMatrix:ue});for(const Oe of W.nodes)ed(c,Oe,W.matrix,c.transform.expandedFarZProjMatrix,K,j,Z,W.materialOverrides);K++}if(j.sort(((W,se)=>se.depth-W.depth)),c.renderPass!=="shadow")J1(c,r,p,j,Z,B),P();else{for(const W of Z)Hc(W.mesh,W.nodeModelMatrix,c,r);for(const W of j)Hc(W.mesh,W.nodeModelMatrix,c,r);P()}}},rd={line:function(c,t,r){if(c.hasElevatedBuckets=!1,c.hasNonElevatedBuckets=!1,c._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||c._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const u=t.getVisibleCoordinates();for(const p of u){const _=t.getTile(p).getBucket(c);if(_&&(_.elevationType!=="none"?c.hasElevatedBuckets=!0:c.hasNonElevatedBuckets=!0,c.hasElevatedBuckets&&c.hasNonElevatedBuckets))break}}}else c.hasNonElevatedBuckets=!0},model:function(c,t,r){const u=t.getSource();if(!u.loaded())return;if(u.type==="vector"||u.type==="geojson"){const _=Qh(u,c,r.style._importedAsBasemap);return void(r.modelManager&&r.modelManager.upload(r,_))}if(u.type==="batched-model"||u.type!=="model")return;const p=u.getModels();for(const _ of p)_.upload(r.context)},raster:function(c,t,r){const u=t.getSource();if(!(u instanceof Xr&&u.loaded()))return;const p=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const _=c.paint.get("raster-array-band")||u.getInitialBand(p);if(_==null)return;const y=t.getIds().map((b=>t.getTileByID(b)));for(const b of y)b.updateNeeded(c.id,_)&&u.prepareTile(b,p,c.id,_)},"raster-particle":function(c,t,r){const u=t.getSource();if(!(u instanceof Xr&&u.loaded()))return;const p=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const _=c.paint.get("raster-particle-array-band")||u.getInitialBand(p);if(_==null)return;const y=t.getIds().map((b=>t.getTileByID(b)));for(const b of y)b.updateNeeded(c.id,_)&&u.prepareTile(b,p,c.id,_)}},Yd={fill:Js},Do={fill:function(c,t,r,u){if(!r.layout||r.layout.get("fill-elevation-reference")==="none"||r.paint.get("fill-opacity").constantOr(1)===0)return;const p=c.context.gl,_=new Ut(p.LEQUAL,Ut.ReadOnly,c.depthRangeFor3D),y=new li({func:p.ALWAYS,mask:255},255,255,p.KEEP,p.KEEP,p.REPLACE),b=c.transform.getFreeCameraOptions().position,T=c.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const M of u){const I=t.getTile(M),P=I.getBucket(r);if(!P)continue;const z=P.elevatedStructures;if(!z||z.depthSegments.segments[0].primitiveLength===0)continue;const O=Yr(M.toUnwrapped(),b),B=c.translatePosMatrix(M.projMatrix,I,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),N=qh(B,O,0,1,0);T.draw(c,p.TRIANGLES,_,y,xi.disabled,ii.disabled,N,r.id,z.vertexBuffer,z.indexBuffer,z.depthSegments,r.paint,c.transform.zoom)}}};class Al{constructor(t,r,u,p,_,y){this.context=new Zu(t,r),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._timeStamp=o.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const b=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const M of b)this._debugParams.enabledLayers[M]=!0;_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),_.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),_.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),_.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const M of b)_.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],M);this.occlusionParams=new Q1(_),this.setup(),this.numSublayers=so.maxUnderzooming+so.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Lu(this),this._wireframeDebugCache=new Kf,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const T=new o.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,T,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=p,this.worldview=y}updateTerrain(t,r){const u=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new xl(this,t));const p=this._terrain;this.transform.elevation=u?p:null,p.update(t,this.transform,r),this.transform.elevation&&!p.enabled&&(this.transform.elevation=null)}_updateFog(t){const r=t.fog;if(!r||this.transform.projection.name==="globe"||r.getOpacity(this.transform.pitch)<1||r.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,p]=r.getFovAdjustedRange(this.transform._fov);if(u>p)return void(this.transform.fogCullDistSq=null);const _=u+.78*(p-u);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new xl(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,r){if(this.width=t*o.o.devicePixelRatio,this.height=r*o.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._mergedLayers[u].resize()}setup(){const t=this.context,r=new o.bc;r.emplaceBack(0,0),r.emplaceBack(o.al,0),r.emplaceBack(0,o.al),r.emplaceBack(o.al,o.al),this.tileExtentBuffer=t.createVertexBuffer(r,o.be.members),this.tileExtentSegments=o.bf.simpleSegment(0,0,4,2);const u=new o.bc;u.emplaceBack(0,0),u.emplaceBack(o.al,0),u.emplaceBack(0,o.al),u.emplaceBack(o.al,o.al),this.debugBuffer=t.createVertexBuffer(u,o.be.members),this.debugSegments=o.bf.simpleSegment(0,0,4,5);const p=new o.bc;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,o.be.members),this.viewportSegments=o.bf.simpleSegment(0,0,4,2);const _=new o.a$;_.emplaceBack(0,0,0,0),_.emplaceBack(o.al,0,o.al,0),_.emplaceBack(0,o.al,0,o.al),_.emplaceBack(o.al,o.al,o.al,o.al),this.mercatorBoundsBuffer=t.createVertexBuffer(_,o.bh.members),this.mercatorBoundsSegments=o.bf.simpleSegment(0,0,4,2);const y=new o.b0;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(y);const b=new o.bd;for(const M of[0,1,3,2,0])b.emplaceBack(M);this.debugIndexBuffer=t.createIndexBuffer(b),this.emptyTexture=new o.T(t,new o.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=o.bB();const T=this.context.gl;this.stencilClearMode=new li({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Ut.disabled,this.stencilClearMode,xi.disabled,ii.disabled,Fc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,r,u){if(!r||this.currentStencilSource===r.id||!t.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let b=!1;for(const T of u)if(this._tileClippingMaskIDs[T.key]===void 0){b=!0;break}if(!b)return}this.currentStencilSource=r.id;const p=this.context,_=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(xi.disabled),p.setDepthMode(Ut.disabled);const y=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const b of u){const T=r.getTile(b),M=this._tileClippingMaskIDs[b.key]=this.nextStencilID++,{tileBoundsBuffer:I,tileBoundsIndexBuffer:P,tileBoundsSegments:z}=this.getTileBoundsBuffers(T);y.draw(this,_.TRIANGLES,Ut.disabled,new li({func:_.ALWAYS,mask:0},M,255,_.KEEP,_.KEEP,_.REPLACE),xi.disabled,ii.disabled,Fc(b.projMatrix),"$clipping",I,P,z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new li({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const r=this.context.gl;return new li({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,u=t.sort(((y,b)=>b.overscaledZ-y.overscaledZ)),p=u[u.length-1].overscaledZ,_=u[0].overscaledZ-p+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const y={};for(let b=0;b<_;b++)y[b+p]=new li({func:r.GEQUAL,mask:255},b+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=_,[y,u]}return[{[p]:li.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new xi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new o.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?xi.unblended:xi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const r=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new xi([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new o.ao(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,r,u,p=!1){if(this.depthOcclusion)return new Ut(this.context.gl.GREATER,Ut.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!p)return Ut.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ut(u||this.context.gl.LEQUAL,r,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,r=Math.ceil(this.width),u=Math.ceil(this.height),p=this.context.bindFramebuffer.get(),_=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===r&&this.depthFBO.height===u||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),r!==0&&u!==0&&(this.depthFBO=new Wh(this.context,r,u,!1,"texture"),this.depthTexture=new o.T(this.context,{width:r,height:u,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(p),t.bindTexture(t.TEXTURE_2D,_),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,r,u,0,0,r,u,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((t,r)=>t+r/this._fpsHistory.length),0))}render(t,r){const u=o.o.now();this._dt=u-this._timeStamp,this._timeStamp=u,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=r;const p=this.style._mergedLayers,_=!(!this.terrain||!this.terrain.enabled),y=()=>this.style._getOrder(_).filter((Me=>{const ge=p[Me];return!(ge.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ge.type]}));let b=y(),T=!1,M=!1,I=null;for(const Me of b){const ge=p[Me];ge.type==="circle"?T=!0:ge.type==="building"?I=ge:ge.type==="symbol"&&(ge.hasOcclusionOpacityProperties?M=!0:T=!0)}let P=b.map((Me=>p[Me]));const z=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.o.now()),this.imageManager.beginFrame();let O=0,B=!1;for(const Me in z){const ge=z[Me];ge.used&&(ge.prepare(this.context),ge.getSource().usedInConflation&&++O)}let N=!1;for(const Me of P)Me.isHidden(this.transform.zoom)||(Me.type==="clip"&&(N=!0),this.prepareLayer(Me));const H={},j={},Z={},K={},W={};for(const Me in z){const ge=z[Me];H[Me]=ge.getVisibleCoordinates(),j[Me]=H[Me].slice().reverse(),Z[Me]=ge.getVisibleCoordinates(!0).reverse(),K[Me]=ge.getShadowCasterCoordinates(),W[Me]=ge.sortCoordinatesByDistance(H[Me])}const se=Me=>{const ge=this.style.getLayerSourceCache(Me);return ge&&ge.used?ge.getSource():null};if(O||N||this._clippingActiveLastFrame){const Me=[],ge=[];let Ge=0;for(const Re of P)this.isSourceForClippingOrConflation(Re,se(Re))&&(Me.push(Re),ge.push(Ge)),Ge++;if(Me&&(N||Me.length>1)||this._clippingActiveLastFrame){N=!1;const Re=[];for(let it=0;it<Me.length;it++){const Je=Me[it],vt=ge[it],Ze=this.style.getLayerSourceCache(Je);if(!Ze||!Ze.used||!Ze.getSource().usedInConflation&&Je.type!=="clip"&&Je.type!=="building")continue;let $e=o.eP,xt=o.bZ.None;const Mt=[];let St=!0;if(Je.type==="building")$e=o.eR;else if(Je.type==="clip"){$e=vt;for(const Rt of Je.layout.get("clip-layer-types"))xt|=Rt==="model"?o.bZ.Model:Rt==="symbol"?o.bZ.Symbol:o.bZ.FillExtrusion;for(const Rt of Je.layout.get("clip-layer-scope"))Mt.push(Rt);Je.isHidden(this.transform.zoom)?St=!1:N=!0}St&&Re.push({layer:Je.fqid,cache:Ze,order:$e,clipMask:xt,clipScope:Mt})}this.replacementSource.setSources(Re),B=!0}}this._clippingActiveLastFrame=N,B||this.replacementSource.clear(),this.conflationActive=B,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Me=0;Me<P.length;Me++){const ge=P[Me],Ge=ge.cutoffRange();if(this.longestCutoffRange=Math.max(Ge,this.longestCutoffRange),Ge>0){const Re=se(ge);Re&&(this.minCutoffZoom=Math.max(Re.minzoom,this.minCutoffZoom)),ge.minzoom&&(this.minCutoffZoom=Math.max(ge.minzoom,this.minCutoffZoom))}ge.is3D(_)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Me),this._lastOcclusionLayer=Me)}const Q=this.style&&this.style.fog;Q?(this._fogVisible=Q.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Q.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Z),this.opaquePassCutoff=0,b=y(),P=b.map((Me=>p[Me])));const ce=this._shadowRenderer;if(ce){ce.updateShadowParameters(this.transform,this.style.directionalLight);for(const Me in z)for(const ge of H[Me]){let Ge={min:0,max:0};this.terrain&&(Ge=this.terrain.getMinMaxForTile(ge)||Ge),ce.addShadowReceiver(ge.toUnwrapped(),Ge.min,Ge.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new fr(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ie=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ie&&!this._snow&&(this._snow=new nd(this)),!ie&&this._snow&&(this._snow.destroy(),delete this._snow),te&&!this._rain&&(this._rain=new $c(this)),!te&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),I){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Se);const Me=this.style.getLayerSourceCache(I);this.buildingTileBorderManager.updateBorders(Me,I)}if(!sr.has(this.context.gl))return;this.renderPass="offscreen";for(const Me of P){const ge=t.getLayerSourceCache(Me);if(!Me.hasOffscreenPass()||Me.isHidden(this.transform.zoom))continue;const Ge=ge?j[ge.id]:void 0;(Me.type==="custom"||Me.type==="raster"||Me.type==="raster-particle"||Me.isSky()||Ge&&Ge.length)&&this.renderLayer(this,ge,Me,Ge)}this.depthRangeFor3D=[0,1-(P.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,K)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ue=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),we=(()=>{if(r.showOverdrawInspector)return o.ao.black;const Me=this.style.fog;if(Me&&this.transform.projection.supportsFog){const ge=this.style.getLut(Me.scope);if(!ue){const Ge=Me.properties.get("color-use-theme")==="none",Re=Me.properties.get("color").toNonPremultipliedRenderColor(Ge?null:ge).toArray01();return new o.ao(...Re)}if(ue){const Ge=Me.properties.get("space-color-use-theme")==="none",Re=Me.properties.get("space-color").toNonPremultipliedRenderColor(Ge?null:ge).toArray01();return new o.ao(...Re)}}return o.ao.transparent})();if(this.context.clear({color:we,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ue&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const Me=P[this.currentLayer],ge=t.getLayerSourceCache(Me);if(Me.isSky())continue;const Ge=ge?(Me.is3D(_)?W:j)[ge.id]:void 0;this._renderTileClippingMasks(Me,ge,Ge),this.renderLayer(this,ge,Me,Ge)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ue&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const Me=P[this.currentLayer],ge=t.getLayerSourceCache(Me);Me.isSky()&&this.renderLayer(this,ge,Me,ge?j[ge.id]:void 0)}function ve(Me,ge){let Ge;return ge&&(Ge=(Me.type==="symbol"?Z:Me.is3D(_)?W:j)[ge.id]),Ge}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<b.length;){const Me=P[this.currentLayer];if(Me.type==="raster"||Me.type==="raster-particle"){const ge=t.getLayerSourceCache(Me);this.renderLayer(this,ge,Me,ve(Me,ge))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Oe=0;ce&&(Oe=ce.getShadowCastingLayerCount());let ze=!1,je=-1;for(let Me=0;Me<b.length;++Me){const ge=P[Me];ge.isHidden(this.transform.zoom)||ge.is3D(_)&&(je=Me)}M&&je===-1&&(T=!0);let lt=!1;for(;this.currentLayer<b.length;){const Me=P[this.currentLayer],ge=t.getLayerSourceCache(Me);if(Me.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Me)){if(Me.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!lt&&Me.is3D(_)&&!_){const Ge=this.currentLayer,Re=it=>{for(this.currentLayer=0;this.currentLayer<P.length;this.currentLayer++){const Je=P[this.currentLayer];if(Yd[Je.type]){const vt=this.style.getLayerSourceCache(Je);Yd[Je.type](this,vt,Je,ve(Je,vt),it)}}};Re("initialize"),Re("reset"),this.currentLayer=Ge,lt=!0}if(T&&!ze&&this.terrain&&!this.transform.isOrthographic&&(ze=!0,this.blitDepth()),M&&je!==-1&&this.currentLayer===je+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Me,ge,ge?H[ge.id]:void 0),this.renderLayer(this,ge,Me,ve(Me,ge)),!this.terrain&&ce&&Oe>0&&Me.hasShadowPass()&&--Oe==0){{this.clearStencil(),this.resetStencilClippingMasks();const Ge=this.currentLayer;for(this.currentLayer=0;this.currentLayer<P.length;this.currentLayer++){const Re=P[this.currentLayer];if(Do[Re.type]){const it=this.style.getLayerSourceCache(Re);Do[Re.type](this,it,Re,ve(Re,it))}}this.currentLayer=Ge}if(ce.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Ge=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ge;this.currentLayer++){const Re=P[this.currentLayer];if(!Re.hasLightBeamPass())continue;const it=t.getLayerSourceCache(Re);this.renderLayer(this,it,Re,it?j[it.id]:void 0)}this.currentLayer=Ge,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ge=this.currentLayer;this.depthOcclusion=!0;for(const Re of this.layersWithOcclusionOpacity){this.currentLayer=Re;const it=P[this.currentLayer],Je=t.getLayerSourceCache(it),vt=Je?j[Je.id]:void 0;this.terrain||this._renderTileClippingMasks(it,Je,Je?H[Je.id]:void 0),this.renderLayer(this,Je,it,vt)}this.depthOcclusion=!1,this.currentLayer=Ge,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Me=null;P.forEach((ge=>{const Ge=t.getLayerSourceCache(ge);Ge&&!ge.isHidden(this.transform.zoom)&&Ge.getVisibleCoordinates().length&&(!Me||Me.getSource().maxzoom<Ge.getSource().maxzoom)&&(Me=Ge)})),Me&&this.options.showTileBoundaries&&Ku(this,Me,Me.getVisibleCoordinates(),o.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ku(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(Me){const ge=Me.transform.padding;mn(Me,Me.transform.height-(ge.top||0),3,Qs),mn(Me,ge.bottom||0,3,Ga),ic(Me,ge.left||0,3,jr),ic(Me,Me.transform.width-(ge.right||0),3,Yu);const Ge=Me.transform.centerPoint;(function(Re,it,Je,vt){nc(Re,it-1,Je-10,2,20,vt),nc(Re,it-10,Je-1,20,2,vt)})(Me,Ge.x,Me.transform.height-Ge.y,Vc)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),B||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:r}=this.transform.projection,u=!r||!r.includes(t.type);if(rd[t.type]&&(u||this.terrain&&t.type==="custom")){const p=this.style.getLayerSourceCache(t);rd[t.type](t,p,this)}this.gpuTimingEnd()}renderLayer(t,r,u,p){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||p&&p.length)&&(this.id=u.id,this.gpuTimingStart(u),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(u.type)&&(!t.terrain||u.type!=="custom")||u.type==="clip"||Wd[u.type](t,r,u,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery,u=this.context.gl;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:u.createQuery()}),p.calls++,u.beginQuery(r.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,r=this.context.gl,u=r.createQuery();this.deferredRenderGpuTimeQueries.push(u),r.beginQuery(t.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const r={};for(const u in t){const p=t[u],_=this.context.extTimerQuery,y=_.getQueryParameter(p.query,this.context.gl.QUERY_RESULT)/1e6;_.deleteQueryEXT(p.query),r[u]=y}return r}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const r=this.context.gl;let u=0;for(const p of t)u+=r.getQueryParameter(p,r.QUERY_RESULT)/1e6,r.deleteQuery(p);return u}translatePosMatrix(t,r,u,p,_){if(!u[0]&&!u[1])return t;const y=_?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(y){const M=Math.sin(y),I=Math.cos(y);u=[u[0]*I-u[1]*M,u[0]*M+u[1]*I]}const b=[_?u[0]:o.ay(r,u[0],this.transform.zoom),_?u[1]:o.ay(r,u[1],this.transform.zoom),0],T=new Float32Array(16);return o.bq(T,t,b),T}saveTileTexture(t){if(t.context!==this.context)return;const r=t.size[0],u=this._tileTextures[r];u?u.push(t):this._tileTextures[r]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,r,u){const p=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,_=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(_.push("LIGHTING_3D_MODE"),_.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):p||_.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||_.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(_.push("TERRAIN"),this.linearFloatFilteringSupported()&&_.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&_.push("GLOBE"),!this._fogVisible||p||r!==void 0&&!r||_.push("FOG","FOG_DITHERING"),p&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}getOrCreateProgram(t,r){this.cache=this.cache||{};const u=r&&r.defines||[],p=r&&r.config,_=this.currentGlobalDefines(t,r&&r.overrideFog,r&&r.overrideRtt).concat(u),y=Vh.cacheKey(Va[t],t,_,p);return this.cache[y]||(this.cache[y]=new Vh(this.context,t,Va[t],p,$1[t],_)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,r){if(this.style.enable3dLights()){const u=this.style.directionalLight,p=this.style.ambientLight;if(u&&p){const _=((y,b,T)=>{const M=y.properties.get("direction"),I=y.properties.get("color-use-theme")==="none",P=y.properties.get("color").toNonPremultipliedRenderColor(I?null:T.getLut(y.scope)).toArray01(),z=y.properties.get("intensity"),O=b.properties.get("color-use-theme")==="none",B=b.properties.get("color").toNonPremultipliedRenderColor(O?null:T.getLut(b.scope)).toArray01(),N=b.properties.get("intensity"),H=[M.x,M.y,M.z],j=o.dM(B,N),Z=o.dM(P,z);return{u_lighting_ambient_color:j,u_lighting_directional_dir:H,u_lighting_directional_color:Z,u_ground_radiance:Uh(H,Z,j)}})(u,p,this.style);r.setLightsUniformValues(t,_)}}}uploadCommonUniforms(t,r,u,p,_){if(this.uploadCommonLightUniforms(t,r),this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const b=y.getOpacity(this.transform.pitch),T=((M,I,P,z,O,B,N,H,j,Z,K,W)=>{const se=M.transform,Q=I.properties.get("color-use-theme")==="none",ce=I.properties.get("color").toNonPremultipliedRenderColor(Q?null:M.style.getLut(I.scope)).toArray01();ce[3]=z;const ie=M.frameCounter/1e3%1,[te,ue]=I.properties.get("vertical-range");return{u_fog_matrix:P?se.calculateFogTileMatrix(P):W||M.identityMat,u_fog_range:I.getFovAdjustedRange(se._fov),u_fog_color:ce,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(te,ue),ue],u_fog_temporal_offset:ie,u_frustum_tl:O,u_frustum_tr:B,u_frustum_br:N,u_frustum_bl:H,u_globe_pos:j,u_globe_radius:Z,u_viewport:K,u_globe_transition:o.aj(se.zoom),u_is_globe:+(se.projection.name==="globe")}})(this,y,u,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.o.devicePixelRatio,this.transform.height*o.o.devicePixelRatio],p);r.setFogUniformValues(t,T)}_&&r.setCutoffUniformValues(t,_.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),r}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,r=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const p of u)r[p.key]=t[p.key]||new jo(p,512,this.transform.tileZoom,this,void 0,this.worldview);return r}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,r){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!r||r.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let r=this._cachedTileFogOpacities[t.key];return r||(this._cachedTileFogOpacities[t.key]=r=this.style.fog.getOpacityForTile(t)),r[0]>=Ce||r[1]>=Ce}setupDepthForOcclusion(t,r,u){const p=this.context,_=p.gl,y=!!u;var b;u||(u={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),p.activeTexture.set(_.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),u.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],u.u_depth_range_unpack=[2/((b=this.depthRangeFor3D)[1]-b[0]),-1-2*b[0]/(b[1]-b[0])],u.u_occluder_half_size=.5*this.occlusionParams.occluderSize,u.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),p.activeTexture.set(_.TEXTURE0),y||r.setTerrainUniformValues(p,u)}}function _s(c,t){let r=!1,u=null;const p=()=>{u=null,r&&(c(),u=setTimeout(p,t),r=!1)};return()=>(r=!0,u||p(),u)}class eh{constructor(t){this._hashName=t&&encodeURIComponent(t),o.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=_s(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const r=Wc(t);if(this._hashName){const u=this._hashName;let p=!1;const _=location.hash.slice(1).split("&").map((y=>{const b=y.split("=")[0];return b===u?(p=!0,`${b}=${r}`):y})).filter((y=>y));return p||_.push(`${u}=${r}`),`#${_.join("&")}`}return`#${r}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let r;return t.split("&").map((u=>u.split("="))).forEach((u=>{u[0]===this._hashName&&(r=u)})),(r&&r[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const r=this._getCurrentHash();if(r.length>=3&&!r.some((u=>isNaN(Number(u))))){const u=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(r[3]||0):t.getBearing();return t.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:u,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Wc(c,t){const r=c.getCenter(),u=Math.round(100*c.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,p),y=Math.round(r.lng*_)/_,b=Math.round(r.lat*_)/_,T=c.getBearing(),M=c.getPitch();let I=t?`/${y}/${b}/${u}`:`${u}/${b}/${y}`;return(T||M)&&(I+="/"+Math.round(10*T)/10),M&&(I+=`/${Math.round(M)}`),I}const Yc={linearity:.3,easing:o.eS(0,0,.3,1)},Ml=Object.assign({deceleration:2500,maxSpeed:1400},Yc),Kc=Object.assign({deceleration:20,maxSpeed:1400},Yc),Po=Object.assign({deceleration:1e3,maxSpeed:360},Yc),ad=Object.assign({deceleration:1e3,maxSpeed:90},Yc);class od{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=o.o.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const r={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)r.zoom+=_.zoomDelta||0,r.bearing+=_.bearingDelta||0,r.pitch+=_.pitchDelta||0,_.panDelta&&r.pan._add(_.panDelta),_.around&&(r.around=_.around),_.pinchAround&&(r.pinchAround=_.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(r.pan.mag()){const _=sc(r.pan.mag(),u,Object.assign({},Ml,t||{}));p.offset=r.pan.mult(_.amount/r.pan.mag()),p.center=this._map.transform.center,oc(p,_)}if(r.zoom){const _=sc(r.zoom,u,Kc);p.zoom=this._map.transform.zoom+_.amount,oc(p,_)}if(r.bearing){const _=sc(r.bearing,u,Po);p.bearing=this._map.transform.bearing+o.aA(_.amount,-179,179),oc(p,_)}if(r.pitch){const _=sc(r.pitch,u,ad);p.pitch=this._map.transform.pitch+_.amount,oc(p,_)}if(p.zoom||p.bearing){const _=r.pinchAround===void 0?r.around:r.pinchAround;p.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function oc(c,t){(!c.duration||c.duration<t.duration)&&(c.duration=t.duration,c.easing=t.easing)}function sc(c,t,r){const{maxSpeed:u,linearity:p,deceleration:_}=r,y=o.aA(c*p/(t/1e3),-u,u),b=Math.abs(y)/(_*p);return{easing:r.easing,duration:1e3*b,amount:y*(b/2)}}class Hn extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,u,p={}){const _=ea(r.getCanvasContainer(),u),y=r.unproject(_);super(t,Object.assign({point:_,lngLat:y,originalEvent:u},p)),this._defaultPrevented=!1,this.target=r}}class Jc extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,u){const p=t==="touchend"?u.changedTouches:u.touches,_=Oa(r.getCanvasContainer(),p),y=_.map((T=>r.unproject(T))),b=_.reduce(((T,M,I,P)=>T.add(M.div(P.length))),new o.P(0,0));super(t,{points:_,point:b,lngLats:y,lngLat:r.unproject(b),originalEvent:u}),this._defaultPrevented=!1}}class Il extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r){super("wheel",{originalEvent:r}),this._defaultPrevented=!1}}class Kd{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Il(this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new Hn(t.type,this._map,t))}mouseup(t){this._map.fire(new Hn(t.type,this._map,t))}preclick(t){const r=new MouseEvent("preclick",t);this._map.fire(new Hn(r.type,this._map,r))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Hn(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Hn(t.type,this._map,t))}mouseover(t){this._map.fire(new Hn(t.type,this._map,t))}mouseout(t){this._map.fire(new Hn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Jc(t.type,this._map,t))}touchmove(t){this._map.fire(new Jc(t.type,this._map,t))}touchend(t){this._map.fire(new Jc(t.type,this._map,t))}touchcancel(t){this._map.fire(new Jc(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lc{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Hn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Hn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Hn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Jd{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(si(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const u=r,p=this._startPos,_=this._lastPos;if(!p||!_||_.equals(u)||!this._box&&u.dist(p)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=hi("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const y=Math.min(p.x,u.x),b=Math.max(p.x,u.x),T=Math.min(p.y,u.y),M=Math.max(p.y,u.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${y}px,${T}px)`,this._box.style.width=b-y+"px",this._box.style.height=M-T+"px")}))}mouseupWindow(t,r){if(!this._active)return;const u=this._startPos,p=r;if(u&&t.button===0){if(this.reset(),ln(),u.x!==p.x||u.y!==p.y)return this._map.fire(new o.z("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(u,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),_n(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new o.z(t,{originalEvent:r}))}}function cc(c,t){const r={};for(let u=0;u<c.length;u++)r[c[u].identifier]=t[u];return r}class Qd{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,r,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=(function(p){const _=new o.P(0,0);for(const y of p)_._add(y);return _.div(p.length)})(r),this.touches=cc(u,r)))}touchmove(t,r,u){if(this.aborted||!this.centroid)return;const p=cc(u,r);for(const _ in this.touches){const y=p[_];(!y||y.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,r,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class il{constructor(t){this.singleTap=new Qd(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,r,u){this.singleTap.touchstart(t,r,u)}touchmove(t,r,u){this.singleTap.touchmove(t,r,u)}touchend(t,r,u){const p=this.singleTap.touchend(t,r,u);if(p){const _=t.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(p)<30;if(_&&y||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class ef{constructor(){this._zoomIn=new il({numTouches:1,numTaps:2}),this._zoomOut=new il({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,u){this._zoomIn.touchstart(t,r,u),this._zoomOut.touchstart(t,r,u)}touchmove(t,r,u){this._zoomIn.touchmove(t,r,u),this._zoomOut.touchmove(t,r,u)}touchend(t,r,u){const p=this._zoomIn.touchend(t,r,u),_=this._zoomOut.touchend(t,r,u);return p?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()+1,around:y.unproject(p)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()-1,around:y.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const sd={0:1,2:2},tf={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class uc{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,r){return!1}_move(t,r){return{}}mousedown(t,r){if(this._lastPoint)return;const u=Ss(t);this._correctButton(t,u)&&(this._lastPoint=r,this._eventButton=u)}mousemoveWindow(t,r){const u=this._lastPoint;if(u){if(t.preventDefault(),this._eventButton!=null&&(function(p,_){const y=sd[_];return p.buttons===void 0||(p.buttons&y)!==y})(t,this._eventButton))this.reset();else if(this._moved||!(r.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(u,r)}}mouseupWindow(t){this._lastPoint&&Ss(t)===this._eventButton&&(this._moved&&ln(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kr extends uc{mousedown(t,r){super.mousedown(t,r),this._lastPoint&&(this._active=!0)}_correctButton(t,r){return r===0&&!t.ctrlKey}_move(t,r){return{around:r,panDelta:r.sub(t)}}}class ua extends uc{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?tf[t.pitchRotateKey]:void 0}_correctButton(t,r){return this._pitchRotateKey?r===0&&t[this._pitchRotateKey]:r===0&&t.ctrlKey||r===2}_move(t,r){const u=.8*(r.x-t.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class nf extends uc{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?tf[t.pitchRotateKey]:void 0}_correctButton(t,r){return this._pitchRotateKey?r===0&&t[this._pitchRotateKey]:r===0&&t.ctrlKey||r===2}_move(t,r){const u=-.5*(r.y-t.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Qf{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),o.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(t,r,u){return this._calculateTransform(t,r,u)}touchmove(t,r,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!o.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,r,u)}}touchend(t,r,u){this._calculateTransform(t,r,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,u){u.length>0&&(this._active=!0);const p=cc(u,r),_=new o.P(0,0),y=new o.P(0,0);let b=0;for(const M in p){const I=p[M],P=this._touches[M];P&&(_._add(I),y._add(I.sub(P)),b++,p[M]=I)}if(this._touches=p,b<this._minTouches||!y.mag())return;const T=y.div(b);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(b),panDelta:T}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=hi("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class ld{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,r,u){return{}}touchstart(t,r,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,u){const p=this._firstTwoTouches;if(!p)return;t.preventDefault();const[_,y]=p,b=th(u,r,_),T=th(u,r,y);if(!b||!T)return;const M=this._aroundCenter?null:b.add(T).div(2);return this._move([b,T],M,t)}touchend(t,r,u){if(!this._firstTwoTouches)return;const[p,_]=this._firstTwoTouches,y=th(u,r,p),b=th(u,r,_);y&&b||(this._active&&ln(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function th(c,t,r){for(let u=0;u<c.length;u++)if(c[u].identifier===r)return t[u]}function Qc(c,t){return Math.log2(c/t)}class e1 extends ld{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Qc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Qc(this._distance,u),pinchAround:r}}}function ih(c,t){return 180*c.angleWith(t)/Math.PI}class t1 extends ld{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const u=this._vector;if(this._vector=t[0].sub(t[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ih(this._vector,u),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const p=ih(t,u);return Math.abs(p)<r}}function rf(c){return Math.abs(c.y)>Math.abs(c.x)}class cd extends ld{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,rf(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,u){const p=this._lastPoints;if(!p)return;const _=t[0].sub(p[0]),y=t[1].sub(p[1]);return this._map._cooperativeGestures&&!o.eT()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(_,y,u.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+y.y)/2*-.5})}gestureBeginsVertically(t,r,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,_=r.mag()>=2;if(!p&&!_)return;if(!p||!_)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const y=t.y>0==r.y>0;return rf(t)&&rf(r)&&y}}const af={panStep:100,bearingStep:15,pitchStep:10};class i1{constructor(){const t=af;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,u=0,p=0,_=0,y=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),y=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:b=>{const T=b.getZoom();b.easeTo({duration:300,easeId:"keyboardHandler",easing:n1,zoom:r?Math.round(T)+r*(t.shiftKey?2:1):T,bearing:b.getBearing()+u*this._bearingStep,pitch:b.getPitch()+p*this._pitchStep,offset:[-_*this._panStep,-y*this._panStep],center:b.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function n1(c){return c*(2-c)}const r1=4.000244140625,a1=1/450;class o1{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=a1,o.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||o.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=o.o.now(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,r!==0&&r%r1==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=r,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=ea(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:r,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>r1?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&I!==0&&(I=1/I);const P=r(),z=Math.pow(2,P),O=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(O*I))),this._type==="wheel"&&(this._startZoom=P,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:r(),p=this._startZoom,_=this._easing;let y,b=!1;if(this._type==="wheel"&&p&&_){const M=Math.min((o.o.now()-this._lastWheelEventTime)/200,1),I=_(M);y=o.ak(p,u,I),M<1?this._frameId||(this._frameId=!0):b=!0}else y=u,b=!0;this._active=!0,b&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let T=y-r();return T*this._lastDelta<0&&(T=0),{noInertia:!0,needsRenderFrame:!b,zoomDelta:T,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=o.eU;if(this._prevEase){const u=this._prevEase,p=(o.o.now()-u.start)/u.duration,_=u.easing(p+.01)-u.easing(p),y=.27/Math.sqrt(_*_+1e-4)*.01,b=Math.sqrt(.0729-y*y);r=o.eS(y,b,.25,1)}return this._prevEase={start:o.o.now(),duration:t,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=hi("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class $n{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class s1{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,r){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(t.shiftKey?-1:1),around:u.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class l1{constructor(){this._tap=new il({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,r,u){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=r[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(t,r,u))}touchmove(t,r,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=r[0],_=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,r,u)}touchend(t,r,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(t,r,u)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class of{constructor(t,r,u){this._el=t,this._mousePan=r,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class c1{constructor(t,r,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class nh{constructor(t,r,u,p){this._el=t,this._touchZoom=r,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const eu=c=>c.zoom||c.drag||c.pitch||c.rotate;class sf extends o.z{}class Jo{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,r){const u=o.av([],r,t);this.radius=o.ag(u[2]<0?o.eW([],u,this.constants):[u[0],u[1],0])}projectRay(t){o.eW(t,t,this.constants),o.aw(t,t),o.eX(t,t,this.constants);const r=o.c4([],t,this.radius);if(r[2]>0){const u=o.c4([],[0,0,1],o.bI(r,[0,0,1])),p=o.c4([],o.aw([],[r[0],r[1],0]),this.radius),_=o.d7([],r,o.c4([],o.av([],o.d7([],p,u),r),2));r[0]=_[0],r[1]=_[1]}return r}}function _o(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class lf{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new od(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Jo,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),o.aX(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,_,y]of this._listeners){const b=p===document?this.handleWindowEvent:this.handleEvent;p.addEventListener(_,b,y)}}destroy(){for(const[t,r,u]of this._listeners){const p=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(r,p,u)}}_addDefaultHandlers(t){const r=this._map,u=r.getCanvasContainer();this._add("mapEvent",new Kd(r,t));const p=r.boxZoom=new Jd(r,t);this._add("boxZoom",p);const _=new ef,y=new s1;r.doubleClickZoom=new $n(y,_),this._add("tapZoom",_),this._add("clickZoom",y);const b=new l1;this._add("tapDragZoom",b);const T=r.touchPitch=new cd(r);this._add("touchPitch",T);const M=new ua(t),I=new nf(t);r.dragRotate=new c1(t,M,I),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]);const P=new Kr(t),z=new Qf(r,t);r.dragPan=new of(u,P,z),this._add("mousePan",P),this._add("touchPan",z,["touchZoom","touchRotate"]);const O=new t1,B=new e1;r.touchZoomRotate=new nh(u,B,O,b),this._add("touchRotate",O,["touchPan","touchZoom"]),this._add("touchZoom",B,["touchPan","touchRotate"]),this._add("blockableMapEvent",new lc(r));const N=r.scrollZoom=new o1(r,this);this._add("scrollZoom",N,["mousePan"]);const H=r.keyboard=new i1;this._add("keyboard",H);for(const j of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[j]&&r[j].enable(t[j])}_add(t,r,u){this._handlers.push({handlerName:t,handler:r,allowed:u}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!eu(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,r,u){for(const p in t)if(p!==u&&(!r||r.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const r=[];for(const u of t)this._el.contains(u.target)&&r.push(u);return r}handleEvent(t,r){this._updatingCamera=!0;const u=t.type==="renderFrame",p=u?void 0:t,_={needsRenderFrame:!1},y={},b={},T=t.touches?this._getMapTouches(t.touches):void 0,M=T?Oa(this._el,T):u?void 0:ea(this._el,t);for(const{handlerName:z,handler:O,allowed:B}of this._handlers){if(!O.isEnabled())continue;let N;this._blockedByActive(b,B,z)?O.reset():O[r||t.type]&&(N=O[r||t.type](t,M,T),this.mergeHandlerResult(_,y,N,z,p),N&&N.needsRenderFrame&&this._triggerRenderFrame()),(N||O.isActive())&&(b[z]=O)}const I={};for(const z in this._previousActiveHandlers)b[z]||(I[z]=p);this._previousActiveHandlers=b,(Object.keys(I).length||_o(_))&&(this._changes.push([_,y,I]),this._triggerRenderFrame()),(Object.keys(b).length||_o(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:P}=_;P&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],P(this._map))}mergeHandlerResult(t,r,u,p,_){if(!u)return;Object.assign(t,u);const y={handlerName:p,originalEvent:u.originalEvent||_};u.zoomDelta!==void 0&&(r.zoom=y),u.panDelta!==void 0&&(r.drag=y),u.pitchDelta!==void 0&&(r.pitch=y),u.bearingDelta!==void 0&&(r.rotate=y)}_applyChanges(){const t={},r={},u={};for(const[p,_,y]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new o.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.aroundCoord!==void 0&&(t.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),Object.assign(r,_),Object.assign(u,y);this._updateMapTransform(t,r,u),this._changes=[]}_updateMapTransform(t,r,u){const p=this._map,_=p.transform,y=Z=>[Z.x,Z.y,Z.z];if((Z=>{const K=this._eventsInProgress.drag;return K&&!this._handlersById[K.handlerName].isActive()})()&&!_o(t)){const Z=_.zoom;_.cameraElevationReference="sea",this._originalZoom!=null&&_._orthographicProjectionAtLowPitch&&_.projection.name!=="globe"&&_.pitch===0?(_.cameraElevationReference="ground",_.zoom=this._originalZoom):(_.recenterOnTerrain(),_.cameraElevationReference="ground"),Z!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&p._stop(!0),!_o(t))return void this._fireEvents(r,u,!0);let{panDelta:b,zoomDelta:T,bearingDelta:M,pitchDelta:I,around:P,aroundCoord:z,pinchAround:O}=t;_._isCameraConstrained&&(T>0&&(T=0),_._isCameraConstrained=!1),O!==void 0&&(P=O),(T||(Z=>r[Z]&&!this._eventsInProgress[Z])("drag"))&&P&&(this._dragOrigin=y(_.pointCoordinate3D(P)),this._originalZoom=_.zoom,this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",p._stop(!0),P=P||p.transform.centerPoint,M&&(_.bearing+=M),I&&(_.pitch+=I),_._updateCameraState();const B=[0,0,0];if(b)if(_.projection.name==="mercator"){const Z=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(P).dir),K=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(P.sub(b)).dir);B[0]=K[0]-Z[0],B[1]=K[1]-Z[1]}else{const Z=_.pointCoordinate(P);if(_.projection.name==="globe"){b=b.rotate(-_.angle);const K=_._pixelsPerMercatorPixel/_.worldSize;B[0]=-b.x*o.eV(o.a_(Z.y))*K,B[1]=-b.y*o.eV(_.center.lat)*K}else{const K=_.pointCoordinate(P.sub(b));Z&&K&&(B[0]=K.x-Z.x,B[1]=K.y-Z.y)}}const N=_.zoom,H=[0,0,0];if(T){const Z=y(z||_.pointCoordinate3D(P)),K={dir:o.aw([],o.av([],Z,_._camera.position))};if(K.dir[2]<0){const W=_.zoomDeltaToMovement(Z,T);o.c4(H,K.dir,W)}}const j=o.d7(B,B,H);_._translateCameraConstrained(j),T&&Math.abs(_.zoom-N)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,u,!0)}_fireEvents(t,r,u){const p=eu(this._eventsInProgress),_=eu(t),y={};for(const I in t){const{originalEvent:P}=t[I];this._eventsInProgress[I]||(y[`${I}start`]=P),this._eventsInProgress[I]=t[I]}!p&&_&&this._fireEvent("movestart",_.originalEvent);for(const I in y)this._fireEvent(I,y[I]);_&&this._fireEvent("move",_.originalEvent);for(const I in t){const{originalEvent:P}=t[I];this._fireEvent(I,P)}const b={};let T;for(const I in this._eventsInProgress){const{handlerName:P,originalEvent:z}=this._eventsInProgress[I];this._handlersById[P].isActive()||(delete this._eventsInProgress[I],T=r[P]||z,b[`${I}end`]=T)}for(const I in b)this._fireEvent(I,b[I]);const M=eu(this._eventsInProgress);if(u&&(p||_)&&!M){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;I?(P(I.bearing||this._map.getBearing())&&(I.bearing=0),this._map.easeTo(I,{originalEvent:T})):(this._map.fire(new o.z("moveend",{originalEvent:T})),P(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new o.z(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new sf("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Mr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ia extends o.E{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=r.respectPrefersReducedMotion!==!1,o.aX(["_renderFrameCallback"],this)}getCenter(){return new o.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,u){return t=o.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},r),u)}panTo(t,r,u){return this.easeTo(Object.assign({center:t},r),u)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,u){return this.easeTo(Object.assign({zoom:t},r),u)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,u){return this.easeTo(Object.assign({bearing:t},r),u)}resetNorth(t,r){return this.rotateTo(0,Object.assign({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=o.aI.convert(t);const u=r&&r.bearing||0,p=r&&r.pitch||0,_=t.getNorthWest(),y=t.getSouthEast();return this._cameraForBounds(this.transform,_,y,u,p,r)}_extendPadding(t){const r={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},r,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},r,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,r){const u=r.max[0]-r.min[0],p=r.max[1]-r.min[1];return u/p>t.aspect?u/(2*Math.tan(.5*t.fovX)*t.aspect):p/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,r,u,p,_,y){const b=t.clone(),T=this._extendCameraOptions(y);b.bearing=p,b.pitch=_;const M=o.aS.convert(r),I=o.aS.convert(u),P=.5*(M.lat+I.lat),z=.5*(M.lng+I.lng),O=o.eY(P,z),B=o.aw([],O),N=o.aw([],o.bH([],B,[0,1,0])),H=o.bH([],N,B),j=[N[0],N[1],N[2],0,H[0],H[1],H[2],0,B[0],B[1],B[2],0,0,0,0,1],Z=[O,o.eY(M.lat,M.lng),o.eY(I.lat,M.lng),o.eY(I.lat,I.lng),o.eY(M.lat,I.lng),o.eY(P,M.lng),o.eY(P,I.lng),o.eY(M.lat,z),o.eY(I.lat,z)];let K=o.d8.fromPoints(Z.map((Re=>[o.bI(N,Re),o.bI(H,Re),o.bI(B,Re)])));const W=o.af([],K.center,j);o.eZ(W)===0&&o.e_(W,0,0,1),o.aw(W,W),o.c4(W,W,o.aD),b.center=o.e$(W);const se=b.getWorldToCameraMatrix(),Q=o.bk(new Float64Array(16),se);K=o.d8.applyTransform(K,o.aB([],se,j));const ce=this._extendAABB(K,b,T,p);if(!ce)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");K=ce,o.af(W,W,se);const ie=.5*(K.max[2]-K.min[2]),te=this._minimumAABBFrustumDistance(b,K),ue=o.c4([],[0,0,1],ie),we=o.d7(ue,W,ue),ve=te+(b.pitch===0?0:o.bF(W,we)),Oe=b.globeCenterInViewSpace,ze=o.av([],W,[Oe[0],Oe[1],Oe[2]]);o.aw(ze,ze),o.c4(ze,ze,ve);const je=o.d7([],W,ze);o.af(je,je,Q);const lt=o.eL/o.aD,Me=o.ag(je),ge=o.ce(Math.max(Me*lt-o.eL,Number.EPSILON),0),Ge=Math.min(b.zoomFromMercatorZAdjusted(ge),T.maxZoom);return Ge>.5*(o.cZ+o.cK)?(b.setProjection({name:"mercator"}),b.zoom=Ge,this._cameraForBounds(b,r,u,p,_,y)):{center:b.center,zoom:Ge,bearing:p,pitch:_}}_extendAABB(t,r,u,p){const _=.5*((u.padding.left||0)+(u.padding.right||0)),y=.5*((u.padding.top||0)+(u.padding.bottom||0)),b=y,T=_,M=_,I=y,P=r.width-(T+M),z=r.height-(b+I),O=o.av([],t.max,t.min),B=Math.min(P/O[0],z/O[1]),N=Math.min(r.scaleZoom(r.scale*B),u.maxZoom);if(isNaN(N))return null;const H=r.scale/r.zoomScale(N),j=new o.d8([t.min[0]-T*H,t.min[1]-I*H,t.min[2]],[t.max[0]+M*H,t.max[1]+b*H,t.max[2]]),Z=(typeof u.offset.x=="number"&&typeof u.offset.y=="number"?new o.P(u.offset.x,u.offset.y):o.P.convert(u.offset)).rotate(-o.an(p));return j.center[0]-=Z.x*H,j.center[1]+=Z.y*H,j}queryTerrainElevation(t,r){const u=this.transform.elevation;return u?(r=Object.assign({},{exaggerated:!0},r),u.getAtPoint(o.ae.fromLngLat(t),null,r.exaggerated)):null}_cameraForBounds(t,r,u,p,_,y){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,r,u,p,_,y);const b=t.clone(),T=this._extendCameraOptions(y);b.bearing=p,b.pitch=_;const M=o.aS.convert(r),I=o.aS.convert(u),P=new o.aS(M.lng,I.lat),z=new o.aS(I.lng,M.lat),O=b.project(M),B=b.project(I),N=this.queryTerrainElevation(M),H=this.queryTerrainElevation(I),j=this.queryTerrainElevation(P),Z=this.queryTerrainElevation(z),K=[[O.x,O.y,Math.min(N||0,H||0,j||0,Z||0)],[B.x,B.y,Math.max(N||0,H||0,j||0,Z||0)]];let W=o.d8.fromPoints(K);const se=b.getWorldToCameraMatrix(),Q=o.bk(new Float64Array(16),se);W=o.d8.applyTransform(W,se);const ce=this._extendAABB(W,b,T,p);if(!ce)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");W=ce;const ie=.5*o.av([],W.max,W.min)[2],te=this._minimumAABBFrustumDistance(b,W),ue=[0,0,1,0];o.aC(ue,ue,se),o.f0(ue,ue);const we=o.c4([],ue,te+ie),ve=o.d7([],W.center,we);o.af(W.center,W.center,Q),o.af(ve,ve,Q);const Oe=b.unproject(new o.P(W.center[0],W.center[1])),ze=o.f1(b.projection,Oe),je=Math.pow(2,ze),lt=Math.min(b._zoomFromMercatorZ(ve[2]*b.pixelsPerMeter*je/b.worldSize),T.maxZoom);return b.mercatorFromTransition&&lt<.5*(o.cZ+o.cK)?(b.setProjection({name:"globe"}),b.zoom=lt,this._cameraForBounds(b,r,u,p,_,y)):{center:Oe,zoom:lt,bearing:p,pitch:_}}fitBounds(t,r,u){const p=this.cameraForBounds(t,r);return this._fitInternal(p,r,u)}fitScreenCoordinates(t,r,u,p,_){const y=o.P.convert(t),b=o.P.convert(r),T=new o.P(Math.min(y.x,b.x),Math.min(y.y,b.y)),M=new o.P(Math.max(y.x,b.x),Math.max(y.y,b.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(y,b))return this;const I=this.transform.pointLocation3D(T),P=this.transform.pointLocation3D(M),z=this.transform.pointLocation3D(new o.P(T.x,M.y)),O=this.transform.pointLocation3D(new o.P(M.x,T.y)),B=[Math.min(I.lng,P.lng,z.lng,O.lng),Math.min(I.lat,P.lat,z.lat,O.lat)],N=[Math.max(I.lng,P.lng,z.lng,O.lng),Math.max(I.lat,P.lat,z.lat,O.lat)],H=p&&p.pitch?p.pitch:this.getPitch(),j=this._cameraForBounds(this.transform,B,N,u,H,p);return this._fitInternal(j,p,_)}_fitInternal(t,r,u){return t?(r=Object.assign(t,r)).linear?this.easeTo(r,u):this.flyTo(r,u):this}jumpTo(t,r){this.stop();const u=t.preloadOnly?this.transform.clone():this.transform;let p=!1,_=!1,y=!1;"zoom"in t&&u.zoom!==+t.zoom&&(p=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=o.aS.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(_=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(y=!0,u.pitch=+t.pitch);const b=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!u.isPaddingEqual(b))if(t.retainPadding===!1){const T=u.clone();T.padding=b,u.setLocationAtPoint(u.center,T.centerPoint)}else u.padding=b;return t.preloadOnly?(this._preloadTiles(u),this):(this.fire(new o.z("movestart",r)).fire(new o.z("move",r)),p&&this.fire(new o.z("zoomstart",r)).fire(new o.z("zoom",r)).fire(new o.z("zoomend",r)),_&&this.fire(new o.z("rotatestart",r)).fire(new o.z("rotate",r)).fire(new o.z("rotateend",r)),y&&this.fire(new o.z("pitchstart",r)).fire(new o.z("pitch",r)).fire(new o.z("pitchend",r)),this.fire(new o.z("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(Mr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,r){const u=this.transform;if(!u.projection.supportsFreeCamera)return o.w(Mr),this;this.stop();const p=u.zoom,_=u.pitch,y=u.bearing;u.setFreeCameraOptions(t);const b=p!==u.zoom,T=_!==u.pitch,M=y!==u.bearing;return this.fire(new o.z("movestart",r)).fire(new o.z("move",r)),b&&this.fire(new o.z("zoomstart",r)).fire(new o.z("zoom",r)).fire(new o.z("zoomend",r)),M&&this.fire(new o.z("rotatestart",r)).fire(new o.z("rotate",r)).fire(new o.z("rotateend",r)),T&&this.fire(new o.z("pitchstart",r)).fire(new o.z("pitch",r)).fire(new o.z("pitchend",r)),this.fire(new o.z("moveend",r)),this}easeTo(t,r){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:o.eU},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const u=this.transform,p=this.getZoom(),_=this.getBearing(),y=this.getPitch(),b=this.getPadding(),T="zoom"in t?+t.zoom:p,M="bearing"in t?this._normalizeBearing(t.bearing,_):_,I="pitch"in t?+t.pitch:y,P=this._extendPadding(t.padding),z=o.P.convert(t.offset);let O,B,N;if(u.projection.name==="globe"){const ue=o.ae.fromLngLat(u.center),we=z.rotate(-u.angle);ue.x+=we.x/u.worldSize,ue.y+=we.y/u.worldSize;const ve=ue.toLngLat(),Oe=o.aS.convert(t.center||ve);this._normalizeCenter(Oe),O=u.centerPoint.add(we),B=new o.P(ue.x,ue.y).mult(u.worldSize),N=new o.P(o.aF(Oe.lng),o.aJ(Oe.lat)).mult(u.worldSize).sub(B)}else{O=u.centerPoint.add(z);const ue=u.pointLocation(O),we=o.aS.convert(t.center||ue);this._normalizeCenter(we),B=u.project(ue),N=u.project(we).sub(B)}const H=u.zoomScale(T-p);let j,Z;t.around&&(j=o.aS.convert(t.around),Z=u.locationPoint(j));const K=this._zooming||T!==p,W=this._rotating||_!==M,se=this._pitching||I!==y,Q=!u.isPaddingEqual(P),ce=t.retainPadding===!1?u.clone():u,ie=ue=>we=>{if(K&&(ue.zoom=o.ak(p,T,we)),W&&(ue.bearing=o.ak(_,M,we)),se&&(ue.pitch=o.ak(y,I,we)),Q&&(ce.interpolatePadding(b,P,we),O=ce.centerPoint.add(z)),j)ue.setLocationAtPoint(j,Z);else{const ve=ue.zoomScale(ue.zoom-p),Oe=T>p?Math.min(2,H):Math.max(.5,H),ze=Math.pow(Oe,1-we),je=ue.unproject(B.add(N.mult(we*ze)).mult(ve));ue.setLocationAtPoint(ue.renderWorldCopies?je.wrap():je,O)}return t.preloadOnly||this._fireMoveEvents(r),ue};if(t.preloadOnly){const ue=this._emulate(ie,t.duration,u);return this._preloadTiles(ue),this}const te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=K,this._rotating=W,this._pitching=se,this._padding=Q,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,te),this._ease(ie(u),(ue=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(r,ue)}),t),this}_prepareEase(t,r,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),r||u.moving||this.fire(new o.z("movestart",t)),this._zooming&&!u.zooming&&this.fire(new o.z("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new o.z("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new o.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new o.z("move",t)),this._zooming&&this.fire(new o.z("zoom",t)),this._rotating&&this.fire(new o.z("rotate",t)),this._pitching&&this.fire(new o.z("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,p=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new o.z("zoomend",t)),p&&this.fire(new o.z("rotateend",t)),_&&this.fire(new o.z("pitchend",t)),this.fire(new o.z("moveend",t))}flyTo(t,r){if(this._prefersReducedMotion(t)){const Re=o.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Re,r)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:o.eU},t);const u=this.transform,p=this.getZoom(),_=this.getBearing(),y=this.getPitch(),b=this.getPadding(),T="zoom"in t?o.aA(+t.zoom,u.minZoom,u.maxZoom):p,M="bearing"in t?this._normalizeBearing(t.bearing,_):_,I="pitch"in t?+t.pitch:y,P=this._extendPadding(t.padding),z=u.zoomScale(T-p),O=o.P.convert(t.offset);let B=u.centerPoint.add(O);const N=u.pointLocation(B),H=o.aS.convert(t.center||N);this._normalizeCenter(H);const j=u.project(N),Z=u.project(H).sub(j);let K=t.curve;const W=Math.max(u.width,u.height),se=W/z,Q=Z.mag();if("minZoom"in t){const Re=o.aA(Math.min(t.minZoom,p,T),u.minZoom,u.maxZoom),it=W/u.zoomScale(Re-p);K=Math.sqrt(it/Q*2)}const ce=K*K;function ie(Re){const it=(se*se-W*W+(Re?-1:1)*ce*ce*Q*Q)/(2*(Re?se:W)*ce*Q);return Math.log(Math.sqrt(it*it+1)-it)}function te(Re){return(Math.exp(Re)-Math.exp(-Re))/2}function ue(Re){return(Math.exp(Re)+Math.exp(-Re))/2}const we=ie(0);let ve=function(Re){return ue(we)/ue(we+K*Re)},Oe=function(Re){return W*((ue(we)*(te(it=we+K*Re)/ue(it))-te(we))/ce)/Q;var it},ze=(ie(1)-we)/K;if(Math.abs(Q)<1e-6||!isFinite(ze)){if(Math.abs(W-se)<1e-6)return this.easeTo(t,r);const Re=se<W?-1:1;ze=Math.abs(Math.log(se/W))/K,Oe=function(){return 0},ve=function(it){return Math.exp(Re*K*it)}}t.duration="duration"in t?+t.duration:1e3*ze/("screenSpeed"in t?+t.screenSpeed/K:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const je=_!==M,lt=I!==y,Me=!u.isPaddingEqual(P),ge=t.retainPadding===!1?u.clone():u,Ge=Re=>it=>{const Je=it*ze,vt=1/ve(Je);Re.zoom=it===1?T:p+Re.scaleZoom(vt),je&&(Re.bearing=o.ak(_,M,it)),lt&&(Re.pitch=o.ak(y,I,it)),Me&&(ge.interpolatePadding(b,P,it),B=ge.centerPoint.add(O));const Ze=it===1?H:Re.unproject(j.add(Z.mult(Oe(Je))).mult(vt));return Re.setLocationAtPoint(Re.renderWorldCopies?Ze.wrap():Ze,B),Re._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(r),Re};if(t.preloadOnly){const Re=this._emulate(Ge,t.duration,u);return this._preloadTiles(Re),this}return this._zooming=!0,this._rotating=je,this._pitching=lt,this._padding=Me,this._prepareEase(r,!1),this._ease(Ge(u),(()=>this._afterEase(r)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,r)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,r,u){u.animate===!1||u.duration===0?(t(1),r()):(this._easeStart=o.o.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((o.o.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=o.bS(t,-180,180);const u=Math.abs(t-r);return Math.abs(t-360-r)<u&&(t-=360),Math.abs(t+360-r)<u&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(r.maxBounds||r.projection.name!=="globe"&&!r.renderWorldCopies)return;const u=t.lng-r.center.lng;t.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&o.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,r,u){const p=Math.ceil(15*r/1e3),_=[],y=t(u.clone());for(let b=0;b<=p;b++){const T=y(b/p);_.push(T.clone())}return _}_preloadTiles(t,r){}}class hc{constructor(t={}){this.options=t,o.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const r=this.options&&this.options.compact,u=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=hi("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=hi("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",u);const p=hi("span","mapboxgl-ctrl-icon",this._compactButton);return p.setAttribute("aria-hidden","true"),p.setAttribute("title",u),this._innerContainer=hi("div","mapboxgl-ctrl-attrib-inner",this._container),r&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),r===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(t){const u=r.reduce(((p,_,y)=>(_.value&&(p+=`${_.key}=${_.value}${y<r.length-1?"&":""}`),p)),"?");t.href=`${o.e.FEEDBACK_URL}/${u}#${Wc(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const r=this._map.style._mergedSourceCaches;for(const p in r){const _=r[p];if(_.used){const y=_.getSource();y.attribution&&t.indexOf(y.attribution)<0&&t.push(y.attribution)}}t.sort(((p,_)=>p.length-_.length)),t=t.filter(((p,_)=>{for(let y=_+1;y<t.length;y++)if(t[y].indexOf(p)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class rh{constructor(){o.aX(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=hi("div","mapboxgl-ctrl");const r=hi("a","mapboxgl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://www.mapbox.com/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const r in t){const u=t[r].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const r=t[0];this._map.getCanvasContainer().offsetWidth<250?r.classList.add("mapboxgl-compact"):r.classList.remove("mapboxgl-compact")}}}class ah{constructor(){o.aX(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=hi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",(r=>this._onIndoorUpdate(r))),this._container}_createButton(t,r){const u=hi("button",t,this._container);return u.type="button",u.addEventListener("click",r),u}_createSeparator(){return hi("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,r){this._map&&(t.setAttribute("aria-label",r),t.textContent=r)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return this._model=t,void(this._container.style.display="none");const r=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px",r&&Array.from(this._container.children).forEach((u=>u.remove())),t.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(t.floors,t.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const t=this._createButton("mapboxgl-ctrl-buildings-toggle",(()=>{const r=this._map;this._model&&r&&r._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)}));hi("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&t.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(t),this._createSeparator()}_updateBuildingsButtonState(){const t=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");t&&this._model&&(this._model.activeFloorsVisible?t.classList.remove("mapboxgl-ctrl-level-button-selected"):t.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(t,r){for(let u=0;u<t.length;u++){const p=t[u],_=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(p.id)}));this._setButtonTitle(_,p.zIndex.toString()),this._model&&p.id===this._model.selectedFloorId&&r&&_.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(_),u<t.length-1&&this._createSeparator()}}}class oh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,u=r?this._queue.concat(r):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){const r=this._currentlyRunning=this._queue;this._queue=[];for(const u of r)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Tr{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const r=o.dC((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,r,u){this._start=this.getValue(r),this._end=t,this._startTime=r,this._endTime=r+u}}const Hp={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class ip extends o.z{constructor(t,r,u,p){const{point:_,lngLat:y,originalEvent:b,target:T}=t;super(t.type,{point:_,lngLat:y,originalEvent:b,target:T}),this.preventDefault=()=>{t.preventDefault()},this.id=r,this.interaction=u,this.feature=p}}class cf{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,r){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const u=r.filter;let p=r.type;u&&this.filters.set(t,o.b5(u)),p==="mouseover"&&(p="mouseenter"),p==="mouseout"&&(p="mouseleave");const _=this.interactionsByType.get(p)||new Map;p==="mouseenter"||p==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,r)):_.size===0&&this.map.on(p,this.handleType),_.size===0&&this.interactionsByType.set(p,_),_.set(t,r),this.typeById.set(t,p)}get(t){const r=this.typeById.get(t);if(!r)return;const u=this.interactionsByType.get(r);return u?u.get(t):void 0}remove(t){const r=this.typeById.get(t);if(!r)return;this.typeById.delete(t),this.filters.delete(t);const u=this.interactionsByType.get(r);u&&(u.delete(t),r==="mouseenter"||r==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):u.size===0&&this.map.off(r,this.handleType))}queryTargets(t,r){const u=[];for(const[p,_]of r)_.target&&u.push({targetId:p,target:_.target,filter:this.filters.get(p)});return this.map.style.queryRenderedTargets(t,u,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const r=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());r.length&&(t.type="mouseenter",this.handleType(t,r));const u=new Map;for(const[p,{feature:_}]of this.prevHoveredFeatures)this.hoveredFeatures.has(p)||u.set(_.id,_);u.size&&(t.type="mouseleave",this.handleType(t,Array.from(u.values())))}handleOut(t){const r=Array.from(this.hoveredFeatures.values()).map((({feature:u})=>u));r.length&&(t.type="mouseleave",this.handleType(t,r)),this.hoveredFeatures.clear()}handleType(t,r){const u=t.type==="mouseenter";if(u&&!this.interactionsByType.has(t.type))return void o.w("mouseenter interaction required for mouseleave to work.");const p=Array.from(this.interactionsByType.get(t.type)).reverse(),_=!!r;r=r||this.queryTargets(t.point,p);let y=!1;const b=new Set;for(const T of r){for(const[M,I]of p){if(!I.target)continue;const P=T.variants?T.variants[M]:null;if(P){for(const z of P){if(ka(z,T,b,M))continue;const O=new o.dw(T,z),B=No(z,T,M);_&&O.id!==void 0&&(O.state=this.map.getFeatureState(O));const N=u?this.prevHoveredFeatures.get(B):null,H=new ip(t,M,I,O),j=N?N.stop:I.handler(H);if(u&&this.hoveredFeatures.set(B,{feature:T,stop:j}),j!==!1){y=!0;break}}if(y)break}}if(y)break}if(!y)for(const[T,M]of p){const{handler:I,target:P}=M;if(!P&&I(new ip(t,T,M,null))!==!1)break}}}function tu(c,t){if(Array.isArray(c)&&Array.isArray(t)){const r=new Set(c),u=new Set(t);return r.size===u.size&&c.every((p=>u.has(p)))}return o.bx(c,t)}const gs={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},ud={showCompass:!0,showZoom:!0,visualizePitch:!1};class sh{constructor(t,r,u=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new ua({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,u&&(this.mousePitch=new nf({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),o.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(t,r){this.mouseRotate.mousedown(t,r),this.mousePitch&&this.mousePitch.mousedown(t,r),si()}move(t,r){const u=this.map,p=this.mouseRotate.mousemoveWindow(t,r),_=p&&p.bearingDelta;if(_&&u.setBearing(u.getBearing()+_),this.mousePitch){const y=this.mousePitch.mousemoveWindow(t,r),b=y&&y.pitchDelta;b&&u.setPitch(u.getPitch()+b)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){_n(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),ea(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,ea(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Oa(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Oa(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Lo(c,t,r){if(c=new o.aS(c.lng,c.lat),t){const u=new o.aS(c.lng-360,c.lat),p=new o.aS(c.lng+360,c.lat),_=360*Math.ceil(Math.abs(c.lng-r.center.lng)/360),y=r.locationPoint3D(c).distSqr(t),b=t.x<0||t.y<0||t.x>r.width||t.y>r.height;r.locationPoint3D(u).distSqr(t)<y&&(b||Math.abs(u.lng-r.center.lng)<_)?c=u:r.locationPoint3D(p).distSqr(t)<y&&(b||Math.abs(p.lng-r.center.lng)<_)&&(c=p)}for(;Math.abs(c.lng-r.center.lng)>180;){const u=r.locationPoint3D(c);if(u.x>=0&&u.y>=0&&u.x<=r.width&&u.y<=r.height)break;c.lng>r.center.lng?c.lng-=360:c.lng+=360}return c}const ha={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},va={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class ys extends o.E{constructor(t,r){super(),(t instanceof HTMLElement||r)&&(t=Object.assign({element:t},r)),o.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:u="center",color:p="#3FB1CE",scale:_=1,draggable:y=!1,clickTolerance:b=0,rotation:T=va.rotation,rotationAlignment:M=va.rotationAlignment,pitchAlignment:I=va.pitchAlignment,occludedOpacity:P=va.occludedOpacity,altitude:z=va.altitude}=t||{};this._anchor=u,this._color=p,this._scale=_,this._draggable=y,this._clickTolerance=b,this._rotation=T,this._rotationAlignment=M,this._pitchAlignment=I,this._occludedOpacity=P,this._altitude=z,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=o.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(N=>{N.preventDefault()})),this._element.addEventListener("mousedown",(N=>{N.preventDefault()}));const O=this._element.classList;for(const N in ha)O.remove(`mapboxgl-marker-anchor-${N}`);O.add(`mapboxgl-marker-anchor-${this._anchor}`);const B=t&&t.className?t.className.trim().split(/\s+/):[];O.add(...B),this._popup=null}_createDefaultMarker(){const t=hi("div"),r=$i("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const u=$i("radialGradient",{id:"shadowGradient"},$i("defs",{},r));$i("stop",{offset:"10%","stop-opacity":.4},u),$i("stop",{offset:"100%","stop-opacity":.05},u),$i("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},r)}return $i("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},r),$i("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},r),$i("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},r),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.aS.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||va.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const r=t.code,u=t.charCode||t.keyCode;r!=="Space"&&r!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(t){const r=t.originalEvent.target,u=this._element;this._popup&&(r===u||u.contains(r))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,r=this._pos;if(!t||!r)return!1;const u=t.unproject(r,this._altitude),p=t.getFreeCameraOptions();if(!p.position)return!1;const _=p.position.toLngLat();return _.distanceTo(u)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)return void this._clearFadeTimer();const u=t.unproject(r,this._altitude);let p;t._showingGlobe()&&o.f4(t.transform,this._lngLat)?p=0:(p=1-t._queryFogOpacity(u),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const r=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${ha[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${r.x}px,${r.y}px)
        `}_calculateXYTransform(){const t=this._pos,r=this._map,u=this.getPitchAlignment();if(!r||!t||u!=="map")return"";if(!r._showingGlobe()){const T=r.getPitch();return T?`rotateX(${T}deg)`:""}const p=o.cW(o.f5(r.transform,this._lngLat)),_=t.sub(o.f6(r.transform)),y=Math.abs(_.x)+Math.abs(_.y);if(y===0)return"";const b=p/y;return`rotateX(${-_.y*b}deg) rotateY(${_.x*b}deg)`}_calculateZTransform(){const t=this._pos,r=this._map;if(!r||!t)return"";let u=0;const p=this.getRotationAlignment();if(p==="map")if(r._showingGlobe()){const _=r.project(new o.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),y=r.project(new o.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(_);u=o.cW(Math.atan2(y.y,y.x))-90}else u=-r.getBearing();else if(p==="horizon"){const _=o.ah(4,6,r.getZoom()),y=o.f6(r.transform);y.y+=_*r.transform.height;const b=t.sub(y),T=o.cW(Math.atan2(b.y,b.x));u=(T>90?T-270:T+90)*(1-_)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const r=this._map;r&&(r.transform.renderWorldCopies&&(this._lngLat=Lo(this._lngLat,this._pos,r.transform)),this._pos=r.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),r._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(r._showingGlobe()||r.getTerrain()||r.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=o.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const r=this._map;if(!r)return;const u=this._pointerdownPos,p=this._positionDelta;if(u&&p){if(!this._isDragging){const _=this._clickTolerance||r._clickTolerance;if(t.point.dist(u)<_)return;this._isDragging=!0}this._pos=t.point.sub(p),this._lngLat=r.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.z("dragstart"))),this.fire(new o.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.z("dragend")),this._state="inactive"}_addDragHandler(t){const r=this._map,u=this._pos;r&&u&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(u),this._pointerdownPos=t.point,this._state="pending",r.on("mousemove",this._onMove),r.on("touchmove",this._onMove),r.once("mouseup",this._onUp),r.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const r=this._map;return r&&(t?(r.on("mousedown",this._addDragHandler),r.on("touchstart",this._addDragHandler)):(r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||va.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||va.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||va.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||va.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Qo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},u1={maxWidth:100,unit:"metric"},h1={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},uf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},np=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function vs(c=new o.P(0,0),t="bottom"){if(typeof c=="number"){const r=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(t){case"top":return new o.P(0,c);case"top-left":return new o.P(r,r);case"top-right":return new o.P(-r,r);case"bottom":return new o.P(0,-c);case"bottom-left":return new o.P(r,-r);case"bottom-right":return new o.P(-r,-r);case"left":return new o.P(c,0);case"right":return new o.P(-c,0)}return new o.P(0,0)}return c instanceof o.P||Array.isArray(c)?o.P.convert(c):o.P.convert(c[t]||[0,0])}return{version:Tt,supported:yn.supported,setRTLTextPlugin:o.fa,getRTLTextPluginStatus:o.f9,Map:class extends Ia{constructor(c){ci.mark(We.create);const t=c;if((c=Object.assign({},gs,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&o.f2(window)&&(c.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ea(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies,null,null),c),this._repaint=!!c.repaint,this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._collectResourceTiming=c.collectResourceTiming,this._language=this._parseLanguage(c.language),this._worldview=c.worldview,this._renderTaskQueue=new oh,this._domRenderTaskQueue=new oh,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.b1(),this._locale=Object.assign({},Hp,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._performanceMetricsCollection=c.performanceMetricsCollection,this._tessellationStep=c.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=c.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Tr(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=c.scaleFactor,this._requestManager=new Bo(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,this._contextCreateOptions=c.contextCreateOptions?Object.assign({},c.contextCreateOptions):{},typeof c.container=="string"){const r=document.getElementById(c.container);if(!r)throw new Error(`Container '${c.container.toString()}' not found.`);this._container=r}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),this._spriteFormat=c.spriteFormat,o.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new ep),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor)})),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new lf(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,(c.style||!c.testMode)&&this.setStyle(c.style||o.e.DEFAULT_STYLE,{config:c.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),c.hash&&(this._hash=new eh(typeof c.hash=="string"&&c.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch});const r=c.bounds;r&&(this.resize(),this.fitBounds(r,Object.assign({},c.fitBoundsOptions,{duration:0})))}this.resize(),c.attributionControl&&this.addControl(new hc({customAttribution:c.customAttribution})),this._logoControl=new rh,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()})),this.on("data",(r=>{this._update(r.dataType==="style"),this.fire(new o.z(`${r.dataType}data`,r))})),this.on("dataloading",(r=>{this.fire(new o.z(`${r.dataType}dataloading`,r))})),this._interactions=new cf(this)}_getMapId(){return this._mapId}addControl(c,t){if(t===void 0&&(t=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new o.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=c.onAdd(this);this._controls.push(c);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(r,u.firstChild):u.appendChild(r),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new o.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(c);return t>-1&&this._controls.splice(t,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new o.z("movestart",c)).fire(new o.z("move",c)),this.fire(new o.z("resize",c)),t&&this.fire(new o.z("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(o.aI.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(c){return this._scaleFactor=c,this.painter.scaleFactor=c,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((t=>t.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(c){return c==="auto"?navigator.language:Array.isArray(c)?c.length===0?void 0:c.map((t=>t==="auto"?navigator.language:t)):c}setLanguage(c){const t=this._parseLanguage(c);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){return this.style&&c!==this._worldview?(this._worldview=c,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,t=c.projection.name;let r;t==="globe"&&c.zoom>=o.cK?(c.setMercatorFromTransition(),r=!0):t==="mercator"&&c.zoom<o.cK&&(c.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(c,t){return this._updateProjection(c||t||{name:"mercator"})}_updateProjection(c){let t;const r=this.transform.mercatorFromTransition;t=c.name==="globe"&&this.transform.zoom>=o.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate();const u=this.transform.getProjection().name==="mercator"&&r!==this.transform.mercatorFromTransition;return(t||u)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(c,t){return this.transform.locationPoint3D(o.aS.convert(c),t)}unproject(c,t){return this.transform.pointLocation3D(o.P.convert(c),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(c,t,r){const u=p=>{let _=[];if(Array.isArray(t)){const y=t.filter((b=>this.getLayer(b)));_=y.length?this.queryRenderedFeatures(p,{layers:y}):[]}else _=this.queryRenderedFeatures(p,{target:t});return _};if(c==="mouseenter"||c==="mouseover"){let p=!1;return{listener:r,targets:t,delegates:{mousemove:y=>{const b=u(y.point);b.length?p||(p=!0,r.call(this,new Hn(c,this,y.originalEvent,{features:b}))):p=!1},mouseout:()=>{p=!1}}}}if(c==="mouseleave"||c==="mouseout"){let p=!1;return{listener:r,targets:t,delegates:{mousemove:b=>{u(b.point).length?p=!0:p&&(p=!1,r.call(this,new Hn(c,this,b.originalEvent)))},mouseout:b=>{p&&(p=!1,r.call(this,new Hn(c,this,b.originalEvent)))}}}}{const p=_=>{const y=u(_.point);y.length&&(_.features=y,r.call(this,_),delete _.features)};return{listener:r,targets:t,delegates:{[c]:p}}}}on(c,t,r){if(typeof t=="function"||r===void 0)return super.on(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(c,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(u);for(const p in u.delegates)this.on(p,u.delegates[p]);return this}once(c,t,r){if(typeof t=="function"||r===void 0)return super.once(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(c,t,r);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(c,t,r){if(typeof t=="function"||r===void 0)return super.off(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._delegatedListeners?this._delegatedListeners[c]:void 0;return u&&(p=>{for(let _=0;_<p.length;_++){const y=p[_];if(y.listener===r&&tu(y.targets,t)){for(const b in y.delegates)this.off(b,y.delegates[b]);return p.splice(_,1),this}}})(u),this}queryRenderedFeatures(c,t){if(!this.style)return[];if(c===void 0||c instanceof o.P||Array.isArray(c)||t!==void 0||(t=c,c=void 0),c=c||[[0,0],[this.transform.width,this.transform.height]],!t){const _=this.style.queryRenderedFeatures(c,void 0,this.transform),y=this.style.queryRenderedFeatureset(c,void 0,this.transform);return _.concat(y)}let r=!0;if(t.target&&(r=this._isTargetValid(t.target),r&&!t.layers))return this.style.queryRenderedFeatureset(c,t,this.transform);let u=!0;if(t.layers&&Array.isArray(t.layers)){for(const _ of t.layers)if(!this._isValidId(_)){u=!1;break}if(u&&!t.target)return this.style.queryRenderedFeatures(c,t,this.transform)}let p=[];return u&&(p=p.concat(this.style.queryRenderedFeatures(c,t,this.transform))),r&&(p=p.concat(this.style.queryRenderedFeatureset(c,t,this.transform))),p}querySourceFeatures(c,t){return!c||typeof c=="string"&&!this._isValidId(c)?[]:this.style.querySourceFeatures(c,t)}queryRasterValue(c,t,r){return this._isValidId(c)?this.style.queryRasterValue(c,t,r):Promise.resolve(null)}isPointOnSurface(c){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&o.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(c))}addInteraction(c,t){return this._interactions.add(c,t),this}removeInteraction(c){return this._interactions.remove(c),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(c){return this._cooperativeGestures=c,this}setStyle(c,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&c&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(c,((r,u)=>{if(r){const p=typeof r=="string"?r:r instanceof Error?r.message:r.error;o.w(`Unable to perform style diff: ${p}. Rebuilding the style from scratch.`),this._updateStyle(c,t)}else u&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(c,t))}_getUIString(c){const t=this._locale[c];if(t==null)throw new Error(`Missing UI string '${c}'`);return t}_updateStyle(c,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c){const r=Object.assign({},t);t&&t.config&&(r.initialConfig=t.config,delete r.config),this.style=new Ho(this,r).load(c),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ho(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(c){return c==null?(this.fire(new o.y(new Error("IDs can't be empty."))),!1):!o.dq(c)||(this.fire(new o.y(new Error(`IDs can't contain special symbols: "${c}".`))),!1)}_isTargetValid(c){return"featuresetId"in c?this._isValidId("importId"in c?c.importId:c.featuresetId):"layerId"in c&&this._isValidId(c.layerId)}_areTargetsValid(c){if(Array.isArray(c)){for(const t of c)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(c)}addSource(c,t){return this._isValidId(c)?(this._lazyInitEmptyStyle(),this.style.addSource(c,t),this._update(!0)):this}isSourceLoaded(c){return!!this._isValidId(c)&&!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(c,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(c,t,r)}removeSource(c){return this._isValidId(c)?(this.style.removeSource(c),this._updateTerrain(),this._update(!0)):this}getSource(c){return this._isValidId(c)?this.style.getOwnSource(c):null}addImage(c,t,{pixelRatio:r=1,sdf:u=!1,stretchX:p,stretchY:_,content:y}={}){this._lazyInitEmptyStyle();const b=o.I.from(c);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:T,height:M,data:I}=o.o.getImageData(t);this.style.addImage(b,{data:new o.q({width:T,height:M},I),pixelRatio:r,stretchX:p,stretchY:_,content:y,sdf:u,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new o.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:T,height:M}=t,I=t;this.style.addImage(b,{data:new o.q({width:T,height:M},new Uint8Array(I.data)),pixelRatio:r,stretchX:p,stretchY:_,content:y,sdf:u,usvg:!1,version:0,userImage:I}),I.onAdd&&I.onAdd(this,c)}}updateImage(c,t){this._lazyInitEmptyStyle();const r=o.I.from(c),u=this.style.getImage(r);if(!u)return void this.fire(new o.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?o.o.getImageData(t):t,{width:_,height:y,data:b}=p;if(_===void 0||y===void 0)return void this.fire(new o.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==(u.usvg?u.icon.usvg_tree.width:u.data.width)||y!==(u.usvg?u.icon.usvg_tree.height:u.data.height))return void this.fire(new o.y(new Error(`The width and height of the updated image (${_}, ${y})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`)));const T=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let M=!1;u.usvg?(u.data=new o.q({width:_,height:y},new Uint8Array(b)),u.usvg=!1,u.icon=void 0,M=!0):u.data.replace(b,T),this.style.updateImage(r,u,M)}hasImage(c){return c?!!this.style&&!!this.style.getImage(o.I.from(c)):(this.fire(new o.y(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(o.I.from(c))}loadImage(c,t){o.n(this._requestManager.transformRequest(c,o.R.Image),((r,u)=>{t(r,u instanceof HTMLImageElement?o.o.getImageData(u):u)}))}listImages(){return this.style.listImages().map((c=>c.name))}addModel(c,t){this._lazyInitEmptyStyle(),this.style.addModel(c,t)}hasModel(c){return c?this.style.hasModel(c):(this.fire(new o.y(new Error("Missing required model id"))),!1)}removeModel(c){this.style.removeModel(c)}listModels(){return this.style.listModels()}addLayer(c,t){return this._isValidId(c.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(c,t),this._update(!0)):this}getSlot(c){const t=this.getLayer(c);return t&&t.slot||null}setSlot(c,t){return this.style.setSlot(c,t),this.style.mergeLayers(),this._update(!0)}addImport(c,t){return this.style.addImport(c,t).catch((r=>this.fire(new o.y(new Error("Failed to add import",r))))),this}updateImport(c,t){return typeof t!="string"&&t.id!==c?(this.removeImport(c),this.addImport(t)):(this.style.updateImport(c,t),this._update(!0))}removeImport(c){return this.style.removeImport(c),this}moveImport(c,t){return this.style.moveImport(c,t),this._update(!0)}moveLayer(c,t){return this._isValidId(c)?(this.style.moveLayer(c,t),this._update(!0)):this}removeLayer(c){return this._isValidId(c)?(this.style.removeLayer(c),this._update(!0)):this}getLayer(c){if(!this._isValidId(c))return null;const t=this.style.getOwnLayer(c);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(c,t,r){return this._isValidId(c)?(this.style.setLayerZoomRange(c,t,r),this._update(!0)):this}setFilter(c,t,r={}){return this._isValidId(c)?(this.style.setFilter(c,t,r),this._update(!0)):this}getFilter(c){return this._isValidId(c)?this.style.getFilter(c):null}setPaintProperty(c,t,r,u={}){return this._isValidId(c)?(this.style.setPaintProperty(c,t,r,u),this._update(!0)):this}getPaintProperty(c,t){return this._isValidId(c)?this.style.getPaintProperty(c,t):null}setLayoutProperty(c,t,r,u={}){return this._isValidId(c)?(this.style.setLayoutProperty(c,t,r,u),this._update(!0)):this}getLayoutProperty(c,t){return this._isValidId(c)?this.style.getLayoutProperty(c,t):null}setLayerProperty(c,t,r,u={}){return this._isValidId(c)?(this.style.setLayerProperty(c,t,r,u),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(c){return this.style.setGlyphsUrl(c),this._update(!0)}getSchema(c){return this.style.getSchema(c)}setSchema(c,t){return this.style.setSchema(c,t),this._update(!0)}getConfig(c){return this.style.getConfig(c)}setConfig(c,t){return this.style.setConfig(c,t),this._update(!0)}getConfigProperty(c,t){return this.style.getConfigProperty(c,t)}setConfigProperty(c,t,r){return this.style.setConfigProperty(c,t,r),this._update(!0)}getFeaturesetDescriptors(c){return this.style.getFeaturesetDescriptors(c)}setLights(c){if(this._lazyInitEmptyStyle(),c&&c.length===1&&c[0].type==="flat"){const t=c[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(c),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const c=this.style.getLights()||[];return c.length===0&&c.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),c}setLight(c,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:c}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(c){return this._lazyInitEmptyStyle(),this.style.setSnow(c),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(c){return this._lazyInitEmptyStyle(),this.style.setRain(c),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(c){return this._lazyInitEmptyStyle(),this.style.setColorTheme(c),this._update(!0)}setImportColorTheme(c,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(c,t),this._update(!0)}setCamera(c){return this.style.setCamera(c),this._triggerCameraUpdate(c)}_triggerCameraUpdate(c){return this._update(this.transform.setOrthographicProjectionAtLowPitch(c["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.aS.convert(c),this.transform):0}setFeatureState(c,t){return c.source&&!this._isValidId(c.source)?this:(this.style.setFeatureState(c,t),this._update())}removeFeatureState(c,t){return c.source&&!this._isValidId(c.source)?this:(this.style.removeFeatureState(c,t),this._update())}getFeatureState(c){return c.source&&!this._isValidId(c.source)?null:this.style.getFeatureState(c)}_selectIndoorFloor(c){this.indoor.selectFloor(c)}_setIndoorActiveFloorsVisibility(c){this.indoor.setActiveFloorsVisibility(c)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new ah),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let r,u,p,_=this._container;for(;_&&(!u||!p);){const y=window.getComputedStyle(_).transform;y&&y!=="none"&&(r=y.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&r[0]!=="0"&&r[0]!=="1"&&(u=r[0]),r[3]&&r[3]!=="0"&&r[3]!=="1"&&(p=r[3])),_=_.parentElement}this._containerWidth=u?Math.abs(c/u):c,this._containerHeight=p?Math.abs(t/p):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Cc(this.style),this.on("load",(()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})),this.on("idle",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}))})))}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=hi("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=hi("div","mapboxgl-canvas-container",c);this._canvas=hi("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=hi("div","mapboxgl-control-container",c),u=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((p=>{u[p]=hi("div",`mapboxgl-ctrl-${p}`,r)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,t){const r=o.o.devicePixelRatio||1;this._canvas.width=r*Math.ceil(c),this._canvas.height=r*Math.ceil(t),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${t}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const t=this._markers.indexOf(c);t!==-1&&this._markers.splice(t,1)}_addPopup(c){this._popups.push(c)}_removePopup(c){const t=this._popups.indexOf(c);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const c=Object.assign({},yn.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",c);t?(ro(t,!0),this.painter=new Al(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",(r=>{r.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),o.k.testSupport(t)):this.fire(new o.y(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.z("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.z("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let t;this.fire(new o.z("renderstart")),++this._frameId;const r=this.painter.context.extTimerQuery,u=o.o.now(),p=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=p.createQuery(),p.beginQuery(r.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,I=this.transform.pitch,P=o.o.now(),z=new o.ac(M,{now:P,fadeDuration:_,pitch:I,transition:this.style.transition,worldview:this._worldview});this.style.update(z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let y=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),y=this._updateAverageElevation(u),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):y=this._updateAverageElevation(u);const b=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),b&&(this._placementDirty=b.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,ci.mark(We.load),this.fire(new o.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const M=o.o.now()-u;p.endQuery(r.TIME_ELAPSED_EXT),setTimeout((()=>{const I=p.getQueryParameter(t,p.QUERY_RESULT)/1e6;p.deleteQuery(t),this.fire(new o.z("gpu-timing-frame",{cpuTime:M,gpuTime:I}))}),50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout((()=>{const I=this.painter.queryGpuTimers(M);this.fire(new o.z("gpu-timing-layer",{layerTimes:I}))}),50)}if(this.listens("gpu-timing-deferred-render")){const M=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const I=this.painter.queryGpuTimeDeferredRender(M);this.fire(new o.z("gpu-timing-deferred-render",{gpuTime:I}))}),50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(T||this._repaint)this.triggerRepaint();else{const M=this.idle();if(M&&(y=this._updateAverageElevation(u,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new o.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const I=this._calculateSpeedIndex();this.fire(new o.z("speedindexcompleted",{speedIndex:I})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,ci.mark(We.fullLoad),this._performanceMetricsCollection&&br(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(c){for(const t of this._markers)c&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!c||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(c,t=!1){const r=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&r(0);const u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(t||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=c;const y=Math.abs(p-_);if(y>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(_),r(_);this._averageElevation.easeTo(_,c,300)}else if(y>1e-4)return this._averageElevation.jumpTo(_),r(_)}return!!this._averageElevation.isEasing(c)&&r(this._averageElevation.getValue(c))}_authenticate(){Ol(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(c=>{if(c&&(c.message===Yi||c.status===401)){const t=this.painter.context.gl;ro(t,!1),this._logoControl instanceof rh&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),gi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&En(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Lr(this._requestManager._customAccessToken)}_updateTerrain(){const c=this._isDragging();this.painter.updateTerrain(this.style,c)}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,u=r.createFramebuffer();function p(_){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,_,0);const y=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,y),y}return r.bindFramebuffer(r.FRAMEBUFFER,u),this._canvasPixelComparison(p(c),t.canvasCopies.map(p),t.timeStamps)}_canvasPixelComparison(c,t,r){let u=r[1]-r[0];const p=c.length/4;for(let _=0;_<t.length;_++){const y=t[_];let b=0;for(let T=0;T<y.length;T+=4)y[T]===c[T]&&y[T+1]===c[T+1]&&y[T+2]===c[T+2]&&y[T+3]===c[T+3]&&(b+=1);u+=(r[_+2]-r[_+1])*(1-b/p)}return u}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),sr.delete(this.painter.context.gl),Br.remove(),qt.remove(),this._removed=!0,this.fire(new o.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=o.o.frame((t=>{const r=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,r&&this._render(t)})))}_preloadTiles(c){const t=this.style?this.style.getSourceCaches():[];return o.bv(t,((r,u)=>r._preloadTiles(c,u)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(c){this._showParseStatus!==c&&(this._showParseStatus=c,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(c){this._showLayers2DWireframe!==c&&(this._showLayers2DWireframe=c,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(c){this._showLayers3DWireframe!==c&&(this._showLayers3DWireframe=c,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,this._tp.refreshUI(),c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(c){this._showTileAABBs!==c&&(this._showTileAABBs=c,this._tp.refreshUI(),c&&this._update())}_setCacheLimits(c,t){o.f3(c,t)}get version(){return Tt}},NavigationControl:class{constructor(c={}){this.options=Object.assign({},ud,c),this._container=hi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(o.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),hi("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),hi("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const r=this._map;r&&(this.options.visualizePitch?r.resetNorthPitch({},{originalEvent:t}):r.resetNorth({},{originalEvent:t}))})),this._compassIcon=hi("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const t=c.getZoom(),r=t===c.getMaxZoom(),u=t===c.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new sh(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,t){const r=hi("button",c,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(c,t){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${t}`);c.setAttribute("aria-label",r),c.firstElementChild&&c.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends o.E{constructor(c={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},Qo,c),o.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=_s(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=hi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){const t=(r=!!this.options.geolocation)=>{this._supportsGeolocation=r,c(r)};this._supportsGeolocation!==void 0?c(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((r=>t(r.state!=="denied"))).catch((()=>t())):t()}_isOutOfMapMaxBounds(c){const t=this._map.getMaxBounds(),r=c.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new o.z("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("geolocate",Object.assign({coords:c.coords,timestamp:c.timestamp},c.toJSON?{toJSON:c.toJSON.bind(c)}:{}))),this._finish()}}_updateCamera(c){const t=new o.aS(c.coords.longitude,c.coords.latitude),r=c.coords.accuracy,u=this._map.getBearing(),p=Object.assign({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(r),p,{geolocateSource:!0})}_updateMarker(c){if(c){const t=new o.aS(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,t=o.ce(1,c._center.lat)*c.worldSize,r=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=hi("button","mapboxgl-ctrl-geolocate",this._container),hi("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=hi("div","mapboxgl-user-location"),this._dotElement.appendChild(hi("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(hi("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ys({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=hi("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ys({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.z("trackuserlocationend")))}))}}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((t=>{t==="granted"&&c()})).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:hc,ScaleControl:class{constructor(c={}){this.options=Object.assign({},u1,c),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),o.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,u=t._containerWidth/2-c/2,p=t.unproject([u,r]),_=t.unproject([u+c,r]),y=p.distanceTo(_);if(this.options.unit==="imperial"){const b=3.2808*y;b>5280?this._setScale(c,b/5280,"mile"):this._setScale(c,b,"foot")}else this.options.unit==="nautical"?this._setScale(c,y/1852,"nautical-mile"):y>=1e3?this._setScale(c,y/1e3,"kilometer"):this._setScale(c,y,"meter")}_setScale(c,t,r){this._map._requestDomTask((()=>{const u=(function(_){const y=Math.pow(10,`${Math.floor(_)}`.length-1);let b=_/y;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:(function(T){const M=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*M)/M})(b),y*b})(t),p=u/t;this._container.innerHTML=this._isNumberFormatSupported&&r!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(u):`${u}&nbsp;${h1[r]}`,this._container.style.width=c*p+"px"}))}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=hi("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c={}){this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:o.w("Full screen control 'container' must be a DOM element.")),o.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=hi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=hi("button","mapboxgl-ctrl-fullscreen",this._controlContainer);hi("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:ah,Popup:class extends o.E{constructor(c){super(),this.options=Object.assign(Object.create(uf),c),this._altitude=this.options.altitude,o.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),c._addPopup(this),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new o.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),c._canvasContainer&&c._canvasContainer.classList.remove("mapboxgl-track-pointer"),c._removePopup(this),this._map=void 0),this.fire(new o.z("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=o.aS.convert(c),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(c){return this._altitude=c,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const t=document.createDocumentFragment(),r=document.createElement("body");let u;for(r.innerHTML=c;u=r.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=hi("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(c),this.options.closeButton){const r=this._closeButton=hi("button","mapboxgl-popup-close-button",t);r.type="button",r.setAttribute("aria-label","Close popup"),r.innerHTML='<span aria-hidden="true">&#215;</span>',r.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let t;return this._classList.delete(c)?t=!1:(this._classList.add(c),t=!0),this._updateClassList(),t}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,u=this._pos;if(!t||!r||!u)return"bottom";const p=r.offsetWidth,_=r.offsetHeight,y=u.x<p/2,b=u.x>t.transform.width-p/2;if(u.y+c<_)return y?"top-left":b?"top-right":"top";if(u.y>t.transform.height-_){if(y)return"bottom-left";if(b)return"bottom-right"}return y?"left":b?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),c.className=t.join(" ")}_update(c){const t=this._map,r=this._content;if(!t||!this._lngLat&&!this._trackPointer||!r)return;let u=this._container;if(u||(u=this._container=hi("div","mapboxgl-popup",t.getContainer()),this._tip=hi("div","mapboxgl-popup-tip",u),u.appendChild(r)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Lo(this._lngLat,this._pos,t.transform)),!this._trackPointer||c){const p=this._pos=this._trackPointer&&c instanceof o.P?c:t.project(this._lngLat,this._altitude),_=vs(this.options.offset),y=this._anchor=this._getAnchor(_.y),b=vs(this.options.offset,y),T=p.add(b).round();t._requestDomTask((()=>{this._container&&y&&(this._container.style.transform=`${ha[y]} translate(${T.x}px,${T.y}px)`)}))}if(!this._marker&&t._showingGlobe()){const p=o.f4(t.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(np);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:ys,Style:Ho,LngLat:o.aS,LngLatBounds:o.aI,Point:o.P,MercatorCoordinate:o.ae,FreeCameraOptions:ks,Evented:o.E,config:o.e,prewarm:o.f8,clearPrewarmedResources:o.f7,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(c){o.e.ACCESS_TOKEN=c},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(c){o.e.API_URL=c},get workerCount(){return o.fh.workerCount},set workerCount(c){o.fh.workerCount=c},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){o.e.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){o.fg(c)},get workerUrl(){return o.ff.workerUrl},set workerUrl(c){o.ff.workerUrl=c},get workerClass(){return o.ff.workerClass},set workerClass(c){o.ff.workerClass=c},get workerParams(){return o.ff.workerParams},set workerParams(c){o.ff.workerParams=c},get dracoUrl(){return o.fe()},set dracoUrl(c){o.fd(c)},get meshoptUrl(){return o.fc()},set meshoptUrl(c){o.fb(c)},setNow:o.o.setNow,restoreNow:o.o.restoreNow}}));var ft=Ae;return ft}))})(s_)),s_.exports}var C4=w7();const z4=v2(C4),T7=x6({__proto__:null,default:z4},[C4]),$m={center:[12,50],zoom:3.3},S7=60,E7="mapbox://styles/mapbox/light-v11",A7=({countryFeatures:ae,visitedSet:me,selectedId:Ie,hoveredId:oe,onSelect:Ae,onHover:ke,onResetView:ft,mapStyleUrl:o,mapboxToken:Tt})=>{const We=di.useRef(null),ci=Ci=>{const ki=Ci?.getStyle?.();ki?.layers&&ki.layers.forEach(si=>{si.type==="symbol"&&si.id.includes("settlement-")&&Ci.setLayoutProperty(si.id,"visibility","none")})};di.useEffect(()=>{if(!Ie){We.current?.flyTo({center:$m.center,zoom:$m.zoom,duration:600});return}const Ci=ae.features.find(ln=>ln.properties?.id===Ie);if(!Ci)return;const[ki,si,_n,mr]=k6(Ci);We.current?.fitBounds([[ki,si],[_n,mr]],{padding:S7,duration:800})},[Ie,ae]);const Ft=di.useMemo(()=>Array.from(me),[me]),Pi={id:"countries-base",type:"fill",source:"countries",paint:{"fill-color":["case",["==",["get","id"],Ie],"#5db7ff",["==",["get","id"],oe],"#e6f0ff",["in",["get","id"],["literal",Ft]],"#7bd88f","#6f7690"],"fill-opacity":.85}},Hi={id:"countries-borders",type:"line",source:"countries",paint:{"line-color":"#0a0f24","line-width":1}},yn={id:"countries-hovered",type:"line",source:"countries",filter:["==",["get","id"],oe],paint:{"line-color":"#2563eb","line-width":2}},hi={id:"countries-selected",type:"line",source:"countries",filter:["==",["get","id"],Ie],paint:{"line-color":"#2563eb","line-width":3}},$i=Ci=>{const si=Ci.features?.find(_n=>_n.properties?.id)?.properties?.id;Ae(si??null)},vn=Ci=>{const si=Ci.features?.find(_n=>_n.properties?.id)?.properties?.id;ke(si??null)};return Bi.jsxs("section",{className:"panel panel--map","aria-label":"World map",children:[Bi.jsxs("div",{className:"map__toolbar",children:[Bi.jsx("span",{className:"toolbar__label",children:"Map"}),Bi.jsxs("div",{className:"toolbar__actions",role:"group","aria-label":"Map controls",children:[Bi.jsx("button",{className:"icon-button",onClick:()=>We.current?.zoomOut(),type:"button",title:"Zoom out",children:""}),Bi.jsx("button",{className:"icon-button",onClick:()=>We.current?.zoomIn(),type:"button",title:"Zoom in",children:"+"})]})]}),Bi.jsx("div",{className:"map__canvas",children:Bi.jsx(s7,{attributionControl:!1,ref:We,mapLib:z4,reuseMaps:!0,initialViewState:{longitude:$m.center[0],latitude:$m.center[1],zoom:$m.zoom},mapStyle:o,mapboxAccessToken:Tt,renderWorldCopies:!1,interactiveLayerIds:["countries-base"],onClick:$i,onMouseMove:vn,onMouseLeave:()=>ke(null),onLoad:Ci=>ci(Ci.target),children:Bi.jsxs(g7,{id:"countries",type:"geojson",data:ae,children:[Bi.jsx(o_,{...Pi}),Bi.jsx(o_,{...Hi}),Bi.jsx(o_,{...yn}),Bi.jsx(o_,{...hi})]})})})]})},M7=({checked:ae,onChange:me})=>Bi.jsxs("label",{className:"toggle",htmlFor:"visited-toggle",children:[Bi.jsx("input",{id:"visited-toggle",type:"checkbox",checked:ae,onChange:Ie=>me(Ie.target.checked)}),Bi.jsx("span",{className:"toggle__track",children:Bi.jsx("span",{className:"toggle__thumb"})}),Bi.jsxs("div",{className:"toggle__copy",children:[Bi.jsx("span",{className:"toggle__title",children:"Visited only"}),Bi.jsx("span",{className:"toggle__hint",children:"Hide countries not checked off"})]})]}),I7=ae=>{const me=[];let Ie=null;const oe=ae.split(`
`);for(let Ae=0;Ae<oe.length;Ae++){const ke=oe[Ae],ft=ke.trim();if(!ft.length)continue;if(ft.startsWith("# ")){Ie={name:ft.substring(2).trim(),countries:[]},me.push(Ie);continue}const o=ke.match(/^\-\s*\[([xX\s])\]\s+([A-Za-z-]{2,})\s+(.+?)(?::\s*(\|)?\s*(.*))?$/);if(o&&Ie){const Tt=o[1].toLowerCase()==="x",We=o[2],ci=o[3].trim(),Ft=!!o[4],Pi=o[5]?.trim();let Hi=Pi?.length?Pi:void 0;if(Ft){const yn=[];let hi=Ae+1;for(;hi<oe.length;){const vn=oe[hi];if(/^\s{2,}/.test(vn)){yn.push(vn.replace(/^\s+/,"")),hi++;continue}if(!vn.trim().length){yn.push(""),hi++;continue}break}const $i=yn.join(`
`).trim();Hi=$i.length?$i:Hi,Ae=hi-1}Ie.countries.push({id:We,name:ci,visited:Tt,description:Hi})}}return me.map(Ae=>({...Ae,countries:Ae.countries.sort((ke,ft)=>ke.name.localeCompare(ft.name))}))},C7=ae=>ae.flatMap(me=>me.countries),z7=()=>{const[ae,me]=di.useState({regions:[],loading:!0,error:null});return di.useEffect(()=>{let Ie=!1;return(async()=>{try{const Ae=new URL("countries.md",new URL("./",window.location.href)).toString(),ke=await fetch(Ae);if(!ke.ok)throw new Error("Failed to load countries.md");const ft=await ke.text();if(Ie)return;const o=I7(ft);me({regions:o,loading:!1,error:null})}catch(Ae){const ke=Ae instanceof Error?Ae.message:"Unknown error";Ie||me({regions:[],loading:!1,error:ke})}})(),()=>{Ie=!0}},[]),ae},R7=()=>({type:"FeatureCollection",features:D6.features.map(me=>{if(!me.geometry)return null;const Ie=(me.properties?.id||"").toString().toUpperCase(),oe=me.properties?.name||"";return!Ie||!oe?null:{type:"Feature",geometry:me.geometry,properties:{id:Ie,name:oe}}}).filter(me=>!!me)}),D7="pk.eyJ1IjoibXhzY2htaXR0IiwiYSI6ImNtaWV6emYwdTA4bnYzY3BoMWRzZ2lub2QifQ.6iw4F5vY3-BUZ3RG_KyNEA",P7=()=>{const{regions:ae,loading:me,error:Ie}=z7(),[oe,Ae]=di.useState(null),[ke,ft]=di.useState(null),[o,Tt]=di.useState(""),[We,ci]=di.useState(!1),Ft=di.useRef({}),[Pi,Hi]=di.useState({type:"FeatureCollection",features:[]});di.useEffect(()=>{Hi(R7())},[]);const yn=di.useMemo(()=>C7(ae),[ae]),hi=di.useMemo(()=>new Set(yn.filter(si=>si.visited).map(si=>si.id)),[yn]),$i=di.useMemo(()=>yn.filter(si=>si.visited).length,[yn]),vn=si=>_n=>{_n?Ft.current[si]=_n:delete Ft.current[si]};di.useEffect(()=>{if(!oe)return;const si=Ft.current[oe];if(si){si.scrollIntoView({behavior:"smooth",block:"center"});try{si.focus({preventScroll:!0})}catch{si.focus()}}},[oe]);const Ci=(si,_n={})=>{if(_n.hoverOnly){ft(si);return}Ae(mr=>mr===si?null:si)},ki=()=>Ae(null);return me?Bi.jsx("div",{className:"app app--loading",children:"Loading map and countries"}):Ie?Bi.jsx("div",{className:"app app--error",children:`Something went wrong: ${Ie}`}):Bi.jsxs("div",{className:"app",children:[Bi.jsxs("header",{className:"app__header",children:[Bi.jsxs("div",{className:"brand",children:[Bi.jsx("div",{className:"brand__title",children:"Where Has Volker Been?"}),Bi.jsx("div",{className:"brand__subtitle",children:"Max Schmitt's visited countries tracker"})]}),Bi.jsxs("div",{className:"stats",children:[Bi.jsx("div",{className:"stats__globe","aria-hidden":"true",children:""}),Bi.jsxs("div",{className:"stats__body",children:[Bi.jsxs("div",{className:"stats__value",children:[$i,"/",yn.length]}),Bi.jsx("div",{className:"stats__label",children:"Visited"})]})]})]}),Bi.jsxs("section",{className:"filters","aria-label":"Filters",children:[Bi.jsxs("div",{className:"field",children:[Bi.jsx("label",{htmlFor:"search",children:"Search"}),Bi.jsx("input",{id:"search",type:"search",value:o,onChange:si=>Tt(si.target.value),placeholder:"Find a country by name or code",autoComplete:"off"})]}),Bi.jsx("div",{className:"field toggle-field",children:Bi.jsx(M7,{checked:We,onChange:ci})})]}),Bi.jsxs("main",{className:"layout",children:[Bi.jsx(F6,{regions:ae,selectedId:oe,hoveredId:ke,onSelect:Ci,search:o,visitedOnly:We,registerRef:vn}),Bi.jsx(A7,{countryFeatures:Pi,visitedSet:hi,selectedId:oe,hoveredId:ke,onSelect:si=>Ci(si),onHover:si=>ft(si),onResetView:ki,mapStyleUrl:E7,mapboxToken:D7})]}),Bi.jsxs("footer",{className:"app__footer",children:["Source available on"," ",Bi.jsx("a",{href:"https://github.com/mxschmitt/been",target:"_blank",rel:"noreferrer",children:"GitHub"}),"."]})]})},b4=document.getElementById("root");b4&&R6.createRoot(b4).render(Bi.jsx(S6.StrictMode,{children:Bi.jsx(P7,{})}));
